/*! zq-3.3.0.js 2020-06-09 */

function hex_md5(a){return binl2hex(core_md5(str2binl(a),a.length*chrsz))}function b64_md5(a){return binl2b64(core_md5(str2binl(a),a.length*chrsz))}function str_md5(a){return binl2str(core_md5(str2binl(a),a.length*chrsz))}function hex_hmac_md5(a,b){return binl2hex(core_hmac_md5(a,b))}function b64_hmac_md5(a,b){return binl2b64(core_hmac_md5(a,b))}function str_hmac_md5(a,b){return binl2str(core_hmac_md5(a,b))}function md5_vm_test(){return"900150983cd24fb0d6963f7d28e17f72"==hex_md5("abc")}function core_md5(a,b){a[b>>5]|=128<<b%32,a[14+(b+64>>>9<<4)]=b;for(var c=1732584193,d=-271733879,e=-1732584194,f=271733878,g=0;g<a.length;g+=16){var h=c,i=d,j=e,k=f;c=md5_ff(c,d,e,f,a[g+0],7,-680876936),f=md5_ff(f,c,d,e,a[g+1],12,-389564586),e=md5_ff(e,f,c,d,a[g+2],17,606105819),d=md5_ff(d,e,f,c,a[g+3],22,-1044525330),c=md5_ff(c,d,e,f,a[g+4],7,-176418897),f=md5_ff(f,c,d,e,a[g+5],12,1200080426),e=md5_ff(e,f,c,d,a[g+6],17,-1473231341),d=md5_ff(d,e,f,c,a[g+7],22,-45705983),c=md5_ff(c,d,e,f,a[g+8],7,1770035416),f=md5_ff(f,c,d,e,a[g+9],12,-1958414417),e=md5_ff(e,f,c,d,a[g+10],17,-42063),d=md5_ff(d,e,f,c,a[g+11],22,-1990404162),c=md5_ff(c,d,e,f,a[g+12],7,1804603682),f=md5_ff(f,c,d,e,a[g+13],12,-40341101),e=md5_ff(e,f,c,d,a[g+14],17,-1502002290),d=md5_ff(d,e,f,c,a[g+15],22,1236535329),c=md5_gg(c,d,e,f,a[g+1],5,-165796510),f=md5_gg(f,c,d,e,a[g+6],9,-1069501632),e=md5_gg(e,f,c,d,a[g+11],14,643717713),d=md5_gg(d,e,f,c,a[g+0],20,-373897302),c=md5_gg(c,d,e,f,a[g+5],5,-701558691),f=md5_gg(f,c,d,e,a[g+10],9,38016083),e=md5_gg(e,f,c,d,a[g+15],14,-660478335),d=md5_gg(d,e,f,c,a[g+4],20,-405537848),c=md5_gg(c,d,e,f,a[g+9],5,568446438),f=md5_gg(f,c,d,e,a[g+14],9,-1019803690),e=md5_gg(e,f,c,d,a[g+3],14,-187363961),d=md5_gg(d,e,f,c,a[g+8],20,1163531501),c=md5_gg(c,d,e,f,a[g+13],5,-1444681467),f=md5_gg(f,c,d,e,a[g+2],9,-51403784),e=md5_gg(e,f,c,d,a[g+7],14,1735328473),d=md5_gg(d,e,f,c,a[g+12],20,-1926607734),c=md5_hh(c,d,e,f,a[g+5],4,-378558),f=md5_hh(f,c,d,e,a[g+8],11,-2022574463),e=md5_hh(e,f,c,d,a[g+11],16,1839030562),d=md5_hh(d,e,f,c,a[g+14],23,-35309556),c=md5_hh(c,d,e,f,a[g+1],4,-1530992060),f=md5_hh(f,c,d,e,a[g+4],11,1272893353),e=md5_hh(e,f,c,d,a[g+7],16,-155497632),d=md5_hh(d,e,f,c,a[g+10],23,-1094730640),c=md5_hh(c,d,e,f,a[g+13],4,681279174),f=md5_hh(f,c,d,e,a[g+0],11,-358537222),e=md5_hh(e,f,c,d,a[g+3],16,-722521979),d=md5_hh(d,e,f,c,a[g+6],23,76029189),c=md5_hh(c,d,e,f,a[g+9],4,-640364487),f=md5_hh(f,c,d,e,a[g+12],11,-421815835),e=md5_hh(e,f,c,d,a[g+15],16,530742520),d=md5_hh(d,e,f,c,a[g+2],23,-995338651),c=md5_ii(c,d,e,f,a[g+0],6,-198630844),f=md5_ii(f,c,d,e,a[g+7],10,1126891415),e=md5_ii(e,f,c,d,a[g+14],15,-1416354905),d=md5_ii(d,e,f,c,a[g+5],21,-57434055),c=md5_ii(c,d,e,f,a[g+12],6,1700485571),f=md5_ii(f,c,d,e,a[g+3],10,-1894986606),e=md5_ii(e,f,c,d,a[g+10],15,-1051523),d=md5_ii(d,e,f,c,a[g+1],21,-2054922799),c=md5_ii(c,d,e,f,a[g+8],6,1873313359),f=md5_ii(f,c,d,e,a[g+15],10,-30611744),e=md5_ii(e,f,c,d,a[g+6],15,-1560198380),d=md5_ii(d,e,f,c,a[g+13],21,1309151649),c=md5_ii(c,d,e,f,a[g+4],6,-145523070),f=md5_ii(f,c,d,e,a[g+11],10,-1120210379),e=md5_ii(e,f,c,d,a[g+2],15,718787259),d=md5_ii(d,e,f,c,a[g+9],21,-343485551),c=safe_add(c,h),d=safe_add(d,i),e=safe_add(e,j),f=safe_add(f,k)}return Array(c,d,e,f)}function md5_cmn(a,b,c,d,e,f){return safe_add(bit_rol(safe_add(safe_add(b,a),safe_add(d,f)),e),c)}function md5_ff(a,b,c,d,e,f,g){return md5_cmn(b&c|~b&d,a,b,e,f,g)}function md5_gg(a,b,c,d,e,f,g){return md5_cmn(b&d|c&~d,a,b,e,f,g)}function md5_hh(a,b,c,d,e,f,g){return md5_cmn(b^c^d,a,b,e,f,g)}function md5_ii(a,b,c,d,e,f,g){return md5_cmn(c^(b|~d),a,b,e,f,g)}function core_hmac_md5(a,b){var c=str2binl(a);c.length>16&&(c=core_md5(c,a.length*chrsz));for(var d=Array(16),e=Array(16),f=0;f<16;f++)d[f]=909522486^c[f],e[f]=1549556828^c[f];var g=core_md5(d.concat(str2binl(b)),512+b.length*chrsz);return core_md5(e.concat(g),640)}function safe_add(a,b){var c=(65535&a)+(65535&b);return(a>>16)+(b>>16)+(c>>16)<<16|65535&c}function bit_rol(a,b){return a<<b|a>>>32-b}function str2binl(a){for(var b=Array(),c=(1<<chrsz)-1,d=0;d<a.length*chrsz;d+=chrsz)b[d>>5]|=(a.charCodeAt(d/chrsz)&c)<<d%32;return b}function binl2str(a){for(var b="",c=(1<<chrsz)-1,d=0;d<32*a.length;d+=chrsz)b+=String.fromCharCode(a[d>>5]>>>d%32&c);return b}function binl2hex(a){for(var b=hexcase?"0123456789ABCDEF":"0123456789abcdef",c="",d=0;d<4*a.length;d++)c+=b.charAt(a[d>>2]>>d%4*8+4&15)+b.charAt(a[d>>2]>>d%4*8&15);return c}function binl2b64(a){for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",c="",d=0;d<4*a.length;d+=3)for(var e=(a[d>>2]>>d%4*8&255)<<16|(a[d+1>>2]>>(d+1)%4*8&255)<<8|a[d+2>>2]>>(d+2)%4*8&255,f=0;f<4;f++)8*d+6*f>32*a.length?c+=b64pad:c+=b.charAt(e>>6*(3-f)&63);return c}var hexcase=0,b64pad="",chrsz=8;if(function(){"use strict";function a(a,b){return typeof a===b}function b(a,b){return a instanceof b}function c(a){return a&&a.nodeType}function d(a){return c(a)?a:b(a,r)?a[0]:void 0}function e(a,b,c){return r.each(a,function(a,d){c=b.call(d,c,a,d)}),c}function f(a,b,c){var d,e,f;if(a===b)return!0;if(!a||!b||a.constructor!==b.constructor)return!1;for(d=0,e=c.length;e>d;d+=1){if(f=c[d],a[f]&&v(a[f].equals)&&!a[f].equals(b[f]))return!1;if(a[f]!==b[f])return!1}return!0}function g(a,b,c,d){this.left=y(a),this.top=y(b),this.width=y(c),this.height=y(d),this.right=this.left+this.width,this.bottom=this.top+this.height}function h(a,b,c,d){this.visible=a||0,this.viewport=b||0,this.possible=c||0,this.rects=d&&u({},d)||null}function i(a,b){this.els=a,this.viewport=b}function j(a,b,c){var d;return r.inArray(c,A)>=0?d=g.ofElement(a):r.inArray(c,B)>=0&&(d=h.of(a,b)),d?d[c]:0}function k(a,b){return a.val-b.val}function l(a,b){return b.val-a.val}function m(a){var b=g.ofContent(a,!0),c=g.ofViewport(a,!0),d=b.width-c.width,e=b.height-c.height;this.content=b,this.viewport=c,this.width=0>=d?null:c.left/d,this.height=0>=e?null:c.top/e,this.left=c.left,this.top=c.top,this.right=b.right-c.right,this.bottom=b.bottom-c.bottom}function n(a){this.el=a||window}function o(a,b){this.context=a,this.viewport=b,this.init()}function p(a,b,c,d){this.context=new i(a,b),this.property=c,this.descending=d,this.init()}function q(a){a&&a!==window&&a!==document?(this.context=a,this.$autoTarget=r(a)):this.context=window,this.init()}var r=jQuery,s=r(window),t=r(document),u=r.extend,v=r.isFunction,w=Math.max,x=Math.min,y=Math.round,z=function(){var a={},b=1;return function(c){return c?(a[c]||(a[c]=b,b+=1),a[c]):0}}();u(g.prototype,{equals:function(a){return f(this,a,["left","top","width","height"])},area:function(){return this.width*this.height},relativeTo:function(a){return new g(this.left-a.left,this.top-a.top,this.width,this.height)},intersection:function(a){if(!b(a,g))return null;var c=w(this.left,a.left),d=x(this.right,a.right),e=w(this.top,a.top),f=x(this.bottom,a.bottom),h=d-c,i=f-e;return h>=0&&i>=0?new g(c,e,h,i):null},envelope:function(a){if(!b(a,g))return this;var c=x(this.left,a.left),d=w(this.right,a.right),e=x(this.top,a.top);return new g(c,e,d-c,w(this.bottom,a.bottom)-e)}}),u(g,{ofContent:function(a,b){return a&&a!==document&&a!==window?b?new g(0,0,a.scrollWidth,a.scrollHeight):new g(a.offsetLeft-a.scrollLeft,a.offsetTop-a.scrollTop,a.scrollWidth,a.scrollHeight):new g(0,0,t.width(),t.height())},ofViewport:function(a,b){return a&&a!==document&&a!==window?b?new g(a.scrollLeft,a.scrollTop,a.clientWidth,a.clientHeight):new g(a.offsetLeft,a.offsetTop,a.clientWidth,a.clientHeight):new g(s.scrollLeft(),s.scrollTop(),s.width(),s.height())},ofElement:function(a){var b=r(a);if(!b.is(":visible"))return null;var c=b.offset();return new g(c.left,c.top,b.outerWidth(),b.outerHeight())}}),u(h.prototype,{equals:function(a){return this.fracsEqual(a)&&this.rectsEqual(a)},fracsEqual:function(a){return f(this,a,["visible","viewport","possible"])},rectsEqual:function(a){return f(this.rects,a.rects,["document","element","viewport"])}}),u(h,{of:function(a,b){var d,e,f;return a=c(a)&&g.ofElement(a)||a,b=c(b)&&g.ofViewport(b)||b||g.ofViewport(),a instanceof g&&(d=a.intersection(b))?(e=d.area(),f=x(a.width,b.width)*x(a.height,b.height),new h(e/a.area(),e/b.area(),e/f,{document:d,element:d.relativeTo(a),viewport:d.relativeTo(b)})):new h}});var A=["width","height","left","right","top","bottom"],B=["possible","visible","viewport"];u(i.prototype,{sorted:function(a,b){var c=this.viewport;return r.map(this.els,function(b){return{el:b,val:j(b,c,a)}}).sort(b?l:k)},best:function(a,b){return this.els.length?this.sorted(a,b)[0]:null}}),u(m.prototype,{equals:function(a){return f(this,a,["width","height","left","top","right","bottom","content","viewport"])}}),u(n.prototype,{equals:function(a){return f(this,a,["el"])},scrollState:function(){return new m(this.el)},scrollTo:function(a,b,c){var d=r(this.el===window?"html,body":this.el);a=a||0,b=b||0,c=isNaN(c)?1e3:c,d.stop(!0).animate({scrollLeft:a,scrollTop:b},c)},scroll:function(a,b,c){var d=this.el===window?s:r(this.el);a=a||0,b=b||0,this.scrollTo(d.scrollLeft()+a,d.scrollTop()+b,c)},scrollToRect:function(a,b,c,d){b=b||0,c=c||0,this.scrollTo(a.left-b,a.top-c,d)},scrollToElement:function(a,b,c,d){var e=g.ofElement(a).relativeTo(g.ofContent(this.el));this.scrollToRect(e,b,c,d)}});var C={init:function(){this.callbacks=r.Callbacks("memory unique"),this.currVal=null,this.prevVal=null,this.checkProxy=r.proxy(this.check,this),this.autoCheck()},bind:function(a){this.callbacks.add(a)},unbind:function(a){a?this.callbacks.remove(a):this.callbacks.empty()},trigger:function(){this.callbacks.fireWith(this.context,[this.currVal,this.prevVal])},check:function(a){var b=this.updatedValue(a);return void 0!==b&&(this.prevVal=this.currVal,this.currVal=b,this.trigger(),!0)},$autoTarget:s,autoEvents:"load resize scroll",autoCheck:function(a){this.$autoTarget[!1===a?"off":"on"](this.autoEvents,this.checkProxy)}};u(o.prototype,C,{updatedValue:function(){var a=h.of(this.context,this.viewport);return this.currVal&&this.currVal.equals(a)?void 0:a}}),u(p.prototype,C,{updatedValue:function(){var a=this.context.best(this.property,this.descending);return a&&(a=a.val>0?a.el:null,this.currVal!==a)?a:void 0}}),u(q.prototype,C,{updatedValue:function(){var a=new m(this.context);return this.currVal&&this.currVal.equals(a)?void 0:a}});var D="fracs";!function(a,b){var c=[].slice,d=jQuery,e=d.extend,f=d.isFunction,g=e({},b),h=function(b,c,e,g){return e=f(e)?e.apply(b,c):e,f(g[e])?g[e].apply(b,c):void d.error('Method "'+e+'" does not exist on jQuery.'+a)},i=function(){return h(this,c.call(arguments),g.defaultStatic,i)},j=function(a){return f(j[a])?j[a].apply(this,c.call(arguments,1)):h(this,c.call(arguments),g.defaultMethod,j)},k=function(a){a&&(e(i,a.statics),e(j,a.methods)),i.modplug=k};k.prev={statics:d[a],methods:d.fn[a]},k(b),d[a]=i,d.fn[a]=j}(D,{statics:{version:"0.15.0",Rect:g,Fractions:h,Group:i,ScrollState:m,Viewport:n,FracsCallbacks:o,GroupCallbacks:p,ScrollStateCallbacks:q,fracs:function(a,b){return h.of(a,b)}},methods:{content:function(a){return this.length?g.ofContent(this[0],a):null},envelope:function(){return e(this,function(a){var b=g.ofElement(this);return a?a.envelope(b):b})},fracs:function(b,c,e){a(b,"string")||(e=c,c=b,b=null),v(c)||(e=c,c=null),e=d(e);var f=D+".fracs."+z(e);return"unbind"===b?this.each(function(){var a=r(this).data(f);a&&a.unbind(c)}):"check"===b?this.each(function(){var a=r(this).data(f);a&&a.check()}):v(c)?this.each(function(){var a=r(this),b=a.data(f);b||(b=new o(this,e),a.data(f,b)),b.bind(c)}):this.length?h.of(this[0],e):null},intersection:function(){return e(this,function(a){var b=g.ofElement(this);return a?a.intersection(b):b})},max:function(a,b,c){return v(b)||(c=b,b=null),c=d(c),b?(new p(this,c,a,!0).bind(b),this):this.pushStack(new i(this,c).best(a,!0).el)},min:function(a,b,c){return v(b)||(c=b,b=null),c=d(c),b?(new p(this,c,a).bind(b),this):this.pushStack(new i(this,c).best(a).el)},rect:function(){return this.length?g.ofElement(this[0]):null},scrollState:function(b,c){var d=D+".scrollState";return a(b,"string")||(c=b,b=null),"unbind"===b?this.each(function(){var a=r(this).data(d);a&&a.unbind(c)}):"check"===b?this.each(function(){var a=r(this).data(d);a&&a.check()}):v(c)?this.each(function(){var a=r(this),b=a.data(d);b||(b=new q(this),a.data(d,b)),b.bind(c)}):this.length?new m(this[0]):null},scroll:function(a,b,c){return this.each(function(){new n(this).scroll(a,b,c)})},scrollTo:function(a,b,c,e){return r.isNumeric(a)&&(e=c,c=b,b=a,a=null),a=d(a),this.each(function(){a?new n(this).scrollToElement(a,b,c,e):new n(this).scrollTo(b,c,e)})},scrollToThis:function(a,b,c,e){return e=new n(d(e)),e.scrollToElement(this[0],a,b,c),this},softLink:function(a,b,c,e){return e=new n(d(e)),this.filter("a[href^=#]").each(function(){var d=r(this);d.on("click",function(){e.scrollToElement(r(d.attr("href"))[0],a,b,c)})})},sort:function(b,c,e){return a(c,"boolean")||(e=c,c=null),e=d(e),this.pushStack(r.map(new i(this,e).sorted(b,!c),function(a){return a.el}))},viewport:function(a){return this.length?g.ofViewport(this[0],a):null}},defaultStatic:"fracs",defaultMethod:"fracs"})}(),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("bs.tooltip"),f="object"==typeof b&&b;(e||"destroy"!=b)&&(e||d.data("bs.tooltip",e=new c(this,f)),"string"==typeof b&&e[b]())})}var c=function(a,b){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",a,b)};c.VERSION="3.2.0",c.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},c.prototype.init=function(b,c,d){this.enabled=!0,this.type=b,this.$element=a(c),this.options=this.getOptions(d),this.$viewport=this.options.viewport&&a(this.options.viewport.selector||this.options.viewport);for(var e=this.options.trigger.split(" "),f=e.length;f--;){var g=e[f];if("click"==g)this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this));else if("manual"!=g){var h="hover"==g?"mouseenter":"focusin",i="hover"==g?"mouseleave":"focusout";this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.enter,this)),this.$element.on(i+"."+this.type,this.options.selector,a.proxy(this.leave,this))}}this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},c.prototype.getDefaults=function(){return c.DEFAULTS},c.prototype.getOptions=function(b){return b=a.extend({},this.getDefaults(),this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},c.prototype.getDelegateOptions=function(){var b={},c=this.getDefaults();return this._options&&a.each(this._options,function(a,d){c[a]!=d&&(b[a]=d)}),b},c.prototype.enter=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),clearTimeout(c.timeout),c.hoverState="in",c.options.delay&&c.options.delay.show?void(c.timeout=setTimeout(function(){"in"==c.hoverState&&c.show()},c.options.delay.show)):c.show()},c.prototype.leave=function(b){var c=b instanceof this.constructor?b:a(b.currentTarget).data("bs."+this.type);return c||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c)),clearTimeout(c.timeout),c.hoverState="out",c.options.delay&&c.options.delay.hide?void(c.timeout=setTimeout(function(){"out"==c.hoverState&&c.hide()},c.options.delay.hide)):c.hide()},c.prototype.show=function(){var b=a.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(b);var c=a.contains(document.documentElement,this.$element[0]);if(b.isDefaultPrevented()||!c)return;var d=this,e=this.tip(),f=this.getUID(this.type);this.setContent(),e.attr("id",f),this.$element.attr("aria-describedby",f),this.options.animation&&e.addClass("fade");var g="function"==typeof this.options.placement?this.options.placement.call(this,e[0],this.$element[0]):this.options.placement,h=/\s?auto?\s?/i,i=h.test(g);i&&(g=g.replace(h,"")||"top"),e.detach().css({top:0,left:0,display:"block"}).addClass(g).data("bs."+this.type,this),this.options.container?e.appendTo(this.options.container):e.insertAfter(this.$element);var j=this.getPosition(),k=e[0].offsetWidth,l=e[0].offsetHeight;if(i){var m=g,n=this.$element.parent(),o=this.getPosition(n);g="bottom"==g&&j.top+j.height+l-o.scroll>o.height?"top":"top"==g&&j.top-o.scroll-l<0?"bottom":"right"==g&&j.right+k>o.width?"left":"left"==g&&j.left-k<o.left?"right":g,e.removeClass(m).addClass(g)}var p=this.getCalculatedOffset(g,j,k,l);this.applyPlacement(p,g);var q=function(){d.$element.trigger("shown.bs."+d.type),d.hoverState=null};a.support.transition&&this.$tip.hasClass("fade")?e.one("bsTransitionEnd",q).emulateTransitionEnd(150):q()}},c.prototype.applyPlacement=function(b,c){var d=this.tip(),e=d[0].offsetWidth,f=d[0].offsetHeight,g=parseInt(d.css("margin-top"),10),h=parseInt(d.css("margin-left"),10);isNaN(g)&&(g=0),isNaN(h)&&(h=0),b.top=b.top+g,b.left=b.left+h,a.offset.setOffset(d[0],a.extend({using:function(a){d.css({top:Math.round(a.top),left:Math.round(a.left)})}},b),0),d.addClass("in");var i=d[0].offsetWidth,j=d[0].offsetHeight;"top"==c&&j!=f&&(b.top=b.top+f-j);var k=this.getViewportAdjustedDelta(c,b,i,j);k.left?b.left+=k.left:b.top+=k.top;var l=k.left?2*k.left-e+i:2*k.top-f+j,m=k.left?"left":"top",n=k.left?"offsetWidth":"offsetHeight";d.offset(b),this.replaceArrow(l,d[0][n],m)},c.prototype.replaceArrow=function(a,b,c){this.arrow().css(c,a?50*(1-a/b)+"%":"")},c.prototype.setContent=function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b),a.removeClass("fade in top bottom left right")},c.prototype.hide=function(){function b(){"in"!=c.hoverState&&d.detach(),c.$element.trigger("hidden.bs."+c.type)}var c=this,d=this.tip(),e=a.Event("hide.bs."+this.type);if(this.$element.removeAttr("aria-describedby"),this.$element.trigger(e),!e.isDefaultPrevented())return d.removeClass("in"),a.support.transition&&this.$tip.hasClass("fade")?d.one("bsTransitionEnd",b).emulateTransitionEnd(150):b(),this.hoverState=null,this},c.prototype.fixTitle=function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||"").attr("title","")},c.prototype.hasContent=function(){return this.getTitle()},c.prototype.getPosition=function(b){b=b||this.$element;var c=b[0],d="BODY"==c.tagName;return a.extend({},"function"==typeof c.getBoundingClientRect?c.getBoundingClientRect():null,{scroll:d?document.documentElement.scrollTop||document.body.scrollTop:b.scrollTop(),width:d?a(window).width():b.outerWidth(),height:d?a(window).height():b.outerHeight()},d?{top:0,left:0}:b.offset())},c.prototype.getCalculatedOffset=function(a,b,c,d){return"bottom"==a?{top:b.top+b.height,left:b.left+b.width/2-c/2}:"top"==a?{top:b.top-d,left:b.left+b.width/2-c/2}:"left"==a?{top:b.top+b.height/2-d/2,left:b.left-c}:{top:b.top+b.height/2-d/2,left:b.left+b.width}},c.prototype.getViewportAdjustedDelta=function(a,b,c,d){var e={top:0,left:0};if(!this.$viewport)return e;var f=this.options.viewport&&this.options.viewport.padding||0,g=this.getPosition(this.$viewport);if(/right|left/.test(a)){var h=b.top-f-g.scroll,i=b.top+f-g.scroll+d;h<g.top?e.top=g.top-h:i>g.top+g.height&&(e.top=g.top+g.height-i)}else{var j=b.left-f,k=b.left+f+c;j<g.left?e.left=g.left-j:k>g.width&&(e.left=g.left+g.width-k)}return e},c.prototype.getTitle=function(){var a=this.$element,b=this.options;return a.attr("data-original-title")||("function"==typeof b.title?b.title.call(a[0]):b.title)},c.prototype.getUID=function(a){do{a+=~~(1e6*Math.random())}while(document.getElementById(a));return a},c.prototype.tip=function(){return this.$tip=this.$tip||a(this.options.template)},c.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},c.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},c.prototype.enable=function(){this.enabled=!0},c.prototype.disable=function(){this.enabled=!1},c.prototype.toggleEnabled=function(){this.enabled=!this.enabled},c.prototype.toggle=function(b){var c=this;b&&((c=a(b.currentTarget).data("bs."+this.type))||(c=new this.constructor(b.currentTarget,this.getDelegateOptions()),a(b.currentTarget).data("bs."+this.type,c))),c.tip().hasClass("in")?c.leave(c):c.enter(c)},c.prototype.destroy=function(){clearTimeout(this.timeout),this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var d=a.fn.tooltip;a.fn.tooltip=b,a.fn.tooltip.Constructor=c,a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(jQuery),function(a,b){if(!b.__SV){var c,d,e,f;window.mixpanel=b,b._i=[],b.init=function(a,c,d){var g=b;for(void 0!==d?g=b[d]=[]:d="mixpanel",g.people=g.people||[],g.toString=function(a){var b="mixpanel";return"mixpanel"!==d&&(b+="."+d),a||(b+=" (stub)"),b},g.people.toString=function(){return g.toString(1)+".people (stub)"},e="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" "),f=0;f<e.length;f++)!function(a,b){var c=b.split(".");2==c.length&&(a=a[c[0]],b=c[1]),a[b]=function(){a.push([b].concat(Array.prototype.slice.call(arguments,0)))}}(g,e[f]);b._i.push([a,c,d])},b.__SV=1.2,b.loadScript=function(){b.__LOADED||(b.__LOADED=!0,c=a.createElement("script"),c.type="text/javascript",c.async=!0,c.src="",d=a.getElementsByTagName("script")[0],d.parentNode.insertBefore(c,d))}}}(document,window.mixpanel||[]),function(a,b){"use strict";var c="function",d="undefined",e="object",f="major",g="model",h="name",i="type",j="vendor",k="version",l="architecture",m="console",n="mobile",o="tablet",p={has:function(a,b){return-1!==b.toLowerCase().indexOf(a.toLowerCase())},lowerize:function(a){return a.toLowerCase()}},q={rgx:function(){for(var a,f,g,h,i,j,k,l=0,m=arguments;l<m.length;l+=2){var n=m[l],o=m[l+1];if(typeof a===d){a={};for(h in o)i=o[h],typeof i===e?a[i[0]]=b:a[i]=b}for(f=g=0;f<n.length;f++)if(j=n[f].exec(this.getUA())){for(h=0;h<o.length;h++)k=j[++g],i=o[h],typeof i===e&&i.length>0?2==i.length?typeof i[1]==c?a[i[0]]=i[1].call(this,k):a[i[0]]=i[1]:3==i.length?typeof i[1]!==c||i[1].exec&&i[1].test?a[i[0]]=k?k.replace(i[1],i[2]):b:a[i[0]]=k?i[1].call(this,k,i[2]):b:4==i.length&&(a[i[0]]=k?i[3].call(this,k.replace(i[1],i[2])):b):a[i]=k||b;break}if(j)break}return a},str:function(a,c){for(var d in c)if(typeof c[d]===e&&c[d].length>0){for(var f=0;f<c[d].length;f++)if(p.has(c[d][f],a))return"?"===d?b:d}else if(p.has(c[d],a))return"?"===d?b:d;return a}},r={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},s={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[h,k,f],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[h,"Opera"],k,f],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[h,k,f],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[h,"IE"],k,f],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[h,"Yandex"],k,f],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[h,/_/g," "],k,f],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],[h,k,f],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[h,"Dolphin"],k,f],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[h,"Chrome"],k,f],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[k,f,[h,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[k,f,h],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[h,[f,q.str,r.browser.oldsafari.major],[k,q.str,r.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[h,k,f],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[h,"Netscape"],k,f],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[h,k,f],[/(apple(?:coremedia|))\/((\d+)[\w\._]+)/i,/(coremedia) v((\d+)[\w\._]+)/i],[h,k,f],[/(aqualung|lyssna|bsplayer)\/([\w\.-]+)/i],[h,k],[/(ares|ossproxy)\s((\d+)[\w\.-]+)/i],[h,k,f],[/(audacious|audimusicstream|amarok|bass|core|dalvik|gnomemplayer|music on console|nsplayer|psp-internetradioplayer|videos)\/((\d+)[\w\.-]+)/i,/(clementine|music player daemon)\s((\d+)[\w\.-]+)/i,/(lg player|nexplayer)\s((\d+)[\d\.]+)/i,/player\/(nexplayer|lg player)\s((\d+)[\w\.-]+)/i],[h,k,f],[/(nexplayer)\s((\d+)[\w\.-]+)/i],[h,k,f],[/(flrp)\/((\d+)[\w\.-]+)/i],[[h,"Flip Player"],k,f],[/(fstream|nativehost|queryseekspider|ia-archiver|facebookexternalhit)/i],[h],[/(gstreamer) souphttpsrc (?:\([^\)]+\)){0,1} libsoup\/((\d+)[\w\.-]+)/i],[h,k,f],[/(htc streaming player)\s[\w_]+\s\/\s((\d+)[\d\.]+)/i,/(java|python-urllib|python-requests|wget|libcurl)\/((\d+)[\w\.-_]+)/i,/(lavf)((\d+)[\d\.]+)/i],[h,k,f],[/(htc_one_s)\/((\d+)[\d\.]+)/i],[[h,/_/g," "],k,f],[/(mplayer)(?:\s|\/)(?:(?:sherpya-){0,1}svn)(?:-|\s)(r\d+(?:-\d+[\w\.-]+){0,1})/i],[h,k],[/(mplayer)(?:\s|\/)((\d+)[\w\.-]+)/i,/(mplayer) unknown-((\d+)[\w\.\-]+)/i],[h,k,f],[/(mplayer)/i,/(yourmuze)/i,/(media player classic|nero showtime)/i],[h],[/(nero (?:home|scout))\/((\d+)[\w\.-]+)/i],[h,k,f],[/(nokia\d+)\/((\d+)[\w\.-]+)/i],[h,k,f],[/\s(songbird)\/((\d+)[\w\.-]+)/i],[h,k,f],[/(winamp)3 version ((\d+)[\w\.-]+)/i,/(winamp)\s((\d+)[\w\.-]+)/i,/(winamp)mpeg\/((\d+)[\w\.-]+)/i],[h,k,f],[/(ocms-bot|tapinradio|tunein radio|unknown|winamp|inlight radio)/i],[h],[/(quicktime|rma|radioapp|radioclientapplication|soundtap|totem|stagefright|streamium)\/((\d+)[\w\.-]+)/i],[h,k,f],[/(smp)((\d+)[\d\.]+)/i],[h,k,f],[/(vlc) media player - version ((\d+)[\w\.]+)/i,/(vlc)\/((\d+)[\w\.-]+)/i,/(xbmc|gvfs|xine|xmms|irapp)\/((\d+)[\w\.-]+)/i,/(foobar2000)\/((\d+)[\d\.]+)/i,/(itunes)\/((\d+)[\d\.]+)/i],[h,k,f],[/(wmplayer)\/((\d+)[\w\.-]+)/i,/(windows-media-player)\/((\d+)[\w\.-]+)/i],[[h,/-/g," "],k,f],[/windows\/((\d+)[\w\.-]+) upnp\/[\d\.]+ dlnadoc\/[\d\.]+ (home media server)/i],[k,f,[h,"Windows"]],[/(com\.riseupradioalarm)\/((\d+)[\d\.]*)/i],[h,k,f],[/(rad.io)\s((\d+)[\d\.]+)/i,/(radio.(?:de|at|fr))\s((\d+)[\d\.]+)/i],[[h,"rad.io"],k,f]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[l,"amd64"]],[/(ia32(?=;))/i],[[l,p.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[l,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[l,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[l,/ower/,"",p.lowerize]],[/(sun4\w)[;\)]/i],[[l,"sparc"]],[/(ia64(?=;)|68k(?=\))|arm(?=v\d+;)|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[l,p.lowerize]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[g,j,[i,o]],[/applecoremedia\/[\w\.]+ \((ipad)/],[g,[j,"Apple"],[i,o]],[/(apple\s{0,1}tv)/i],[[g,"Apple TV"],[j,"Apple"]],[/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[j,g,[i,o]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[g,j,[i,n]],[/\((ip[honed|\s\w*]+);/i],[g,[j,"Apple"],[i,n]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[j,g,[i,n]],[/\((bb10);\s(\w+)/i],[[j,"BlackBerry"],g,[i,n]],[/android.+((transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+))/i],[[j,"Asus"],g,[i,o]],[/(sony)\s(tablet\s[ps])/i],[j,g,[i,o]],[/(nintendo)\s([wids3u]+)/i],[j,g,[i,m]],[/((playstation)\s[3portablevi]+)/i],[[j,"Sony"],g,[i,m]],[/(sprint\s(\w+))/i],[[j,q.str,r.device.sprint.vendor],[g,q.str,r.device.sprint.model],[i,n]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[j,[g,/_/g," "],[i,n]],[/\s((milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?))[\w\s]+build\//i,/(mot)[\s-]?(\w+)*/i],[[j,"Motorola"],g,[i,n]],[/android.+\s((mz60\d|xoom[\s2]{0,2}))\sbuild\//i],[[j,"Motorola"],g,[i,o]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9))/i],[[j,"Samsung"],g,[i,o]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[j,"Samsung"],g,[i,n]],[/(sie)-(\w+)*/i],[[j,"Siemens"],g,[i,n]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[j,"Nokia"],g,[i,n]],[/android\s3\.[\s\w-;]{10}((a\d{3}))/i],[[j,"Acer"],g,[i,o]],[/android\s3\.[\s\w-;]{10}(lg?)-([06cv9]{3,4})/i],[[j,"LG"],g,[i,o]],[/((nexus\s[45]))/i,/(lg)[e;\s-\/]+(\w+)*/i],[[j,"LG"],g,[i,n]],[/android.+((ideatab[a-z0-9\-\s]+))/i],[[j,"Lenovo"],g,[i,o]],[/(lg) netcast\.tv/i],[j,[i,"smarttv"]],[/(mobile|tablet);.+rv\:.+gecko\//i],[i,j,g]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[h,k],[/rv\:([\w\.]+).*(gecko)/i],[k,h]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[h,k],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[h,[k,q.str,r.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[h,"Windows"],[k,q.str,r.os.windows.version]],[/\((bb)(10);/i],[[h,"BlackBerry"],k],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],[h,k],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[h,"Symbian"],k],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[h,"Firefox OS"],k],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[h,k],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[h,"Chromium OS"],k],[/(sunos)\s?([\w\.]+\d)*/i],[[h,"Solaris"],k],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[h,k],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[h,"iOS"],[k,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[h,[k,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[h,k]]},t=function(b){var c=b||(a&&a.navigator&&a.navigator.userAgent?a.navigator.userAgent:"");return this instanceof t?(this.getBrowser=function(){return q.rgx.apply(this,s.browser)},this.getCPU=function(){return q.rgx.apply(this,s.cpu)},this.getDevice=function(){return q.rgx.apply(this,s.device)},this.getEngine=function(){return q.rgx.apply(this,s.engine)},this.getOS=function(){return q.rgx.apply(this,s.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return c},this.setUA=function(a){return c=a,this},
void this.setUA(c)):new t(b).getResult()};if(typeof exports!==d)typeof module!==d&&module.exports&&(exports=module.exports=t),exports.UAParser=t;else if(a.UAParser=t,typeof define===c&&define.amd&&define(function(){return t}),typeof a.jQuery!==d){var u=a.jQuery,v=new t;u.ua=v.getResult(),u.ua.get=function(){return v.getUA()},u.ua.set=function(a){v.setUA(a);var b=v.getResult();for(var c in b)u.ua[c]=b[c]}}}(this),window.Modernizr=function(a,b,c){function d(a,b){return typeof a===b}var e,f,g={},h=b.documentElement,i=b.createElement("modernizr"),j=i.style,k={},l=[],m=l.slice,n={}.hasOwnProperty;f=d(n,"undefined")||d(n.call,"undefined")?function(a,b){return b in a&&d(a.constructor.prototype[b],"undefined")}:function(a,b){return n.call(a,b)},Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError;var c=m.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var f=new e,g=b.apply(f,c.concat(m.call(arguments)));return Object(g)===g?g:f}return b.apply(a,c.concat(m.call(arguments)))};return d}),k.webgl=function(){return!!a.WebGLRenderingContext};for(var o in k)f(k,o)&&(e=o.toLowerCase(),g[e]=k[o](),l.push((g[e]?"":"no-")+e));return g.addTest=function(a,b){if("object"==typeof a)for(var c in a)f(a,c)&&g.addTest(c,a[c]);else{if(a=a.toLowerCase(),void 0!==g[a])return g;b="function"==typeof b?b():b,"undefined"!=typeof enableClasses&&enableClasses&&(h.className+=" "+(b?"":"no-")+a),g[a]=b}return g},function(a){j.cssText=a}(""),i=null,g._version="2.8.2",g}(this,this.document),function(a,b,c){"use strict";function d(b,I,J){function K(c){var d=Ga.length;if(ya.old=a.extend({},ya),wa=ta?0:ua[ra.horizontal?"width":"height"](),Ba=za[ra.horizontal?"width":"height"](),xa=ta?b:va[ra.horizontal?"outerWidth":"outerHeight"](),Ga.length=0,ya.start=0,ya.end=F(xa-wa,0),Ra){Ia.length,Ha=va.children(ra.itemSelector),Ia.length=0;var e,f=j(va,ra.horizontal?"paddingLeft":"paddingTop"),g=j(va,ra.horizontal?"paddingRight":"paddingBottom"),h="border-box"===a(Ha).css("boxSizing"),i="none"!==Ha.css("float"),l=0,m=Ha.length-1;xa=0,Ha.each(function(b,c){var d=a(c),h=c.getBoundingClientRect(),k=E(ra.horizontal?h.width||h.right-h.left:h.height||h.bottom-h.top),n=j(d,ra.horizontal?"marginLeft":"marginTop"),o=j(d,ra.horizontal?"marginRight":"marginBottom"),p=k+n+o,q=!n||!o,r={};r.el=c,r.size=q?k:p,r.half=r.size/2,r.start=xa+(q?n:0),r.center=r.start-E(wa/2-r.size/2),r.end=r.start-wa+r.size,b||(xa+=f),xa+=p,ra.horizontal||i||o&&n&&b>0&&(xa-=G(n,o)),b===m&&(r.end+=g,xa+=g,l=q?o:0),Ia.push(r),e=r}),va[0].style[ra.horizontal?"width":"height"]=(h?xa:xa-f-g)+"px",xa-=l,Ia.length?(ya.start=Ia[0][Pa?"center":"start"],ya.end=Pa?e.center:xa>wa?e.end:ya.start):ya.start=ya.end=0}if(ya.center=E(ya.end/2+ya.start/2),V(),Aa.length&&Ba>0&&(ra.dynamicHandle?(Ca=ya.start===ya.end?Ba:E(Ba*wa/xa),Ca=k(Ca,ra.minHandleSize,Ba),Aa[0].style[ra.horizontal?"width":"height"]=Ca+"px"):Ca=Aa[ra.horizontal?"outerWidth":"outerHeight"](),Da.end=Ba-Ca,eb||N()),!ta&&wa>0){var n=ya.start,o="";if(Ra)a.each(Ia,function(a,b){Pa?Ga.push(b.center):b.start+b.size>n&&n<=ya.end&&(n=b.start,Ga.push(n),(n+=wa)>ya.end&&n<ya.end+wa&&Ga.push(ya.end))});else for(;n-wa<ya.end;)Ga.push(n),n+=wa;if(Ea[0]&&d!==Ga.length){for(var p=0;p<Ga.length;p++)o+=ra.pageBuilder.call(sa,p);Fa=Ea.html(o).children(),Fa.eq(Ja.activePage).addClass(ra.activeClass)}}if(Ja.slideeSize=xa,Ja.frameSize=wa,Ja.sbSize=Ba,Ja.handleSize=Ca,Ra){c&&null!=ra.startAt&&(T(ra.startAt),sa[Qa?"toCenter":"toStart"](ra.startAt));var q=Ia[Ja.activeItem];L(Qa&&q?q.center:k(ya.dest,ya.start,ya.end))}else c?null!=ra.startAt&&L(ra.startAt,1):L(k(ya.dest,ya.start,ya.end));oa("load")}function L(a,b,c){if(Ra&&cb.released&&!c){var d=U(a),e=a>ya.start&&a<ya.end;Qa?(e&&(a=Ia[d.centerItem].center),Pa&&ra.activateMiddle&&T(d.centerItem)):e&&(a=Ia[d.firstItem].start)}cb.init&&cb.slidee&&ra.elasticBounds?a>ya.end?a=ya.end+(a-ya.end)/6:a<ya.start&&(a=ya.start+(a-ya.start)/6):a=k(a,ya.start,ya.end),ab.start=+new Date,ab.time=0,ab.from=ya.cur,ab.to=a,ab.delta=a-ya.cur,ab.tweesing=cb.tweese||cb.init&&!cb.slidee,ab.immediate=!ab.tweesing&&(b||cb.init&&cb.slidee||!ra.speed),cb.tweese=0,a!==ya.dest&&(ya.dest=a,oa("change"),eb||M()),Z(),V(),W(),O()}function M(){if(sa.initialized){if(!eb)return eb=r(M),void(cb.released&&oa("moveStart"));ab.immediate?ya.cur=ab.to:ab.tweesing?(ab.tweeseDelta=ab.to-ya.cur,B(ab.tweeseDelta)<.1?ya.cur=ab.to:ya.cur+=ab.tweeseDelta*(cb.released?ra.swingSpeed:ra.syncSpeed)):(ab.time=G(+new Date-ab.start,ra.speed),ya.cur=ab.from+ab.delta*a.easing[ra.easing](ab.time/ra.speed,ab.time,0,1,ra.speed)),ab.to===ya.cur?(ya.cur=ab.to,cb.tweese=eb=0):eb=r(M),oa("move"),ta||(m?va[0].style[m]=n+(ra.horizontal?"translateX":"translateY")+"("+-ya.cur+"px)":va[0].style[ra.horizontal?"left":"top"]=-E(ya.cur)+"px"),!eb&&cb.released&&oa("moveEnd"),N()}}function N(){Aa.length&&(Da.cur=ya.start===ya.end?0:((cb.init&&!cb.slidee?ya.dest:ya.cur)-ya.start)/(ya.end-ya.start)*Da.end,Da.cur=k(E(Da.cur),Da.start,Da.end),_a.hPos!==Da.cur&&(_a.hPos=Da.cur,m?Aa[0].style[m]=n+(ra.horizontal?"translateX":"translateY")+"("+Da.cur+"px)":Aa[0].style[ra.horizontal?"left":"top"]=Da.cur+"px"))}function O(){Fa[0]&&_a.page!==Ja.activePage&&(_a.page=Ja.activePage,Fa.removeClass(ra.activeClass).eq(Ja.activePage).addClass(ra.activeClass),oa("activePage",_a.page))}function P(){bb.speed&&ya.cur!==(bb.speed>0?ya.end:ya.start)||sa.stop(),hb=cb.init?r(P):0,bb.now=+new Date,bb.pos=ya.cur+(bb.now-bb.lastTime)/1e3*bb.speed,L(cb.init?bb.pos:E(bb.pos)),cb.init||ya.cur!==ya.dest||oa("moveEnd"),bb.lastTime=bb.now}function Q(a,b,d){if("boolean"===e(b)&&(d=b,b=c),b===c)L(ya[a],d);else{if(Qa&&"center"!==a)return;var f=sa.getPos(b);f&&L(f[a],d,!Qa)}}function R(a){return null!=a?i(a)?a>=0&&a<Ia.length?a:-1:Ha.index(a):-1}function S(a){return R(i(a)&&0>a?a+Ia.length:a)}function T(a,b){var c=R(a);return!(!Ra||0>c)&&((_a.active!==c||b)&&(Ha.eq(Ja.activeItem).removeClass(ra.activeClass),Ha.eq(c).addClass(ra.activeClass),_a.active=Ja.activeItem=c,W(),oa("active",c)),c)}function U(a){a=k(i(a)?a:ya.dest,ya.start,ya.end);var b={},c=Pa?0:wa/2;if(!ta)for(var d=0,e=Ga.length;e>d;d++){if(a>=ya.end||d===Ga.length-1){b.activePage=Ga.length-1;break}if(a<=Ga[d]+c){b.activePage=d;break}}if(Ra){for(var f=!1,g=!1,h=!1,j=0,l=Ia.length;l>j;j++)if(!1===f&&a<=Ia[j].start+Ia[j].half&&(f=j),!1===h&&a<=Ia[j].center+Ia[j].half&&(h=j),j===l-1||a<=Ia[j].end+Ia[j].half){g=j;break}b.firstItem=i(f)?f:0,b.centerItem=i(h)?h:b.firstItem,b.lastItem=i(g)?g:b.centerItem}return b}function V(b){a.extend(Ja,U(b))}function W(){var a=ya.dest<=ya.start,b=ya.dest>=ya.end,c=(a?1:0)|(b?2:0);if(_a.slideePosState!==c&&(_a.slideePosState=c,Ya.is("button,input")&&Ya.prop("disabled",a),Za.is("button,input")&&Za.prop("disabled",b),Ya.add(Va)[a?"addClass":"removeClass"](ra.disabledClass),Za.add(Ua)[b?"addClass":"removeClass"](ra.disabledClass)),_a.fwdbwdState!==c&&cb.released&&(_a.fwdbwdState=c,Va.is("button,input")&&Va.prop("disabled",a),Ua.is("button,input")&&Ua.prop("disabled",b)),Ra&&null!=Ja.activeItem){var d=0===Ja.activeItem,e=Ja.activeItem>=Ia.length-1,f=(d?1:0)|(e?2:0);_a.itemsButtonState!==f&&(_a.itemsButtonState=f,Wa.is("button,input")&&Wa.prop("disabled",d),Xa.is("button,input")&&Xa.prop("disabled",e),Wa[d?"addClass":"removeClass"](ra.disabledClass),Xa[e?"addClass":"removeClass"](ra.disabledClass))}}function X(a,b,c){if(a=S(a),b=S(b),a>-1&&b>-1&&a!==b&&(!c||b!==a-1)&&(c||b!==a+1)){Ha.eq(a)[c?"insertAfter":"insertBefore"](Ia[b].el);var d=b>a?a:c?b:b-1,e=a>b?a:c?b+1:b,f=a>b;null!=Ja.activeItem&&(a===Ja.activeItem?_a.active=Ja.activeItem=c?f?b+1:b:f?b:b-1:Ja.activeItem>d&&Ja.activeItem<e&&(_a.active=Ja.activeItem+=f?1:-1)),K()}}function Y(a,b){for(var c=0,d=$a[a].length;d>c;c++)if($a[a][c]===b)return c;return-1}function Z(){cb.released&&!sa.isPaused&&sa.resume()}function $(a){return E(k(a,Da.start,Da.end)/Da.end*(ya.end-ya.start))+ya.start}function _(){cb.history[0]=cb.history[1],cb.history[1]=cb.history[2],cb.history[2]=cb.history[3],cb.history[3]=cb.delta}function aa(a){cb.released=0,cb.source=a,cb.slidee="slidee"===a}function ba(b){var c="touchstart"===b.type,d=b.data.source,e="slidee"===d;cb.init||!c&&ea(b.target)||("handle"!==d||ra.dragHandle&&Da.start!==Da.end)&&(!e||(c?ra.touchDragging:ra.mouseDragging&&b.which<2))&&(c||f(b),aa(d),cb.init=0,cb.$source=a(b.target),cb.touch=c,cb.pointer=c?b.originalEvent.touches[0]:b,cb.initX=cb.pointer.pageX,cb.initY=cb.pointer.pageY,cb.initPos=e?ya.cur:Da.cur,cb.start=+new Date,cb.time=0,cb.path=0,cb.delta=0,cb.locked=0,cb.history=[0,0,0,0],cb.pathToLock=e?c?30:10:0,s.on(c?v:u,ca),sa.pause(1),(e?va:Aa).addClass(ra.draggedClass),oa("moveStart"),e&&(fb=setInterval(_,10)))}function ca(a){if(cb.released="mouseup"===a.type||"touchend"===a.type,cb.pointer=cb.touch?a.originalEvent[cb.released?"changedTouches":"touches"][0]:a,cb.pathX=cb.pointer.pageX-cb.initX,cb.pathY=cb.pointer.pageY-cb.initY,cb.path=C(D(cb.pathX,2)+D(cb.pathY,2)),cb.delta=ra.horizontal?cb.pathX:cb.pathY,cb.released||!(cb.path<1)){if(!cb.init){if(!(ra.horizontal?B(cb.pathX)>B(cb.pathY):B(cb.pathX)<B(cb.pathY)))return da();cb.init=1}f(a),!cb.locked&&cb.path>cb.pathToLock&&cb.slidee&&(cb.locked=1,cb.$source.on(x,g)),cb.released&&(da(),ra.releaseSwing&&cb.slidee&&(cb.swing=(cb.delta-cb.history[0])/40*300,cb.delta+=cb.swing,cb.tweese=B(cb.swing)>10)),L(cb.slidee?E(cb.initPos-cb.delta):$(cb.initPos+cb.delta))}}function da(){clearInterval(fb),cb.released=!0,s.off(cb.touch?v:u,ca),(cb.slidee?va:Aa).removeClass(ra.draggedClass),setTimeout(function(){cb.$source.off(x,g)}),ya.cur===ya.dest&&cb.init&&oa("moveEnd"),sa.resume(1),cb.init=0}function ea(b){return~a.inArray(b.nodeName,z)||a(b).is(ra.interactive)}function fa(){sa.stop(),s.off("mouseup",fa)}function ga(a){switch(f(a),this){case Ua[0]:case Va[0]:sa.moveBy(Ua.is(this)?ra.moveBy:-ra.moveBy),s.on("mouseup",fa);break;case Wa[0]:sa.prev();break;case Xa[0]:sa.next();break;case Ya[0]:sa.prevPage();break;case Za[0]:sa.nextPage()}}function ha(a){return db.curDelta=(ra.horizontal?a.deltaY||a.deltaX:a.deltaY)||-a.wheelDelta,db.curDelta/=1===a.deltaMode?3:100,Ra?(o=+new Date,db.last<o-db.resetTime&&(db.delta=0),db.last=o,db.delta+=db.curDelta,B(db.delta)<1?db.finalDelta=0:(db.finalDelta=E(db.delta/1),db.delta%=1),db.finalDelta):db.curDelta}function ia(a){a.originalEvent[p]=sa;var b=+new Date;if(H+ra.scrollHijack>b&&Sa[0]!==document&&Sa[0]!==window)return void(H=b);if(ra.scrollBy&&ya.start!==ya.end){var c=ha(a.originalEvent);(ra.scrollTrap||c>0&&ya.dest<ya.end||0>c&&ya.dest>ya.start)&&f(a,1),sa.slideBy(ra.scrollBy*c)}}function ja(a){ra.clickBar&&a.target===za[0]&&(f(a),L($((ra.horizontal?a.pageX-za.offset().left:a.pageY-za.offset().top)-Ca/2)))}function ka(a){if(ra.keyboardNavBy)switch(a.which){case ra.horizontal?37:38:f(a),sa["pages"===ra.keyboardNavBy?"prevPage":"prev"]();break;case ra.horizontal?39:40:f(a),sa["pages"===ra.keyboardNavBy?"nextPage":"next"]()}}function la(a){return ea(this)?void(a.originalEvent[p+"ignore"]=!0):void(this.parentNode!==va[0]||a.originalEvent[p+"ignore"]||sa.activate(this))}function ma(){this.parentNode===Ea[0]&&sa.activatePage(Fa.index(this))}function na(a){ra.pauseOnHover&&sa["mouseenter"===a.type?"pause":"resume"](2)}function oa(a,b){if($a[a]){for(qa=$a[a].length,A.length=0,pa=0;qa>pa;pa++)A.push($a[a][pa]);for(pa=0;qa>pa;pa++)A[pa].call(sa,a,b)}}var pa,qa,ra=a.extend({},d.defaults,I),sa=this,ta=i(b),ua=a(b),va=ra.slidee?a(ra.slidee).eq(0):ua.children().eq(0),wa=0,xa=0,ya={start:0,center:0,end:0,cur:0,dest:0},za=a(ra.scrollBar).eq(0),Aa=za.children().eq(0),Ba=0,Ca=0,Da={start:0,end:0,cur:0},Ea=a(ra.pagesBar),Fa=0,Ga=[],Ha=0,Ia=[],Ja={firstItem:0,lastItem:0,centerItem:0,activeItem:null,activePage:0},Ka=new l(ua[0]),La=new l(va[0]),Ma=new l(za[0]),Na=new l(Aa[0]),Oa="basic"===ra.itemNav,Pa="forceCentered"===ra.itemNav,Qa="centered"===ra.itemNav||Pa,Ra=!ta&&(Oa||Qa||Pa),Sa=ra.scrollSource?a(ra.scrollSource):ua,Ta=ra.dragSource?a(ra.dragSource):ua,Ua=a(ra.forward),Va=a(ra.backward),Wa=a(ra.prev),Xa=a(ra.next),Ya=a(ra.prevPage),Za=a(ra.nextPage),$a={},_a={},ab={},bb={},cb={released:1},db={last:0,delta:0,resetTime:200},eb=0,fb=0,gb=0,hb=0;ta||(b=ua[0]),sa.initialized=0,sa.frame=b,sa.slidee=va[0],sa.pos=ya,sa.rel=Ja,sa.items=Ia,sa.pages=Ga,sa.isPaused=0,sa.options=ra,sa.dragging=cb,sa.reload=function(){K()},sa.getPos=function(a){if(Ra){var b=R(a);return-1!==b&&Ia[b]}var c=va.find(a).eq(0);if(c[0]){var d=ra.horizontal?c.offset().left-va.offset().left:c.offset().top-va.offset().top,e=c[ra.horizontal?"outerWidth":"outerHeight"]();return{start:d,center:d-wa/2+e/2,end:d-wa+e,size:e}}return!1},sa.moveBy=function(a){bb.speed=a,!cb.init&&bb.speed&&ya.cur!==(bb.speed>0?ya.end:ya.start)&&(bb.lastTime=+new Date,bb.startPos=ya.cur,aa("button"),cb.init=1,oa("moveStart"),q(hb),P())},sa.stop=function(){"button"===cb.source&&(cb.init=0,cb.released=1)},sa.prev=function(){sa.activate(null==Ja.activeItem?0:Ja.activeItem-1)},sa.next=function(){sa.activate(null==Ja.activeItem?0:Ja.activeItem+1)},sa.prevPage=function(){sa.activatePage(Ja.activePage-1)},sa.nextPage=function(){sa.activatePage(Ja.activePage+1)},sa.slideBy=function(a,b){a&&(Ra?sa[Qa?"toCenter":"toStart"](k((Qa?Ja.centerItem:Ja.firstItem)+ra.scrollBy*a,0,Ia.length)):L(ya.dest+a,b))},sa.slideTo=function(a,b){L(a,b)},sa.toStart=function(a,b){Q("start",a,b)},sa.toEnd=function(a,b){Q("end",a,b)},sa.toCenter=function(a,b){Q("center",a,b)},sa.getIndex=R,sa.activate=function(a,b){var c=T(a);ra.smart&&!1!==c&&(Qa?sa.toCenter(c,b):c>=Ja.lastItem?sa.toStart(c,b):c<=Ja.firstItem?sa.toEnd(c,b):Z())},sa.activatePage=function(a,b){i(a)&&L(Ga[k(a,0,Ga.length-1)],b)},sa.resume=function(a){ra.cycleBy&&ra.cycleInterval&&("items"!==ra.cycleBy||Ia[0]&&null!=Ja.activeItem)&&!(a<sa.isPaused)&&(sa.isPaused=0,gb?gb=clearTimeout(gb):oa("resume"),gb=setTimeout(function(){switch(oa("cycle"),ra.cycleBy){case"items":sa.activate(Ja.activeItem>=Ia.length-1?0:Ja.activeItem+1);break;case"pages":sa.activatePage(Ja.activePage>=Ga.length-1?0:Ja.activePage+1)}},ra.cycleInterval))},sa.pause=function(a){a<sa.isPaused||(sa.isPaused=a||100,gb&&(gb=clearTimeout(gb),oa("pause")))},sa.toggle=function(){sa[gb?"pause":"resume"]()},sa.set=function(b,c){a.isPlainObject(b)?a.extend(ra,b):ra.hasOwnProperty(b)&&(ra[b]=c)},sa.add=function(b,c){var d=a(b);Ra?(null==c||!Ia[0]||c>=Ia.length?d.appendTo(va):Ia.length&&d.insertBefore(Ia[c].el),null!=Ja.activeItem&&c<=Ja.activeItem&&(_a.active=Ja.activeItem+=d.length)):va.append(d),K()},sa.remove=function(b){if(Ra){var c=S(b);if(c>-1){Ha.eq(c).remove();var d=c===Ja.activeItem;null!=Ja.activeItem&&c<Ja.activeItem&&(_a.active=--Ja.activeItem),K(),d&&(_a.active=null,sa.activate(Ja.activeItem))}}else a(b).remove(),K()},sa.moveAfter=function(a,b){X(a,b,1)},sa.moveBefore=function(a,b){X(a,b)},sa.on=function(a,b){if("object"===e(a))for(var c in a)a.hasOwnProperty(c)&&sa.on(c,a[c]);else if("function"===e(b))for(var d=a.split(" "),f=0,g=d.length;g>f;f++)$a[d[f]]=$a[d[f]]||[],-1===Y(d[f],b)&&$a[d[f]].push(b);else if("array"===e(b))for(var h=0,i=b.length;i>h;h++)sa.on(a,b[h])},sa.one=function(a,b){function c(){b.apply(sa,arguments),sa.off(a,c)}sa.on(a,c)},sa.off=function(a,b){if(b instanceof Array)for(var c=0,d=b.length;d>c;c++)sa.off(a,b[c]);else for(var e=a.split(" "),f=0,g=e.length;g>f;f++)if($a[e[f]]=$a[e[f]]||[],null==b)$a[e[f]].length=0;else{var h=Y(e[f],b);-1!==h&&$a[e[f]].splice(h,1)}},sa.destroy=function(){return Sa.add(Aa).add(za).add(Ea).add(Ua).add(Va).add(Wa).add(Xa).add(Ya).add(Za).off("."+p),s.off("keydown",ka),Wa.add(Xa).add(Ya).add(Za).removeClass(ra.disabledClass),Ha&&null!=Ja.activeItem&&Ha.eq(Ja.activeItem).removeClass(ra.activeClass),Ea.empty(),ta||(ua.off("."+p),Ka.restore(),La.restore(),Ma.restore(),Na.restore(),a.removeData(b,p)),Ia.length=Ga.length=0,_a={},sa.initialized=0,sa},sa.init=function(){if(!sa.initialized){sa.on(J);var a=["overflow","position"],b=["position","webkitTransform","msTransform","transform","left","top","width","height"];Ka.save.apply(Ka,a),Ma.save.apply(Ma,a),La.save.apply(La,b),Na.save.apply(Na,b);var c=Aa;return ta||(c=c.add(va),ua.css("overflow","hidden"),m||"static"!==ua.css("position")||ua.css("position","relative")),m?n&&c.css(m,n):("static"===za.css("position")&&za.css("position","relative"),c.css({position:"absolute"})),ra.forward&&Ua.on(y,ga),ra.backward&&Va.on(y,ga),ra.prev&&Wa.on(x,ga),ra.next&&Xa.on(x,ga),ra.prevPage&&Ya.on(x,ga),ra.nextPage&&Za.on(x,ga),Sa.on(w,ia),za[0]&&za.on(x,ja),Ra&&ra.activateOn&&ua.on(ra.activateOn+"."+p,"*",la),Ea[0]&&ra.activatePageOn&&Ea.on(ra.activatePageOn+"."+p,"*",ma),Ta.on(t,{source:"slidee"},ba),Aa&&Aa.on(t,{source:"handle"},ba),s.on("keydown",ka),ta||(ua.on("mouseenter."+p+" mouseleave."+p,na),ua.on("scroll."+p,h)),sa.initialized=1,K(!0),ra.cycleBy&&!ta&&sa[ra.startPaused?"pause":"resume"](),sa}}}function e(a){return null==a?String(a):"object"==typeof a||"function"==typeof a?Object.prototype.toString.call(a).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof a}function f(a,b){a.preventDefault(),b&&a.stopPropagation()}function g(b){f(b,1),a(this).off(b.type,g)}function h(){this.scrollLeft=0,this.scrollTop=0}function i(a){return!isNaN(parseFloat(a))&&isFinite(a)}function j(a,b){return 0|E(String(a.css(b)).replace(/[^\-0-9.]/g,""))}function k(a,b,c){return b>a?b:a>c?c:a}function l(a){var b={};return b.style={},b.save=function(){if(a&&a.nodeType){for(var c=0;c<arguments.length;c++)b.style[arguments[c]]=a.style[arguments[c]];return b}},b.restore=function(){if(a&&a.nodeType){for(var c in b.style)b.style.hasOwnProperty(c)&&(a.style[c]=b.style[c]);return b}},b}var m,n,o,p="sly",q=b.cancelAnimationFrame||b.cancelRequestAnimationFrame,r=b.requestAnimationFrame,s=a(document),t="touchstart."+p+" mousedown."+p,u="mousemove."+p+" mouseup."+p,v="touchmove."+p+" touchend."+p,w=(document.implementation.hasFeature("Event.wheel","3.0")?"wheel.":"mousewheel.")+p,x="click."+p,y="mousedown."+p,z=["INPUT","SELECT","BUTTON","TEXTAREA"],A=[],B=Math.abs,C=Math.sqrt,D=Math.pow,E=Math.round,F=Math.max,G=Math.min,H=0;s.on(w,function(a){var b=a.originalEvent[p],c=+new Date;(!b||b.options.scrollHijack<c-H)&&(H=c)}),function(a){function b(a){var b=(new Date).getTime(),d=Math.max(0,16-(b-c)),e=setTimeout(a,d);return c=b,e}r=a.requestAnimationFrame||a.webkitRequestAnimationFrame||b;var c=(new Date).getTime(),d=a.cancelAnimationFrame||a.webkitCancelAnimationFrame||a.clearTimeout;q=function(b){d.call(a,b)}}(window),function(){function a(a){for(var d=0,e=b.length;e>d;d++){var f=b[d]?b[d]+a.charAt(0).toUpperCase()+a.slice(1):a;if(null!=c.style[f])return f}}var b=["","webkit","moz","ms","o"],c=document.createElement("div");m=a("transform"),n=a("perspective")?"translateZ(0) ":""}(),b.Sly=d,a.fn.sly=function(b,c){var f,g;return a.isPlainObject(b)||(("string"===e(b)||!1===b)&&(f=!1===b?"destroy":b,g=Array.prototype.slice.call(arguments,1)),b={}),this.each(function(e,h){var i=a.data(h,p);i||f?i&&f&&i[f]&&i[f].apply(i,g):i=a.data(h,p,new d(h,b,c).init())})},d.defaults={slidee:null,horizontal:!1,itemNav:null,itemSelector:null,smart:!1,activateOn:null,activateMiddle:!1,scrollSource:null,scrollBy:0,scrollHijack:300,scrollTrap:!1,dragSource:null,mouseDragging:!1,touchDragging:!1,releaseSwing:!1,swingSpeed:.2,elasticBounds:!1,interactive:null,scrollBar:null,dragHandle:!1,dynamicHandle:!1,minHandleSize:50,clickBar:!1,syncSpeed:.5,pagesBar:null,activatePageOn:null,pageBuilder:function(a){return"<li>"+(a+1)+"</li>"},forward:null,backward:null,prev:null,next:null,prevPage:null,nextPage:null,cycleBy:null,cycleInterval:5e3,pauseOnHover:!1,startPaused:!1,moveBy:300,speed:0,easing:"swing",startAt:null,keyboardNavBy:null,draggedClass:"dragged",activeClass:"active",disabledClass:"disabled"}}(jQuery,window),function(){function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){return e(b[g][1][a]||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}return a}()({1:[function(a,b,c){(function(c){"use strict";function d(a){this.player=null,this.director=null,this.modelManager=null,this.container=null,this.mattertagManager=null,this.fadeInSpeed=a,null!==this.fadeInSpeed&&void 0!==this.fadeInSpeed||(this.fadeInSpeed=0)}var e=a("three"),f=a("./util/logger"),g=(a("./util/common"),a("./enum/PlayerEvents")),h=a("./enum/DirectorEvents"),i=a("./conf"),j=a("./enum/Viewmode"),k=(a("./enum/WarpStyle"),a("./enum/BlackoutStyle"),a("./enum/ModelManagerEvents")),l=a("./enum/MattertagEvents"),m=a("./util/transitions"),n=a("./util/lerp"),o=new f(c);d.prototype.init=function(a,b,c,d,e){this.player=b,this.director=a,this.modelManager=c,this.mattertagManager=d,this.container=e,this.updateModel(),this.bindEvents()},d.prototype.bindEvents=function(){this.modelManager.on(k.ActiveModelChanged,this.updateModel.bind(this)),this.player.on(g.ModeChanging,this.handlePlayerModeChanging.bind(this)),this.player.on(g.ModeChanged,this.handlePlayerModeChanged.bind(this)),this.player.on(g.ClosestPanoChanging,this.handleClosestPanoChanging.bind(this)),this.player.on(g.StartInside,this.handleStartInside.bind(this)),this.player.on(g.StartOutside,this.handleStartOutside.bind(this)),this.player.on(g.WarpStarted,this.handleWarpStarted.bind(this)),this.director.on(h.ActionInterrupted,this.handleActionInterruption.bind(this)),this.mattertagManager.on(l.TagActivated,this.onMattertagActivated.bind(this)),this.mattertagManager.on(l.TagNavigation,this.onNavigationToMattertag.bind(this))},d.prototype.updateModel=function(){this.model=this.modelManager.getActiveModel()},d.prototype.handleWarpStarted=function(){this.hidePlayerReticule()},d.prototype.onMattertagActivated=function(){this.hidePlayerReticule()},d.prototype.onNavigationToMattertag=function(){this.hidePlayerReticule()},d.prototype.handlePlayerModeChanging=function(a,b,c){var d=this.modelManager.getActiveModel(),e=this.player.is360View(b,c)||this.director.tourIsPlaying?0:i[b].markerOpacity;d.fadePanoMarkers(e),d.setMode(b)},d.prototype.handlePlayerModeChanged=function(a,b){var c=this.modelManager.getActiveModel(),d=b===j.PANORAMA?e.DoubleSide:e.FrontSide;c.setSide(d),c.setMode(b)},d.prototype.handleClosestPanoChanging=function(a,b,c){c!==j.TRANSITIONING&&(a&&!this.director.tourIsPlaying&&a.hoverOff(c),b&&!this.director.tourIsPlaying&&b.hoverOn(c))},d.prototype.handleActionInterruption=function(){},d.prototype.handleStartInside=function(a){var b=i[this.player.mode],c=a?0:b.transitionTime*b.skyboxOpacityLength;this.fadeIn(this.fadeInSpeed),this.model.alpha=0,this.model.skybox.material.uniforms.opacity.value=1,this.model.fadePanoMarkers(a?0:b.markerOpacity);var d=this.player.reticule;m.start(n.property(d.material,"opacity",0),c,null,0,null,"retReOpac")},d.prototype.handleStartOutside=function(a){this.fadeIn(a)},d.prototype.fadeIn=function(a){null!==a&&void 0!==a||(a=2e3,o.warn("DisplayController.fadeIn -> no transition time specified, defaulting to 2000 ms.")),$(this.container).fadeIn(a)},d.prototype.hidePlayerReticule=function(){this.player.reticule.hide()},b.exports=d}).call(this,"/js/DisplayController.js")},{"./conf":7,"./enum/BlackoutStyle":17,"./enum/DirectorEvents":20,"./enum/MattertagEvents":28,"./enum/ModelManagerEvents":30,"./enum/PlayerEvents":38,"./enum/Viewmode":51,"./enum/WarpStyle":52,"./util/common":145,"./util/lerp":152,"./util/logger":153,"./util/transitions":162,three:177}],2:[function(a,b,c){(function(c){"use strict";var d=a("three"),e=(a("./util/ajax"),a("./util/browser"),a("./util/common"),a("./conf"),a("./enum/Viewmode"),a("./enum/ControlEvents"),a("./util/logger")),f=(new e(c),a("./enum/PlayerEvents"),new d.Clock(!0));f.start(),b.exports={report:function(a,b,c){},getMixpanelToken:function(a){},impression:function(a){},initMixpanel:function(a){},initMixpanelModel:function(a){},sessionStart:function(a){},track:function(a,b){},trackAlways:function(a,b){}}}).call(this,"/js/analytics.js")},{"./conf":7,"./enum/ControlEvents":19,"./enum/PlayerEvents":38,"./enum/Viewmode":51,"./util/ajax":141,"./util/browser":142,"./util/common":145,"./util/logger":153,three:177}],3:[function(a,b,c){(function(c){"use strict";function d(a,b,c){a&&(a=a.toLowerCase().trim());var d=new k.Vector3(0,1,0),e=Math.PI/3,f=Math.PI/2;switch(a){case"left":c.copy(b),c.applyAxisAngle(d,f);break;case"right":c.copy(b),c.applyAxisAngle(d,-f);break;case"forwardleft":c.copy(b),c.applyAxisAngle(d,e);break;case"forwardright":c.copy(b),c.applyAxisAngle(d,-e);break;case"forward":default:c.copy(b)}return c}function e(a,b){if(a){var c={pano:a,lookAtPoint:null,duration:null,maxDistanceOverride:null,skipWarpingCheck:!1};this.player.flyToPano(c,function(){b&&b({success:!0,message:"Transition complete."})})}else s.warn("Automation -> clickPanoObject: Unable to find pano."),b&&b({success:!1,error:"Unable to find pano."})}function f(a,b){var c=this.findRankedPano(a,b);return c>=0?this.handleToObject[c]:(s.warn("Automation -> findRankedPanoObject: Unable to find nearby pano."),null)}function g(a,b){var c=this.findRankedMattertag(a,b);return c>=0?this.handleToObject[c]:(s.warn("Automation -> findRankedMattertagObject: Unable to find nearby Mattertag."),null)}function h(a,b){b.copy(p.FORWARD),a.getDirection(b)}function i(a,b,c){if(b){var d=b.targetFunction,e=b.params;if(d){var f=t[d];if(f){e=e||{},e.onDone=function(a){q.respondToMessage(c,a)};var g=[];for(var h in e)e.hasOwnProperty(h)&&g.push(e[h]);f.apply(t,g)}}}}function j(a){a({success:!0,message:"Init complete."})}var k=a("three"),l=a("./util/logger"),m=a("./enum/Viewmode"),n=a("./enum/Keys"),o=a("./conf"),p=a("./enum/Vectors"),q=a("./postmessage.js"),r=a("./util/math.js"),s=new l(c),t=null,u=function(){var a=new k.Vector3;return function(b){b?(a.copy(b.position),a.add(b.discPosition),r.projectPositionToCanvas(a,this.player.camera,a),this.click(a.x,a.y)):s.warn("Automation -> clickMattertagObject: Unable to find Mattertag.")}}(),v=function(a){var b=new k.Vector3;return function(a){var c=this.player.getDirection(),d=0,e=0;if(this.player.mode===m.PANORAMA)d=o.insideLookLimitUp,e=o.insideLookLimitDown;else{if(this.player.mode!==m.DOLLHOUSE)return a;d=o.dollhouseDefault.maxPolarAngle,e=o.dollhouseDefault.minPolarAngle}b.copy(c),b.y=0,b.normalize();var f=-k.Math.radToDeg(b.angleTo(c));return e-=f,d-=f,a>d&&(a=d),a<e&&(a=e),a}}();q.setReceiver(i);var w={};t={handleToObject:{},objectToHandle:{},handleCount:0,director:null,player:null,init:function(a,b){this.director=a,this.player=b;var c=w.onInitComplete;c?j(c):w.onInitComplete={completed:!0}},findRankedPano:function(a,b){var c=new k.Vector3,e=new k.Vector3;return function(a,b){h(this.player,e),d(b,e,c);var f=this.player.rankedPanoInDirection(a,c);if(f){var g=this.objectToHandle[f.id];return g||(this.objectToHandle[f.id]=g=this.handleCount++,this.handleToObject[g]=f),g}return s.warn("Automation -> findRankedPano: Unable to find nearby pano."),-1}}(),findRankedMattertag:function(a,b){var c=new k.Vector3,e=new k.Vector3;return function(a,b){h(this.player,e),d(b,e,c);var f=this.player.rankedMattertagInDirection(a,c);if(f){var g=this.objectToHandle[f.i];return g||(this.objectToHandle[f.i]=g=this.handleCount++,this.handleToObject[g]=f),g}return s.warn("Automation -> findRankedMattertag: Unable to find nearby Mattertag."),-1}}(),clickNearestMattertag:function(a){this.clickRankedMattertag(0,a)},clickRankedMattertag:function(a,b){var c=g.call(this,a,b);c&&u.call(this,c)},clickNearestPano:function(a,b){this.clickRankedPano(0,a,b)},clickRankedPano:function(a,b,c){var d=f.call(this,a,b);d?e.call(this,d,c):c(null)},clickPano:function(a,b){var c=this.handleTable[a];c?e.call(this,c,b):b(null)},rotate:function(){function a(a){return"right"===a?n.RIGHTARROW:"left"===a?n.LEFTARROW:"up"===a?n.I:"down"===a?n.K:void 0}var b=(new k.Vector3,new k.Vector3),c=new k.Vector3(0,0,0),d=!1,e=new k.Vector3;return function(f,g,h){if(!d){if(!g||isNaN(g))return s.warn("Automation -> rotate: Invalid rotation angle."),void(h&&h({success:!1,error:"Invalid rotation angle."}));"right"===f||"left"===f?(c.set(0,1,0),"right"===f&&(g=-g)):"up"===f||"down"===f?(c.set(1,0,0),"down"===f&&(g=-g),g=v.call(this,g)):(s.warn("Automation -> rotate: Invalid direction for rotation: "+f),h&&h({success:!1,error:"Invalid direction for rotation."})),g=k.Math.degToRad(g),b=this.player.getDirection(),d=!0;var i=this.player.controls[this.player.mode];i.handleKeyDown(a(f));var j=0;(function c(){e.copy(p.FORWARD),this.player.getDirection(e);var k=e.angleTo(b);j+=Math.abs(k),j>=Math.abs(g)?(d=!1,i.handleKeyUp(a(f)),h&&h({success:!0,message:"Rotation complete."})):(b.copy(e),window.setTimeout(c.bind(this),4))}).bind(this)()}}}(),click:function(a,b,c){!0===c&&(a=a/100*window.innerWidth,b=b/100*window.innerHeight),this.player.handleInputStart(a,b),this.player.updateIntersect(),this.player.handleInputEnd(a,b)},mouseOver:function(a,b,c){!0===c&&(a=a/100*window.innerWidth,b=b/100*window.innerHeight),this.player.handleInputMove(a,b),this.player.updateIntersect()}},function(){b.exports=t,window.__showcaseAutomationApi=t}()}).call(this,"/js/automation.js")},{"./conf":7,"./enum/Keys":25,"./enum/Vectors":50,"./enum/Viewmode":51,"./postmessage.js":122,"./util/logger":153,"./util/math.js":154,three:177}],4:[function(a,b,c){"use strict";function d(){e.PerspectiveCamera.call(this,f.dollhouseFOV,window.innerWidth/window.innerHeight,f.dollhouseNear,f.dollhouseFar),this.controls=null}var e=a("three"),f=a("../conf");d.prototype=Object.create(e.PerspectiveCamera.prototype),d.prototype.updateAspect=function(a){this.aspect=a,this.updateProjectionMatrix()},b.exports=d},{"../conf":7,three:177}],5:[function(a,b,c){"use strict";function d(){var a=window.innerWidth/window.innerHeight;e.OrthographicCamera.call(this,-f.orthoBase,f.orthoBase,f.orthoBase/a,-f.orthoBase/a,f.orthoNear,f.orthoFar),this.controls=null,this.updateAspect(a)}var e=a("three"),f=a("../conf");d.prototype=Object.create(e.OrthographicCamera.prototype),d.prototype.updateAspect=function(a){this.aspect=a,this.top=f.orthoBase/a,this.bottom=-f.orthoBase/a,this.updateProjectionMatrix()},b.exports=d},{"../conf":7,three:177}],6:[function(a,b,c){"use strict";function d(){e.PerspectiveCamera.call(this,f.insideFOV,window.innerWidth/window.innerHeight,f.insideNear,f.insideFar),this.controls=null}var e=a("three"),f=a("../conf");d.prototype=Object.create(e.PerspectiveCamera.prototype),d.prototype.updateAspect=function(a){this.aspect=a,this.updateProjectionMatrix()},b.exports=d},{"../conf":7,three:177}],7:[function(a,b,c){"use strict";var d=a("three"),e=a("./util/browser"),f=a("./enum/Viewmode"),g=a("./enum/VROption"),h=a("./enum/Colors"),i=a("./enum/WarpStyle"),j=a("./util/easing"),k=a("./util/common"),l=a("./util/showcase"),m=a("./constants"),n={debug:!1,isTestVersion:!1,isNewServerPreviewVersion:!1,isCleanUI:!1,isUserVersion:!1,isEditVersion:!1,isNewEditVersion:!1,isProduceVersion:!1,isLocalVersion:!0,vrDebug:!1,fpsOn:!1,adjustCompass:!1,adjustColor:!1,newbarrage:!0,wscdn:!0,thirdCustomer:-1,version:"2.11.9-0-ga9537d5",pageTitle:"众趣科技",authorizationHeader:l.getAuthorizationHeader(),autoplay:e.valueFromHash("play",!0),logLevel:e.valueFromHash("log",2),showLog:e.valueFromHash("db",0),skyboxRadius:1e3,modelBoundsPadding:5,showNeighbors:!1,brand:e.valueFromHash("brand",!0),mls:e.valueFromHash("mls",0),showHighlights:e.valueFromHash("hhl",!0),startHighlights:e.valueFromHash("hl",!1),specialEdition:e.valueFromHash("bn",0),showTitleContainer:e.valueFromHash("title",!0),useWheel:e.valueFromHash("wh",!0),crossOrigin:"anonymous",fancierTransition:!0,wireframe:!0,skyboxWireframe:!0,modelAlpha:1,highlightPanoSelection:!1,showSweeps:!0,showSkyboxes:!0,showMesh:!0,showFloors:!0,showFloorDuration:300,showFloorDelay:300,hideFloorDuration:300,hideFloorDelay:0,reticuleOpacityTransitionTime:250,
reticuleColor:h.white,markerOpacityTransitionTime:500,guiAnimationSpeed:250,highlightAnimationDuration:500,barfadeAnimationDuration:300,modelComponentLoadSpinnerDelay:150,captureErrors:!1,maxMobileTextures:10,startupFlyinDelay:3e3,dollhouseDefault:{minDistance:15,maxDistance:50,minPolarAngle:d.Math.degToRad(10),maxPolarAngle:d.Math.degToRad(65)},hideReticuleTimeout:1e3,titletagMaxdistance:5,weathertagMaxdistance:5,analytics:{inactivityThreshold:30,sessionTrackingRate:.15,maxTrackedErrors:20,sessionDurationPingFrequency:10,sessionDurationTimeout:15},flydown:{movementEasing:"easeInOutQuad",movementDelay:.001,rotationEasing:"easeInOutQuad",rotationDelay:.5,modelTextureDelay:.75,skyboxDelay:.75},transition:{flySpeed:.01,flyTime:1150,flytimeMaxDistanceThreshold:5,flytimeDistanceMultiplier:150,aimTime:1150,aimSlowFactor:1.5,blur:.2,movementEasing:"easeInOutQuad",blendEasing:"easeInOutQuad",fastForwardFactor:1},show360Views:{enabled:!0,transitionTime:1e3},quickstart:{enabled:1===e.valueFromHash("qust",0)||1===e.valueFromHash("qs",0),animation:1400,showTextDelay:500,fadeOutDelay:3e3,fovChange:10},vr:{enabled:!1,option:e.valueFromHash("vr",g.CONTEXTUAL)},mattertags:{enabled:!0,enableLinking:!0,startup:{hideUntilStart:!1,fadeInDuration:500,fadeInDelay:100},visibility:{anyDistance:!0,visibleDistance:8,cameraClearance:.1,alphaTestLevel:.05,hideViaFloor:!0,hideOffScreenDisc:!1,hideOffScreenObject:!1,MaxDistance:e.valueFromHash("MaxDistance",5)},disc:{opacity:.9,disabledOpacity:.5,scale:{nearBound:1.5,farBound:4.8,linkFarBound:!1,linkPercent:40,maxSize:80,minSize:40,baseViewportSize:800,buildingViewportSize:300,responsiveness:100}},pole:{enabled:!0,height:.5,width:2,opacity:.5,color:"white"},animation:{hoverOnClosing:!1,animInDelay:100,animOutDelay:50,animInTime:200,animOutTime:100},boardScale:{billboardScale:1,scaleToDisc:!0,boardToDiscRatio:1.2},navigate:{nearestPano:!0,lineOfSight:!0,reactivate:!0,aimAt:"disc",tiltTolerance:25,rotateSpeedFactor:.6}},path:{color:h.white,colorUp:h._desat(h.white,.5),colorDown:h._darken(h.white,.35),opacity:.5,style:"ribbon",height:.025,ribbonWidth:.24,outsideHeight:.5,waypointRadius:.5,waypointIndoorRadius:.24,waypointPulse:1e3,typ:i.BLACK,meshFree:e.valueFromHash("mf",0),mapGuides:e.valueFromHash("guides",!0),fadeInTime:400,fadeOutTime:300},warp:{nearPanoDist:.1,matchCam:!1,blur:.33,fastTime:1500,teleportTime:1500,outsideTime:2e3,lookAheadMax:.3,lookAheadDist:2.5,softPushDist:.37,softPushEnd:.3,softBendAngle:8,softBendTilt:4,softBendEnd:.3,doBurns:e.valueFromHash("kb",!0),burnsAngle:15,minBurnsAngle:6,minDownAngle:-35,maxTurnPerSec:280,maxAimPerSec:45,minRotation:12,maxAimRotation:33.2,turnFriction:.2,flySpeed:.01,minWarpTime:1200,warpInterruptionRedirectTime:500,tourStepDelay:e.valueFromHash("st",5e3),walkDelay:0,walkMaxDist:50,walkSlideShowThreshhold:3e3,walkExtraPanosDistance:.4,timePerMeter:800,motionLeadTime:500,movementEasing:"easeInOutQuad",blendEasing:"easeInOutQuad",showBunny:!1,loop:e.valueFromHash("lp",!0),auto:e.valueFromHash("ts",-1),eOrder:"YXZ",stepFactor:.25,brakeStrength:2,minBrakeAngle:.1,maxBrakeAngle:1.8,climbEffort:4,waitMultiplier1:4,waitMultiplier2:4},rotationFriction:.03,rotationAccelerationInside:4.5,rotationAccelerationOutside:.15,rotationAfterMoveMultiplier:30,rotationAfterMoveHistoryCount:5,panFriction:.09,panAccelerationOutside:60,onload:e.valueFromHash("onload",f.PANORAMA),zoomNearLimit:.1,zoomFarLimit:10,navigation:{panoScores:!1,mouseDirection:!0,filterStrictness:.75,angleFactor:-30,directionFactor:10,distanceFactor:-1,optionalityFactor:3},secretPanelWord:[38,38,40,40,37,39,37,39,66,65],console:e.valueFromHash("console",!1),noMeshFloorPositionOffset:new d.Vector3(0,-1.2,0),panoramaNeighbourMaxDistance:5,panoFloorClickRadius:.7,showScreenshotLocations:!1,showAxis:!1,showNeighbourRaycasts:!1,colorMarkerOnLoad:!1,colorMarkerByFloor:!1,tiling:{panoPreRenderRepeatDelay:2500,panoPreRenderDelay:500,preRenderTourPanos:e.valueFromHash("tileprerender",0),tilingFlagNames:["usetiles","tiles"],maxNavPanoQuality:e.valueFromHash("maxtileq",null),maxZoomPanoQuality:e.valueFromHash("maxztileq",null),overlayStyle:e.valueFromHash("tileoverlay",0),uploadIntervalDelay:e.valueFromHash("tileupdelay",10),initialIntervalDelay:e.valueFromHash("itiledelay",0),maxNonBaseUploadsPerFrame:e.valueFromHash("maxnbtpf",2),maxBaseUploadsPerFrame:e.valueFromHash("maxbtpf",6),customCompression:e.valueFromHash("tilecustcomp",0),mobileHighQualityOverride:!1,allowUltraHighResolution:!1},zoom:{enabled:!0,max:e.valueFromHash("maxzoom",1.5),min:e.valueFromHash("minzoom",1),transitionStyle:e.valueFromHash("zoomtrans",1),restoreTime:500,activationThreshold:1.1},panoramaSettings:{loading_2k:!1,screenshot_2k:!1,loading_fov82:!1,screenshot_fov82:!1}};n=k.deepExtend(n,m,{panorama:{transitionTime:1e3,modelAlpha:0,modelAlphaDelay:n.flydown.modelTextureDelay,modelAlphaLength:1,skyboxOpacity:1,skyboxOpacityDelay:n.flydown.skyboxDelay,skyboxOpacityLength:.9,fovLength:1,fovDelay:0,cameraMatrixDuration:.8,cameraMatrixDelay:0,cameraMatrixEase:j.easeInCubic,reticuleOpacity:1,markerOpacity:.6,markerOpacityOnHover:1},dollhouse:{transitionTime:1e3,modelAlpha:1,modelAlphaDelay:0,modelAlphaLength:1-n.flydown.modelTextureDelay,skyboxOpacity:0,skyboxOpacityDelay:0,skyboxOpacityLength:1-n.flydown.skyboxDelay,fovLength:1,fovDelay:0,cameraMatrixDuration:.8,cameraMatrixDelay:.3,cameraMatrixEase:j.easeInCubic,reticuleOpacity:1,markerOpacity:0,markerOpacityOnHover:0},floorplan:{transitionTime:1e3,modelAlpha:1,modelAlphaDelay:0,modelAlphaLength:1-n.flydown.modelTextureDelay,skyboxOpacity:0,skyboxOpacityDelay:0,skyboxOpacityLength:1-n.flydown.skyboxDelay,fovLength:1,fovDelay:0,cameraMatrixDuration:.5,cameraMatrixDelay:0,cameraMatrixEase:j.easeOutCubic,reticuleOpacity:1,markerOpacity:0,markerOpacityOnHover:0},transitioning:{reticuleOpacity:0},"floorplan-dollhouse":{rotationDelay:0,rotationDuration:1},"floorplan-panorama":{rotationDelay:.5,rotationDuration:1},"dollhouse-panorama":{rotationDelay:.5,rotationDuration:1},"dollhouse-floorplan":{rotationDelay:0,rotationDuration:1,cameraMatrixDuration:1.05,cameraMatrixDelay:.5},"panorama-dollhouse":{rotationDelay:0,rotationDuration:.5},"panorama-floorplan":{transitionTime:1500,rotationDelay:0,rotationDuration:.5}}),n.path.meshFree&&(n.path.typ=i.WALK),b.exports=n},{"./constants":8,"./enum/Colors":18,"./enum/VROption":47,"./enum/Viewmode":51,"./enum/WarpStyle":52,"./util/browser":142,"./util/common":145,"./util/easing":147,"./util/showcase":156,three:177}],8:[function(a,b,c){"use strict";b.exports={signedUrlDefaultExpireTime:24e4,signedUrlCheckInterval:1e4,signedUrlRefreshBuffer:15e3,dollhouseFOV:70,dollhouseNear:1,dollhouseFar:5e3,insideFOV:70,insideNear:.1,insideFar:5e3,insideLookSpeed:.12,insideLookLimitUp:40,insideLookLimitDown:-40,orthoNear:1,orthoFar:5e3,orthoBase:10,narrowLandscapeHeight:290,reallyNarrowLandscapeHeight:250,visionTilingStartDate:new Date("8/26/2016"),visionTilingStartVersion:"1.1.407.13667",windowHeightHighQualityThreshold:1200,tourStepDelayDefault:3500,tourStepDelaySlideShow:5e3,workshopApsect:9/16,highQualityMaxZoom:2,ultraHighQualityMaxZoom:1.5}},{}],9:[function(a,b,c){"use strict";function d(a){g.call(this,a),this.minPolarAngle=f.dollhouseDefault.minPolarAngle,this.maxPolarAngle=f.dollhouseDefault.maxPolarAngle,this.minDistance=f.dollhouseDefault.minDistance,this.maxDistance=f.dollhouseDefault.maxDistance,this.adjustedMinDistance=this.minDistance,this.adjustedMaxDistance=this.maxDistance}var e=a("three"),f=a("../conf"),g=a("./OutsideControls");d.prototype=Object.create(g.prototype),d.prototype.pan=function(a,b){this.camera.updateMatrix();var c=this.camera.position.clone().sub(this.target).length();c*=Math.tan(this.camera.fov/2*Math.PI/180),this.panLeft(2*a*c/window.innerHeight),this.panUp(-2*b*c/window.innerHeight)},d.prototype.updateZoom=function(){return this.offset.length()*this.scale},d.prototype.setZoomBounds=function(a){var b=a.min.distanceTo(a.max);this.adjustedMinDistance=Math.max(Math.min(b/2,f.dollhouseDefault.minDistance),0),this.adjustedMaxDistance=Math.min(Math.max(b,f.dollhouseDefault.maxDistance),f.skyboxRadius),this.minDistance=this.adjustedMinDistance,this.maxDistance=this.adjustedMaxDistance},d.prototype.resetRanges=function(a,b){a?(this.minDistance=Math.min(a,this.minDistance),this.maxDistance=Math.max(a,this.maxDistance)):(this.minDistance=this.adjustedMinDistance,this.maxDistance=this.adjustedMaxDistance),b?(this.minPolarAngle=e.Math.degToRad(10),this.maxPolarAngle=e.Math.degToRad(65)):(this.minPolarAngle=f.dollhouseDefault.minPolarAngle,this.maxPolarAngle=f.dollhouseDefault.maxPolarAngle)},d.prototype.toJSON=function(){return g.prototype.toJSON.call(this)},b.exports=d},{"../conf":7,"./OutsideControls":11,three:177}],10:[function(a,b,c){"use strict";function d(a){g.call(this,a),this.minDistance=20,this.maxDistance=50,this.noRotateUpDown=!0,this.minPolarAngle=0,this.maxPolarAngle=0,this.absoluteScale=1,this.currentScale=1}var e=a("three"),f=a("../conf"),g=a("./OutsideControls"),h=a("../util/math"),i=a("../util/browser");d.prototype=Object.create(g.prototype),d.prototype.zoomToContain=function(a){var b=Math.max(a.x,a.z),c=Math.min(a.x,a.z),d=Math.max(b,c*this.camera.aspect),e=Math.max(c,b*this.camera.aspect);this.absoluteScale=(i.aspectRatio()<1?e:d)/2/f.orthoBase*1.2,this.currentScale=this.absoluteScale},d.prototype.rotateToView=function(a,b){var c=0;i.aspectRatio()<1==a.x<a.z?b.z>0&&(c=Math.PI):c=b.x>0?Math.PI/2:-Math.PI/2,this.rotateLeft(c),this.update(0)},d.prototype.pan=function(a,b){this.camera.updateMatrix(),this.panLeft(a*(this.camera.right-this.camera.left)/window.innerWidth),this.panUp(-b*(this.camera.top-this.camera.bottom)/window.innerHeight)},d.prototype.updateZoom=function(){return this.absoluteScale*=this.scale-.03*this.keyboardZoomSpeed,this.absoluteScale=Math.max(f.zoomNearLimit,Math.min(this.absoluteScale,f.zoomFarLimit)),this.currentScale=.8*this.currentScale+.2*this.absoluteScale,this.camera.left=-f.orthoBase*this.currentScale,this.camera.right=f.orthoBase*this.currentScale,this.camera.top=f.orthoBase*this.currentScale/this.camera.aspect,this.camera.bottom=-f.orthoBase*this.currentScale/this.camera.aspect,this.camera.updateProjectionMatrix(),this.offset.length()},d.prototype.toJSON=function(){var a=new e.Quaternion,b=(new e.Quaternion).setFromAxisAngle(new e.Vector3(0,1,0),e.Math.degToRad(90)),c=new e.Quaternion;return function(){var d=g.prototype.toJSON.call(this);return a.copy(d._rotation),c.copy(b),c.multiply(a),d._rotation.x=h.toPrecision(c.x,4),d._rotation.y=h.toPrecision(c.y,4),d._rotation.z=h.toPrecision(c.z,4),d._rotation.w=h.toPrecision(c.w,4),d._zoom=h.toPrecision(this.currentScale*this.camera.aspect,4),d}}(),b.exports=d},{"../conf":7,"../util/browser":142,"../util/math":154,"./OutsideControls":11,three:177}],11:[function(a,b,c){"use strict";function d(a){this.camera=a,this.camera.controls=this,this.enabled=!1,this.target=new e.Vector3,this.targetBounds=new e.Box3,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.noRotateUpDown=!1,this.rotateSpeed=1,this.keyboardZoomSpeed=0,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=e.Math.degToRad(25),this.maxPolarAngle=e.Math.degToRad(65),this.noKeys=!1,this.rotationAcceleration=new e.Vector2,this.rotationSpeed=new e.Vector2,this.panAcceleration=new e.Vector2,this.panSpeed=new e.Vector2,this.rotateStart=new e.Vector2,this.rotateEnd=new e.Vector2,this.rotateDelta=new e.Vector2,this.panStart=new e.Vector2,this.panEnd=new e.Vector2,this.panDelta=new e.Vector2,this.panOffset=new e.Vector3,this.offset=new e.Vector3,this.dollyStart=new e.Vector2,this.dollyEnd=new e.Vector2,this.dollyDelta=new e.Vector2,this.phiDelta=0,this.thetaDelta=0,this.scale=1,this.panVector=new e.Vector3,this.lastPosition=new e.Vector3,this.state=l.NONE,this.lastMoveTime=0,this.pointersLimit=2,this.pointers=[],this.on("touch-one-finger-start",d.touch.rotate.start),this.on("touch-one-finger-move",d.touch.rotate.move),this.on("touch-two-finger-start",d.touch.pan.start),this.on("touch-two-finger-move",d.touch.pan.move),this.on("touch-two-finger-start",d.touch.zoom.start),this.on("touch-two-finger-move",d.touch.zoom.move)}var e=a("three"),f=a("../conf"),g=a("../util/common"),h=a("../util/math"),i=a("../enum/Keys"),j=a("../enum/ControlEvents"),k=a("events").EventEmitter,l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4};d.prototype=Object.create(k.prototype),d.prototype.setBounds=function(a){this.targetBounds=a},d.prototype.bindEvents=function(a){a=a||document,a.addEventListener("contextmenu",function(a){a.preventDefault()}),a.addEventListener("mousedown",this.onMouseDown.bind(this)),a.addEventListener("mousemove",this.onMouseMove.bind(this)),a.addEventListener("mouseup",this.onMouseUp.bind(this)),a.addEventListener("mouseover",function(a){0!==a.which&&0!==a.buttons||this.onMouseUp(a)}.bind(this)),f.useWheel&&(a.addEventListener("mousewheel",this.onMouseWheel.bind(this)),a.addEventListener("DOMMouseScroll",this.onMouseWheel.bind(this))),a.addEventListener("touchstart",this.onTouchStart.bind(this)),a.addEventListener("touchend",this.onTouchEnd.bind(this)),a.addEventListener("touchmove",this.onTouchMove.bind(this)),a.addEventListener("pointerdown",this.onPointerDown.bind(this)),a.addEventListener("pointerup",this.onPointerUp.bind(this)),a.addEventListener("pointerout",this.onPointerUp.bind(this)),a.addEventListener("pointercancel",this.onPointerUp.bind(this)),a.addEventListener("pointermove",this.onPointerMove.bind(this)),document.addEventListener("keydown",this.onKeyDown.bind(this)),document.addEventListener("keyup",this.onKeyUp.bind(this))},d.prototype.isEngaged=function(){return this.state!==l.NONE},d.prototype.rotateLeft=function(a){void 0===a&&(a=this.getAutoRotationAngle()),this.thetaDelta-=a},d.prototype.rotateUp=function(a){this.noRotateUpDown||(void 0===a&&(a=this.getAutoRotationAngle()),this.phiDelta-=a)},d.prototype.panLeft=function(a){var b=this.camera.matrix.elements;this.panOffset.set(b[0],0,b[2]).normalize(),this.panOffset.multiplyScalar(-a),this.panVector.add(this.panOffset)},d.prototype.panUp=function(a){var b=this.camera.matrix.elements;this.panOffset.set(b[4],0,b[6]).normalize(),this.panOffset.multiplyScalar(-a),this.panVector.add(this.panOffset)},d.prototype.dollyIn=function(a){void 0===a&&(a=this.getZoomScale()),this.scale/=a},d.prototype.dollyOut=function(a){void 0===a&&(a=this.getZoomScale()),this.scale*=a},d.prototype.update=function(a){if(!G.measurestarted){a||(a=1/60),this.rotationSpeed.multiplyScalar(1-f.rotationFriction).addScaledVector(this.rotationAcceleration,f.rotationAccelerationOutside*a),this.rotateLeft(-this.rotationSpeed.x),this.noRotateUpDown||this.rotateUp(this.rotationSpeed.y),this.panSpeed.multiplyScalar(1-f.panFriction).addScaledVector(this.panAcceleration,f.panAccelerationOutside*a),this.pan(-this.panSpeed.x,this.panSpeed.y);var b=this.camera.position;this.offset.copy(b).sub(this.target);var c=Math.atan2(this.offset.x,this.offset.z),d=Math.atan2(Math.sqrt(this.offset.x*this.offset.x+this.offset.z*this.offset.z),this.offset.y);this.autoRotate&&this.rotateLeft(this.getAutoRotationAngle()),c+=this.thetaDelta,d+=this.phiDelta,d=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,d)),d=Math.max(1e-6,Math.min(Math.PI-1e-6,d));var g=this.updateZoom();g=Math.max(this.minDistance,Math.min(this.maxDistance,g)),this.target.add(this.panVector),this.targetBounds.clampPoint(this.target,this.target),this.offset.x=g*Math.sin(d)*Math.sin(c),this.offset.y=g*Math.cos(d),this.offset.z=g*Math.sin(d)*Math.cos(c),b.copy(this.target).add(this.offset),this.camera.lookAt(this.target),this.thetaDelta=0,this.phiDelta=0,this.scale=1,this.panVector.set(0,0,0),this.lastPosition.distanceTo(this.camera.position)>0&&this.lastPosition.copy(this.camera.position),G.settings&&G.settings.basic.menu.compass_enable&&$(".compass").css("transform","rotate("+e.Math.radToDeg(c+G.model.adjustCompass)+"deg)")}},d.prototype.getAutoRotationAngle=function(){return 2*Math.PI/60/60*this.autoRotateSpeed},d.prototype.getZoomScale=function(){return Math.pow(.95,this.zoomSpeed)},d.prototype.onMouseDown=function(a){if(this.enabled){switch(a.preventDefault(),this.mouseDown=!0,a.button){case 0:if(this.noRotate)return;this.state=l.ROTATE,this.rotateStart.set(a.clientX,this.noRotateUpDown?0:a.clientY),this.rotationSpeed.set(0,0);break;case 1:if(this.noZoom)return;this.state=l.DOLLY,this.dollyStart.set(a.clientX,a.clientY);break;case 2:if(this.noPan)return;this.state=l.PAN,this.panStart.set(a.clientX,a.clientY)}this.emit(j.InputStart,"mouse")}},d.prototype.onMouseMove=function(a){if(this.enabled&&this.mouseDown&&0!==a.buttons){a.preventDefault();var b=a.currentTarget;switch(this.state){case l.ROTATE:if(this.noRotate)return;this.rotateEnd.set(a.clientX,this.noRotateUpDown?0:a.clientY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateLeft(2*Math.PI*this.rotateDelta.x/b.clientWidth*this.rotateSpeed),this.rotateUp(2*Math.PI*this.rotateDelta.y/b.clientHeight*this.rotateSpeed),this.rotateStart.copy(this.rotateEnd);break;case l.DOLLY:if(this.noZoom)return;this.dollyEnd.set(a.clientX,a.clientY),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart);(this.dollyDelta.y>0?this.dollyIn:this.dollyOut).call(this),this.dollyStart.copy(this.dollyEnd);break;case l.PAN:if(this.noPan)return;this.panEnd.set(a.clientX,a.clientY),this.panDelta.subVectors(this.panEnd,this.panStart),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd)}this.emit(j.Move,"mouse"),this.lastMoveTime=a.timeStamp,this.update()}},d.prototype.onMouseUp=function(a){this.enabled&&(this.mouseDown=!1,this.state=l.NONE,"mouseover"!==a.type&&(a.timeStamp>this.lastMoveTime+100?(this.rotationSpeed.set(0,0),this.rotationAcceleration.set(0,0)):this.rotationAcceleration.set(-this.rotateDelta.x,this.rotateDelta.y),this.update(),this.rotationAcceleration.set(0,0),this.rotateDelta.set(0,0)))},d.prototype.onMouseWheel=function(a){if(this.enabled&&!this.noZoom&&f.useWheel){this.emit(j.Move,"wheel");((a.wheelDelta||-a.detail)>0?this.dollyOut:this.dollyIn).call(this),this.update()}},d.prototype.onKeyDown=function(a){!this.enabled||this.noKeys||this.noPan||a.metaKey||a.ctrlKey||(a.preventDefault(),this.handleKeyDown(a.which))},d.prototype.handleKeyDown=function(a){var b=function(a,b){"y"===a?this.noRotateUpDown?this.keyboardZoomSpeed=b:this.rotationAcceleration.y=b:this.rotationAcceleration.x=b}.bind(this),c=function(a,b){this.panAcceleration[a]=b}.bind(this),d=!0;switch(a){case i.UPARROW:case i.I:b("y",1);break;case i.DOWNARROW:case i.K:b("y",-1);break;case i.LEFTARROW:case i.J:b("x",-1);break;case i.RIGHTARROW:case i.L:b("x",1);break;case i.W:c("y",1);break;case i.S:c("y",-1);break;case i.A:c("x",-1);break;case i.D:c("x",1);break;default:d=!1}d&&this.emit(j.Move,"key")},d.prototype.onKeyUp=function(a){!this.enabled||this.noKeys||this.noPan||(a.preventDefault(),a.stopPropagation(),this.handleKeyUp(a.which))},d.prototype.handleKeyUp=function(a){switch(a){case i.I:case i.K:case i.UPARROW:case i.DOWNARROW:this.keyboardZoomSpeed=0,this.rotationAcceleration.y=0;break;case i.J:case i.L:case i.LEFTARROW:case i.RIGHTARROW:this.rotationAcceleration.x=0;break;case i.S:case i.W:this.panAcceleration.y=0;break;case i.A:case i.D:this.panAcceleration.x=0}},d.prototype.onTouchStart=function(a){if(this.enabled){switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:this.emit("touch-one-finger-start",a);break;case 2:this.emit("touch-two-finger-start",a);break;default:this.state=l.NONE}this.rotationSpeed.set(0,0),this.emit(j.InputStart,"touch")}},d.prototype.onTouchMove=function(a){if(this.enabled){switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:this.emit("touch-one-finger-move",a),this.update();break;case 2:this.emit("touch-two-finger-move",a),this.update();break;default:this.state=l.NONE}this.lastMoveTime=a.timeStamp}},d.prototype.onTouchEnd=function(a){this.enabled&&(this.emit("touch-one-finger-end",a),this.emit("touch-two-finger-end",a),this.state=l.NONE,a.timeStamp>this.lastMoveTime+100?(this.rotationSpeed.set(0,0),this.rotationAcceleration.set(0,0)):this.rotationAcceleration.set(-this.rotateDelta.x,this.rotateDelta.y),this.update(),this.rotationAcceleration.set(0,0),this.rotateDelta.set(0,0))},d.prototype.onPointerDown=function(a){this.enabled&&("touch"===a.pointerType&&(this.pointers.length<this.pointersLimit&&this.pointers.push({id:a.pointerId,pageX:a.pageX,pageY:a.pageY}),a.touches=this.pointers,this.onTouchStart(a)),this.emit(j.InputStart,"pointer"))},d.prototype.onPointerMove=function(a){this.enabled&&"touch"===a.pointerType&&(this.pointers.forEach(function(b){a.pointerId===b.id&&(b.pageX=a.pageX,b.pageY=a.pageY)}),a.touches=this.pointers,this.onTouchMove(a))},d.prototype.onPointerUp=function(a){this.enabled&&"touch"===a.pointerType&&(this.pointers.forEach(function(b,c){a.pointerId===b.id&&this.pointers.splice(c,1)}.bind(this)),a.touches=this.pointers,this.onTouchEnd(a))},d.prototype.reset=function(){this.state=l.NONE,this.rotationSpeed.set(0,0),this.rotationAcceleration.set(0,0),this.panSpeed.set(0,0),this.panAcceleration.set(0,0)},d.prototype.toJSON=function(){return{_viewpoint:{x:h.toPrecision(this.camera.position.x,4),y:h.toPrecision(this.camera.position.y,4),z:h.toPrecision(this.camera.position.z,4)},_rotation:{x:h.toPrecision(this.camera.quaternion.x,4),y:h.toPrecision(this.camera.quaternion.y,4),z:h.toPrecision(this.camera.quaternion.z,4),w:h.toPrecision(this.camera.quaternion.w,4)}}},d.touch={rotate:{start:function(a){this.state=l.TOUCH_ROTATE,this.rotateStart.set(a.touches[0].pageX,a.touches[0].pageY)},move:function(a){if(this.state===l.TOUCH_ROTATE){this.emit(j.Move,"touch");var b=a.currentTarget;this.rotateEnd.set(a.touches[0].pageX,a.touches[0].pageY),this.rotateDelta.subVectors(this.rotateEnd,this.rotateStart),this.rotateLeft(2*Math.PI*this.rotateDelta.x/b.clientWidth*this.rotateSpeed),this.rotateUp(2*Math.PI*this.rotateDelta.y/b.clientHeight*this.rotateSpeed),this.rotateStart.copy(this.rotateEnd)}}},zoom:{start:function(a){this.state=l.TOUCH_DOLLY_PAN;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY,d=Math.sqrt(b*b+c*c);this.dollyStart.set(0,d)},move:function(a){if(this.state===l.TOUCH_DOLLY_PAN){this.emit(j.Move,"touch");var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY,d=Math.sqrt(b*b+c*c);this.dollyEnd.set(0,d),this.dollyDelta.subVectors(this.dollyEnd,this.dollyStart),this.dollyDelta.y>0?this.dollyOut(1-this.dollyDelta.y/500):this.dollyIn(1+this.dollyDelta.y/500),this.dollyStart.copy(this.dollyEnd)}}},pan:{start:function(a){this.state=l.TOUCH_DOLLY_PAN,this.panStart.set(g.average(a.touches,"pageX"),g.average(a.touches,"pageY"))},move:function(a){this.state===l.TOUCH_DOLLY_PAN&&(this.emit(j.Move,"touch"),this.panEnd.set(g.average(a.touches,"pageX"),g.average(a.touches,"pageY")),this.panDelta.subVectors(this.panEnd,this.panStart),this.pan(this.panDelta.x,this.panDelta.y),this.panStart.copy(this.panEnd),this.rotateDelta.set(0,0))}}},b.exports=d},{"../conf":7,"../enum/ControlEvents":19,"../enum/Keys":25,"../util/common":145,"../util/math":154,events:170,three:177}],12:[function(a,b,c){(function(c){"use strict";function d(a){this.camera=a,this.camera.controls=this,this.target=new k.Vector3(0,0,0),this.lookVector=new k.Vector3,this.lookSpeed=.05,this.rotationAcc=new k.Vector2,this.rotationSpeed=new k.Vector2,this.lat=0,this.lon=0,this.phi=0,this.theta=0,this.enabled=!1,this.locked=!1,this.pointer=new k.Vector2(0,0),this.rotationHistory=[],this.rotationDifference=new k.Vector2,this.pointerDragOn=!1,this.pointerDragStart=new k.Vector2(0,0),this.pinchDistance=0,this.moveStart=new k.Vector2,this.moveTolerance=.01,this.pointersLimit=2,this.pointers=[],this.euler=new k.Euler,this.el=new k.Euler,this.q0=new k.Quaternion,this.q1=new k.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this.up=new k.Vector3(0,1,0),this.right=new k.Vector3(0,0,1),this.v=new k.Vector3,this.offsetLon=0,this.offsetLat=0,this.q3=new k.Quaternion}function e(){function a(){u=!1,(v||G.d.jumpingto3d)&&(f(),G.d.jumpingto3d=!1)}m.isCleanUI||(G.d.tourIsPlaying&&G.d.stopTour(),clearTimeout(j),j=null,u||(u=!0,$("#drawer").css("pointer-events","none"),$(".pinTop").css("pointer-events","none"),$(".pinBottom").css("pointer-events","none"),$("#rightbar").css("pointer-events","none"),$(".btn-cat-play").css("pointer-events","none"),$("#pinTopLeft, .pinBottom, #rightbar, .btn-cat-play").animate({opacity:0},{duration:m.barfadeAnimationDuration,complete:a}),$("#drawer").animate({opacity:0},{duration:2*m.barfadeAnimationDuration,complete:a}),$(".barrageSwitch").animate({left:"70px",width:"40px"},500,function(){$(this).css("display","none")}),$(".sendBarrage").animate({left:"70px",width:"40px"},500,function(){$(this).css("display","none"),$(".barrageControl").animate({opacity:".8"},500)}),$("#virgule").animate({top:"-16px",opacity:"0"},300),$("#barrageShow").animate({top:"9px",opacity:"0"},300)))}function f(){m.isCleanUI||u||(clearTimeout(j),j=setTimeout(function(){$("#pinTopLeft, .pinBottom, #rightbar, .btn-cat-play").animate({opacity:1},m.barfadeAnimationDuration),$("#drawer").animate({opacity:1},2*m.barfadeAnimationDuration,function(){$("#drawer").css("pointer-events","all"),$(".pinTop").css("pointer-events","all"),$(".pinBottom").css("pointer-events","all"),$("#rightbar").css("pointer-events","all"),$(".btn-cat-play").css("pointer-events","all")}),$("#virgule").animate({opacity:".3"},500),$("#barrageShow").animate({opacity:".8"},500)},600))}function g(){$("#meta-info").slideToggle(m.guiAnimationSpeed),$("#more-hint").toggle(),$("#less-hint").toggle()}function h(a){a&&(a.preventDefault(),a.stopPropagation())}function i(a){$("#model-title");a&&h(a),$("#meta-info").is(":visible")&&($("#title-toggle").find("i").toggleClass("icon-dpad-left icon-dpad-right"),g(),$(".title-container").animate({opacity:1},m.guiAnimationSpeed).animate({width:"hide"},{duration:m.guiAnimationSpeed}))}var j,k=a("three"),l=a("../util/logger"),m=a("../conf"),n=a("../util/common"),o=a("../util/math"),p=a("../enum/Vectors"),q=a("../enum/Keys"),r=a("../enum/ControlEvents"),s=a("events").EventEmitter,t=a("../util/browser"),u=(new l(c),!1),v=!1;d.prototype=Object.create(s.prototype),d.prototype.bindEvents=function(a){a.addEventListener("mousemove",this.onMouseMove.bind(this)),a.addEventListener("mousedown",this.onMouseDown.bind(this)),a.addEventListener("mouseup",this.onMouseUp.bind(this)),a.addEventListener("mouseover",function(a){!this.pointerDragOn||0!==a.which&&0!==a.buttons||this.onMouseUp(a)}.bind(this)),a.addEventListener("touchstart",this.onTouchStart.bind(this)),a.addEventListener("touchmove",this.onTouchMove.bind(this)),a.addEventListener("touchend",this.onTouchEnd.bind(this)),m.useWheel&&(a.addEventListener("mousewheel",this.onMouseWheel.bind(this)),a.addEventListener("DOMMouseScroll",this.onMouseWheel.bind(this))),a.addEventListener("contextmenu",function(a){a.preventDefault()}),a.addEventListener("pointerdown",this.onPointerDown.bind(this)),a.addEventListener("pointerup",this.onPointerUp.bind(this)),a.addEventListener("pointerout",this.onPointerUp.bind(this)),a.addEventListener("pointercancel",this.onPointerUp.bind(this)),a.addEventListener("pointermove",this.onPointerMove.bind(this)),a.addEventListener("keydown",this.onKeyDown.bind(this)),a.addEventListener("keyup",this.onKeyUp.bind(this))},d.prototype.usable=function(){return this.enabled&&!this.locked},d.prototype.lookAt=function(a){0==a.x&&-5==a.y&&0==a.z&&(a.z=-1);var b=this.camera.position.clone().sub(a),c=0;0==b.x&&0==b.y&&0==b.z&&(b.z=1),c=Math.atan(b.z/b.x),c+=b.x<0?Math.PI:0,c+=b.x>0&&b.z<0?2*Math.PI:0,this.lon=k.Math.radToDeg(c)+180;var d=Math.sqrt(b.x*b.x+b.z*b.z),e=0;e=Math.atan(b.y/d),this.lat=-k.Math.radToDeg(e)},d.prototype.startRotationFrom=function(a,b){o.convertScreenPositionToNDC(a,b,this.pointer),this.pointerDragOn=!0,this.pointerDragStart.copy(this.pointer),this.moveStart.copy(this.pointer),this.rotationHistory=[],this.rotationSpeed.set(0,0),this.disableOri()},d.prototype.disableOri=function(){G.ori.timeoutID&&clearTimeout(G.ori.timeoutID),G.ori.enable=!1},d.prototype.onTouchStart=function(a){if(this.usable()){switch(v=!1,e(),i(a),a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:this.startRotationFrom(a.touches[0].clientX,a.touches[0].clientY);break;case 2:var b=(a.touches[0].clientX-a.touches[1].clientX)/window.innerWidth,c=(a.touches[0].clientY-a.touches[1].clientY)/window.innerHeight;this.pinchDistance=Math.sqrt(b*b+c*c)}this.emit(r.InputStart,"touch")}},d.prototype.onPointerDown=function(a){this.usable()&&"touch"===a.pointerType&&(this.pointers.length<this.pointersLimit&&this.pointers.push({id:a.pointerId,clientX:a.clientX,clientY:a.clientY}),a.touches=this.pointers,this.onTouchStart(a),this.emit(r.InputStart,"pointer"))},d.prototype.onMouseDown=function(a){if(this.usable()){switch(v=!1,i(),e(),a.preventDefault(),a.stopPropagation(),a.button){case 0:this.startRotationFrom(a.clientX,a.clientY)}this.emit(r.InputStart,"mouse")}},d.prototype.updateRotation=function(){if(this.usable()&&this.pointerDragOn){var a=new k.Vector3(this.pointerDragStart.x,this.pointerDragStart.y,-1).unproject(this.camera),b=new k.Vector3(this.pointer.x,this.pointer.y,-1).unproject(this.camera),c=Math.sqrt(a.x*a.x+a.z*a.z),d=Math.sqrt(b.x*b.x+b.z*b.z),e=Math.atan2(a.y,c),f=Math.atan2(b.y,d);this.rotationDifference.y=k.Math.radToDeg(e-f),a.y=0,b.y=0;var g=Math.acos(a.dot(b)/a.length()/b.length());isNaN(g)||(this.rotationDifference.x=k.Math.radToDeg(g),this.pointerDragStart.x<this.pointer.x&&(this.rotationDifference.x*=-1)),this.pointerDragStart.copy(this.pointer)}},d.prototype.onMouseMove=function(a){this.usable()&&(o.convertScreenPositionToNDC(a.clientX,a.clientY,this.pointer),this.pointerDragOn&&(Math.abs(this.pointer.x-this.moveStart.x)>this.moveTolerance||Math.abs(this.pointer.y-this.moveStart.y)>this.moveTolerance)&&this.emit(r.Move,"mouse"))},d.prototype.onTouchMove=function(a){if(this.usable())switch(this.emit(r.Move,"touch"),a.touches.length){case 1:o.convertScreenPositionToNDC(a.touches[0].clientX,a.touches[0].clientY,this.pointer),this.disableOri();break;case 2:var b=(a.touches[0].clientX-a.touches[1].clientX)/window.innerWidth,c=(a.touches[0].clientY-a.touches[1].clientY)/window.innerHeight,d=this.pinchDistance-Math.sqrt(b*b+c*c);Math.abs(d)>.01&&(this.emit(r.InteractionDirect),this.emit(r.Pinch,d),this.pinchDistance-=d)}},d.prototype.onPointerMove=function(a){this.usable()&&"touch"===a.pointerType&&(this.pointers.forEach(function(b){a.pointerId===b.id&&(b.clientX=a.clientX,b.clientY=a.clientY)}),a.touches=this.pointers,this.onTouchMove(a))},d.prototype.endRotation=function(){this.pointerDragOn=!1;var a=n.averageVectors(this.rotationHistory);this.rotationSpeed.set(a.x*m.rotationAfterMoveMultiplier,a.y*m.rotationAfterMoveMultiplier),t.isIe.versions.trident||t.isEdge.versions.Edge||G.WeatherGo||(G.player.mattertagManager.wtposition(),null!==G.player.mattertagManager.activeWeatherTag&&null!==G.player.mattertagManager.activeTag&&G.player.mattertagManager.weatherOpenAudioEnd())},d.prototype.onTouchEnd=function(a){this.usable()&&(f(),v=!0,a.preventDefault(),a.stopPropagation(),this.endRotation())},d.prototype.onMouseUp=function(a){this.usable()&&(f(),v=!0,a.preventDefault(),a.stopPropagation(),this.endRotation())},d.prototype.onPointerUp=function(a){this.usable()&&"touch"===a.pointerType&&(this.pointers.forEach(function(b,c){a.pointerId===b.id&&this.pointers.splice(c,1)}.bind(this)),a.touches=this.pointers,this.onTouchEnd(a))},d.prototype.update=function(a){for(this.updateRotation(),this.rotationHistory.push(this.rotationDifference.clone());this.rotationHistory.length>m.rotationAfterMoveHistoryCount;)this.rotationHistory.shift();var b=this.lon,c=this.lat;G.ori.flag?(this.offsetLon+=this.rotationDifference.x,
this.offsetLat+=this.rotationDifference.y,this.rotationDifference.set(0,0),this.rotationSpeed.x=this.rotationSpeed.x*(1-m.rotationFriction)+this.rotationAcc.x*m.rotationAccelerationInside,this.rotationSpeed.y=this.rotationSpeed.y*(1-m.rotationFriction)+this.rotationAcc.y*m.rotationAccelerationInside,this.offsetLon+=this.rotationSpeed.x*a,this.offsetLat+=this.rotationSpeed.y*a,this.offsetLat=Math.max(m.insideLookLimitDown,Math.min(m.insideLookLimitUp,this.offsetLat)),G.ori.enable&&!G.playing&&(this.euler.set(G.ori.beta,G.ori.alpha,-G.ori.gamma,"YXZ"),this.q3=this.camera.quaternion.clone(),this.q3.setFromEuler(this.euler).multiply(this.q1),this.v.set(0,0,1).applyQuaternion(this.q3),this.lat=k.Math.radToDeg(this.v.angleTo(this.up)-Math.PI/2),this.v.set(1,0,0).applyQuaternion(this.q3),this.v.clone().cross(this.right).y>0?this.lon=360+k.Math.radToDeg(this.v.angleTo(this.right)):this.lon=360-k.Math.radToDeg(this.v.angleTo(this.right))),this.phi=k.Math.degToRad(90-(this.lat+this.offsetLat)),this.theta=k.Math.degToRad(this.lon+this.offsetLon),this.lookVector.x=Math.sin(this.phi)*Math.cos(this.theta),this.lookVector.y=Math.cos(this.phi),this.lookVector.z=Math.sin(this.phi)*Math.sin(this.theta),this.target.copy(this.lookVector).add(this.camera.position),this.camera.lookAt(this.target),G.ori.enable=!0):(this.lon+=this.rotationDifference.x,this.lat+=this.rotationDifference.y,this.rotationDifference.set(0,0),this.rotationSpeed.x=this.rotationSpeed.x*(1-m.rotationFriction)+this.rotationAcc.x*m.rotationAccelerationInside,this.rotationSpeed.y=this.rotationSpeed.y*(1-m.rotationFriction)+this.rotationAcc.y*m.rotationAccelerationInside,this.lon+=this.rotationSpeed.x*a,this.lat+=this.rotationSpeed.y*a,this.lat=Math.max(m.insideLookLimitDown,Math.min(m.insideLookLimitUp,this.lat)),this.phi=k.Math.degToRad(90-this.lat),this.theta=k.Math.degToRad(this.lon),this.lookVector.x=Math.sin(this.phi)*Math.cos(this.theta),this.lookVector.y=Math.cos(this.phi),this.lookVector.z=Math.sin(this.phi)*Math.sin(this.theta),this.target.copy(this.lookVector).add(this.camera.position),this.camera.lookAt(this.target)),$(".indoordir").css("transform","rotateZ("+(90+this.lon-k.Math.radToDeg(G.model.adjustCompass))%360+"deg)");var d=this.lon,e=this.lat;G.player.mattertagManager&&(!G.player.mattertagManager.ttflying&&o.compareFloats(b,d)&&o.compareFloats(c,e)||this.emit(r.TtagsMove))},d.prototype.onMouseWheel=function(a){if(this.usable()){var b=a.wheelDelta||-a.detail;this.emit(r.InteractionDirect),this.emit(r.Scroll,b)}},d.prototype.onKeyDown=function(a){this.usable()&&(a.metaKey||a.ctrlKey||(a.preventDefault(),this.handleKeyDown(a.which)))},d.prototype.handleKeyDown=function(a){var b=function(a){this.flyDirection(a)}.bind(this),c=function(a,b){this.rotationAcc[a]=b}.bind(this);this.emit(r.InteractionKey);var d=!0;switch(a){case q.UPARROW:case q.W:b(p.FORWARD);break;case q.DOWNARROW:case q.S:b(p.BACK);break;case q.A:b(p.LEFT);break;case q.D:b(p.RIGHT);break;case q.LEFTARROW:case q.J:c("x",-1);break;case q.RIGHTARROW:case q.L:c("x",1);break;case q.I:c("y",1);break;case q.K:c("y",-1);break;default:d=!1}d&&this.emit(r.Move,"key")},d.prototype.onKeyUp=function(a){this.usable()&&(a.preventDefault(),a.stopPropagation(),this.handleKeyUp(a.which))},d.prototype.handleKeyUp=function(a){switch(a){case q.LEFTARROW:case q.J:case q.RIGHTARROW:case q.L:this.rotationAcc.x=0;break;case q.I:case q.K:this.rotationAcc.y=0}},d.prototype.reset=function(){this.pointerDragOn=!1,this.rotationAcc.set(0,0),this.rotationSpeed.set(0,0),this.pointers=[]},d.prototype.flyDirection=function(a){this.emit(r.FlyInDirection,a.clone())},d.prototype.copy=function(a){this.target.copy(a.target),this.lookVector.copy(a.lookVector),this.lookSpeed=a.lookSpeed,this.rotationAcc.copy(a.rotationAcc),this.rotationSpeed.copy(a.rotationSpeed),this.lat=a.lat,this.lon=a.lon,this.phi=a.phi,this.theta=a.theta,this.enabled=a.enabled,this.locked=a.locked,this.pointer.copy(a.pointer),this.rotationHistory=a.rotationHistory.slice(),this.rotationDifference.copy(a.rotationDifference),this.pointerDragOn=a.pointerDragOn,this.pointerDragStart.copy(a.pointerDragStart),this.pinchDistance=a.pinchDistance,this.moveStart.copy(a.moveStart),this.moveTolerance=a.moveTolerance,this.pointersLimit=a.pointersLimit,this.pointers=a.pointers.slice()},d.prototype.toJSON=function(){return{_viewpoint:{x:o.toPrecision(this.camera.position.x,4),y:o.toPrecision(this.camera.position.y,4),z:o.toPrecision(this.camera.position.z,4)},_rotation:{x:o.toPrecision(this.camera.quaternion.x,4),y:o.toPrecision(this.camera.quaternion.y,4),z:o.toPrecision(this.camera.quaternion.z,4),w:o.toPrecision(this.camera.quaternion.w,4)}}},d.prototype.setStateFromJSON=function(a){this.camera.position.copy(a._viewpoint),this.camera.quaternion.copy(a._rotation)},b.exports=d}).call(this,"/js/controls/PanoramaControls.js")},{"../conf":7,"../enum/ControlEvents":19,"../enum/Keys":25,"../enum/Vectors":50,"../util/browser":142,"../util/common":145,"../util/logger":153,"../util/math":154,events:170,three:177}],13:[function(a,b,c){(function(c){"use strict";var d=a("three"),e=a("../enum/Viewmode"),f=a("../util/logger"),g=new f(c);b.exports={serialize:function(a){return encodeURI(JSON.stringify(a))},deserialize:function(a){try{var b=JSON.parse(decodeURI(a));return{mode:e.fromInt(b._type),panoId:b._locationid,position:(new d.Vector3).copy(b._viewpoint),quaternion:(new d.Quaternion).copy(b._rotation),zoom:b._zoom,floorVisibility:b.floor_visibility}}catch(b){g.debug("Not able to parse start location as JSON; falling back to old array style parsing");try{var c=a.split(","),f={x:parseFloat(c[2]),y:parseFloat(c[3]),z:parseFloat(c[4])},h={x:parseFloat(c[5]),y:parseFloat(c[6]),z:parseFloat(c[7]),w:parseFloat(c[8])};return{mode:e.fromInt(c[0]),panoId:c[1],position:(new d.Vector3).copy(f),quaternion:(new d.Quaternion).copy(h)}}catch(b){g.warn('Invalid start override, ignoring: "'+a+'"',b.message)}}return null}}}).call(this,"/js/controls/serializer.js")},{"../enum/Viewmode":51,"../util/logger":153,three:177}],14:[function(a,b,c){(function(c){"use strict";function d(){G.d=this,this.endlessLoop=g.warp.loop,this.clock=new e.Clock(!0),this.model=null,this.player=null,this.currentItem=null,this.destinationItem=null,this.tourIsPlaying=!1,this.transitionStage=v.None,this.nextFunc=null,this.onTheBus=!1,this.reachSource=null,this.interrupted=!1,this.nItems=0,this.currentScript=0,this.walkingSectionPaused=!1}var e=a("three"),f=a("./util/logger"),g=a("./conf"),h=a("./util/transitions"),i=a("events").EventEmitter,j=a("./enum/Viewmode"),k=a("./analytics"),l=a("./enum/WarpStyle"),m=(a("./util/transitions"),a("./model/ModelManager"),a("./enum/ModelManagerEvents")),n=a("./enum/DirectorEvents"),o=a("./enum/PlayerEvents"),p=a("./enum/ControlEvents"),q=a("./enum/BlackoutStyle"),r=a("./enum/PathDiscardMode"),s=a("./enum/PathDisplayMode"),t=a("./util/browser"),u=(a("./player"),new f(c)),v=Object.freeze({None:0,Moving:1,Aiming:2,Interlude:3}),w=Object.freeze({Forward:1,NoChange:0,Backwards:-1}),x=a("./enum/MediaType");d.prototype=Object.create(i.prototype),d.prototype.init=function(a,b){this.player=a,this.modelManager=b,this.updateModel(),this.resetAll(),this.bindEvents()},d.prototype.resetAll=function(){if(this.currentItem=null,this.destinationItem=null,this.tourIsPlaying=!1,this.transitionStage=v.None,this.nextFunc=null,this.onTheBus=!1,this.reachSource=null,this.interrupted=!1,this.model)switch(this.model.switch_scene_type){case 1:this.defaultWarpStyle=l.BLACK;break;case 2:this.defaultWarpStyle=l.WALK;break;case 3:this.defaultWarpStyle=l.STD;break;default:this.defaultWarpStyle=l.BLACK}else this.defaultWarpStyle=l.BLACK,u.warn('No model yet, choosing "'+this.defaultWarpStyle+'" transitions');this.resetSpecialTransition()},d.prototype.updateModel=function(){this.model=this.modelManager.getActiveModel(),this.nItems=this.model.heroLocations.length-1},d.prototype.bindEvents=function(){this.modelManager.on(m.ActiveModelChanged,this.updateModel.bind(this)),this.player.on(o.WarpInterruptedWithFlyTo,this.handleFlyToWarpInterruption.bind(this)),this.player.on(o.Move,this.handlePlayerMove.bind(this)),this.player.on(o.PanoChosen,this.handlePlayerPanoChosen.bind(this)),this.player.on(o.ModeChanged,this.handlePlayerModeChanged.bind(this)),this.player.on(o.InputStart,this.handlePlayerInputStart.bind(this)),this.player.on(o.FlyingStarted,this.handlePlayerFlyingStarted.bind(this))},d.prototype.handleFlyToWarpInterruption=function(a,b){a===l.WALK?(this.interrupt(q.FADEIN),this.pauseWalkingSection(),this.player.fastForwardActivePanoFlight()):this.transitionStage===v.Interlude&&(this.interrupt(q.NONE),b&&b())},d.prototype.handlePlayerMove=function(a){this.transitionStage===v.Interlude&&this.interrupt(q.NONE)},d.prototype.handlePlayerPanoChosen=function(a,b){this.intermediateState()||a.id===b.id||(this.onTheBus=!1,this.emit("update.controls"))},d.prototype.handlePlayerModeChanged=function(a,b){this.intermediateState()||a===b||(this.onTheBus=!1,this.emit("update.controls")),G.settings&&G.settings.basic.menu.compass_enable&&("floorplan"===b||"dollhouse"===b?($(".indoordir").hide(),$(".indoorscale").hide(),$(".compass").show()):"panorama"===b&&($(".compass").hide(),$("#play").hasClass("play")&&($(".indoordir").show(),$(".indoorscale").show())))},d.prototype.handlePlayerInputStart=function(a){this.transitionStage===v.Interlude&&this.interrupt(q.NONE)},d.prototype.handlePlayerFlyingStarted=function(){this.clearWalkingSectionPaused(),this.player.mattertagManager.ttflying=!0},d.prototype.describe=function(){return{nItems:this.nItems,currentItem:this.currentItem,destinationItem:this.destinationItem,tourIsPlaying:this.tourIsPlaying,onTheBus:this.onTheBus,endlessLoop:this.endlessLoop,viewMode:this.player.mode,inTransition:this._inTransition(),transitionStage:this.transitionStage}},d.prototype._inTransition=function(){return this.player.flying||this.player.isWarping()||this.player.mode===j.TRANSITIONING||this.tourIsPlaying},d.prototype.bounceable=function(){var a=this.clock.getDelta();return this.isInterrupted()||a<.9&&a>.01||this.player.flying&&!this.player.isWarping()},d.prototype.currentMoveDirection=function(){return null===this.currentItem||void 0===this.currentItem?w.Forward:this.destinationItem===this.currentItem?w.NoChange:this.destinationItem>this.currentItem?w.Forward:w.Backwards},d.prototype.clearPath=function(){this._inTransition()||this.player.path.discardPathObject()},d.prototype.allFloors=function(){var a=this.player.controls[this.player.mode];a&&a.emit("move","gui"),this.player.controls[j.PANORAMA].emit(p.InteractionGui,"floor-control"),this.model.toggleAllFloors()},d.prototype.openTag=function(){this.player.mattertagManager.closeTag(),null!==this.currentItem&&void 0!==this.currentItem||(this.currentItem=0);var a,b=!1,c=3e3,d=this.currentItem-G.d.sLen;if(d<0)return void console.log("error script order");if(this.model.catalogue&&this.model.catalogue.sequence&&this.model.catalogue.sequence[d]&&this.model.catalogue.sequence[d].tagid&&(b=!0),b){a=this.model.getTagByTagid(this.model.catalogue.sequence[d].tagid),this.player.mattertagManager.openTag(a),a.mediatype===x.Normal?c=1e3*this.model.catalogue.tagopentime:a.mediatype===x.Audio||a.mediatype===x.Video?c=1e3*this.model.catalogue.mediamaxtime:a.mediatype===x.IFrame&&(c=1e3*this.model.catalogue.iframemaxtime);var e,f=1,g=0,h=function(){if(console.log((new Date).getTime(),"media ended"),f&&(f=0,g&&clearTimeout(g),this.player.mattertagManager.closeTag(),this.nextFunc)){var a=this.nextFunc;this.nextFunc=null,a()}}.bind(this);g=setTimeout(function(){if(f&&(f=0,e&&e.removeEventListener("ended",h),this.player.mattertagManager.closeTag(),this.nextFunc)){var a=this.nextFunc;this.nextFunc=null,a()}}.bind(this),c),a.mediatype===x.Audio?(e=a.mediadiv)&&e.addEventListener("ended",h):a.mediatype===x.Video&&(e=a.mediadiv)&&e.addEventListener("ended",h)}else if(this.nextFunc){var i=this.nextFunc;this.nextFunc=null,i()}},d.prototype.actionComplete=function(a){var b=this.transitionStage;if(this.interrupted=!1,this.transitionStage=v.None,this.resetSpecialTransition(),null!==this.destinationItem&&this.setCurrentItem(this.destinationItem),this.tourIsPlaying||(this.player.disablePreRendering(),this.player.mode===j.PANORAMA&&this.player.currentPano.isAligned()&&this.model.fadePanoMarkers()),this.emit("update.controls"),this.currentScript&&(this.model.enableTagMovie&&b===v.Interlude||this.model.enableTagMovie&&b===v.Aiming&&null===this.nextFunc))this.openTag();else if(this.nextFunc){var c=this.nextFunc;this.nextFunc=null,c()}},d.prototype.awaitCompletion=function(a,b){this.nextFunc=b,a()},d.prototype.updateSuccessFunction=function(a){this.nextFunc=a},d.prototype.interrupt=function(a,b){return!(!this.wouldInterrupt()||!this.canInterrupt())&&(this.tourIsPlaying&&(this.player.zoomEnabled=this.wasZoomEnabled),this.tourIsPlaying=!1,this.interrupted=!0,this.nextFunc=null,$("#drawer-container").show(),$("#gui").show(),t.isMobile()?$(".btn-cat-play").removeClass("cat-mob-pause").addClass("cat-mob-play"):$(".btn-cat-play").removeClass("cat-pc-pause").addClass("cat-pc-play"),this.emit(n.ActionInterruped),null!==a&&void 0!==a||(a=q.BEGINNING),this.player.interruptAndFastForward(a,b),!0)},d.prototype.wouldInterrupt=function(){return this.transitionStage!==v.None},d.prototype.intermediateState=function(){return this.transitionStage!==v.None},d.prototype.isInterrupted=function(){return this.interrupted},d.prototype.canInterrupt=function(){return this.transitionStage!==v.Aiming&&this.transitionStage!==v.Moving||this.transitionStage===v.Moving&&this.player.mode===j.PANORAMA&&this.nextWarpStyle!==l.BLACK},d.prototype.pauseWalkingSection=function(){this.walkingSectionPaused=!0},d.prototype.clearWalkingSectionPaused=function(){this.walkingSectionPaused=!1},d.prototype.autoTour=function(){G.settings.nestscenes&&G.settings.nestscenes.scenes&&G.settings.nestscenes.scenes.length&&!G.settings.nestscenes.scenes[0].script&&(G.settings.basic.menu.scene_autoplay&&(g.warp.auto=0,$("#play").removeClass("play").addClass("pause"),G.playing=!0,$(".gui-floor").hide(),$(".rightbar").hide(),$("#page-view").hide(),$("#back-url").hide(),$(".indoordir, .indoorscale").hide(),$("#virgule, #barrageShow, #barrageCon").hide()),g.warp.auto>=0&&h.trigger({duration:1e3*Math.min(300,g.warp.auto),done:function(){this.playTour()}.bind(this),name:"_atr"}))},d.prototype.atDestinationPano=function(){if(!this.player.currentPano||null===this.destinationItem)return!1;var a=this.player.currentPano.id;if(void 0===a)return!1;var b=this.model.heroLocations;return null!==this.destinationItem&&void 0!==b[this.destinationItem]&&a==b[this.destinationItem].panoId},d.prototype.redirectToItem=function(a,b){if(null===a||void 0===a)return void u.warn("Director.redirectToItem() -> Redirecting to null item.");if(!this.wouldInterrupt())return void u.warn("Director.redirectToItem() -> Director cannot redirect if there is nothing to interrupt.");if(this.player.mode===j.TRANSITIONING)return void u.debug("Director.redirectToItem() -> Cannot redirect while transitioning.");u.debug("Director.redirectToItem() -> Redirecting to "+a+" via "+b);var c=function(){h.setTimeout(function(){this.setDestinationItem(a),console.log("from redirectToItem"),this.goToDestination(!0,q.BEGINNING,g.warp.warpInterruptionRedirectTime,!1)}.bind(this),0)}.bind(this);this.interrupt(q.END,0),this.updateSuccessFunction(c)},d.prototype.useSpecialTransition=function(a){void 0!==a&&this.defaultWarpStyle!==l.BLACK&&u.debug("useSpecialTransition(): "+a),this.nextWarpStyle=this.defaultWarpStyle},d.prototype.resetSpecialTransition=function(){this.nextWarpStyle=this.defaultWarpStyle},d.prototype.arrivedAtDestination=function(a){if(this.player.flying||this.player.isWarping())u.warn("Cannot advance to interlude or aiming while player is flying or warping.");else{this.transitionStage=v.Aiming;var b=this.tourIsPlaying?this.tourInterlude.bind(this,this.nextItem(this.currentItem)):null;this.player.model.fadePanoMarkers(0),this.tour360view(),this.awaitCompletion(function(){this.resetSpecialTransition(),a?this.player.aimTourCamera(this.destinationItem,s.Hide,r.Slow,this.actionComplete.bind(this)):this.actionComplete()}.bind(this),b)}this.player.mattertagManager.wtposition()},d.prototype.toast=function(a){setTimeout(function(){document.getElementsByClassName("toast-wrap")[0].getElementsByClassName("toast-msg")[0].innerHTML=a;var b=document.getElementsByClassName("toast-wrap")[0];b.className=b.className.replace("toastAnimate",""),setTimeout(function(){b.className=b.className+" toastAnimate"},10)},10)},d.prototype.tour360view=function(){var a=this.model;if(this.player.currentPano&&2===this.player.currentPano.alignmentType){var b=a.language;this.toast(b.watchPr)}else $("#play").hasClass("play")},d.prototype.goToDestination=function(a,b,c,d){if(this.player.mattertagManager.activeWeatherTag=null,this.player.mattertagManager.weatherHide(),this.onTheBus=!0,this.emit("update.controls"),this.player.updateLastView(),!d&&this.atDestinationPano())return void this.arrivedAtDestination(!0);if(this.player.flying||this.player.isWarping())u.warn("Cannot go to new destination while player is flying or warping.");else{var e=this.model.getHeroDescriptorByIndex(this.destinationItem),f=null,g=null;if(console.log("goToDestination"),this.player.mattertagManager.update360Tags(e.panoId),e.isPano()){var h=0===this.destinationItem||a?l.BLACK:this.nextWarpStyle;g=this.player.warpToPanoByHeroIndex.bind(this.player,this.destinationItem,s.Show,r.Slow,h,b,c,this.actionComplete.bind(this)),f=this.arrivedAtDestination.bind(this,!0)}else g=this.player.warpToNonPanoByHeroIndex.bind(this.player,this.destinationItem,this.actionComplete.bind(this)),f=this.arrivedAtDestination.bind(this,!1);this.transitionStage=v.Moving,this.model.fadePanoMarkers(0),this.awaitCompletion(function(){g()}.bind(this),f),this.emit("update.controls")}},d.prototype.tourInterlude=function(){if(k.trackAlways("USER",{event_type:"reach_highlight",reach_source:this.reachSource}),this.model.fadePanoMarkers(0),this.emit("update.controls"),this.tourIsPlaying)return this.atEndOfTour()&&!this.endlessLoop?(this.stopTour(),void(this.player.mode===j.PANORAMA&&this.model.fadePanoMarkers(g.panorama.markerOpacity))):void this.awaitCompletion(function(){this.transitionStage=v.Interlude,this.player.tourInterlude(this.nextItem(this.currentItem),this.actionComplete.bind(this))}.bind(this),this.goNext.bind(this))},d.prototype.playTour=function(){var a=this.model,b=G.settings.nestscenes.scenes;if(console.log("start play"),b.length>0&&1!==b[0].script&&1!==a.switch_scene_type&&$("#multiplier-speed").fadeIn(300),!this.bounceable())return this.tourIsPlaying?void u.info("tour is already playing"):void(this.wouldInterrupt()||(this.player.emit("tour_auto",this.defaultWarpStyle),this.reachSource="play",this.tourIsPlaying=!0,this.wasZoomEnabled=this.player.zoomEnabled,this.player.zoomEnabled=!1,this.resetSpecialTransition(),this.emit("update.controls"),this.player.enablePreRendering(),this.walkingSectionPaused?(this.clearWalkingSectionPaused(),console.log("from playTour"),this.goToDestination()):this.goNext()))},d.prototype.hideTourBar=function(){t.isMobile()?$(".btn-cat-play").removeClass("cat-mob-pause").addClass("cat-mob-play"):$(".btn-cat-play").removeClass("cat-pc-pause").addClass("cat-pc-play"),$("#gui").show()},d.prototype.stopTour=function(){console.log("stopTour"),this.emit("tourStop"),this.isInterrupted()||(this.tourIsPlaying&&(this.player.zoomEnabled=this.wasZoomEnabled),this.tourIsPlaying=!1,this.interrupt(),this.clearWalkingSectionPaused(),this.resetSpecialTransition(),this.emit("update.controls")),this.openTag(),this.hideTourBar(),this.player.mattertagManager.hideShowTagsForBlackoutStyle(q.FADEIN,1e3)},d.prototype.goToHighlight=function(a){if(this.player.mattertagManager.activeWeatherTag=null,this.player.mattertagManager.weatherHide(),this.canInterrupt()||!this.wouldInterrupt()){if(this.wouldInterrupt()&&(a===this.destinationItem?this.interrupt():this.redirectToItem(a,"goToHighlight")),this.isInterrupted())return void console.log("canceled");this.clearWalkingSectionPaused(),this.setDestinationItem(a),this.useSpecialTransition("Hilight"),this.goToDestination(),k.trackAlways("USER",{event_type:"reach_highlight",reach_source:"thumb"})}},d.prototype.goToHighlightByLocation=function(a){function b(b){return!(!b.panoId||b.panoId!=a)}var c=this.model.heroLocations.findIndex(b);if(this.canInterrupt()||!this.wouldInterrupt()){if(u.debug("<tour.goto "+c+">"),this.wouldInterrupt()&&(c===this.destinationItem?this.interrupt():this.redirectToItem(c,"goToHighlight")),this.isInterrupted())return;this.clearWalkingSectionPaused(),this.setDestinationItem(c),this.useSpecialTransition("Hilight"),this.goToDestination(),k.trackAlways("USER",{event_type:"reach_highlight",reach_source:"thumb"})}},d.prototype.prevHighlight=function(){this.bounceable()||(this.player.emit("tour_manual","prev"),this.interrupt(q.BEGINNING)||this.isInterrupted()||(this.clearWalkingSectionPaused(),this.reachSource="prev",this.goPrev()))},d.prototype.nextHighlight=function(){this.bounceable()||(this.player.emit("tour_manual","next"),this.interrupt(q.BEGINNING)||this.isInterrupted()||(this.clearWalkingSectionPaused(),this.reachSource="next",this.goNext()))},d.prototype.changeMode=function(a,b){var c=b||"gui";switch(this.wouldInterrupt()&&this.interrupt(),this.player.controls[a].emit("interaction."+c),this.clearWalkingSectionPaused(),a){case j.PANORAMA:this.player.insideMode();break;case j.DOLLHOUSE:case j.FLOORPLAN:this.player.flyToNewMode({mode:a})}},d.prototype.atEndOfTour=function(){return this.currentItem>=this.nItems-1},d.prototype.firstDestination=function(){if(this.nItems<=0)return null;for(var a=0;a<this.nItems;a++)if(this.model.images.list[a].script===this.currentScript)return a;return 0},d.prototype.finalDestination=function(){if(this.nItems<=0)return null;for(var a=this.nItems-1;a>=0;a--)if(this.model.images.list[a].script===this.currentScript)return a;return 0},d.prototype.goPrev=function(){this.tourAdvance(-1)},d.prototype.goNext=function(){null===this.currentItem&&(this.currentItem=this.finalDestination());for(var a,b=!1,c=this.currentItem+1;c<this.nItems;c++)if(this.model.images.list[c].script===this.currentScript){a=c-this.currentItem,b=!0;break}b||(a=this.nItems-this.currentItem),0===a&&(a=1),this.tourAdvance(a)},d.prototype.setDestinationItem=function(a){a>this.nItems&&(a=this.firstDestination()),this.destinationItem=a,this.emit("update.controls")},d.prototype.setCurrentItem=function(a){this.currentItem=a,this.emit("update.controls")},d.prototype.nextItem=function(a){return null===a?this.firstDestination():a>=this.nItems-1?this.endlessLoop?this.firstDestination():null:a+1},d.prototype.prevItem=function(a){return null===a?this.firstDestination():a<0?this.endlessLoop?this.lastDestination():null:a-1},d.prototype.tourAdvance=function(a){u.debug("tourAdvance("+a+")"),null===this.currentItem||void 0===this.currentItem?this.setDestinationItem(this.firstDestination()):this.setDestinationItem(this.currentItem+a),this.destinationItem<0?(this.setDestinationItem(this.finalDestination()),this.useSpecialTransition("reverse-looping to end")):this.destinationItem>=this.nItems&&(this.setDestinationItem(this.firstDestination()),this.useSpecialTransition("looping back to start")),this.goToDestination()},d.prototype.compassAdd=function(a){G.model.adjustCompass+=a,$("#nest_rotate_value").text(G.model.adjustCompass.toFixed(2))},d.prototype.compassReset=function(a){G.model.adjustCompass=a,$("#nest_rotate_value").text(G.model.adjustCompass.toFixed(2))},b.exports=d}).call(this,"/js/director.js")},{"./analytics":2,"./conf":7,"./enum/BlackoutStyle":17,"./enum/ControlEvents":19,"./enum/DirectorEvents":20,"./enum/MediaType":29,"./enum/ModelManagerEvents":30,"./enum/PathDiscardMode":35,"./enum/PathDisplayMode":36,"./enum/PlayerEvents":38,"./enum/Viewmode":51,"./enum/WarpStyle":52,"./model/ModelManager":103,"./player":121,"./util/browser":142,"./util/logger":153,"./util/transitions":162,events:170,three:177}],15:[function(a,b,c){"use strict";var d=a("three"),e=a("./enum/Viewmode"),f=(a("./conf"),a("./util/transitions")),g=a("./enum/PlayerEvents"),h=new d.ShaderPass(d.HorizontalBlurShader),i=new d.ShaderPass(d.VerticalBlurShader);i.renderToScreen=!0;var j=window.innerWidth/window.innerHeight;isNaN(j)&&(j=1);var k={currentBlur:0,aspect:j,blurStrength:1,hblurPass:h,vblurPass:i,bindEvents:function(a){a.on(g.ModeChanged,function(a,b){a===e.PANORAMA&&(f.cancel(k.blur),f.cancel(k.addBlur),f.start(k.removeBlur,500,null,0,null,"deblur"))})},blur:function(a){k.currentBlur=a;var b=a*k.blurStrength;i.uniforms.v.value=b/512*k.aspect,h.uniforms.h.value=b/512},addBlur:function(a){a=Math.max(a,k.currentBlur),k.blur(a)},removeBlur:function(a){a=Math.min(1-a,k.currentBlur),k.blur(a)}};k.blur(0),b.exports=k},{"./conf":7,"./enum/PlayerEvents":38,"./enum/Viewmode":51,"./util/transitions":162,three:177}],16:[function(a,b,c){"use strict";b.exports={UNKNOWN:0,ALIGNED:1,UNALIGNED:2,PLACED:3}},{}],17:[function(a,b,c){"use strict";b.exports={NONE:0,MIDDLE:1,END:2,BEGINNING:3,FADEIN:4}},{}],18:[function(a,b,c){"use strict";var d=a("three");b.exports={newBlue:new d.Color("#28eff5"),altBlue:new d.Color(47355),classicBlue:new d.Color(53759),mpYellow:new d.Color(16502016),mpOrange:new d.Color(16428055),mpBlue:new d.Color(12096),mpLtGrey:new d.Color(13751252),mpDkGrey:new d.Color(10000019),mpRed:new d.Color(12525854),mpOrangeDesat:new d.Color(16764529),mpBlueDesat:new d.Color(4034734),mpRedDesat:new d.Color(14705505),white:new d.Color(16777215),black:new d.Color(0),_desat:function(a,b){var c=b||.3,e=(new d.Color).copy(a).getHSL();return(new d.Color).setHSL(e.h,e.s*(1-c),e.l)},_darken:function(a,b){var c=b||.2,e=(new d.Color).copy(a).getHSL();return(new d.Color).setHSL(e.h,e.s,e.l*(1-c))}}},{three:177}],19:[function(a,b,c){"use strict";b.exports={Move:"move",InteractionDirect:"interaction.direct",InteractionKey:"interaction.key",InteractionGui:"interaction.gui",FlyInDirection:"fly.direction",InputStart:"input.start",Pinch:"input.pinch",Scroll:"input.scroll",HideEvent:"panorama.move",RulersMove:"rulers.move",RulersWalk:"rulers.walk",TtagsMove:"titletag.move"}},{}],20:[function(a,b,c){"use strict";b.exports={ActionInterrupted:"action.interrupted"}},{}],21:[function(a,b,c){"use strict";b.exports=Object.freeze({None:0,Queued:1,ForceQueued:2,Downloading:3,Downloaded:4,DownloadFailed:5})},{}],22:[function(a,b,c){"use strict";b.exports={GL_TEXTURE_CUBE_MAP_POSITIVE_X:0,GL_TEXTURE_CUBE_MAP_NEGATIVE_X:1,GL_TEXTURE_CUBE_MAP_POSITIVE_Y:2,GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:3,GL_TEXTURE_CUBE_MAP_POSITIVE_Z:4,GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:5}},{}],23:[function(a,b,c){"use strict";b.exports={Texture2D:0,TextureCube:1}},{}],24:[function(a,b,c){"use strict";var d={UP:1,DOWN:-1,LEFT:"L",RIGHT:"R",FORWARD:"F",BACK:"B",reverse:{},opposite:function(a){return this.reverse[a.toString()]}};!function(){d.reverse[d.UP]=d.DOWN,d.reverse[d.DOWN]=d.UP,d.reverse[d.LEFT]=d.RIGHT,d.reverse[d.RIGHT]=d.LEFT,d.reverse[d.FORWARD]=d.BACK,d.reverse[d.BACK]=d.FORWARD}(),b.exports=d},{}],25:[function(a,b,c){"use strict";b.exports={ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,SPACE:32,RETURN:13,PLUSEQUALS:187,DASHUNDERSCORE:189,OPENBRACKET:219}},{}],26:[function(a,b,c){"use strict";b.exports={Chinese:0,English:1,Japanese:2}},{}],27:[function(a,b,c){"use strict";b.exports={NAVIGATION:"navigation",MODEL:"model",EXT_LINK:"ext-link"}},{}],28:[function(a,b,c){"use strict";b.exports={TagActivated:"tag.activated",TagDismissed:"tag.dismissed",TagNavigation:"tag.navigation"}},{}],29:[function(a,b,c){"use strict";b.exports={Normal:0,Audio:1,Video:2,IFrame:3}},{}],30:[function(a,b,c){"use strict";b.exports={ModelAdded:"model-added",ActiveModelChanged:"active-model-changed"}},{}],31:[function(a,b,c){"use strict";b.exports={GAODE:1,GOOGLE:2}},{}],32:[function(a,b,c){"use strict";b.exports={PanoRenderComplete:"panorama.render.complete",TileRenderFailure:"panorama.tile.render.failed",TileRenderSuccess:"panorama.tile.render.success",TileUploadAttempted:"panorama.tile.upload.attempted",UploadAttemptedForAllTiles:"panorama.upload.attempted.all.tiles"}},{}],33:[function(a,b,c){"use strict";b.exports={BASE:1,STANDARD:2,HIGH:3,ULTRAHIGH:4}},{}],34:[function(a,b,c){"use strict";b.exports={LoadComplete:"panorama.load.complete",LoadFailed:"panorama.load.failed",TileLoaded:"panorama.tile.loaded"}},{}],35:[function(a,b,c){"use strict";b.exports=Object.freeze({Standard:0,Slow:1,Retain:2})},{}],36:[function(a,b,c){"use strict";b.exports=Object.freeze({Show:0,Hide:1,Retain:2})},{}],37:[function(a,b,c){"use strict";b.exports={Default:0,Fastmovie:1,Catalogue:2}},{}],38:[function(a,b,c){"use strict";b.exports={Move:"move",MoveComplete:"move.complete",ModeChanged:"mode.changed",ModeChanging:"mode.changing",PanoChosen:"pano.chosen",ClosestPanoChanging:"closest.pano.changing",WarpStarted:"warp.started",WarpInterrupted:"warp.interrupted",WarpEnded:"warp.ended",FlyingStarted:"flying.started",FlyingInterrupted:"flying.interrupted",FlyingEnded:"flying.ended",Ready:"ready",StartInside:"start.inside",StartOutside:"start.outside",ViewChanged:"view.changed",WarpInterruptedWithFlyTo:"warp.interrupted.flyto",InputStart:"input.start",EditAddTagHighlight:"edit.add.taghighlight"}},{}],39:[function(a,b,c){"use strict";b.exports={visibleFloor:1,ghostFloor:3,boundingSkybox:1,panoMarker:2,reticule:3,mattertagDisc:1,mattertagCutout:2,mattertagStem:3,ribbon:100}},{}],40:[function(a,b,c){"use strict";b.exports={ContextCreated:"scene-renderer-context-created",AfterRender:"after-render",MemoryUsageUpdated:"scene-renderer-memory-usage-updated"}},{}],41:[function(a,b,c){"use strict";b.exports={STAY3D:1,FLYTOPANO:2,STARTPANO:3}},{}],42:[function(a,b,c){"use strict";b.exports={Pic:1,Text:2,GIF:3}},{}],43:[function(a,b,c){"use strict";b.exports={IDLE:"idle",BROWSE:"browse",EXAMINE:"examine"}},{}],44:[function(a,b,c){"use strict";b.exports={BuildingType:0,TextOnly:1,ImageText:2,Audio:4,OtherModel:5,TextAudio:6,ImageTextAudio:7,IFrame:8,Tag360T1:9,TagTo360:10,Video:11,Title:12,ClassifyType:{Indoor:1,Building:2},EW:101,IKEA:102,Pano:9e3,Tag360:36,Commodity:37,PanoVideo:38,WeatherTag:39}},{}],45:[function(a,b,c){"use strict";b.exports={TileDownloadSuccess:"tiledownloader.download.success",TileDownloadFailure:"tiledownloader.download.failure",PanoDownloadComplete:"tiledownloader.pano.download.complete"}},{}],46:[function(a,b,c){"use strict";b.exports={Cardboard:"googlevr",GearVR:"gearvr"}},{}],47:[function(a,b,c){"use strict";b.exports={NONE:0,CONTEXTUAL:1,ANDROID:2}},{}],48:[function(a,b,c){"use strict";var d={Title:1,Cardboard:2,Gear:3};d.LastPage=Object.keys(d).length,d.AfterLastPage=d.LastPage+1,b.exports=d},{}],49:[function(a,b,c){"use strict";b.exports={Android:"android",IOS:"ios",Desktop:"desktop",UnsupportedAndroid:"android-unsupported"}},{}],50:[function(a,b,c){"use strict";var d=a("three");b.exports={UP:new d.Vector3(0,1,0),DOWN:new d.Vector3(0,-1,0),LEFT:new d.Vector3(-1,0,0),RIGHT:new d.Vector3(1,0,0),FORWARD:new d.Vector3(0,0,-1),BACK:new d.Vector3(0,0,1)}},{three:177}],51:[function(a,b,c){"use strict";var d=a("../exception/ViewmodeConvertException");b.exports={PANORAMA:"panorama",DOLLHOUSE:"dollhouse",FLOORPLAN:"floorplan",MESH:"mesh",OUTDOOR:"outdoor",TRANSITIONING:"transitioning",toInt:function(a){switch(a){case this.PANORAMA:return 1;case this.DOLLHOUSE:return 2;case this.FLOORPLAN:return 3;case this.OUTDOOR:return 4;case this.TRANSITIONING:return-1}throw new d("No known conversion for Viewmode to int for mode: "+a)},fromInt:function(a){switch(a){case"1":case 1:return this.PANORAMA;case"2":case 2:return this.DOLLHOUSE;case"3":case 3:
return this.FLOORPLAN;case"4":case 4:return this.OUTDOOR}throw new d("No known conversion for int to viewmode for int: "+a)},convertWorkshopModeInt:function(a){switch(a){case"0":case 0:return this.PANORAMA;case"1":case 1:return this.FLOORPLAN;case"2":case 2:return this.DOLLHOUSE;case"3":case 3:return this.MESH}throw new d("No known conversion for Workshop int to viewmode for int: "+a)}}},{"../exception/ViewmodeConvertException":57}],52:[function(a,b,c){"use strict";b.exports={BLACK:"black",STD:"std",WALK:"walk"}},{}],53:[function(a,b,c){"use strict";b.exports={ZoomIn:"zoom.in",ZoomOut:"zoom.out",ZoomMax:"zoom.max",ZoomMin:"zoom.min"}},{}],54:[function(a,b,c){"use strict";function d(a){this.message=a}b.exports=d},{}],55:[function(a,b,c){"use strict";function d(a){e.call(this,a)}var e=a("./BasicException");d.prototype=Object.create(e.prototype),b.exports=d},{"./BasicException":54}],56:[function(a,b,c){arguments[4][55][0].apply(c,arguments)},{"./BasicException":54,dup:55}],57:[function(a,b,c){arguments[4][55][0].apply(c,arguments)},{"./BasicException":54,dup:55}],58:[function(a,b,c){function d(){}var e=a("events").EventEmitter,f=a("../util/browser"),g=a("../util/cookie"),h=a("./buryPoint"),i=a("../enum/LanguageType"),j=a("../conf"),k=a("../util/statistic_utils"),l=h[window.location.hostname];d.prototype=Object.create(e.prototype),d.prototype.init=function(a){function b(){return"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)}if(!a.oauth)return!1;this.modelid=f.valueFromHash("m"),this.barrageChange=!0,this.one_load=!1,this.i=0,this.innerheight=window.innerHeight;var c=this;$.get("https://user.3dnest.cn/wx/comment/?m="+this.modelid,function(a){c.barrageArr=a,c.barrageArr.forEach(function(a){a.headimgurl=a.headimgurl.replace(/http:/,"https:")}),c.barrage_load()}),f.isMobile()&&$("#virgule, #barrageShow").css("display","block"),$(".barrageControl").on("click",function(){l&&G._hmt&&(G._hmt.push(["_trackEvent",l[24].desc,h.trigger,h.modelid]),G._hmt.push(["'"+h.type.custom+"'","'"+l[24].id+"'","'"+h.modelid+"'"]),k.trackEvent(56)),c.barrage_control()}),$(".barrageSwitch, #barrage-switch").on("click",function(){l&&G._hmt&&(G._hmt.push(["_trackEvent",l[25].desc,h.trigger,h.modelid]),G._hmt.push(["'"+h.type.custom+"'","'"+l[25].id+"'","'"+h.modelid+"'"])),c.barrage_control(),c.barrage_switch()}),$(".sendBarrage").on("click",function(){if(l&&G._hmt&&(G._hmt.push(["_trackEvent",l[26].desc,h.trigger,h.modelid]),G._hmt.push(["'"+h.type.custom+"'","'"+l[26].id+"'","'"+h.modelid+"'"]),k.trackEvent(58)),c.barrage_control(),!b())return c.toast(a.language.barrage.reminder),!1;$(".comment").css("display","block"),$(".help_back").css("display","block")}),$(".comment").on("keyup",function(a){a.stopPropagation()}).on("keydown",function(a){a.stopPropagation()}),$(".commentBtn").on("click",function(){l&&G._hmt&&(G._hmt.push(["_trackEvent",l[27].desc,h.trigger,h.modelid]),G._hmt.push(["'"+h.type.custom+"'","'"+l[27].id+"'","'"+h.modelid+"'"]),k.trackEvent(59)),c.barrage_commit()}),$(".commentClose").on("click",function(){l&&G._hmt&&(G._hmt.push(["_trackEvent",l[28].desc,h.trigger,h.modelid]),G._hmt.push(["'"+h.type.custom+"'","'"+l[28].id+"'","'"+h.modelid+"'"]),k.trackEvent(60)),$(".comment").css("display","none"),$(".help_back").css("display","none")}),$(window).resize(function(){"block"===$("#barrageCon").css("display")&&f.isMobile()&&window.innerHeight!==c.innerheight&&($("#barrageCon").empty(),c.barrage_load())}),f.isMobile()&&a.mlanguage_type===i.Japanese&&($(".barrageSwitch p").css({width:"58px",left:"9px"}),$(".barrage-switch").css({left:"56px"}),$(".sendBarrage p").css({width:"58px",right:"9px"}),$(".barrage-send").css({right:"56px"})),document.addEventListener("visibilitychange",function(){document.hidden?f.isMobile()||$("#barrage-switch").hasClass("barrage-on")&&c.barrageclose():f.isMobile()||$("#barrage-switch").hasClass("barrage-on")&&c.barrage_load()})},d.prototype.clearAll=function(){var a=this;clearTimeout(a.looper),$.fn.barrager.removeAll()},d.prototype.load2=function(){function a(){"pc"===d()?speed=b(15e3,2e4):speed=(d(),b(15e3,2e4)),speed/=1e3;var f="pc"===d()?b(60,500):c(),g={img:e.barrageArr[l].headimgurl,info:e.barrageArr[l].content,close:!1,speed:speed,bottom:window.innerHeight-f,color:"#fff"};$("body").barrager(g),l=(l+1)%k,e.looper=setTimeout(a,i)}function b(a,b){var c=b-a,d=Math.random();return a+Math.round(d*c)}function c(){return h+=j,n="landscape"===d()?2*j:3*j,h>.1*g+n&&(h=.1*g+j),h}function d(){return f.isMobile()?$(window).width()/$(window).height()>1?"landscape":"portrait":"pc"}var e=this;if(!e.barrageArr||!e.barrageArr.length)return!1;var g=parseInt($(window).height()),h=parseInt(.1*g),i="portrait"===d()?8e3:1e4,j=40,k=e.barrageArr.length,l=0;e.barrageArr.length<=5&&(i=8e3),a()},d.prototype.barrage_load=function(){function a(){var a=m.length;if(0!=a){var f=m[e.i].content,g=parseInt($(window).width())+30,h="pc"===d()?b(60,500):c(),i=$("<div class='barrage' ><img class='barrageImg' src="+m[e.i].headimgurl+"></img><p class='barrageText' identifying='"+m[e.i].identifying+"'></p></div>");$("#barrageCon").append(i),$(".barrageText").each(function(a){"true"===$(this).attr("identifying")&&$(this).addClass("identifying")}),$(".barrageText").last().text(f),$(".barrage").last().css({left:g+"px",top:h+"px"}).animate({left:"-900px"},l,function(){$(this).remove()}),e.i++,e.one_load=!0,e.i>=a&&(e.i=0)}}function b(a,b){var c=b-a,d=Math.random();return a+Math.round(d*c)}function c(){return i+=n,g="landscape"===d()?2*n:3*n,i>.1*h+g&&(i=.1*h+n),i}function d(){return f.isMobile()?$(window).width()/$(window).height()>1?"landscape":"portrait":"pc"}var e=this;if(j.newbarrage)e.clearAll(),$.get("https://user.3dnest.cn/wx/comment/?m="+this.modelid,function(a){e.barrageArr=a,e.barrageArr.forEach(function(a){a.headimgurl=a.headimgurl.replace(/http:/,"https:")}),e.load2()});else{$("#barrageCon").css("display","block");var g,h=parseInt($(window).height()),i=parseInt(.1*h),k="portrait"===d()?3e3:5e3,l="portrait"===d()?b(15e3,25e3):b(25e3,35e3),m=this.barrageArr,n=80;if(this.one_load||!this.barrageArr)return!1;"pc"===d()&&(l=b(38e3,45e3)),a(),m.length<=5&&(k=8e3),this.timer=setInterval(function(){a()},k)}},d.prototype.barrage_control=function(){"none"===$(".sendBarrage").css("display")?($(".barrageSwitch, .sendBarrage").css("display","block"),$("#barrageShow").animate({top:"25px"},500),$("#virgule").animate({top:"0px"},500),$(".barrageSwitch").animate({left:"-24px",width:"118px"},500),$(".sendBarrage").animate({left:"86px",width:"118px"},500),$(".barrageControl").animate({opacity:"1"},10)):($(".barrageSwitch").animate({left:"70px",width:"40px"},500,function(){$(this).css("display","none")}),$(".sendBarrage").animate({left:"70px",width:"40px"},500,function(){$(this).css("display","none"),$(".barrageControl").animate({opacity:".8"},500)}),$("#virgule").animate({top:"-16px"},500),$("#barrageShow").animate({top:"9px"},500))},d.prototype.barrage_switch=function(){var a=$(".barrage-switch");f.isMobile()?this.barrageChange?(this.barrageChange=!1,a.removeClass("iconDanmuOn").addClass("iconDanmuOff"),this.barrageclose(),k.trackEvent(61)):(this.barrageChange=!0,a.removeClass("iconDanmuOff").addClass("iconDanmuOn"),this.barrage_load(),k.trackEvent(57)):$("#barrage-switch").hasClass("barrage-on")?($("#barrage-switch").removeClass("barrage-on").addClass("barrage-off"),this.barrageclose(),k.trackEvent(61)):$("#barrage-switch").hasClass("barrage-off")&&($("#barrage-switch").removeClass("barrage-off").addClass("barrage-on"),this.barrage_load(),k.trackEvent(57))},d.prototype.barrage_commit=function(){var a=this,b=g.getOauth("openid"),c=this.modelid,d=$(".barrage-switch"),e=$(".commentDet").val();if($(".commentDet").val(""),$(".comment").css("display","none"),$(".help_back").css("display","none"),!e)return!1;e.length>30&&(e=e.substring(0,30)+"..."),a.barrageChange=!0,a.barrage_load(),$.post("https://user.3dnest.cn/wx/comment/m="+c,{openid:b,m:c,con:e},function(b){b.code,a.barrageArr.splice(a.i,0,{headimgurl:b.imgurl,content:e,identifying:!0}),d.removeClass("iconDanmuOff").addClass("iconDanmuOn")})},d.prototype.toast=function(a){setTimeout(function(){document.getElementsByClassName("toast-wrap")[0].getElementsByClassName("toast-msg")[0].innerHTML=a;var b=document.getElementsByClassName("toast-wrap")[0];b.className=b.className.replace("toastAnimate",""),setTimeout(function(){b.className=b.className+" toastAnimate"},10)},10)},d.prototype.barrageclose=function(){var a=this;j.newbarrage?($("#barrageCon").css("display","none"),a.clearAll()):$("#barrageCon").css("display","none")},b.exports=d},{"../conf":7,"../enum/LanguageType":26,"../util/browser":142,"../util/cookie":146,"../util/statistic_utils":158,"./buryPoint":59,events:170}],59:[function(a,b,c){"use strict";function d(a,b){var c=new RegExp("[#&?]"+a+"=([^#&?]*)"),d=c.exec(window.location.href);if(!d)return b;var e=d[1];return"boolean"==typeof b?"true"===e||"1"===e:"number"==typeof b?parseFloat(e):window.decodeURIComponent(e)}var e=function(){return d("model")||d("m")}();b.exports={type:{incident:"_trackEvent",custom:"_setUserTag"},trigger:"click",modelid:e,"beyond.3dnest.cn":[{id:"1898",desc:"场景条切换"},{id:"1899",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1900",desc:"场景播放"},{id:"1901",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1902",desc:"地图按钮"},{id:"1903",desc:"网站总pv"},{id:"1904",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1905",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1906",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1907",desc:"弹幕开关"},{id:"1908",desc:"打开发弹幕框"},{id:"1909",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"beyond.3dnest.biz":[{id:"1898",desc:"场景条切换"},{id:"1899",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1900",desc:"场景播放"},{id:"1901",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1902",desc:"地图按钮"},{id:"1903",desc:"网站总pv"},{id:"1904",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1905",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1906",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1907",desc:"弹幕开关"},{id:"1908",desc:"打开发弹幕框"},{id:"1909",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"3dnest.n.weimob.com":[{id:"1898",desc:"场景条切换"},{id:"1899",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1900",desc:"场景播放"},{id:"1901",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1902",desc:"地图按钮"},{id:"1903",desc:"网站总pv"},{id:"1904",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1905",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1906",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1907",desc:"弹幕开关"},{id:"1908",desc:"打开发弹幕框"},{id:"1909",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"cloud.3dnest.cn":[{id:"1898",desc:"场景条切换"},{id:"1899",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1900",desc:"场景播放"},{id:"1901",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1902",desc:"地图按钮"},{id:"1903",desc:"网站总pv"},{id:"1904",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1905",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1906",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1907",desc:"弹幕开关"},{id:"1908",desc:"打开发弹幕框"},{id:"1909",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"cloudone.3dnest.cn":[{id:"1898",desc:"场景条切换"},{id:"1899",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1900",desc:"场景播放"},{id:"1901",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1902",desc:"地图按钮"},{id:"1903",desc:"网站总pv"},{id:"1904",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1905",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1906",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1907",desc:"弹幕开关"},{id:"1908",desc:"打开发弹幕框"},{id:"1909",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"cloud2.3dnest.cn":[{id:"1898",desc:"场景条切换"},{id:"1899",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1900",desc:"场景播放"},{id:"1901",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1902",desc:"地图按钮"},{id:"1903",desc:"网站总pv"},{id:"1904",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1905",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1906",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1907",desc:"弹幕开关"},{id:"1908",desc:"打开发弹幕框"},{id:"1909",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"cloud3.3dnest.cn":[{id:"1898",desc:"场景条切换"},{id:"1899",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1900",desc:"场景播放"},{id:"1901",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1902",desc:"地图按钮"},{id:"1903",desc:"网站总pv"},{id:"1904",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1905",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1906",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1907",desc:"弹幕开关"},{id:"1908",desc:"打开发弹幕框"},{id:"1909",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"cloud5.3dnest.cn":[{id:"1898",desc:"场景条切换"},{id:"1899",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1900",desc:"场景播放"},{id:"1901",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1902",desc:"地图按钮"},{id:"1903",desc:"网站总pv"},{id:"1904",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1905",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1906",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1907",desc:"弹幕开关"},{id:"1908",desc:"打开发弹幕框"},{id:"1909",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"cloud6.3dnest.cn":[{id:"1898",desc:"场景条切换"},{id:"1899",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1900",desc:"场景播放"},{id:"1901",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1902",desc:"地图按钮"},{id:"1903",desc:"网站总pv"},{id:"1904",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1905",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1906",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1907",desc:"弹幕开关"},{id:"1908",desc:"打开发弹幕框"},{id:"1909",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"cloud7.3dnest.cn":[{id:"1898",desc:"场景条切换"},{id:"1899",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1900",desc:"场景播放"},{id:"1901",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1902",desc:"地图按钮"},{id:"1903",desc:"网站总pv"},{id:"1904",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1905",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1906",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1907",desc:"弹幕开关"},{id:"1908",desc:"打开发弹幕框"},{id:"1909",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"cloud8.3dnest.cn":[{id:"1898",desc:"场景条切换"},{id:"1899",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1900",desc:"场景播放"},{id:"1901",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1902",desc:"地图按钮"},{id:"1903",desc:"网站总pv"},{id:"1904",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1905",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1906",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1907",desc:"弹幕开关"},{id:"1908",desc:"打开发弹幕框"},{id:"1909",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"cloud9.3dnest.cn":[{id:"1898",desc:"场景条切换"},{id:"1899",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1900",desc:"场景播放"},{id:"1901",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1902",desc:"地图按钮"},{id:"1903",desc:"网站总pv"},{id:"1904",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1905",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1906",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1907",desc:"弹幕开关"},{id:"1908",desc:"打开发弹幕框"},{id:"1909",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"cloud10.3dnest.cn":[{id:"1898",desc:"场景条切换"},{id:"1899",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1900",desc:"场景播放"},{id:"1901",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1902",desc:"地图按钮"},{id:"1903",desc:"网站总pv"},{id:"1904",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1905",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1906",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1907",desc:"弹幕开关"},{id:"1908",desc:"打开发弹幕框"},{id:"1909",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"oldbeyond.3dnest.cn":[{id:"1910",desc:"场景条切换"},{id:"1911",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1912",desc:"场景播放"},{id:"1913",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1914",desc:"地图按钮"},{id:"1915",desc:"网站总pv"},{id:"1916",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1917",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1918",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1919",desc:"弹幕开关"},{id:"1920",desc:"打开发弹幕框"},{id:"1921",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"vr360.evdo.vip":[{id:"1910",desc:"场景条切换"},{id:"1911",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1912",desc:"场景播放"},{id:"1913",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1914",desc:"地图按钮"},{id:"1915",desc:"网站总pv"},{id:"1916",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1917",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1918",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1919",desc:"弹幕开关"},{id:"1920",desc:"打开发弹幕框"},{id:"1921",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"yun.3dnest.cn":[{id:"1910",desc:"场景条切换"},{id:"1911",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1912",desc:"场景播放"},{id:"1913",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1914",desc:"地图按钮"},{id:"1915",desc:"网站总pv"},{id:"1916",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1917",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1918",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1919",desc:"弹幕开关"},{id:"1920",desc:"打开发弹幕框"},{id:"1921",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"3dv.sdnews.com.cn":[{id:"1910",desc:"场景条切换"},{id:"1911",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1912",desc:"场景播放"},{id:"1913",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1914",desc:"地图按钮"},{id:"1915",desc:"网站总pv"},{id:"1916",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1917",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1918",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1919",desc:"弹幕开关"},{id:"1920",desc:"打开发弹幕框"},{id:"1921",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"vr.coart.cn":[{id:"1910",desc:"场景条切换"},{id:"1911",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1912",desc:"场景播放"},{id:"1913",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1914",desc:"地图按钮"},{id:"1915",desc:"网站总pv"},{id:"1916",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1917",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1918",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1919",desc:"弹幕开关"},{id:"1920",desc:"打开发弹幕框"},{id:"1921",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"vr.anyouyou365.com":[{id:"1910",desc:"场景条切换"},{id:"1911",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1912",desc:"场景播放"},{id:"1913",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1914",desc:"地图按钮"},{id:"1915",desc:"网站总pv"},{id:"1916",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1917",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1918",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1919",desc:"弹幕开关"},{id:"1920",desc:"打开发弹幕框"},{id:"1921",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}],"testweb.3dnest.cn":[{id:"1910",desc:"场景条切换"},{id:"1911",desc:"vr按钮"},{id:"2",desc:"场景/3D"},{id:"3",desc:"平面按钮"},{id:"4",desc:"3D按钮"},{id:"1912",desc:"场景播放"},{id:"1913",desc:"音乐按钮"},{id:"7",desc:"帮助按钮"},{id:"1914",desc:"地图按钮"},{id:"1915",desc:"网站总pv"},{id:"1916",desc:"推荐更多"},{id:"11",desc:"在模型中走动"},{id:"10",desc:"点击屏幕进入全景"},{id:"1917",desc:"点击场景条里的场景"},{id:"14",desc:""},{id:"1918",desc:"测量开关按钮"},{id:"16",desc:"清除测量界面(手机)"},{id:"17",desc:"测量帮助(手机)"},{id:"18",desc:"测量长度(手机)"},{id:"19",desc:"测量面积(手机)"},{id:"20",desc:"清除测量界面(pc)"},{id:"21",desc:"测量帮助(pc)"},{id:"22",desc:"测量长度(pc)"},{id:"23",desc:"测量面积(pc)"},{id:"24",desc:"弹幕控制按钮"},{id:"1919",desc:"弹幕开关"},{id:"1920",desc:"打开发弹幕框"},{id:"1921",desc:"发送弹幕"},{id:"28",desc:"关闭弹幕框"}]}},{}],60:[function(a,b,c){"use strict";function d(a){}var e=a("../util/browser");d.prototype.init=function(a){var b=a.language;a.mlanguage_enable&&1===a.mlanguage_type?($(".nav-help-content").css("letter-spacing","0px"),$("#barrageShow").css("font-size","12px"),e.isMobile()&&$(".measureCon li p").css("font-size","12px"),$(".playSpeed").css("font-size","12px"),$("#multiplier-speed").css("width","36px"),$(".m-cat-popup p").css("font-size","14px")):a.mlanguage_enable&&2===a.mlanguage_type&&$("#goto-vr").css("width","220px"),$("head title").text(b.title),$("#gui-modes-floorplan").text(b.guiModesFloorplan),$("#gui-modes-dollhouse").text(b.guiModesDollhouse),$("#descrVr").html(b.vrCon.descrVr),$("#beginVr").html(b.vrCon.beginVr),$("#goto-vr").html(b.vrCon.gotoVr),$("#helpTitle").text(b.help.helpTitle),$("#helpKey").text(b.help.helpKey),$("#helpDrag").text(b.help.helpDrag),$(".helpSlide").text(b.help.helpSlide),$(".helpLord").text(b.help.helpLord),$(".helpRoam").text(b.help.helpRoam),$(".helpChange").text(b.help.helpChange),$(".helpVisit").text(b.help.helpVisit),$(".helpVr").text(b.help.helpVr),$(".helpClick-move").text(b.help.helpClickMove),$(".helpDrag-move").text(b.help.helpDragMove),$(".helpZoom-move").text(b.help.helpZoomMove),$(".helpKey-move").text(b.help.helpKeyMove),$(".helpMore").text(b.help.helpMore),$(".helpMeasure").text(b.help.helpMeasure),$(".helpToMove").text(b.help.helpToMove),$(".helpToAround").text(b.help.helpToAround),$(".helpToZoom").text(b.help.helpToZoom),$(".initial-lord p").text(b.help.helpLord),$(".initial-lord b").text(b.help.helpFade),e.isMobile()?($(".initial-help p").text(b.help.helpToMove),$(".initial-turn p").text(b.help.helpToAround)):($(".initial-help p").text(b.help.helpClickMove),$(".initial-turn p").text(b.help.helpDragMove)),$(".measureTitle p").text(b.measureHelp.measureHelpTitle),$(".measureHelpLine").text(b.measureHelp.measureHelpLine),$(".measureHelpArea").text(b.measureHelp.measureHelpArea),$(".measureHelpClear").text(b.measureHelp.measureHelpClear),$(".measureHelpExit").text(b.measureHelp.measureHelpExit),$(".measureHelpAdjust").text(b.measureHelp.measureHelpAdjust),$(".measureStatement").text(b.measureHelp.measureStatement),G.settings.catalogue&&G.settings.catalogue.title&&(b.catalog.goodsList=G.settings.catalogue.title),$(".mCatalogCommodity p, .catalogCommodity p").text(b.catalog.goodsList),$(".mCatalogTemplet p, .catalogTemplet p").text(b.catalog.moreRoom),$(".m-cat-popup p").text(b.catalog.newSpace),$(".m-cat-popup b a").text(b.catalog.confirm),$(".m-cat-popup span").text(b.catalog.cancel),$(".barrageSwitch p").text(b.barrage.switch),$(".sendBarrage p, .commentDanmu").text(b.barrage.comment),$(".commentBtn").text(b.barrage.send),$(".commentClose").text(b.barrage.close),$(".commentDet").attr("placeholder",b.barrage.placeholder),$("#popularity").text(b.popularity),$("#details, .bl-text").text(b.details),$(".ck-title").text(b.more),$(".playSpeed").text(b.playSpeed)},b.exports=d},{"../util/browser":142}],61:[function(a,b,c){"use strict";var d=(a("../util/common"),{status:0,set:function(a){var b=a;if(isNaN(b))return!1;var c=Math.max(Math.min(b,100),0),d=Math.floor(c)+"%";$("#loadingProgress").css("width",d),$(".stripes span").css("background-color","#4BCDFC"),$("#progressNum").text(d),this.status=a},done:function(a){return a||this.status?(this.status=null,this.set(100)):this}});b.exports.circleLoader=d},{"../util/common":145}],62:[function(a,b,c){"use strict";function d(a,b,c){var d=new e.GUI({width:400}),l=d.addFolder("Flydown from Dollhouse");l.add(k.flydown,"movementEasing",Object.keys(g)),l.add(k.flydown,"movementDelay",0,1).step(.01),l.add(k.flydown,"rotationEasing",Object.keys(g)),l.add(k.flydown,"rotationDelay",0,1).step(.01),l.add(k.flydown,"modelTextureDelay",0,1).step(.01),l.add(k.flydown,"skyboxDelay",0,1).step(.01),l.add(k.dollhouseDefault,"minPolarAngle",0,f.Math.degToRad(50)),l.add(k.dollhouseDefault,"maxPolarAngle",f.Math.degToRad(50),f.Math.degToRad(170));var m=d.addFolder("Transition between panos");m.add(k.transition,"blur",0,10).onFinishChange(function(){}),m.add(k.transition,"flySpeed",0,10).step(.01).onFinishChange(function(){k.transition.flyTime=0,m.__controllers.forEach(function(a){a.updateDisplay()})}),m.add(k.transition,"flyTime",0,5e3).onFinishChange(function(){k.transition.flySpeed=0,m.__controllers.forEach(function(a){a.updateDisplay()})}),m.add(k.transition,"aimTime",500,2500).step(50),m.add(k.transition,"aimSlowFactor",1,3).step(.1),m.add(k.transition,"movementEasing",Object.keys(g));var n=d.addFolder("Path Display");n.add(k.path,"opacity",0,1).step(.01).onFinishChange(function(){}),n.add(k.path,"height",0,.2).step(.01).onFinishChange(function(){}),n.add(k.path,"outsideHeight",0,2).step(.01).onFinishChange(function(){}),n.add(k.path,"ribbonWidth",.01,.35).step(.01).onFinishChange(function(){}),n.add(k.path,"waypointRadius",.01,1.2).step(.01).onFinishChange(function(){}),n.add(k.path,"waypointPulse",0,3600).step(20).onFinishChange(function(){}),n.add(k.path,"waypointIndoorRadius",.01,1.2).step(.01).onFinishChange(function(){}),n.add(k.path,"fadeInTime",0,1200).step(10).onFinishChange(function(){}),n.add(k.path,"fadeOutTime",0,1200).step(10).onFinishChange(function(){}),n.add(k.path,"color",Object.keys(i)).onFinishChange(function(){k.path.color=i[k.path.color],k.path.colorUp=i.desat(k.path.color),k.path.colorDown=i.darken(k.path.color)}),n.add(k,"reticuleColor",Object.keys(i)).onFinishChange(function(){k.reticuleColor=i[k.reticuleColor],c.reticule.material.uniforms.color.value.set(k.reticuleColor)});var o=d.addFolder("Warping"),p=o.addFolder("Warp/Teleport");p.add(k.warp,"softPushDist",0,2).onFinishChange(function(){}),p.add(k.warp,"softPushEnd",0,1).step(.01).onFinishChange(function(){}),p.add(k.warp,"softBendAngle",0,45).onFinishChange(function(){}),p.add(k.warp,"softBendTilt",0,45).onFinishChange(function(){}),p.add(k.warp,"softBendEnd",0,1).step(.01).onFinishChange(function(){}),p.add(k.warp,"burnsAngle",0,30).onFinishChange(function(){}),p.add(k.warp,"minBurnsAngle",0,10).onFinishChange(function(){}),p.add(k.warp,"brakeStrength",1,8).onFinishChange(function(){}),p.add(k.warp,"minBrakeAngle",0,5).step(.01).onFinishChange(function(){}),p.add(k.warp,"maxBrakeAngle",0,5).step(.01).onFinishChange(function(){}),p.add(k.path,"mapGuides").onFinishChange(function(){}),p.add(k.warp,"teleportTime",0,5e3).step(10).onFinishChange(function(){}),p.add(k.warp,"outsideTime",0,5e3).step(10).onFinishChange(function(){}),p.add(k.path,"typ",Object.keys(j)).onFinishChange(function(){k.path.typ=j[k.path.typ]}),p.add(k.warp,"tourStepDelay",0,1e4).step(100).onFinishChange(function(){}),p.add(k.warp,"loop").onChange(function(){}).onFinishChange(function(){b.endlessLoop=k.warp.loop}),p.add(k.warp,"walkSlideShowThreshhold",1,1e4).step(1).onFinishChange(function(){}),p.add(k.warp,"walkExtraPanosDistance",0,3).step(.1).onFinishChange(function(){}),p.add(k.transition,"fastForwardFactor",1,10).step(1).onFinishChange(function(){});var q=o.addFolder("Long Warp Only");q.add(k.warp,"minWarpTime",0,5e3).step(10).onFinishChange(function(){k.warp.flySpeed=0,q.__controllers.forEach(function(a){a.updateDisplay()})}),q.add(k.warp,"timePerMeter",0,5e3).step(10).onFinishChange(function(){}),q.add(k.warp,"lookAheadMax",.01,1).step(.01).onFinishChange(function(){}),q.add(k.warp,"lookAheadDist",.01,4).step(.01).onFinishChange(function(){}),q.add(k.warp,"maxTurnPerSec",0,720).step(1).onFinishChange(function(){}),q.add(k.warp,"maxAimPerSec",0,720).step(1).onFinishChange(function(){}),q.add(k.warp,"turnFriction",0,1).step(.01).onFinishChange(function(){}),q.add(k.warp,"walkDelay",0,2e3).step(10).onFinishChange(function(){}),q.add(k.transition,"flytimeMaxDistanceThreshold",0,25).step(10).onFinishChange(function(){}),q.add(k.warp,"walkMaxDist",0,100).step(1).onFinishChange(function(){});var r=d.addFolder("Warp Esoterica");r.add(k.warp,"nearPanoDist",.01,12).step(0).onFinishChange(function(){}),r.add(k.warp,"blur",.01,1).onFinishChange(function(){}),r.add(k.warp,"flySpeed",0,10).step(.01).onFinishChange(function(){k.warp.minWarpTime=0,r.__controllers.forEach(function(a){a.updateDisplay()})}),
r.add(k.warp,"showBunny").onFinishChange(function(){}),r.add(k.warp,"fastTime",0,2500).step(10).onFinishChange(function(){}),r.add(k.warp,"movementEasing",Object.keys(g));var s=d.addFolder("Misc");s.add(k,"dollhouseFOV",10,180).onChange(function(){c.controls[h.DOLLHOUSE].camera.fov=k.dollhouseFOV}),s.add(k,"insideFOV",10,180).onChange(function(){c.controls[h.PANORAMA].camera.fov=k.insideFOV}),s.add(k,"insideLookSpeed",.01,.3).step(.01).onChange(function(){}),s.add(k,"rotationAccelerationInside",.1,10).step(.1).onChange(function(){}),s.add(k,"rotationAccelerationOutside",.1,10).step(.1).onChange(function(){});var t=d.addFolder("Navigation");t.add(k.navigation,"panoScores").onFinishChange(function(){k.navigation.panoScores||a.panos.forEach(function(a){a.floor.remove(a.text3d),a.text3d=null})}),t.add(k.navigation,"mouseDirection"),t.add(k.navigation,"filterStrictness",0,1),t.add(k.navigation,"angleFactor",-60,0),t.add(k.navigation,"directionFactor",1,20),t.add(k.navigation,"distanceFactor",-5,5),t.add(k.navigation,"optionalityFactor",.1,10);var u=d.addFolder("Mattertags"),v=u.addFolder("Tag Creation");v.add(k.mattertags.pole,"enabled").name("poleEnabled"),v.add(k.mattertags.pole,"height",0,2.5).step(.01).name("poleHeight"),v.add(k.mattertags.pole,"width",1,10).step(1).name("poleWidth"),v.add(k.mattertags.pole,"opacity",.1,1).step(.1).name("poleOpacity");var w=u.addFolder("Visibility");w.add(k.mattertags.visibility,"anyDistance"),w.add(k.mattertags.visibility,"visibleDistance",.1,30).step(.1),w.add(k.mattertags.visibility,"cameraClearance",0,1).step(.01),w.add(k.mattertags.visibility,"hideViaFloor"),w.add(k.mattertags.visibility,"hideOffScreenDisc").name("hideEdgeDisc"),w.add(k.mattertags.visibility,"hideOffScreenObject").name("hideEdgeObject");var x=u.addFolder("Disc Parameters");x.add(k.mattertags.disc.scale,"nearBound",.1,10).step(.1),x.add(k.mattertags.disc.scale,"farBound",.1,20).step(.1).listen(),x.add(k.mattertags.disc.scale,"linkFarBound").onChange(function(a){a&&(k.mattertags.disc.scale.farBound=k.mattertags.visibility.visibleDistance*(1-k.mattertags.disc.scale.linkPercent/100))}),x.add(k.mattertags.disc.scale,"linkPercent",0,100).step(1).onChange(function(a){k.mattertags.disc.scale.linkFarBound&&(k.mattertags.disc.scale.farBound=k.mattertags.visibility.visibleDistance*(1-a/100))}),x.add(k.mattertags.disc.scale,"maxSize",40,200).step(1),x.add(k.mattertags.disc.scale,"minSize",20,100).step(1),x.add(k.mattertags.disc.scale,"responsiveness",0,100).step(1);var y=u.addFolder("Animation Timers");y.add(k.mattertags.animation,"hoverOnClosing"),y.add(k.mattertags.animation,"animInDelay",0,500).step(10).name("Opening Delay"),y.add(k.mattertags.animation,"animOutDelay",0,500).step(10).name("Closing Delay"),y.add(k.mattertags.animation,"animInTime",0,1e3).step(25).name("Opening Duration"),y.add(k.mattertags.animation,"animOutTime",0,1e3).step(25).name("Closing Duration");var z=u.addFolder("Billboard Scaling");z.add(k.mattertags.boardScale,"billboardScale",.5,5).step(.1),z.add(k.mattertags.boardScale,"scaleToDisc"),z.add(k.mattertags.boardScale,"boardToDiscRatio",.5,5).step(.1);var A=u.addFolder("Navigate");A.add(k.mattertags.navigate,"nearestPano").name("nearestPano"),A.add(k.mattertags.navigate,"lineOfSight").name("lineOfSight"),A.add(k.mattertags.navigate,"reactivate").name("reactivate"),A.add(k.mattertags.navigate,"aimAt",["disc","object","pole","nothing"]).name("aim at"),A.add(k.mattertags.navigate,"tiltTolerance",0,50).step(1),A.add(k.mattertags.navigate,"rotateSpeedFactor",0,5).step(.1);var B=d.addFolder("Debug");B.add(k,"wireframe").onFinishChange(function(){a.chunks.forEach(function(b){b.material&&(b.wireframeTwin||(b.wireframeTwin=new f.WireframeHelper(b),b.wireframeTwin.material.depthWrite=!1,b.wireframeTwin.material.depthTest=!1,b.wireframeTwin.material.opacity=.5,b.wireframeTwin.material.transparent=!0),k.wireframe?a.add(b.wireframeTwin):a.remove(b.wireframeTwin))})}),B.add(k,"skyboxWireframe").onFinishChange(function(){k.skyboxWireframe?(a.skybox.wireframe=new f.WireframeHelper(a.skybox),a.add(a.skybox.wireframe)):(a.remove(a.skybox.wireframe),a.skybox.wireframe=null)}),B.add(k,"showSweeps").onFinishChange(function(){a.setSweepVisibility(k.showSweeps)}),B.add(k,"showMesh").onFinishChange(function(){a.chunks.forEach(function(a){a.visible=k.showMesh})}),B.add(k,"showFloors").onFinishChange(function(){a.floors.forEach(function(a){a.collider.children.forEach(function(a){a.material.visible=k.showFloors})})}),B.add(k,"showSkyboxes").onFinishChange(function(){a.panos.forEach(function(a){a.skyboxMesh.visible=k.showSkyboxes})}),B.add(k,"showNeighbors").onChange(function(){}),B.add(a,"alpha",0,1)}var e=a("../lib/dat.gui"),f=a("three"),g=a("../util/easing"),h=a("../enum/Viewmode"),i=a("../enum/Colors"),j=a("../enum/WarpStyle"),k=a("../conf");a("../mattertag/Mattertag"),e.GUI.prototype.removeFolder=function(a){var b=this.__folders[a];b&&(b.close(),this.__ul.removeChild(b.domElement.parentNode),delete this.__folders[a],this.onResize())},b.exports.toggle=d},{"../conf":7,"../enum/Colors":18,"../enum/Viewmode":51,"../enum/WarpStyle":52,"../lib/dat.gui":76,"../mattertag/Mattertag":97,"../util/easing":147,three:177}],63:[function(a,b,c){(function(c){"use strict";function d(a,b,c,d){$(".gui-error .error-problem-text").text(a),$(".gui-error .error-solution-text").text(c),$(".gui-error .error-explanation").text(b),$(".gui-error .error-actions").html(d),$(window).resize(),$(".gui-error").fadeIn(),$("#bottom-logo").fadeIn()}function e(a){d(a,"你的浏览器不支持","建议使用火狐、Chrome 或者IE 11以上版本",['<div class="browser-tiles">','<div class="tile">','<a href="https://www.google.com/chrome/browser/" target="_blank">','<img class="icon" src="images/icon_Google_Chrome_2011.png" ','rel="tiletip" title="Chrome"></a>',"</div>",'<div class="tile">','<a href="https://www.mozilla.org/en-US/firefox/new/" target="_blank">','<img class="icon" src="images/icon_Mozilla_Firefox.png" ','rel="tiletip" title="Firefox"></a>',"</div>",'<div class="tile">','<a href="https://windows.microsoft.com/en-us/internet-explorer/download-ie" target="_blank">','<img class="icon" src="images/icon_Internet_Explorer_10.png" ','rel="tiletip" title="Internet? Explorer"></a>',"</div>",'<div class="tile">','<a href="https://support.apple.com/en-us/HT204416" target="_blank">','<img class="icon" src="images/icon_MacOSX_Safari.png" ','rel="tiletip" title="Safari"></a>',"</div>","</div>"].join("")),h.isMobile()||$("[rel=tiletip]").tooltip({placement:"bottom",delay:{show:50,hide:0},trigger:"hover",viewport:{selector:"body",padding:10}})}function f(){var a=h.isMobile()?"":'<span class="link install-browser">install a supported browser</span> or ';["If the problem persists, ",a,'<a class="link" target="_blank" href=',n,">see our troubleshooting guide</a>."].join("");d(o.o.t,o.o.e),h.isMobile()||$(".install-browser").on("click touchstart",function(a){a.preventDefault(),a.stopPropagation(),e(" ")})}function g(a,b){if($("head title").text(k.pageTitle),$("#gui-message, #gui-loading, #nprogress, #gui-thumb, #bottom-logo").hide(),$("#firstLoading").fadeOut(250),$("#gui-loading").fadeOut(250),$("#quick-blackout").hide(),j.track("USER",{event_type:"showcase_error",error_key:a}),"webgl-unsupported"===a)h.isMobile(),f();else if("webgl-ios"===a)d(o.webglIos.t,o.webglIos.e,o.webglIos.i);else if("webgl-safari"===a)d(o.webglSafari.t,o.webglSafari.e,o.webglSafari.i);else if("webgl-generic"===a)h.isMobile()?d(o.webglGeneric.mobile.t,o.webglGeneric.mobile.e,o.webglGeneric.mobile.i):d(o.webglGeneric.pc.t,o.webglGeneric.pc.e,o.webglGeneric.pc.i);else if("missing-urls"===a)d(o.missingUrls.t,o.missingUrls.e,o.missingUrls.i);else if("loading-failed"===a)d(o.loadingFailed.t,o.loadingFailed.e,o.loadingFailed.i);else if("version-is-empty"===a)d(o.versionIsEmpty.t,o.versionIsEmpty.e,o.versionIsEmpty.i);else if("version-not-found"===a)d(o.versionNotFound.t,o.versionNotFound.e,o.versionNotFound.i);else if("settings-not-found"===a)d(o.settingsNotFound.t,o.settingsNotFound.e,o.settingsNotFound.i);else{if("loading-failed-maintenance"!==a)return void m.error(o.loadingFailedMaintenance.r+a);d(o.loadingFailedMaintenance.t,o.loadingFailedMaintenance.e,o.loadingFailedMaintenance.i)}}var h=a("./../util/browser"),i=a("./mLanguage"),j=a("./../analytics"),k=a("./../conf"),l=a("./../util/logger"),m=new l(c),n='"https://www.3dnest.cn/help/System-Requirements"',o=i.error;b.exports.error=g}).call(this,"/js/gui/error.js")},{"./../analytics":2,"./../conf":7,"./../util/browser":142,"./../util/logger":153,"./mLanguage":69}],64:[function(a,b,c){(function(c){"use strict";function d(){Nb=[],$b.floors.visible&&Nb.push(".gui-floor",".gui-floor-title"),Nb.push(".hideTarget",".pinTop.right")}function e(){for(var a in $b)if($b.hasOwnProperty(a)){var b=$b[a];if(!b.visible)for(var c=0;c<b.elements.length;c++)$(b.elements[c]).hide()}$b.highlight.visible&&$(".pinBottom").addClass("highlightExists"),$b.highlight2nd.visible&&$(".pinBottom").addClass("highlightExists"),!1===$b.tourControls.visible&&$("#drawer").addClass("fullWidth"),$b.coBrand.visible||$("#gui-name").addClass("noCoBrand"),$b.titleContainer.visible&&$(".pinTop.right").addClass("reposition"),d()}function f(a){G.model.floors&&G.model.floors.length>1&&(a?$(".gui-floor").show():$(".gui-floor").hide()),G.model.catalogue&&(a?qa():ra())}function g(a,b){var c=!Ya.isMobile()&&sb.zoom.enabled&&b.mode===Cb.PANORAMA&&!a.tourIsPlaying;$("#gui-zoomin").toggle(c),$("#gui-zoomout").toggle(c)}function h(a,b,c){function d(){$("#tag-btn-on").hasClass("hidden")?($("#tag-btn-off").addClass("hidden"),$("#tag-btn-on").removeClass("hidden"),a.shouldShowMattertags=!0,c.showAllMattertags(sb.mattertags.startup.fadeInDuration)):(a.shouldShowMattertags=!1,$("#tag-btn-on").addClass("hidden"),$("#tag-btn-off").removeClass("hidden"),c.hideAllMattertags(sb.mattertags.startup.fadeInDuration))}$("#tag-btn-on").css("display","block"),$("#tag-btn-on, #tag-btn-off").click(function(){d()})}function i(a){r(),$(".pinBottom").toggleClass("open"),$("#drawer").toggleClass("open"),$(".footer").toggleClass("open"),$("#drawer").hasClass("open")?($("#pullTab .icon").attr("data-original-title","收起"),$("#pullTab").removeClass("pull").addClass("down")):($("#pullTab .icon").attr("data-original-title","房间列表"),$("#pullTab").removeClass("down").addClass("pull")),setTimeout(function(){$("#pullTab").toggleClass("opened"),$("#drawer").hasClass("open")?($("#pullTab .icon").attr("data-original-title","收起"),$("#pullTab").removeClass("pull").addClass("down")):($("#pullTab .icon").attr("data-original-title","房间列表"),$("#pullTab").removeClass("down").addClass("pull"))},$("#drawer").hasClass("open")?0:sb.highlightAnimationDuration),a||p("highlights"),$(".pinBottom").hasClass("open")&&k($(".nav-help-dialog"))&&("none"!==$(".nav-help-dialog").css("display")?n():o()),$(".pinBottom").hasClass("open")&&k($(".vr-popup"))&&$(".vr-popup").is(":visible")&&zb.dismiss()}function j(a){if(r(),$("#pinBottom").hasClass("open")?($("#pinBottom").removeClass("open"),$(".pinBottom").toggleClass("highOpen")):$(".pinBottom").toggleClass("highOpen"),$("#drawer-2nd").toggleClass("open"),$("#shopTab").hasClass("open")&&$("#pinBtmLoad").height(160),$("#drawer-2nd").hasClass("open")){$("#shopTab").removeClass("pull-n").addClass("down-n");var b=$("#thumb-container-2nd");0!=$("#thumb-container-2nd:has(li)").length&&b.empty(),$("#commodity_search").val(""),kb=!1,U(lb),T(lb)}else $("#shopTab").removeClass("down-n").addClass("pull-n"),$(".commodity_search").fadeOut(300),$(".search_title").removeClass("search_close").addClass("search_open");setTimeout(function(){$("#shopTab").toggleClass("opened"),$("#drawer-2nd").hasClass("open")?$("#shopTab").removeClass("pull-n").addClass("down-n"):$("#shopTab").removeClass("down-n").addClass("pull-n")},$("#drawer-2nd").hasClass("open")?0:sb.highlightAnimationDuration),a||p("highlights"),$(".pinBottom").hasClass("open")&&k($(".nav-help-dialog"))&&("none"!==$(".nav-help-dialog").css("display")?n():o()),$(".pinBottom").hasClass("open")&&k($(".vr-popup"))&&$(".vr-popup").is(":visible")&&zb.dismiss()}function k(a){return!1}function l(){$(window).height()<400&&$("#drawer").hasClass("open")&&i(!0)}function m(){$(window).height()<400&&$("#meta-info").is(":visible")&&A(!0)}function n(){$("#drawer").hasClass("open")&&($(".nav-help-dialog").addClass("elevated"),"none"!==$(".title-container").css("display")&&(B(),Tb=!0))}function o(){$(".nav-help-dialog").removeClass("elevated"),Tb&&(B(),Tb=!1)}function p(a){function b(){j.is(":visible")}function c(){p.is(":visible")&&p.fadeOut()}function d(){q.is(":visible")&&(o(),vb.closeHelp())}function e(){u.is(":visible")&&zb.dismiss()}function f(){r.hasClass("open")&&i(!0)}function g(){s.is(":visible")&&s.fadeOut()}function h(){t.hasClass("open")&&t.removeClass("open")}var j=$("#meta-info"),p=$("#terms-modal"),q=$(".nav-help-dialog"),r=$("#drawer"),s=$("#share-modal"),t=$(".gui-floor"),u=$(".vr-popup");switch(a){case"info":c(),d(),l(),g(),h(),e();break;case"terms":b(),d(),f(),g(),h(),e();break;case"help":k(q)&&n(),b(),c(),g(),h(),e();break;case"help-dismissed":o();break;case"vr":b(),c(),g(),h(),d(),k(u)&&f();break;case"highlights":m(),c(),g(),h();break;case"share":c(),h();break;case"floor":c(),g(),e();break;case"view":h(),g(),c(),e();break;case"tour":case"move":c(),g(),h(),e();break;case"resize":b(),l(),g(),h()}}function q(a){"touchstart"===a.type&&a.preventDefault(),a.stopPropagation()}function r(){_a&&(_a.reload(),_a.init()),eb&&(eb.reload(),eb.init())}function s(a){wb.show(a),e()}function t(a,b){function c(){$("#gui-parent").css("display","none"),$("#vr-mode-container").css("display","block"),window.vrEnabled=!0}function d(){$("#vr-mode-container").css("display","none"),$("#gui-parent").css("display","block"),window.vrEnabled=!1}function e(a){setTimeout(function(){document.getElementsByClassName("toast-wrap")[0].getElementsByClassName("toast-msg")[0].innerHTML=a;var b=document.getElementsByClassName("toast-wrap")[0];b.className=b.className.replace("toastAnimate",""),setTimeout(function(){b.className=b.className+" toastAnimate"},10)},10)}function f(a){"none"!==$(".nav-help-dialog").css("display")&&vb.closeHelp(),Ya.isMobile()?"none"===$("#vr-mode-container").css("display")?$("#play").hasClass("pause")?e(a):$(".vr-guide-dialog").css("display","block"):d():$(".vr-guide-dialog").css("display","block")}function g(){G.ori.flag=!G.ori.flag}function h(){$(".vrbargroup").toggle()}var i=(a.modelid,b.watchVr);$("#goto-vr").click(function(){$(".vr-guide-dialog").css("display","none"),Ya.isMobile()&&($("#play").hasClass("pause")?e(i):("function"==typeof DeviceMotionEvent.requestPermission&&DeviceMotionEvent.requestPermission().then(function(a){"granted"===a&&window.addEventListener("devicemotion",function(){})}).catch(console.error),"function"==typeof DeviceOrientationEvent.requestPermission&&DeviceOrientationEvent.requestPermission().then(function(a){"granted"===a&&window.addEventListener("deviceorientation",function(){})}).catch(console.error),G.settings.basic.menu.compass_enable&&$(".indoordir, .indoorscale").fadeOut(300),c()))}),$(".vr-guide-dialog .close").on("click",function(){$(".vr-guide-dialog").css("display","none")}),a.vr_num>0&&$("#gui-vr-on").css("display","block"),a.vr_enable&&1===a.vr_num?($("#gui-vr-on").addClass("openvr"),$("#gui-vr-on, #gui-vr-off").click(function(){Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[1].desc,Ma.trigger,Ma.modelid]),G._hmt.push(["'"+Ma.type.custom+"'","'"+Za[1].id+"'","'"+Ma.modelid+"'"]),Xa.trackEvent(1)),f(i)})):a.enableOri&&1===a.vr_num?($("#gui-vr-on").addClass("openor"),$("#gui-vr-on, #gui-vr-off").click(function(){Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[1].desc,Ma.trigger,Ma.modelid]),G._hmt.push(["'"+Ma.type.custom+"'","'"+Za[1].id+"'","'"+Ma.modelid+"'"]),Xa.trackEvent(1)),g()})):a.vr_enable&&a.enableOri&&2===a.vr_num&&($("#gui-vr-on").addClass("btn-vrall"),$("#gui-vr-on").click(function(){h()}),$(".openvr, #gui-vr-off").click(function(){Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[1].desc,Ma.trigger,Ma.modelid]),G._hmt.push(["'"+Ma.type.custom+"'","'"+Za[1].id+"'","'"+Ma.modelid+"'"]),Xa.trackEvent(1)),f(i)}),$(".openor").click(function(){g()})),a.vr_enable&&$("#gui-vr-off").click(function(){G.settings.basic.menu.compass_enable&&$(".indoordir, .indoorscale").fadeIn(300)})}function u(a,b){a.innermap_enable&&Fa.init(a,b)}function v(a){wb.progress(a)}function w(b,c,d,f){function j(a){if("getSnapshot"==a.data){var b=document.getElementsByTagName("canvas")[0].toDataURL("image/png");window.parent.postMessage({msg:"got_image",image:b},"*")}}function k(a){setTimeout(function(){document.getElementsByClassName("toast-wrap")[0].getElementsByClassName("toast-msg")[0].innerHTML=a;var b=document.getElementsByClassName("toast-wrap")[0];b.className=b.className.replace("toastAnimate",""),setTimeout(function(){b.className=b.className+" toastAnimate"},10)},10)}if(window.addEventListener("message",j,!1),sb.isProduceVersion&&($("#adjust_angle_translation").css("display","block"),$("#submit_adjust_y").on("click",function(a){c.player.currentPano.adjustTAngleY,c.player.currentPano.id})),2==sb.thirdCustomer&&window.addEventListener("message",j,!1),sb.isNewEditVersion&&a("../util/editor/Editor"),sb.isEditVersion){var l=parent.location.href;l.indexOf("nest/tag")>-1||l.indexOf("nest/highlights")>-1||l.indexOf("nest/orientations")>-1?$("#editversion-note").css("display","block"):($("#editversion-angle-note").css("display","block"),parent.window.showHiddenPano||$("#adjust_angle").css("display","block"),$("#input_nest_up_x").on("click",function(a){c.player.currentPano.updateAngle("x",1)}),$("#input_nest_down_x").on("click",function(a){c.player.currentPano.updateAngle("x",2)}),$("#reset_nest_x").on("click",function(a){c.player.currentPano.updateAngle("x",0)}),$("#input_nest_up_y").on("click",function(a){c.player.currentPano.updateAngle("y",1)}),$("#input_nest_down_y").on("click",function(a){c.player.currentPano.updateAngle("y",2)}),$("#reset_nest_y").on("click",function(a){c.player.currentPano.updateAngle("y",0)}),$("#input_nest_up_z").on("click",function(a){c.player.currentPano.updateAngle("z",1)}),$("#input_nest_down_z").on("click",function(a){c.player.currentPano.updateAngle("z",2)}),$("#reset_nest_z").on("click",function(a){c.player.currentPano.updateAngle("z",0)}),$("#submit_form_aa").on("click",function(a){Ja.add_angle(c.player.currentPano.id)})),parent.window.adjustCompass&&($("#adjust_compass").css("display","block"),$("#nest_rotate_value").text(G.model.adjustCompass.toFixed(2)),$("#input_nest_rotate_up").on("click",function(a){c.compassAdd(.05)}),$("#input_nest_rotate_down").on("click",function(a){c.compassAdd(-.05)}),$("#input_nest_rotate_zero").on("click",function(a){c.compassReset(0)}),$("#submit_form_compass").on("click",function(a){Ja.add_compass()}))}var m=b.language,n=c.player;if(Ub=d,!(!0===b.loading_enable)&&$("#gui-thumb").delay(500).fadeOut(2500),wb.hide(function(){Qb=!1},b,Ya.isMobile()),$("#circleLoader").hasClass("clickIntoModel")&&$("#gui-loading, #gui-thumb").fadeOut(2500,function(){$("#gui-loading-splash").attr("src",""),$(".loadingLogo").hide()}),sb.mattertags.enabled&&Object.keys(b.mattertags).length>0&&(h(b,n,d),sb.mattertags.enableLinking&&yb.attachMattertagLinks(n)),$b.address.visible||$b.contact.visible||$b.description.visible?$("#mattertag-toggles").prepend("<br>"):Object.keys(b.mattertags).length||($(".meta-toggle").off("click"),$(".title-container").removeClass("meta-toggle"),$b.metaInfo.visible=!1),b.floors.length<=1||!$b.floors.visible?$b.floors.visible=!1:(M(b,c),N(b.currentFloor,n.mode)),window.DeviceOrientationEvent&&t(b,m),e(),g(c,c.player),$("#gui").fadeIn(1500),$b.highlight.visible&&setTimeout(function(){i(),n.currentPano&&2==n.currentPano.alignmentType&&k(m.watchPr)},2e3),!Ya.isMobile())for(var o=["a","#title-toggle",".next-button",".prev-button",".gui-floor",".meta-toggle",".thumbImg","logo-button"],p=0;p<o.length;p++)$(o[p]).hasClass("noHover")||$(o[p]).addClass("hasHover");na(b),u(b,n),x(b),sb.isUserVersion&&$("#toprightbar").addClass("toprightbar-edit"),(void 0==b.measure_enable||b.measure_enable)&&(Wb=new Pa(f.scene,f.renderer,c.player),f.addComponent(Wb),$("#measure-group").addClass("measure-mobile"),$("#measure-tools").on("click",function(a){Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[15].desc,Ma.trigger,Ma.modelid]),G._hmt.push(["'"+Ma.type.custom+"'","'"+Za[15].id+"'","'"+Ma.modelid+"'"]),Xa.trackEvent(62)),Xb?(Xb=!1,G.measurestarted=!1,$("#measure-unit").css("display","none"),Ya.isMobile()?($("#rightbar").css("display","block"),b.oauth&&($("#virgule").css("display","block"),$("#barrageShow").css("display","block")),$("#length-tool-m").css("display","none"),$("#area-tool-m").css("display","none"),$("#reset-tool-m").css("display","none"),$("#help-tool-m").css("display","none"),$("#area-tool-m").click()):($("#length-tool").css("display","none"),$("#area-tool").css("display","none"),$("#reset-tool").css("display","none"),$("#help-tool").css("display","none"),$("#area-tool").click()),$("#measure-tools").removeClass("measure-close").addClass("measure-open"),$("#measure-back").css("display","none"),$("#measure-back, #meok").hide(),Wb.backup(),Wb.finishInsertion(!Ya.isMobile()),Wb.exitMeasureMode(a),Wb.finishInsertion(!Ya.isMobile()),$("#length-tool").hasClass("measure-checked")&&($("#length-tool").removeClass("measure-checked"),Wb.finishInsertion(!Ya.isMobile())),$("#area-tool-m").hasClass("measure-checked")&&($("#area-tool-m").removeClass("measure-checked"),Wb.finishInsertion(!Ya.isMobile())),$("#length-tool-m").hasClass("measure-checked")&&($("#length-tool-m").removeClass("measure-checked"),Wb.finishInsertion(!Ya.isMobile())),$(".pinBottom-container").css("display","block"),$("#pinBtmLoad").css("display","flex"),E(b),$("#rightbar").css("display","block"),b.t_logo_enable&&$("#userlogo").css("display","block"),b.back_url&&$("#back-url").css("display","block"),b.visiotors_enable&&$("#page-view").css("display","block"),G.settings&&G.settings.basic.menu.compass_enable&&$(".compass").css("display","block"),G.m.state=0):(Xb=!0,G.measurestarted=!0,$("#measure-unit").css("display","block"),G.m.toast(m.measureHelp.notice),Ya.isMobile()?($("#rightbar").css("display","none"),$("#virgule").css("display","none"),$("#barrageShow").css("display","none"),$("#reset-tool-m").css("display","block"),$("#area-tool-m").click()):($("#reset-tool").css("display","block"),$("#area-tool").click()),$("#meok").hide(),$("#measure-back").hide(),$("#measure-tools").removeClass("measure-open").addClass("measure-close"),Wb.intoMeasureMode(!Ya.isMobile()),Wb.restore(),$(".pinBottom-container").css("display","none"),$("#pinBtmLoad").css("display","none"),F(b),$("#rightbar").css("display","none"),$("#userlogo").css("display","none"),$("#page-view").css("display","none"),$("#back-url").css("display","none"),$(".compass").css("display","none"))}),$("#reset-tool-m").on("click",function(a){Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[16].desc,Ma.trigger,Ma.modelid]),Xa.trackEvent(63)),Wb.deleteAll(),$("#area-tool-m").hasClass("measure-checked")&&($("#area-tool-m").removeClass("measure-checked"),Wb.finishInsertion(!Ya.isMobile())),$("#length-tool-m").hasClass("measure-checked")&&($("#length-tool-m").removeClass("measure-checked"),Wb.finishInsertion(!Ya.isMobile())),$("#area-tool-m").click(),$("#meok").hide(),$("#measure-back").hide()}),$("#measure-back").on("click",function(a){var b=G.m.measurements.length;if(b>0){var c=G.m.measurements[b-1].points.length;c>0&&(c<=2?(G.m.onDoubleClick(),G.m.removeMeasurement(G.m.measurements[b-1])):G.m.measurements[b-1].removeMarker(c-1))}}),$("#help-tool-m").on("click",function(a){Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[17].desc,Ma.trigger,Ma.modelid]),Xa.trackEvent(64)),$(".help_back").css("display","block"),$("#measureHelp").css("display","block"),$(".measureClose").css("display","block")}),$("#length-tool-m").on("click",function(a){Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[18].desc,Ma.trigger,Ma.modelid]),Xa.trackEvent(65)),$("#area-tool-m").hasClass("measure-checked")&&($("#area-tool-m").removeClass("measure-checked"),Wb.finishInsertion(!Ya.isMobile())),$("#length-tool-m").hasClass("measure-checked")?($("#length-tool-m").removeClass("measure-checked"),Wb.finishInsertion(!Ya.isMobile())):($("#length-tool-m").addClass("measure-checked"),Wb.startInsertion({showDistances:!0,showArea:!1,closed:!1},!Ya.isMobile()))}),$("#area-tool-m").on("click",function(a){Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[19].desc,Ma.trigger,Ma.modelid]),Xa.trackEvent(66)),$("#length-tool-m").hasClass("measure-checked")&&($("#length-tool-m").removeClass("measure-checked"),Wb.finishInsertion(!Ya.isMobile())),$("#area-tool-m").hasClass("measure-checked")?($("#area-tool-m").removeClass("measure-checked"),Wb.finishInsertion(!Ya.isMobile())):($("#area-tool-m").addClass("measure-checked"),Wb.startInsertion({showDistances:!0,showArea:!0,closed:!0},!Ya.isMobile()))}),$("#reset-tool").on("click",function(a){Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[20].desc,Ma.trigger,Ma.modelid]),Xa.trackEvent(67)),Wb.deleteAll(),$("#area-tool").hasClass("measure-checked")&&($("#area-tool").removeClass("measure-checked"),Wb.finishInsertion(!Ya.isMobile())),$("#length-tool").hasClass("measure-checked")&&($("#length-tool").removeClass("measure-checked"),Wb.finishInsertion(!Ya.isMobile())),$("#area-tool").click()}),$("#help-tool").on("click",function(a){Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[21].desc,Ma.trigger,Ma.modelid]),Xa.trackEvent(68)),$(".help_back").css("display","block"),$("#measureHelp").css("display","block"),$(".measureClose").css("display","block")}),$("#length-tool").on("click",function(a){Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[22].desc,Ma.trigger,Ma.modelid]),Xa.trackEvent(69)),$("#area-tool").hasClass("measure-checked")&&($("#area-tool").removeClass("measure-checked"),Wb.finishInsertion(!Ya.isMobile())),$("#length-tool").hasClass("measure-checked")?($("#length-tool").removeClass("measure-checked"),Wb.finishInsertion(!Ya.isMobile())):($("#length-tool").addClass("measure-checked"),Wb.startInsertion({showDistances:!0,showArea:!1,closed:!1},!Ya.isMobile()))}),$("#area-tool").on("click",function(a){if(Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[23].desc,Ma.trigger,Ma.modelid]),Xa.trackEvent(70)),$("#length-tool").hasClass("measure-checked")&&($("#length-tool").removeClass("measure-checked"),Wb.finishInsertion(!Ya.isMobile())),$("#area-tool").hasClass("measure-checked")){$("#area-tool").removeClass("measure-checked");var b;Xb||(b=!0),Wb.finishInsertion(!Ya.isMobile(),b)}else $("#area-tool").addClass("measure-checked"),Wb.startInsertion({showDistances:!0,showArea:!0,closed:!0},!Ya.isMobile())}),$("#meok").on("click",function(){G.m.onDoubleClick(!0)})),Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[9].desc,Ma.trigger,Ma.modelid]),G._hmt.push(["'"+Ma.type.custom+"'","'"+Za[9].id+"'","'"+Ma.modelid+"'"])),sb.isCleanUI&&function(){$("#barrageCon").hide(),$("#pinBtmLoad").css("display","none"),$("#view-controllers").show(),$(".rightgroup").hide()}(),Va.delayLoad(b)}function x(a){var b=a.data.description_voice_url,c=window.document.getElementById("audio-summary");if(b)if(b+="?time="+(new Date).getTime(),c.src=b,"iOS"===$.ua.os.name){if(ba())return void function(a){wx.config({debug:!1,appId:"",timestamp:1,nonceStr:"",signature:"",jsApiList:[]}),wx.ready(function(){c.loop="",c.src=a,c.play()}),parent!==window&&(c.loop="",c.src=a,c.play())}(b);c.muted="muted"}else{var d=window.document.getElementById("audio-tag");d.volume=.7,c.autoplay="autoplay"}}function y(a){a||(a=0),Sb=!1,window.setTimeout(function(){Sb||(Rb=!0,$("#gui-spinner").stop(!0,!0).show())}.bind(this),a)}function z(){$("#gui-spinner").stop(!0,!0),$("#gui-spinner").fadeOut(1e3),Sb=!0,Rb=!1}function A(a){var b=$("#meta-info");$(".pinTop.right").toggleClass("hideUnderMeta"),b.slideToggle(sb.guiAnimationSpeed),$("#more-hint").toggle(),$("#less-hint").toggle(),a||l()}function B(a){function b(){c&&e.toggleClass("closed")}a&&q(a);var c,d=$(".title-container"),e=$("#model-title");$("#title-toggle").find("i").toggleClass("icon-dpad-left icon-dpad-right"),$(".pinTop.right").toggleClass("reposition"),"none"===d.css("display")?(tb.trackAlways("USER",{event_type:"showcase_gui",gui_action:"about_show"}),c=!1):(tb.trackAlways("USER",{event_type:"showcase_gui",gui_action:"about_hide"}),c=!0),c||e.toggleClass("closed"),$("#meta-info").is(":visible")?(A(),$(".title-container").animate({opacity:1},sb.guiAnimationSpeed).animate({width:"toggle"},{duration:sb.guiAnimationSpeed,complete:b})):$(".title-container").animate({width:"toggle"},{duration:sb.guiAnimationSpeed,complete:b})}function C(a,b,c){if(b.model.data.player_options.show3d){var d=b.mode,e=c||b.currentPano;$("#gui-modes-dollhouse").toggleClass("active",d===Cb.DOLLHOUSE),$("#gui-modes-floorplan").toggleClass("active",d===Cb.FLOORPLAN),d===Cb.PANORAMA?(sb.isCleanUI||$("#view-controllers").slideUp(500),sb.show360Views.enabled&&!e.isAligned()?$("#gui-modes-outside").addClass("desktop-only"):$("#gui-modes-outside").removeClass("desktop-only"),$("#gui-modes-outside").removeClass("inside").addClass("outside"),$("#cube-container").css("display","block")):d!==Cb.TRANSITIONING&&(z(),Jb=d,$("#gui-modes-outside").removeClass("outside").addClass("inside"),$("#cube-container").css("display","none"),b.model.has360Views&&f(!0),$("#view-controllers").is(":visible")||$("#view-controllers").slideDown(sb.guiAnimationSpeed))}}function D(a,b){var c=b.player;$("#gui-modes-outside").on("click",function(d){if(!1===a.data.player_options.show3d)return!1;Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[2].desc,Ma.trigger,Ma.modelid]),Xa.trackEvent(2)),q(d),$("#gui-modes-outside").hasClass("outside")?(tb.track("USER",{event_type:"showcase_gui",gui_action:"click_outside_mode_button"}),b.changeMode(Jb,"gui"),a.house_type_enabled&&a.house_type_url?$("#image-floor-container").hide(1e3):c.mode!==Cb.DOLLHOUSE&&tb.track("USER",{event_type:"showcase_gui",gui_action:"click_dollhouse_mode_button"}),$("#play").hasClass("pause")&&($("#play").removeClass("pause").addClass("play"),$("#multiplier-speed").fadeOut(300).find("ul").animate({opacity:"0"},300),G.playing=!1,f(!0))):$("#gui-modes-outside").hasClass("inside")&&(tb.track("USER",{event_type:"showcase_gui",gui_action:"click_inside_mode_button"}),$("#image-floor-container").hide(1e3),$("#gui-modes-floor").css("background-image","url(images/icon_wawj_pm2.png)"),c.model.has360Views?(b.stopTour(),c.controls[Cb.PANORAMA].emit(Eb.InteractionGui,"inside-button"),c.goToLastView(!0)):b.changeMode(Cb.PANORAMA,"gui"))}),$("#image-floor-container").on("click",function(){$("#image-floor-container").hide(1e3)}),$("#gui-modes-floorplan").on("click",function(d){Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[3].desc,Ma.trigger,Ma.modelid]),Xa.trackEvent(3)),q(d),a.house_type_enabled&&a.house_type_url?($("#image-floor-container").show(1e3),$("#floor-image").attr("src",a.house_type_url),$("#drawer").hasClass("open")&&i(),$("#play").hasClass("pause")&&$("#play").mousedown()):c.mode!==Cb.FLOORPLAN&&(tb.track("USER",{event_type:"showcase_gui",gui_action:"click_dollhouse_mode_button"}),b.changeMode(Cb.FLOORPLAN))}),$("#gui-modes-dollhouse").on("click",function(a){Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[4].desc,Ma.trigger,Ma.modelid]),Xa.trackEvent(4)),q(a),c.mode!==Cb.DOLLHOUSE&&(tb.track("USER",{event_type:"showcase_gui",gui_action:"click_dollhouse_mode_button"}),b.changeMode(Cb.DOLLHOUSE))})}function E(a){a.normalMovie&&$("#drawer-container").show()}function F(a){a.normalMovie&&$("#drawer-container").hide()}function H(){$("#drawer").hasClass("open")&&(i(),$(".rightbar").hide(),$("#userlogo").hide(),$("#page-view").hide(),$(".breathLight").hide(),$("#back-url").hide(),$("#virgule, #barrageShow, #barrageCon").hide(500),$(".compass, .indoordir, .indoorscale").hide())}function I(a){K(a)}function J(a){K(a),i()}function K(a){$(".rightbar").fadeIn(300),
a.t_logo_enable&&a.t_logo_url&&$("#userlogo").fadeIn(300),a.visiotors_enable&&$("#page-view").fadeIn(300),a.back_url&&$("#back-url").fadeIn(300),G.settings.basic.menu.compass_enable&&$(".indoordir, .indoorscale").fadeIn(300),a.oauth&&Ya.isMobile()&&$("#virgule, #barrageShow").fadeIn(300),$(".barrage-switch").hasClass("iconDanmuOff")||$("#barrage-switch").hasClass("barrage-off")||$("#barrageCon").fadeIn(300)}function L(a,b){b.enableTagMovie&&($(".btn-cat-play").show(),$(".btn-cat-play").on("click",function(){G.playing?(a.currentScript=1,a.stopTour(),a.player.mattertagManager.closeTag(),$("#gui").show(),E(b),G.playing=!1):(a.currentScript=1,Ya.isMobile()?$(".btn-cat-play").removeClass("cat-mob-play").addClass("cat-mob-pause"):$(".btn-cat-play").removeClass("cat-pc-pplaye").addClass("cat-pc-pause"),a.playTour(),$("#gui").hide(),F(b),G.playing=!0)})),$("#play").on("click",function(c){Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[5].desc,Ma.trigger,Ma.modelid]),G._hmt.push(["'"+Ma.type.custom+"'","'"+Za[5].id+"'","'"+Ma.modelid+"'"]),Xa.trackEvent(5)),q(c),$("#play").hasClass("play")?(a.currentScript=0,G.playing=!0,f(!1),p("tour"),a.playTour(),H(),tb.trackAlways("USER",{event_type:"showcase_gui",gui_action:"play_highlights"}),$("#play").removeClass("play").addClass("pause"),$("#image-floor-container").hide(1e3),$("#gui-modes-floor").css("background-image","url(images/icon_wawj_pm2.png)")):$("#play").hasClass("pause")&&(a.currentScript=0,$("#multiplier-speed").fadeOut(300).find("ul").animate({opacity:"0"},300),a.stopTour(),G.playing=!1,f(!0),J(b),tb.trackAlways("USER",{event_type:"showcase_gui",gui_action:"pause_highlights"}),$("#play").removeClass("pause").addClass("play"))}),$("#gui-zoomin").find("a").on("click",function(b){q(b),a.player.zoomInIncrementally()}),$("#gui-zoomout").find("a").on("click",function(b){q(b),a.player.zoomOutIncrementally()}),$("#multiplier-speed p").on("click",function(){"1"===$("#multiplier-speed").find("ul").css("opacity")?$("#multiplier-speed").find("ul").animate({opacity:"0"},500):$("#multiplier-speed").find("ul").css("display","block").animate({opacity:"1"},500)}),$("#multiplier-speed ul li").on("click",function(){$("#multiplier-speed ul").animate({opacity:"0"},500),$("#multiplier-speed").find("p").text($(this).text())}),Ya.isMobile()&&$("#multiplier-speed").css("font-size","12px")}function M(a,b){for(var c=$(".gui-floor"),d=0;d<a.floors.length;d++){var e=$('<div class="floorChoice" data-index="'+d+'"></div>').text(a.floors.get(d).name);$(".gui-floor").find(".container").prepend(e),0===d&&e.addClass("firstFloorBtn"),d===a.floors.length-1&&e.attr("id","lastFloorBtn")}Ya.isMobile()||($(".gui-floor").addClass("pc"),$(".pinBottom.right").css("right","50px")),c.find(".container").prepend('<div class="floorChoice darkGlass allFloorBtn" data-index="all" style="display:none">'+a.language.floor.all+"</div>"),c.on("click",function(a){q(a),p("floor"),c.toggleClass("open")}),$(".floorChoice").on("click",function(a){q(a);var d=$(this).data("index");"all"!==d?(b.player.gotoFloor(d,"gui"),tb.track("USER",{event_type:"showcase_gui",gui_action:"click_floor_select_button",interaction_source:"gui"})):(b.allFloors(),tb.track("USER",{event_type:"showcase_gui",gui_action:"click_toggle_all_floors_button",interaction_source:"gui"})),c.removeClass("open")}),Ya.isMobile()||$(".floorup").addClass("pc"),c.show()}function N(a,b){a&&(b===Cb.DOLLHOUSE||b===Cb.FLOORPLAN?($(".allFloorBtn").show(),$("#lastFloorBtn").removeClass("lastFloorBtn")):($(".allFloorBtn").hide(),$("#lastFloorBtn").addClass("lastFloorBtn")),a.model.allFloorsVisible?($(".gui-floor-title").text(a.model.language.floor.all),$(".gui-floor-number").text(a.model.language.floor.all),$(".floorChoice").removeClass("active"),$('.floorChoice[data-index="all"]').addClass("active")):($(".gui-floor-title").text(a.name),location.host.indexOf(".biz")>-1&&(a.model.mlanguage_type=1),a.model.mlanguage_type===Wa.Chinese?$(".gui-floor-number").text(a.floorIndex+1+" "+a.model.language.floor.level):$(".gui-floor-number").text(a.model.language.floor.level+" "+(a.floorIndex+1)),$(".floorChoice").removeClass("active"),$(".floorChoice[data-index="+a.floorIndex+"]").addClass("active")))}function O(a){return a.describe().inTransition}function P(a){$("#gui-thumb").css({backgroundImage:"url("+a+")"}).show(),$("<img/>").attr("src",a).on("load",function(){$("#gui-thumb").css("transform","scale(1.1)"),$(this).remove()})}function Q(a,b,c,d){var e=new Ka({cameraMode:"panorama",position:d._camera._viewpoint,quaternion:d._camera._rotation,panoId:d._camera._locationid,orthoZoom:d._camera._zoom,floorVisibility:void 0!==d._camera.floor_visibility?d._camera.floor_visibility.slice(0):[],thumbUrl:d.shortcuturl,name:d.name,isHero:d.init_point,script:d.script?d.script:0});d._camera._rotation&&(e.quaternion=La.convertWorkshopQuaternion(d._camera._rotation)),0==a.heroLocations.length&&(e.isHero=!0),a.heroLocations.push(e),b.updateModel(),Lb=a.heroLocations.length;var f=100/Lb+"%",g=$("#thumb-container"),h=$("#progressBar");$("#status").find(".totalSteps").text(Lb);var i=a.heroLocations[Lb-1],j=$('<li class="thumbImg" data-index=""><img src=""></li>');if(j.attr("data-index",Lb-1),$b.highlight.visible&&j.find("img").attr("src",i.thumbUrl),i.name){var k=$('<div class="overlay"></div>').text(i.name);j.prepend(k)}if(a.has360Views&&i.cameraMode===Cb.PANORAMA){var l=a.panos.get(i.panoId),m=l&&!l.isAligned(),n=m?sb.isLocalVersion?'<div><img class="mark360View" src="image/has360.png"></div>':'<div><img class="mark360View" src="https://template2.3dnest.cn/common/image/has360.png"></div>':"";j.prepend(n)}if(g.append(j),$("#progressBar .step").css("width",f),h.append('<div class="step" data-idx="'+(Lb-1)+'" style="width:'+f+'"></div>'),ab=144*Lb,bb=111*Lb,$(".thumbImg").on("mouseover",function(){O(b)||c.showPathToHeroLocation($(this).data("index"))}),$(".thumbImg").on("mouseout",function(){b.clearPath()}),$(".thumbImg").on("click",function(a){q(a);var d=$(this);tb.trackAlways("USER",{event_type:"showcase_gui",gui_action:"click_highlight"}),$("#image-floor-container").hide(1e3),c.controls[Cb.PANORAMA].emit(Eb.InteractionGui,"thumbnail"),b.goToHighlight(d.data("index")),Xa.trackEvent(71,G.settings.nestscenes.scenes[d.data("index")].sceneid)}),$(".previous").find("a").on("click",function(a){q(a),tb.trackAlways("USER",{event_type:"showcase_gui",gui_action:"prev_highlight"}),b.prevHighlight()}),$(".next").find("a").on("click",function(a){q(a),tb.trackAlways("USER",{event_type:"showcase_gui",gui_action:"next_highlight"}),b.nextHighlight()}),$("#drawer").on("mouseleave",function(a){q(a);var b;try{b=new MouseEvent("mouseup",{clientX:a.clientX,clientY:a.clientY,screenX:a.screenX,screenY:a.screenY})}catch(c){b=document.createEvent("MouseEvents"),b.initMouseEvent("mouseup",a.bubbles,a.cancelable,a.view,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget)}document.dispatchEvent(b)}),_a&&_a.on("active",function(a,b){Mb=b,p("tour"),$(".step").removeClass("active"),$("#status").find(".curIdx").text(b+1);for(var c=0;c<=b;c++)$("#progressBar").find("[data-idx='"+c+"']").addClass("active")}),!Ya.isMobile())for(var o=["a","#title-toggle",".next-button",".prev-button",".gui-floor",".meta-toggle",".thumbImg","logo-button"],r=0;r<o.length;r++)$(o[r]).hasClass("noHover")||$(o[r]).addClass("hasHover");$(".overlay").css("bottom","-8px"),_a&&_a.reload()}function R(a){_a&&_a.slideTo(a),eb&&eb.slideTo(a)}function S(a,b,c){$("#pullTab").css("display","block"),$("#play").css("display","block"),Lb=a.heroLocations.length-1;var d=100/Lb+"%",e=$("#thumb-container"),f=$("#progressBar"),g=Ya.valueFromHash("lang");$("#status").find(".totalSteps").text(Lb);for(var h=0;h<Lb;h++){var i=a.heroLocations[h],j=$('<li class="thumbImg" data-index=""><img src=""></li>');if(j.attr("data-index",h),$b.highlight.visible&&j.find("img").attr("src",i.thumbUrl),i.name){g&&2===parseInt(g)&&"总述"===i.name&&(i.name="解説");var k=$('<div class="overlay"></div>').text(i.name);j.prepend(k)}if(a.has360Views&&i.cameraMode===Cb.PANORAMA){var l=a.panos.get(i.panoId),m=l&&!l.isAligned(),n=m?sb.isLocalVersion?'<div><img class="mark360View" src="image/has360.png"></div>':'<div><img class="mark360View" src="https://template2.3dnest.cn/common/image/has360.png"></div>':"";j.prepend(n)}e.append(j),f.append('<div class="step" data-idx="'+h+'" style="width:'+d+'"></div>'),1===i.script&&j.hide()}ab=144*Lb,bb=111*Lb,$(".thumbImg").on("mouseover",function(){O(b)||c.showPathToHeroLocation($(this).data("index"))}),$(".thumbImg").on("mouseout",function(){b.clearPath()}),$(".thumbImg").on("click",function(a){Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[13].desc,Ma.trigger,Ma.modelid]),G._hmt.push(["'"+Ma.type.custom+"'","'"+Za[13].id+"'","'"+Ma.modelid+"'"]),Xa.trackEvent(13)),q(a);var d=$(this);tb.trackAlways("USER",{event_type:"showcase_gui",gui_action:"click_highlight"}),$("#image-floor-container").hide(1e3),c.controls[Cb.PANORAMA].emit(Eb.InteractionGui,"thumbnail"),b.goToHighlight(d.data("index"))}),$(".previous").find("a").on("click",function(a){q(a),tb.trackAlways("USER",{event_type:"showcase_gui",gui_action:"prev_highlight"}),b.prevHighlight()}),$(".next").find("a").on("click",function(a){q(a),tb.trackAlways("USER",{event_type:"showcase_gui",gui_action:"next_highlight"}),b.nextHighlight()}),$("#drawer").on("mouseleave",function(a){q(a);var b;try{b=new MouseEvent("mouseup",{clientX:a.clientX,clientY:a.clientY,screenX:a.screenX,screenY:a.screenY})}catch(c){b=document.createEvent("MouseEvents"),b.initMouseEvent("mouseup",a.bubbles,a.cancelable,a.view,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget)}document.dispatchEvent(b)}),_a=new Sly($("#scrollFrame"),{horizontal:!0,itemNav:"centered",smart:!0,scrollTrap:!0,scrollBy:1,mouseDragging:!0,touchDragging:!0,speed:300,dragHandle:!0,dynamicHandle:!0,clickBar:!0,scrollBar:$("#scroller"),activateOn:null}).init(),eb=new Sly($("#scrollFrame-2nd"),{horizontal:!0,itemNav:"centered",smart:!0,scrollTrap:!0,scrollBy:1,mouseDragging:!0,touchDragging:!0,speed:300,dragHandle:!0,dynamicHandle:!0,clickBar:!0,scrollBar:$("#scroller-2nd"),activateOn:null}).init();new Kb("#shopSwiper",{direction:"horizontal",loop:!1,freeMode:!0,slidesPerView:"auto",freeModeSticky:!0,roundLengths:!0,observer:!0,observeParents:!0,initialSlide:0});_a&&_a.on("active",function(a,b){Mb=b,p("tour"),$(".step").removeClass("active"),$("#status").find(".curIdx").text(b+1);for(var c=0;c<=b;c++)$("#progressBar").find("[data-idx='"+c+"']").addClass("active")}),W()}function T(a,b){b=b||0,0==b&&($("ol#thumb-list li").eq(b).find(".bgIcon").addClass("opIcon"),$("ol#thumb-list li").eq(b).siblings().find(".bgIcon").removeClass("opIcon")),jb=a.commoditytypes[b].commodities,Yb=void 0!=jb.length?jb.length:1;var c=a.commoditytypes[b].mlanguage_type;a.mlanguage_enable?1==c?$("#commodity_search").attr("placeholder","Product search...."):2==c?$("#commodity_search").attr("placeholder","商品検索...."):$("#commodity_search").attr("placeholder","商品检索...."):$("#commodity_search").attr("placeholder","商品检索....");var d="折";1==c&&(d="Discount");var e=100/Yb+"%",f=$("#thumb-container-2nd"),g=$("#progressBar-2nd");$("#status-2nd").find(".totalSteps").text(Yb);for(var h=0;h<Yb;h++){var i=void 0!=jb.length?jb[h]:jb,j=$('<li class="thumbImg-2nd" data-index="" data-tagId=""><img src=""></li>');$('<div class="zheNew_tips" id="zheNew_tips"></div>');j.attr("data-index",h),j.attr("data-tagId",i.taginfo.id);var k=i.commodityinfo.commodity_carousel_img.split(",");if(k.length>0?$b.highlight2nd.visible&&j.find("img").attr("src",k[0]):$b.highlight2nd.visible&&j.find("img").attr("src",i.commodityinfo.commodity_carousel_img),i.commodityinfo.commodity_name){var l=$('<div class="goodsName"></div>').text(i.commodityinfo.commodity_name);j.prepend(l),j.find("img").after(l)}var m=i.commodityinfo.commodity_oprice,n=i.commodityinfo.commodity_price;if(n&&m){parseFloat(m)-parseFloat(n)>0&&'<span class="shopList_discount">'+d+"</span>"}var o=i.commodityinfo.commodity_new;parseInt(o)<=0&&(1==c?'<span class="shopList_new">New</span>':'<span class="shopList_new">新</span>'),f.append(j),g.append('<div class="step" data-idx="'+h+'" style="width:'+e+'"></div>')}document.getElementById("scrollFrame-2nd");fb=$("#scrollFrame-2nd").width(),gb=($(".thumbImg-2nd").width()+20)*Yb-20,fb<=gb?($(".changePage").show(),$("#scroller-2nd").removeClass("hidden")):($(".changePage").hide(),$("#scroller-2nd").addClass("hidden")),eb=new Sly($("#scrollFrame-2nd"),{horizontal:!0,itemNav:"centered",smart:!0,scrollTrap:!0,scrollBy:1,mouseDragging:!0,touchDragging:!0,speed:300,dragHandle:!0,dynamicHandle:!0,clickBar:!0,scrollBar:$("#scroller-2nd"),activateOn:null}).init();new Kb("#shopSwiper",{direction:"horizontal",loop:!1,freeMode:!0,slidesPerView:"auto",freeModeSticky:!0,roundLengths:!0,observer:!0,observeParents:!0,initialSlide:0})}function U(a,b,c){ib=a.commoditytypes,Zb=ib.length;var d=$("#thumb-list");if(0==$("#thumb-list:has(li)").length&&0==$("#thumb-list:has(p)").length||d.empty(),0!=Zb){$("#thumb-list").removeClass("text_layout");for(var e=0;e<Zb;e++){var f=ib[e];if(f.commodities.length&&0!=f.commodities.length){var g=$('<li class="swiper-slide pitchOn" data-ind=""><span class="bgIcon"></span></li>');if(g.attr("data-index",e),""!=f.commoditytype_name){var h=$('<a href="javascript:void(0)"></a>').text(f.commoditytype_name);g.prepend(h)}d.append(g)}}}else $("#thumb-list").append("<p class='no_goods'>没有商品!</p>").addClass("text_layout");$("#thumb-list li").eq(0).find("span").addClass("opIcon")}function V(a){function b(a){setTimeout(function(){document.getElementsByClassName("toast-wrap")[0].getElementsByClassName("toast-msg")[0].innerHTML=a;var b=document.getElementsByClassName("toast-wrap")[0];b.className=b.className.replace("toastAnimate",""),setTimeout(function(){b.className=b.className+" toastAnimate"},10)},10)}if(!a.moreHouse)return!1;for(var c=a.language,d=a.moreHouse.length,e=$(".ck-slide-wrapper"),f=$(".dot-wrap"),g="",h="",i=0,j=Math.ceil(d/3),k=$(".ck-pc-wrapper").width(),l=(a.modelid,0);l<d;l++){var m=a.moreHouse[l];Ya.isMobile()?0===l?(g+='<li class="ckSlide"><a href='+m.src+"><img src="+m.img_url+' alt="image"><p>'+m.text+"</p></a></li>",h+='<li class="current"></li>'):(g+='<li class="ckSlide" style="display: none"><a href='+m.src+"><img src="+m.img_url+' alt="image"><p>'+m.text+"</p></a></li>",h+='<li class=""></li>'):g+='<li class="ckSlide"><a href='+m.src+' target="_blank"><img src='+m.img_url+' alt="image"><p>'+m.text+"</p></a></li>"}$("#moreHouse").on("click",function(){Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[10].desc,Ma.trigger,Ma.modelid]),G._hmt.push(["'"+Ma.type.custom+"'","'"+Za[10].id+"'","'"+Ma.modelid+"'"]),Xa.trackEvent(10)),e.append(g),f.append(h),$("#morebg").css("display","block"),Ya.isMobile()?Oa.init():($(".pck-slide").css("display","flex"),$(".ck-slide-wrapper").css("width",j*k+"px"),$(".ck-next").on("click",function(){if(i>=j-1)return b(c.noMore),!1;i++,$(".ck-slide-wrapper").stop().animate({"margin-left":-i*k})}),$(".ck-prev").on("click",function(){if(i<=0)return!1;i--,$(".ck-slide-wrapper").stop().animate({"margin-left":-i*k})}))})}function W(){var a=window.innerWidth-20,b=$("#scroller"),c=$("#drawer"),d=$("#drawer-2nd"),e=$(".pinBottom");if(window.innerWidth<488||window.innerHeight<488)b.addClass("hidden"),c.addClass("noScroll"),d.addClass("noScroll"),e.addClass("noScroll");else{ab>a!==!c.hasClass("noScroll")&&(b.toggleClass("hidden"),c.toggleClass("noScroll"),d.toggleClass("noScroll"),e.toggleClass("noScroll"))}}function X(a){var b=function(a,b){$b[a].visible=b};b("address",a.address),b("email",a.contact_email),b("contactName",a.contact_name),b("phone",a.contact_phone),b("titleContainer",a.model_name),b("description",a.model_summary),b("coBrand",a.presented_by),b("highlight",a.highlight_reel),b("tourControls",a.tour_buttons),b("businessname",a.businessname),b("innerimage",a.innerimage),b("bottompresentedby",a.bottom_presented_by),1===sb.specialEdition&&($b.coBrand.visible=!1,$b.highlight.visible=!1),sb.showHighlights||($b.highlight.visible=!1),sb.showTitleContainer||($b.titleContainer.visible=!1),sb.brand&&!sb.mls||($b.coBrand.visible=!1,$b.contact.visible=!1)}function Y(a,b){$(".model-title").text(a.name),$(".titlecontent").text(a.name),$(".meta-title").text(a.name),$("head title").text(a.name);var c=$(".titleText");if(c.text(a.name),a.name.length>19&&c.attr("title",a.name),Ya.isMobile()?$("#gui-fullscreen, #barrage-switch").css("display","none"):$("[rel=tooltip]").tooltip({delay:{show:50,hide:0},trigger:"hover",html:!1,viewport:{selector:"body",padding:10}}),$b.coBrand.visible&&a.hasOwnProperty("presented_by")&&a.presented_by?($("#cobrandTitle").text(a.presented_by),$("#loaderCoBrandName").text(a.presented_by),$("#presented-by").text(a.presented_by)):$b.coBrand.visible=!1,$b.description.visible&&a.hasOwnProperty("summary")&&a.summary?$("#meta-description").html(a.summary):$b.description.visible=!1,$b.contact.visible){var d=b.language;if($b.contactName.visible&&a.hasOwnProperty("contact_name")&&a.contact_name&&($("#contact-data").css("display","block"),$("#contact-data").append('<span id="contactName"></span>').text(d.linkMan+"："+a.contact_name),!1),$b.phone.visible&&a.hasOwnProperty("contact_phone")&&a.contact_phone){var e=a.contact_phone;$("#contact-data").css("display","block"),Ya.isMobile()?$("#contact-data").append('<a id="phone" href="callto:'+a.contact_phone+'">'+d.contact+"："+e+"</a>"):$("#contact-data").append("<span>"+d.contact+"："+e+"</span>"),Ya.isMobile()?($("#phone-topbar-li").css("display","block"),$("#phone-topbar").attr("href","tel:"+a.contact_phone)):$("#phone-topbar-li").css("display","none")}}if($b.address.visible&&a.hasOwnProperty("address")&&a.address){var f=a.address;$("#contact-data").css("display","block"),$("#contact-data").append('<br><span style="float: left">'+d.address+'：</span><div style="white-space:normal;width:270px;">'+f+"</div>")}else $b.address.visible=!1;var g=$b.businessname.visible&&a.hasOwnProperty("businessname")&&a.businessname;g?($("#supportTxt").css("display","block"),$("#supportTxt").text(a.businessname)):$("#supportTxt").css("display","none");var h=$b.innerimage.visible&&a.hasOwnProperty("innerimage")&&a.innerimage;h?($(".support .qrimg").css("display","block"),$(".qrimg").attr("src",a.innerimage)):$(".support .qrimg").css("display","none"),g||h||$(".support").css("display","none"),$(".meta-toggle").on("click",function(a){q(a),A()}),$("#meta-description").find("a").on("click",function(a){tb.trackAlways("USER",{event_type:"about_link"})}),$(".contact-info a").on("click",function(a){var b={event_type:"about_link"};switch($(this).attr("id")){case"phone":b.contact_type="phone";break;case"email":b.contact_type="email"}tb.trackAlways("USER",b)}),$(".address a").on("click",function(a){tb.trackAlways("USER",{event_type:"map_link"})})}function Z(a,b,c){function d(){za(),c?(Ca(),g()):s(f)}Va.init(a),ja(),Ta.init(a),a.data.player_options.bottom_presented_by&&$(".message-technology").html(a.data.bottom_presented_by);var e=$.Deferred(),f=e.resolve.bind(e);if(Qb=!0,aa(a),na(a),a.data.player_options&&X(a.data.player_options),a.normalMovie||($b.highlight.visible=!1),1===sb.specialEdition&&$("body").addClass("specialEdition"),Y(a.data,a),da(a),c){var h=$("#quick-overlay");(Ya.isMobile()?h.find(".desktop"):h.find(".mobile")).addClass("hidden")}else $(".quick").addClass("hidden");return a.inside_limit&&(sb.insideLookLimitUp=a.inside_limit,sb.insideLookLimitDown=-a.inside_limit),!c&&Ya.isMobile()&&a.data.mobileimg?P(a.data.mobileimg):c||Ya.isMobile()||!a.data.image||P(a.data.image),b?(tb.impression(),d()):xb.show(c,d),e}function _(a){if(a.t_logo_enable){var b=a.t_logo_url;b&&(a.back_url&&$("#userlogo").addClass("left"),$("#userlogo").css("display","block"),$(".loadingLogo, .logoimg").css("background-image","url("+b+")"))}}function aa(a){if(!0===a.loading_enable)if(Ya.isMobile()&&a.data.mobileimg){$("#intoModel").css("display","block");for(var b=a.language.intoModel.split(" "),c=0;c<b.length;c++){var d='<p class="intoBounce" style="animation-delay: '+c/10+'0s">'+b[c]+"</p>";$("#intoModel").append(d)}}else if(!Ya.isMobile()&&a.data.image){$("#intoModel").css("display","block");for(var b=a.language.intoModel.split(" "),c=0;c<b.length;c++){var d='<p class="intoBounce" style="animation-delay: '+c/10+'0s">'+b[c]+"</p>";$("#intoModel").append(d)}}else $("#circleLoader").css("opacity","1");else $("#circleLoader").css("opacity","1");$("#gui-loading").on("click",function(){$("#progressNum").text().replace("%","")>=100?$("#gui-loading, #gui-thumb").fadeOut(2500,function(){$("#gui-loading-splash").attr("src",""),$(".loadingLogo").hide(),a.loading_enable&&G.d.autoTour()}):($("#circleLoader").animate({opacity:"1"},1e3).addClass("clickIntoModel"),$("#intoModel").fadeOut(1e3))})}function ba(){return/micromessenger/.test(navigator.userAgent.toLowerCase())}function ca(a){if(wx.config({debug:!1,appId:"",timestamp:1,nonceStr:"",signature:"",jsApiList:[]}),wx.ready(function(){var b=window.document.getElementById("audio-bar");b.loop=a.loop,b.src=a.url,b.play()}),parent!==window){$("#audio-btn-on").removeClass("audioon").addClass("audiooff");var b=window.document.getElementById("audio-bar");b.loop=a.loop,b.src=a.url,b.muted="muted"}}function da(a){var b=a.data;if(b.audio&&b.audio.enable&&b.audio.url){$("#audio-btn-on").css("display","block"),$("#audio-btn-on").click(function(){Za&&G._hmt&&(G._hmt.push(["_trackEvent",Za[6].desc,Ma.trigger,Ma.modelid]),G._hmt.push(["'"+Ma.type.custom+"'","'"+Za[6].id+"'","'"+Ma.modelid+"'"]),Xa.trackEvent(6)),c(),$("#audio-btn-on").hasClass("audioon")?$("#audio-btn-on").removeClass("audioon").addClass("audiooff"):$("#audio-btn-on").hasClass("audiooff")&&$("#audio-btn-on").removeClass("audiooff").addClass("audioon")});var c=function(){var a=window.document.getElementById("audio-bar");a.muted?(a.muted=void 0,a.play()):a.muted="muted"};if("iOS"===$.ua.os.name){if(ba())return void ca(b.audio);var d=window.document.getElementById("audio-bar");if(b&&b.audio&&($("#audio-btn-on").removeClass("audioon").addClass("audiooff"),d.autoplay="",d.loop=null!=b.audio.loop?b.audio.loop:"loop",d.src=null!=b.audio.url?b.audio.url:""),c(),!ba()){var e=!1;document.addEventListener("touchend",function(a){if(!e&&d.paused&&b&&b.audio&&b.audio.url)try{d.muted=void 0,d.autoplay="autoplay",d.loop=null!=b.audio.loop?b.audio.loop:"loop",d.src=null!=b.audio.url?b.audio.url:"",d.play()}catch(a){console.log("music error,",a),e=!1}finally{setTimeout(function(){d.paused||(e=!0,$("#audio-btn-on").removeClass("audiooff").addClass("audioon"))},300)}},!1)}}else{var d=window.document.getElementById("audio-bar");if(b&&b.audio){d.autoplay="autoplay",d.loop=null!=b.audio.loop?b.audio.loop:"loop",d.src=null!=b.audio.url?b.audio.url:"";var f=d.play(),g=navigator.userAgent,h=g.indexOf("compatible")>-1&&g.indexOf("MSIE")>-1,i=g.indexOf("Trident")>-1&&g.indexOf("rv:11.0")>-1;h||i||f.then(function(){}).catch(function(){$("#audio-btn-on").removeClass("audioon").addClass("audiooff"),d.muted="muted"})}}}a.oauth&&!Ya.isMobile()&&$("#barrage-switch").css("display","block")}function ea(a,b,c,d){function e(){$(".nav-help-dialog").fadeOut(300,function(){}),$(".helpclose").fadeOut(300),$(".help_back").fadeOut(300),$(".measureClose").fadeOut(300),$("#measureHelp").fadeOut(300),$(".comment").css("display","none"),$("#initial-help").fadeOut(300)}if(Ja.init(a,c,b),function(){Ya.isMobile()?$("#initial-help").addClass("init-mobile-help"):$("#initial-help").addClass("init-pc-help")}(),a.outsideAllowed()||$("#gui-modes-outside").addClass("invisible"),vb.navHelpSessionStart(c,d,p,a),Fb.init(a,b,c),$(".icon").on("mouseover",function(){b.player&&b.player.reticule.hide()}),D(a,b),sb.isNewEditVersion&&window.parent.NestP&&window.parent.NestP.getPath){"/model/roam/"==window.parent.NestP.getPath()?$b.highlight.visible=!1:(L(b,a),a.normalMovie>0?S(a,b,c):($b.highlight.visible=!1,$b.tourControls.visible=!1),Ba())}else L(b,a),a.normalMovie>0?S(a,b,c):($b.highlight.visible=!1,$b.tourControls.visible=!1),Ba();a&&(lb=a,mb=b,ob=c,kb=!1,void 0==lb.commoditytypes||0==lb.commoditytypes.length?$b.highlight2nd.visible=!1:U(a,b,c)),$("ol#thumb-list").on("click","li",function(a){$(this).find(".bgIcon").addClass("opIcon"),$(this).siblings().find(".bgIcon").removeClass("opIcon");var b=$(this).index(),c=$("#thumb-container-2nd");0!=$("#thumb-container-2nd:has(li)").length&&c.empty(),hb=b,1==kb?T(nb,hb):T(lb,hb)}),$("#thumb-container-2nd").on("click",".thumbImg-2nd",function(){var b=$(this).attr("data-tagId");console.log(b+"ojhgfd"),$("#commodityTag").fadeOut(300),a.flyToTagid(b)}),$(".prevPage").on("click",function(){eb.prevPage()}),$(".nextPage").on("click",function(){eb.nextPage()}),C(b,c),a.on("floor.changed",N),a.on("waiting",la.bind(this,a)),a.on("waiting-done",ma.bind(this,a)),b.on("tourStop",I.bind(this,a)),c.on(Db.ModeChanged,function(d,e){if(C(b,c),g(b,c),Wb){var f=1;"floorplan"==e&&(f=3),3==f?($("#toprightbar").css("display","block"),Ya.isMobile()&&$("#rightbar").addClass("has-measure-m"),Xb?$("#rightbar").css("display","none"):($("#rightbar").css("display","block"),2==f&&(a.alpha=0),Wb.updateMode(f))):(Ya.isMobile()&&$("#rightbar").removeClass("has-measure-m"),$("#toprightbar").css("display","none"),$("#play").hasClass("play")&&$("#rightbar").css("display","block"))}}),c.on(Db.WarpEnded,function(b,c){!a.data.player_options.autoplay&&Vb&&($("#play a").mousedown(),Vb=!1)}),c.on(Db.FlyingEnded,function(a,b,c,d){sb.isEditVersion&&(c&&c.updateAngleDisplay(),c&&c.updateColorDisplay()),sb.isProduceVersion&&c&&c.updateTAngleDisplay(),G.player.mattertagManager.ttflying=!1,G.player.mattertagManager.updateTitleTags(),Ya.isIe.versions.trident||Ya.isEdge.versions.Edge||G.player.mattertagManager.wtposition()}),c.on(Db.Ready,function(){$b.bottompresentedby.visible&&a.data.bottom_presented_by&&$(".bottom_presented_container").css("display","block"),c.on(Db.ModeChanged,function(a,b){a!==b&&$(".vr-popup").is(":visible")&&zb.dismiss()})}),c.on(Db.PanoChosen,function(a,d){C(b,c,d)}),c.on(Db.EditAddTagHighlight,function(a){if(sb.isNewEditVersion)G.sendTag(a);else{var b="";sb.isEditVersion&&(2==a.type?b+="<a id='edit_add_360tag_a' href='javascript:;'>添加360标签</a><BR/><BR/>":(parent.location.href.indexOf("nest/tag")>-1&&(b+="<a id='edit_add_tag_a' href='javascript:;'>添加标签</a><br><br>"),parent.location.href.indexOf("nest/highlights")>-1&&(b+="<a id='edit_add_highlight_a' href='javascript:;'>添加场景</a><BR/><BR/>"),parent.location.href.indexOf("nest/orientations")>-1&&(b+="<a id='edit_add_orientation_a' href='javascript:;'>添加定位点</a><BR/><BR/>"))),$("#editversion-capture").css("display","block"),$("#editversion-capture").css("left",event.clientX+5),$("#editversion-capture").css("top",event.clientY+5),$("#editversion-capture").html(b),$("#edit_add_tag_a").on("click",function(b){Ja.add_tag(a.locationid,a.x,a.y,a.z,a.nx,a.ny,a.nz,a.dx,a.dy,a.dz,a.qw,a.qx,a.qy,a.qz)}),$("#edit_add_highlight_a").on("click",function(b){Ja.add_scene(a.locationid,a.qw,a.qx,a.qy,a.qz)}),$("#edit_add_orientation_a").on("click",function(b){Ja.add_orientation(a.locationid,a.qw,a.qx,a.qy,a.qz)}),$("#edit_add_360tag_a").on("click",function(b){Ja.add_360_tag(a.panoid,a.x,a.y,a.z)})}}),c.controls[Cb.PANORAMA].on("move",function(){p("move")}),c.controls[Cb.DOLLHOUSE].on("move",function(){p("move")}),c.controls[Cb.FLOORPLAN].on("move",function(){p("move")}),b.on("update.controls",function(){var d=b.describe();$b.tourControls.visible&&(d.tourIsPlaying||c.isWarping()?d.tourIsPlaying&&($(".pinBottom").addClass("playing"),$("#drawer").addClass("playing"),this.currentScript||$("#playHead").addClass("playing")):($(".pinBottom").removeClass("playing"),$("#drawer").removeClass("playing"),$("#multiplier-speed").fadeOut(300).find("ul").animate({opacity:"0"},300),G.playing=!1,f(!0),$("#playHead").removeClass("playing"),$("#play").removeClass("pause").addClass("play")));var e,h,i,j=$("#progressBar"),k=$("#thumb-container");if(null!==d.currentItem){var l,m;$("#status").find(".curIdx").text(d.currentItem+1),d.onTheBus?(l="active",m="recent"):(m="active",l="recent");var n=null===d.destinationItem||d.currentItem===d.destinationItem;for(e=0;e<a.heroLocations.length;e+=1)i=k.find("[data-index='"+e+"']"),h=j.find("[data-idx='"+e+"']"),i.removeClass(m),h.removeClass(m),d.onTheBus&&e===d.destinationItem?(i.addClass(l),h.addClass(l),_a&&_a.activate(e)):d.onTheBus&&n&&e===d.currentItem?(i.addClass(l),h.addClass(l)):(i.removeClass(l),h.removeClass(l))}else for(e=0;e<a.heroLocations.length;e+=1)i=k.find("[data-index='"+e+"']"),h=j.find("[data-idx='"+e+"']"),i.removeClass("active"),i.removeClass("recent"),h.removeClass("active"),h.removeClass("recent");g(b,c)}.bind(b)),Ya.isMobile()||(document.addEventListener("keydown",function(d){switch(d.which){case Bb.ZERO:sb.debug&&a.toggleAlpha();break;case Bb.ONE:c.model.has360Views&&!c.isInMode(Cb.TRANSITIONING)?c.isInMode(Cb.PANORAMA)&&c.currentPano.isAligned()||(c.controls[Cb.PANORAMA].emit(Eb.InteractionKey),b.tourIsPlaying?b.stopTour():c.goToLastView(!0)):c.isInMode(Cb.PANORAMA,Cb.TRANSITIONING)||b.changeMode(Cb.PANORAMA,"key");break;case Bb.TWO:a.outsideAllowed()&&!c.isInMode(Cb.DOLLHOUSE,Cb.TRANSITIONING)&&b.changeMode(Cb.DOLLHOUSE,"key");break;case Bb.THREE:a.outsideAllowed()&&!c.isInMode(Cb.FLOORPLAN,Cb.TRANSITIONING)&&b.changeMode(Cb.FLOORPLAN,"key");break;case Bb.FOUR:c.model.has360Views&&!c.isInMode(Cb.TRANSITIONING)&&(c.isInMode(Cb.PANORAMA)&&!c.currentPano.isAligned()||(c.controls[Cb.PANORAMA].emit(Eb.InteractionKey),b.tourIsPlaying?b.stopTour():c.goToLastView(!1)));break;case Bb.SPACE:sb.debug&&a.toggleExplode();break;case Bb.RETURN:sb.debug&&a.toggleExplodeUp();break;case Bb.P:ya();break;case Bb.U:ua();break;case Bb.PLUSEQUALS:b.player.activatePersistentZooming(!0);break;case Bb.DASHUNDERSCORE:b.player.activatePersistentZooming(!1);break;case Bb.SEVEN:Hb.info("Zoom level: "+b.player.zoomLevel+", FOV: "+b.player.zoomFov);break;case Bb.EIGHT:b.player.decreaseZoomSpeed();break;case Bb.NINE:b.player.increaseZoomSpeed()}return c&&c.reticule.hide(),!0}.bind(this)),document.addEventListener("keyup",function(a){switch(a.which){case Bb.PLUSEQUALS:b.player.deactivatePersistentZooming();break;case Bb.DASHUNDERSCORE:b.player.deactivatePersistentZooming()}}.bind(this))),va(a),oa(a,b.player),ka(c),Ha.init(a),Ra.init(a),fa(a),_(a),ha(a),ga(a),V(a),sb.isEditVersion&&ia(b,a),!a.catalogue||1!==a.catalogue.displaytype&&2!==a.catalogue.displaytype?a.catalogue&&0!==a.catalogue.displaytype||!a.moreHouse||$("#moreHouse").css("display","block"):(pa(a),Ya.isMobile()?$("#m-opencatalog").show():$(".breathLight").fadeIn(2e3)),$(".moreclose").on("click",function(a){a.preventDefault(),a.stopImmediatePropagation(),$(".ck-slide").fadeOut(300),$(".pck-slide").fadeOut(300),$("#morebg").fadeOut(300),$(".ck-slide-wrapper").empty(),$(".dot-wrap").empty()}),$(".helpclose, .help_back, .measureClose").on("click",function(a){a.preventDefault(),a.stopImmediatePropagation(),e()}),$("#unit-m").click(function(){$(".unit-selection").toggleClass("unit-toggle");for(var a=0;a<G.m.measurements.length;a++)G.m.measurements[a].update()}),$("#unit-ft").click(function(){$(".unit-selection").toggleClass("unit-toggle");for(var a=0;a<G.m.measurements.length;a++)G.m.measurements[a].update()})}function fa(a){a.back_url&&($("#back-url").show(),console.log("url-modelid:",pb.getModelIDFromQueryString()),Ya.isWeixin()&&"longfor_1"===pb.getModelIDFromQueryString()?wx.miniProgram.getEnv(function(b){console.log("getEnv",b),b.miniprogram?($(".backimg").attr("href","void(0);"),$("#back-url").on("click",function(a){return a.preventDefault(),console.log("zhuge 行为上报"),zhuge.track("行为上报",{"端":"H5","业务城市ID":"36","用户所在城市ID":"","项目ID":276,"用户ID":"","户型名称":"","页面类型":"楼盘信息","页面名称":"熙湖悦著VR","统计数据类型":"行为上报","行为类型":"2020021505","行为名称":"2020021506","行为参数":""}),wx.miniProgram.navigateTo({
url:"/pages/project/projectInfo/projectInfo?pid=276"}),!1})):$(".backimg").attr("href",a.back_url)}):$(".backimg").attr("href",a.back_url))}function ga(a){var b=pb.getModelIDFromQueryString();if(a.visiotors_enable){if($("#page-view").show(),"block"===$("#userlogo").css("display")||"block"===$("#back-url").css("display")){$("#page-view").addClass("up");var c=!0}G.settings.basic.menu.compass_enable&&(c?$("#page-view").addClass("below"):$("#page-view").addClass("middle"));var d="https://user.3dnest.cn/show/get_visitors";sb.isTestVersion&&(d="https://test.3dnest.cn/show/get_visitors"),$.ajax({type:"GET",url:d,dataType:"json",data:{nest_id:b},success:function(a){if(0===a.code){var b=a.data;$(".page-view").html(b)}}})}}function ha(a){"block"!==$("#userlogo").css("display")&&"block"!==$("#back-url").css("display")||($a+=50),$a+=0,$(".compass").css("top",$a+"px"),$(".indoordir").css("top",$a+"px"),$(".indoorscale").css("top",$a+"px"),Ya.isMobile()&&($(".compass").css("width","60px"),$(".indoordir").css("width","60px"),$(".indoorscale").css("width","60px"),$(".compass").css("height","60px"),$(".indoordir").css("height","60px"),$(".indoorscale").css("height","60px"),$(".compass").css("background-size","60px 60px"),$(".indoordir").css("background-size","60px 60px"),$(".indoorscale").css("background-size","60px 60px"),$(".compass").css("-webkit-background-size","60px 60px"),$(".indoordir").css("-webkit-background-size","60px 60px"),$(".indoorscale").css("-webkit-background-size","60px 60px")),a.mlanguage_enable&&a.mlanguage_type&&($(".compass").addClass("foreign"),$(".indoordir").addClass("foreign"),$(".indoorscale").addClass("foreign"))}function ia(a,b){if(parent.window.adjustColor&&(sb.adjustColor=!0),sb.adjustColor){var c={brightness:0,contrast:0,gamma:100,hue:0,saturation:0,vibrance:0,balance_R:0,balance_G:0,balance_B:0};console.log("adjustColor");var d=new Gb.GUI({width:500});d.add(c,"brightness",-100,100).step(.01).onChange(function(c){a.player.currentPano&&a.player.currentPano.changeColor(b,"brightness",c)}),$(".property-name","#dat-brightness").text("亮度(brightness)"),d.add(c,"contrast",-100,100).step(.01).onChange(function(c){a.player.currentPano&&a.player.currentPano.changeColor(b,"contrast",c)}),$(".property-name","#dat-contrast").text("对比度(contrast)"),d.add(c,"gamma",0,300).step(.01).onChange(function(c){a.player.currentPano&&a.player.currentPano.changeColor(b,"gamma",c)}),$(".property-name","#dat-gamma").text("伽马矫正(gamma)"),d.add(c,"hue",-100,100).step(.01).onChange(function(c){a.player.currentPano&&a.player.currentPano.changeColor(b,"hue",c)}),$(".property-name","#dat-hue").text("色调(hue)"),d.add(c,"saturation",-100,100).step(.01).onChange(function(c){a.player.currentPano&&a.player.currentPano.changeColor(b,"saturation",c)}),$(".property-name","#dat-saturation").text("饱和度(saturation)"),d.add(c,"vibrance",-100,100).step(.01).onChange(function(c){a.player.currentPano&&a.player.currentPano.changeColor(b,"vibrance",c)}),$(".property-name","#dat-vibrance").text("自然饱和度(vibrance)"),d.add(c,"balance_R",-100,100).step(.01).onChange(function(c){a.player.currentPano&&a.player.currentPano.changeColor(b,"balance_R",c)}),$(".property-name","#dat-balance_R").text("红色通道调整(balance_R)"),d.add(c,"balance_G",-100,100).step(.01).onChange(function(c){a.player.currentPano&&a.player.currentPano.changeColor(b,"balance_G",c)}),$(".property-name","#dat-balance_G").text("绿色通道调整(balance_G)"),d.add(c,"balance_B",-100,100).step(.01).onChange(function(c){a.player.currentPano&&a.player.currentPano.changeColor(b,"balance_B",c)}),$(".property-name","#dat-balance_B").text("蓝色通道调整(balance_B)"),$(".container-adjust-color").show(),$("#input_color_reset").on("click",function(){a.player.currentPano&&a.player.currentPano.resetColor(b)}),$("#input_color_applyall").on("click",function(){a.player.currentPano&&a.player.currentPano.applyAllColor(b)}),$("#submit_form_colors").on("click",function(){Ja.add_colors()})}}function ja(){function a(a,b){function c(a){var c=a||window.event,d=!0;return d=c.detail?c.detail>0:c.wheelDelta<0,b&&b.call(this,d,c),c.preventDefault&&c.preventDefault(),!1}a.onmousewheel=c,a.addEventListener&&a.addEventListener("DOMMouseScroll",c,!1)}function b(a,b){function c(a){o=parseInt(a.css("left")),p=parseInt(a.css("top")),q=a.width(),r=a.height()}var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=!1,t=$(a),u=t.width(),v=t.height(),w=parseFloat(u/v),x=[],y=parseInt($(b).css("top"));return $(a).on("touchstart touchmove touchend",$(a).parent().selector,function(b){var v=$(a),z=b.originalEvent.targetTouches[0],A=b.originalEvent.targetTouches[1],B=b.originalEvent.touches.length;if("touchstart"==b.type)2==B?(d=z.pageX-A.pageX,f=z.pageY-A.pageY,i=Math.sqrt(d*d+f*f),s=!1):1==B&&(k=z.pageX,m=z.pageY,s=!0),c(v);else if("touchmove"==b.type){var C=$(".picsize").attr("data-with");$(".picsize").attr("data-height");if(2==B){e=z.pageX-A.pageX,g=z.pageY-A.pageY,j=Math.sqrt(e*e+g*g),h=j-i;var D;h>0?D=!0:h<0&&(D=!1),!D&&C<u+h?v.css({width:u+h,height:(u+h)/w,left:o,top:p}):D&&3*C>u+h&&v.css({width:u+h,height:(u+h)/w,left:o,top:p})}else if(1==B){l=z.pageX,n=z.pageY;var E=o+(l-k),F=p+(n-m),G=v.width()/2,H=v.height()/2;E-v.width()/2<0&&Math.abs(E-v.width()/2)>v.width()-document.documentElement.clientWidth/2?E=-G+document.documentElement.clientWidth/2:E-v.width()/2>document.documentElement.clientWidth-document.documentElement.clientWidth/2&&(E=document.documentElement.clientWidth/2+v.width()/2),F-v.height()/2<0&&Math.abs(F-v.height()/2)>v.height()-document.documentElement.clientWidth/2?F=-H+document.documentElement.clientWidth/2:F-v.height()/2>document.documentElement.clientHeight-H&&(F=document.documentElement.clientHeight-H+v.height()/2),s&&v.css({left:E,top:F})}}else"touchend"==b.type&&(u=t.width(),c(v),x=[[o,p-y,q,r],[0,0,640,640]])}),{imgData:function(){return x}}}function c(){if("iOS"===$.ua.os.name&&!ba()){var a=window.document.getElementById("audio-tag");window.document.getElementById("audio-tag").volume=.7,a.muted&&(a.muted=void 0,a.play())}}for(var d=G.settings.nestscenes.scenes,e=0,f=0;f<d.length;f++)0!==d[f].script&&void 0!==d[f].script||e++;if(G.d.sLen=e,!Ya.isMobile()){$(".rightbar").css("top","auto"),$(".rightbar").css("bottom","45px"),$(".overlay").css("bottom","-8px");var g=107*e+10;g>.8*window.innerWidth?$(".fullWidth .frame-container").css("width","80%"):$(".fullWidth .frame-container").css("width",g+"px"),$("#pullTab").addClass("pc"),$("#play").addClass("pc"),$("#gui-vr-on").addClass("pc"),$("#gui-modes-outside").addClass("pc"),$("#footer-help").addClass("pc"),$("#audio-btn-on").addClass("pc"),$("#barrage-switch").addClass("pc"),$(".bplusx").addClass("pc"),$("#meta-info").addClass("pc"),$(".nav-help-dialog").addClass("pc"),$(".helpclose").addClass("pc"),$("#outermap-on").addClass("pc"),$("#userlogo").addClass("pc"),$("#page-view").addClass("pc"),$(".loadingLogo").addClass("pc"),$("#amap-container").addClass("pc"),$("#moreHouse").addClass("pc"),$(".cs-slide-pc .ck-prev").addClass("pc"),$(".cs-slide-pc .ck-next").addClass("pc")}$("#menu-info-close, .bplusx").on("click",function(){$("#mainmenu").fadeOut(300),$(".help_back").css("display","none")}),$(".imageCon").on("click",function(){event.stopPropagation(),event.cancelBubble=!0;var a=$(this).attr("src"),b=qb.getWinSize(a);$(".originpic").css("background-image","url("+a+")"),$(".picsize").css({width:b.width,height:b.height}),$(".picsize").attr("data-with",b.width),$(".picsize").attr("data-height",b.height),$("#picsizeScroll").css({left:"50%",top:"50%",transform:"translate(-50%, -50%)"}),$(".originpic-container").fadeIn(300)});var h=!1,i=0,j=0;$(".originpic-container").on("click",function(a){$(".originpic-container").fadeOut(300)}),$(".picsize").on("click",function(a){h?(h=!1,a.stopPropagation(),a.cancelBubble=!0):(a.stopPropagation(),a.cancelBubble=!0)});var k=document.getElementById("picsizeScroll");k.addEventListener&&(k.addEventListener("mousewheel",a(k,function(a,b){var c=$(".picsize").attr("data-with"),d=($(".picsize").attr("data-height"),this.offsetWidth),e=this.offsetHeight,f=this.offsetLeft,g=this.offsetTop,h=(b.clientX-f)/d,i=(b.clientY-g)/e;a&&c>d?(this.style.width=.9*this.offsetWidth+"px",this.style.height=.9*this.offsetHeight+"px"):0==a&&3*c>1.1*d&&(this.style.width=1.1*this.offsetWidth+"px",this.style.height=1.1*this.offsetHeight+"px");var j=this.offsetWidth,k=this.offsetHeight;this.style.left=f-h*(j-d)+"px",this.style.top=g-i*(k-e)+"px"}),!1),k.addEventListener("DOMMouseScroll",a(k,function(a,b){var c=$(".picsize").attr("data-with"),d=($(".picsize").attr("data-height"),this.offsetWidth),e=this.offsetHeight,f=this.offsetLeft,g=this.offsetTop,h=(b.clientX-f)/d,i=(b.clientY-g)/e;a&&c<d?(this.style.width=.9*this.offsetWidth+"px",this.style.height=.9*this.offsetHeight+"px"):0==a&&3*c>1.1*d&&(this.style.width=1.1*this.offsetWidth+"px",this.style.height=1.1*this.offsetHeight+"px");var j=this.offsetWidth,k=this.offsetHeight;this.style.left=f-h*(j-d)+"px",this.style.top=g-i*(k-e)+"px"}),!1));var l,m,n=document.querySelector(".picsize");document.querySelector(".originpic-container");if(n.onmousedown=function(a){i=(new Date).getTime(),l=!0,m=!0;var a=a||window.event;a.stopPropagation(),a.cancelBubble=!0;var b,c;l&&(b=a.clientX-n.offsetLeft,c=a.clientY-n.offsetTop),document.onmousemove=function(a){a.stopPropagation(),a.cancelBubble=!0,l||(document.onmousemove=null);var d=a.clientX-b,e=a.clientY-c,f=n.offsetWidth/2,g=n.offsetHeight/2;d-n.offsetWidth/2<0&&Math.abs(d-n.offsetWidth/2)>f?d=-f+n.offsetWidth/2:d-n.offsetWidth/2>document.documentElement.clientWidth-f&&(d=document.documentElement.clientWidth-f+n.offsetWidth/2),e-n.offsetHeight/2<0&&Math.abs(e-n.offsetHeight/2)>g?e=-g+n.offsetHeight/2:e-n.offsetHeight/2>document.documentElement.clientHeight-g&&(e=document.documentElement.clientHeight-g+n.offsetHeight/2),n.style.left=d+"px",n.style.top=e+"px"},document.onmouseup=function(a){return j=(new Date).getTime(),j-i<200&&(h=!0),document.onmousemove=null,document.onmouseup=null,a.stopPropagation(),a.cancelBubble=!0,!1}},Ya.isMobile()){var o=document.querySelector("#picsizeScroll"),p=$("#picsizeScroll"),q=$("#containerScroll");o.addEventListener("touchstart",function(a){b(p,q)})}Ya.isMobile()?($(".titlecontent").hide(),$("#openmenu").hide(),$("#m-openmenu").show().on("click",function(){$(".help_back").css("display","block"),$("#mainmenu").css("display","block"),$("#meta-info").css("display","block"),c()})):$(".titlecontent, #openmenu").on("click",function(){$("#mainmenu").fadeIn(300),$("#meta-info").fadeIn(300),$(".help_back").css("display","block"),c()})}function ka(a){var b=function(a,b){$(a).find("a").each(function(a,c){b?$(c).removeClass("buttonZoomDisabled").addClass("buttonZoomEnabled"):$(c).addClass("buttonZoomDisabled").removeClass("buttonZoomEnabled"),c.style.pointerEvents=b?"auto":"none"})};a.on(Ib.ZoomMax,function(){b("#gui-zoomin",!1),b("#gui-zoomout",!0)}),a.on(Ib.ZoomMin,function(){b("#gui-zoomin",!0),b("#gui-zoomout",!1)}),a.on(Ib.ZoomIn,function(){b("#gui-zoomout",!0)}),a.on(Ib.ZoomOut,function(){b("#gui-zoomin",!0)}),function(){a.zoomLevel>=sb.zoom.max?b("#gui-zoomin",!1):b("#gui-zoomin",!0),a.zoomLevel<=sb.zoom.min?b("#gui-zoomout",!1):b("#gui-zoomout",!0)}()}function la(a){na(a)}function ma(a){na(a)}function na(a){a.waitQueue.length<=0?z():Qb||y(sb.modelComponentLoadSpinnerDelay)}function oa(a,b){Pb={gui:null,visible:!1,model:a,player:b}}function pa(a){a.moreHouse||($(".catalogTemplet, .mCatalogTemplet").remove(),$(".catalogCommodity").css({width:"100%","border-radius":"5px"}),$(".mCatalogCommodity").css("width","36%"));var b=!0,c=$(window).width()/100,d=a.catalogue?a.catalogue.list:"",e=a.moreHouse,f=0;if(Ya.isMobile()){if($("#catalogue").addClass("mCatalogue"),$("#mobileCatalog").show(),d){for(var g=0;g<d.length;g++){$.isArray(d[g].img_url)&&(d[g].img_url=d[g].img_url[0]);var h='<div class="swiper-slide commoditySwiper" tagid='+d[g].tagid+'><div class="comSwiperImg" style="background-image: url('+d[g].img_url+')"></div><p class="commodityText">'+d[g].name1+"</p></div>";$(".mwrapper1").append(h)}var i=(new Kb(".mSwiper1",{speed:500,spaceBetween:c,slidesPerView:4,slidesPerGroup:4,pagination:".mPagination1",prevButton:".btn-prev1",nextButton:".btn-next1",paginationClickable:!0,roundLengths:!0}),$(".mCatalogTemplet")),j=$(".mCatalogCommodity");1===a.catalogue.displaytype?($("#m-opencatalog").addClass("m-opencatalog-ikea"),$(".m-cat-popup b").css("background","#ff6600")):2===a.catalogue.displaytype&&(j.css({color:"#000","background-color":"#40cdd4"}),$(".mPagination1, .mPagination2").addClass("not-ikea-Pagination"),$("#m-opencatalog").addClass("m-opencatalog-notikea"));var k=$(".comSwiperImg");k.css("height",k.width()+"px")}if(e){for(var g=0;g<e.length;g++){var h='<div class="swiper-slide templetSwiper"><a class="templetHref" index='+g+' href="javaScript:void(0)"><img class="houseImg templetImg" src='+e[g].img_url+'><p class="templetText">'+e[g].text+"</p></a></div>";$(".mwrapper2").append(h)}new Kb(".mSwiper2",{speed:500,spaceBetween:c,slidesPerView:4,slidesPerGroup:4,pagination:".mPagination2",prevButton:".btn-prev2",nextButton:".btn-next2",paginationClickable:!0,roundLengths:!0});$(".mTempletSlide").hide()}$("#m-opencatalog").on("touchstart",function(){$(".mCatalogue").animate({bottom:"0px"},800,function(){$(".mCatalogCommodity").hasClass("isHover")&&$(".mTempletSlide").hide()})}),$(".mCatalogClose").on("touchstart",function(){return $(".mCatalogue").animate({bottom:"-450px"},800),!1}),$(".mCatalogCommodity").on("touchstart",function(){if($(this).hasClass("isHover"))return!1;$(this).addClass("isHover"),2===a.catalogue.displaytype&&(j.css({color:"#000","background-color":"#40cdd4"}),i.css({color:"#666","background-color":"#fff"})),$(".mCatalogTemplet").removeClass("isHover"),$(".mTempletSlide").hide(),$(".mCommoditySlide").show()}),$(".mCatalogTemplet").on("touchstart",function(){$(this).addClass("isHover"),$(".mCatalogCommodity").removeClass("isHover"),$(".mCommoditySlide").hide(),$(".mTempletSlide").show().css("bottom","0px"),2===a.catalogue.displaytype&&(i.css({color:"#000","background-color":"#40cdd4"}),j.css({color:"#666","background-color":"#fff"}))}),$(".templetHref").on("touchstart",function(){f=$(this).attr("index"),$(".m-cat-blank").fadeIn(300),$(".m-cat-popup b a").attr("href",e[f].src)}),$(".m-cat-popup span").on("touchstart",function(){return $(".m-cat-blank").hide(),!1})}else{if($("#catalogue").addClass("catalogue"),$("#mobileCatalog").hide(),d){for(var g=0;g<d.length;g++){if($.isArray(d[g].img_url)&&(d[g].img_url=d[g].img_url[0]),d[g].price)var h='<div class="swiper-slide tagslide" tagid='+d[g].tagid+'><div class="swiper-img" style="background-image: url('+d[g].img_url+')"></div><div class="swiper-desc"><p>'+d[g].name1+"</p><span title="+d[g].name2+"> "+d[g].name2+"</span><b>¥ "+d[g].price+"</b></div></div>";else var h='<div class="swiper-slide tagslide" tagid='+d[g].tagid+'><div class="swiper-img" style="background-image: url('+d[g].img_url+')"></div><div class="swiper-desc"><p>'+d[g].name1+"</p><span title="+d[g].name2+"> "+d[g].name2+"</span></div></div>";$("#wrapper1").append(h)}new Kb("#swiper1",{speed:500,spaceBetween:.9*c,slidesPerView:3,slidesPerGroup:3,slidesPerColumn:3,prevButton:".btn-prev1",nextButton:".btn-next1",pagination:"#pagination1",paginationClickable:!0,roundLengths:!0,slidesPerColumnFill:"row",setWrapperSize:!0});if(1===a.catalogue.displaytype?($(".Cat-play-background").addClass("ikea-play-background"),$(".breathLight span").addClass("breathLightToRight")):2===a.catalogue.displaytype&&($(".Cat-play-background").addClass("notikea-play-background"),$("#pagination1").addClass("ikea-pagination"),$(".breathLight").addClass("notikeabreathLight"),$(".swiper-slide").addClass("notikeachose"),$(".catalogCommodity").addClass("not-ikea-cat not-ikea-hover").find("img").attr("src",Va.splitComUrl("https://template2.3dnest.cn/common/image/icon_pc_tag_bai_38x38.png")),$(".catalogTemplet").addClass("not-ikea-mouse").find("img").attr("src",Va.splitComUrl("https://template2.3dnest.cn/common/image/icon_pc_fagnzi_lan_38x38.png")),$(".breathLight span").addClass("breathLightRight"),$(".btn-prev1").addClass("swiperPrev"),$(".btn-next1").addClass("swiperNext"),$(".catalog").css("background-color","rgba(245, 245, 245, .9)"),$(".CatalogPlay").css("background-color","#40cDD4"),$(".swiper-slide img").css("margin","0"),$(".commoditySlide, .templetSlide").css({"background-color":"rgba(0,0,0,0)",opacity:".85"}),$(".swiper-desc").css("padding","0").find("span").hide(),$(".swiper-desc p").css("margin","8px"),$(".swiper-desc b").hide()),d.length<=9)$(".btn-prev1, .btn-next1").hide(),a.enableTagMovie||($(".swiper-pagination").hide(),$(".Cat-play-background").hide());else{var l=Math.floor(d.length/9),m=150+19*l,n=parseInt(.32*$(window).width()-m-20);$(".notikea-play-background").css({width:m+"px","margin-left":n}),$("#pagination1").addClass("cat_pagination1")}var o=$(".swiper-img");o.css("height",o.width()+"px"),$(window).on("resize",function(a){if(d.length>9){var b=Math.floor(d.length/9),c=150+17*b,e=parseInt(.32*$(window).width()-c-20);d.length>9&&$(".notikea-play-background").css({"margin-left":e})}o.css("height",o.width()+"px"),setTimeout(function(){o.css("height",o.width()+"px")},50)})}if(e){for(var g=0;g<e.length;g++){var h='<div class="swiper-slide"><a target="_blank" href='+e[g].src+'><img class="houseImg" src='+e[g].img_url+"><p>"+e[g].text+"</p></a></div>";$("#wrapper2").append(h)}new Kb("#swiper2",{speed:500,spaceBetween:.4*c,slidesPerView:2,slidesPerGroup:2,slidesPerColumn:3,roundLengths:!0,slidesPerColumnFill:"row",setWrapperSize:!0})}$(".breathLight").on("click",function(){b?($(window).on("resize",function(a){if("0px"===$(".catalog").css("left")){var b=.32*$(window).width();$(".breathLight").css("left",b+"px")}}),$(".catalog").animate({left:"0"},1e3,function(){1===a.catalogue.displaytype?$(".breathLightToRight").removeClass("breathLightunfold").addClass("breathLightrevert"):2===a.catalogue.displaytype&&$(".breathLightToRight").removeClass("breathLightRight").addClass("breathLightLeft"),b=!1}),$(".breathLight").animate({left:.32*$(window).width()+"px"},1e3)):($(".catalog").animate({left:"-32vw"},1e3,function(){1===a.catalogue.displaytype?$(".breathLightToRight").removeClass("breathLightrevert").addClass("breathLightunfold"):2===a.catalogue.displaytype&&$(".breathLightToRight").removeClass("breathLightLeft").addClass("breathLightRight"),b=!0}),$(".breathLight").animate({left:"0"},1e3))}),$(".catalogCommodity").on("click",function(){$(this).hasClass("isHover")||$(this).addClass("isHover").find("img").attr("src",Va.splitComUrl("https://template2.3dnest.cn/common/image/icon_goods_38x38_b.png")),$(".catalogTemplet").removeClass("isHover").find("img").attr("src",Va.splitComUrl("https://template2.3dnest.cn/common/image/icon_room_38x38_c.png")),$(".commoditySlide").css("left","0"),$(".templetSlide").css("left","-32vw"),2===a.catalogue.displaytype&&($(this).removeClass("not-ikea-nohover").addClass("not-ikea-hover").find("img").attr("src",Va.splitComUrl("https://template2.3dnest.cn/common/image/icon_pc_tag_bai_38x38.png")),$(".catalogTemplet").removeClass("not-ikea-hover").addClass("not-ikea-nohover").find("img").attr("src",Va.splitComUrl("https://template2.3dnest.cn/common/image/icon_pc_fagnzi_lan_38x38.png")))}),$(".catalogTemplet").on("click",function(){$(this).addClass("isHover").find("img").attr("src",Va.splitComUrl("https://template2.3dnest.cn/common/image/icon_room_38x38_b.png")),$(".catalogCommodity").removeClass("isHover").find("img").attr("src",Va.splitComUrl("https://template2.3dnest.cn/common/image/icon_goods_38x38_c.png")),$(".commoditySlide").css("left","-32vw"),$(".templetSlide").css("left","0"),2===a.catalogue.displaytype&&($(".catalogCommodity").removeClass("not-ikea-hover").addClass("not-ikea-nohover").find("img").attr("src",Va.splitComUrl("https://template2.3dnest.cn/common/image/icon_pc_tag_lan_38x38.png")),$(this).removeClass("not-ikea-nohover").addClass("not-ikea-hover").find("img").attr("src",Va.splitComUrl("https://template2.3dnest.cn/common/image/icon_pc_fangzi_38x38.png")))})}$(".tagslide, .commoditySwiper").on("click",function(){var b=$(this).attr("tagid");a.flyToTagid(b)})}function qa(){Ya.isMobile()||$(".breathLight, .catalog").show()}function ra(){Ya.isMobile()||$(".breathLight, .catalog").css("display","none")}function sa(a,b){function c(){var c=b.toJSON();d.linkToLocation=window.location.protocol+"//"+window.location.host+window.location.pathname+"?m="+a.modelid+"&start="+Ab.serialize(c),b.mattertagManager.activeTag&&(d.linkToLocation+="&tag="+b.mattertagManager.activeTag.i)}var d={},e=new Gb.GUI({autoPlace:!0,width:"60%"});return c(),b.on(Db.ViewChanged,c),e.add(d,"linkToLocation").name("Link to location").listen(),e.domElement.id="datLinks",[].slice.call(e.domElement.querySelectorAll(".property-name")).forEach(function(a){if(!Ya.detectSafari()){var b=document.createElement("button");b.classList.add("btn-deep-link"),b.innerText="Copy",a.nextSibling.appendChild(b);var c=function(){alert("Please use CTRL/CMD + C to copy."),b.hide()};b.addEventListener("click",function(a){try{var b=a.target.parentNode.childNodes[0];b.select();var d=document.execCommand("copy");b.blur(),d||c()}catch(a){c()}})}}),$(e.__closeButton).hide(),e}function ta(a){Pb.gui||(Pb.gui=sa(Pb.model,Pb.player)),Pb.visible=a,a?$(Pb.gui.domElement).show():$(Pb.gui.domElement).hide()}function ua(){ta(!Pb.visible)}function va(a){Ob={gui:null,visible:!1,model:a}}function wa(a){var b=new Gb.GUI;return b.add(sb,"showSweeps").name("Show sweeps").onFinishChange(function(){a.setSweepVisibility(sb.showSweeps)}),b.add(sb,"rotationAccelerationInside",.1,10).name("Rotation speed").step(.1),b.add(sb.transition,"flyTime",0,5e3).name("Transition time").onFinishChange(function(){sb.transition.flySpeed=0,b.__controllers.forEach(function(a){a.updateDisplay()})}),b.add(sb.path,"opacity",0,1).name("Path opacity"),$(b.__closeButton).hide(),b}function xa(a){Ob.gui||(Ob.gui=wa(Ob.model)),Ob.visible=a,a?$(Ob.gui.domElement).show():$(Ob.gui.domElement).hide()}function ya(){xa(!Ob.visible)}function za(){function a(a){}$("body").css("touch-action","none"),$("#gui-parent").find("*").on("touchmove",function(a){a.preventDefault()}),$("#image-floor-container").on("touchmove",function(a){a.preventDefault()});var b=document.getElementById("terms-text");sb.useWheel&&(document.body.addEventListener("mousewheel",a),document.body.addEventListener("DOMMouseScroll",a)),$(b).off("touchmove").on("touchmove",function(a){a.stopPropagation()})}function Aa(a,b){for(var c=[];a;)c.push(a),a=a.parentNode;for(;b&&-1===c.indexOf(b);)b=b.parentNode;return b}function Ba(){var a,b=function(b){a=0===b.button||1===b.which?b.target:null},c=function(b){a!==b.target&&(a=Aa(a,b.target));var c=document.getElementById("gui-parent");if(Aa(c,a)!==c&&(a=null),a){var d;try{d=new MouseEvent("click",b)}catch(a){d=document.createEvent("MouseEvents"),d.initMouseEvent("click",b.bubbles,b.cancelable,b.view,b.detail,b.screenX,b.screenY,b.clientX,b.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,b.button,b.relatedTarget)}d.syntheticClick=!0,a.dispatchEvent(d),a=null}};document.body.addEventListener("mousedown",b,!0),document.body.addEventListener("mouseup",c,!0),document.getElementById("gui-parent").addEventListener("click",function(a){a.syntheticClick||a.stopPropagation()},!0)}function Ca(a){function b(){c.addClass("fadeOut"),h.forEach(function(a){document.body.removeEventListener(a,b,!0)})}var c=$("#quick-overlay"),d=$("#quick-blackout"),e=$("#quick-logo"),f=$(".quick-brand"),g=$("#loaderCoBrand");$b.coBrand.visible&&(g.addClass("quick-brand"),e.before(g),f=$(".quick-brand")),d.addClass("fadeOut"),c.removeClass("hidden");var h=["touchstart","mousedown","keydown"];h.forEach(function(a){document.body.addEventListener(a,b,!0)}),setTimeout(function(){f.addClass("fadeIn")},sb.quickstart.showTextDelay),setTimeout(function(){c.find(".outer").addClass("fadeIn")},sb.quickstart.showTextDelay+sb.quickstart.fadeOutDelay),setTimeout(function(){f.addClass("fadeOut")},sb.quickstart.fadeOutDelay)}function Da(){event.preventDefault(),event.stopPropagation()}var Ea=a("../map/InnerMap"),Fa=new Ea,Ga=a("../map/OuterMap"),Ha=new Ga,Ia=a("../mattertag/AddTagAndHighlight"),Ja=new Ia,Ka=a("../objects/Snapshot"),La=a("../util/math"),Ma=a("./buryPoint"),Na=a("../util/slide"),Oa=new Na,Pa=(a("../objects/Measure"),a("../util/MeasuringTool")),Qa=a("./barrage"),Ra=new Qa,Sa=a("./chLanguage"),Ta=new Sa,Ua=a("./offLine"),Va=new Ua,Wa=a("../enum/LanguageType"),Xa=a("../util/statistic_utils"),Ya=a("../util/browser"),Za=(a("../controls/PanoramaControls"),Ma[window.location.hostname]),$a=10;$(".help_back")[0].addEventListener("touchmove",Da,!1);var _a,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb=(a("../util/common"),a("../util/PanoramaCollection"),a("../util/math"),a("../util/showcase")),qb=a("../util/img"),rb=(a("three"),a("../util/ajax")),Ya=a("../util/browser"),sb=a("../conf"),tb=a("../analytics"),ub=(a("../util/transitions"),a("../util/camera"),a("../util/logger")),vb=(a("../objects/Snapshot"),a("./help")),wb=(a("./helpManager"),a("./loadingScreen")),xb=a("./playButton"),yb=a("./tagLinks"),zb=a("./vrModal"),Ab=a("../controls/serializer"),Bb=a("../enum/Keys"),Cb=a("../enum/Viewmode"),Db=(a("../enum/BlackoutStyle"),a("../enum/PathDiscardMode"),a("../enum/PathDisplayMode"),a("../enum/PlayerEvents")),Eb=a("../enum/ControlEvents"),Fb=(a("../enum/Vectors"),a("../enum/WarpStyle"),a("../enum/AlignmentType"),a("../enum/VROption"),a("./konami")),Gb=a("../lib/dat.gui"),Hb=new ub(c),Ib=(a("../util/showcase"),a("../enum/ZoomEvents")),Jb=Cb.DOLLHOUSE,Kb=(a("../enum/StartupType"),a("../util/swiper")),Lb=0,Mb=0,Nb=[".hideTarget"],Ob=null,Pb=null,Qb=!1,Rb=!1,Sb=!1,Tb=!1,Ub=null,Vb=!0,Wb=null,Xb=!1,Yb=0,Zb=0,$b={titleContainer:{visible:!0,elements:["#model-title"]},coBrand:{visible:!0,elements:[".co-brand","#loaderCoBrand","#presented-by"]},metaInfo:{visible:!0,elements:["#meta-info","#more-hint","#less-hint"]},description:{visible:!0,elements:["#meta-description"]},contact:{visible:!0,elements:[".contact-info"]},email:{visible:!0,elements:["#email"]},address:{visible:!0,elements:[".address"]},support:{visible:!0,elements:[".support"]},phone:{visible:!0,elements:["#phone"]},contactName:{visible:!0,elements:["#contactName"]},url:{visible:!0,elements:["#url"]},help:{visible:!0,elements:[".nav-help","#nav-help"]},tourControls:{visible:!0,elements:[".next",".previous","#play"]},highlight:{visible:!0,elements:["#drawer-container","#pullTab"]},highlight2nd:{visible:!0,elements:["#drawer-container-2nd","#shopTab"]},share:{visible:!0,elements:[".socialButton","#share"]},fullScreen:{visible:!0,elements:["#gui-fullscreen"]},businessname:{visible:!0,elements:["#supportTxt"]},innerimage:{visible:!0,elements:["#qrimg"]},floors:{visible:!0,elements:[".gui-floor"]},bottompresentedby:{visible:!1,elements:["#bottom_presented_by"]}};$(document).on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(a){Ya.isFullscreen()?Ya.isFullscreen()&&$("#gui-fullscreen").removeClass("enterfs").addClass("exitfs"):$("#gui-fullscreen").removeClass("exitfs").addClass("enterfs"),setTimeout(function(){},100)}),$("#gui-fullscreen").on("click",function(a){q(a),Ya.isFullscreen()?Ya.isFullscreen()&&(Ya.exitFullscreen(),tb.track("USER",{event_type:"showcase_gui",gui_action:"click_exit_fullscreen",interaction_source:"gui"})):(Ya.requestFullscreen($("html")[0]),tb.track("USER",{event_type:"showcase_gui",gui_action:"click_enter_fullscreen",interaction_source:"gui"})),_a&&_a.reload()}),$(window).on("resize",function(a){var b=a.target.innerHeight,c=a.target.innerWidth;b===cb&&c===db||($b.highlight.visible&&W(),$b.highlight2nd.visible&&W(),p("resize"),$(".pinTop.right").removeClass("hideUnderMeta"),r(),cb=b,db=c),fb=$("#scrollFrame-2nd").width(),fb<=gb?($(".changePage").show(),$("#scroller-2nd").removeClass("hidden")):($(".changePage").hide(),$("#scroller-2nd").addClass("hidden"))}).resize(),Ya.supportsFullscreen()||$("#gui-fullscreen").hide(),$("#title-toggle").on("click",B),$("#pullTab").on("click",function(a){Za&&G._hmt&&(G._hmt.push(["_trackEvent","场景条切换","click",Ma.modelid]),G._hmt.push(["'"+Ma.type.custom+"'","'"+Za[0].id+"'","'"+Ma.modelid+"'"])),q(a),$("#tag-detail").hasClass("open")?Ub.clickedOnTag():$("#drawer-2nd").hasClass("open")?(j(),i()):i()}),$("#shopTab").on("click",function(a){Za&&G._hmt&&(G._hmt.push(["_trackEvent","场景条切换","click",Ma.modelid]),G._hmt.push(["'"+Ma.type.custom+"'","'"+Za[0].id+"'","'"+Ma.modelid+"'"])),q(a),$("#tag-detail").hasClass("open")?Ub.clickedOnTag():$("#drawer").hasClass("open")?(i(),j()):j()}),$(".commodity_search").css("display","none"),$(".search_title").on("click",function(){var a=$(".commodity_search").css("display");"none"==a&&($(".commodity_search").fadeIn(300),$(this).removeClass("search_open").addClass("search_close")),"block"!=a&&"flex"!=a||($(".commodity_search").fadeOut(300),$(this).removeClass("search_close").addClass("search_open"))}),$(".search_button").on("click",function(){var a=lb;a=JSON.parse(JSON.stringify(a.commoditytypes)),console.log("searchModel",a);var b=$("#commodity_search").val();if(""==b){kb=!1,U(lb);var c=$("#thumb-container-2nd");0!=$("#thumb-container-2nd:has(li)").length&&c.empty(),T(lb)}else{for(var d={},e=[],f=0,g=[],h=0;h<a.length;h++)for(var i=a[h].commodities,j=0;j<i.length;j++){var k=JSON.stringify(i[j]);-1!=k.indexOf(b)&&(-1==e.indexOf(a[h])&&(e.push(a[h]),f++,e[f-1].commodities=[]),g.push(f-1),-1!=JSON.stringify(g).indexOf(f-1)&&e[f-1].commodities.push(i[j]))}d.commoditytypes=e;U(d,1);var c=$("#thumb-container-2nd");0!=$("#thumb-container-2nd:has(li)").length&&c.empty(),0!=d.commoditytypes.length&&(kb=!0,nb=d,hb=0,T(d,hb))}}),$("#commodity_search").on("focus",function(){}),$("#more-menu-button").on("click",function(a){q(a),$("#more-menu").toggleClass("open")}),$(".shareContainer > div.icoContainer > a").on("click",function(a){q(a),p("share");var b={event_type:"showcase_gui",gui_action:"share"};switch($(this).attr("class")){case"faceBookLink":b.site="facebook";break;case"twitterLink":b.site="twitter";break;case"shareTextLink":b.site="link";break;default:return}tb.trackAlways("USER",b)}),$(".footer-terms").on("click",function(a){q(a),p("terms"),rb.get("static/terms.html").done(function(a){$("#terms-text").html(a),tb.track("USER",{event_type:"showcase_gui",gui_action:"click_terms_button",interaction_source:"gui"})}).fail(function(){$("#terms-text").html("<h1>Terms of Use</h1><p>Could not fetch terms. Please make sure you have an internet connection to view the terms of use.")}),$("#terms-modal").fadeIn(sb.guiAnimationSpeed)}),$("#terms-modal .btn").on("click",function(a){q(a),$("#terms-modal").fadeOut(sb.guiAnimationSpeed)}),b.exports.init=ea,b.exports.startLoading=Z,b.exports.endLoading=w,b.exports.onProgress=v,b.exports.addHighlight=Q,b.exports.gotoFrom360=R,b.exports.scrollAllShop=j}).call(this,"/js/gui/gui.js")},{"../analytics":2,"../conf":7,"../controls/PanoramaControls":12,"../controls/serializer":13,"../enum/AlignmentType":16,"../enum/BlackoutStyle":17,"../enum/ControlEvents":19,"../enum/Keys":25,"../enum/LanguageType":26,"../enum/PathDiscardMode":35,"../enum/PathDisplayMode":36,"../enum/PlayerEvents":38,"../enum/StartupType":41,"../enum/VROption":47,"../enum/Vectors":50,"../enum/Viewmode":51,"../enum/WarpStyle":52,"../enum/ZoomEvents":53,"../lib/dat.gui":76,"../map/InnerMap":92,"../map/OuterMap":93,"../mattertag/AddTagAndHighlight":96,"../objects/Measure":111,"../objects/Snapshot":118,"../util/MeasuringTool":136,"../util/PanoramaCollection":138,"../util/ajax":141,"../util/browser":142,"../util/camera":143,"../util/common":145,"../util/editor/Editor":148,"../util/img":151,"../util/logger":153,"../util/math":154,"../util/showcase":156,"../util/slide":157,"../util/statistic_utils":158,"../util/swiper":160,"../util/transitions":162,"./barrage":58,"./buryPoint":59,"./chLanguage":60,"./help":65,
"./helpManager":66,"./konami":67,"./loadingScreen":68,"./offLine":70,"./playButton":71,"./tagLinks":72,"./vrModal":74,three:177}],65:[function(a,b,c){var d=(a("../conf"),a("../util/statistic_utils"));(function(c){"use strict";function e(){return $(".nav-help-dialog").is(":hidden")}function f(a,b,c){if(!o.isEditVersion){var d=$(".nav-help-elements"),e=d.find("#pc-help"),h=d.find("#mobile-help"),i=d.find("#pc-first"),j=d.find("#pc-second"),k=(d.find("#mobile-first"),d.find(".next-button")),l=d.find(".helpclose");p.isMobile()?(e.addClass("hidden"),h.removeClass("hidden"),k.html("进入空间")):(h.addClass("hidden"),e.removeClass("hidden"),i.removeClass("hidden"),j.removeClass("hidden")),l.on("click",function(a){a.preventDefault(),a.stopImmediatePropagation(),g()}),k.on("click",function(a){a.preventDefault(),a.stopImmediatePropagation(),p.isMobile()?g():f(a,++v,!0)}),c||($(".nav-help-dialog").fadeIn(),$(".helpclose").fadeIn(),$(".help_back").fadeIn())}}function g(){$(".nav-help-dialog").fadeOut(300,function(){u("help-dismissed")}),s=0,$(".helpclose").fadeOut(300),$(".help_back").fadeOut(300)}function h(a,b,c,g){u=c;var h=b.pano,k=b.mode;if(a.model.has360Views&&k===l.PANORAMA&&h&&!h.isAligned()&&(k=l.OUTDOOR),q.isStandardHelpEnabled()){t[k]=!0,t[l.PANORAMA]=!0,a.model.has360Views&&(t[l.OUTDOOR]=!0);var s=o.startupFlyinDelay;j(),k===l.PANORAMA&&(s+=o.dollhouse.transitionTime),setTimeout(function(){u("help"),v=1,$("#initial-help, .help_back").show()},s)}$("#footer-help").on("mouseup touchend",function(b){var c=r[window.location.hostname];if(c&&G._hmt&&(G._hmt.push(["_trackEvent",c[7].desc,r.trigger,r.modelid]),d.trackEvent(18)),"none"!==$(".vr-guide-dialog").css("display")&&$(".vr-guide-dialog").css("display","none"),$("#pc-second").removeClass("hidden"),b.preventDefault(),b.stopPropagation(),$("#more-menu").removeClass("open"),u("help"),n.track("USER",{event_type:"showcase_gui",gui_action:"help_open"}),e()){var g=a.model.has360Views&&a.mode===l.PANORAMA?a.currentPano.isAligned()?l.PANORAMA:l.OUTDOOR:a.mode;v=1,f(g,1)}}),o.isEditVersion||(a.on(m.ModeChanging,i),a.on(m.PanoChosen,i)),g.mlanguage_type===x.Japanese&&($(".nav-help-dialog").addClass("Japan"),p.isMobile()&&$("#middle-row, #middle-col").addClass("Japan"))}function i(a,b){if($(".helpclose").on("click",function(a){a.preventDefault(),a.stopPropagation(),g()}),!e()){var c=this;if(a===l.PANORAMA&&b===l.DOLLHOUSE){var d=p.isMobile()?mobileInfo[a]:PCinfo[a],f=d?d.length/2:0;if(s===f)return $(".nav-help-elements .next-button").off().on("click",function(a){a.preventDefault(),a.stopPropagation(),n.track("USER",{event_type:"showcase_gui",gui_action:"help_done"}),g(),setTimeout(function(){c.insideMode()},1e3)}),void $(".nav-help-elements .prev-button").off().on("click",function(a){a.preventDefault(),a.stopPropagation(),n.track("USER",{event_type:"showcase_gui",gui_action:"help_prev"}),!0,c.insideMode()})}}}function j(){var a=$("#initial-help");p.isMobile()?(a.find(".initial-help img").attr("src",y.splitComUrl("https://template2.3dnest.cn/common/image/icon_phone_click_96x96.png")),a.find(".initial-turn img").attr("src",y.splitComUrl("https://template2.3dnest.cn/common/image/icon_phone_slide_96x96.png"))):(a.find(".initial-help img").attr("src",y.splitComUrl("https://template2.3dnest.cn/common/image/icon_pc_click_72x114.png")),a.find(".initial-turn img").attr("src",y.splitComUrl("https://template2.3dnest.cn/common/image/icon_pc_drag_72x114.png"))),a.find(".initial-lord img").attr("src",y.splitComUrl("https://template2.3dnest.cn/common/image/outside_56x56.png"))}var k=a("./../util/logger"),l=a("./../enum/Viewmode"),m=a("./../enum/PlayerEvents"),n=(a("../enum/AlignmentType"),a("./../analytics")),o=a("./../conf"),p=a("./../util/browser"),q=a("./helpManager"),r=a("./buryPoint"),s=(new k(c),0),t={},u=null,v=1,w=a("../gui/offLine"),x=a("../enum/LanguageType"),y=new w;b.exports.navHelpSessionStart=h,b.exports.closeHelp=g}).call(this,"/js/gui/help.js")},{"../conf":7,"../enum/AlignmentType":16,"../enum/LanguageType":26,"../gui/offLine":70,"../util/statistic_utils":158,"./../analytics":2,"./../conf":7,"./../enum/PlayerEvents":38,"./../enum/Viewmode":51,"./../util/browser":142,"./../util/logger":153,"./buryPoint":59,"./helpManager":66}],66:[function(a,b,c){(function(c){"use strict";var d=a("../util/browser"),e=a("./../util/logger"),f=a("./../conf"),g=new e(c),h=function(){var a;try{return a=window.localStorage.getItem("visitCount")||"0",a=(parseFloat(a)+1).toString(),window.localStorage.setItem("visitCount",a),g.debug("visitCount = "+a),a}catch(b){a="1",g.debug("couldn't set local storage")}}();b.exports={isHelpEnabled:function(){return("1"===h||"1"===d.valueFromHash("help",null))&&"0"!==d.valueFromHash("help",null)&&f.warp.auto<0},isQuickstartHelpEnabled:function(){if(f.quickstart.enabled&&this.isHelpEnabled())return!0},isStandardHelpEnabled:function(){if(!f.quickstart.enabled&&this.isHelpEnabled())return!0}}}).call(this,"/js/gui/helpManager.js")},{"../util/browser":142,"./../conf":7,"./../util/logger":153}],67:[function(a,b,c){(function(c){"use strict";function d(a,b,c){i.debug("konami has the modelInstance");var d=[];$(window).on("keydown",function(a){d.push(a.which),d.length>f.secretPanelWord.length&&d.shift(),h.equalLists(d,f.secretPanelWord)&&(i.debug("Developer mode active."),f.debug=!0)}),$(window).on("keydown",function d(e){f.debug&&72==e.which&&(a&&c?(g.toggle(a,b,c),$(window).off("keydown",d)):console.warn("sorry we're not ready yet"))})}var e=a("./../util/logger"),f=a("./../conf"),g=a("./debug"),h=a("./../util/common"),i=(a("./gui"),new e(c));f.console&&$("body").append('<div id="debug-console"></div>'),b.exports.init=d}).call(this,"/js/gui/konami.js")},{"./../conf":7,"./../util/common":145,"./../util/logger":153,"./debug":62,"./gui":64}],68:[function(a,b,c){"use strict";var d=a("./circleLoader").circleLoader;b.exports={element:$("#gui-loading"),hide:function(a,b,c){d.done(),b.loading_enable&&(!c&&b.data.image||c&&b.data.mobileimg)||this.element.fadeOut(2500,function(){$("#gui-loading-splash").attr("src",""),$(".loadingLogo").hide(),a&&a()})},show:function(a){this.element.fadeIn(500,function(){$("#first-loading-splash").attr("src",""),$("#firstLoading").css("display","none"),this.element.css("display","table"),$(".rightgroup").css("display","block"),$("#pinBtmLoad").css("display","flex"),a&&a()}.bind(this))},progress:function(a){d.set(a)}}},{"./circleLoader":61}],69:[function(a,b,c){"use strict";b.exports={Chinese:{title:"加载模型中...",guiModesFloorplan:"平面",guiModesDollhouse:"3D",vrCon:{descrVr:"请将手机解锁自动旋转后放入VR眼镜中",beginVr:"将视野中白色圆点瞄准蓝色方块后即可前进",gotoVr:"请使用手机进入VR模式"},help:{helpTitle:"使用手册",helpKey:"使用键盘方向键",helpDrag:"使用鼠标点击、拖拽",navTitle:"切换视角",helpSlide:"点击滑动",helpLord:"3D视角",helpRoam:"漫游视角",helpChange:"场景切换",helpVisit:"自动游览",helpVr:"虚拟现实",helpMore:"房源推荐",helpMeasure:"尺寸测量",helpClickMove:"鼠标点击行走",helpDragMove:"鼠标拖拽转向",helpZoomMove:"鼠标滚轮缩放",helpKeyMove:"方向键行走、转向",helpToMove:"点击行走",helpToAround:"滑动转向",helpToZoom:"双指缩放",helpFade:"点击任意位置关闭本窗口"},measureHelp:{measureHelpTitle:"测量帮助",measureHelpLine:"测量长度，点击两点测量距离",measureHelpArea:"测量面积，点击三点以上测量面积",measureHelpClear:"清除测量数据",measureHelpExit:"退出测量模型",measureHelpAdjust:"按住端点拖动，调整端点位置",measureHelpStatement:"*声明：测量数据仅供参考，精确测量请使用专业工具。",unit:"请选择单位：",notice:"点击屏幕两点或两点以上"},catalog:{goodsList:"标签导览",moreRoom:"更多空间",newSpace:"确定去往新空间吗？",confirm:"确 定",cancel:"取 消"},modelCode:{passport:"空间主人设置了密码，输入密码才能访问哦~",wandering:"访问模型",placeholder:"请输入密码",passwordError:"密码错误，请重新输入"},barrage:{switch:"开关",comment:"发弹幕",send:"发送",close:"关闭",reminder:"请用微信访问,发弹幕",placeholder:"   不要超过30个字哦!"},floor:{level:"层",all:"整体"},popularity:"人气：",slideUD:"长图可以上下滑动查看",slideabout:"宽图可以左右滑动查看",watchVr:"请先退出自动导览模式，再观看VR",watchPr:"可通过下方场景导览，切换至室内进行漫游",details:"查看详情",more:"查看更多",noMore:"没有更多",address:"地址",contact:"联系方式",modelCon:"模型信息",linkMan:"联系人",intoModel:"点 击 开 启",playSpeed:"倍速"},English:{title:"Loading……",guiModesFloorplan:"Plan",guiModesDollhouse:"3D",vrCon:{descrVr:"Please unlock the phone and rotate it automatically into the VR glasses",beginVr:"Aim the white dot on the blue square and move",gotoVr:"View Space in Virtual Reality"},help:{helpTitle:"Help",helpKey:"Directiion keys",helpDrag:"Click or Drag",navTitle:"Select View",helpSlide:"Touch and Drag",helpLord:"3D View",helpRoam:"Inside View",helpChange:"Switch Space",helpVisit:"Tour Controls",helpVr:"VR Mode",helpMore:"More",helpMeasure:"Measure",helpClickMove:"Click to move",helpDragMove:"Drag to look around",helpZoomMove:"Scroll wheel to zoom",helpKeyMove:"Direction Key to walk around ",helpToMove:"Move",helpToAround:"Rotate",helpToZoom:"Zoom",helpFade:"Click anywhere to close window"},measureHelp:{measureHelpTitle:"Measurement Help",measureHelpLine:"Click 2 points to measure length",measureHelpArea:"Click 3 points above to measure area",measureHelpClear:"Clear measurement",measureHelpExit:"Quit measurement",measureHelpAdjust:"Drag the point to adjust measurement",measureHelpStatement:"*Announcement: For reference only",unit:"Unit",notice:"Click 2 points above to measure"},catalog:{goodsList:"Tag Tour",moreRoom:"More Space",newSpace:"Are you sure to go to the next room？",confirm:"confirm",cancel:"cancel"},modelCode:{passport:"Enter password to visit",wandering:"Visit",placeholder:"password",passwordError:"Password error, please reenter!"},barrage:{switch:"Switch",comment:"Comment",send:"Send",close:"Close",reminder:"Please use wechat to send comments",placeholder:" No more than 30 words"},floor:{level:"Floor",all:"All"},popularity:"Views：",slideUD:"Long Picture,Slide up or down view",slideabout:"WidePicture, Slide left or right view",watchVr:"Please exit Tour Controls, and then enter VR Mode",watchPr:"You can switch to indoor roaming by the list of spaces below",details:"More",more:"More",noMore:"No More",address:"Address",contact:"Contacts",modelCon:"Information",linkMan:"linkMan",intoModel:"Click to open",playSpeed:"Speed"},Japanese:{title:"ロード中...",guiModesFloorplan:"平面",guiModesDollhouse:"3D",vrCon:{descrVr:"スマートフォンの画面縦向きのロックを解除し、VRゴーグルに入れてください",beginVr:"前に進むには、視野の中の白い点を青い枠に合わせてください",gotoVr:"VRモードの起動は、スマートフォンをご利用ください"},help:{helpTitle:"ヘルプ",helpKey:"矢印キーの使用",helpDrag:"マウスでクリック,ドラッグ",navTitle:"ビューの切り替え",helpSlide:"タッチ＆ドラッグ",helpLord:"鳥瞰図",helpRoam:"自由視点",helpChange:"シーンの切替",helpVisit:"自動案内",helpVr:" VRモード",helpMore:"お勧め物件",helpMeasure:"寸法測定",helpClickMove:"ウォーキング",helpDragMove:"回転",helpZoomMove:"拡大／縮小",helpKeyMove:"方向キーでウォーキング",helpToMove:"ウォーキング",helpToAround:"回転",helpToZoom:"拡大／縮小",helpFade:"任意の位置をクリックして、ウィンドウを閉じる"},measureHelp:{notice:"画面２点また２点以上をクリック"},catalog:{goodsList:"ラベルガイド",moreRoom:"もっと見る",newSpace:"新しいスペースへ移動しますか",confirm:"確認",cancel:"キャンセル"},modelCode:{passport:"パスワードを入力してください",wandering:"確認",placeholder:"パスワードを入力してください",passwordError:"正しく入力してください"},barrage:{switch:"スイッチ",comment:"弾幕送信",send:"送信",close:"閉じる",reminder:"ウィチャットからアクセスし、弾幕を発信してだくさい",placeholder:" 30字を超えないでください"},floor:{level:"F",all:"すべて"},popularity:"人気：",slideUD:"縦長の画像は、上下のスライドでご覧ください",slideabout:"横長の画像は、左右のスライドでご覧ください",watchVr:"VRモードに入るには、自動遊覧モードを先に中止してください",watchPr:"次のシーンへ切替、室内漫遊",details:"詳細を確認",more:"詳しく",noMore:"もっと",address:"住所",contact:"連絡先",modelCon:"モデル情報",linkMan:"連絡先",intoModel:"ス タ ー ト",playSpeed:"倍速"},error:{o:{t:"你的浏览器不支持,建议使用火狐、Chrome 或者IE 11以上版本",e:"ブラウザーがサポートしていません,Firefox、Chrome、IE11以上がお勧め",i:"Your browser does not support it.Please use Firefox, Chrome or the latest version of the IE."},webglIos:{t:"需要更新iOS,请更新到iOS8以上版本",e:"IOSの更新が必要です,IO S8以上に更新してください",i:"Please update to iOS 8 or later version."},webglSafari:{t:"需要开启WebGL功能,或选择其他浏览器，如：火狐和Chrome",e:"WebGL機能を起動してください,WebGL機能を起動し、本画面を更新してください。または他のブラウザーをご利用ください。",i:"Your browser does not support it.Please choose other browsers."},webglGeneric:{pc:{t:"软件或硬件版本不支持，请升级浏览器到最新版本或者升级新版本操作系统。",e:"注意：ソフトウェアかハードウェアがサポートしていません。ブラウザドを最新バージョンに更新してください",i:"Tip: software or hardware version does not support, please update the browser to the latest version or upgrade the new version of the operating system."},mobile:{t:"软件或硬件版本不支持，请升级Android系统到最新版本。",e:"注意：ソフトウェアかハードウェアがサポートしていません。アンドロイドを最新バージョンに更新してください",i:"Tip: software or hardware version does not support, please upgrade the Android system to the latest version."}},missingUrls:{t:"3D模型数据不支持,请尝试其他模型",e:"3Dモデル情報がサポートされていません,他のモデルを試してください",i:"3D model data is not supported.Please try other models."},loadingFailed:{t:"抱歉，该链接地址不完整",e:"申し訳ございませんが、この接続は不完全なものです",i:"Sorry, this link is incomplete.Please confirm the link is complete."},versionIsEmpty:{t:"抱歉，该空间未公开",e:"申し訳ございませんが、このモデルは公開されていません。",i:"Sorry, this model is not public."},versionNotFound:{t:"您的浏览器版本过低,请按下Ctrl+F5刷新，或切换其他浏览器尝试",e:"申し訳ございませんが、ブラウザーのバージョンが低いため、閲覧できません,CTL+F5で画面を更新してください。または他のブラウザーで開いてみてください。",i:"Sorry, your browser version is too low.Please press Ctrl+F5 to refresh,or use other browsers."},settingsNotFound:{t:"抱歉，该模型未发布",e:"申し訳ございませんが、このモデルは公開されていません。",i:"Sorry, this model was not released."},loadingFailedMaintenance:{r:"错误: ",t:"3dnest暂时无法访问,请换个时段再尝试",e:"3dnesへのアクセスができません,時間帯を変えて、もう一度試してください",i:"3dnest is inaccessible.Please try again later."}}}},{}],70:[function(a,b,c){"use strict";function d(a){}var e=(a("../util/browser"),a("../conf"));d.prototype.init=function(a){if(!0!==e.isLocalVersion)return!1;$("#first-loading-splash, #gui-loading-splash").attr("src","image/splash_110x110.gif"),$(".top-img").attr("src","image/vr-guide_290x300.png"),$(".switch-label1").attr("src","image/tagtype1_1_60x60.png"),$(".switch-label2").attr("src","image/tagtype1_2_60x60.png"),$(".switch-label3").attr("src","image/tagtype1_3_60x60.png"),$(".switch-label4").attr("src","image/tagtype1_4_60x60.png"),$(".switch-label5").attr("src","image/gif8_80x80.png"),$(".switch-label6").attr("src","image/gif9_80x80.png"),$(".switch-label7").attr("src","image/gif10_80x80.png"),$(".switch-label8").attr("src","image/gif11_80x80.png"),$(".switch-label9").attr("src","image/gif12_80x80.png"),$(".switch-label10").attr("src","image/gif13_80x80.png"),$(".switch-label11").attr("src","image/gif14_80x80.png"),$("#gui-spinner-icon").attr("src","image/loading_74x74.png"),$(".error-splash").attr("src","image/splash_110x110.gif"),$(".pc-first1").attr("src","image/icon_pc_click_72x114.png"),$(".pc-first2").attr("src","image/icon_pc_drag_72x114.png"),$(".pc-first3").attr("src","image/icon_pc_zoom.png"),$(".pc-first4").attr("src","image/icon_pc_keys.png"),$(".pc-second1").attr("src","image/outside_56x56.png"),$(".pc-second2").attr("src","image/indoor_56x56.png"),$(".pc-second3").attr("src","image/pull_56x56.png"),$(".pc-second4").attr("src","image/play_56x56.png"),$(".pc-second5").attr("src","image/vr_56x56.png"),$(".pc-second6").attr("src","image/icon_morehouse_56x56.png"),$(".pc-second7").attr("src","image/icon_measure_56x56.png"),$(".middle-row1").attr("src","image/icon_phone_click_96x96.png"),$(".middle-row2").attr("src","image/icon_phone_slide_96x96.png"),$(".middle-row3").attr("src","image/icon_phone_zoom_96x96.png"),$(".middle-col1").attr("src","image/outside_56x56.png"),$(".middle-col2").attr("src","image/indoor_56x56.png"),$(".middle-col3").attr("src","image/pull_56x56.png"),$(".middle-col4").attr("src","image/play_56x56.png"),$(".middle-col5").attr("src","image/vr_56x56.png"),$(".middle-col6").attr("src","image/icon_morehouse_56x56.png"),$(".middle-col7").attr("src","image/icon_measure_56x56.png"),$("#quick-logo").attr("src","image/logo2.png"),$("#map-man, #sm-man").attr("src","image/man.png"),$(".catalogCommodity").attr("src","image/icon_goods_38x38_b.png"),$(".catalogTemplet").attr("src","image/icon_room_38x38_c.png"),$(".backimg").addClass("Local")},d.prototype.delayLoad=function(a){if(!0!==e.isLocalVersion)return!1;$(".bottom-logo .img").addClass("Local"),$(".measureCon ul").addClass("Local"),$(".b-close, .amap-close, #iframe-close, .moreclose").addClass("BigCloseLocal"),$(".ck-prev").addClass("Local"),$(".ck-next").addClass("Local"),$("#barrage-switch").addClass("Local"),$(".barrage-con").addClass("Local"),$(".barrage-switch").addClass("Local"),$(".barrage-send").addClass("Local"),$(".floorup").addClass("Local"),$("#measure-tools").addClass("Local"),$("#length-tool, #length-tool-m").addClass("Local"),$("#area-tool, #area-tool-m").addClass("Local"),$("#reset-tool, #reset-tool-m").addClass("Local"),$("#help-tool, #help-tool-m").addClass("Local"),$(".breathLightToRight").addClass("Local"),$(".catalog-close").addClass("Local"),$(".btn-cat-play").addClass("Local"),$("#moreHouse").addClass("Local"),$(".openmenu").addClass("Local"),$(".vrclose").addClass("Local"),$("#footer-help").addClass("Local"),$("#outermap-on").addClass("Local"),$("#audio-btn-on").addClass("Local"),$("#phone-topbar").addClass("Local"),$("#gui-fullscreen").addClass("Local"),$("#m-openmenu").addClass("Local"),$("#play").addClass("Local"),$(".helpclose").addClass("Local"),$("#pullTab").addClass("Local"),$(".openor").addClass("Local"),$(".openvr").addClass("Local"),$(".btn-vrall").addClass("Local"),$(".compass").addClass("Local"),$(".indoordir").addClass("Local"),$(".indoorscale").addClass("Local"),$("#gui-modes-outside").addClass("Local"),$("#m-opencatalog").addClass("Local")},d.prototype.splitUrl=function(a){return e.isLocalVersion?window.location.origin+window.location.pathname.split("index.html")[0]+"/"+a.split("/common/")[1]:a},d.prototype.splitComUrl=function(a){return e.isLocalVersion?a.split("/common/")[1]:a},b.exports=d},{"../conf":7,"../util/browser":142}],71:[function(a,b,c){"use strict";var d=a("../util/browser"),e=a("../analytics");a("../conf"),b.exports={show:function(a,b){$("#gui-message").fadeIn(250,function(){$(this).css("display","table");var a=$("#gui-message").fracs().visible>=.5;e.impression({visible:a,immediate:!0})}),a&&($("#quick-blackout").addClass("fadeOut"),$("#quick-overlay").addClass("hidden")),$("#button-play").on("click",function(c){return d.inIframe()&&d.isMobile()?void(top.location.href=self.location.href):a?(c.stopPropagation(),$("#quick-blackout").removeClass("fadeOut"),$("#gui-message").hide(),void b()):void $("#gui-message").fadeOut(500,function(){b()})})}}},{"../analytics":2,"../conf":7,"../util/browser":142}],72:[function(a,b,c){(function(c){"use strict";function d(a){var b=[].slice.call(document.getElementById("tag-billboards").querySelectorAll("a"));p=b.length,b.forEach(function(b){b.addEventListener("click",e.bind(b,a))})}function e(a,b){b.preventDefault();var c=this.getAttribute("href"),d=this.getAttribute("data-linktype"),e=this.getAttribute("data-tagid");q[e]=!0;var h={event_type:"click_mattertag_link",link_type:d,link_count:p,links_clicked:Object.keys(q).length};switch(d){case j.NAVIGATION:var i=new RegExp("[#&?]start=([^#&?]*)"),i=i.exec(c);f(a,i[1]);break;case j.MODEL:window.location.replace(c);break;case j.EXT_LINK:window.open(c,"_blank")}g.trackAlways("USER",h)}function f(a,b){var c=h.deserialize(b);if(c)if(c.mode===k.PANORAMA){try{a.model.panos.get(c.panoId)}catch(a){return void o.warn("Unable to find panorama location",c.panoId)}a.warpToPanoById(c.panoId,c.quaternion,null,null,l.BLACK)}else{var d={cameraMode:c.mode,position:c.position,quaternion:c.quaternion,scanId:c.panoId,orthoZoom:c.zoom,floorVisibility:c.floorVisibility,thumbUrl:null,name:null,isHero:!1};a.flyToNewMode({mode:c.mode,duration:m.warp.outsideTime,warpDest:new i(d),force:!0})}}var g=a("../analytics"),h=a("../controls/serializer"),i=a("../objects/Snapshot"),j=a("../enum/LinkType"),k=a("../enum/Viewmode"),l=a("../enum/WarpStyle"),m=a("../conf"),n=a("../util/logger"),o=new n(c),p=0,q={};b.exports.attachMattertagLinks=d}).call(this,"/js/gui/tagLinks.js")},{"../analytics":2,"../conf":7,"../controls/serializer":13,"../enum/LinkType":27,"../enum/Viewmode":51,"../enum/WarpStyle":52,"../objects/Snapshot":118,"../util/logger":153}],73:[function(a,b,c){"use strict";function d(a,b,c){l("USER",{event_type:"showcase_gui",gui_action:"launch_vr",vr_platform:a,vr_app:b});var d=e(b,c);switch(a){case j.Android:f(d);break;case j.IOS:g(d);break;default:h(d)}}function e(a,b){var c;return i.valueFromHash("vrcoll",!1)?(c=o,c+="&sids="+b.modelid+"&lsid="+b.modelid+"&ln="+encodeURIComponent(b.name)+"&ld="+encodeURIComponent(b.summary)):(c=n,c+="&m="+b.modelid),c+="&display="+a}function f(a){window.open(a,"_blank")}function g(a){window.open(a,"_blank")}function h(a){window.open(a,"_blank")}var i=a("../util/browser"),j=(a("../enum/VRApps"),a("../enum/VRPlatforms")),k=a("../analytics"),l=k.trackAlways,m=encodeURIComponent(document.referrer)||encodeURIComponent(window.location.href),n="https://my.3dnest.cn/vr/show/?ret="+m,o="https://my.3dnest.cn/vr/dlist/?ret="+m;b.exports.launch=d},{"../analytics":2,"../enum/VRApps":46,"../enum/VRPlatforms":49,"../util/browser":142}],74:[function(a,b,c){"use strict";function d(){if(l.detectIOS())return!1;var a;return!!l.detectAndroidMobile()&&(a=l.androidVersion(),a.major>4||4===a.major&&a.minor>4||4===a.major&&4===a.minor&&a.patch>=4)}function e(a,b){function c(b){switch(b!==p.AfterLastPage&&(g(b),$(".vr-page").text(b+" / "+p.LastPage)),b){case p.Title:B.css("display","none"),C.text(h[b]),f(a,e);break;case p.Cardboard:B.css("display","block"),C.text(h[b]),z.filter(".cardboard").off(),z.filter(".gearvr").off(),i(G,I,K);break;case p.Gear:C.text(h[b]),i(H,F,J);break;case p.AfterLastPage:w.fadeOut(q.guiAnimationSpeed)}$("img").filter("[src='']").hide()}var e=function(){return l.detectAndroid()?d()?(w.addClass("supported"),v=".show-supported",o.Android):(w.addClass("unsupported"),v=".show-unsupported",o.UnsupportedAndroid):l.detectIOS()?(w.addClass("ios"),v=".show-ios",o.IOS):(w.addClass("desktop"),v=".show-desktop",o.Desktop)}();e!==o.Desktop&&w.addClass("mobile"),k(),$(".show-supported, .show-unsupported, .show-ios, .show-desktop").hide(),$(v).show();var h=["","更多","下一页","知道了"],r=["","vr_modal_learn_more","vr_modal_next","vr_modal_done"];$("#vr").on("click",function(a){a.preventDefault(),t("USER",{event_type:"showcase_gui",gui_action:"click_vr_button"}),w.is(":hidden")?(u=1,c(u),w.fadeIn(q.guiAnimationSpeed),b("vr")):j()});var s="https://my.3dnest.cn/vr/show/?m="+a.modelid;$(".cardboardLink").on("click",m.launch.bind(this,e,n.Cardboard,a)),$(".gearLink").on("click",m.launch.bind(this,e,n.GearVR,a)),$("span.modelLink").text(s),B.on("click",function(a){t("USER",{event_type:"showcase_gui",gui_action:"vr_modal_prev"}),u--,c(u)}),C.on("click",function(a){C.text(),t("USER",{event_type:"showcase_gui",gui_action:r[u]}),u++,c(u)}),w.find(".close").on("click",j)}function f(a,b){switch(z.filter(".cardboard").off().on("click",m.launch.bind(this,b,n.Cardboard,a)),z.filter(".gearvr").off().on("click",m.launch.bind(this,b,n.GearVR,a)),b){case o.Android:h(G,H,"logo-button","same-line");break;case o.UnsupportedAndroid:h("",I,"","");break;case o.IOS:h(E,D,"","same-line");break;case o.Desktop:h(G,H,"logo-button","same-line")}}function g(a){$(".p1, .p2, .p3").hide(),x.insertAfter(y),w.removeClass("front-page"),w.removeClass("details-page"),z.removeClass("logo-button"),z.removeClass("same-line"),A.attr("src",""),A.css("display","inline-block"),$(".p"+a+v).show()}function h(a,b,c,d){w.addClass("front-page"),A.filter(".first").attr("src",a),A.filter(".second").attr("src",b),z.filter(".first").addClass(c),z.filter(".second").addClass(c),z.addClass(d),".show-desktop"===v&&y.insertAfter(x)}function i(a,b,c){w.find(".inner").addClass("details-page"),w.addClass("details-page"),A.filter(".first").attr("src",a),A.filter(".second").attr("src",b),A.filter(".third").attr("src",c)}function j(){t("USER",{event_type:"showcase_gui",gui_action:"vr_modal_close"}),w.fadeOut(q.guiAnimationSpeed)}function k(){var a=l.aspectRatio()>1&&l.isMobile();w.toggleClass("landscape",a).toggleClass("portrait",!a),w.toggleClass("tiny",window.innerHeight<=s.narrowLandscapeHeight),w.toggleClass("tinier",window.innerHeight<=s.reallyNarrowLandscapeHeight)}var l=a("../util/browser"),m=a("./vrLink"),n=a("../enum/VRApps"),o=a("../enum/VRPlatforms"),p=a("../enum/VRPages"),q=a("../conf"),r=a("../analytics"),s=a("../constants"),t=r.trackAlways,u=1,v=null,w=$(".vr-popup"),x=w.find(".vr-popup-body"),y=w.find(".vr-images"),z=w.find(".img-container"),A=w.find(".vr-sm-image"),B=$(".vr-buttons").find(".prev-button"),C=$(".vr-buttons").find(".next-button"),D="images/badge-oculus.png",E="images/badge-cardboard.png",F="images/logo-samsung.png",G="images/headset-cardboard.png",H="images/headset-gearvr.png",I="images/ico-android-robot.png",J="images/ico-gearvr.png",K="images/ico-vr.png";$(window).resize(k),b.exports.init=e,b.exports.dismiss=j},{"../analytics":2,"../conf":7,"../constants":8,"../enum/VRApps":46,"../enum/VRPages":48,"../enum/VRPlatforms":49,"../util/browser":142,"./vrLink":73}],75:[function(a,b,c){"use strict";Array.prototype.findIndex||(Array.prototype.findIndex=function(a){if(null==this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;f<d;f++)if(b=c[f],a.call(e,b,f,c))return f;return-1})},{}],76:[function(a,b,c){"use strict";var d=d||{};b.exports=d,d.gui=d.gui||{},d.utils=d.utils||{},d.controllers=d.controllers||{},d.dom=d.dom||{},d.color=d.color||{},d.utils.css=function(){return{load:function(a,b){b=b||document;var c=b.createElement("link");c.type="text/css",c.rel="stylesheet",c.href=a,b.getElementsByTagName("head")[0].appendChild(c)},inject:function(a,b){b=b||document;var c=document.createElement("style");c.type="text/css",c.innerHTML=a,b.getElementsByTagName("head")[0].appendChild(c)}}}(),d.utils.common=function(){var a=Array.prototype.forEach,b=Array.prototype.slice;return{BREAK:{},extend:function(a){return this.each(b.call(arguments,1),function(b){for(var c in b)this.isUndefined(b[c])||(a[c]=b[c])},this),a},defaults:function(a){return this.each(b.call(arguments,1),function(b){for(var c in b)this.isUndefined(a[c])&&(a[c]=b[c])},this),a},compose:function(){var a=b.call(arguments);return function(){for(var c=b.call(arguments),d=a.length-1;d>=0;d--)c=[a[d].apply(this,c)];return c[0]}},each:function(b,c,d){if(b)if(a&&b.forEach&&b.forEach===a)b.forEach(c,d);else if(b.length===b.length+0){for(var e=0,f=b.length;e<f;e++)if(e in b&&c.call(d,b[e],e)===this.BREAK)return}else for(var e in b)if(c.call(d,b[e],e)===this.BREAK)return},defer:function(a){setTimeout(a,0)},toArray:function(a){return a.toArray?a.toArray():b.call(a)},isUndefined:function(a){return void 0===a},isNull:function(a){return null===a},isNaN:function(a){return a!==a},isArray:Array.isArray||function(a){return a.constructor===Array},isObject:function(a){return a===Object(a)},isNumber:function(a){return a===a+0},isString:function(a){return a===a+""},isBoolean:function(a){return!1===a||!0===a},isFunction:function(a){return"[object Function]"===Object.prototype.toString.call(a)}}}(),d.controllers.Controller=function(a){var b=function(a,b){this.initialValue=a[b],this.domElement=document.createElement("div"),this.object=a,this.property=b,this.__onChange=void 0,this.__onFinishChange=void 0};return a.extend(b.prototype,{onChange:function(a){return this.__onChange=a,this},onFinishChange:function(a){return this.__onFinishChange=a,this},setValue:function(a){return this.object[this.property]=a,this.__onChange&&this.__onChange.call(this,a),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),b}(d.utils.common),d.dom.dom=function(a){function b(b){if("0"===b||a.isUndefined(b))return 0;var c=b.match(e);return a.isNull(c)?0:parseFloat(c[1])}var c={HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},d={};a.each(c,function(b,c){a.each(b,function(a){d[a]=c})});var e=/(\d+(\.\d+)?)px/,f={makeSelectable:function(a,b){void 0!==a&&void 0!==a.style&&(a.onselectstart=b?function(){return!1}:function(){},a.style.MozUserSelect=b?"auto":"none",a.style.KhtmlUserSelect=b?"auto":"none",a.unselectable=b?"on":"off")},makeFullscreen:function(b,c,d){a.isUndefined(c)&&(c=!0),a.isUndefined(d)&&(d=!0),b.style.position="absolute",c&&(b.style.left=0,b.style.right=0),d&&(b.style.top=0,b.style.bottom=0)},fakeEvent:function(b,c,e,f){e=e||{};var g=d[c];if(!g)throw new Error("Event type "+c+" not supported.");var h=document.createEvent(g);switch(g){case"MouseEvents":var i=e.x||e.clientX||0,j=e.y||e.clientY||0;h.initMouseEvent(c,e.bubbles||!1,e.cancelable||!0,window,e.clickCount||1,0,0,i,j,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var k=h.initKeyboardEvent||h.initKeyEvent;a.defaults(e,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),k(c,e.bubbles||!1,e.cancelable,window,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.keyCode,e.charCode);break;default:h.initEvent(c,e.bubbles||!1,e.cancelable||!0)}a.defaults(h,f),b.dispatchEvent(h)},bind:function(a,b,c,d){return d=d||!1,a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&&a.attachEvent("on"+b,c),f},unbind:function(a,b,c,d){return d=d||!1,a.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent&&a.detachEvent("on"+b,c),f},addClass:function(a,b){if(void 0===a.className)a.className=b;else if(a.className!==b){var c=a.className.split(/ +/);-1==c.indexOf(b)&&(c.push(b),a.className=c.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return f},removeClass:function(a,b){if(b)if(void 0===a.className);else if(a.className===b)a.removeAttribute("class");else{var c=a.className.split(/ +/),d=c.indexOf(b);-1!=d&&(c.splice(d,1),a.className=c.join(" "))}else a.className=void 0;return f},hasClass:function(a,b){return new RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)").test(a.className)||!1},getWidth:function(a){var c=getComputedStyle(a);return b(c["border-left-width"])+b(c["border-right-width"])+b(c["padding-left"])+b(c["padding-right"])+b(c.width)},getHeight:function(a){var c=getComputedStyle(a);return b(c["border-top-width"])+b(c["border-bottom-width"])+b(c["padding-top"])+b(c["padding-bottom"])+b(c.height)},getOffset:function(a){var b={left:0,top:0};if(a.offsetParent)do{b.left+=a.offsetLeft,b.top+=a.offsetTop}while(a=a.offsetParent);return b},isActive:function(a){return a===document.activeElement&&(a.type||a.href)}};return f}(d.utils.common),d.controllers.OptionController=function(a,b,c){var d=function(a,e,f){d.superclass.call(this,a,e);var g=this;if(this.__select=document.createElement("select"),c.isArray(f)){var h={};c.each(f,function(a){h[a]=a}),f=h}c.each(f,function(a,b){var c=document.createElement("option");c.innerHTML=b,c.setAttribute("value",a),g.__select.appendChild(c)}),this.updateDisplay(),b.bind(this.__select,"change",function(){var a=this.options[this.selectedIndex].value;g.setValue(a)}),this.domElement.appendChild(this.__select)};return d.superclass=a,c.extend(d.prototype,a.prototype,{setValue:function(a){var b=d.superclass.prototype.setValue.call(this,a);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),b},updateDisplay:function(){return this.__select.value=this.getValue(),d.superclass.prototype.updateDisplay.call(this)}}),d}(d.controllers.Controller,d.dom.dom,d.utils.common),d.controllers.NumberController=function(a,b){function c(a){return a=a.toString(),a.indexOf(".")>-1?a.length-a.indexOf(".")-1:0}var d=function(a,e,f){d.superclass.call(this,a,e),f=f||{},this.__min=f.min,this.__max=f.max,this.__step=f.step,b.isUndefined(this.__step)?0==this.initialValue?this.__impliedStep=1:this.__impliedStep=Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__impliedStep=this.__step,this.__precision=c(this.__impliedStep)};return d.superclass=a,b.extend(d.prototype,a.prototype,{setValue:function(a){return void 0!==this.__min&&a<this.__min?a=this.__min:void 0!==this.__max&&a>this.__max&&(a=this.__max),void 0!==this.__step&&a%this.__step!=0&&(a=Math.round(a/this.__step)*this.__step),d.superclass.prototype.setValue.call(this,a)},min:function(a){return this.__min=a,this},max:function(a){return this.__max=a,this},step:function(a){return this.__step=a,
this.__impliedStep=a,this.__precision=c(a),this}}),d}(d.controllers.Controller,d.utils.common),d.controllers.NumberControllerBox=function(a,b,c){function d(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c}var e=function(a,d,f){function g(){var a=parseFloat(m.__input.value);c.isNaN(a)||m.setValue(a)}function h(){g(),m.__onFinishChange&&m.__onFinishChange.call(m,m.getValue())}function i(a){b.bind(window,"mousemove",j),b.bind(window,"mouseup",k),l=a.clientY}function j(a){var b=l-a.clientY;m.setValue(m.getValue()+b*m.__impliedStep),l=a.clientY}function k(){b.unbind(window,"mousemove",j),b.unbind(window,"mouseup",k)}this.__truncationSuspended=!1,e.superclass.call(this,a,d,f);var l,m=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),b.bind(this.__input,"change",g),b.bind(this.__input,"blur",h),b.bind(this.__input,"mousedown",i),b.bind(this.__input,"keydown",function(a){13===a.keyCode&&(m.__truncationSuspended=!0,this.blur(),m.__truncationSuspended=!1)}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return e.superclass=a,c.extend(e.prototype,a.prototype,{updateDisplay:function(){return this.__input.value=this.__truncationSuspended?this.getValue():d(this.getValue(),this.__precision),e.superclass.prototype.updateDisplay.call(this)}}),e}(d.controllers.NumberController,d.dom.dom,d.utils.common),d.controllers.NumberControllerSlider=function(a,b,c,d,e){function f(a,b,c,d,e){return d+(a-b)/(c-b)*(e-d)}var g=function(a,c,d,e,h){function i(a){b.bind(window,"mousemove",j),b.bind(window,"mouseup",k),j(a)}function j(a){a.preventDefault();var c=b.getOffset(l.__background),d=b.getWidth(l.__background);return l.setValue(f(a.clientX,c.left,c.left+d,l.__min,l.__max)),!1}function k(){b.unbind(window,"mousemove",j),b.unbind(window,"mouseup",k),l.__onFinishChange&&l.__onFinishChange.call(l,l.getValue())}g.superclass.call(this,a,c,{min:d,max:e,step:h});var l=this;this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),b.bind(this.__background,"mousedown",i),b.addClass(this.__background,"slider"),b.addClass(this.__foreground,"slider-fg"),this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)};return g.superclass=a,g.useDefaultStyles=function(){c.inject("/**\n * dat-gui JavaScript Controller Library\n * http://code.google.com/p/dat-gui\n *\n * Copyright 2011 Data Arts Team, Google Creative Lab\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n */\n\n.slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}")},d.extend(g.prototype,a.prototype,{updateDisplay:function(){var a=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*a+"%",g.superclass.prototype.updateDisplay.call(this)}}),g}(d.controllers.NumberController,d.dom.dom,d.utils.css,d.utils.common),d.controllers.FunctionController=function(a,b,c){var d=function(a,c,e){d.superclass.call(this,a,c);var f=this;this.__button=document.createElement("div"),this.__button.innerHTML=void 0===e?"Fire":e,b.bind(this.__button,"click",function(a){return a.preventDefault(),f.fire(),!1}),b.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)};return d.superclass=a,c.extend(d.prototype,a.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),d}(d.controllers.Controller,d.dom.dom,d.utils.common),d.controllers.BooleanController=function(a,b,c){var d=function(a,c){function e(){f.setValue(!f.__prev)}d.superclass.call(this,a,c);var f=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),b.bind(this.__checkbox,"change",e,!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay()};return d.superclass=a,c.extend(d.prototype,a.prototype,{setValue:function(a){var b=d.superclass.prototype.setValue.call(this,a);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),b},updateDisplay:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,d.superclass.prototype.updateDisplay.call(this)}}),d}(d.controllers.Controller,d.dom.dom,d.utils.common),d.color.toString=function(a){return function(b){if(1==b.a||a.isUndefined(b.a)){for(var c=b.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"rgba("+Math.round(b.r)+","+Math.round(b.g)+","+Math.round(b.b)+","+b.a+")"}}(d.utils.common),d.color.interpret=function(a,b){var c,d,e=function(){d=!1;var a=arguments.length>1?b.toArray(arguments):arguments[0];return b.each(f,function(e){if(e.litmus(a))return b.each(e.conversions,function(e,f){if(c=e.read(a),!1===d&&!1!==c)return d=c,c.conversionName=f,c.conversion=e,b.BREAK}),b.BREAK}),d},f=[{litmus:b.isString,conversions:{THREE_CHAR_HEX:{read:function(a){var b=a.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==b&&{space:"HEX",hex:parseInt("0x"+b[1].toString()+b[1].toString()+b[2].toString()+b[2].toString()+b[3].toString()+b[3].toString())}},write:a},SIX_CHAR_HEX:{read:function(a){var b=a.match(/^#([A-F0-9]{6})$/i);return null!==b&&{space:"HEX",hex:parseInt("0x"+b[1].toString())}},write:a},CSS_RGB:{read:function(a){var b=a.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==b&&{space:"RGB",r:parseFloat(b[1]),g:parseFloat(b[2]),b:parseFloat(b[3])}},write:a},CSS_RGBA:{read:function(a){var b=a.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null!==b&&{space:"RGB",r:parseFloat(b[1]),g:parseFloat(b[2]),b:parseFloat(b[3]),a:parseFloat(b[4])}},write:a}}},{litmus:b.isNumber,conversions:{HEX:{read:function(a){return{space:"HEX",hex:a,conversionName:"HEX"}},write:function(a){return a.hex}}}},{litmus:b.isArray,conversions:{RGB_ARRAY:{read:function(a){return 3==a.length&&{space:"RGB",r:a[0],g:a[1],b:a[2]}},write:function(a){return[a.r,a.g,a.b]}},RGBA_ARRAY:{read:function(a){return 4==a.length&&{space:"RGB",r:a[0],g:a[1],b:a[2],a:a[3]}},write:function(a){return[a.r,a.g,a.b,a.a]}}}},{litmus:b.isObject,conversions:{RGBA_OBJ:{read:function(a){return!!(b.isNumber(a.r)&&b.isNumber(a.g)&&b.isNumber(a.b)&&b.isNumber(a.a))&&{space:"RGB",r:a.r,g:a.g,b:a.b,a:a.a}},write:function(a){return{r:a.r,g:a.g,b:a.b,a:a.a}}},RGB_OBJ:{read:function(a){return!!(b.isNumber(a.r)&&b.isNumber(a.g)&&b.isNumber(a.b))&&{space:"RGB",r:a.r,g:a.g,b:a.b}},write:function(a){return{r:a.r,g:a.g,b:a.b}}},HSVA_OBJ:{read:function(a){return!!(b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v)&&b.isNumber(a.a))&&{space:"HSV",h:a.h,s:a.s,v:a.v,a:a.a}},write:function(a){return{h:a.h,s:a.s,v:a.v,a:a.a}}},HSV_OBJ:{read:function(a){return!!(b.isNumber(a.h)&&b.isNumber(a.s)&&b.isNumber(a.v))&&{space:"HSV",h:a.h,s:a.s,v:a.v}},write:function(a){return{h:a.h,s:a.s,v:a.v}}}}}];return e}(d.color.toString,d.utils.common),d.GUI=d.gui.GUI=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(a,b,c,f){if(void 0===b[c])throw new Error("Object "+b+' has no property "'+c+'"');var g;if(f.color)g=new k(b,c);else{var h=[b,c].concat(f.factoryArgs);g=d.apply(a,h)}f.before instanceof e&&(f.before=f.before.__li),s(a,g),n.addClass(g.domElement,"c");var i=document.createElement("span");n.addClass(i,"property-name"),i.innerHTML=g.property;var j=document.createElement("div");j.id="dat-"+g.property,j.appendChild(i),j.appendChild(g.domElement);var l=q(a,j,f.before);return n.addClass(l,J.CLASS_CONTROLLER_ROW),n.addClass(l,typeof g.getValue()),r(a,l,g),a.__controllers.push(g),g}function q(a,b,c){var d=document.createElement("li");return b&&d.appendChild(b),c?a.__ul.insertBefore(d,params.before):a.__ul.appendChild(d),a.onResize(),d}function r(a,b,c){if(c.__li=b,c.__gui=a,o.extend(c,{options:function(b){return arguments.length>1?(c.remove(),p(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[o.toArray(arguments)]})):o.isArray(b)||o.isObject(b)?(c.remove(),p(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[b]})):void 0},name:function(a){return c.__li.firstElementChild.firstElementChild.innerHTML=a,c},listen:function(){return c.__gui.listen(c),c},remove:function(){return c.__gui.remove(c),c}}),c instanceof i){var d=new h(c.object,c.property,{min:c.__min,max:c.__max,step:c.__step});o.each(["updateDisplay","onChange","onFinishChange"],function(a){var b=c[a],e=d[a];c[a]=d[a]=function(){var a=Array.prototype.slice.call(arguments);return b.apply(c,a),e.apply(d,a)}}),n.addClass(b,"has-slider"),c.domElement.insertBefore(d.domElement,c.domElement.firstElementChild)}else if(c instanceof h){var e=function(b){return o.isNumber(c.__min)&&o.isNumber(c.__max)?(c.remove(),p(a,c.object,c.property,{before:c.__li.nextElementSibling,factoryArgs:[c.__min,c.__max,c.__step]})):b};c.min=o.compose(e,c.min),c.max=o.compose(e,c.max)}else c instanceof f?(n.bind(b,"click",function(){n.fakeEvent(c.__checkbox,"click")}),n.bind(c.__checkbox,"click",function(a){a.stopPropagation()})):c instanceof g?(n.bind(b,"click",function(){n.fakeEvent(c.__button,"click")}),n.bind(b,"mouseover",function(){n.addClass(c.__button,"hover")}),n.bind(b,"mouseout",function(){n.removeClass(c.__button,"hover")})):c instanceof k&&(n.addClass(b,"color"),c.updateDisplay=o.compose(function(a){return b.style.borderLeftColor=c.__color.toString(),a},c.updateDisplay),c.updateDisplay());c.setValue=o.compose(function(b){return a.getRoot().__preset_select&&c.isModified()&&A(a.getRoot(),!0),b},c.setValue)}function s(a,b){var c=a.getRoot(),d=c.__rememberedObjects.indexOf(b.object);if(-1!=d){var e=c.__rememberedObjectIndecesToControllers[d];if(void 0===e&&(e={},c.__rememberedObjectIndecesToControllers[d]=e),e[b.property]=b,c.load&&c.load.remembered){var f,g=c.load.remembered;if(g[a.preset])f=g[a.preset];else{if(!g[E])return;f=g[E]}if(f[d]&&void 0!==f[d][b.property]){var h=f[d][b.property];b.initialValue=h,b.setValue(h)}}}}function t(a,b){return document.location.href+"."+b}function u(a){var b=a.__save_row=document.createElement("li");n.addClass(a.domElement,"has-save"),a.__ul.insertBefore(b,a.__ul.firstChild),n.addClass(b,"save-row");var c=document.createElement("span");c.innerHTML="&nbsp;",n.addClass(c,"button gears");var d=document.createElement("span");d.innerHTML="Save",n.addClass(d,"button"),n.addClass(d,"save");var e=document.createElement("span");e.innerHTML="New",n.addClass(e,"button"),n.addClass(e,"save-as");var f=document.createElement("span");f.innerHTML="Revert",n.addClass(f,"button"),n.addClass(f,"revert");var g=a.__preset_select=document.createElement("select");if(a.load&&a.load.remembered?o.each(a.load.remembered,function(b,c){y(a,c,c==a.preset)}):y(a,E,!1),n.bind(g,"change",function(){for(var b=0;b<a.__preset_select.length;b++)a.__preset_select[b].innerHTML=a.__preset_select[b].value;a.preset=this.value}),b.appendChild(g),b.appendChild(c),b.appendChild(d),b.appendChild(e),b.appendChild(f),F){var h=document.getElementById("dg-save-locally"),i=document.getElementById("dg-local-explain");h.style.display="block";var j=document.getElementById("dg-local-storage");"true"===localStorage.getItem(t(a,"isLocal"))&&j.setAttribute("checked","checked");var k=function(){i.style.display=a.useLocalStorage?"block":"none"};k(),n.bind(j,"change",function(){a.useLocalStorage=!a.useLocalStorage,k()})}var l=document.getElementById("dg-new-constructor");n.bind(l,"keydown",function(a){!a.metaKey||67!==a.which&&67!=a.keyCode||C.hide()}),n.bind(c,"click",function(){l.innerHTML=JSON.stringify(a.getSaveObject(),void 0,2),C.show(),l.focus(),l.select()}),n.bind(d,"click",function(){a.save()}),n.bind(e,"click",function(){var b=prompt("Enter a new preset name.");b&&a.saveAs(b)}),n.bind(f,"click",function(){a.revert()})}function v(a){function b(b){return b.preventDefault(),e=b.clientX,n.addClass(a.__closeButton,J.CLASS_DRAG),n.bind(window,"mousemove",c),n.bind(window,"mouseup",d),!1}function c(b){return b.preventDefault(),a.width+=e-b.clientX,a.onResize(),e=b.clientX,!1}function d(){n.removeClass(a.__closeButton,J.CLASS_DRAG),n.unbind(window,"mousemove",c),n.unbind(window,"mouseup",d)}a.__resize_handle=document.createElement("div"),o.extend(a.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"});var e;n.bind(a.__resize_handle,"mousedown",b),n.bind(a.__closeButton,"mousedown",b),a.domElement.insertBefore(a.__resize_handle,a.domElement.firstElementChild)}function w(a,b){a.domElement.style.width=b+"px",a.__save_row&&a.autoPlace&&(a.__save_row.style.width=b+"px"),a.__closeButton&&(a.__closeButton.style.width=b+"px")}function x(a,b){var c={};return o.each(a.__rememberedObjects,function(d,e){var f={},g=a.__rememberedObjectIndecesToControllers[e];o.each(g,function(a,c){f[c]=b?a.initialValue:a.getValue()}),c[e]=f}),c}function y(a,b,c){var d=document.createElement("option");d.innerHTML=b,d.value=b,a.__preset_select.appendChild(d),c&&(a.__preset_select.selectedIndex=a.__preset_select.length-1)}function z(a){for(var b=0;b<a.__preset_select.length;b++)a.__preset_select[b].value==a.preset&&(a.__preset_select.selectedIndex=b)}function A(a,b){var c=a.__preset_select[a.__preset_select.selectedIndex];c.innerHTML=b?c.value+"*":c.value}function B(a){0!=a.length&&l(function(){B(a)}),o.each(a,function(a){a.updateDisplay()})}a.inject(".dg {\n  /** Clear list styles */\n  /* Auto-place container */\n  /* Auto-placed GUI's */\n  /* Line items that don't contain folders. */\n  /** Folder names */\n  /** Hides closed items */\n  /** Controller row */\n  /** Name-half (left) */\n  /** Controller-half (right) */\n  /** Controller placement */\n  /** Shorter number boxes when slider is present. */\n  /** Ensure the entire boolean and function row shows a hand */ }\n  .dg ul {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n    width: 100%;\n    clear: both; }\n  .dg.ac {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 0;\n    z-index: 0; }\n  .dg:not(.ac) .main {\n    /** Exclude mains in ac so that we don't hide close button */\n    overflow: hidden; }\n  .dg.main {\n    -webkit-transition: opacity 0.1s linear;\n    -o-transition: opacity 0.1s linear;\n    -moz-transition: opacity 0.1s linear;\n    transition: opacity 0.1s linear; }\n    .dg.main.taller-than-window {\n      overflow-y: auto; }\n      .dg.main.taller-than-window .close-button {\n        opacity: 1;\n        /* TODO, these are style notes */\n        margin-top: -1px;\n        border-top: 1px solid #2c2c2c; }\n    .dg.main ul.closed .close-button {\n      opacity: 1 !important; }\n    .dg.main:hover .close-button,\n    .dg.main .close-button.drag {\n      opacity: 1; }\n    .dg.main .close-button {\n      /*opacity: 0;*/\n      -webkit-transition: opacity 0.1s linear;\n      -o-transition: opacity 0.1s linear;\n      -moz-transition: opacity 0.1s linear;\n      transition: opacity 0.1s linear;\n      border: 0;\n      position: absolute;\n      line-height: 19px;\n      height: 20px;\n      /* TODO, these are style notes */\n      cursor: pointer;\n      text-align: center;\n      background-color: #000; }\n      .dg.main .close-button:hover {\n        background-color: #111; }\n  .dg.a {\n    float: right;\n    margin-right: 15px;\n    overflow-x: hidden; }\n    .dg.a.has-save > ul {\n      margin-top: 27px; }\n      .dg.a.has-save > ul.closed {\n        margin-top: 0; }\n    .dg.a .save-row {\n      position: fixed;\n      top: 0;\n      z-index: 1002; }\n  .dg li {\n    -webkit-transition: height 0.1s ease-out;\n    -o-transition: height 0.1s ease-out;\n    -moz-transition: height 0.1s ease-out;\n    transition: height 0.1s ease-out; }\n  .dg li:not(.folder) {\n    cursor: auto;\n    height: 27px;\n    line-height: 27px;\n    overflow: hidden;\n    padding: 0 4px 0 5px; }\n  .dg li.folder {\n    padding: 0;\n    border-left: 4px solid rgba(0, 0, 0, 0); }\n  .dg li.title {\n    cursor: pointer;\n    margin-left: -4px; }\n  .dg .closed li:not(.title),\n  .dg .closed ul li,\n  .dg .closed ul li > * {\n    height: 0;\n    overflow: hidden;\n    border: 0; }\n  .dg .cr {\n    clear: both;\n    padding-left: 3px;\n    height: 27px; }\n  .dg .property-name {\n    cursor: default;\n    float: left;\n    clear: left;\n    width: 40%;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  .dg .c {\n    float: left;\n    width: 60%; }\n  .dg .c input[type=text] {\n    border: 0;\n    margin-top: 4px;\n    padding: 3px;\n    width: 100%;\n    float: right; }\n  .dg .has-slider input[type=text] {\n    width: 30%;\n    /*display: none;*/\n    margin-left: 0; }\n  .dg .slider {\n    float: left;\n    width: 66%;\n    margin-left: -5px;\n    margin-right: 0;\n    height: 19px;\n    margin-top: 4px; }\n  .dg .slider-fg {\n    height: 100%; }\n  .dg .c input[type=checkbox] {\n    margin-top: 9px; }\n  .dg .c select {\n    margin-top: 5px; }\n  .dg .cr.function,\n  .dg .cr.function .property-name,\n  .dg .cr.function *,\n  .dg .cr.boolean,\n  .dg .cr.boolean * {\n    cursor: pointer; }\n  .dg .selector {\n    display: none;\n    position: absolute;\n    margin-left: -9px;\n    margin-top: 23px;\n    z-index: 10; }\n  .dg .c:hover .selector,\n  .dg .selector.drag {\n    display: block; }\n  .dg li.save-row {\n    padding: 0; }\n    .dg li.save-row .button {\n      display: inline-block;\n      padding: 0px 6px; }\n  .dg.dialogue {\n    background-color: #222;\n    width: 460px;\n    padding: 15px;\n    font-size: 13px;\n    line-height: 15px; }\n\n/* TODO Separate style and structure */\n#dg-new-constructor {\n  padding: 10px;\n  color: #222;\n  font-family: Monaco, monospace;\n  font-size: 10px;\n  border: 0;\n  resize: none;\n  box-shadow: inset 1px 1px 1px #888;\n  word-wrap: break-word;\n  margin: 12px 0;\n  display: block;\n  width: 440px;\n  overflow-y: scroll;\n  height: 100px;\n  position: relative; }\n\n#dg-local-explain {\n  display: none;\n  font-size: 11px;\n  line-height: 17px;\n  border-radius: 3px;\n  background-color: #333;\n  padding: 8px;\n  margin-top: 10px; }\n  #dg-local-explain code {\n    font-size: 10px; }\n\n#dat-gui-save-locally {\n  display: none; }\n\n/** Main type */\n.dg {\n  color: #eee;\n  font: 11px 'Lucida Grande', sans-serif;\n  text-shadow: 0 -1px 0 #111;\n  /** Auto place */\n  /* Controller row, <li> */\n  /** Controllers */ }\n  .dg.main {\n    /** Scrollbar */ }\n    .dg.main::-webkit-scrollbar {\n      width: 5px;\n      background: #1a1a1a; }\n    .dg.main::-webkit-scrollbar-corner {\n      height: 0;\n      display: none; }\n    .dg.main::-webkit-scrollbar-thumb {\n      border-radius: 5px;\n      background: #676767; }\n  .dg li:not(.folder) {\n    background: #1a1a1a;\n    border-bottom: 1px solid #2c2c2c; }\n  .dg li.save-row {\n    line-height: 25px;\n    background: #dad5cb;\n    border: 0; }\n    .dg li.save-row select {\n      margin-left: 5px;\n      width: 108px; }\n    .dg li.save-row .button {\n      margin-left: 5px;\n      margin-top: 1px;\n      border-radius: 2px;\n      font-size: 9px;\n      line-height: 7px;\n      padding: 4px 4px 5px 4px;\n      background: #c5bdad;\n      color: #fff;\n      text-shadow: 0 1px 0 #b0a58f;\n      box-shadow: 0 -1px 0 #b0a58f;\n      cursor: pointer; }\n      .dg li.save-row .button.gears {\n        background: #c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;\n        height: 7px;\n        width: 8px; }\n      .dg li.save-row .button:hover {\n        background-color: #bab19e;\n        box-shadow: 0 -1px 0 #b0a58f; }\n  .dg li.folder {\n    border-bottom: 0; }\n  .dg li.title {\n    padding-left: 16px;\n    background: black url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;\n    cursor: pointer;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.2); }\n  .dg .closed li.title {\n    background-image: url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==); }\n  .dg .cr.boolean {\n    border-left: 3px solid #806787; }\n  .dg .cr.function {\n    border-left: 3px solid #e61d5f; }\n  .dg .cr.number {\n    border-left: 3px solid #2fa1d6; }\n    .dg .cr.number input[type=text] {\n      color: #2fa1d6; }\n  .dg .cr.string {\n    border-left: 3px solid #1ed36f; }\n    .dg .cr.string input[type=text] {\n      color: #1ed36f; }\n  .dg .cr.function:hover, .dg .cr.boolean:hover {\n    background: #111; }\n  .dg .c input[type=text] {\n    background: #303030;\n    outline: none; }\n    .dg .c input[type=text]:hover {\n      background: #3c3c3c; }\n    .dg .c input[type=text]:focus {\n      background: #494949;\n      color: #fff; }\n  .dg .c .slider {\n    background: #303030;\n    cursor: ew-resize; }\n  .dg .c .slider-fg {\n    background: #2fa1d6; }\n  .dg .c .slider:hover {\n    background: #3c3c3c; }\n    .dg .c .slider:hover .slider-fg {\n      background: #44abda; }\n");var C,D,E="Default",F=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}(),G=!0,H=!1,I=[],J=function(a){var b=this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),n.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],a=a||{},a=o.defaults(a,{autoPlace:!0,width:J.DEFAULT_WIDTH}),a=o.defaults(a,{resizable:a.autoPlace,hideable:a.autoPlace}),o.isUndefined(a.load)?a.load={preset:E}:a.preset&&(a.load.preset=a.preset),o.isUndefined(a.parent)&&a.hideable&&I.push(this),a.resizable=o.isUndefined(a.parent)&&a.resizable,a.autoPlace&&o.isUndefined(a.scrollable)&&(a.scrollable=!0);var c,d=F&&"true"===localStorage.getItem(t(this,"isLocal"));if(Object.defineProperties(this,{parent:{get:function(){return a.parent}},scrollable:{get:function(){return a.scrollable}},autoPlace:{get:function(){return a.autoPlace}},preset:{get:function(){return b.parent?b.getRoot().preset:a.load.preset},set:function(c){b.parent?b.getRoot().preset=c:a.load.preset=c,z(this),b.revert()}},width:{get:function(){return a.width},set:function(c){a.width=c,w(b,c)}},name:{get:function(){return a.name},set:function(b){a.name=b,f&&(f.innerHTML=a.name)}},closed:{get:function(){return a.closed},set:function(c){a.closed=c,a.closed?n.addClass(b.__ul,J.CLASS_CLOSED):n.removeClass(b.__ul,J.CLASS_CLOSED),this.onResize(),b.__closeButton&&(b.__closeButton.innerHTML=c?J.TEXT_OPEN:J.TEXT_CLOSED)}},load:{get:function(){return a.load}},useLocalStorage:{get:function(){return d},set:function(a){F&&(d=a,a?n.bind(window,"unload",c):n.unbind(window,"unload",c),localStorage.setItem(t(b,"isLocal"),a))}}}),o.isUndefined(a.parent)){if(a.closed=!1,n.addClass(this.domElement,J.CLASS_MAIN),n.makeSelectable(this.domElement,!1),F&&d){b.useLocalStorage=!0;var e=localStorage.getItem(t(this,"gui"));e&&(a.load=JSON.parse(e))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=J.TEXT_CLOSED,n.addClass(this.__closeButton,J.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),n.bind(this.__closeButton,"click",function(){b.closed=!b.closed})}else{void 0===a.closed&&(a.closed=!0);var f=document.createTextNode(a.name);n.addClass(f,"controller-name");var g=q(b,f),h=function(a){return a.preventDefault(),b.closed=!b.closed,!1};n.addClass(this.__ul,J.CLASS_CLOSED),n.addClass(g,"title"),n.bind(g,"click",h),a.closed||(this.closed=!1)}a.autoPlace&&(o.isUndefined(a.parent)&&(G&&(D=document.createElement("div"),n.addClass(D,"dg"),n.addClass(D,J.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(D),G=!1),D.appendChild(this.domElement),n.addClass(this.domElement,J.CLASS_AUTO_PLACE)),this.parent||w(b,a.width)),n.bind(window,"resize",function(){b.onResize()}),n.bind(this.__ul,"webkitTransitionEnd",function(){b.onResize()}),n.bind(this.__ul,"transitionend",function(){b.onResize()}),n.bind(this.__ul,"oTransitionEnd",function(){b.onResize()}),this.onResize(),a.resizable&&v(this),c=function(){F&&"true"===localStorage.getItem(t(b,"isLocal"))&&localStorage.setItem(t(b,"gui"),JSON.stringify(b.getSaveObject()))},this.saveToLocalStorageIfPossible=c,b.getRoot(),a.parent||function(){var a=b.getRoot();a.width+=1,o.defer(function(){a.width-=1})}()};return J.toggleHide=function(){H=!H,o.each(I,function(a){a.domElement.style.zIndex=H?-999:999,a.domElement.style.opacity=H?0:1})},J.CLASS_AUTO_PLACE="a",J.CLASS_AUTO_PLACE_CONTAINER="ac",J.CLASS_MAIN="main",J.CLASS_CONTROLLER_ROW="cr",J.CLASS_TOO_TALL="taller-than-window",J.CLASS_CLOSED="closed",J.CLASS_CLOSE_BUTTON="close-button",J.CLASS_DRAG="drag",J.DEFAULT_WIDTH=245,J.TEXT_CLOSED="Close Controls",J.TEXT_OPEN="Open Controls",n.bind(window,"keydown",function(a){"text"===document.activeElement.type||72!==a.which&&72!=a.keyCode||J.toggleHide()},!1),o.extend(J.prototype,{add:function(a,b){return p(this,a,b,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(a,b){return p(this,a,b,{color:!0})},remove:function(a){this.__ul.removeChild(a.__li),this.__controllers.slice(this.__controllers.indexOf(a),1);var b=this;o.defer(function(){b.onResize()})},destroy:function(){this.autoPlace&&D.removeChild(this.domElement)},addFolder:function(a){if(void 0!==this.__folders[a])throw new Error('You already have a folder in this GUI by the name "'+a+'"');var b={name:a,parent:this};b.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[a]&&(b.closed=this.load.folders[a].closed,b.load=this.load.folders[a]);var c=new J(b);this.__folders[a]=c;var d=q(this,c.domElement);return n.addClass(d,"folder"),c},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var a=this.getRoot();if(a.scrollable){var b=n.getOffset(a.__ul).top,c=0;o.each(a.__ul.childNodes,function(b){a.autoPlace&&b===a.__save_row||(c+=n.getHeight(b))}),window.innerHeight-b-20<c?(n.addClass(a.domElement,J.CLASS_TOO_TALL),a.__ul.style.height=window.innerHeight-b-20+"px"):(n.removeClass(a.domElement,J.CLASS_TOO_TALL),a.__ul.style.height="auto")}a.__resize_handle&&o.defer(function(){a.__resize_handle.style.height=a.__ul.offsetHeight+"px"}),a.__closeButton&&(a.__closeButton.style.width=a.width+"px")},remember:function(){if(o.isUndefined(C)&&(C=new m,C.domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var a=this;o.each(Array.prototype.slice.call(arguments),function(b){0==a.__rememberedObjects.length&&u(a),-1==a.__rememberedObjects.indexOf(b)&&a.__rememberedObjects.push(b)}),this.autoPlace&&w(this,this.width)},getRoot:function(){for(var a=this;a.parent;)a=a.parent;return a},getSaveObject:function(){var a=this.load;return a.closed=this.closed,this.__rememberedObjects.length>0&&(a.preset=this.preset,a.remembered||(a.remembered={}),a.remembered[this.preset]=x(this)),a.folders={},o.each(this.__folders,function(b,c){a.folders[c]=b.getSaveObject()}),a},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=x(this),A(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(a){this.load.remembered||(this.load.remembered={},this.load.remembered[E]=x(this,!0)),this.load.remembered[a]=x(this),this.preset=a,y(this,a,!0),this.saveToLocalStorageIfPossible()},revert:function(a){o.each(this.__controllers,function(b){this.getRoot().load.remembered?s(a||this.getRoot(),b):b.setValue(b.initialValue)},this),o.each(this.__folders,function(a){a.revert(a)}),a||A(this.getRoot(),!1)},listen:function(a){var b=0==this.__listening.length;this.__listening.push(a),b&&B(this.__listening)}}),J}(d.utils.css,0,0,d.controllers.factory=function(a,b,c,d,e,f,g){return function(h,i){var j=h[i];return g.isArray(arguments[2])||g.isObject(arguments[2])?new a(h,i,arguments[2]):g.isNumber(j)?g.isNumber(arguments[2])&&g.isNumber(arguments[3])?new c(h,i,arguments[2],arguments[3]):new b(h,i,{min:arguments[2],max:arguments[3]}):g.isString(j)?new d(h,i):g.isFunction(j)?new e(h,i,""):g.isBoolean(j)?new f(h,i):void 0}}(d.controllers.OptionController,d.controllers.NumberControllerBox,d.controllers.NumberControllerSlider,d.controllers.StringController=function(a,b,c){var d=function(a,c){function e(){g.setValue(g.__input.value)}function f(){g.__onFinishChange&&g.__onFinishChange.call(g,g.getValue())}d.superclass.call(this,a,c);var g=this;this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),b.bind(this.__input,"keyup",e),b.bind(this.__input,"change",e),b.bind(this.__input,"blur",f),b.bind(this.__input,"keydown",function(a){13===a.keyCode&&this.blur()}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return d.superclass=a,c.extend(d.prototype,a.prototype,{updateDisplay:function(){return b.isActive(this.__input)||(this.__input.value=this.getValue()),d.superclass.prototype.updateDisplay.call(this)}}),d}(d.controllers.Controller,d.dom.dom,d.utils.common),d.controllers.FunctionController,d.controllers.BooleanController,d.utils.common),d.controllers.Controller,d.controllers.BooleanController,d.controllers.FunctionController,d.controllers.NumberControllerBox,d.controllers.NumberControllerSlider,d.controllers.OptionController,d.controllers.ColorController=function(a,b,c,d,e){function f(a,b,c,d){a.style.background="",e.each(i,function(e){a.style.cssText+="background: "+e+"linear-gradient("+b+", "+c+" 0%, "+d+" 100%); "})}function g(a){a.style.background="",a.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",a.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",a.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",
a.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);"}var h=function(a,i){function j(a){n(a),b.bind(window,"mousemove",n),b.bind(window,"mouseup",k)}function k(){b.unbind(window,"mousemove",n),b.unbind(window,"mouseup",k)}function l(){var a=d(this.value);!1!==a?(p.__color.__state=a,p.setValue(p.__color.toOriginal())):this.value=p.__color.toString()}function m(){b.unbind(window,"mousemove",o),b.unbind(window,"mouseup",m)}function n(a){a.preventDefault();var c=b.getWidth(p.__saturation_field),d=b.getOffset(p.__saturation_field),e=(a.clientX-d.left+document.body.scrollLeft)/c,f=1-(a.clientY-d.top+document.body.scrollTop)/c;return f>1?f=1:f<0&&(f=0),e>1?e=1:e<0&&(e=0),p.__color.v=f,p.__color.s=e,p.setValue(p.__color.toOriginal()),!1}function o(a){a.preventDefault();var c=b.getHeight(p.__hue_field),d=b.getOffset(p.__hue_field),e=1-(a.clientY-d.top+document.body.scrollTop)/c;return e>1?e=1:e<0&&(e=0),p.__color.h=360*e,p.setValue(p.__color.toOriginal()),!1}h.superclass.call(this,a,i),this.__color=new c(this.getValue()),this.__temp=new c(0);var p=this;this.domElement=document.createElement("div"),b.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",b.bind(this.__input,"keydown",function(a){13===a.keyCode&&l.call(this)}),b.bind(this.__input,"blur",l),b.bind(this.__selector,"mousedown",function(a){b.addClass(this,"drag").bind(window,"mouseup",function(a){b.removeClass(p.__selector,"drag")})});var q=document.createElement("div");e.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),e.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),e.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),e.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),e.extend(q.style,{width:"100%",height:"100%",background:"none"}),f(q,"top","rgba(0,0,0,0)","#000"),e.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),g(this.__hue_field),e.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),b.bind(this.__saturation_field,"mousedown",j),b.bind(this.__field_knob,"mousedown",j),b.bind(this.__hue_field,"mousedown",function(a){o(a),b.bind(window,"mousemove",o),b.bind(window,"mouseup",m)}),this.__saturation_field.appendChild(q),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};h.superclass=a,e.extend(h.prototype,a.prototype,{updateDisplay:function(){var a=d(this.getValue());if(!1!==a){var b=!1;e.each(c.COMPONENTS,function(c){if(!e.isUndefined(a[c])&&!e.isUndefined(this.__color.__state[c])&&a[c]!==this.__color.__state[c])return b=!0,{}},this),b&&e.extend(this.__color.__state,a)}e.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var g=this.__color.v<.5||this.__color.s>.5?255:0,h=255-g;e.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+g+","+g+","+g+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,f(this.__saturation_field,"left","#fff",this.__temp.toString()),e.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+g+","+g+","+g+")",textShadow:this.__input_textShadow+"rgba("+h+","+h+","+h+",.7)"})}});var i=["-moz-","-o-","-webkit-","-ms-",""];return h}(d.controllers.Controller,d.dom.dom,d.color.Color=function(a,b,c,d){function e(a,b,c){Object.defineProperty(a,b,{get:function(){return"RGB"===this.__state.space?this.__state[b]:(g(this,b,c),this.__state[b])},set:function(a){"RGB"!==this.__state.space&&(g(this,b,c),this.__state.space="RGB"),this.__state[b]=a}})}function f(a,b){Object.defineProperty(a,b,{get:function(){return"HSV"===this.__state.space?this.__state[b]:(h(this),this.__state[b])},set:function(a){"HSV"!==this.__state.space&&(h(this),this.__state.space="HSV"),this.__state[b]=a}})}function g(a,c,e){if("HEX"===a.__state.space)a.__state[c]=b.component_from_hex(a.__state.hex,e);else{if("HSV"!==a.__state.space)throw"Corrupted color state";d.extend(a.__state,b.hsv_to_rgb(a.__state.h,a.__state.s,a.__state.v))}}function h(a){var c=b.rgb_to_hsv(a.r,a.g,a.b);d.extend(a.__state,{s:c.s,v:c.v}),d.isNaN(c.h)?d.isUndefined(a.__state.h)&&(a.__state.h=0):a.__state.h=c.h}var i=function(){if(this.__state=a.apply(this,arguments),!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};return i.COMPONENTS=["r","g","b","h","s","v","hex","a"],d.extend(i.prototype,{toString:function(){return c(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),e(i.prototype,"r",2),e(i.prototype,"g",1),e(i.prototype,"b",0),f(i.prototype,"h"),f(i.prototype,"s"),f(i.prototype,"v"),Object.defineProperty(i.prototype,"a",{get:function(){return this.__state.a},set:function(a){this.__state.a=a}}),Object.defineProperty(i.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=b.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(a){this.__state.space="HEX",this.__state.hex=a}}),i}(d.color.interpret,d.color.math=function(){var a;return{hsv_to_rgb:function(a,b,c){var d=Math.floor(a/60)%6,e=a/60-Math.floor(a/60),f=c*(1-b),g=c*(1-e*b),h=c*(1-(1-e)*b),i=[[c,h,f],[g,c,f],[f,c,h],[f,g,c],[h,f,c],[c,f,g]][d];return{r:255*i[0],g:255*i[1],b:255*i[2]}},rgb_to_hsv:function(a,b,c){var d,e,f=Math.min(a,b,c),g=Math.max(a,b,c),h=g-f;return 0==g?{h:NaN,s:0,v:0}:(e=h/g,d=a==g?(b-c)/h:b==g?2+(c-a)/h:4+(a-b)/h,d/=6,d<0&&(d+=1),{h:360*d,s:e,v:g/255})},rgb_to_hex:function(a,b,c){var d=this.hex_with_component(0,2,a);return d=this.hex_with_component(d,1,b),d=this.hex_with_component(d,0,c)},component_from_hex:function(a,b){return a>>8*b&255},hex_with_component:function(b,c,d){return d<<(a=8*c)|b&~(255<<a)}}}(),d.color.toString,d.utils.common),d.color.interpret,d.utils.common),d.utils.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){window.setTimeout(a,1e3/60)}}(),d.dom.CenteredDiv=function(a,b){var c=function(){this.backgroundElement=document.createElement("div"),b.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),a.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),b.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var c=this;a.bind(this.backgroundElement,"click",function(){c.hide()})};return c.prototype.show=function(){var a=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),b.defer(function(){a.backgroundElement.style.opacity=1,a.domElement.style.opacity=1,a.domElement.style.webkitTransform="scale(1)"})},c.prototype.hide=function(){var b=this,c=function(){b.domElement.style.display="none",b.backgroundElement.style.display="none",a.unbind(b.domElement,"webkitTransitionEnd",c),a.unbind(b.domElement,"transitionend",c),a.unbind(b.domElement,"oTransitionEnd",c)};a.bind(this.domElement,"webkitTransitionEnd",c),a.bind(this.domElement,"transitionend",c),a.bind(this.domElement,"oTransitionEnd",c),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},c.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-a.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-a.getHeight(this.domElement)/2+"px"},c}(d.dom.dom,d.utils.common),d.dom.dom,d.utils.common)},{}],77:[function(a,b,c){!function(a){a.getUrlParam=function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)"),c=window.location.search.substr(1).match(b);return null!=c?unescape(c[2]):null}}(jQuery)},{}],78:[function(a,b,c){"use strict";var d=a("three");d.EffectComposer=function(a,b){if(this.renderer=a,void 0===b){var c={minFilter:d.LinearFilter,magFilter:d.LinearFilter,format:d.RGBAFormat,stencilBuffer:!1},e=a.getSize();b=new d.WebGLRenderTarget(e.width,e.height,c)}this.renderTarget1=b,this.renderTarget2=b.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===d.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),this.copyPass=new d.ShaderPass(d.CopyShader)},d.EffectComposer.prototype={swapBuffers:function(){var a=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=a},addPass:function(a){this.passes.push(a)},insertPass:function(a,b){this.passes.splice(b,0,a)},render:function(a){this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2;var b,c,e=!1,f=this.passes.length;for(c=0;c<f;c++)if(b=this.passes[c],b.enabled){if(b.render(this.renderer,this.writeBuffer,this.readBuffer,a,e),b.needsSwap){if(e){var g=this.renderer.context;g.stencilFunc(g.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,a),g.stencilFunc(g.EQUAL,1,4294967295)}this.swapBuffers()}b instanceof d.MaskPass?e=!0:b instanceof d.ClearMaskPass&&(e=!1)}},reset:function(a){if(void 0===a){var b=this.renderer.getSize();a=this.renderTarget1.clone(),a.setSize(b.width,b.height)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=a,this.renderTarget2=a.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(a,b){this.renderTarget1.setSize(a,b),this.renderTarget2.setSize(a,b)}}},{three:177}],79:[function(a,b,c){"use strict";var d=a("three");d.MaskPass=function(a,b){this.scene=a,this.camera=b,this.enabled=!0,this.clear=!0,this.needsSwap=!1,this.inverse=!1},d.MaskPass.prototype={render:function(a,b,c,d){var e=a.context;e.colorMask(!1,!1,!1,!1),e.depthMask(!1);var f,g;this.inverse?(f=0,g=1):(f=1,g=0),e.enable(e.STENCIL_TEST),e.stencilOp(e.REPLACE,e.REPLACE,e.REPLACE),e.stencilFunc(e.ALWAYS,f,4294967295),e.clearStencil(g),a.render(this.scene,this.camera,c,this.clear),a.render(this.scene,this.camera,b,this.clear),e.colorMask(!0,!0,!0,!0),e.depthMask(!0),e.stencilFunc(e.EQUAL,1,4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}},d.ClearMaskPass=function(){this.enabled=!0},d.ClearMaskPass.prototype={render:function(a,b,c,d){var e=a.context;e.disable(e.STENCIL_TEST)}}},{three:177}],80:[function(a,b,c){"use strict";var d=a("three");d.RenderPass=function(a,b,c,e,f){this.scene=a,this.camera=b,this.overrideMaterial=c,this.clearColor=e,this.clearAlpha=void 0!==f?f:1,this.oldClearColor=new d.Color,this.oldClearAlpha=1,this.enabled=!0,this.clear=!0,this.needsSwap=!1},d.RenderPass.prototype={render:function(a,b,c,d){this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(this.oldClearColor.copy(a.getClearColor()),this.oldClearAlpha=a.getClearAlpha(),a.setClearColor(this.clearColor,this.clearAlpha)),a.render(this.scene,this.camera,c,this.clear),this.clearColor&&a.setClearColor(this.oldClearColor,this.oldClearAlpha),this.scene.overrideMaterial=null}}},{three:177}],81:[function(a,b,c){"use strict";var d=a("three");d.ShaderPass=function(a,b){this.textureID=void 0!==b?b:"tDiffuse",a instanceof d.ShaderMaterial?(this.uniforms=a.uniforms,this.material=a):a&&(this.uniforms=d.UniformsUtils.clone(a.uniforms),this.material=new d.ShaderMaterial({defines:a.defines||{},uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader})),this.renderToScreen=!1,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.camera=new d.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new d.Scene,this.quad=new d.Mesh(new d.PlaneBufferGeometry(2,2),null),this.scene.add(this.quad)},d.ShaderPass.prototype={render:function(a,b,c,d){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=c),this.quad.material=this.material,this.renderToScreen?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)}}},{three:177}],82:[function(a,b,c){"use strict";a("three").CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")}},{three:177}],83:[function(a,b,c){"use strict";a("three").HorizontalBlurShader={uniforms:{tDiffuse:{type:"t",value:null},h:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")}},{three:177}],84:[function(a,b,c){"use strict";a("three").VerticalBlurShader={uniforms:{tDiffuse:{type:"t",value:null},v:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")}},{three:177}],85:[function(a,b,c){!function(a,d){"object"==typeof c&&void 0!==b?b.exports=d():"function"==typeof define&&define.amd?define(d):a.Stats=d()}(this,function(){var a=function(){function b(a){return e.appendChild(a.dom),a}function c(a){for(var b=0;b<e.children.length;b++)e.children[b].style.display=b===a?"block":"none";d=a}var d=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(a){a.preventDefault(),c(++d%e.children.length)},!1);var f=(performance||Date).now(),g=f,h=0,i=b(new a.Panel("FPS","#0ff","#002")),j=b(new a.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var k=b(new a.Panel("MB","#f08","#201"));return c(0),{REVISION:16,dom:e,addPanel:b,showPanel:c,begin:function(){f=(performance||Date).now()},end:function(){h++;var a=(performance||Date).now();if(j.update(a-f,200),a>g+1e3&&(i.update(1e3*h/(a-g),100),g=a,h=0,k)){var b=performance.memory;k.update(b.usedJSHeapSize/1048576,b.jsHeapSizeLimit/1048576)}return a},update:function(){f=this.end()},domElement:e,setMode:c}};return a.Panel=function(a,b,c){var d=1/0,e=0,f=Math.round,g=f(window.devicePixelRatio||1),h=80*g,i=48*g,j=3*g,k=2*g,l=3*g,m=15*g,n=74*g,o=30*g,p=document.createElement("canvas");p.width=h,p.height=i,p.style.cssText="width:80px;height:48px";var q=p.getContext("2d");return q.font="bold "+9*g+"px Helvetica,Arial,sans-serif",q.textBaseline="top",q.fillStyle=c,q.fillRect(0,0,h,i),q.fillStyle=b,q.fillText(a,j,k),q.fillRect(l,m,n,o),q.fillStyle=c,q.globalAlpha=.9,q.fillRect(l,m,n,o),{dom:p,update:function(i,r){d=Math.min(d,i),e=Math.max(e,i),q.fillStyle=c,q.globalAlpha=1,q.fillRect(0,0,h,m),q.fillStyle=b,q.fillText(f(i)+" "+a+" ("+f(d)+"-"+f(e)+")",j,k),q.drawImage(p,l+g,m,n-g,o,l,m,n-g,o),q.fillRect(l+n-g,m,g,o),q.fillStyle=c,q.globalAlpha=.9,q.fillRect(l+n-g,m,g,f((1-i/r)*o))}}},a})},{}],86:[function(a,b,c){"use strict";var d=a("three");!function(){if("performance"in window==0&&(window.performance={}),"now"in window.performance==0){var a=Date.now();performance.timing&&performance.timing.navigationStart&&(a=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-a}}}(),d.WebGLRenderer.prototype.paramThreeToGL=function(a){var b,c=this.extensions,e=this.context;if(a===d.RepeatWrapping)return e.REPEAT;if(a===d.ClampToEdgeWrapping)return e.CLAMP_TO_EDGE;if(a===d.MirroredRepeatWrapping)return e.MIRRORED_REPEAT;if(a===d.NearestFilter)return e.NEAREST;if(a===d.NearestMipMapNearestFilter)return e.NEAREST_MIPMAP_NEAREST;if(a===d.NearestMipMapLinearFilter)return e.NEAREST_MIPMAP_LINEAR;if(a===d.LinearFilter)return e.LINEAR;if(a===d.LinearMipMapNearestFilter)return e.LINEAR_MIPMAP_NEAREST;if(a===d.LinearMipMapLinearFilter)return e.LINEAR_MIPMAP_LINEAR;if(a===d.UnsignedByteType)return e.UNSIGNED_BYTE;if(a===d.UnsignedShort4444Type)return e.UNSIGNED_SHORT_4_4_4_4;if(a===d.UnsignedShort5551Type)return e.UNSIGNED_SHORT_5_5_5_1;if(a===d.UnsignedShort565Type)return e.UNSIGNED_SHORT_5_6_5;if(a===d.ByteType)return e.BYTE;if(a===d.ShortType)return e.SHORT;if(a===d.UnsignedShortType)return e.UNSIGNED_SHORT;if(a===d.IntType)return e.INT;if(a===d.UnsignedIntType)return e.UNSIGNED_INT;if(a===d.FloatType)return e.FLOAT;if(null!==(b=c.get("OES_texture_half_float"))&&a===d.HalfFloatType)return b.HALF_FLOAT_OES;if(a===d.AlphaFormat)return e.ALPHA;if(a===d.RGBFormat)return e.RGB;if(a===d.RGBAFormat)return e.RGBA;if(a===d.LuminanceFormat)return e.LUMINANCE;if(a===d.LuminanceAlphaFormat)return e.LUMINANCE_ALPHA;if(a===d.AddEquation)return e.FUNC_ADD;if(a===d.SubtractEquation)return e.FUNC_SUBTRACT;if(a===d.ReverseSubtractEquation)return e.FUNC_REVERSE_SUBTRACT;if(a===d.ZeroFactor)return e.ZERO;if(a===d.OneFactor)return e.ONE;if(a===d.SrcColorFactor)return e.SRC_COLOR;if(a===d.OneMinusSrcColorFactor)return e.ONE_MINUS_SRC_COLOR;if(a===d.SrcAlphaFactor)return e.SRC_ALPHA;if(a===d.OneMinusSrcAlphaFactor)return e.ONE_MINUS_SRC_ALPHA;if(a===d.DstAlphaFactor)return e.DST_ALPHA;if(a===d.OneMinusDstAlphaFactor)return e.ONE_MINUS_DST_ALPHA;if(a===d.DstColorFactor)return e.DST_COLOR;if(a===d.OneMinusDstColorFactor)return e.ONE_MINUS_DST_COLOR;if(a===d.SrcAlphaSaturateFactor)return e.SRC_ALPHA_SATURATE;if(null!==(b=c.get("WEBGL_compressed_texture_s3tc"))){if(a===d.RGB_S3TC_DXT1_Format)return b.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===d.RGBA_S3TC_DXT1_Format)return b.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===d.RGBA_S3TC_DXT3_Format)return b.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===d.RGBA_S3TC_DXT5_Format)return b.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(b=c.get("WEBGL_compressed_texture_pvrtc"))){if(a===d.RGB_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===d.RGB_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===d.RGBA_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===d.RGBA_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(b=c.get("WEBGL_compressed_texture_etc1"))&&a===d.RGB_ETC1_Format)return b.COMPRESSED_RGB_ETC1_WEBGL;if(null!==(b=c.get("EXT_blend_minmax"))){if(a===d.MinEquation)return b.MIN_EXT;if(a===d.MaxEquation)return b.MAX_EXT}return 0},d.WebGLState=function(a,b,c){var e=this,f=new d.Vector4,g=a.getParameter(a.MAX_VERTEX_ATTRIBS),h=new Uint8Array(g),i=new Uint8Array(g),j=new Uint8Array(g),k={},l=null,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=!1,u=null,v=null,w=null,x=null,y=null,z=null,A=null,B=null,C=null,D=null,E=null,F=null,G=null,H=null,I=null,J=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),K=void 0,L={},M=new d.Vector4,N=null,O=null,P=new d.Vector4,Q=new d.Vector4;this.init=function(){this.clearColor(0,0,0,1),this.clearDepth(1),this.clearStencil(0),this.enable(a.DEPTH_TEST),a.depthFunc(a.LEQUAL),a.frontFace(a.CCW),a.cullFace(a.BACK),this.enable(a.CULL_FACE),this.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA)},this.initAttributes=function(){for(var a=0,b=h.length;a<b;a++)h[a]=0},this.enableAttribute=function(c){if(h[c]=1,0===i[c]&&(a.enableVertexAttribArray(c),i[c]=1),0!==j[c]){b.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(c,0),j[c]=0}},this.enableAttributeAndDivisor=function(b,c,d){h[b]=1,0===i[b]&&(a.enableVertexAttribArray(b),i[b]=1),j[b]!==c&&(d.vertexAttribDivisorANGLE(b,c),j[b]=c)},this.disableUnusedAttributes=function(){for(var b=0,c=i.length;b<c;b++)i[b]!==h[b]&&(a.disableVertexAttribArray(b),i[b]=0)},this.enable=function(b){!0!==k[b]&&(a.enable(b),k[b]=!0)},this.disable=function(b){!1!==k[b]&&(a.disable(b),k[b]=!1)},this.getCompressedTextureFormats=function(){if(null===l&&(l=[],b.get("WEBGL_compressed_texture_pvrtc")||b.get("WEBGL_compressed_texture_s3tc")||b.get("WEBGL_compressed_texture_etc1")))for(var c=a.getParameter(a.COMPRESSED_TEXTURE_FORMATS),d=0;d<c.length;d++)l.push(c[d]);return l},this.setBlending=function(b,e,f,g,h,i,j,k){b===d.NoBlending?this.disable(a.BLEND):this.enable(a.BLEND),b===m&&k===t||(b===d.AdditiveBlending?k?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):b===d.SubtractiveBlending?k?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):b===d.MultiplyBlending?k?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.SRC_COLOR,a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):k?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),m=b,t=k),b===d.CustomBlending?(h=h||e,i=i||f,j=j||g,e===n&&h===q||(a.blendEquationSeparate(c(e),c(h)),n=e,q=h),f===o&&g===p&&i===r&&j===s||(a.blendFuncSeparate(c(f),c(g),c(i),c(j)),o=f,p=g,r=i,s=j)):(n=null,o=null,p=null,q=null,r=null,s=null)},this.setDepthFunc=function(b){if(u!==b){if(b)switch(b){case d.NeverDepth:a.depthFunc(a.NEVER);break;case d.AlwaysDepth:a.depthFunc(a.ALWAYS);break;case d.LessDepth:a.depthFunc(a.LESS);break;case d.LessEqualDepth:a.depthFunc(a.LEQUAL);break;case d.EqualDepth:a.depthFunc(a.EQUAL);break;case d.GreaterEqualDepth:a.depthFunc(a.GEQUAL);break;case d.GreaterDepth:a.depthFunc(a.GREATER);break;case d.NotEqualDepth:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}else a.depthFunc(a.LEQUAL);u=b}},this.setDepthTest=function(b){b?this.enable(a.DEPTH_TEST):this.disable(a.DEPTH_TEST)},this.setDepthWrite=function(b){v!==b&&(a.depthMask(b),v=b)},this.setColorWrite=function(b){w!==b&&(a.colorMask(b,b,b,b),w=b)},this.setStencilFunc=function(b,c,d){y===b&&z===c&&A===d||(a.stencilFunc(b,c,d),y=b,z=c,A=d)},this.setStencilOp=function(b,c,d){B===b&&C===c&&D===d||(a.stencilOp(b,c,d),B=b,C=c,D=d)},this.setStencilTest=function(b){b?this.enable(a.STENCIL_TEST):this.disable(a.STENCIL_TEST)},this.setStencilWrite=function(b){x!==b&&(a.stencilMask(b),x=b)},this.setFlipSided=function(b){E!==b&&(b?a.frontFace(a.CW):a.frontFace(a.CCW),E=b)},this.setLineWidth=function(b){b!==F&&(a.lineWidth(b),F=b)},this.setPolygonOffset=function(b,c,d){b?this.enable(a.POLYGON_OFFSET_FILL):this.disable(a.POLYGON_OFFSET_FILL),!b||G===c&&H===d||(a.polygonOffset(c,d),G=c,H=d)},this.getScissorTest=function(){return I},this.setScissorTest=function(b){I=b,b?this.enable(a.SCISSOR_TEST):this.disable(a.SCISSOR_TEST)},this.activeTexture=function(b){void 0===b&&(b=a.TEXTURE0+J-1),K!==b&&(a.activeTexture(b),K=b)},this.bindTexture=function(b,c){void 0===K&&e.activeTexture();var d=L[K];void 0===d&&(d={type:void 0,texture:void 0},L[K]=d),d.type===b&&d.texture===c||(a.bindTexture(b,c),d.type=b,d.texture=c)},this.compressedTexImage2D=function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(a){console.error(a)}},this.texImage2D=function(){try{a.texImage2D.apply(a,arguments)}catch(a){console.error(a)}},this.clearColor=function(b,c,d,e){f.set(b,c,d,e),!1===M.equals(f)&&(a.clearColor(b,c,d,e),M.copy(f))},this.clearDepth=function(b){N!==b&&(a.clearDepth(b),N=b)},this.clearStencil=function(b){O!==b&&(a.clearStencil(b),O=b)},this.scissor=function(b){!1===P.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),P.copy(b))},this.viewport=function(b){!1===Q.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),Q.copy(b))},this.reset=function(){for(var b=0;b<i.length;b++)1===i[b]&&(a.disableVertexAttribArray(b),i[b]=0);k={},l=null,K=void 0,L={},m=null,w=null,v=null,x=null,E=null}}},{three:177}],87:[function(a,b,c){(function(c,d){"use strict";function e(a){this.urls=a;var b=c("bWVzc2FnZSBtZXNoZXMgew0KICAgIHJlcXVpcmVkIHN0cmluZyB2ZXJzaW9uID0gMTsNCiAgICByZXBlYXRlZCBibG9ja19kZWZhdWx0IGJsb2NrX2RlZmF1bHQgPSAyOw0KICAgIHJlcGVhdGVkIGJsb2NrX21vZGVsIGJsb2NrX21vZGVsID0gMzsNCiAgICByZXBlYXRlZCBibG9ja19jdXN0b21pemVkIGJsb2NrX2N1c3RvbWl6ZWQgPSA0Ow0KfQ0KDQptZXNzYWdlIHZlcnRpY2VzX3NpbXBsZSB7DQogICAgcmVwZWF0ZWQgZmxvYXQgdXYgPSAxIFtwYWNrZWQ9dHJ1ZV07DQogICAgcmVwZWF0ZWQgZmxvYXQgeHl6ID0gMiBbcGFja2VkPXRydWVdOw0KfQ0KDQptZXNzYWdlIGZhY2VzX3NpbXBsZSB7DQogICAgcmVwZWF0ZWQgdWludDMyIGZhY2VzID0gMSBbcGFja2VkPXRydWVdOw0KfQ0KDQptZXNzYWdlIGJsb2NrX21vZGVsIHsNCiAgICBvcHRpb25hbCB2ZXJ0aWNlc19zaW1wbGUgdmVydGljZXMgPSAxOw0KICAgIG9wdGlvbmFsIGZhY2VzX3NpbXBsZSBmYWNlcyA9IDI7DQogICAgb3B0aW9uYWwgc3RyaW5nIGJsb2NrX25hbWUgPSAzOw0KICAgIG9wdGlvbmFsIHN0cmluZyB0eHRuYW1lID0gNDsNCn0NCg0KbWVzc2FnZSBibG9ja19kZWZhdWx0IHsNCiAgICByZXBlYXRlZCBibG9ja19kZWZhdWx0X3VuaXQgZGVmYXVsdF91bml0cyA9IDE7DQp9DQoNCm1lc3NhZ2UgYmxvY2tfZGVmYXVsdF91bml0IHsNCiAgICByZXF1aXJlZCBzdHJpbmcgdW5pdF9pZCA9IDE7DQogICAgb3B0aW9uYWwgdmVydGljZXNfc2ltcGxlIHZlcnRpY2VzID0gMjsNCiAgICBvcHRpb25hbCBmYWNlc19zaW1wbGUgZmFjZXMgPSAzOw0KICAgIG9wdGlvbmFsIHN0cmluZyBibG9ja19kZXMgPSA0Ow0KICAgIG9wdGlvbmFsIHN0cmluZyB0eHRuYW1lID0gNTsNCn0NCg0KbWVzc2FnZSBibG9ja19jdXN0b21pemVkIHsNCiAgICByZXBlYXRlZCBibG9ja19jdXN0b21pemVkX3VuaXQgY3VzdG9taXplZF91bml0cyA9IDE7DQp9DQoNCm1lc3NhZ2UgYmxvY2tfY3VzdG9taXplZF91bml0IHsNCiAgICByZXF1aXJlZCBzdHJpbmcgdW5pdF9pZCA9IDE7DQogICAgcmVxdWlyZWQgc3RyaW5nIHJlbGF0ZWRfaWQgPSAyOw0KICAgIG9wdGlvbmFsIHZlcnRpY2VzX3NpbXBsZSB2ZXJ0aWNlcyA9IDM7DQogICAgb3B0aW9uYWwgZmFjZXNfc2ltcGxlIGZhY2VzID0gNDsNCiAgICBvcHRpb25hbCBzdHJpbmcgYmxvY2tfZGVzID0gNTsNCiAgICBvcHRpb25hbCBzdHJpbmcgdHh0bmFtZSA9IDY7DQp9DQo=","base64");this.decoder=g.loadProto(b).build("meshes")}var f=a("three"),g=a("protobufjs"),h=a("../util/logger"),i=(a("../util/common"),a("../util/ajax")),j=a("../objects/Chunk"),k=new h(d);e.prototype={constructor:e,load:function(a,b,c,d){return k.time("download"),i.get(a,{responseType:"arraybuffer"}).done(function(e){k.timeEnd("download"),this.parse(e,a,b,c,d)}.bind(this)).fail(d)},parse:function(a,b,c,d,e){var f=this.readProtobuf(a);if(!f)return e();try{k.time("convert to webgl"),this.convertProtobufToSceneObject(f,b,c,d,e),k.timeEnd("convert to webgl")}catch(a){return k.error("failed parsing .dam"),k.error(a.message),e()}},readProtobuf:function(a){var b;try{k.time("parse proto"),b=this.decoder.decode(a),k.timeEnd("parse proto")}catch(a){return k.error("failed parsing proto for .dam"),k.error(a.message),null}return b},convertProtobufToSceneObject:function(a,b,c,d,e){function g(a){var c=new f.BufferGeometry;return c.addAttribute("position",new f.BufferAttribute(new Float32Array(a.vertices.xyz,0,3),3)),a.vertices.uv.length>0&&c.addAttribute("uv",new f.BufferAttribute(new Float32Array(a.vertices.uv,0,2),2)),c.setIndex(new f.BufferAttribute(new Uint32Array(a.faces.faces,0,1),1)),c.applyMatrix(h),c.computeBoundingBox(),new j({geometry:c,textureName:a.txtname,name:a.block_name,meshUrl:b})}if(0===a.block_model.length)return k.warn("No chunks in damfile..."),c([]);var h=new f.Matrix4;h.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1);var i=a.block_model.map(g);return i?c(i):(k.error("no blocks..."),e())}},b.exports=e}).call(this,a("buffer").Buffer,"/js/loaders/DamLoader.js")},{"../objects/Chunk":108,"../util/ajax":141,"../util/common":145,"../util/logger":153,buffer:167,protobufjs:176,three:177}],88:[function(a,b,c){(function(c){"use strict";var d=(a("three"),a("../conf"),a("../util/browser"),a("./DamLoader")),e=a("../util/logger"),f=new e(c);b.exports={getLoaders:function(){return[["_50k",".dam",d],["",".dam",d]]},load:function(a,b,c,d,e){var g=this.getLoaders();e=e||0;var h=g[e];if(!h)return void(d&&d("No suitable model file found..."));var i=h[0],j=h[1],k=new h[2](a),l=G.url.model+"/model.nest";l?(f.debug("Trying "+i+j),k.load(l,b,c,function(){this.load(a,b,c,d,++e)}.bind(this))):(f.debug("Skipping "+j+", not available"),this.load(a,b,c,d,++e))}}}).call(this,"/js/loaders/ModelLoader.js")},{"../conf":7,"../util/browser":142,"../util/logger":153,"./DamLoader":87,three:177}],89:[function(a,b,c){(function(c){"use strict";var d=a("../util/common"),e=a("../util/texture"),f=a("../util/browser"),g=a("../util/logger"),h=a("../conf"),i=new g(c);b.exports={load:function(a){function b(a){a||(k++,j.notify(k,c),k===c&&j.resolve())}if(!a.chunks[0]||!a.chunks[0].meshUrl)return $.when();var c=d.countUnique(a.chunks.map(function(a){return a.textureName})),g=(a.chunks[0].meshUrl.indexOf("_50k"),"high");f.isMobile()&&"high"==g&&(f.detectSamsungS6()?(i.warn("Galaxy S6 cannot handle large textures, turning down quality."),g="low"):c>h.maxMobileTextures&&(i.warn("Model probably too large for mobile, turning down quality."),g="low"));var j=$.Deferred(),k=0,l=G.url.model+"/texture_"+g+"/";return a.chunks.forEach(function(a){if(!a.material.map&&a.textureName){var c=l+a.textureName;a.setTextureMap(e.load(c,b.bind(this,e.isLoaded(c))))}}),j.promise()}}}).call(this,"/js/loaders/ModelTextureLoader.js")},{"../conf":7,"../util/browser":142,
"../util/common":145,"../util/logger":153,"../util/texture":161}],90:[function(a,b,c){(function(c,d){"use strict";function e(a){this.model=a,this.modelDataPath=G.url.model+"/vision.modeldata"}var f=a("../conf"),g=(a("protobufjs"),a("../util/ajax")),h=(a("../util/common"),a("../util/math")),i=a("../util/logger"),j=a("three"),k=new i(d);e.prototype.load=function(){return this.modelDataPath?(k.info("Using vision.modeldata"),this.loadVisionModelData()):(k.warn("No sweep file found"),$.when([]))},e.prototype.loadVisionModelData=function(){var a=this;return g.get(this.modelDataPath,{responseType:"json",fetchNum:1,prefetchFrom:"locations"}).then(function(b){var c=b.points.map(function(a){var b=a.color;return b?(b.brightness||(b.brightness=0),b.contrast||(b.contrast=0),null!==b.gamma&&void 0!==b.gamma||(b.gamma=1),b.hue||(b.hue=0),b.saturation||(b.saturation=0),b.vibrance||(b.vibrance=0),b.balance||(b.balance=new j.Vector3(0,0,0))):b={brightness:0,contrast:0,gamma:1,hue:0,saturation:0,vibrance:0,balance:new j.Vector3(0,0,0)},{enable:a.enable,locationid:a.locationid,position:{x:a.viewpoint.x,y:a.viewpoint.y,z:a.viewpoint.z},quaternion:{x:a.rotation.x,y:a.rotation.y,z:a.rotation.z,w:a.rotation.w},puck:{x:a.spot.x,y:a.spot.y,z:a.spot.z},u:a.u,v:a.v,floor:a.flooridx,neighbours:a.vps,alignmentType:a.type,angle_enable:a.angle_enable,angle_x:a.angle_x,angle_y:a.angle_y,angle_z:a.angle_z,launch:a.launch,color:b}}).map(function(b){if(a.model.straight_enable){var c=new j.Euler;c.setFromQuaternion(b.quaternion,"ZYX",!1),c._x=0,c._y=0;var d=new j.Quaternion;d.setFromEuler(c,!1),b.quaternion.x=d.x,b.quaternion.y=d.y,b.quaternion.z=d.z,b.quaternion.w=d.w}return b.position=h.convertVisionVector(b.position),b.quaternion=h.convertVisionQuaternion(b.quaternion),b.puck=h.convertVisionVector(b.puck),b});return c.forEach(function(a){a.neighbours=a.neighbours.map(function(a){return c[a].locationid})}),f.isEditVersion||f.isNewEditVersion||(c=c.filter(function(a){return a.enable})),c}.bind(this))},b.exports=e}).call(this,a("buffer").Buffer,"/js/loaders/SweepDataLoader.js")},{"../conf":7,"../util/ajax":141,"../util/common":145,"../util/logger":153,"../util/math":154,buffer:167,protobufjs:176,three:177}],91:[function(a,b,c){(function(b){function c(a){return a.replace("modelcdn.3dnest.cn","modelcdn2.3dnest.cn").replace("infocdn.3dnest.cn","infocdn2.3dnest.cn").replace("template.3dnest.cn","template2.3dnest.cn")}function d(a){for(var b in a)"object"==typeof a[b]?d(a[b]):"string"==typeof a[b]&&(a[b]=c(a[b]))}function e(a){d(a)}function f(a){ja.info("Version","2.11.9-0-ga9537d5"),Z.defaultMaxListeners=1e3,h(a),i()}function g(){return document.getElementById("player")}function h(a){a.addEventListener("dragenter",B,!1),a.addEventListener("dragover",B,!1)}function i(){var a=O.valueFromHash("title");"0"!==a&&0!==a||$(document).ready(function(){$(".model-title").hide()})}function j(){return"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)}function k(){$(".message-outer").css("background-color","rgba(255,255,255,0)"),$("#gui-loading-splash").hide(),$("#firstLoading").hide()}function l(){return{panoElementsToLoad:6,modelElementsToLoad:0,totalElementsLoaded:0,totalElementsToLoad:0,totalPercentageLoaded:0,progressCallback:null}}function m(){function b(){$("#gui-loading").show(),$("#firstLoading").show()}function c(){$("#gui-loading").hide(),$("#firstLoading").hide()}var d=$.Deferred(),e=W.getModelIDFromQueryString(),f=new Date,g="/model/rtiframedata/";O.valueFromHash("h")&&(g="/manager_house"+g),G.cdn="https://modelcdn2.3dnest.cn",G.icdn="https://infocdn2.3dnest.cn",G.tcdn="https://template2.3dnest.cn",G.u={"beyond.3dnest.cn":{id:1,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"beyond.3dnest.biz":{id:42,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"3dnest.n.weimob.com":{id:18,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"beyond.3dnest.cc":{id:1,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"cloud.3dnest.cn":{id:40,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"cloudone.3dnest.cn":{id:41,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"cloud2.3dnest.cn":{id:42,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"cloud3.3dnest.cn":{id:43,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"cloud5.3dnest.cn":{id:44,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"yun.3dnest.cn":{id:45,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"vr.coart.cn":{id:46,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"vr.anyouyou365.com":{id:47,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"vr360.evdo.vip":{id:20,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"cloud5.3dnest.cn":{id:40,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"cloud6.3dnest.cn":{id:40,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"cloud7.3dnest.cn":{id:40,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"cloud8.3dnest.cn":{id:40,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"cloud9.3dnest.cn":{id:40,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"cloud10.3dnest.cn":{id:40,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"yun.3dnest.cn":{id:40,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"testweb.3dnest.cn":{id:3,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"vr360.evdo.vip":{id:3,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"space.3dnest.cn":{id:4,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"3dv.sdnews.com.cn":{id:22,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"vr.coart.cn":{id:22,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"vr.anyouyou365.com":{id:22,type:"display",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/"+e+"/",infopre:G.icdn+"/"+e+"/",setpre:G.icdn+"/"+e+"/"},"192.168.0.225":{id:11,type:"sms",versionpre:"https://modelcdn2.3dnest.cn/"+e+"/",modelpre:"https://modelcdn2.3dnest.cn/",infopre:"https://infocdn2.3dnest.cn/",setpre:"http://127.0.0.1:8000/model"+g+e+"/"},"user.3dnest.cn":{id:11,type:"sms",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/",infopre:G.icdn+"/",setpre:window.location.origin+g+e+"/"},"user.3dnest.biz":{id:19,type:"sms",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/",infopre:G.icdn+"/",setpre:window.location.origin+g+e+"/"},"test.3dnest.cn":{id:12,type:"sms",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/",infopre:G.icdn+"/",setpre:window.location.origin+g+e+"/"},"allfun.3dnest.cn":{id:13,type:"sms",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/",infopre:G.icdn+"/",setpre:window.location.origin+g+e+"/"},"third.3dnest.cn":{id:14,type:"sms",versionpre:G.cdn+"/"+e+"/",modelpre:G.cdn+"/",infopre:G.icdn+"/",setpre:window.location.origin+g+e+"/"}},G.u[window.location.host]||(G.u[window.location.host]={type:"local",id:31+f.getTime(),modelpre:"./play/data/",infopre:"./play/data/",setpre:"./play/data/"+e+"/"}),G.url=G.url||{},G.url.modelid=e,G.url.type=G.u[window.location.host].type;var h=G.u[window.location.host],i=G.u[window.location.host].infopre+"p.json",j="",k="zq_"+e,l="_slkxucv98324jasdf";if(G.toast=function(a){setTimeout(function(){document.getElementsByClassName("toast-wrap")[0].getElementsByClassName("toast-msg")[0].innerHTML=a;var b=document.getElementsByClassName("toast-wrap")[0];b.className=b.className.replace("toastAnimate",""),setTimeout(function(){b.className=b.className+" toastAnimate"},10)},10)},"display"===h.type){G.url.version=h.versionpre+"version.txt?f="+(new Date).getTime()/1e4;var m,n=a("./enum/LanguageType"),o=a("./gui/mLanguage");$("#passbtn").on("click",function(){D.get(i,{responseType:"json"}).done(function(a){if(hex_md5($("#passipt").val())===a.value){localStorage.setItem(k,a.value),localStorage.setItem(k+l,(new Date).getTime());var c={version:j};d.resolve(c),""==c.version&&d.reject("version-is-empty"),$(".p-container").hide(),$(".passui").hide(),b()}else G.toast(m.modelCode.passwordError)})}),D.get(G.url.version,{responseType:"json"}).done(function(a){if(location.host.indexOf(".biz")>-1&&(a.language=1),m=a.language===n.English?o.English:a.language===n.Japanese?o.Japanese:o.Chinese,a.auth){$(".p-notice").text(m.modelCode.passport),$("#passbtn").text(m.modelCode.wandering),$("#passipt").attr("placeholder",m.modelCode.placeholder),j=a.version;var e=localStorage.getItem(k),f=parseInt(localStorage.getItem(k+l));(new Date).getTime()-f>6048e5||!e?(c(),$(".p-container").show()):D.get(i,{responseType:"json"}).done(function(a){if(e===a.value){var c={version:j};d.resolve(c),""==c.version&&d.reject("version-is-empty"),$(".p-container").hide(),$(".passui").hide(),b()}else localStorage.removeItem(k),$(".passui").show(),b()})}else $(".passui").hide(),b(),d.resolve(a),""==a.version&&d.reject("version-is-empty")}).fail(function(){ja.debug("Retrieval of version failed."),d.reject("version-not-found")})}else $(".p-container").hide(),$(".passui").hide(),b();return"sms"===h.type?d.resolve():"demo"===h.type?d.resolve():"local"===h.type&&d.resolve(),d.promise()}function n(a){var b=$.Deferred(),c=G.u[window.location.host],d=new Date;return"display"===c.type?(G.url.model=c.modelpre+a.version,G.url.info=c.infopre+a.version,a.setting?G.url.settings=c.setpre+a.version+"/settings.txt?s="+a.setting+"&f="+c.id:G.url.settings=c.setpre+a.version+"/settings.txt?s="+d.getTime()):"sms"===c.type?G.url.settings=c.setpre+"settings":"local"===c.type?(G.url.model=c.modelpre+G.url.modelid,G.url.info=c.infopre+G.url.modelid,G.url.settings=c.setpre+"settings.txt?t="+d.getTime()+"&f="+c.id):"demo"===c.type&&(G.url.version=$.getUrlParam("version"),G.url.model=c.modelpre+G.url.version,G.url.info=c.modelpre+G.url.version,G.url.settings=c.setpre+"settings.txt"),D.get(G.url.settings,{responseType:"json"}).done(function(a){window.PREFETCHED_MODELDATA=a,b.resolve(a)}).fail(function(){ja.debug("Retrieval of settings failed."),b.reject("settings-not-found")}),b.promise()}function o(){var a;if("display"===G.url.type);else if("sms"===G.url.type){var b=G.settings.basic.locationpics.match(/([0-9\-]+)\/{{filename}}/);a=b&&b[1]?b[1]:"",a?(G.url.model=G.cdn+"/"+G.url.modelid+"/"+a,G.url.info=G.icdn+"/"+G.url.modelid+"/"+a):(ja.info("no version"),G.url.model=G.cdn+"/"+G.url.modelid,G.url.info=G.icdn+"/"+G.url.modelid)}else"local"===G.url.type||G.url.type}function p(a,b,c,d,e){return e.progressCallback=b,a.load(d).progress(q.bind(this,e))}function q(a,b){a.modelElementsToLoad=b[1],s(a),r(a)}function r(a){a.totalElementsLoaded++,a.totalPercentageLoaded=a.totalElementsLoaded/a.totalElementsToLoad,a.progressCallback&&a.progressCallback(100*a.totalPercentageLoaded)}function s(a){a.totalElementsToLoad=a.modelElementsToLoad+a.panoElementsToLoad}function t(a){var b=new F.PerspectiveCamera,c=new F.Scene,d=new F.AmbientLight(16777215);return window.camera=b,window.scene=c,window.THREE=F,c.add(d),c.skybox=new V,c.add(c.skybox),c.plane=new F.Mesh(new F.PlaneBufferGeometry(1e5,1e5),new F.RawShaderMaterial({side:F.DoubleSide})),c.plane.position.y=0,c.plane.rotateX(-Math.PI/2),c.plane.material.visible=!1,c.add(c.plane),c.updateMatrixWorld(),P.showScreenshotLocations&&a.data.images.forEach(function(a){if(a._camera&&a._camera._viewpoint){var b=a._camera._viewpoint,d=new F.Mesh(new F.BoxGeometry(.3,.3,.3));d.position.copy(b.clone()),c.add(d);var e=a._camera._viewpoint,f=new F.Vector3(0,0,-1).applyQuaternion(e);c.add(new F.ArrowHelper(f,b.clone(),1,16711680))}}),P.showAxis&&(c.add(new F.ArrowHelper(new F.Vector3(0,1,0),new F.Vector3(0,0,0),1,255)),c.add(new F.ArrowHelper(new F.Vector3(0,0,1),new F.Vector3(0,0,0),1,16711680)),c.add(new F.ArrowHelper(new F.Vector3(1,0,0),new F.Vector3(0,0,0),1,65280))),new aa(c,b,U)}function u(a,b){var c=a?1:1e3,d=new ca,e=new ea({concurrentDownloads:O.valueFromHash("tileconc",2)}),f=new fa,g=new J,h=new I,i=new H(b),j=new K(c);return{qualityManager:d,panoRenderer:f,tileDownloader:e,player:i,director:h,modelManager:g,mattertagManager:new da,displayController:j}}function v(a,b,c){var d=c.qualityManager,e=c.panoRenderer,f=c.tileDownloader,g=c.modelManager;d.init(g),f.init(d),e.init(b,f,d),g.init(f,e,d),g.addModel(a),b.addComponent(T)}function w(a,b,c,d){var e=c.qualityManager,f=c.panoRenderer,g=c.tileDownloader,h=c.modelManager,i=c.player,j=c.director,k=c.mattertagManager,l=c.displayController;b.scene.add(a),b.qualityManager=e,a.update();var m={camera:b.camera,director:j,modelManager:h,tileDownloader:g,panoRenderer:f,qualityManager:e,mattertagManager:k,container:d};b.scene.location_enable=a.location_enable,b.scene.location_url=a.location_url||null,i.init(m),i.setScene(b.scene),j.init(i,h),k.init(h,i,j),l.init(j,i,h,k,d),U.bindEvents(i),b.addComponent(k),b.addComponent(a),b.addComponent(i),b.addComponent(f),i.mattertagManager.updateModel()}function x(a,b,c,d){return ja.info("Starting player in "+c.mode),a.start(c)}function y(a,b){ja.error(b),R.error(b)}function z(a){var b=O.details();b&&"Safari"===b.name&&b.version>500&&b.version<600?R.error("webgl-safari"):R.error("webgl-generic")}function A(a,b,c){try{a.start(b)}catch(a){throw ja.warn(a.message),z(c.modelid),a}}function B(a){a.stopPropagation(),a.preventDefault()}window.G={},a("./lib/getParam"),a("./lib/three75-shim"),a("./lib/array-polyfill"),a("./lib/shaders/CopyShader.js"),a("./lib/shaders/HorizontalBlurShader.js"),a("./lib/shaders/VerticalBlurShader.js"),a("./lib/postprocessing/EffectComposer.js"),a("./lib/postprocessing/RenderPass.js"),a("./lib/postprocessing/MaskPass.js"),a("./lib/postprocessing/ShaderPass.js");var C=a("./util/cookie"),D=a("./util/ajax.js"),E=a("./weixin/weixinshare"),F=a("three"),H=a("./player"),I=a("./director"),J=a("./model/ModelManager"),K=a("./DisplayController"),L=a("./enum/Viewmode"),M=a("./util/logger"),N=a("./showcase"),O=a("./util/browser"),P=a("./conf"),Q=a("./gui/gui"),R=a("./gui/error"),S=a("./analytics"),T=a("./util/transitions"),U=a("./effects"),V=a("./objects/Skybox"),W=(a("./util/common"),a("./util/PanoramaCollection"),a("./util/math"),a("./util/showcase")),X=a("./util/camera"),Y=(a("./objects/Panorama"),a("./cameras/PanoramaCamera"),a("./preloaders")),Z=a("events").EventEmitter;a("./util/lerp"),a("./util/ajax");var _=a("./automation.js"),aa=a("./scene/SceneRenderer"),ba=a("./scene/QuickstartManager"),ca=a("./tile/QualityManager.js"),da=a("./mattertag/MattertagManager"),ea=a("./tile/TileDownloader"),fa=a("./tile/PanoRenderer"),ga=(a("./enum/PanoSizeClass"),a("./enum/PanoramaEvents"),a("./enum/SceneRendererEvents")),ha=(a("./util/texture"),a("./enum/StartupType")),ia=a("./util/statistic_utils"),ja=new M(b);M.level=P.logLevel,M.consoleEnabled=P.console,"1"==P.showLog&&function(a,b,c){var d={content:"",dom:null,cssUrl:"//g.alicdn.com/mtb/ctrl-mjlogger/1.0.5/index-min.css"};d._update=function(){this.contentDom.innerText=this.content,this.contentDom.scrollTop=this.contentDom.scrollHeight-this.contentDom.clientHeight},d.log=function(){var a=[].reduce.call(arguments,function(a,b){return a+" "+b});this.content+="> "+a+"\n\n",this._update()},d._clear=function(){this.content="",this._update()},d._hide=function(){d.contentDom.style.display="none",d.hideBtn.style.display="none",d.showBtn.style.display="block"},d._show=function(){d.contentDom.style.display="block",d.hideBtn.style.display="block",d.showBtn.style.display="none"},d.init=function(){var c=this;b.documentElement.getAttribute("data-dpr")||b.documentElement.setAttribute("data-dpr",2);var d=b.createElement("div");d.className="J_mjlogger mj-logger",d.innerHTML='<div class="J_loggerContent logger-content"></div><div class="J_loggerHide logger-hide">hide</div><div class="J_loggerShow logger-show">show</div>',d.addEventListener("touchmove",function(a){a.stopPropagation()},!1),c.contentDom=d.querySelector(".J_loggerContent"),b.addEventListener("DOMContentLoaded",function(){b.body.appendChild(d),c.hideBtn=b.querySelector(".J_loggerHide"),c.showBtn=b.querySelector(".J_loggerShow"),c.hideBtn.onclick=c._hide,c.showBtn.onclick=c._show});var e=a.console.log,f=a.console.error;a.console.log=function(){e&&e.apply(a.console,arguments),c.log.apply(c,arguments)},a.console.error=function(){f&&f.apply(a.console,arguments),c.log.apply(c,arguments)},a.onerror=function(a,b,d){c.log("error:"+a+"\n> error: "+b+"\n> error: "+d)}},c.mjLogger=d,d.init()}(window,window.document,window.ctrl||(window.ctrl={})),G.ori={},O.isMobile()?G.ori.flag=!0:G.ori.flag=!1,G.ori.isHuawei5X=O.detectHUAWEI5X(),G.ori.gamma=-1e3,G.ori.beta=-1e3,G.ori.alpha=-1e3,G.ori.enable=!0,G.orientationHandler=function(a){a.gamma||a.beta||(a.gamma=a.x*(180/Math.PI),a.beta=a.y*(180/Math.PI),a.alpha=a.z*(180/Math.PI));var b=a.gamma,c=a.beta,d=a.alpha;a.accelerationIncludingGravity&&(b=10*event.accelerationIncludingGravity.x,c=10*-event.accelerationIncludingGravity.y,d=10*event.accelerationIncludingGravity.z),G.ori.gamma=b,G.ori.beta=c,G.ori.alpha=d},G.HorientationChange=function(){G.ori.orient=F.Math.degToRad(window.orientation||0)},G.HdeviceOrientation=function(a){var b=F.Math.degToRad(a.alpha),c=F.Math.degToRad(a.beta),d=F.Math.degToRad(a.gamma);G.ori.isHuawei5X?(-1e3==G.ori.alpha&&(G.ori.alpha=b),-1e3==G.ori.beta&&(G.ori.beta=c),-1e3==G.ori.gamma&&(G.ori.gamma=d),Math.abs(b-G.ori.alpha)>.06&&(G.ori.alpha=b),Math.abs(c-G.ori.beta)>.006&&(G.ori.beta=c),Math.abs(d-G.ori.gamma)>.006&&(G.ori.gamma=d)):(G.ori.alpha=b,G.ori.beta=c,G.ori.gamma=d)},window.addEventListener("orientationchange",G.HorientationChange),window.addEventListener("deviceorientation",G.HdeviceOrientation),function(){var a="";"beyond.3dnest.cn"===window.location.host||"beyond.3dnest.cc"===window.location.host||"3dnest.n.weimob.com"===window.location.host||"cloud.3dnest.cn"===window.location.host||"cloudone.3dnest.cn"===window.location.host||"beyond.3dnest.biz"===window.location.host||"vr360.evdo.vip"===window.location.host||"cloud2.3dnest.cn"===window.location.host||"cloud3.3dnest.cn"===window.location.host||"cloud5.3dnest.cn"===window.location.host||"cloud5.3dnest.cn"===window.location.host||"yun.3dnest.cn"===window.location.host||"3dv.sdnews.com.cn"===window.location.host||"vr.coart.cn"===window.location.host||"vr.anyouyou365.com"===window.location.host?a="https://hm.baidu.com/hm.js?96df2c98736a2bf4259ad25af5776fbf":"oldbeyond.3dnest.cn"===window.location.host?a="https://hm.baidu.com/hm.js?68d0322f8c7ffed05a973a7462059d9a":"space.3dnest.cn"===window.location.host&&(a="https://hm.baidu.com/hm.js?8fedd025fb3a09638ea38634359c9683"),$.ajax({url:a,dataType:"script",cache:!0}).done(function(){var a=_hmt||[];G._hmt=a})}(),function(){var a=W.getModelIDFromQueryString();if(!a)return y(null,"loading-failed");var b=W.parseModelid(a),c=l(),d=g(),h=P.quickstart.enabled,i=null,q=null,r=null,s=null,z=null,B=null,D=null,H=null,I=null,J=null,K=null,M=null,R=C.getId();f(d);var T=O.getAllValueFromSearch(),U=T.iframe_type_editor;!function(a){"edit"===a?(P.isNewEditVersion=!0,P.isCleanUI=!0):P.isTestVersion=!1}(U);var V="https://user.3dnest.cn/show/update_statistics";P.isTestVersion&&(V="https://allfun.3dnest.cn/show/update_statistics"),$.post(V,{nest_id:a,cookie_id:R,nest_url:location.pathname}).done(function(a){console.log(a)}).fail(function(a){console.log(a)}),m().then(n).then(function(c){if(c.basic.menu.oauth&&j()&&!C.getOauth("isOauth"))return window.location.replace("https://user.3dnest.cn/wx/oauth/?gospace="+a),!1;var d,f;if(G.settings=c||{},e(G.settings),o(),c.building&&(d=c.building.blocks)){f=d.length;for(var g=0;g<f;g++)d[g].blockidx=parseInt(d[g].blockidx),d[g].flooridx=parseInt(d[g].flooridx),d[g].roomidx=parseInt(d[g].roomidx)}else c.building.blocks={};if(c.basic.facebook&&c.basic.facebook.enable){!function(){var a="725001574522277";location.href.indexOf("3dnest.cn")>=0&&(a="1842865549077140"),window.fbAsyncInit=function(){FB.init({appId:a,status:!0,xfbml:!0,version:"v2.12"}),FB.AppEvents.logPageView()},function(b,c,d){var e,f=b.getElementsByTagName(c)[0];b.getElementById(d)||(e=b.createElement(c),e.id=d,e.src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.12&appId="+a+"&autoLogAppEvents=1",f.parentNode.insertBefore(e,f))}(document,"script","facebook-jssdk")}();var h="biz/";location.href.indexOf("3dnest.cn")>=0&&(h="cn/"),$("#facebook").show(),$("#facebook").on("click",function(){var b=window.location.host,c=window.location.search;FB.ui({method:"share",href:b+"/fb_html/"+h+a+".html"+c},function(a){})})}E(),ia.setCustomVar(a),ia.updatePageDuration(a),setInterval(function(a){ia.updatePageDuration(a)},5e3),ia.trackEvent(9);var i=N.initS({url:a,floors:O.valueFromHash("f",!0),autoload:!1},b,c),l=S.getMixpanelToken({urlBase:b.urlBase});return O.isMobile()&&G.settings.nestscenes.backgroundmobileimgurl&&-1===G.settings.nestscenes.backgroundmobileimgurl.indexOf("background.")?k():!O.isMobile()&&G.settings.nestscenes.backgroundimgurl&&-1===G.settings.nestscenes.backgroundimgurl.indexOf("background.")&&k(),$.when(i,l).then(null,function(a){return"loading-failed-mixpanel"===a?i:this})}).then(function(a,b){I=a}).then(function(){return I.loadPanos()}).then(function(){q=X.getStartCameraOptions(I,I.panos,new F.Vector3(0,0,0),!0),B=t(I),J=u(h,q.mode),r=J.player,s=J.director,z=J.mattertagManager,D=J.tileDownloader,H=J.qualityManager,K=J.panoRenderer,v(I,B,J),I.supportsTiles&&D.start(),h&&q.mode!==L.PANORAMA&&(ja.warn("Tried to quickstart, but failed as we are not starting in inside mode."),h=!1),q.mode,L.PANORAMA;var a=null;return h&&(ja.warn("Quickstart engaged. Hold on to your knickers."),q.pano.id&&ia.trackEvent(11,q.pano.id),i=new ba(H,B.scene,B.camera,d),A(B,d,I),a=i.load(q).then(function(){B.addComponent(i),P.autoplay&&(M=i.startLanding()),B.once(ga.AfterRender,function(){ja.warn("First render after quickstart load finished.")})})),$.when(a,Q.startLoading(I,!0,h))}).then(function(){return p(I,Q.onProgress,"fullpage",!h,c)}).then(function(){function a(){w(I,B,J,d),_.init(s,r),B.started||A(B,d,I),x(r,I,q,!0).done(function(){I.loading_enable||s.autoTour()}),I.supportsTiles||new Y(I,r).start(),h&&(r.control.copy(i.controls),B.removeComponent(i),i.destroy()),Q.init(I,s,r,q),Q.endLoading(I,s,z,B),B.once(ga.AfterRender,function(){ja.warn("First render after model load finished.")})}q=X.getStartCameraOptions(I,I.panos,r.position),I.data.player_options.show3d?I.startup_type===ha.STARTPANO?q.quickstart=!0:q.quickstart=h:q.quickstart=!0,h?M.done(a):a()}).fail(y.bind(this,a))}()}).call(this,"/js/main.js")},{"./DisplayController":1,"./analytics":2,"./automation.js":3,"./cameras/PanoramaCamera":6,"./conf":7,"./director":14,"./effects":15,"./enum/LanguageType":26,"./enum/PanoSizeClass":33,"./enum/PanoramaEvents":34,"./enum/SceneRendererEvents":40,"./enum/StartupType":41,"./enum/Viewmode":51,"./gui/error":63,"./gui/gui":64,"./gui/mLanguage":69,"./lib/array-polyfill":75,"./lib/getParam":77,"./lib/postprocessing/EffectComposer.js":78,"./lib/postprocessing/MaskPass.js":79,"./lib/postprocessing/RenderPass.js":80,"./lib/postprocessing/ShaderPass.js":81,"./lib/shaders/CopyShader.js":82,"./lib/shaders/HorizontalBlurShader.js":83,"./lib/shaders/VerticalBlurShader.js":84,"./lib/three75-shim":86,"./mattertag/MattertagManager":98,"./model/ModelManager":103,"./objects/Panorama":113,"./objects/Skybox":117,"./player":121,"./preloaders":123,"./scene/QuickstartManager":124,"./scene/SceneRenderer":125,"./showcase":127,"./tile/PanoRenderer":128,"./tile/QualityManager.js":129,"./tile/TileDownloader":130,"./util/PanoramaCollection":138,"./util/ajax":141,"./util/ajax.js":141,"./util/browser":142,"./util/camera":143,"./util/common":145,"./util/cookie":146,"./util/lerp":152,"./util/logger":153,"./util/math":154,"./util/showcase":156,"./util/statistic_utils":158,"./util/texture":161,"./util/transitions":162,"./weixin/weixinshare":163,events:170,three:177}],92:[function(a,b,c){function d(){this.enable=!1,this.state="small",this.opened=!0,this.img={},this.portrait={},this.portrait.points=[],this.landscape={},this.landscape.points=[],this.smallmap={},this.smallmap.points=[],this.map={},this.points=[],this.type=1,this.man={w:20,angle:90,locationid:""},G.InnerMap=this}var e=a("events").EventEmitter,f=a("../util/browser"),g=a("../enum/Viewmode"),h=a("../enum/PlayerEvents"),i=a("../util/img");d.prototype=Object.create(e.prototype),d.prototype.getori=function(){return window.innerWidth<window.innerHeight?"portrait":"landscape"},d.prototype.init=function(a,b){var c,d,e,g,i,j,k,l,m,n=this,o=G.settings.basic.menu,p=window.innerWidth,q=window.innerHeight;(this.enable=o.innermap_enable)&&(this.model=a,this.player=b,this.type=o.innermap_type,this.inited=!0,this.img.url=o.innermap_imgurl,this.setImg(this.img.url),f.isMobile()?(this.r=this.portrait.r=this.landscape.r=.25,this.map.w=150,this.map.h=100,this.model.panos.forEach(function(a){p>q&&(m=p,p=q,q=m),isNaN(a.u)||isNaN(a.v)||(n.portrait.w1=c=p,n.portrait.w2=d=p-p*n.r,n.portrait.h1=e=q*n.r,n.portrait.h2=g=q-2*e,k=n.img.w/n.img.h,l=c/g,k>=l?(i=a.u*c,j=.5*(g-c/k)+c/k*a.v):(i=.5*(c-g*k)+g*k*a.u,j=a.v*g),n.portrait.points.push({locationid:a.id,offsetX:i,offsetY:j}),n.smallmap.points.push({locationid:a.id,offsetX:n.map.w*a.u,offsetY:n.map.h*a.v}),m=p,p=q,q=m,n.landscape.w1=c=p*n.r,n.landscape.w2=d=p-2*c,n.landscape.h1=e=q,n.landscape.h2=g=q-q*n.r,k=n.img.w/n.img.h,l=d/e,k>=l?(i=a.u*d,j=.5*(e-d/k)+d/k*a.v):(i=.5*(d-e*k)+e*k*a.u,j=a.v*g),n.landscape.points.push({locationid:a.id,offsetX:i,offsetY:j}))})):(this.r=.2,this.map.w=300,this.map.h=200),this.model.panos.forEach(function(a){a.on("enter",function(){this.moveman(a.id)}.bind(this))}.bind(this)),$("#bigmap").click(function(a){var b=n.getPano(a.offsetX,a.offsetY);n.player.flyToPano({pano:b,lookAtPoint:null,duration:null,maxDistanceOverride:null,skipWarpingCheck:!1})}),$("#cover").click(function(a){n.enterSmallMapUpdateUI(),n.enterSmallMap()}),$("#smcover").click(function(a){"none"==$("#image-floor-container").css("display")&&(n.enterBigMapUpdateUI(),n.enterBigMap())}),this.player.on(h.FlyingEnded,this.stretch.bind(this)),this.resize())},d.prototype.toggleMap=function(){this.opened?(this.opened=!1,this.hideAll()):(this.opened=!0,this.stretch())},d.prototype.moveman=function(a){if("small"===this.state||"big"===this.state){var b=this.getPosById(a);"big"===this.state?($("#map-man").css("left",-10+b.offsetX+$("#bigmap").offset().left+"px"),$("#map-man").css("top",-10+b.offsetY+$("#bigmap").offset().top+"px")):"small"===this.state&&($("#sm-man").css("left",-5+b.offsetX+$("#smallmap").offset().left+"px"),$("#sm-man").css("top",-5+b.offsetY+"px"))}},d.prototype.getPosById=function(a){return"big"===this.state?this[this.getori()].points.filter(function(b){if(b.locationid===a)return!0})[0]:"small"===this.state?this.smallmap.points.filter(function(b){if(b.locationid===a)return!0})[0]:void 0},d.prototype.getPano=function(a,b){if(!isNaN(a)&&!isNaN(b)){var c,d=window.innerWidth*window.innerWidth+window.innerHeight*window.innerHeight,e=0;this.points.forEach(function(f){d>(e=(f.offsetX-a)*(f.offsetX-a)+(f.offsetY-b)*(f.offsetY-b))&&(d=e,c=f.locationid)});return this.model.panos.filter(function(a){return a.id===c})[0]}},d.prototype.checkstate=function(){this.player.mode===g.DOLLHOUSE||this.player.mode===g.FLOORPLAN?this.state="hide":$("canvas").width()===window.innerWidth?this.state="small":this.state="big"},d.prototype.resize=function(){this.enable&&this.inited&&this.player.currentPano&&(this.stretch(),this.moveman(this.player.currentPano.id))},d.prototype.setImg=function(a){var b=i.getSize(a);this.img.url=a,this.img.w=b.width,this.img.h=b.height,$("#mapimg").css("background-image","url("+this.img.url+")"),$("#smimg").css("background-image","url("+this.img.url+")")},d.prototype.stretch=function(a){this.checkstate(),"hide"===this.state?this.hideAll():"big"===this.state?this.enterBigMap():this.enterSmallMap()},d.prototype.hideAll=function(){$("#map_container").hide(),$("#cover").hide(),$("#map-man").hide(),$("#sm_container").hide(),$("#smcover").hide(),$("#sm-man").hide(),this.stretchIndoor(!1)},d.prototype.stretchIndoor=function(a){a?($("canvas").css("position","fixed"),$("canvas").css("bottom","0px"),$("canvas").css("right","0px"),$("canvas").css("left",""),$("canvas").css("top",""),$("canvas").css("width",window.innerWidth*this.r),$("canvas").css("height",window.innerHeight*this.r),$("#player").css("position","absolute"),$("#player").css("bottom","0px"),$("#player").css("right","0px"),$("#player").css("width",window.innerWidth*this.r),$("#player").css("height",window.innerHeight*this.r),$("#player").css("left",""),$("#player").css("top","")):($("canvas").css("position","absolute"),$("canvas").css("left","0px"),$("canvas").css("top","0px"),$("canvas").css("bottom",""),$("canvas").css("right",""),$("canvas").css("width",window.innerWidth),$("canvas").css("height",window.innerHeight),$("#player").css("position","absolute"),$("#player").css("left","0px"),$("#player").css("top","0px"),$("#player").css("bottom",""),$("#player").css("right",""),$("#player").css("width",window.innerWidth),$("#player").css("height",window.innerHeight))},d.prototype.enterBigMap=function(){this.state="big",$("#sm_container").hide(),$("#smcover").hide(),$("#sm-man").hide();var a,b,c,d,e=(this.img.w,this.img.h,window.innerWidth),f=window.innerHeight;e/f<1?(a=e,b=e-e*this.r,c=f/4,d=f-2*c,$("#maptop").css("position","absolute"),$("#maptop").css("left","0px"),$("#maptop").css("top","0px"),$("#maptop").css("width",a+"px"),$("#maptop").css("height",c+"px"),$("#bigmap").css("position","absolute"),$("#bigmap").css("left","0px"),$("#bigmap").css("top",c+"px"),$("#bigmap").css("width",a+"px"),$("#bigmap").css("height",d+"px"),a,d,$("#mapbottom").css("position","absolute"),$("#mapbottom").css("left","0px"),$("#mapbottom").css("top",c+d+"px"),$("#mapbottom").css("width",b+"px"),$("#mapbottom").css("height",c+"px"),$("#cover").css("position","absolute"),$("#cover").css("left",b+"px"),$("#cover").css("top",c+d+"px"),$("#cover").css("width",e-b+"px"),$("#cover").css("height",c+"px"),this.points=this.portrait.points):(a=e*this.r,b=e-2*a,c=f,d=f-f*this.r,$("#maptop").css("position","absolute"),$("#maptop").css("left","0px"),$("#maptop").css("top","0px"),$("#maptop").css("width",a+"px"),$("#maptop").css("height",c+"px"),$("#bigmap").css("position","absolute"),$("#bigmap").css("left",a+"px"),$("#bigmap").css("top","0px"),$("#bigmap").css("width",b+"px"),$("#bigmap").css("height",c+"px"),b,c,$("#mapbottom").css("position","absolute"),$("#mapbottom").css("left",a+b+"px"),$("#mapbottom").css("top","0px"),$("#mapbottom").css("width",a+"px"),$("#mapbottom").css("height",d+"px"),$("#cover").css("position","absolute"),
$("#cover").css("left",a+b+"px"),$("#cover").css("top",d+"px"),$("#cover").css("width",a+"px"),$("#cover").css("height",f-d+"px"),this.points=this.landscape.points),this.stretchIndoor(!0),$("#map_container").show(),$("#cover").show(),$("#map-man").show(),this.moveman(this.player.currentPano.id)},d.prototype.enterSmallMap=function(){this.state="small",$("#map_container").hide(),$("#cover").hide(),$("#map-man").hide(),$("#sm_container").css("width",this.map.w),$("#sm_container").css("height",this.map.h),$("#smcover").css("width",this.map.w),$("#smcover").css("height",this.map.h),this.stretchIndoor(!1),$("#sm_container").show(),$("#smcover").show(),$("#sm-man").show(),this.moveman(this.player.currentPano.id)},d.prototype.enterBigMapUpdateUI=function(){"block"==$("#image-floor-container").css("display")&&($("#image-floor-container").hide(1e3),$("#gui-modes-floor").css("background-image","url(images/icon_wawj_pm2.png)")),$("#tag-detail-container").hide(),G.model.normalMovie&&$("#drawer-container").hide(),$(".pinBottom.left").hide()},d.prototype.enterSmallMapUpdateUI=function(){$("#tag-detail-container").show(),G.model.normalMovie&&$("#drawer-container").show(),$(".pinBottom.left").show()},b.exports=d},{"../enum/PlayerEvents":38,"../enum/Viewmode":51,"../util/browser":142,"../util/img":151,events:170}],93:[function(a,b,c){function d(){}var e=a("events").EventEmitter,f=(a("../util/browser"),a("../enum/Viewmode"),a("../enum/PlayerEvents"),a("../gui/buryPoint")),g=a("../enum/OuterMapType"),h=a("../util/statistic_utils");d.prototype=Object.create(e.prototype),d.prototype.init=function(a){var b=a.outermap_enable,c=a.outermap_url,d=a.outermap_type,e=this,i=!0,j=!1;if(b){if(c){var k=c;$("#outermap-on").css("display","block")}d===g.GAODE?$("#outermap-on").click(function(){var a=f[window.location.hostname];if(a&&G._hmt&&(G._hmt.push(["_trackEvent",a[8].desc,f.trigger,f.modelid]),G._hmt.push(["'"+f.type.custom+"'","'"+a[8].id+"'","'"+f.modelid+"'"]),h.trackEvent(8)),i){if(j)return!1;$.ajax({url:"https://webapi.amap.com/maps?v=1.3&key=906d34b0ef02b53a2635143df3401767",dataType:"script",success:function(){new AMap.Map("amap-container",{})&&(e.openMap(k),i=!1)},error:function(){j=!1}}),j=!0}else e.openMap(k)}):d===g.GOOGLE&&$("#outermap-on").click(function(){k=k.replace('"600"','"'+Math.ceil(.8*window.innerWidth)+'"'),k=k.replace('"450"','"'+Math.ceil(.4*window.innerHeight)+'"'),$("#amap-container").css("display","block"),$("#amap-container").css("postion","fixed"),$("#amap-container").css("top",Math.ceil(.2*window.innerHeight)+"px"),$("#amap-container").css("left",Math.ceil(.1*window.innerWidth)+"px"),$("#mapdiv").html(k),$("#amap-container").css("display","block"),$(".help_back").css("display","block"),$(".amap-close").css("display","block")}),$(".amap-close, .help_back").click(function(){$("#amap-container").css("display","none"),$(".help_back").css("display","none"),$(".amap-close").css("display","none")})}},d.prototype.openMap=function(a){$("#amap-container").css("display","block"),$(".help_back").css("display","block"),$(".amap-close").css("display","block");var b=new AMap.Map("amap-container",{resizeEnable:!0,zoom:15,center:[116.381643,39.980434]});AMap.plugin("AMap.Geocoder",function(){var c=new AMap.Geocoder({city:""}),d=new AMap.Marker({map:b,bubble:!0});c.getLocation(a,function(a,c){"complete"==a&&c.geocodes.length?(d.setPosition(c.geocodes[0].location),b.setCenter(d.getPosition())):$("#amap-container").innerHTML="获取位置失败"})})},b.exports=d},{"../enum/OuterMapType":31,"../enum/PlayerEvents":38,"../enum/Viewmode":51,"../gui/buryPoint":59,"../util/browser":142,"../util/statistic_utils":158,events:170}],94:[function(a,b,c){"use strict";function d(a){a=a||{},e.RawShaderMaterial.call(this,g.extendObject({fragmentShader:f.cube.fragmentShader,vertexShader:f.cube.vertexShader,uniforms:e.UniformsUtils.clone(f.cube.uniforms),name:"CubemapMaterial"},a))}var e=a("three"),f=a("../shaders"),g=a("../util/common");d.prototype=Object.create(e.RawShaderMaterial.prototype),d.prototype.constructor=d,b.exports=d},{"../shaders":126,"../util/common":145,three:177}],95:[function(a,b,c){"use strict";function d(a){a=a||{},G.model.enablefilter?e.RawShaderMaterial.call(this,g.extendObject({fragmentShader:f.model2.fragmentShader,vertexShader:f.model2.vertexShader,uniforms:e.UniformsUtils.clone(f.model2.uniforms),name:"ModelTextureMaterial"},a)):e.RawShaderMaterial.call(this,g.extendObject({fragmentShader:f.model.fragmentShader,vertexShader:f.model.vertexShader,uniforms:e.UniformsUtils.clone(f.model.uniforms),name:"ModelTextureMaterial"},a))}var e=a("three"),f=a("../shaders"),g=a("../util/common");d.prototype=Object.create(e.RawShaderMaterial.prototype),d.prototype.constructor=d,d.prototype.setProjectedPanos=function(a,b,c){if(G.model.enablefilter){var d=a.getAjustedColors(),e=b.getAjustedColors();c&&(this.uniforms.progress.value=0),a.ensureSkyboxReadyForRender(),this.uniforms.pano0Map.value=a.getSkyboxTexture(),this.uniforms.brightness0.value=d.brightness,this.uniforms.contrast0.value=d.contrast,this.uniforms.gamma0.value=d.gamma,this.uniforms.hue0.value=d.hue,this.uniforms.saturation0.value=d.saturation,this.uniforms.vibrance0.value=d.vibrance,this.uniforms.balance0.value.copy(d.balance),this.uniforms.pano0Position.value.copy(a.position),this.uniforms.pano0Matrix.value.copy(a.skyboxMesh.matrixWorld),b.ensureSkyboxReadyForRender(),this.uniforms.pano1Map.value=b.getSkyboxTexture(),this.uniforms.brightness1.value=e.brightness,this.uniforms.contrast1.value=e.contrast,this.uniforms.gamma1.value=e.gamma,this.uniforms.hue1.value=e.hue,this.uniforms.saturation1.value=e.saturation,this.uniforms.vibrance1.value=e.vibrance,this.uniforms.balance1.value.copy(e.balance),this.uniforms.pano1Position.value.copy(b.position),this.uniforms.pano1Matrix.value.copy(b.skyboxMesh.matrixWorld)}else c&&(this.uniforms.progress.value=0),a.ensureSkyboxReadyForRender(),this.uniforms.pano0Map.value=a.getSkyboxTexture(),this.uniforms.pano0Position.value.copy(a.position),this.uniforms.pano0Matrix.value.copy(a.skyboxMesh.matrixWorld),b.ensureSkyboxReadyForRender(),this.uniforms.pano1Map.value=b.getSkyboxTexture(),this.uniforms.pano1Position.value.copy(b.position),this.uniforms.pano1Matrix.value.copy(b.skyboxMesh.matrixWorld)},b.exports=d},{"../shaders":126,"../util/common":145,three:177}],96:[function(a,b,c){function d(){}var e=a("events").EventEmitter,f=(a("../enum/PlayerEvents"),a("../gui/gui")),g=a("../model/Chunks");d.prototype=Object.create(e.prototype),d.prototype.init=function(a,b,c){this.model=a,this.player=b,this.director=c},d.prototype.add_orientation=function(a,b,c,d,e){function f(a){for(var b=document.cookie.split("; "),c=0;c<b.length;c++){var d=b[c].split("=");if(d[0]===a)return d[1]}return""}var g=f("tagList_nestid"),h=f("tagList_relCode");$("#inp_location_id_o").val(a),$("#inp_qw_o").val(b),$("#inp_qx_o").val(c),$("#inp_qy_o").val(d),$("#inp_qz_o").val(e),$("#inp_rel_code_o").val(h),$("#inp_nest_id_o").val(g),$("#add_orientation").show(),$("#editversion-capture").hide(),$("#cancel_add_o").click(function(){$("#add_orientation").hide()}),$("#add_orientation").on("keydown",function(){event.stopPropagation()}),$("#sub_add_o").unbind("click"),$("#sub_add_o").on("click",function(a){return""===$("#inp_nest_id_o").val().trim()?void alert("项目ID不能为空"):""===$("#inp_rel_code_o").val().trim()?void alert("版本号不能为空"):""===$("#inp_title_o").val().trim()?void alert("定位点名称不能为空"):""===$("#inp_key_o").val().trim()?void alert("定位点对接值不能为空"):($.ajax({url:"/nest/orientations/",type:"POST",data:{qw:$("#inp_qw_o").val(),qx:$("#inp_qx_o").val(),qy:$("#inp_qy_o").val(),qz:$("#inp_qz_o").val(),nest_id:$("#inp_nest_id_o").val(),rel_code:$("#inp_rel_code_o").val(),title:$("#inp_title_o").val(),orientation_key:$("#inp_key_o").val(),location_id:$("#inp_location_id_o").val(),imgnum:1}}).success(function(a){alert("添加定位点成功")}).fail(function(a){alert("提交失败")}),$("#inp_title_o").val(""),void $("#add_orientation").css({display:"none"}))})},d.prototype.add_scene=function(a,b,c,d,e){function g(a){for(var b=document.cookie.split("; "),c=0;c<b.length;c++){var d=b[c].split("=");if(d[0]===a)return d[1]}return""}var h=g("tagList_nestid"),i=g("tagList_relCode"),j=this;$("#inp_location_id_scene").val(a),$("#inp_qw").val(b),$("#inp_qx").val(c),$("#inp_qy").val(d),$("#inp_qz").val(e),$("#inp_rel_code").val(i),$("#inp_nest_id_scene").val(h);var k="https://modelcdn2.3dnest.cn/"+h+"/"+i+"/locations/pc/low/"+a;$(".img-responsive").each(function(a,b){$(b).attr("src",k+"_"+(a+1)+".jpg")}),$("#add_scene").show(),$("#editversion-capture").hide(),$("#cancel_add_scene").click(function(){$("#add_scene").hide()}),$("#add_scene").on("keydown",function(){event.stopPropagation()}),$("#sub_add_scene").unbind("click"),$("#sub_add_scene").on("click",function(a){return""===$("#inp_nest_id_scene").val().trim()?void alert("项目ID不能为空"):""===$("#inp_rel_code").val().trim()?void alert("版本号不能为空"):""===$("#inp_title_scene").val().trim()?void alert("标签名称不能为空"):($.ajax({url:"/nest/highlights/",type:"POST",data:{qw:$("#inp_qw").val(),qx:$("#inp_qx").val(),qy:$("#inp_qy").val(),qz:$("#inp_qz").val(),nest_id:$("#inp_nest_id_scene").val(),rel_code:$("#inp_rel_code").val(),title:$("#inp_title_scene").val(),location_id:$("#inp_location_id_scene").val(),imgnum:$("input").filter("[name=imgnum]:checked").val()}}).success(function(a){alert("添加场景成功"),f.addHighlight(j.model,j.director,j.player,a.data)}).fail(function(a){alert("提交失败")}),$("#inp_title_scene").val(""),void $("#add_scene").css({display:"none"}))})},d.prototype.add_tag=function(a,b,c,d,e,f,h,i,j,k,l,m,n,o){if(0==event.isTrusted)return!1;var p=window.parent.getPD();null!=p&&("EW"==p.customN?($("#ew_lable").css("display","inline"),$("#custom_id").css("display","block")):"ikea"==p.customN&&$("#ikea_lable").css("display","inline")),$(".check_tag").off("click"),$(".check_tag").on("click",function(a){$(this).find("input:checked").length>0&&("2"===$(this).find("input:checked").val()?$("#tip").show():$("#tip").hide())}),$("#add_tag").on("keydown",function(a){a.stopPropagation()});var q=this,r=!1;if("flex"==$("#tag_to_360").css("display")&&(r=!0),$("#tag_to_360").empty(),this.model.scenes360.length>0){$("#tag_360_type").removeClass("display-none"),$("#tag_to_360").append("<label>选择欲跳转到室外全景</label>");for(var s in this.model.scenes360){var t=this.model.scenes360[s].sceneid,u=this.model.scenes360[s].shortcuturl,v="";0==s&&(v="checked"),$("#tag_to_360").append('<div class="col-md-2"  style="margin-top: 7px;"><input type="radio" name="scennum" value='+t+" "+v+' class="make-switch switch-radio1"><label>全景'+s+'</label><img class="img-responsive" src='+u+' alt=""></div>')}}$("input[type='radio'][name='type']").change(function(){1==this.value?($("#cle_val").removeClass("display-none"),$("#tag_bg_style").css("display","block"),$("#tag_detail").removeClass("display-none-t"),$("#sub_value").removeClass("display-block-t"),$("#tag_url").removeClass("display-none-t"),$("#tag_image").removeClass("display-none-t"),$("#tag_music").removeClass("display-none-t"),r&&($("#tag_to_360").css("display","flex"),$("#tag_bg_style").css("display","none"))):2==this.value&&($("#cle_val").addClass("display-none"),$("#tag_bg_style").css("display","none"),$("#tag_detail").addClass("display-none-t"),$("#sub_value").addClass("display-block-t"),$("#tag_url").addClass("display-none-t"),$("#tag_image").addClass("display-none-t"),$("#tag_music").addClass("display-none-t"),$("#tag_to_360").css("display","none"))}),$("input[type='radio'][name='tagnum']").change(function(){6==this.value?$("#tagtitle").removeClass("display-none"):$("#tagtitle").addClass("display-none"),7==this.value?$("#tagpic").removeClass("display-none"):$("#tagpic").addClass("display-none")}),$("input[type='radio'][name='template_type']").change(function(){r=!1,$("#tag_bg_style").css("display","block"),1==this.value?($("#sub_value").removeClass("display-none"),$("#tag_url").addClass("display-none"),$("#tag_image").addClass("display-none"),$("#tag_music").addClass("display-none"),$("#tag_detail").removeClass("display-none"),$("#tag_to_360").css("display","none"),$("#product_info").hide()):2==this.value?($("#sub_value").removeClass("display-none"),$("#tag_url").removeClass("display-none"),$("#tag_image").removeClass("display-none"),$("#tag_music").removeClass("display-none"),$("#tag_detail").removeClass("display-none"),$("#tag_to_360").css("display","none"),$("#product_info").hide()):4==this.value?($("#sub_value").addClass("display-none"),$("#tag_url").addClass("display-none"),$("#tag_image").addClass("display-none"),$("#tag_music").removeClass("display-none"),$("#tag_detail").addClass("display-none"),$("#tag_to_360").css("display","none"),$("#product_info").hide()):5==this.value?($("#sub_value").removeClass("display-none"),$("#tag_url").removeClass("display-none"),$("#tag_image").addClass("display-none"),$("#tag_music").addClass("display-none"),$("#tag_detail").addClass("display-none"),$("#tag_to_360").css("display","none"),$("#product_info").hide()):10==this.value?(r=!0,$("#tag_bg_style").css("display","none"),$("#sub_value").removeClass("display-none"),$("#tag_to_360").css("display","flex"),$("#tag_url").addClass("display-none"),$("#tag_image").addClass("display-none"),$("#tag_music").addClass("display-none"),$("#tag_detail").addClass("display-none"),$("#product_info").hide()):101==this.value?($("#sub_value").addClass("display-none"),$("#tag_url").addClass("display-none"),$("#tag_image").addClass("display-none"),$("#tag_music").addClass("display-none"),$("#tag_detail").addClass("display-none"),$("#tag_to_360").css("display","none"),$("#product_info").hide()):102==this.value&&($("#sub_value").removeClass("display-none"),$("#tag_url").removeClass("display-none"),$("#tag_image").removeClass("display-none"),$("#tag_music").removeClass("display-none"),$("#tag_detail").removeClass("display-none"),$("#tag_to_360").css("display","none"),$("#product_info").show())}),$("#add_tag").css("display","block"),$("#editversion-capture").css("display","none"),$("#submit_form").unbind("click"),$("#submit_form").on("click",function(a){window.Model;if(0==event.isTrusted)return!1;var b=new FormData($("#formd")[0]),c=parseInt($("input[name=type]:checked").val()),d=parseInt($("input[name=template_type]:checked").val()),e=($("#upimg").val(),$("#upmic").val(),$("#inp_title").val());if(void 0!=e&&""==e.trim()&&(2==c||5==d||8==d))return alert("标签名称不能为空"),!1;$.ajax({type:"POST",url:"/nest/tag/",async:!1,dataType:"json",data:b,cache:!1,contentType:!1,processData:!1,success:function(a){alert("添加标签成功"),console.log(a),q.model.buildTagsForAddTag(a.data),q.player.mattertagManager.updateModel()},fail:function(){alert("提交失败")}}),$("#inp_title").val(""),$("#inp_url").val(""),$("#upimg").val(""),$("#upimg2").val(""),$("#upimg3").val(""),$("#upmic").val(""),$("#tex_des").val(""),$(":radio[name=tagnum][value=1]").attr("checked","true"),$("#add_tag").css({display:"none"})}),$("#inp_nest_id").val(G.settings.basic.model.modelid),$("#inp_nest_floor").val(g.getflooridx()),$("#inp_base_x").val(b),$("#inp_base_y").val(c),$("#inp_base_z").val(d),$("#inp_normal_x").val(e),$("#inp_normal_y").val(f),$("#inp_normal_z").val(h),$("#inp_dx").val(i),$("#inp_dy").val(j),$("#inp_dz").val(k),$("#inp_tag_qw").val(l),$("#inp_tag_qx").val(m),$("#inp_tag_qy").val(n),$("#inp_tag_qz").val(o),$("#inp_location_id").val(a),$("#cancel_add_tag").on("click",function(){$("#add_tag").css({display:"none"}),$("#inp_title").val(""),$("#inp_url").val(""),$("#upimg").val(""),$("#upimg2").val(""),$("#upimg3").val(""),$("#tex_des").val("")})},d.prototype.add_angle=function(a){function b(a){for(var b=document.cookie.split("; "),c=0;c<b.length;c++){var d=b[c].split("=");if(d[0]===a)return d[1]}return""}var c=b("tagList_nestid"),d=b("tagList_relCode");$.ajax({url:"/nest/angleadjust/",type:"POST",data:{location_id:a,angle_adjust_x:$("#x_adjust_value").text(),angle_adjust_y:$("#y_adjust_value").text(),angle_adjust_z:$("#z_adjust_value").text(),nest_id:c,rel_code:d}}).success(function(a){alert("调整全景角度成功")}).fail(function(a){alert("提交失败")})},d.prototype.add_compass=function(){function a(a){for(var b=document.cookie.split("; "),c=0;c<b.length;c++){var d=b[c].split("=");if(d[0]===a)return d[1]}return""}var b=a("tagList_nestid"),c=a("tagList_relCode");$.ajax({url:"/nest/compassadjust/",type:"POST",data:{compassangle:G.model.adjustCompass,nest_id:b,rel_code:c}}).success(function(a){alert("调整指南针角度成功")}).fail(function(a){alert("提交失败")})},d.prototype.add_colors=function(){function a(a){for(var b=document.cookie.split("; "),c=0;c<b.length;c++){var d=b[c].split("=");if(d[0]===a)return d[1]}return""}for(var b=a("tagList_nestid"),c=a("tagList_relCode"),d=[],e=0;e<G.model.panos.list.length;e++)d.push({locationid:G.model.panos.list[e].id,brightness:G.model.panos.list[e].color.brightness,contrast:G.model.panos.list[e].color.contrast,gamma:G.model.panos.list[e].color.gamma,hue:G.model.panos.list[e].color.hue,saturation:G.model.panos.list[e].color.saturation,vibrance:G.model.panos.list[e].color.vibrance,balance:G.model.panos.list[e].color.balance});$.ajax({url:"/nest/coloradjust/",type:"POST",data:{colors:JSON.stringify(d),nest_id:b,rel_code:c},dataType:"json"}).success(function(a){alert("调整全景颜色成功")}).fail(function(a){alert("提交失败")})},d.prototype.add_360_tag=function(a,b,c,d){function e(a){setTimeout(function(){window.document.getElementsByClassName("toast-wrap")[0].getElementsByClassName("toast-msg")[0].innerHTML=a;var b=window.document.getElementsByClassName("toast-wrap")[0];b.className=b.className.replace("toastAnimate",""),setTimeout(function(){b.className=b.className+" toastAnimate"},10)},10)}if(0==event.isTrusted)return!1;$("#add_360_tag").on("keydown",function(a){a.stopPropagation()});var f=this;$("#add_360_tag").css("display","block"),$("#editversion-capture").css("display","none"),$("#submit_form_360").unbind("click"),$("#submit_form_360").on("click",function(a){if(0==event.isTrusted)return!1;var b=$("#inp_title_360").val();if(""==b)return e("输入不能为空"),!1;if(b.length>5)return e("输入字数不能超过5位"),!1;var c=new FormData($("#formd_360")[0]);$.ajax({type:"POST",url:"/nest/tag/",async:!1,dataType:"json",data:c,cache:!1,contentType:!1,processData:!1,success:function(a){alert("添加360标签成功"),console.log(a);var b=f.model.build360TagsForAddTag(a.data);f.player.mattertagManager.show360TagPanoId=b,f.player.mattertagManager.updateModel()},fail:function(){alert("提交失败")}}),$("#inp_title_360").val(""),$("#add_360_tag").css({display:"none"})}),$("#inp_360_nest_id").val(G.settings.basic.model.modelid),$("#inp_360_base_x").val(b),$("#inp_360_base_y").val(c),$("#inp_360_base_z").val(d),$("#inp_pano_id").val(a),$("#cancel_add_tag_360").on("click",function(){$("#add_360_tag").css({display:"none"}),$("#inp_title_360").val("")})},b.exports=d},{"../enum/PlayerEvents":38,"../gui/gui":64,"../model/Chunks":99,events:170}],97:[function(a,b,c){(function(c){"use strict";function d(a,b,c,d,e){this.tilesHorizontal=b,this.tilesVertical=c,this.numberOfTiles=d,a.wrapS=a.wrapT=h.RepeatWrapping,a.repeat.set(1/this.tilesHorizontal,1/this.tilesVertical),this.tileDisplayDuration=e,this.currentLoopTime=this.currentTile=this.currentDisplayTime=0,this.inStop=!1,this.totalcount=0,this.update=function(b){for(this.inStop?800<++this.totalcount&&(this.totalcount=0,this.inStop=!1):this.currentDisplayTime+=b;this.currentDisplayTime>this.tileDisplayDuration;)this.currentDisplayTime-=this.tileDisplayDuration,this.currentTile++,a.offset.x=this.currentTile%this.tilesHorizontal/this.tilesHorizontal,a.offset.y=Math.floor(this.currentTile/this.tilesHorizontal)/this.tilesVertical}}function e(a,b,c){var e=c.version||"0";if("0"!==e&&w.info("nesttags version: "+e),this.data=c,this.model=a,this.player=G.player,this.locationId=c.locationid,this.i=b,this.tagid=c.tagid,this.enabled=k.mattertags.enabled&&c.enable,this.label=c.details.title?c.details.title:"",this.subtype=c.details.subtype,this.tagInfoUrl=c.details.url,this.audioenable=c.details.audioenable,c.details.templatetype===u.Audio&&(this.audioenable=!0),this.audiourl=c.details.audiourl||c.details.url,this.videourl=c.details.videourl,this.tagPicUrl=c.details.tagpicurl,this.tagPicType=c.details.tagpictype,this.tagSupplement=c.label_config,this.fontColor=this.tagSupplement?this.tagSupplement.fontColor:null,this.background=this.tagSupplement?this.tagSupplement.background:null,this.parsedDescription=[],this.links=[],this.floor=null,this.floorIndex=c.flooridx||0,this.isBuilt=!1,this.des=this.data.details.description,this.media_scale=parseFloat((this.data.details.media_scale||1)+""),this.pano_video_url=this.data.details.pano_video_url||"",this.isplaying=!1,this.media_size=parseFloat(this.data.details.media_size||"1.0"),G.player&&G.player.currentPano&&2===G.player.currentPano.alignmentType?this.rt360=!0:this.rt360=!1,2e4===b&&(c.details.templatetype=u.Tag360T1),c.details.templatetype===u.ImageText&&c.details.audioenable&&c.details.audiourl&&(c.details.templatetype=u.ImageTextAudio),c.details.templatetype===u.TextOnly&&c.details.audioenable&&c.details.audiourl&&(c.details.templatetype=u.TextAudio),c.actiontype==u.ClassifyType.Building?(this.type=u.BuildingType,this.mediatype=v.Normal):(this.type=c.details.templatetype,c.details.templatetype===u.BuildingType||c.details.templatetype===u.TextOnly||c.details.templatetype===u.ImageText||c.details.templatetype===u.OtherModel?this.mediatype=v.Normal:c.details.templatetype===u.Audio||c.details.templatetype===u.TextAudio||c.details.templatetype===u.ImageTextAudio?(this.mediadiv=(c.details.templatetype,u.ImageTextAudio,window.document.getElementById("audio-tag")),this.mediatype=v.Audio):c.details.templatetype===u.Video?(this.mediadiv=window.document.getElementById("video-tag"),this.mediatype=v.Video):c.details.templatetype===u.IFrame?this.mediatype=v.IFrame:this.mediatype=v.Normal),c.details.audioenable&&c.details.audiourl&&(c.details.templatetype=u.TextAudio),this.imgaudioControl={loop:""},this.picDescription=null,this.audioControl={loop:""},this.audioPauseTime=0,this.highlightStatus=!1,this.mode=l.PANORAMA,c.preferred_camera&&c.preferred_camera.mode&&(this.mode=c.preferred_camera.mode),this.obj3d=this.disc=this.billboard=null,this.geometry={},this.geometry.disc=new h.PlaneBufferGeometry(2.5,2.5),this.geometry.discGif=new h.PlaneBufferGeometry(2,2),this.geometry.discBuilding=new h.PlaneBufferGeometry(2,2),this.geometry.discTo360Tag=new h.PlaneBufferGeometry(2.5,2.5),this.geometry.discFrom360Tag=new h.PlaneBufferGeometry(2.5,1.5),this.geometry.discOtherModel=new h.PlaneBufferGeometry(2.5,2.5),this.geometry.discOtherModelText=new h.PlaneBufferGeometry(2,5,2.5),this.geometry.cutout=new h.SphereBufferGeometry(.5,16,8),this.geometry.panoVideoTag=new h.PlaneBufferGeometry(this.media_size,1),this.type===u.BuildingType&&this.label){var f=G.settings.locations.points;if(f&&f.forEach(function(a,b){if(c.locationid===a.locationid)return c.base.y=a.viewpoint.z,!1}),this.label.length>6){var g=this.label.length,i=.22*g+.3;this.geometry.discBuilding=new h.PlaneBufferGeometry(i,.5)}else{var g=this.label.length,i=.35*g+.3;this.geometry.discBuilding=new h.PlaneBufferGeometry(i,.5)}}if(this.type===u.Audio){this.materialsAudio={};var j=A.splitUrl("https://template2.3dnest.cn/common/image/audioon_128x128.png"),m=A.splitUrl("https://template2.3dnest.cn/common/image/audiooff_128x128.png");if(this.tagPicType!=y.Pic&&this.tagPicType!=y.GIF||null==this.tagPicUrl||""==this.tagPicUrl||(j=this.tagPicUrl,m=this.tagPicUrl.replace(".png","_hover.png")),this.tagPicType===y.Text)this.materialsAudio.free=this.buildDiscMaterial(this.getText(this.tagPicUrl,1,this.fontColor,this.background)),this.materialsAudio.hover=this.buildDiscMaterial(this.getText(this.tagPicUrl,1,this.fontColor,this.background));else if(this.tagPicType===y.GIF){var o=this.getTexture(j);this.materialsAudio.free=this.buildDiscMaterial(o),this.materialsAudio.hover=this.buildDiscMaterial(o),this.clock=new h.Clock,this.gifObject=new d(o,1,25,25,30)}else this.materialsAudio.free=this.buildDiscMaterial(this.getTexture(j)),this.materialsAudio.hover=this.buildDiscMaterial(this.getTexture(m));this.materialsAudio.disable=this.materialsAudio.free.clone(),this.materialsAudio.disable.opacity=k.mattertags.disc.disabledOpacity,this.materialsAudio.cutout=new h.MeshBasicMaterial({transparent:!0,opacity:1,colorWrite:!1}),this.materialsAudio.pole=new h.LineBasicMaterial({linewidth:k.mattertags.pole.width,color:k.mattertags.pole.color,opacity:k.mattertags.startup.hideUntilStart?0:k.mattertags.pole.opacity,transparent:!0,alphaTest:k.mattertags.pole.opacity*k.mattertags.visibility.alphaTestLevel}),this.materialsAudio={free:this.materialsAudio.free.clone(),hover:this.materialsAudio.hover.clone(),disable:this.materialsAudio.disable.clone(),pole:this.materialsAudio.pole.clone(),cutout:this.materialsAudio.cutout.clone()},this.audioControl.loop=c.details.loop,this.tagInfoUrl=c.details.url,this.materials=this.materialsAudio}else if(this.type===u.PanoVideo){this.materialsPanoVideoTag={};var p=document.getElementById(this.tagid);p?p.setAttribute("src",this.pano_video_url):(p=document.createElement("VIDEO"),p.setAttribute("id",this.tagid),p.setAttribute("src",this.pano_video_url),document.getElementById("panoVideoDIV").appendChild(p)),p.setAttribute("crossorigin","Anonymous"),p.setAttribute("preload","auto"),p.setAttribute("webkit-playsinline","true"),p.setAttribute("playsinline","playsinline"),p.setAttribute("x5-video-player-type","h5"),p.setAttribute("x5-video-player-fullscreen","true"),p.setAttribute("x5-video-orientation","portraint"),p.setAttribute("style","mix-blend-mode: screen;position: absolute;object-fit:contain;top: 0;display:none;"),p.muted=!0,p.load();var q=new h.VideoTexture(p);q.side=h.DoubleSide,q.minFilter=h.LinearFilter,q.magFilter=h.LinearFilter,q.format=h.RGBFormat,q.generateMipmaps=!1,q.needsUpdate=!0;var r=new h.TextureLoader;r.setCrossOrigin("Anonymous");var s=r.load(this.tagPicUrl);s.image=new Image,s.image.src=this.tagPicUrl,s.image.crossOrigin="Anonymous",this.materialsPanoVideoTag.videofree=this.buildDiscMaterial(q,38),this.materialsPanoVideoTag.free=this.buildDiscMaterial(s,39),this.materialsPanoVideoTag.hover=this.buildDiscMaterial(s,39),this.materialsPanoVideoTag.disable=this.materialsPanoVideoTag.free.clone(),this.materialsPanoVideoTag.disable.opacity=k.mattertags.disc.disabledOpacity,this.materialsPanoVideoTag.cutout=new h.MeshBasicMaterial({transparent:!0,opacity:1,colorWrite:!0}),this.materialsPanoVideoTag.pole=new h.LineBasicMaterial({linewidth:k.mattertags.pole.width,color:k.mattertags.pole.color,opacity:1,transparent:!0,alphaTest:!1}),this.materialsPanoVideoTag={free:this.materialsPanoVideoTag.free.clone(),videofree:this.materialsPanoVideoTag.videofree,hover:this.materialsPanoVideoTag.hover.clone(),disable:this.materialsPanoVideoTag.disable.clone(),pole:this.materialsPanoVideoTag.pole.clone(),cutout:this.materialsPanoVideoTag.cutout.clone()},this.materials=this.materialsPanoVideoTag,this.materials.free.map.needsUpdate=!0}else if(this.type===u.OtherModel||this.type===u.TagTo360||this.type===u.Tag360T1||this.type===u.TextOnly){this.materialsOtherModel={};var j=A.splitUrl("https://template2.3dnest.cn/common/image/goto_256x256.png"),m=A.splitUrl("https://template2.3dnest.cn/common/image/goto_256x256.png");if(this.tagPicType!==y.Pic&&this.tagPicType!==y.GIF||null===this.tagPicUrl||""===this.tagPicUrl||(j=m=this.tagPicUrl),this.type===u.Title)this.geometry.disc=new h.PlaneBufferGeometry(12,3),this.materialsOtherModel.free=this.materialsOtherModel.hover=this.buildDiscMaterial();else if(this.tagPicType===y.Text)this.materialsOtherModel.free=this.buildDiscMaterial(this.getText(this.tagPicUrl,1,this.fontColor,this.background)),this.materialsOtherModel.hover=this.buildDiscMaterial(this.getText(this.tagPicUrl,1,this.fontColor,this.background));else if(this.tagPicType===y.GIF){var o=this.getTexture(j);this.materialsOtherModel.free=this.buildDiscMaterial(o),this.materialsOtherModel.hover=this.buildDiscMaterial(o),this.clock=new h.Clock,this.gifObject=new d(o,1,25,25,30)}else this.materialsOtherModel.free=this.buildDiscMaterial(this.getTexture(j)),this.materialsOtherModel.hover=this.buildDiscMaterial(this.getTexture(m));this.materialsOtherModel.disable=this.materialsOtherModel.free.clone(),this.materialsOtherModel.disable.opacity=k.mattertags.disc.disabledOpacity,this.materialsOtherModel.cutout=new h.MeshBasicMaterial({transparent:!0,opacity:1,colorWrite:!1}),this.materialsOtherModel.pole=new h.LineBasicMaterial({linewidth:k.mattertags.pole.width,color:k.mattertags.pole.color,opacity:k.mattertags.startup.hideUntilStart?0:k.mattertags.pole.opacity,transparent:!0,alphaTest:k.mattertags.pole.opacity*k.mattertags.visibility.alphaTestLevel}),this.materialsOtherModel={free:this.materialsOtherModel.free.clone(),hover:this.materialsOtherModel.hover.clone(),disable:this.materialsOtherModel.disable.clone(),pole:this.materialsOtherModel.pole.clone(),cutout:this.materialsOtherModel.cutout.clone()},this.tagInfoUrl=c.details.url,this.materials=this.materialsOtherModel,this.materials.free.map.needsUpdate=!0}else if(this.type===u.Title)$(".viewport-tags").append('<a id="titletag'+this.i+'" href="javascript:;" class="viewport-tag js-tag visible" style="z-index:20;"><div class="viewport-tag-point"></div><div class="viewport-tag-label"><span class="viewport-tag-label-name">'+c.details.title+"</span></div></a>");else if(this.type===u.ImageText||this.type===u.ImageTextAudio||this.type===u.IKEA||this.type===u.Video){this.materialsNotAudio={};var j=A.splitUrl("https://template2.3dnest.cn/common/image/tagnormal_128x128.png"),m=A.splitUrl("https://template2.3dnest.cn/common/image/taghover_128x128.png");if(this.tagPicType!==y.Pic&&this.tagPicType!==y.GIF||null===this.tagPicUrl||""===this.tagPicUrl||(j=m=this.tagPicUrl),this.tagPicType===y.Text)this.materialsNotAudio.free=this.buildDiscMaterial(this.getText(this.tagPicUrl,1,this.fontColor,this.background)),this.materialsNotAudio.hover=this.buildDiscMaterial(this.getText(this.tagPicUrl,1,this.fontColor,this.background));else if(this.tagPicType===y.GIF){var o=this.getTexture(j);this.materialsNotAudio.free=this.buildDiscMaterial(o),this.materialsNotAudio.hover=this.buildDiscMaterial(o),this.clock=new h.Clock,this.gifObject=new d(o,1,25,25,30)}else this.materialsNotAudio.free=this.buildDiscMaterial(this.getTexture(j)),this.materialsNotAudio.hover=this.buildDiscMaterial(this.getTexture(m));this.materialsNotAudio.disable=this.materialsNotAudio.free.clone(),this.materialsNotAudio.disable.opacity=k.mattertags.disc.disabledOpacity,this.materialsNotAudio.cutout=new h.MeshBasicMaterial({transparent:!0,opacity:1,colorWrite:!1}),this.materialsNotAudio.pole=new h.LineBasicMaterial({linewidth:k.mattertags.pole.width,color:k.mattertags.pole.color,opacity:k.mattertags.startup.hideUntilStart?0:k.mattertags.pole.opacity,transparent:!0,alphaTest:k.mattertags.pole.opacity*k.mattertags.visibility.alphaTestLevel}),this.materialsNotAudio={free:this.materialsNotAudio.free.clone(),hover:this.materialsNotAudio.hover.clone(),disable:this.materialsNotAudio.disable.clone(),pole:this.materialsNotAudio.pole.clone(),cutout:this.materialsNotAudio.cutout.clone()},this.imgaudioControl=c.details.audioloop?c.details.audioloop:{loop:""},this.materials=this.materialsNotAudio}else if(this.type===u.Tag360T1){if(I={free:n.loadCanvas(this.label),hover:n.loadCanvas(this.label)},this.materials360Type={},2===this.subtype){this.tagPicType=3;var j=A.splitUrl("https://template2.3dnest.cn/common/image/gif8_128x3200.png"),o=this.getTexture(j);this.materials360Type.free=this.buildDiscMaterial(o),this.materials360Type.hover=this.buildDiscMaterial(o),this.clock=new h.Clock,this.gifObject=new d(o,1,25,25,30)}else this.materials360Type.free=this.buildDiscMaterial(this.getText(this.label,1,this.fontColor,this.background)),this.materials360Type.hover=this.buildDiscMaterial(this.getText(this.label,1,this.fontColor,this.background))
;this.materials360Type.disable=this.materials360Type.free.clone(),this.materials360Type.disable.opacity=k.mattertags.disc.disabledOpacity,this.materials360Type.cutout=new h.MeshBasicMaterial({transparent:!0,opacity:1,colorWrite:!1}),this.materials360Type.pole=new h.LineBasicMaterial({linewidth:k.mattertags.pole.width,color:k.mattertags.pole.color,opacity:k.mattertags.startup.hideUntilStart?0:k.mattertags.pole.opacity,transparent:!0,alphaTest:k.mattertags.pole.opacity*k.mattertags.visibility.alphaTestLevel}),this.materials360Type={free:this.materials360Type.free.clone(),hover:this.materials360Type.hover.clone(),disable:this.materials360Type.disable.clone(),pole:this.materials360Type.pole.clone(),cutout:this.materials360Type.cutout.clone()},this.materials=this.materials360Type}else if(this.type===u.BuildingType)I={free:n.loadCanvas(this.label),hover:n.loadCanvas(this.label)},this.materialsBuilding={},this.materialsBuilding.free=this.buildDiscMaterial(this.getText(this.label)),this.materialsBuilding.hover=this.buildDiscMaterial(this.getText(this.label)),this.materialsBuilding.disable=this.materialsBuilding.free.clone(),this.materialsBuilding.disable.opacity=k.mattertags.disc.disabledOpacity,this.materialsBuilding.cutout=new h.MeshBasicMaterial({transparent:!0,opacity:1,colorWrite:!1}),this.materialsBuilding.pole=new h.LineBasicMaterial({linewidth:k.mattertags.pole.width,color:k.mattertags.pole.color,opacity:k.mattertags.startup.hideUntilStart?0:k.mattertags.pole.opacity,transparent:!0,alphaTest:k.mattertags.pole.opacity*k.mattertags.visibility.alphaTestLevel}),this.materialsBuilding={free:this.materialsBuilding.free.clone(),hover:this.materialsBuilding.hover.clone(),disable:this.materialsBuilding.disable.clone(),pole:this.materialsBuilding.pole.clone(),cutout:this.materialsBuilding.cutout.clone()},this.materials=this.materialsBuilding;else if(this.type===u.TagTo360){if(I={free:n.loadCanvas(this.label),hover:n.loadCanvas(this.label)},this.materialsTo360={},2===this.subtype){this.tagPicType=3;var j=A.splitUrl("https://template2.3dnest.cn/common/image/gif8_128x3200.png"),o=this.getTexture(j);this.materialsTo360.free=this.buildDiscMaterial(o),this.materialsTo360.hover=this.buildDiscMaterial(o),this.clock=new h.Clock,this.gifObject=new d(o,1,25,25,30)}else this.materialsTo360.free=this.buildDiscMaterial(this.getText(this.label,1,this.fontColor,this.background)),this.materialsTo360.hover=this.buildDiscMaterial(this.getText(this.label,1,this.fontColor,this.background));this.materialsTo360.disable=this.materialsTo360.free.clone(),this.materialsTo360.disable.opacity=k.mattertags.disc.disabledOpacity,this.materialsTo360.cutout=new h.MeshBasicMaterial({transparent:!0,opacity:1,colorWrite:!1}),this.materialsTo360.pole=new h.LineBasicMaterial({linewidth:k.mattertags.pole.width,color:k.mattertags.pole.color,opacity:k.mattertags.startup.hideUntilStart?0:k.mattertags.pole.opacity,transparent:!0,alphaTest:k.mattertags.pole.opacity*k.mattertags.visibility.alphaTestLevel}),this.materialsTo360={free:this.materialsTo360.free.clone(),hover:this.materialsTo360.hover.clone(),disable:this.materialsTo360.disable.clone(),pole:this.materialsTo360.pole.clone(),cutout:this.materialsTo360.cutout.clone()},this.tagInfoUrl=c.details.url,this.materials=this.materialsTo360}else if(this.type===u.Pano){this.materialsNotAudio={};var j,m;if(a.panos.index[this.locationId].enable?(j=A.splitUrl("https://template2.3dnest.cn/common/image/disable_on_256x256.png"),m=A.splitUrl("https://template2.3dnest.cn/common/image/disable_on_256x256.png")):(j=A.splitUrl("https://template2.3dnest.cn/common/image/disable_off_256x256.png"),m=A.splitUrl("https://template2.3dnest.cn/common/image/disable_off_256x256.png")),this.tagPicType!==y.Pic&&this.tagPicType!==y.GIF||null===this.tagPicUrl||""===this.tagPicUrl||void 0===this.tagPicUrl||(j=m=this.tagPicUrl),this.tagPicType===y.Text)this.materialsNotAudio.free=this.buildDiscMaterial(this.getText(this.tagPicUrl,1,this.fontColor,this.background)),this.materialsNotAudio.hover=this.buildDiscMaterial(this.getText(this.tagPicUrl,1,this.fontColor,this.background));else if(this.tagPicType===y.GIF){var o=this.getTexture(j);this.materialsNotAudio.free=this.buildDiscMaterial(o),this.materialsNotAudio.hover=this.buildDiscMaterial(o),this.clock=new h.Clock,this.gifObject=new d(o,1,25,25,30)}else this.materialsNotAudio.free=this.buildDiscMaterial(this.getTexture(j)),this.materialsNotAudio.hover=this.buildDiscMaterial(this.getTexture(m));this.materialsNotAudio.disable=this.materialsNotAudio.free.clone(),this.materialsNotAudio.disable.opacity=k.mattertags.disc.disabledOpacity,this.materialsNotAudio.cutout=new h.MeshBasicMaterial({transparent:!0,opacity:1,colorWrite:!1}),this.materialsNotAudio.pole=new h.LineBasicMaterial({linewidth:k.mattertags.pole.width,color:k.mattertags.pole.color,opacity:k.mattertags.startup.hideUntilStart?0:k.mattertags.pole.opacity,transparent:!0,alphaTest:k.mattertags.pole.opacity*k.mattertags.visibility.alphaTestLevel}),this.materialsNotAudio={free:this.materialsNotAudio.free.clone(),hover:this.materialsNotAudio.hover.clone(),disable:this.materialsNotAudio.disable.clone(),pole:this.materialsNotAudio.pole.clone(),cutout:this.materialsNotAudio.cutout.clone()},this.materials=this.materialsNotAudio}else{this.materialsNotAudio={};var j=A.splitUrl("https://template2.3dnest.cn/common/image/tagnormal_128x128.png"),m=A.splitUrl("https://template2.3dnest.cn/common/image/taghover_128x128.png");if(this.tagPicType!==y.Pic&&this.tagPicType!==y.GIF||null===this.tagPicUrl||""===this.tagPicUrl||(j=m=this.tagPicUrl),this.tagPicType===y.Text)this.materialsNotAudio.free=this.buildDiscMaterial(this.getText(this.tagPicUrl,1,this.fontColor,this.background)),this.materialsNotAudio.hover=this.buildDiscMaterial(this.getText(this.tagPicUrl,1,this.fontColor,this.background));else if(this.tagPicType===y.GIF){var o=this.getTexture(j);this.materialsNotAudio.free=this.buildDiscMaterial(o),this.materialsNotAudio.hover=this.buildDiscMaterial(o),this.clock=new h.Clock,this.gifObject=new d(o,1,25,25,30)}else this.materialsNotAudio.free=this.buildDiscMaterial(this.getTexture(j)),this.materialsNotAudio.hover=this.buildDiscMaterial(this.getTexture(m));this.materialsNotAudio.disable=this.materialsNotAudio.free.clone(),this.materialsNotAudio.disable.opacity=k.mattertags.disc.disabledOpacity,this.materialsNotAudio.cutout=new h.MeshBasicMaterial({transparent:!0,opacity:1,colorWrite:!1}),this.materialsNotAudio.pole=new h.LineBasicMaterial({linewidth:k.mattertags.pole.width,color:k.mattertags.pole.color,opacity:k.mattertags.startup.hideUntilStart?0:k.mattertags.pole.opacity,transparent:!0,alphaTest:k.mattertags.pole.opacity*k.mattertags.visibility.alphaTestLevel}),this.materialsNotAudio={free:this.materialsNotAudio.free.clone(),hover:this.materialsNotAudio.hover.clone(),disable:this.materialsNotAudio.disable.clone(),pole:this.materialsNotAudio.pole.clone(),cutout:this.materialsNotAudio.cutout.clone()},this.materials=this.materialsNotAudio}this.position=(new h.Vector3).copy(c.base);var t=(new h.Vector3).copy(c.stem.direction);if(this.type,u.Title,this.discPosition=t,this.basepos=this.position.clone(),this.discpos2=this.discPosition.clone(),this.type===u.BuildingType?this.discPosition.y+=.5:this.type===u.PanoVideo||(this.discPosition.y+=.03),this.discScale=.05,this.poleEnabled=c.stem.enabled,this.boardOrientation="",this.boardState=C.CLOSED,this.hoveringBillboard=!1,this.animationScale=0,this.visibleTransition=null,this.boardTransition=null,this.fadeInTimer=void 0,this.fadeOutTimer=void 0,k.mattertags.enableLinking&&(this.type===u.TextOnly||this.type===u.TextAudio)){var x=this.parseLinks(c.details.description,a.modelid);this.links=x.links,this.parsedDescription=x.description}}var f,g=a("../util/img"),h=a("three"),i=a("../util/logger"),j=a("../util/browser"),k=a("../conf"),l=a("../enum/Viewmode"),m=a("../enum/RenderOrder"),n=(a("../enum/Colors"),a("../util/common"),a("../util/texture")),o=a("../objects/Panorama"),p=(a("../analytics"),a("../util/transitions")),q=a("../util/lerp"),r=a("../util/easing"),s=a("../enum/LinkType"),t=a("events").EventEmitter,u=a("../enum/TagType"),v=a("../enum/MediaType"),w=new i(c),x=a("../util/swiper"),y=a("../enum/TagPicType"),z=a("../gui/offLine"),A=new z,B=a("../util/statistic_utils"),C={CLOSED:"closed",OPENING:"opening",OPEN:"open",CLOSING:"closing",ACTIVE:"active"},D=document.getElementById("tag-billboards"),E=window.document.getElementById("audio-tag"),F=window.document.getElementById("audio-tag"),H=window.document.getElementById("video-tag");e.prototype=Object.create(t.prototype),e.raycaster=new h.Raycaster,e.prototype.build=function(){return this.enabled&&!this.isBuilt?(this.floor=this.model.floors.get(this.floorIndex)||this.model.floors.first(),this.floor&&(this.billboard=this.buildBillboard(),this.obj3d=this.buildObject3D(),this.type===u.PanoVideo&&this.obj3d.scale.set(this.media_scale,this.media_scale,this.media_scale),this.floor.add(this.obj3d)),this.isBuilt=!0,this):null},e.prototype.draw=function(a,b){if(this.ctx){var c,d=this.data.details.description||"",e=this.ctx;c=j.detectIOS()?"PingFang SC":"Microsoft YaHei",e.font="bold 24px "+c;var f=512;e.measureText(d).width;!function(b,c,d,g,h,i){e.beginPath(),e.lineWidth=g,e.strokeStyle=h,0!==a&&-1!==a||(e.arc(b+d,c+d,d,0,2*Math.PI),e.moveTo(b+d+6,c+d+6),e.arc(b+d,c+d,6,0,2*Math.PI),e.stroke()),1!==a&&-1!==a||(e.moveTo(f+32,200),e.lineTo(f+72+-6,166),e.stroke()),2!==a&&-1!==a||(e.moveTo(f+72+-6,166),e.lineTo(f+142+-6,166),e.arc(f+144+-6,166,2,0,2*Math.PI),e.stroke())}(f+10,200,16,4,"rgba(255,255,255,1)");var g=f+154;(a>=3||-1===a)&&(e.fillStyle=b,-1!==a?e.fillText(d.substring(0,a-2),g,175):e.fillText(d,g,175),e.stroke()),e.closePath(),this.materials.free.map.needsUpdate=!0}},e.prototype.buildObject3D=function(){var a=new h.Object3D;if(a.position.copy(this.position),this.tagPicType===y.Text){if(this.tagPicUrl){var b=[{w:.35,h:.5},{w:.7,h:1},{w:.9,h:1.3}],c=this.tagSupplement?this.tagSupplement.fontSize-1:0,d=this.tagPicUrl.length,e=b[c].h,f=d*b[c].w+.2;this.geometry.discOtherModelText=new h.PlaneBufferGeometry(f,e)}this.disc=new h.Mesh(this.geometry.discOtherModelText,this.materials.free)}else this.type===u.BuildingType?this.disc=new h.Mesh(this.geometry.discBuilding,this.materials.free):this.type===u.OtherModel?this.disc=new h.Mesh(this.geometry.discOtherModel,this.materials.free):this.type===u.Tag360T1?this.disc=new h.Mesh(this.geometry.discFrom360Tag,this.materials.free):this.type===u.PanoVideo?this.disc=new h.Mesh(this.geometry.panoVideoTag,this.materials.free):this.type===u.TagTo360?this.disc=new h.Mesh(this.geometry.discTo360Tag,this.materials.free):this.tagPicType===y.Text?this.disc=new h.Mesh(this.geometry.discGif,this.materials.free):this.type!==u.Title&&(this.disc=new h.Mesh(this.geometry.disc,this.materials.free));2e4===this.i&&(this.geometry.disc=new h.PlaneBufferGeometry(1e-4,1e-4),this.disc=new h.Mesh(this.geometry.disc,this.materials.free)),this.type!=u.Tag360T1&&this.disc.position.copy(this.discPosition),this.disc.renderOrder=m.mattertagDisc,this.disc.tag=this;var g=new h.Mesh(this.geometry.cutout,this.materials.cutout);if(g.renderOrder=m.mattertagCutout,this.type!=u.PanoVideo&&this.disc.add(g),this.poleEnabled){var i=this.buildPole();i.renderOrder=m.mattertagStem,a.add(i)}return(j.isIe.versions.trident||j.isEdge.versions.Edge)&&this.disc.tag.type==u.WeatherTag&&(this.disc.visible=!1),a.add(this.disc)},e.prototype.updateTagMaterial=function(a){this.materials.free=this.buildDiscMaterial(this.getTexture(a)),this.disc.material=this.materials.free,this.disc.material.needUpdate=!0},e.prototype.buildTextObject3D=function(a){var b=Object.create(a);b.type=-1;var c=new h.Object3D;b.position.y+=.05,c.position.copy(b.position),b.disc=new h.Mesh(b.geometry.discOtherModel,b.materials.free),b.discPosition.y+=.05,b.disc.position.copy(b.discPosition),b.disc.renderOrder=m.mattertagDisc,b.disc.tag=this;var d=new h.Mesh(b.geometry.cutout,b.materials.cutout);if(d.renderOrder=m.mattertagCutout,b.disc.add(d),b.poleEnabled){var e=b.buildPole();e.renderOrder=m.mattertagStem,c.add(e)}return c.add(b.disc)},e.prototype.buildDiscMaterial=function(a,b){if(this.type===u.Title){var c=document.createElement("canvas");c.width=1024,c.height=256;var d=c.getContext("2d");return this.dc=c,this.ctx=d,new h.MeshBasicMaterial({map:new h.Texture(c),transparent:!0,opacity:1,alphaTest:k.mattertags.visibility.alphaTestLevel,depthTest:!1})}if(1==b){var e=new h.SpriteMaterial({opacity:k.mattertags.startup.hideUntilStart?0:k.mattertags.disc.opacity,transparent:!0,map:a});return e.map.offset=new h.Vector2(0,0),e.map.repeat=new h.Vector2(1/17,1),e.depthTest=!1,e.blending=h.AdditiveBlending,e}if(38==b){var f={time:{type:"f",value:1},videoTexture:{type:"t",value:a}};return new h.ShaderMaterial({uniforms:f,vertexShader:"varying mediump vec2 vUv;\nvoid main(void)\n{\n vUv = uv;\n mediump vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n gl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform mediump sampler2D videoTexture;\nvarying mediump vec2 vUv;\nvoid main(void)\n{\n  gl_FragColor = vec4(texture2D(videoTexture, vec2(vUv.x, 0.5+vUv.y/2.)).rgb,  texture2D(videoTexture, vec2(vUv.x, vUv.y / 2.)).r); \n}",depthTest:!0,depthWrite:!1,needsUpdate:!0,transparent:!0})}return new h.MeshBasicMaterial({map:a,transparent:!0,opacity:k.mattertags.startup.hideUntilStart?0:k.mattertags.disc.opacity,alphaTest:k.mattertags.visibility.alphaTestLevel})},e.prototype.initAnimation=function(){var a=this.disc.material.map.offset,b=function(a){return Math.floor(17*a)/17};this.cursorAnimate=new TWEEN.Tween(a).to({x:1},1e3).onStart(function(){}).onStop(function(){a.x=0}).onUpdate(function(){}).onComplete(function(){a.x=0,setTimeout(function(){},1500)}),this.cursorAnimate.easing(b),this.cursorAnimate.repeat(Number.POSITIVE_INFINITY),this.cursorAnimate.start()},e.prototype.getTexture=function(a){return n.loadurl(a)},e.prototype.getText=function(a,b,c,d){return b?n.loadCanvasIn(a,c,d):n.loadCanvas(a)};var I;e.prototype.buildPole=function(){return this.geom=new h.BufferGeometry,this.ar=new Float32Array(6),this.ar[0]=this.ar[1]=this.ar[2]=0,this.ar[3]=this.discPosition.x,this.ar[4]=this.discPosition.y,this.ar[5]=this.discPosition.z,this.geom.addAttribute("position",new h.BufferAttribute(this.ar,3)),this.line=new h.Line(this.geom,this.materials.pole),this.line},e.prototype.parseLinks=function(a,b){var c=/\[([^\]]*)\]\((.*?)(?:\)(?:\s|$))/,d=[],e=[],f=[];for(a=a.slice();;){var g=a.match(c);if(!g)break;e.push(a.slice(0,g.index)),a=a.slice(g.index+g[0].length),-1===g[2].indexOf("javascript:")&&d.push(g)}return e.push(a),k.mls||(f=this.buildLinks(d,b)),{links:f,description:e}},e.prototype.buildLinks=function(a,b){return a.map(function(a){var c=s.EXT_LINK,d=a[1],e=a[2];return-1===e.indexOf("://")&&(e="https://"+e),-1===e.indexOf("matterport.com/show")&&-1===e.indexOf(window.location.host+"/show")||(-1!==e.indexOf(b)&&-1!==e.indexOf("start=")?c=s.NAVIGATION:(c=s.MODEL,e+="&play=1")),{label:d,URL:e,type:c}})},e.prototype.buildBillboard=function(){function a(a){return function(b){var c,d=document.getElementById("player");try{c=new MouseEvent(a,b)}catch(d){c=document.createEvent("MouseEvents"),c.initMouseEvent(a,b.bubbles,b.cancelable,b.view,b.detail,b.screenX,b.screenY,b.clientX,b.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,b.button,b.relatedTarget)}d.dispatchEvent(c)}}var b=document.createElement("div");b.className="tag-container has-hotzone",D.appendChild(b);var c=document.createElement("div");c.className="tag-body",b.appendChild(c);var d=document.createElement("p");return d.className="tag-label",d.textContent=this.label,$(".tag-label").css("line-height",1.5),$(".tag-label").css("letter-spacing","1px"),c.appendChild(d),this.buildContents(c),c.addEventListener("mouseover",function(a){this.boardState===C.OPEN&&b.classList.remove("has-hotzone")}.bind(this)),c.addEventListener("mousedown",function(a){a.stopPropagation()}),c.addEventListener("mouseup",function(a){a.stopPropagation()}),b.addEventListener("mousedown",a("mousedown")),b.addEventListener("mouseup",a("mouseup")),b.addEventListener("mouseenter",function(a){(k.mattertags.animation.hoverOnClosing||this.boardState!==C.CLOSING)&&(this.hoveringBillboard=!0,this.emit("enter",this),this.setHoverState())}.bind(this)),b.addEventListener("mouseleave",function(a){this.hoveringBillboard=!1,this.emit("leave",this),this.boardState!==C.ACTIVE&&this.setFreeState()}.bind(this)),b},e.prototype.buildContents=function(a){function b(a){var b=document.createElement("span");return b.className="tag-desc",$(".tag-desc").css("line-height",1.6),$(b).html(null!=a?a:""),b}this.links.forEach(function(c,d){var e=b(this.parsedDescription[d]);a.appendChild(e);var f=document.createElement("a");if(f.classList.add("tag-link"),f.setAttribute("data-linktype",c.type),f.setAttribute("data-tagID",this.i),f.href=c.URL,f.textContent=c.label+" ",c.type===s.EXT_LINK){e.textContent+="→ ";var g=document.createElement("i");g.classList.add("icon-ext-link"),g.title="Link to external web site",f.appendChild(g)}a.appendChild(f)}.bind(this));var c=b(this.parsedDescription[this.parsedDescription.length-1]);a.appendChild(c)},e.prototype.scrollAll=function(a){a?this.highlightStatus?$("#drawer").hasClass("open")?($(".pinBottom").removeClass("open"),$("#drawer").removeClass("open"),$("#drawer").hasClass("open")?$("#pullTab .icon").attr("data-original-title","收起"):$("#pullTab .icon").attr("data-original-title","房间列表"),setTimeout(function(){$("#pullTab").removeClass("opened")},$("#drawer").hasClass("open")?0:k.highlightAnimationDuration),$(".pinBottom").addClass("large-open"),$("#tag-detail").addClass("open")):($(".pinBottom").removeClass("large-open"),$("#tag-detail").removeClass("open"),$(".pinBottom").addClass("open"),$("#drawer").addClass("open"),$("#drawer").hasClass("open")?$("#pullTab .icon").attr("data-original-title","收起"):$("#pullTab .icon").attr("data-original-title","房间列表"),setTimeout(function(){$("#pullTab").addClass("opened")},$("#drawer").hasClass("open")?0:k.highlightAnimationDuration)):($(".pinBottom").toggleClass("large-open"),$("#tag-detail").toggleClass("open")):this.highlightStatus},e.prototype.setFreeState=function(a,b,c){console.log("setFreeState----leave"),E.volume=1,this.type===u.Commodity||this.type===u.Tag360||this.type===u.ImageText||this.type===u.ImageTextAudio||this.type===u.IKEA||this.type===u.Video?this.setClosedState():this.type===u.Audio?b&&(this.setClosedState(),this.stopAudio(c)):this.type===u.Title||!a&&this.hoveringBillboard||(this.fadeOutTimer||(this.fadeOutTimer=p.setTimeout(function(){this.disc.material=this.materials.free,this.boardState!==C.CLOSED&&(this.boardState=C.CLOSING,this.animateBoard())}.bind(this),k.mattertags.animation.animOutDelay)),p.cancel(this.fadeInTimer),this.fadeInTimer=void 0)},e.prototype.startAudio=function(){function a(a,b,c){return a*(1-c)+c*b}function b(b,d){d<=.5?(b.firstElementChild.firstElementChild.style.webkitTransform="rotate("+a(-135,45,d)+"deg)",b.lastElementChild.firstElementChild.style.webkitTransform="rotate(-135deg)"):(b.firstElementChild.firstElementChild.style.webkitTransform="rotate(45deg)",b.lastElementChild.firstElementChild.style.webkitTransform="rotate("+a(-135,45,d)+"deg)"),G.R.longplaying?(c.billboard.style.display="block",c.billboard.style.visibility="visible"):c.billboard.style.display="none"}var c=this;E.loop=this.audioControl.loop,E.src=this.audiourl,E.currentTime=0,E.play(),this.played?c.intvl=setInterval(function(){var a=E.currentTime/E.duration;b(c.billboard,a)},1e3):(this.played=!0,E.oncanplay=function(){c.intvl=setInterval(function(){var a=E.currentTime/E.duration;b(c.billboard,a)},1e3)}),E.onended=function(){c.intvl&&(clearInterval(c.intvl),c.intvl=null,c.billboard.style.display="none")}},e.prototype.stopAudio=function(a){E.ended||(this.intvl&&(clearInterval(this.intvl),this.intvl=null),E.pause(),0===a&&(E.currentTime=0),this.audioPauseTime=E.currentTime,this.billboard.style.display="none")},e.prototype.setHoverState=function(a,b){var c=this,d=this.model;this.model.language;if(this.boardState!==C.ACTIVE)if(0!==b&&1!==b||E.pause(),$("#tag-detail").hasClass("open")||($("#drawer").hasClass("open")?this.highlightStatus=!0:this.highlightStatus=!1),this.type===u.Commodity){$("#commodity_video_source").src="",$("#commodity_videoe").src="",$("#commodity_video_list").hide(),$("#image_center").empty(),$("#commodity_title").html(""),$("#commodity_typename").html(""),$("#commodity_size").html("");var e=this.data.details.commodityinfo||null,h=this.data.details.mlanguage_type,i=window.location.href;isNaN(h)?h=i.indexOf(".biz")>0?1:G&&G.settings&&G.settings.basic&&G.settings.basic.menu&&G.settings.basic.menu.mlanguage_enable?2:0:G.settings.basic.menu.mlanguage_enable||(h=0),h=parseInt(h);var l="折",m="去购买";1==h?($("#commodity_video_btn_id").html("Video"),$("#commodity_img_btn_id").html("Images"),$("#commodity_three_btn_id").html("3D"),l="Discount",m="Go Buy"):2==h?($("#commodity_video_btn_id").html("映像"),$("#commodity_img_btn_id").html("画像"),$("#commodity_three_btn_id").html("3D"),m="購入"):($("#commodity_video_btn_id").html("视频"),$("#commodity_img_btn_id").html("图片"),$("#commodity_three_btn_id").html("3D"),m="去购买"),$("#commodityTag").fadeIn(300,function(){if(e){var a=e.commodity_audio,b=document.getElementById("commodity_video"),c=document.getElementById("commodity_audio");a&&a.length>0&&a.indexOf(".mp3")>0?(document.getElementById("commodity_audio_source").src=a,c.src=a,$("#commodity_audio_btn").removeClass("commodity_audio_pause_btn"),$("#commodity_audio_btn").addClass("commodity_audio_play_btn")):(document.getElementById("commodity_audio_source").src="",c.src="",$("#commodity_audio_btn").removeClass("commodity_audio_play_btn"),$("#commodity_audio_btn").addClass("commodity_audio_pause_btn")),$("#commodity_video_list").hide(),$("#commodity_video_cover").hide(),$("#commodity_video_btn_id").removeClass("commodity_btn_active");var d=e.commodity_video;d&&d.length>0&&d.indexOf(".mp4")>0?(document.getElementById("commodity_video_source").src=e.commodity_video,b.src=e.commodity_video,$("#commodity_video_play").on("click",function(){b&&b.src.indexOf(".mp4")>0&&(b.currentTime=0,b.play()),$("#commodity_video_cover").hide()}),$("#commodity_video_btn_id").show(),$("#commodity_video_btn_id").on("click",function(){c&&c.src.indexOf(".mp3")>0&&c.pause(),/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)?b.play():b.play()&&b.pause(),$("#commodity_video_cover").show(),$("#commodity_video_list").show(),$("#commodity_images_list").hide(),$("#commodity_three_list").hide(),$("#commodity_video_btn_id").addClass("commodity_btn_active"),$("#commodity_img_btn_id").removeClass("commodity_btn_active"),$("#commodity_three_btn_id").removeClass("commodity_btn_active"),$("#commodity_audio_btn").removeClass("commodity_audio_play_btn"),$("#commodity_audio_btn").addClass("commodity_audio_pause_btn")})):(document.getElementById("commodity_video_source").src="",b.src="",$("#commodity_video_btn_id").hide()),$("#commodity_audio_btn").on("click",function(){c.src.indexOf(".mp3")>0&&c.paused?($("#commodity_audio_btn").removeClass("commodity_audio_pause_btn"),$("#commodity_audio_btn").addClass("commodity_audio_play_btn"),c.currentTime=0,c.play()):($("#commodity_audio_btn").removeClass("commodity_audio_play_btn"),$("#commodity_audio_btn").addClass("commodity_audio_pause_btn"),c.pause())});var f=e.commodity_carousel_img||"",g=[];if(f&&f.length>0&&(g=f.split(",")),$("#image_center").empty(),g&&g.length>0){$("#commodity_images_list").show(),$("#commodity_img_btn_id").show(),c&&c.src.indexOf(".mp3")>0&&c.play(),$("#commodity_img_btn_id").on("click",function(){b&&b.src.indexOf(".mp4")>0&&b.pause(),c&&c.src.indexOf(".mp3")>0&&(c.currentTime=0),$("#commodity_video_list").hide(),$("#commodity_images_list").show(),$("#commodity_three_list").hide(),$("#commodity_video_btn_id").removeClass("commodity_btn_active"),$("#commodity_three_btn_id").removeClass("commodity_btn_active"),$("#commodity_img_btn_id").addClass("commodity_btn_active")});for(var i=0;i<g.length;i++){$("#image_center").append('<div class="image_center_item swiper-slide" id="img_'+i+'"><img src="'+g[i]+'"/></div>');var k=new Image;k.src=g[i];var n=$(".image_center_item").height();k.onload=function(){k.width<=k.height?$(".image_center .image_center_item img").height("100%"):k.width>k.height&&(k.width>n?($(".image_center .image_center_item img").height("100%"),$(".image_center .image_center_item img").width("100%")):$(".image_center .image_center_item img").width("100%"))}}if(g.length>1){new x("#commodity_images_list",{speed:500,loop:!0,setWrapperSize:!0,observer:!0,observeParents:!0,nextButton:".image_right",prevButton:".image_left"});$(".image_left, .image_right").delay(750).fadeIn(500).fadeOut(500).fadeIn(500)}else $(".image_left").fadeOut(200),$(".image_right").fadeOut(200)}else $("#commodity_images_list").hide(),$("#commodity_img_btn_id").hide();$(".image_center_item img").on("click",function(){$(".wheel-container").fadeIn(300)}),$(".wheel-container").on("click",function(){$(".wheel-container").fadeOut(300)}),$(".image_center_item img").on("click",function(a){a.stopPropagation(),a.cancelBubble=!0;var b=$(this).attr("src");$(".wheelPic").css("background-image","url("+b+")"),$(".wheel-container").fadeIn(300)});var o=e.commodity_image||"",p=[];if(o&&(p=o.split(",")),$("#commodity_three_images").spritespin("destroy"),$("#commodity_three_images").empty(),$("#commodity_three_list").hide(),$("#commodity_three_btn_id").removeClass("commodity_btn_active"),p&&p.length>0){$("#commodity_three_btn_id").show(),p.sort();var q=420,r=420;j.isMobile()&&$(window).width()<=599&&(q=260,r=260),$("#commodity_three_btn_id").on("click",function(){b&&b.src.indexOf(".mp4")>0&&b.pause(),c&&c.src.indexOf(".mp3")>0&&(c.currentTime=0),$("#commodity_video_list").hide(),$("#commodity_images_list").hide(),$("#commodity_three_list").show(),$("#commodity_img_btn_id").removeClass("commodity_btn_active"),$("#commodity_video_btn_id").removeClass("commodity_btn_active"),$("#commodity_three_btn_id").addClass("commodity_btn_active"),setTimeout(function(){$("#commodity_three_images").spritespin({source:p,frames:p.length,width:r,height:q,OnInit:function(){},onProgress:function(){},onLoad:function(){}})},200)}),$(".commodity_three_list").on("click",function(){$(".three-container").fadeIn(300)}),$(".three-container").on("click",function(){$(".three-container").fadeOut(300)}),$(".commodity_three_list").on("click",function(a){a.stopPropagation(),a.cancelBubble=!0,setTimeout(function(){$(".fake_3d").spritespin({source:p,frames:p.length,width:$(".threeSize").width(),height:$(".threeSize").height(),OnInit:function(){},onProgress:function(){},onLoad:function(){}})},200),$(".three-container").fadeIn(300)})}else $("#commodity_three_btn_id").hide();$("#commodity_title").html(e.commodity_name),$("#commodity_typename").html(e.commoditytype_name);var s=e.commodity_color||"";s=s?s.split(","):[],$("#commodity_color").empty();for(var t=0;t<s.length;t++)$("#commodity_color").append('<span style="background-color:'+s[t]+';display:inline-block;height: 14px;width: 14px;"></span>');$("#commodity_size").html(e.commodity_size);var u=e.commodity_unit||"cny",v={usd:"$",cny:"¥",jpy:"¥(jpy)",eur:"€",USD:"$",CNY:"¥",JPY:"¥(jpy)",EUR:"€"};e.commodity_price?$("#commodity_presentrice").html(v[u]+" "+e.commodity_price):$("#commodity_presentrice").html(v[u]+" "),e.commodity_oprice?$("#commodity_oprice").html(v[u]+" "+e.commodity_oprice):$("#commodity_oprice").html(v[u]+" ");var w="",y="",z=e.commodity_oprice,A=e.commodity_price;if(A&&z){parseFloat(z)-parseFloat(A)>0&&(w='<span class="commodity_discount">'+l+"</span>")}var B=e.commodity_new;parseInt(B)<=0&&(y=1==h?'<span class="commodity_new">New</span>':'<span class="commodity_new">新</span>'),$("#commodity_title_tips").html(y+w),$("#commodity_url").html("<a href="+e.commodity_url+' target="_blank">'+m+"</a>")}})}else if(this.type===u.Tag360){var n=this.data.details.imageurl||[];n.sort();var o=280,q=420;j.isMobile()&&$(window).width()<=420&&(o=200,q=300),n[0]&&n[0].length>0&&$("#tag360picLoading").show(),$("#tag360pic").spritespin({source:n,frames:n.length,width:q,height:o,OnInit:function(){},onProgress:function(){},onLoad:function(){$("#tag360picLoading").hide()}}),window.isFirstClicked=!0;var r=this.tagInfoUrl;$("#object360TagMore").show(),r&&r.length>0?$("#object360TagMore").bind("click",function(a){window.isFirstClicked&&(window.isFirstClicked=!1,window.open(r)),setTimeout(function(){window.isFirstClicked=!0},500)}):$("#object360TagMore").hide();var s=0,t=parseFloat(this.data.details.price).toFixed(2),v=parseFloat(this.data.details.orgi_price).toFixed(2);s=parseFloat(v-t).toFixed(2),$("#tag360Title").html(this.data.details.title),t=0==parseInt(t)?"":t,v=0==parseInt(v)?"":v,$("#tag360price").html('<div class="price">'+t+'</div><div class="oriprice">'+v+"</div>"),0==parseInt(s)?$("#tag360save").hide():($("#tag360save").show(),$("#tag360save").html(s)),$("#tag360weight").html(this.data.details.weight_volume),$("#tag360contentDetail").html(this.data.details.description_html),$("#object360Tag").fadeIn(300)}else if(this.type===u.ImageText||this.type===u.ImageTextAudio||this.type===u.IKEA||this.type===u.Video){if(this.audioenable&&this.audiourl&&(E.volume=.7,E.loop=this.imgaudioControl.loop,E.src=this.audiourl,j.isIe.versions.trident?E.oncanplay=function(){E.currentTime=0}:E.currentTime=0,E.play()),this.type===u.Video){if(j.isMobile()||(H.width=450),H.src=this.videourl,j.isMobile()&&($(window).width()<=375||$(window).height()<=418)?(this.data.details.title||this.data.details.description)&&$(".middletext").css({height:"88px","margin-bottom":"30px","overflow-y":"auto"}).show():(this.data.details.title||this.data.details.description)&&$(".middletext").css({height:"110px","margin-bottom":"34px","overflow-y":"auto"}).show(),""==this.videourl)$(".whiteboard #video-tag").css({width:"100%",height:"auto"});else{console.log(this.videourl);var w=document.querySelector("#video-tag");w.addEventListener("canplay",function(){this.videoWidth>this.videoHeight?$(".whiteboard #video-tag").css({width:"auto",height:"auto"}):this.videoWidth<=this.videoHeight&&(j.isMobile()&&($(window).width()<=375||$(window).height()<=418)?$(".whiteboard #video-tag").css({width:"auto",height:"300px"}):$(".whiteboard #video-tag").css({width:"auto",height:"400px"}))})}$(".topimg").hide(),j.detectIOS(),$("#video-tag").css("display","block"),$(".topimg").css("height","0px")}else $(".middletext").show(),j.isMobile()?$(".topimg").css("height","240px").show():$(".topimg").css("height","350px").show(),$("#video-tag").css("display","none");if($.isArray(this.data.details.imageurl))!function(a){$(".topimg").hide(),$("#slidePictures").show();for(var b=0;b<a.length;b++){var c=g.getSize(a[b]),c=g.getSize(a[b]),d=$("#slidePictures").width(),e=$("#slidePictures").height();if(c.width<=c.height)var f='<div class="swiper-slide moreImages"><img class="imageCon longimgCon" src='+a[b]+' alt=""></div>';else if(c.width>c.height)if(c.width/c.height>d/e)var f='<div class="swiper-slide moreImages"><img class="imageCon commimgCon" src='+a[b]+' alt=""></div>';else var f='<div class="swiper-slide moreImages"><img class="imageCon longimgCon" src='+a[b]+' alt=""></div>';$("#wrapperPic").append(f)}new x("#slidePictures",{speed:500,loop:!0,setWrapperSize:!0,observer:!0,observeParents:!0,nextButton:".btn-next3",prevButton:".btn-prev3"}),$(".imageCon").on("click",function(a){a.stopPropagation(),a.cancelBubble=!0;var b=$(this).attr("src"),c=g.getWinSize(b);$(".originpic").css("background-image","url("+b+")"),$(".picsize").css({width:c.width,height:c.height}),$(".picsize").attr("data-with",c.width),$(".picsize").attr("data-height",c.height),$("#picsizeScroll").css({left:"50%",top:"50%",transform:"translate(-50%, -50%)"}),$(".originpic-container").fadeIn(300)}),
$(".btn-prev3, .btn-next3").delay(750).fadeIn(500).fadeOut(500).fadeIn(500)}(this.data.details.imageurl);else{$("#slidePictures").hide();var y=g.getSize(this.data.details.imageurl);if(y.width&&y.height){var z=y.width/y.height;console.log(z);var A=$(".topimg").width(),D=$(".topimg").height();y.width<=y.height?$(".imageCon").removeClass("highimgCon commimgCon").addClass("longimgCon"):y.width>y.height&&(y.width/y.height>A/D?$(".imageCon").removeClass("highimgCon commimgCon").addClass("highimgCon"):$(".imageCon").removeClass("longimgCon commimgCon").addClass("longimgCon"))}this.data.details.imageurl&&$(".topimg .imageCon").show().attr("src",this.data.details.imageurl),$(".originpic").css("background-image","url("+this.data.details.imageurl+")");var I=g.getWinSize(this.data.details.imageurl);$(".picsize").css({width:I.width,height:I.height})}var J,K=this.data.details.isNew?'<span style="color: red">新 </span>':"",L=this.data.details.price?'<br/><span style="font-size: 200%;color:black;">¥ '+this.data.details.price+"</span>":"";J=j.isMobile()?"ikea":"ikeapc",this.type===u.IKEA?($(".topimg").addClass(J),$(".middletitle").html(this.data.details.name1?K+this.data.details.name1:""),$(".middlecontent").html(this.data.details.name2?this.data.details.name2+L:""+L)):($(".topimg").removeClass(J),$(".middletitle").html(this.label?K+this.label:""),$(".middlecontent").html(this.data.details.description?this.data.details.description:"")),void 0!==this.tagInfoUrl&&""!==this.tagInfoUrl?($(".bottomlink").css("display","block"),f=this.tagInfoUrl,window.isFirstClicked=!0,$(".bl-text").bind("click",function(a){window.isFirstClicked&&(window.isFirstClicked=!1,window.open(f)),setTimeout(function(){window.isFirstClicked=!0},500)})):$(".bottomlink").css("display","none"),j.isMobile()&&($(window).width()<=375||$(window).height()<=418)?$(".middletext").css({height:"88px","margin-bottom":"30px","overflow-y":"auto"}):$(".middletext").css({height:"110px","margin-bottom":"34px","overflow-y":"auto"}),this.label||this.data.details.description||this.tagInfoUrl||$(".middletext").css({height:"0px","margin-bottom":"0","overflow-y":"hidden"}),$(".pctagcontainer").fadeIn(300),$(".middletext").scrollTop(0)}else if(this.type===u.Audio){var c=this;E.addEventListener("ended",function(){"loop"!==E.loop&&(c.setFreeState(!0,!0),E.currentTime=0)}),0==b?(1===!this.subtype&&(this.disc.material=this.materials.hover),E.loop=this.audioControl.loop,E.src=this.audiourl,j.isIe.versions.trident?E.oncanplay=function(){E.currentTime=0}:E.currentTime=0,E.play()):1==b&&(1===!this.subtype&&(this.disc.material=this.materials.hover),E.loop=this.audioControl.loop,E.src=this.audiourl,E.currentTime=E.ended?0:this.audioPauseTime,E.play())}else if(8===this.type){if(0===b){document.getElementsByClassName("iframe-open")[0];$("#iframe-parent").css("display","block"),$(".iframe-open")[0].src=this.data.details.url,$(".iframeTitle").text(this.label?this.label:""),$("#iframe-close, .help_back").css("display","block"),d.iframe_screen_enable?($(".iframeTitle").hide(),j.isMobile()?($("#iframeBox").addClass("mobile-screen-open"),$("#iframe-close").addClass("mobile-screen-close")):($("#iframeBox").addClass("pc-screen-open"),$("#iframe-close").addClass("pc-screen-close"))):j.isMobile()?($("#iframeBox").addClass("iframeOMobile"),$("#iframe-close").addClass("iframeCMobile")):($("#iframeBox").addClass("iframeOPc"),$("#iframe-close").addClass("iframeCPc"))}this.hoveringBillboard||this.billboard.classList.add("has-hotzone"),this.fadeInTimer&&a&&this.setActiveState(),p.cancel(this.fadeOutTimer),this.fadeOutTimer=void 0}else if(this.type===u.OtherModel)0===b&&this.tagInfoUrl&&window.open(this.tagInfoUrl);else if(this.type===u.Video){var M=window.document.getElementById("audio-bar");M.pause(),$(".pwVideo").fadeIn(300,function(){j.isMobile()?$(".video-play").hide():$(".video-play").fadeIn(200)}).css("display","flex"),$(".help_back").fadeIn(500)}else(this.type===u.TextOnly||this.type===u.TextAudio)&&this.audioenable&&this.audiourl&&0===b&&(E.volume=.7,F.loop="",F.src=this.audiourl,F.currentTime=0,F.play()),$(".tag-body").scrollTop(0),!this.hoveringBillboard&&this.billboard&&this.billboard.classList.add("has-hotzone"),this.fadeInTimer?a&&this.setActiveState():this.type!==u.TextOnly&&this.type!==u.TextAudio||(this.fadeInTimer=p.setTimeout(function(){1===!this.subtype&&(this.disc.material=this.materials.hover),this.boardState!==C.OPEN&&(this.boardState=C.OPENING,this.animateBoard(function(){a&&this.setActiveState()}.bind(this)))}.bind(this),k.mattertags.animation.animInDelay)),p.cancel(this.fadeOutTimer),this.fadeOutTimer=void 0;B.trackEvent(53,this.tagid)},e.prototype.setClosedState=function(){this.disc.material=this.materials.free,this.emit("tag.closed"),this.boardState=C.CLOSED,this.billboard.style.visibility="hidden",this.billboard.classList.contains("has-hotzone")||this.billboard.classList.add("has-hotzone"),this.type===u.Video&&($("#video-tag")[0].pause(),$("#video-tag")[0].currentTime=0),this.type===u.ImageTextAudio&&E.pause()},e.prototype.setActiveState=function(){this.type!==u.OtherModel&&this.type!==u.IFrame&&this.type!==u.Audio&&(this.boardState=C.ACTIVE,this.billboard.classList.remove("has-hotzone"))},e.prototype.hide=function(a,b){var c=$.Deferred();if(0===this.materials.free.opacity&&!p.isRunning(this.visibleTransition))return c.resolve().promise();a=a||0,b=b||0,p.cancel(this.visibleTransition);var d=this.materials.free.opacity/k.mattertags.disc.opacity,e=b+a,f=b/e;return this.visibleTransition=p.start(function(a){q.property(this.materials.free,"opacity",0)(a),q.property(this.materials.hover,"opacity",0)(a),q.property(this.materials.pole,"opacity",0)(a)}.bind(this),e*d,function(){c.resolve()},f,r[k.warp.blendEasing]),c.promise()},e.prototype.show=function(a,b){var c=$.Deferred();if(this.materials.free.opacity===k.mattertags.disc.opacity&&!p.isRunning(this.visibleTransition))return c.resolve().promise();a=a||0,b=b||0,p.cancel(this.visibleTransition);var d=(k.mattertags.disc.opacity-this.materials.free.opacity)/k.mattertags.disc.opacity,e=b+a,f=b/e;return this.visibleTransition=p.start(function(a){q.property(this.materials.free,"opacity",k.mattertags.disc.opacity)(a),q.property(this.materials.hover,"opacity",k.mattertags.disc.opacity)(a),q.property(this.materials.pole,"opacity",k.mattertags.pole.opacity)(a)}.bind(this),e*d,function(){c.resolve()},f,r[k.warp.blendEasing]),c.promise()},e.prototype.closestPanoTowardTag=function(a,b){var c=[],d=[],f=this.disc.getWorldPosition();if(a===l.PANORAMA){var g=b.position.clone().sub(f).normalize();c.push(o.filters.isPanoAligned()),c.push(o.filters.inPanoDirection(f,g,.5)),c.push(o.filters.isNeighbourPanoTo(b)),d.push(o.scoreFunctions.direction(f,g))}var i=new h.Vector3,j=function(a){i.copy(f).sub(a.position);var b=-h.Math.radToDeg(Math.atan(i.y/Math.sqrt(i.x*i.x+i.z*i.z))),c=k.mattertags.navigate.tiltTolerance;return k.insideLookLimitDown-c<b&&b<k.insideLookLimitUp+c},m=function(a){return Math.abs(a.position.x-f.x)>k.mattertags.visibility.cameraClearance||Math.abs(a.position.z-f.z)>k.mattertags.visibility.cameraClearance};c.push(m,j),d.push(o.scoreFunctions.distanceSquared(this,-2));var n=this.model.panos.sortByScore(c,d);if(k.mattertags.navigate.lineOfSight){for(var p=0;p<n.length;p++){var q=n[p].pano,r=q.position.distanceTo(f);if(!k.mattertags.visibility.anyDistance&&r>k.mattertags.visibility.visibleDistance)return null;e.raycaster.set(q.position,f.clone().sub(q.position).normalize());var s=e.raycaster.intersectObjects(this.model.colliders);if(0===s.length||s[0].distance>r)return q}return null}return n.length>0?n[0].pano:null},e.prototype.examineMattertag=function(a,b){var c,d,e,f=a.mode;if(k.mattertags.navigate.nearestPano&&1!==this.subtype&&(c=this.closestPanoTowardTag(f,a.currentPano)),c||(c=a.currentPano),d="disc"===k.mattertags.navigate.aimAt?this.disc.getWorldPosition():"object"===k.mattertags.navigate.aimAt?this.obj3d.getWorldPosition():"nothing"===k.mattertags.navigate.aimAt?null:this.obj3d.getWorldPosition().add(this.discPosition.clone().multiplyScalar(.5)),e=k.mattertags.navigate.reactivate?function(){b(this),this.setActiveState(),G.WeatherGo=!1}.bind(this):null,f===l.PANORAMA)this.type===u.WeatherTag&&(G.WeatherGo=!0),a.flyToPano({pano:c,lookAtPoint:d,duration:null,maxDistanceOverride:null,skipWarpingCheck:!1},e);else{var g={pano:c};if(d){var i=(new h.Matrix4).lookAt(c.position,d,new h.Vector3(0,1,0));g.quaternion=(new h.Quaternion).setFromRotationMatrix(i)}k.mattertags.navigate.reactivate&&(g.callback=e),g.duration=1500,g.mode=l.PANORAMA,a.flyToNewMode(g)}},e.prototype.update=function(a,b,c,d,e){if(this.type!==u.Title){var f=this.model;if(this.i>=1e4&&this.disc&&this.disc.position&&b&&b.position){var g=this.basepos.distanceTo(b.position);if(G&&G.P){var h=Math.max(g*G.P.a-G.P.b,G.P.c);this.disc.position.y=this.discpos2.y-h}}if(this.type===u.BuildingType?a!==l.PANORAMA?this.enabled=!0:(this.enabled=!1,this.obj3d.visible=!1,this.hideDisc(a,b,c,d)):this.type===u.Tag360T1||1===this.subtype?a!==l.PANORAMA?(this.enabled=!1,this.obj3d.visible=!1,this.hideDisc(a,b,c,d)):c&&(this.obj3d.position.copy(c.position.clone().add(this.position)),!this.i>=1e4&&this.disc.position.copy(this.discPosition),this.locationId==e?this.enabled=!0:(this.enabled=!1,this.obj3d.visible=!1,this.hideDisc(a,b,c,d))):G.settings.nesttags.setting.show_in_3d||(a!==l.PANORAMA?this.materials.free.opacity=0:this.materials.free.opacity=k.mattertags.disc.opacity),this.type===u.PanoVideo)if(a!==l.PANORAMA)this.enabled=!1,this.obj3d.visible=!1,this.hideDisc(a,b,c,d);else if(c)if(c.id!==this.locationId){this.enabled=!1,this.obj3d.visible=!1,!k.isNewEditVersion||"-1"!=this.tagid&&"-2"!=this.tagid?this.hideDisc(a,b,c,d):(this.enabled=!0,this.obj3d.visible=!0);var i=document.getElementById(this.tagid);i&&i.pause()}else this.enabled=!0,this.obj3d.visible=!0;this.enabled&&(this.updateDisc(a,b,c,d,f),this.boardState!==C.CLOSED&&this.updateBillboard(b))}},e.prototype.updateDisc=function(a,b,c,d,f){if(k.isNewEditVersion&&("-1"==this.tagid||"-2"==this.tagid))if(this.rt360){var g=this.player.getMouseDirection(),i=Math.sqrt(4/(g.x*g.x+g.y*g.y+g.z*g.z));g.multiplyScalar(i),this.obj3d.position.copy(c.position.clone().add(g)),this.disc.position.copy(this.discPosition)}else{var j=this.player.intersect;if(null!=j){var i={};i.point=j.point.clone(),i.normal=j.normal.clone();var m=i.normal.clone().multiplyScalar(.1);this.obj3d.position.copy(i.point),this.disc.position.copy(m),null!=this.ar&&(this.ar[3]=m.x,this.ar[4]=m.y,this.ar[5]=m.z,this.geom.addAttribute("position",new h.BufferAttribute(this.ar,3)))}}var n,o=G.settings.nesttags.setting,p=k.mattertags.visibility,q=k.mattertags.disc.scale,r=this.disc.getWorldPosition();if(a===l.PANORAMA?(n=b.position.distanceTo(r),1!=this.subtype&&this.type!=u.Tag360T1&&this.type!==u.Title?o.autohide&&(n>p.MaxDistance?this.materials.free.opacity=0:this.materials.free.opacity=k.mattertags.disc.opacity):this.type===u.Title||(this.materials.free.opacity=k.mattertags.disc.opacity)):n=p.visibleDistance,this.obj3d.visible=0!==this.disc.material.opacity&&(p.anyDistance||n<=p.visibleDistance||a===l.TRANSITIONING)&&(!p.hideViaFloor||this.tagVisibleOnCurrentFloor(a))&&(!p.hideOffScreenDisc||!this.offScreen(this.disc,b))&&(!p.hideOffScreenObject||!this.offScreen(this.obj3d,b)),this.obj3d.visible){k.isNewEditVersion||this.type!=u.PanoVideo?this.disc.quaternion.copy(b.quaternion):(this.disc.quaternion.copy(b.quaternion),this.disc.quaternion.x=0,this.disc.quaternion.z=0);var s=q.maxSize-(q.maxSize-q.minSize)*h.Math.smoothstep(n,q.nearBound,q.farBound),t=r.clone().project(b),v=new h.Vector3(window.innerWidth/2,window.innerHeight/2,1).multiply(t),w=new h.Vector3(s/2,0,0).add(v),i=new h.Vector3(2/window.innerWidth,2/window.innerHeight,1).multiply(w),x=i.clone().unproject(b),y=x.clone().distanceTo(r),z=1+q.responsiveness/100*(e.viewportScale(this.type)-1);this.tagSupplement&&!1===this.tagSupplement.inScale&&(z=1),this.discScale=y*z,this.disc.scale.set(this.discScale,this.discScale,this.discScale)}},e.prototype.hideDisc=function(a,b,c,d){this.obj3d.visible=!1,this.billboard.style.display="none"},e.prototype.tagVisibleOnCurrentFloor=function(a){if(this.clock&&this.gifObject){var b=this.clock.getDelta();this.gifObject.update(1e3*b)}return a!==l.DOLLHOUSE&&a!==l.FLOORPLAN||this.model.allFloorsVisible||!this.floor.hidden},e.prototype.offScreen=function(a,b){var c=a.getWorldPosition().project(b);return!(-1<c.x&&c.x<1&&-1<c.y&&c.y<1)},e.viewportScale=function(a){return e.viewportWidth===window.innerWidth&&e.viewportHeight===window.innerHeight||(e.viewportWidth=window.innerWidth,e.viewportHeight=window.innerHeight),a===u.BuildingType?(e.currentViewportScaleBuilding=Math.sqrt(Math.min(e.viewportWidth,e.viewportHeight)/k.mattertags.disc.scale.buildingViewportSize),e.currentViewportScaleBuilding):(e.currentViewportScaleCommon=Math.sqrt(Math.min(e.viewportWidth,e.viewportHeight)/k.mattertags.disc.scale.baseViewportSize),e.currentViewportScaleCommon)},e.prototype.newBillboardOrientation=function(a){if(this.boardOrientation&&this.boardState!==C.OPENING)return this.boardOrientation;var b=1/3,c=a.y<-b?0:a.y<b?1:2,d=a.x<-b?0:a.x<b?1:2,e="";return e+=0===d?"right":2===d?"left":"",e+=0===c?"-down":2===c?"-up":"",1===d&&(e=0===c?"bottom":2===c?"top":"",1===c&&(e=window.innerWidth>window.innerHeight?a.x<0?"right":"left":a.y<0?"bottom":"top")),e},e.prototype.updateBillboard=function(a){var b=this.disc.getWorldPosition(),c=b.clone().project(a);c.y*=-1;var d=this.newBillboardOrientation(c);if(d!==this.boardOrientation){this.billboard.style.transform=this.billboard.style.webkitTransform="",this.billboard.classList.remove("tag-container-"+this.boardOrientation),this.billboard.classList.add("tag-container-"+d);var e=window.getComputedStyle(this.billboard);this.billboard.initialTransform=e.transform||e.webkitTransform,"none"===this.billboard.initialTransform&&(this.billboard.initialTransform="");var f=window.getComputedStyle(this.billboard).transform.slice(7,-1).split(","),g=-f[4],i=-f[5];this.billboard.style.webkitTransformOrigin=g+"px "+i+"px",this.billboard.style.transformOrigin=g+"px "+i+"px",this.boardOrientation=d}var j=new h.Vector3(-this.discScale/2,0,0).applyQuaternion(a.quaternion).add(b).project(a),l=Math.abs(c.x-j.x)*window.innerWidth,m=Math.sqrt(l/40)*k.mattertags.boardScale.boardToDiscRatio,n={x:(c.x+1)*window.innerWidth/2,y:(c.y+1)*window.innerHeight/2};this.billboard.screenTransform=this.billboard.initialTransform+" translate("+n.x+"px, "+n.y+"px) scale("+m*this.animationScale+")",this.billboard.style.webkitTransform=this.billboard.screenTransform,this.billboard.style.transform=this.billboard.screenTransform,this.type!==u.IFrame&&this.type!==u.ImageTextAudio||(this.billboard.screenTransform=this.billboard.initialTransform+" translate("+n.x+"px, "+n.y+"px) scale(0)",this.billboard.style.visibility="hidden")},e.prototype.animateBoard=function(a,b){this.boardState===C.OPENING?($(".tag-container").show(),p.cancel(this.boardTransition),j.detectSamsungNative()?(this.boardOrientation=null,this.billboard.style.visibility="visible",this.emit("tag.opened"),this.boardState=C.OPEN,a&&a()):(this.billboard.style.webkitTransform="scale(0)",this.billboard.style.transform="scale(0)",this.billboard.style.visibility="visible",this.boardTransition=p.start(q.property(this,"animationScale",1),k.mattertags.animation.animInTime,function(){this.emit("tag.opened"),this.boardState=C.OPEN,a&&a()}.bind(this)))):this.boardState===C.CLOSING&&(p.cancel(this.boardTransition),this.boardTransition=p.start(q.property(this,"animationScale",0),k.mattertags.animation.animOutTime,function(){this.emit("tag.closed"),this.boardState=C.CLOSED,this.billboard.style.visibility="hidden",this.billboard.classList.contains("has-hotzone")||this.billboard.classList.add("has-hotzone"),b&&b()}.bind(this)))},b.exports=e}).call(this,"/js/mattertag/Mattertag.js")},{"../analytics":2,"../conf":7,"../enum/Colors":18,"../enum/LinkType":27,"../enum/MediaType":29,"../enum/RenderOrder":39,"../enum/TagPicType":42,"../enum/TagType":44,"../enum/Viewmode":51,"../gui/offLine":70,"../objects/Panorama":113,"../util/browser":142,"../util/common":145,"../util/easing":147,"../util/img":151,"../util/lerp":152,"../util/logger":153,"../util/statistic_utils":158,"../util/swiper":160,"../util/texture":161,"../util/transitions":162,events:170,three:177}],98:[function(a,b,c){(function(c){"use strict";function d(){this.tagState=n.IDLE,this.intersectTag=null,this.hoveredTag=null,this.activeTag=null,this.mattertagDiscs=[],this.raycaster=new e.Raycaster,this.modelManager=null,this.player=null,this.director=null,this.totalMattertags=0,this.lastAudioTag=null,this.hide360TagForce="",this.activeWeather=!1}var e=a("three"),f=a("../util/logger"),g=a("../util/common"),h=a("../conf"),i=(a("../enum/Viewmode"),a("../enum/WarpStyle")),j=a("../enum/BlackoutStyle"),k=a("../enum/ModelManagerEvents"),l=a("../enum/MattertagEvents"),m=a("../enum/PlayerEvents"),n=(a("../util/lerp"),a("../enum/TagStates")),o=a("events").EventEmitter,p=a("../enum/TagType"),q=a("../gui/gui"),r=a("../util/browser");new f(c),g.extend(d,o),d.prototype.init=function(a,b,c){this.modelManager=a,this.player=b,this.director=c,this.updateModel(),this.bindEvents();var d=this;$("#iframe-close, .help_back").click(function(){$("#iframeBox, #iframe-close").attr("class",""),document.getElementsByClassName("iframe-open")[0].src="about:blank",$("#iframe-parent, #iframe-close, .help_back").fadeOut(300),d.dismissExaminedTag()}),$(".closeTagContainer").on("click",function(){$(".pctagcontainer").fadeOut(300,function(){$(".moreImages").remove()}),setTimeout(function(){$(".imageCon").attr("src","").removeClass("longimgCon highimgCon commimgCon"),$(".topimg").removeClass("topimgCss")},300),d.dismissExaminedTag()}),$(".tag360Close").on("click",function(){$(".object360Tag").fadeOut(300,function(){$("#tag360pic").spritespin("destroy"),$("#tag360pic").html(""),$("#tag360pic").attr("style","")}),setTimeout(function(){},300),d.dismissExaminedTag()}),$("#close_btn").on("click",function(){$("#shopTab").hasClass("opened")&&q.scrollAllShop(),$("#commodityTag").fadeOut(300,function(){var a=document.getElementById("commodity_video"),b=document.getElementById("commodity_audio");b.src.indexOf(".mp3")>0&&b.pause(),a.src.indexOf(".mp4")>0&&a.pause()}),d.dismissExaminedTag()}),$(".closeCommodityTag").on("click",function(){$("#shopTab").hasClass("opened")&&q.scrollAllShop(),$("#commodityTag").fadeOut(300,function(){var a=document.getElementById("commodity_video"),b=document.getElementById("commodity_audio");b.src.indexOf(".mp3")>0&&b.pause(),a.src.indexOf(".mp4")>0&&a.pause()}),d.dismissExaminedTag()}),this.hasroom=!1},d.prototype.update=function(a){this.updateTags(this.player.mode,this.player.camera,this.player.currentPano,this.player.flying)},d.prototype.updateTags=function(a,b,c,d){for(var e in this.model.mattertags)this.model.mattertags[e].update(a,b,c,d,this.show360TagPanoId)},d.prototype.updateModel=function(){this.model=this.modelManager.getActiveModel(),this.getMattertagsFromModel(),this.totalMattertags=Object.keys(this.model.mattertags).length},d.prototype.getMattertagsFromModel=function(){this.mattertagDiscs=[];for(var a in this.model.mattertags){var b=this.model.mattertags[a].disc;b&&this.mattertagDiscs.push(b)}},d.prototype.bindEvents=function(){this.modelManager.on(k.ActiveModelChanged,this.updateModel.bind(this)),this.player.on(m.ModeChanging,this.onPlayerModeChanging.bind(this)),this.player.on(m.Move,this.onPlayerMove.bind(this)),this.player.on(m.Ready,this.onPlayerReady.bind(this)),this.player.on(m.FlyingEnded,this.onPlayerFlyingEnded.bind(this)),this.player.on(m.WarpStarted,this.handleWarpStart.bind(this)),this.player.on(m.WarpInterrupted,this.handleWarpInterruption.bind(this))},d.prototype.handleWarpStart=function(a,b,c,d){this.dismissExaminedTag(),b===i.BLACK&&(d=d||h.warp.teleportTime,a&&(c=j.END),this.hideShowTagsForBlackoutStyle(c,d))},d.prototype.handleWarpInterruption=function(a,b,c){c=c||h.warp.teleportTime,this.hideShowTagsForBlackoutStyle(b,c)},d.prototype.hideShowTagsForBlackoutStyle=function(a,b){var c=0,d=0,e=b/2;switch(null!==a&&void 0!==a||(a=j.MIDDLE),a){case j.END:this.hideAllMattertags(e);break;case j.BEGINNING:this.hideAllMattertags().done(this.showAllMattertags.bind(this,e));break;case j.NONE:break;case j.MIDDLE:c=e,d=e,this.hideAllMattertags(d),setTimeout(function(){this.showAllMattertags(c)}.bind(this),d);break;case j.FADEIN:setTimeout(function(){this.showAllMattertags(e)}.bind(this),e)}},d.prototype.onPlayerModeChanging=function(){this.dismissExaminedTag()},d.prototype.onPlayerMove=function(){this.dismissExaminedTag(!0)},d.prototype.onPlayerReady=function(a,b,c){this.startAllMattertags(a,b?c:null)},d.prototype.onPlayerFlyingEnded=function(a,b,c){this.updateClosestTags(a),console.log("飞行完毕")},d.prototype.dismissExaminedTag=function(a){a&&this.activeTag&&this.activeTag.type===p.Audio||(this.activeTag&&this.tagState===n.EXAMINE&&this.dismissActiveTag(),this.hoveredTag&&(this.hoveredTag.setFreeState(!0),this.hoveredTag=null))},d.prototype.startAllMattertags=function(a,b){this.model.shouldShowMattertags=h.mattertags.enabled,a||(this.showAllMattertags(h.mattertags.startup.fadeInDuration,h.mattertags.startup.fadeInDelay),b&&setTimeout(function(){this.activateTag(this.model.getTagByIdx(b))}.bind(this),h.mattertags.startup.fadeInDuration/2))},d.prototype.showAllMattertags=function(a,b){function c(){++e===this.totalMattertags&&(this.model.tagsShown=!0,d.resolve())}var d=$.Deferred(),e=0;if(!this.model.shouldShowMattertags)return d.resolve().promise();for(var f in this.model.mattertags){var g=this.model.mattertags[f];12!==g.type&&g.show(a,b).done(c.bind(this))}return this.showtitletags=!0,this.updateTitleTags(),d.promise()},d.prototype.updateTitleTags=function(){if(!this.showtitletags||!G.titletags||"panorama"!==G.player.mode)return void $(".viewport-tag").css("display","none");var a,b,c=G.player.camera.clone();this.ttagsshow=[],this.ttagshide=[];for(var d=0;d<G.titletags.length;d++)if(G.player&&G.player.currentPano&&2===G.player.currentPano.alignmentType)this.ttagsshow.push(G.titletags[d]);else if("dollhouse"!==G.player.mode&&"floorplan"!==G.player.mode)if(this.hasroom)!function(a){return!(!G.player.currentPano||!G.model.panos.index[a.locationId]||G.player.currentPano.roomid!==G.model.panos.index[a.locationId].roomid)}(G.titletags[d])?this.ttagshide.push(G.titletags[d]):this.ttagsshow.push(G.titletags[d]);else{if(a=G.titletags[d].position,(b=a.clone().distanceTo(c.position))<=h.titletagMaxdistance){var f=new e.Raycaster(c.position,c.position.clone().sub(a).normalize()),g=f.intersectObjects(G.model.colliders);if(console.log("dis:"+b),console.log(g.length),g.length?(console.log(d+"objs1:"+(g[0].distance-b)),setTimeout(function(){G.player.mattertagManager.wtposition()},1e3)):console.log(d+"objs0"),!g.length||g[0].distance-b>-1){this.ttagsshow.push(G.titletags[d]);continue}}this.ttagshide.push(G.titletags[d])}else this.ttagshide.push(G.titletags[d]);this.ttposition()},d.prototype.ttposition=function(){if(!this.ttagsshow)return!1;for(var a=G.player.camera.clone(),b=a.getWorldDirection(),c=0;c<this.ttagsshow.length;c++){var d=this.ttagsshow[c],e=d.position;if(e.clone().sub(a.position).normalize().angleTo(b)>Math.PI/2)$("#titletag"+d.i).css("display","none");else{var f=e.clone().project(a),g=(f.x+1)/2*100,h=(1-f.y)/2*100;$("#titletag"+d.i).css({display:"",left:g+"%",top:h+"%"})}}for(var c=0;c<this.ttagshide.length;c++)$("#titletag"+this.ttagshide[c].i).css("display","none")},d.prototype.wtposition=function(a){var b,c,d=G.player.camera.clone();if(this.wtagsshow=[],this.wtagshide=[],a){this.activeWeatherTag=a;var f=g.convertWorldPositionToScreen(a.disc.getWorldPosition(),d),i=a.data.width,j=a.data.height;document.body.clientWidth<=i&&(i=document.body.clientWidth-50),$("#weather_tag").attr("src",a.data.details.url).css({width:i+"px",height:j+"px",transform:"translate(-50%,-110%)",left:f.x+"px",top:f.y+"px"}).attr("tagindex",a.i).show()}else{for(var k=0;k<G.weathertags.length;k++){if(b=G.weathertags[k].disc.getWorldPosition(),(c=b.clone().distanceTo(d.getWorldPosition()))<=h.weathertagMaxdistance){var l=new e.Raycaster(d.getWorldPosition(),G.weathertags[k].disc.getWorldPosition().sub(d.getWorldPosition()).normalize()),m=l.intersectObjects(G.model.colliders);if(!m.length||m[0].distance-c>-1){G.weathertags[k].closeWeather||this.wtagsshow.push(G.weathertags[k]);continue}}this.wtagshide.push(G.weathertags[k])}if(this.wtagsshow!=[]){var n,o,p,q=d.getWorldDirection().normalize(),r=new e.Vector3,s=new e.Vector3;s=q.clone();for(var k=0;k<this.wtagsshow.length;k++){p=this.wtagsshow[k];var b=p.disc.getWorldPosition();r=b.clone().sub(d.getWorldPosition()).normalize();var t=Math.acos(r.dot(s));n?t>=0&&t<o&&(n=p,o=t):(n=p,o=t)}if(o<Math.PI/5){n!==this.activeWeatherTag&&$("#weather_tag").attr("src",n.data.details.url),this.activeWeatherTag=n;var b=n.position,f=g.convertWorldPositionToScreen(n.disc.getWorldPosition(),d),i=n.data.width,j=n.data.height;document.body.clientWidth<=i&&(i=document.body.clientWidth-50),console.log(this.activeWeatherTag),$("#weather_tag").css({width:i+"px",height:j+"px",transform:"translate(-50%,-110%)",left:f.x+"px",top:f.y+"px"}).attr("tagindex",n.i).show()}else this.activeWeatherTag=null,this.weatherHide()}}},d.prototype.updateWtposition=function(){var a=G.player.camera.clone(),b=this.activeWeatherTag;if(this.activeWeatherTag){var c=g.convertWorldPositionToScreen(b.disc.getWorldPosition(),a);$("#weather_tag").css({left:c.x+"px",top:c.y+"px"})}},d.prototype.weatherHide=function(){$("#weather_tag").attr("src"," "),$("#weather_tag").hide().attr("tagindex","")},d.prototype.weatherOpenAudioEnd=function(){this.activeTag.type===p.Audio&&(this.pauseAudioTag(0),this.dismissActiveTag())},d.prototype.hideAllMattertags=function(a,b){function c(){++e===this.totalMattertags&&(this.model.tagsShown=!1,d.resolve())}var d=$.Deferred(),e=0;for(var f in this.model.mattertags){var g=this.model.mattertags[f];12!==g.type&&-1!==g.tagid&&-2!==g.tagid&&(g.hide(a,b).done(c.bind(this)),g===this.activeTag&&this.dismissActiveTag())}return d.promise()},d.prototype.update360Tags=function(a){var b=$.Deferred();this.hideAllMattertags(h.mattertags.startup.fadeInDuration);for(var c in this.model.mattertags){var d=this.model.mattertags[c];if(d.type==p.Tag360T1||1===d.subtype){var e=this;setTimeout(function(){e.show360TagPanoId=a},600)}}return b.promise()},d.prototype.hideAllMattertagsExceptType=function(a,b,c){function d(){++f===this.totalMattertags&&(this.model.tagsShown=!1,e.resolve())}var e=$.Deferred(),f=0;for(var g in this.model.mattertags){var h=this.model.mattertags[g];h.type!==a&&(h.hide(b,c).done(d.bind(this)),h===this.activeTag&&this.dismissActiveTag())}return e.promise()},d.prototype.activateTag=function(a,b){b=b||n.EXAMINE,this.activeTag=a,"panorama"===this.player.mode&&(this.activeTag.type===p.IFrame||this.activeTag.type===p.ImageText||this.activeTag.type===p.ImageTextAudio||this.activeTag.type===p.Video||this.activeTag===p.IKEA?document.getElementsByTagName("html").item(0).style.cursor="default":this.activeTag.type===p.Tag360T1||(document.getElementsByTagName("html").item(0).style.cursor="default",(this.activeTag.type!=p.TextOnly&&this.activeTag!==p.TextAudio||void 0!=this.activeTag.label&&""!=this.activeTag.label)&&(this.activeTag.type==p.TagTo360||this.activeTag.type==p.Tag360||this.activeTag.type==p.Commodity||this.activeTag.setHoverState(b===n.EXAMINE)))),this.tagState=b,this.emit(l.TagActivated,a)},d.prototype.activateAudioTag=function(a,b,c){b=b||n.EXAMINE,this.activeTag=a,this.activeTag.setHoverState(b===n.EXAMINE,c),this.tagState=b,this.emit(l.TagActivated,a)},d.prototype.activateOtherModelTag=function(a,b,c){b=b||n.EXAMINE,this.activeTag=a,this.activeTag.setHoverState(b===n.EXAMINE,c),this.tagState=b,this.emit(l.TagActivated,a)},d.prototype.dismissActiveTag=function(a){if(null!==this.activeTag){a?this.lastAudioTag&&this.lastAudioTag.setFreeState(!0,!0):this.activeTag.setFreeState(!0);var b=this.activeTag;this.activeTag=null,this.tagState=n.IDLE,this.emit(l.TagDismissed,b)}},d.prototype.dismissAudioActiveTag=function(){if(null!=this.activeTag){var a=this.activeTag;this.lastAudioTag.setFreeState(!0,!0),this.activeTag=null,this.tagState=n.IDLE,this.emit(l.TagDismissed,a)}},d.prototype.pauseAudioTag=function(a){null!=this.lastAudioTag&&this.lastAudioTag.setFreeState(!0,!0,a)},d.prototype.openTag=function(a,b,c){a&&(this.activeTag=a,this.tagState=n.EXAMINE,a.setHoverState(!0,0),b&&b>=0&&(this.toid=setTimeout(function(){this.closeTag(),c&&c()}.bind(this),b)))},d.prototype.closeTag=function(){$(".pctagcontainer").fadeOut(300),$("#iframe-parent").css("display","none"),$(".help_back").css("display","none"),this.dismissExaminedTag(),this.activeTag&&(this.activeTag.setClosedState(),this.activeTag.boardState=BoardState.CLOSED,this.activeTag=null),this.tagState=n.IDLE},d.prototype.clickedOnTag=function(a,b,c){var d=this;if(this.intersectTag.type===p.BuildingType)return c.stopPropagation(),!0;if(this.intersectTag.type===p.PanoVideo){if(c.stopPropagation(),console.log("clickedOnTag--this.intersectTag",this.intersectTag),h.isNewEditVersion){var f=window.parent.location.href;console.log(f),f.indexOf(".cn")>0&&($("#closePanoVideoTag").html("关闭"),$("#savePanoVideoTag").html("保存")),f.indexOf(".cn/en/")>0&&($("#closePanoVideoTag").html("Close"),$("#savePanoVideoTag").html("Save"))}var g=document.getElementById(this.intersectTag.tagid);if(g&&(g.muted=!1,g.play(),this.intersectTag.materialsPanoVideoTag.free=this.intersectTag.materialsPanoVideoTag.videofree,console.log("panoVideo--muted",g.muted),console.log("this.tagState",this.tagState),this.intersectTag.isClickAgain||(this.intersectTag.isClickAgain=!0,setTimeout(function(){this.tagState=n.EXAMINE,a=!0,d.clickedOnTag(a,b,c)},500)),b.mattertagManager.updateModel()),window.intersectTag=this.intersectTag,console.log("panoVideo--intersectTag.data.base",window.intersectTag.data.base),h.isNewEditVersion&&0!=window.intersectTag.data.base.x){$("#panoVideoFormDIVBG").css({display:"flex"}).show(100),$("#panoVideoFormDIV").css({top:c.pageY-50+"px",left:c.pageX+50+"px",display:"flex","flex-direction":"column"}).show(500),window.xmediaHandle=$("#pano-x-handle"),window.xmediaHandle.text(window.intersectTag.data.base.x),$("#x-pano-slider").slider({min:-40,max:40,value:window.intersectTag.data.base.x,step:1e-16,animate:!0,create:function(){window.xmediaHandle.text(window.intersectTag.data.base.x)},slide:function(a,c){window.xmediaHandle.text(c.value),window.intersectTag.obj3d.position.x=parseFloat(""+c.value),b.mattertagManager.updateModel()}}),window.ymediaHandle=$("#pano-y-handle"),window.ymediaHandle.text(window.intersectTag.data.base.y),$("#y-pano-slider").slider({min:-40,max:40,value:window.intersectTag.data.base.y,step:1e-16,create:function(){window.ymediaHandle.text($(this).slider("value"))},slide:function(a,c){window.ymediaHandle.text(c.value),window.intersectTag.obj3d.position.y=parseFloat(""+c.value),b.mattertagManager.updateModel()}}),window.zmediaHandle=$("#pano-z-handle"),window.zmediaHandle.text(window.intersectTag.data.base.z),$("#z-pano-slider").slider({min:-40,max:40,value:window.intersectTag.data.base.z,step:1e-16,create:function(){window.zmediaHandle.text($(this).slider("value"))},slide:function(a,c){window.zmediaHandle.text(c.value),window.intersectTag.obj3d.position.z=parseFloat(""+c.value),b.mattertagManager.updateModel()}}),window.smediaHandle=$("#pano-scale-handle"),window.smediaHandle.text(window.intersectTag.data.details.media_scale),$("#scale-pano-slider").slider({min:.1,max:20,value:window.intersectTag.data.details.media_scale,step:.1,create:function(){window.smediaHandle.text($(this).slider("value"))},slide:function(a,c){window.smediaHandle.text(c.value),window.intersectTag.obj3d.scale.set(parseFloat(""+c.value),parseFloat(""+c.value),parseFloat(""+c.value)),
b.mattertagManager.updateModel()}}),window.click_time=0,console.log("click--save",window.click_time),$("#closePanoVideoTag").on("click",function(){$("#panoVideoFormDIV").hide(),$("#panoVideoFormDIVBG").hide();for(var a=b.camera.parent.children,c=0;c<a.length;c++)if(a[c]instanceof e.AxisHelper){b.camera.parent.remove(a[c]);break}window.click_time=0}),$("#savePanoVideoTag").on("click",function(){$("#panoVideoFormDIV").hide(),$("#panoVideoFormDIVBG").hide();for(var a=b.camera.parent.children,c=0;c<a.length;c++)if(a[c]instanceof e.AxisHelper){b.camera.parent.remove(a[c]);break}console.log("click--save",window.click_time),1!=window.click_time&&(console.log("click--save--tagid",window.intersectTag.tagid),window.parent.NestP.savePanoVideo(window.xmediaHandle.text(),window.ymediaHandle.text(),window.zmediaHandle.text(),window.smediaHandle.text(),window.intersectTag.tagid),window.click_time=1)});for(var i=b.camera.parent.children,j=0;j<i.length;j++)if(i[j]instanceof e.AxisHelper){b.camera.parent.remove(i[j]);break}var k=new e.AxisHelper(1);k.position.set(window.intersectTag.obj3d.position.x+.01,window.intersectTag.obj3d.position.y,window.intersectTag.obj3d.position.z),b.camera.parent.add(k),b.mattertagManager.updateModel()}if(!r.isMobile())return!0}if(this.intersectTag.type===p.TagTo360||this.intersectTag.type===p.Tag360T1){if(c.stopPropagation(),this.director){var m=function(a){var b=-1;for(var c in d.player.model.images.list)d.player.model.images.list[c].sceneid==a&&(b=c);return b}(this.intersectTag.tagInfoUrl);-1===m&&(m=0),q.gotoFrom360(m),this.director.goToHighlight(m)}return!0}if(!(this.intersectTag.type!=p.TextOnly&&this.intersectTag!==p.TextAudio||void 0!=this.intersectTag.label&&""!=this.intersectTag.label))return!0;if(this.intersectTag.type==p.Pano)return!0;if(this.intersectTag.type!==p.WeatherTag||r.isIe.versions.trident||r.isEdge.versions.Edge?this.intersectTag.i===$("#weather_tag").attr("tagindex")||r.isIe.versions.trident||r.isEdge.versions.Edge||(this.activeWeatherTag=null,G.WeatherGo=!0,this.weatherHide()):$("#weather_tag").attr("tagindex")&&this.intersectTag.i==$("#weather_tag").attr("tagindex")?(this.activeWeatherTag=null,this.intersectTag.closeWeather=!0,this.weatherHide()):(this.intersectTag.closeWeather=!1,this.wtposition(this.intersectTag)),!a)return this.tagState!==n.EXAMINE?(this.intersectTag.type===p.Audio?(null==this.lastAudioTag&&(this.lastAudioTag=this.intersectTag),this.intersectTag.i==this.lastAudioTag.i?"active"==this.intersectTag.boardState?this.dismissActiveTag(!0):this.intersectTag.setHoverState(!0,1):(this.dismissActiveTag(!0),this.intersectTag.setHoverState(!0,0),this.lastAudioTag=this.intersectTag)):(this.pauseAudioTag(),this.dismissActiveTag(!0),this.intersectTag.type===p.Commodity||this.intersectTag.type===p.Tag360||this.intersectTag.type===p.OtherModel||this.intersectTag.type===p.IFrame||this.intersectTag.type===p.ImageText||this.intersectTag.type===p.ImageTextAudio||this.intersectTag.type===p.TextOnly||this.intersectTag.type===p.TextAudio||this.intersectTag===p.IKEA?(this.intersectTag.type===p.ImageTextAudio||this.intersectTag.type===p.TextAudio||(this.intersectTag.type,p.ImageTextAudio),this.intersectTag.setHoverState(!0,0)):this.intersectTag.setHoverState(!0)),this.activeTag=this.intersectTag,(this.intersectTag.type!==p.IFrame&&this.intersectTag.type!==p.ImageText&&this.intersectTag.type!==p.ImageTextAudio||this.intersectTag!==p.IKEA)&&this.activeTag.examineMattertag(this.player,this.activateTag.bind(this)),this.tagState=n.EXAMINE,console.log(this),this.emit(l.TagNavigation,this.activeTag),!0):(this.dismissActiveTag(!0),!1);if(this.tagState===n.IDLE)return this.intersectTag.type===p.Audio?(null==this.lastAudioTag&&(this.lastAudioTag=this.intersectTag),this.intersectTag.i==this.lastAudioTag.i?this.activateAudioTag(this.intersectTag,n.EXAMINE,1):(this.dismissAudioActiveTag(),this.lastAudioTag=this.intersectTag,this.activateAudioTag(this.intersectTag,n.EXAMINE,0))):(this.pauseAudioTag(),this.dismissActiveTag(),this.intersectTag.type===p.Commodity||this.intersectTag.type===p.Tag360||this.intersectTag.type===p.OtherModel||this.intersectTag.type===p.IFrame||this.intersectTag.type===p.ImageText||this.intersectTag.type===p.ImageTextAudio||this.intersectTag.type===p.Video||this.intersectTag.type===p.TextOnly||this.intersectTag.type===p.TextAudio||this.intersectTag===p.IKEA?this.activateOtherModelTag(this.intersectTag,n.EXAMINE,0):this.activateTag(this.intersectTag,n.EXAMINE));if(this.tagState===n.EXAMINE)return this.intersectTag!==this.activeTag?this.intersectTag.type===p.Audio?(this.pauseAudioTag(),this.dismissActiveTag(),this.lastAudioTag=this.intersectTag,this.activateAudioTag(this.intersectTag,n.EXAMINE,1)):(this.pauseAudioTag(),this.dismissActiveTag(),this.intersectTag.type===p.Commodity||this.intersectTag.type===p.Tag360||this.intersectTag.type===p.OtherModel||this.intersectTag.type===p.IFrame||this.intersectTag.type===p.ImageText||this.intersectTag.type===p.ImageTextAudio||this.intersectTag===p.IKEA?this.activateOtherModelTag(this.intersectTag,n.EXAMINE,0):this.activateTag(this.intersectTag,n.EXAMINE)):this.intersectTag.type===p.Audio?(this.pauseAudioTag(),this.dismissActiveTag(),!1):(this.dismissActiveTag(),this.intersectTag.type!==p.Commodity&&this.intersectTag.type!==p.Tag360&&this.intersectTag.type!==p.ImageText&&this.intersectTag.type!==p.ImageTextAudio&&this.intersectTag!==p.IKEA||this.intersectTag.label||this.intersectTag.data.details.description||this.intersectTag.tagInfoUrl||this.activateOtherModelTag(this.intersectTag,n.EXAMINE,0),!1);if(this.tagState===n.BROWSE){if(this.intersectTag.type!==p.Audio)return this.pauseAudioTag(),this.dismissActiveTag(),this.intersectTag.type===p.Commodity||this.intersectTag.type===p.Tag360||this.intersectTag.type===p.OtherModel||this.intersectTag.type===p.IFrame||this.intersectTag.type===p.ImageText||this.intersectTag.type===p.ImageTextAudio||this.intersectTag===p.IKEA?this.activateOtherModelTag(this.intersectTag,n.EXAMINE,0):this.activateTag(this.intersectTag,n.EXAMINE);this.intersectTag.i==this.lastAudioTag.i?(this.pauseAudioTag(),this.dismissActiveTag()):(this.pauseAudioTag(),this.lastAudioTag=this.intersectTag,this.intersectTag.setHoverState(!0,0))}},d.prototype.disposeCursorFor360=function(a){a&&a.type===p.Tag360T1?document.getElementsByTagName("html").item(0).style.cursor="pointer":document.getElementsByTagName("html").item(0).style.cursor="default"},d.prototype.intersectMattertag=function(){var a=new e.Vector3,b=new e.Vector3,c=new e.Vector3;return function(d,e,f){var g=null,i=this.mattertagDiscs.filter(function(a){return a.parent.visible});if(i.length>0){var j=this.model.floors.reduce(function(a,b){return b.hidden?a:a.concat(b.collider.children)},i);a.set(d.x,d.y,-1).unproject(f),b.set(d.x,d.y,1).unproject(f),c.copy(b).sub(a).normalize(),this.raycaster.set(a,c);var k=this.raycaster.intersectObjects(j);j=null,k.length>0&&-1!==i.indexOf(k[0].object)&&(k[0].object.tag.type||h.isNewEditVersion)&&(g=k[0].object.tag,g.i>=1e4&&(g=G.model.mattertags[g.i-1e4]))}return this.intersectTag=g,this.disposeCursorFor360(g),e&&(this.activeTag&&g!==this.activeTag&&(this.tagState===n.BROWSE||this.tagState===n.EXAMINE&&g)&&this.dismissActiveTag(),g&&g!==this.activeTag&&(g.listeners("enter").length<1&&(g.on("enter",function(a){this.hoveredTag=a}.bind(this)),g.on("leave",function(a){this.hoveredTag=null}.bind(this))),this.activateTag(g,n.BROWSE))),g}}(),d.prototype.rankedMattertagInDirection=function(){var a=[],b=[],c=new e.Vector3,d=new e.Vector3,f=new e.Vector3;return function(e,g,h,i){var j=0;b.length=0;for(var k=0;k<this.closestMattertags.length;k++){var l=this.closestMattertags[k];d.copy(l.position),d.add(l.discPosition),c.copy(g),c.sub(d).negate(),c.normalize();var m=c.dot(i);if(m>=0){f.copy(d),f.project(h);if(this.intersectMattertag(f,!1,h)){if(j>=a.length)for(var n=0;n<64;n++)a.push({tag:l,dot:m});var o=a[j];o.tag=l,o.dot=m,o.position=math.projectPositionToCanvas(d,h),b.push(o),j++}}}return b.sort(function(a,b){return a.dot>b.dot?-1:a.dot<b.dot?1:0}),e<b.length?b[e].tag:null}}(),d.prototype.updateClosestTags=function(){var a=new e.Vector3;return function(b){this.closestMattertags||(this.closestMattertags=[]),this.closestMattertags.length=0;var c=this.model.mattertags;if(c)for(var d in c)if(c.hasOwnProperty(d)){if(d>=1e4)return;var e=c[d],f=e.position;a.copy(b),a.sub(f).negate();var g=a.lengthSq();12!==e.type&&g<30&&this.closestMattertags.push(e)}}}(),b.exports=d}).call(this,"/js/mattertag/MattertagManager.js")},{"../conf":7,"../enum/BlackoutStyle":17,"../enum/MattertagEvents":28,"../enum/ModelManagerEvents":30,"../enum/PlayerEvents":38,"../enum/TagStates":43,"../enum/TagType":44,"../enum/Viewmode":51,"../enum/WarpStyle":52,"../gui/gui":64,"../util/browser":142,"../util/common":145,"../util/lerp":152,"../util/logger":153,events:170,three:177}],99:[function(a,b,c){(function(c){"use strict";var d=a("../util/logger"),e=(new d(c),{parseIdsFromChunkName:function(a,b){b.floorId=e.parseFloor(a),b.roomId=e.parseRoom(a)},parseFloor:function(a){var b,c=a.match(/block_([0-9]+)/);if(!c)return 0;try{b=parseInt(c[1],10)}catch(a){return 0}return this.getfid(b)},getfid:function(a){for(var b=G.settings.building.blocks,c=b.length||0,d=0;d<c;d++)if(b[d].blockidx===a)return b[d].flooridx;return 0},getflooridx:function(){for(var a=G.model.chunks,b=0;b<a.length;b++)if(G.model.chunks[b].id===G.interchunkid)return this.getfid(b);return 0},getrid:function(a){for(var b=G.settings.building.blocks,c=b.length||0,d=0;d<c;d++)if(b[d].blockidx===a)return b[d].roomidx;return 0},parseRoom:function(a){var b,c=a.match(/block_([0-9]+)/);if(!c)return 0;try{b=parseInt(c[1],10)}catch(a){return 0}return this.getrid(b)}});b.exports=e}).call(this,"/js/model/Chunks.js")},{"../util/logger":153}],100:[function(a,b,c){(function(c){"use strict";function d(a){h.call(this),this.model=a,this.exploded=!1}var e=a("../objects/Floor"),f=(a("../conf"),a("../util/logger")),g=a("../util/transitions"),h=a("../util/IndexedCollection"),i=a("../util/common"),j=a("../util/easing");new f(c),i.inherit(d,h),d.prototype.add=function(a){h.prototype.add.call(this,a),this.model.add(a)},d.prototype.getIndex=function(a){return a.floorIndex},d.prototype.build=function(){this.list.forEach(function(a){a.build()})},d.prototype.size=function(){return this.length},d.prototype.sort=function(){h.prototype.sort.call(this,function(a,b){return a.floorIndex-b.floorIndex})},d.prototype.nextFloor=function(a,b){return this.index[a.floorIndex+b]||null},d.prototype.getFloorAtPoint=function(a){for(var b=null,c=1/0,d=0;d<this.list.length;d++){var e=this.list[d],f=e.distanceToPoint(a);(!b||c>f)&&(c=f,b=e)}return b},d.prototype.getOrMakeFloor=function(a){var b=this.index[a],c=this.model.buildFloors;if(!b){var d=null;c.floors&&c.floors[a]&&(d=c.floors[a].name),b=new e(this.model,a,d),this.add(b)}return b},d.prototype.hide=function(){this.list.forEach(function(a){a.hide()})},d.prototype.show=function(){this.list.forEach(function(a){a.show()})},d.prototype.names=function(){return this.list.reduce(function(a,b){return a.concat(b.name)},[])},d.prototype.toggleExplodeHorizontal=function(){function a(a,b){a.position.x=c[a.floorIndex]*b,a.position.y=1*a.floorIndex*b}var b,c=[],d=0;this.list.forEach(function(a,e,f){b=e>0?Math.max(f[e-1].boundingBox.max.x-a.boundingBox.min.x,a.boundingBox.size().x/2):0,d+=b,c[e]=d}),c=c.map(function(a){return a-d/2}),this.exploded?this.list.forEach(function(b){g.start(function(c){a(b,1-c)}.bind(this),1500,null,0,j.easeOutExpo)}.bind(this)):this.list.forEach(function(b){g.start(function(c){a(b,c)}.bind(this),1500,null,0,j.easeOutExpo)}.bind(this)),this.exploded=!this.exploded},d.prototype.toggleExplodeVertical=function(){function a(a,c){a.position.y=(5*a.floorIndex-b.y/2)*c,a.panos.forEach(function(b){b.position.y=b.origin.y+a.position.y,b.skyboxMesh.position.y=b.origin.y+a.position.y})}var b=this.model.size;this.exploded?this.list.forEach(function(b){g.start(function(c){a(b,1-c)},1500,null,0,j.easeOutExpo)}):this.list.forEach(function(b){g.start(function(c){a(b,c)},1500,null,0,j.easeOutExpo)}),this.exploded=!this.exploded},b.exports=d}).call(this,"/js/model/FloorCollection.js")},{"../conf":7,"../objects/Floor":110,"../util/IndexedCollection":134,"../util/common":145,"../util/easing":147,"../util/logger":153,"../util/transitions":162}],101:[function(a,b,c){(function(c){"use strict";function d(){j.call(this)}var e=a("../conf"),f=a("../util/logger"),g=a("../enum/Viewmode"),h=a("../objects/Snapshot"),i=(a("../util/math"),a("../util/common")),j=a("../util/IndexedCollection"),k=new f(c);i.inherit(d,j),d.prototype.getbg=function(){for(var a=0;a<this.list.length;a++)if(this.list[a].init_point)return this.list[a];return null},d.prototype.filterByModesAndReel=function(a,b){for(var c,d=a[g.DOLLHOUSE],e=a[g.FLOORPLAN],f=[],h=0;h<b.length;h++)c=this.index[b[h].sceneid],0==h&&(c.isHero=!0),c&&f.push(c);f=f.filter(function(a){var b;if(a._camera&&void 0!==a._camera._type){try{b=g.convertWorkshopModeInt(a._camera._type)}catch(a){return void k.debug(a.message)}return b===g.PANORAMA||b===g.FLOORPLAN&&e||b===g.DOLLHOUSE&&d}}),f.length!==this.list.length&&(k.info("Disallowed "+(this.list.length-f.length)+" highlight images"),this.list=f,this.reIndex()),this.list=f,this.reIndex()},d.prototype.getHeroLocations=function(a){var b=[],c=!1;if(0===this.list.length)return[];for(var f=0;f<this.list.length;++f){var i=this.list[f],j=i.shortcuturl,k=i.name;if(i.script=i.script?i.script:0,i._camera&&void 0!==i._camera._rotation){if(!e.show360Views.enabled&&i._camera._locationid){var l=a.get(i._camera._locationid);if(l&&!l.isAligned())continue}var m=g.convertWorkshopModeInt(i._camera._type);if(m===g.MESH)continue;var n=new h({cameraMode:m,position:i._camera._viewpoint,quaternion:i._camera._rotation,panoId:i._camera._locationid,orthoZoom:i._camera._zoom,floorVisibility:void 0!==i._camera.floor_visibility?i._camera.floor_visibility.slice(0):[],thumbUrl:j,name:d.filterImageName(k),isHero:i.init_point,script:i.script});b.push(n),c=c||i.init_point}}return b.length>0&&!c&&(b[0].isHero=!0),b},d.prototype.getIndex=function(a){return a.sceneid},d.filterImageName=function(a){return""===a||a.match(/^[0-9.]+_[0-9.]+$/)?null:a},b.exports=d}).call(this,"/js/model/ImageCollection.js")},{"../conf":7,"../enum/Viewmode":51,"../objects/Snapshot":118,"../util/IndexedCollection":134,"../util/common":145,"../util/logger":153,"../util/math":154}],102:[function(a,b,c){(function(c){"use strict";function d(a,b){G.model=this,b.floors="",g.Object3D.call(this),this.modelid=b.basic.model.modelid;var c=b.basic;if(p.isLocalVersion){if(b.nestscenes&&b.nestscenes.backgroundimgurl&&-1===b.nestscenes.backgroundimgurl.indexOf("background.")){var d=b.nestscenes.backgroundimgurl.split("resources");if(d.length>1){var h="play/data/"+c.model.modelid+"/resources"+d[d.length-1];b.nestscenes.backgroundimgurl=h}}if(b.nestscenes&&b.nestscenes.backgroundmobileimgurl&&-1===b.nestscenes.backgroundmobileimgurl.indexOf("background.")){var j=b.nestscenes.backgroundmobileimgurl.split("resources");if(j.length>1){var l="play/data/"+c.model.modelid+"/resources"+j[j.length-1];b.nestscenes.backgroundmobileimgurl=l}}if(c.menu&&c.menu.innerimage){var o=c.menu.innerimage.split("resources");if(o.length>1){var q="play/data/"+c.model.modelid+"/resources"+o[o.length-1];c.menu.innerimage=q}}if(c.menu&&!0===c.menu.t_logo_enable&&c.menu.t_logo_url){var r=c.menu.t_logo_url.split("resources");if(r.length>1){var s="play/data/"+c.model.modelid+"/resources"+r[r.length-1];c.menu.t_logo_url=s}}if(c.model.audio&&c.model.audio.url){var u=c.model.audio.url.split("resources");if(u.length>1){var v="play/data/"+c.model.modelid+"/resources"+u[u.length-1];c.model.audio.url=v}}if(b.nesttags.info&&b.nesttags.info.length>0)for(var w=0;w<b.nesttags.info.length;w++)if(null!==b.nesttags.info[w].details&&null!==b.nesttags.info[w].details.tagpicurl){var x=b.nesttags.info[w].details.tagpicurl.split("nesttags");if(x.length>1){var y="play/data/"+c.model.modelid+"/nesttags"+x[x.length-1];b.nesttags.info[w].details.tagpicurl=y}var B=b.nesttags.info[w].details.tagpicurl.split("common/");if(B.length>1){var y=B[B.length-1];b.nesttags.info[w].details.tagpicurl=y}}if(b.nesttags.info&&b.nesttags.info.length>0)for(var C=b.nesttags.info,w=0;w<C.length;w++)if(C[w].details&&C[w].details.imageurl&&C[w].details.imageurl instanceof Array)C[w].details.imageurl.forEach(function(a,b){var d=a.split("nesttags");if(d.length>1){var e="play/data/"+c.model.modelid+"/nesttags"+d[d.length-1];C[w].details.imageurl[b]=e}var f=a.split("common/");if(f.length>1){var e=f[f.length-1];C[w].details.imageurl[b]=e}});else if(C[w].details&&C[w].details.imageurl){var x=C[w].details.imageurl.split("nesttags");if(x.length>1){var y="play/data/"+c.model.modelid+"/nesttags"+x[x.length-1];C[w].details.imageurl=y}var B=C[w].details.imageurl.split("common/");if(B.length>1){var y=B[B.length-1];C[w].details.imageurl=y}}if(b.nesttags.info&&b.nesttags.info.length>0)for(var w=0;w<b.nesttags.info.length;w++)if(b.nesttags.info[w].details&&b.nesttags.info[w].details.audiourl){var x=b.nesttags.info[w].details.audiourl.split("nesttags");if(x.length>1){var y="play/data/"+c.model.modelid+"/nesttags"+x[x.length-1];b.nesttags.info[w].details.audiourl=y}var B=b.nesttags.info[w].details.audiourl.split("common/");if(B.length>1){var y=B[B.length-1];b.nesttags.info[w].details.audiourl=y}}if(b.nesttags.info&&b.nesttags.info.length>0)for(var w=0;w<b.nesttags.info.length;w++)if(b.nesttags.info[w].details&&b.nesttags.info[w].details.videourl){var x=b.nesttags.info[w].details.videourl.split("nesttags");if(x.length>1){var y="play/data/"+c.model.modelid+"/nesttags"+x[x.length-1];b.nesttags.info[w].details.videourl=y}var B=b.nesttags.info[w].details.videourl.split("common/");if(B.length>1){var y=B[B.length-1];b.nesttags.info[w].details.videourl=y}}if(b.nestscenes.scenes&&b.nestscenes.scenes.length>0)for(var w=0;w<b.nestscenes.scenes.length;w++){var x=b.nestscenes.scenes[w].shortcuturl.split("locations");if(x.length>1){var y="play/data/"+c.model.modelid+"/locations"+x[x.length-1];y=y.replace("pc","mobile"),b.nestscenes.scenes[w].shortcuturl=y}}}if(this.data={modelid:c.model.modelid,name:c.model.name,floors:"",image:b.nestscenes.backgroundimgurl&&-1===b.nestscenes.backgroundimgurl.indexOf("background.")?b.nestscenes.backgroundimgurl:"",mobileimg:b.nestscenes.backgroundmobileimgurl&&-1===b.nestscenes.backgroundmobileimgurl.indexOf("background.")?b.nestscenes.backgroundmobileimgurl:"",images:b.nestscenes,player_options:{highlight_reel:!0,tour_buttons:!0,contact_email:!0,address:c.menu.address_enable,contact_name:c.menu.contact_name_enable,presented_by:c.menu.producer_enable,floor_plan:!0,dollhouse:!0,fast_transitions:!1,model_summary:c.menu.description_enable,contact_phone:c.menu.phone_enable,model_name:!0,autoplay:!1,bottom_presented_by:c.menu.bottom_presented_enable,show3d:void 0===c.menu.single_indoor||!c.menu.single_indoor,businessname:c.menu.businessname_enable,innerimage:c.menu.innerimage_enable},camera_start:null,summary:c.menu.description,description_voice_url:c.menu.description_voice_url,presented_by:c.menu.producer,address:c.menu.address,contact_name:c.menu.contact_name,contact_phone:c.menu.phone,contact_email:c.menu.contact_email,bottom_presented_by:c.menu.bottom_presented_by,audio:c.model.audio,businessname:c.menu.businessname,innerimage:c.menu.innerimage,orientations:b.locations.orientations},b.nestrecommends&&0!==b.nestrecommends.models.length){this.moreHouse=b.nestrecommends.models;for(var w=0,D=b.nestrecommends.models.length;w<D;w++)this.moreHouse[w].src=window.location.origin+"/play/"+this.moreHouse[w].src.split("/play/")[1]}if(this.location_url=c.model.location_url||null,this.location_enable=c.model.location_enable,this.scene_enable=c.menu.scene_enable,this.scene_autoplay=c.menu.scene_autoplay,this.single_3D=c.menu.single_3D,this.innermap_enable=!1,this.innermap_type=c.menu.innermap_type,this.innermap_imgurl=c.menu.innermap_imgurl,this.outermap_enable=c.menu.outermap_enable,this.outermap_type=c.menu.outermap_type,this.outermap_url=c.menu.outermap_url,this.visiotors_enable=c.menu.visiotors_enable,this.mlanguage_enable=c.menu.mlanguage_enable,this.measure_enable=c.menu.measure_enable,this.mlanguage_type=0===c.menu.mlanguage_type||void 0===c.menu.mlanguage_type?0:c.menu.mlanguage_type,this.t_logo_enable=c.menu.t_logo_enable,this.t_logo_url=c.menu.t_logo_url,this.house_type_enabled=c.menu.house_type_enabled,this.house_type_url=c.menu.house_type_url,this.inside_limit=c.menu.inside_limit,this.model_name_style=c.menu.model_name_style,this.menu_autohide=c.menu.menu_autohide,this.share_enable=c.model.share_enable,this.startup_type=c.menu.startup_type,this.switch_scene_type=c.menu.switch_scene_type,this.oauth=c.menu.oauth,this.back_url=c.menu.back_url,this.buildFloors=b.building,this.building_tag_enable=c.model.building_tag_enable,this.commoditytypes=b.commoditytypes,G.P={a:.025,b:0,c:.01},this.loading_enable=c.menu.loading_enable,this.iframe_screen_enable=c.menu.iframe_screen_enable,this.straight_enable=c.menu.straight_enable,this.catalogue=b.catalogue,this.catalogue&&((!this.catalogue.tagopentime||this.catalogue.tagopentime<0)&&(this.catalogue.tagopentime=5),(!this.catalogue.mediamaxtime||this.catalogue.mediamaxtime<0)&&(this.catalogue.mediamaxtime=180),(!this.catalogue.iframemaxtime||this.catalogue.iframemaxtime<0)&&(this.catalogue.iframemaxtime=20)),p.zoom.enabled=!0,b.panorama_settings&&(p.panoramaSettings=b.panorama_settings,p.insideFOV=p.panoramaSettings.loading_fov82?82:70),b.nestscenes.scenes&&b.nestscenes.scenes.length>0){for(var E=-1,w=0;w<b.nestscenes.scenes.length;w++)if(1!==b.nestscenes.scenes[w].script){E=w;break}-1!==E&&(b.nestscenes.scenes[E].init_point=!0,this.normalMovie=!0)}if(this.mlanguage_enable?(location.host.indexOf(".biz")>-1&&(this.mlanguage_type=1),this.mlanguage_type===e.Chinese?this.language=F.Chinese:this.mlanguage_type===e.English?this.language=F.English:this.mlanguage_type==e.Japanese?this.language=F.Japanese:(this.language=F.Chinese,this.mlanguage_type=e.Chinese)):(this.language=F.Chinese,this.mlanguage_type=e.Chinese,location.host.indexOf(".biz")>-1&&(this.language=F.English,this.mlanguage_type=e.English)),this.options=a,this.urls=new i(a.urlFiles),this.isPublic=2!==b.basic.privacy,this.images=new A(this),this.images.extend(b.nestscenes.scenes),this.scenes360=[],this.points=b.locations.points,this.gotoFrom360Item=-1,this.catalogue&&this.catalogue.sequence&&this.catalogue.sequence.length&&b.nestscenes&&(b.nestscenes.path=f.Catalogue,this.switch_scene_type=2),b.nestscenes.path&&b.nestscenes.path.type===f.Fastmovie&&(p.warp.burnsAngle=0,p.warp.tourStepDelay=2e3,p.warp.waitMultiplier1=8,p.warp.waitMultiplier2=2),this.catalogue&&this.catalogue.displaytype){p.warp.burnsAngle=0,p.warp.tourStepDelay=500,p.warp.waitMultiplier1=8,p.warp.waitMultiplier2=2;for(var E=-1,w=0;w<b.nestscenes.scenes.length;w++)if(1===b.nestscenes.scenes[w].script){E=w;break}-1!==E&&(this.enableTagMovie=!0)}var H=null,I=null;if(this.images.getLength()>0){for(var w in this.images.list)1==this.images.list[w].type?-1==this.gotoFrom360Item&&((H=this.images.list[w]._camera)&&(H=this.images.list[w]._camera._locationid,I=this.images.list[w]._camera._rotation),this.gotoFrom360Item=w):2==this.images.list[w].type&&this.scenes360.push(this.images.list[w]);if(null==H)for(var w in this.images.list)for(var E in this.points)this.images.list[w]._camera&&this.points[E].locationid==this.images.list[w]._camera._locationid&&(1==this.points[E].type?-1==this.gotoFrom360Item&&(H=this.images.list[w]._camera._locationid,I=this.images.list[w]._camera._rotation,this.gotoFrom360Item=w):this.scenes360.push(this.images.list[w]));if(null==H)for(var w in this.points)if(1==this.points[w].type){H=this.points[w].locationid,I=this.points[w].rotation,this.gotoFrom360Item=this.images.getLength();break}if(null!=H){var J={_locationid:H,_rotation:I,_type:0,_viewpoint:new g.Vector3(0,0,0),_zoom:0,_zoom_enable:0},K={init_point:!0,name:"",sceneid:"test",shortcuturl:"",_camera:J};this.images.add(K)}}-1==this.gotoFrom360Item&&(this.gotoFrom360Item=0),this.enableOri=c.model.orientation,z.isMobile()||(this.enableOri=!1),G.ori.flag=!1,this.vr_num=0,this.vr_enable=!(void 0!=c.menu.vr_enable&&!c.menu.vr_enable),this.vr_enable&&this.vr_num++,this.enableOri&&this.vr_num++,this.heroImage=this.images.getbg(),this.heroLocations=[],this.outdoorPanoLocations=[],this.floors=new n(this),this.floorsEnabled=void 0===a.floors||a.floors,this.changingFloor=!1,this.chunks=[],this.panos=new t,this.colliders=[],this.loadPanosPromise=null,this.loadMeshTexturesPromise=null,this.meshTexturesLoaded=!1,this.mattertags={},this.tagsShown=!1,this.shouldShowMattertags=!1,this.has360Views=!0,this.supportedModes={},this.supportedModes[k.PANORAMA]=!0,this.supportedModes[k.DOLLHOUSE]=!b.player_options||b.player_options.dollhouse,this.supportedModes[k.FLOORPLAN]=!b.player_options||b.player_options.floor_plan,this.supportedModes[k.TRANSITIONING]=!0,this.supportsTiles=!!c.model.multiple,p.tiling.allowUltraHighResolution=!!c.model.hq,p.tiling.mobileHighQualityOverride=!!c.model.mobile2k,this.adjustCompass=parseFloat(c.model.adjustCompass?c.model.adjustCompass:0),this.mode=k.DOLLHOUSE,this.size=null,this.center=null,this.boundingBox=new g.Box3,this.currentFloor=null,this.allFloorsVisible=!0,this.projectedPano0=null,this.projectedPano1=null,this.floorsEnabled&&b.floors&&-1!==b.floors.indexOf(",")&&b.floors.split(",").forEach(function(a,b){this.addFloor(new m(this,b,a.trim()))}.bind(this)),this.enablefilter=!1;for(var L=G.settings.locations.points,w=0;w<L.length;w++)!L[w].color||0===L[w].color.brightness&&0===L[w].color.contrast&&1===L[w].color.gamma&&0===L[w].color.hue&&0===L[w].color.saturation&&0===L[w].color.vibrance||(this.enablefilter=!0);this.waitQueue=[],this.on("load",function(a){0!==this.waitQueue.length&&(this.waitQueue=this.waitQueue.filter(function(a){return!a.isLoadedCallback()}),0===this.waitQueue.length&&this.emit("waiting-done"))}.bind(this)),this.setupCustomProperties()}var e=a("../enum/LanguageType"),f=a("../enum/PathType"),g=a("three"),h=a("../util/ajax"),i=a("../util/ModelUrls"),j=a("../objects/BoundingTextureSkybox"),k=a("../enum/Viewmode"),l=a("../enum/RenderOrder"),m=(a("../enum/AlignmentType"),a("../objects/Floor")),n=a("./FloorCollection"),o=a("../objects/Chunk"),p=(a("../objects/Room"),a("../objects/Snapshot"),a("../util/math"),a("../conf")),q=(a("../shaders"),a("../util/logger")),r=a("../mattertag/Mattertag"),s=(a("../mattertag/MattertagManager"),a("../objects/Panorama")),t=a("../util/PanoramaCollection"),u=a("../loaders/ModelLoader"),v=a("../loaders/ModelTextureLoader"),w=a("../loaders/SweepDataLoader"),x=a("../util/transitions"),y=(a("../util/easing"),a("../util/lerp"),a("../util/common")),z=(a("../util/texture"),a("./../util/browser")),A=a("./ImageCollection"),B=a("./RoomCollection"),C=a("./Chunks"),D=(a("./../util/showcase"),a("../exception/BasicException")),E=a("events").EventEmitter,F=a("../gui/mLanguage"),H=new q(c);d.prototype=Object.create(g.Object3D.prototype),y.extend(d,E),d.prototype.setupCustomProperties=function(){var a=p.modelAlpha;Object.defineProperty(this,"alpha",{get:function(){return a},set:function(b){a=b,this.chunks.forEach(function(b){b.material&&b.material.uniforms.modelAlpha&&(b.material.uniforms.modelAlpha.value=a)})}})},d.prototype.toggleAlpha=function(){this.alpha<1?this.alpha=1:this.alpha=0},d.prototype.load=function(a){var b=function(){return $.when(this.loadPanos(),this.loadMesh())},c=b.bind(this);c=c(),a?c=c.then(this.loadMeshTextures.bind(this)):c.then(this.loadMeshTextures.bind(this));var d=$.when(this.loadHighlightReel(),this.loadMattertags());return $.when(c,d).done(this.build.bind(this))},d.prototype.loadMesh=function(){function a(a){H.error(a),d.reject("loading-failed")}function b(a,b){d.notify(a,b)}function c(a,b){if(0===a.length){H.warn("No geometry found for model, loading faux geometry, disabling outside mode"),e.supportedModes[k.DOLLHOUSE]=!1,e.supportedModes[k.FLOORPLAN]=!1;var c=new o({geometry:new g.PlaneBufferGeometry(5,5,1,1)});c.material.visible=!1,c.rotateX(-Math.PI/2),c.geometry.computeBoundingBox(),a=[c]}a.forEach(function(a){var b=e.floorsEnabled?C.parseFloor(a.name):0;e.addChunk(b,a)}),e.floors.sort(),d.resolve(e)}var d=$.Deferred(),e=this;return u.load(e.urls,c,b,a),d.promise()},d.prototype.flyToTagid=function(a){if(!G.d.tourIsPlaying){G.player.mattertagManager.closeTag();var b=this.getTagByTagid(a);if(b){var c={pano:this.panos.index[b.locationId],lookAtPoint:{x:b.position.x,y:b.position.y,z:b.position.z}};if(G.d.flyingtag)return;G.d.flyingtag=!0,G.d.player.flyToPano(c,function(){console.log("tag.locationId: "+b.locationId),G.d.player.mattertagManager.openTag(b),G.d.flyingtag=!1})}}},d.prototype.loadMeshTextures=function(){return this.loadTexturesPromise?this.loadTexturesPromise:(this.loadTexturesPromise=v.load(this).then(function(){this.meshTexturesLoaded=!0}.bind(this)),this.loadTexturesPromise)},d.prototype.loadMattertags=function(){var a=$.Deferred();if(!p.mattertags.enabled)return a.resolve();var b=this.options.urlBase+"/play/data/"+this.modelid+"/nesttags";return h.get(b,{responseType:"json",fetchNum:1,prefetchFrom:"nesttags",auth:this.isPublic?null:p.authorizationHeader}).done(function(b){if(!(b&&b.setting&&b.setting.display))return a.resolve();var c=b.info,d=this.building_tag_enable;d=isNaN(d)?1:parseInt(d),console.log("building_tag_enable*********",d),c=c.filter(function(a){return 1==d||2!=parseInt(a.actiontype)});var e;G.titletags=[],G.weathertags=[];for(var f in c)e=c[f],e.enable&&(e.showtitle&&e.tagtitle&&12!==e.details.templatetype&&e.label_config&&(2===e.label_config.fontSize?e.base.y+=.013:3===e.label_config.fontSize&&(e.base.y+=.035)),this.mattertags[f]=new r(this,f,e),e.showtitle&&e.tagtitle&&12!==e.details.templatetype&&(e.details.tagpictype=2,e.details.tagpicurl=e.tagtitle,e.label_config&&(2===e.label_config.fontSize?e.base.y-=.01:3===e.label_config.fontSize&&(e.base.y-=.025)),this.mattertags[1e4+parseInt(f)]=new r(this,1e4+parseInt(f),e)),39===e.details.templatetype&&G.weathertags.push(this.mattertags[f]),12===e.details.templatetype&&G.titletags.push(this.mattertags[f]));e={actiontype:1,base:{x:1e4,y:1e4,z:1e4},details:{description:"faketag",subtype:1,tagpictype:1,tagpicurl:null,templatetype:9,title:"faketag"},enable:!0,flooridx:0,locationid:"location_01",normal:{x:0,y:0,z:0},showtitle:!1,stem:{direction:{x:0,y:0,z:0},enabled:!1},tagid:"faketag"},this.mattertags[2e4]=new r(this,2e4,e),a.resolve()}.bind(this)).fail(function(){H.warn("Getting tags failed, not displaying tags."),a.resolve()}),a},d.prototype.buildTagsForAddTag=function(a){var b=0;for(var c in this.mattertags)b++;var d=new r(this,b,a);this.mattertags[b]=d,this.mattertags[b].build(),this.mattertags[b].disc.material.opacity=1},d.prototype.newBuildTagsForAddTag=function(a){var b=0;this.delTag(a.tagid);for(var c in this.mattertags)parseInt(c)<1e4&&(b=parseInt(c)+1);var d=new r(this,b,a);if(this.mattertags[b]=d,a.details&&12===a.details.templatetype)return G.titletags.push(this.mattertags[b]),!1;this.mattertags[b].build(),this.mattertags[b].disc.material.opacity=1,a.showtitle&&a.tagtitle&&(b+=1e4,a.details.tagpictype=2,a.details.tagpicurl=a.tagtitle,this.mattertags[b]=new r(this,b,a),this.mattertags[b].build(),this.mattertags[b].disc.material.opacity=1)},d.prototype.delTag=function(a){var b={CLOSED:"closed",OPENING:"opening",OPEN:"open",CLOSING:"closing",ACTIVE:"active"},c=null;for(var d in this.mattertags)if(this.mattertags[d]&&this.mattertags[d].tagid&&this.mattertags[d].tagid==a){c=this.mattertags[d];break}if(null!=c){if(12===c.type)return G.titletags.forEach(function(a,b){parseInt(a.i)===parseInt(c.i)&&($("#titletag"+c.i).remove(),G.titletags.splice(b,1))}),!1;c.floor.remove(c.obj3d),c.boardState!==b.OPEN&&c.boardState!==b.ACTIVE||(c.setClosedState(),c.boardState=b.CLOSED),delete this.mattertags[d]}},
d.prototype.newAddScene=function(a){gui.addHighlight(G.model,G.d,G.player,a)},d.prototype.build360TagsForAddTag=function(a){var b=Object.keys(this.mattertags).length,c=this.mattertags[0],d=JSON.parse(JSON.stringify(c.data));d.base.x=a.base.x,d.base.y=a.base.y,d.base.z=a.base.z,d.details.title=a.details.title,d.details.templatetype=a.details.templatetype,d.locationid=a.locationid;var e=new r(this,b,d);return this.mattertags[b]=e,this.mattertags[b].build(),this.mattertags[b].disc.material.opacity=1,d.locationid},d.prototype.removeScene=function(a){for(var b=this.heroLocations.length-1;b>=0;b--)this.heroLocations[b].panoId==a&&this.heroLocations.splice(b,1);G.d.updateModel()},d.prototype.loadPanos=function(){if(this.loadPanosPromise)return this.loadPanosPromise;var a=new w(this);return this.loadPanosPromise=a.load().then(function(a){return this.data.sweeps&&Object.keys(this.data.sweeps).length>0&&(a=a.filter(function(a){return!(!this.data.sweeps[a.locationid]||void 0===this.data.sweeps[a.locationid].enabled)&&this.data.sweeps[a.locationid].enabled}.bind(this))),this.panos.extend(a.map(function(a){return new s(this,a.locationid,a,this.supportsTiles)}.bind(this))),this.panos.forEach(function(a){a.neighbourUUIDs&&(a.neighbourUUIDs.forEach(function(b){var c=this.panos.get(b);c&&this.panos.setNeighbour(a,c,!0)}.bind(this)),a.neighbourPanos=this.panos.getNeighbours(a)||this.panos.setNeighbour(a,a,!0))}.bind(this)),0===this.panos.length&&(H.warn("Model has no panos, turning off inside mode"),this.supportedModes[k.PANORAMA]=!1),$.when(this)}.bind(this)),this.loadPanosPromise},d.prototype.loadHighlightReel=function(){var a=$.Deferred(),b=this.options.urlBase+"/play/data/"+this.modelid+"/nestscenes";return h.get(b,{responseType:"json",fetchNum:1,prefetchFrom:"nestscenes",auth:this.isPublic?null:p.authorizationHeader}).done(function(b){a.resolve()}.bind(this)).fail(function(){H.warn("Getting highlight reel failed, no highlights available"),a.resolve()}),a},d.prototype.waitForLoad=function(a,b){b()||(this.waitQueue.push({object:a,isLoadedCallback:b}),1===this.waitQueue.length&&this.emit("waiting"))},d.prototype.update=function(a){this.panos.update(a)},d.prototype.hide=function(){this.floors.hide()},d.prototype.show=function(){this.floors.show()},d.prototype.floorNames=function(){return this.floors.names()},d.prototype.warpDestFloors=function(a,b){if(!a||this.floors.length!==a.length)return void this.toggleAllFloors(!0);var c=a.findIndex(function(a){return a}.bind(this));-1!==c&&this.setFloor(this.floors.list[c],null,b)},d.prototype.setFloor=function(a,b,c){this.allFloorsVisible&&this.emit("allfloors.toggled",!1,this.currentFloor),this.allFloorsVisible=!1,this._setFloor(a,b,c)},d.prototype.toggleAllFloors=function(a){this.allFloorsVisible=void 0!==a?a:!this.allFloorsVisible,this.emit("allfloors.toggled",this.allFloorsVisible,this.currentFloor),this._setFloor(this.currentFloor)},d.prototype._setFloor=function(a,b,c){b=b||this.mode,this.emit("floor.changed",a,b,this.currentFloor),this.currentFloor=a;var d;if(b===k.PANORAMA){if(this.show(),this.shouldShowMattertags&&this.tagsShown)for(d in this.mattertags)this.mattertags[d].show(p.showFloorDuration)}else if((b===k.FLOORPLAN||b===k.DOLLHOUSE)&&(this.floors.list.forEach(function(a,b){a.toggle(a===this.currentFloor||this.allFloorsVisible,c||this.allFloorsVisible)}.bind(this)),this.shouldShowMattertags&&this.tagsShown))for(d in this.mattertags){var e=this.mattertags[d];this.allFloorsVisible?e.show(p.showFloorDuration):e.floor===this.currentFloor?e.show(p.showFloorDuration,p.showFloorDelay):e.hide(p.hideFloorDuration,p.hideFloorDelay)}var f=this,g=a;x.start(function(){},p.showFloorDelay,function(){f.floors.forEach(function(a){a.chunks.forEach(function(b){b.renderOrder=a===g?l.visibleFloor:l.ghostFloor})})}.bind(this))},d.prototype.toggleExplode=function(){this.floors.toggleExplodeHorizontal()},d.prototype.toggleExplodeUp=function(){this.floors.toggleExplodeVertical()},d.prototype.nextFloor=function(a){return this.floors.nextFloor(this.currentFloor,a)},d.prototype.addFloor=function(a){this.floors.add(a)},d.prototype.getFloorAtPoint=function(a){return this.floors.getFloorAtPoint(a)},d.prototype.getTagByIdx=function(a){return a>=1e4&&(a-=1e4),this.mattertags[a]},d.prototype.getTagByTagid=function(a){for(var b=Object.keys(this.mattertags).length,c=0;c<b;c++)if(this.mattertags[c].tagid===a)return this.mattertags[c];return null},d.prototype.addChunk=function(a,b){this.floors.getOrMakeFloor(a).addChunk(b),this.chunks.push(b)},d.prototype.setMode=function(a){if(!this.supportedModes[a])throw new D("Mode not supported for this model: "+a);this.mode=a,this.chunks.forEach(function(b){b.setMode(a)})},d.prototype.build=function(){function a(a,b){return new THREE.Quaternion(a.x,a.y,a.z,a.w).multiply((new THREE.Quaternion).setFromAxisAngle(new THREE.Vector3(1,0,0),THREE.Math.degToRad(b)))}var b=this;this.heroLocations=this.images.getHeroLocations(this.panos),this.has360Views=p.show360Views.enabled&&this.heroLocations.some(function(a){return a.cameraMode===k.PANORAMA&&this.panos.get(a.panoId)&&!this.panos.get(a.panoId).isAligned()}.bind(this)),null===this.heroImage&&H.warn("No hero image defined."),this.currentFloor=this.floors.last(),this.floors.build(),this.colliders=this.floors.reduce(function(a,b){return a.concat(b.collider.children)},[]);var c=[],d=[];this.panos.forEach(function(a){2==a.alignmentType?d.push(a):c.push(a)}.bind(this)),c.forEach(function(a){a.build1(),a.on("enter",function(){a.floor!==this.currentFloor&&this.setFloor(a.floor)}.bind(this))}.bind(this)),d.forEach(function(a){a.build1(),a.on("enter",function(){a.floor!==this.currentFloor&&this.setFloor(a.floor)}.bind(this))}.bind(this)),(p.isEditVersion||p.isNewEditVersion)&&(parent.window.showHiddenPano?G.editPanos=!0:G.editPanos=!1),this.panos.forEach(function(a){if(a.build2(),1===a.alignmentType&&(p.isEditVersion||p.isNewEditVersion)&&G.editPanos){var c={actiontype:1,base:{x:a.marker.position.x,y:a.marker.position.y,z:a.marker.position.z},details:{templatetype:9e3,subtype:0,time:"2017-09-15 03:39:33",title:"点击隐藏或显示全景点："+a.id,description:"pano使能",tagpictype:1},enable:!0,locationid:a.id,normal:{x:0,y:1,z:0},stem:{direction:{x:0,y:1,z:0},enabled:!0},tagid:"pano_"+a.id};b.buildTagsForAddTag(c)}}),this.floors.forEach(function(a){this.boundingBox.union(a.boundingBox)}.bind(this)),this.size=this.boundingBox.size(),this.center=this.boundingBox.center(),this.floors.forEach(function(a){H.info("Floor "+a+": "+a.children.length+" chunks, "+a.panos.length+" panos.")}.bind(this)),this.panos.populate_path_graph(),this.skybox=new j(this.boundingBox),this.skybox.matrixWorldNeedsUpdate=!0,this.add(this.skybox);for(var e in this.mattertags)12!==this.mattertags[e].type&&this.mattertags[e].build();if(1==p.thirdCustomer&&(null==this.floorNavigationMesh||void 0==this.floorNavigationMesh)){var f=new THREE.PlaneBufferGeometry(this.boundingBox.max.x-this.boundingBox.min.x,this.boundingBox.max.z-this.boundingBox.min.z),g=new THREE.TextureLoader;g.setCrossOrigin(!0);var h=g.load("https://template2.3dnest.cn/dianli/"+this.modelid+".png"),i=new THREE.MeshBasicMaterial({map:h,side:THREE.FrontSide,transparent:!0,opacity:1});this.floorNavigationMesh=new THREE.Mesh(f,i);var l=(new THREE.Vector3).copy(this.boundingBox.center()),m=this.boundingBox.max.y,n=l.clone().setY(m);this.floorNavigationMesh.position.copy(n),"zq_sxex_17"==this.modelid?this.floorNavigationMesh.quaternion.copy(a(this.floorNavigationMesh.quaternion,-95)):"zq_dnjl_7"==this.modelid?this.floorNavigationMesh.quaternion.copy(a(this.floorNavigationMesh.quaternion,-92)):"zq_sxsx_18"==this.modelid?this.floorNavigationMesh.quaternion.copy(a(this.floorNavigationMesh.quaternion,-95)):"zq_ylck_24"==this.modelid?this.floorNavigationMesh.quaternion.copy(a(this.floorNavigationMesh.quaternion,-92)):this.floorNavigationMesh.quaternion.copy(a(this.floorNavigationMesh.quaternion,-90)),this.add(this.floorNavigationMesh)}return H.debug("Done building model"),s.raycastsDone>0&&(H.warn("raycasts: "+s.raycastsDone),H.warn("raycasts skipped: "+s.raycastsSkipped)),this.buildRooms(),$.when(this)},d.prototype.buildRooms=function(){this.rooms=new B(this),this.rooms.createFromChunks(this.chunks),this.rooms.calcRoomBoundaries()},d.prototype.updateProjectedPanos=function(){this.projectedPano0&&this.projectedPano1&&this.setProjectedPanos(this.projectedPano0,this.projectedPano1,!1)},d.prototype.setProjectedPanos=function(a,b,c){void 0!==c&&null!==c||(c=!0),c=!!c,this.projectedPano0=a,this.projectedPano1=b,this.skybox.material.setProjectedPanos(a,b,c),this.chunks.forEach(function(d){d.materialInside.setProjectedPanos(a,b,c)})},d.prototype.setSide=function(a){this.floors.forEach(function(b){b.collider.material.side=a})},d.prototype.setSide=function(a){this.floors.forEach(function(b){b.collider.material.side=a})},d.prototype.heroCount=function(){return this.heroLocations?this.heroLocations.length:0},d.prototype.getHeroDescriptorByIndex=function(a){if(a<0)return H.warn("Model.getHeroDescriptorByHeroIndex() -> heroIndex is less than 0."),null;if(this.heroCount()<1)return H.warn("Model.getHeroDescriptorByIndex() -> No hero locations in this model"),null;var b=this.heroLocations[a];return void 0===b?(H.warn("Model.getHeroDescriptorByIndex() -> Index "+a+" is not a validindex"),null):b},d.prototype.findPanoramicHero=function(){for(var a in this.heroLocations)if(this.heroLocations[a].cameraMode===k.PANORAMA)return this.heroLocations[a];return null},d.prototype.listImagePanos=function(){var a=[],b=this;return this.images.forEach(function(c){if(c._camera&&c._camera._locationid){var d=b.panos.get(c._camera._locationid);d&&(b.supportsTiles||d.isLoaded("high")||a.push(d))}}),a},d.prototype.fadePanoMarkers=function(a,b){this.panos.fadeMarkerOpacity(a,b)},d.prototype.setSweepVisibility=function(a){this.panos.forEach(function(b){b.marker&&(b.marker.visible=a)})},d.prototype.setPanoNeighbourSweepVisible=function(a){},d.prototype.outsideAllowed=function(){return this.supportedModes[k.DOLLHOUSE]&&this.supportedModes[k.FLOORPLAN]},b.exports=d}).call(this,"/js/model/Model.js")},{"../conf":7,"../enum/AlignmentType":16,"../enum/LanguageType":26,"../enum/PathType":37,"../enum/RenderOrder":39,"../enum/Viewmode":51,"../exception/BasicException":54,"../gui/mLanguage":69,"../loaders/ModelLoader":88,"../loaders/ModelTextureLoader":89,"../loaders/SweepDataLoader":90,"../mattertag/Mattertag":97,"../mattertag/MattertagManager":98,"../objects/BoundingTextureSkybox":107,"../objects/Chunk":108,"../objects/Floor":110,"../objects/Panorama":113,"../objects/Room":115,"../objects/Snapshot":118,"../shaders":126,"../util/ModelUrls":137,"../util/PanoramaCollection":138,"../util/ajax":141,"../util/common":145,"../util/easing":147,"../util/lerp":152,"../util/logger":153,"../util/math":154,"../util/texture":161,"../util/transitions":162,"./../util/browser":142,"./../util/showcase":156,"./Chunks":99,"./FloorCollection":100,"./ImageCollection":101,"./RoomCollection":104,events:170,three:177}],103:[function(a,b,c){"use strict";function d(){this.modelMap={},this.activeModel=null,this.modelCount=0,this.tileDownloader=null,this.panoRenderer=null}var e=(a("three"),a("../util/common")),f=a("../exception/BasicException"),g=a("../enum/ModelManagerEvents"),h=a("events").EventEmitter;d.prototype.init=function(a,b,c){this.tileDownloader=a,this.panoRenderer=b,this.qualityManager=c},d.prototype.addModel=function(a){this.modelMap[a.modelid]=a,0===this.modelCount&&this.activateModel(a.modelid),this.modelCount++,this.emit(g.ModelAdded)},d.prototype.activateModel=function(a){var b=this.modelMap[a];if(!b)throw new f("Tried to activate invalid model!");var c=this.activeModel;this.activeModel=b,this.tileDownloader.setPanoData(b.panos,b.listImagePanos(),b.modelid),this.tileDownloader.setUrls(b.urls),b.panos.forEach(function(a){a.attachToPanoRenderer(this.panoRenderer),a.tileDownloader=this.tileDownloader,a.qualityManager=this.qualityManager}.bind(this)),this.emit(g.ActiveModelChanged,{oldModel:c,model:b})},d.prototype.getActiveModel=function(){return this.activeModel},e.extend(d,h),b.exports=d},{"../enum/ModelManagerEvents":30,"../exception/BasicException":54,"../util/common":145,events:170,three:177}],104:[function(a,b,c){(function(c){"use strict";function d(){h.call(this)}var e=a("../objects/Room"),f=(a("../conf"),a("../util/logger")),g=(a("../util/transitions"),a("../util/easing"),a("../util/common")),h=a("../util/IndexedCollection"),i=a("./Chunks");new f(c),g.inherit(d,h),d.prototype.getIndex=function(a){return a.roomId},d.prototype.calcRoomBoundaries=function(){this.forEach(function(a){a.calcBoundaries()})},d.prototype.createFromChunks=function(a){var b={floorId:-1,roomId:-1},c={};a.forEach(function(a){i.parseIdsFromChunkName(a.name,b);var f=c[b.roomId];if(!f){var g=d.generateRoomId(b.floorId,b.roomId);f=new e(b.floorId,g),this.add(f),c[b.roomId]=f}f.addChunk(a)}.bind(this)),this.calcRoomBoundaries()},d.generateRoomId=function(a,b){return a+"_"+b},b.exports=d}).call(this,"/js/model/RoomCollection.js")},{"../conf":7,"../objects/Room":115,"../util/IndexedCollection":134,"../util/common":145,"../util/easing":147,"../util/logger":153,"../util/transitions":162,"./Chunks":99}],105:[function(a,b,c){"use strict";function d(a){var b=g.UniformsUtils.clone(l.waypoint.uniforms);b.map.value=n,b.opacity.value=0,b.color.value.set(h.reticuleColor),g.Mesh.call(this,new g.PlaneBufferGeometry(.2,.2,1,1),new g.RawShaderMaterial({side:g.DoubleSide,depthWrite:!1,depthTest:!1,transparent:!0,vertexShader:l.waypoint.vertexShader,fragmentShader:l.waypoint.fragmentShader,uniforms:b,name:"waypoint",opacity:0})),this.renderOrder=m.reticule,this.player=a,this.direction=new g.Vector3,this.hidden=!0,this.mouseLastMoveTime=Date.now(),this.lineMaterial=new g.LineBasicMaterial({linewidth:h.mattertags.pole.width,color:h.mattertags.pole.color,opacity:1,transparent:!0,alphaTest:h.mattertags.pole.opacity*h.mattertags.visibility.alphaTestLevel}),o.addAttribute("position",new g.BufferAttribute(p,3)),this.line=new g.Line(o,this.lineMaterial),this.line.renderOrder=m.ribbon,this.pObject=new g.Object3D,this.pObject.add(this),this.pObject.add(this.line)}var e=a("../gui/offLine"),f=new e,g=a("three"),h=a("../conf"),i=a("../util/transitions"),j=a("../util/texture"),k=a("../util/lerp"),l=a("../shaders"),m=a("../enum/RenderOrder"),n=j.loadurl(f.splitUrl("https://template2.3dnest.cn/common/image/pointermain_512x512.png")),o=new g.BufferGeometry,p=new Float32Array(6);p[0]=p[1]=p[2]=p[3]=p[4]=p[5]=0,d.prototype=Object.create(g.Mesh.prototype),d.prototype.move=function(a,b,c){this.hidden=c,this.mouseLastMoveTime=Date.now()},d.prototype.hide=function(){this.hidden||(this.hidden=!0,i.start(k.property(this.material.uniforms.opacity,"value",0),h.reticuleOpacityTransitionTime))},d.prototype.show=function(){this.hidden=!1,this.material.opacity<=0&&i.start(k.property(this.material.uniforms.opacity,"value",h[this.player.mode].reticuleOpacity),h.reticuleOpacityTransitionTime)},d.prototype.update=function(){Date.now()-this.mouseLastMoveTime>h.hideReticuleTimeout&&!this.hidden&&this.hide()},d.prototype.updatePosition=function(a,b){if(!this.hidden){if(!b)return this.hide();var c=b.point,d=a.distanceTo(c),e=1+.01*d;d<1&&(e-=1-d),this.show(),this.scale.set(e,e,e),this.direction=this.direction.multiplyScalar(.8),this.direction.add(b.face.normal.clone().multiplyScalar(.2)),this.position.copy(c).add(b.face.normal.clone().multiplyScalar(.01)),this.pObject.position.copy(this.position),this.buildPole(b),this.lookAt(this.position.clone().add(this.direction))}},d.prototype.buildPole=function(a){p[0]=p[1]=p[2]=0,p[3]=a.face.normal.x,p[4]=a.face.normal.y,p[5]=a.face.normal.z;var b=new g.Vector3(p[3],p[4],p[5]);b.normalize().multiplyScalar(.5),p[3]=b.x,p[4]=b.y,p[5]=b.z,o.addAttribute("position",new THREE.BufferAttribute(p,3))},d.prototype.writeAsMattertag=function(){var a=Math.floor(4294967296*(1+Math.random())).toString(16)+Math.floor(16*(1+Math.random())).toString(16),b=new Date;this.tagCount=void 0===this.tagCount?1:this.tagCount+1;var c={enabled:!0,version:"0",created:b.toISOString(),created_by:"APITest",position:this.position.clone(),stem:{enabled:h.mattertags.pole.enabled,direction:this.direction.multiplyScalar(h.mattertags.pole.height)},label:"Mattertag "+this.tagCount,description:"Description "+a,floor:function(a){if(a.currentFloor){var b=a.floors.indexOf(a.currentFloor);return b>-1?b:void 0}}(this.player.model),type:"info",metadata:{preferred_camera:{mode:this.player.mode}}};console.log("--------------------------"),console.log(JSON.stringify(c));var d=this.player.model.addMattertag(a,c).build();d&&(d.disc&&this.player.mattertagDiscs.push(d.disc),d.visible||d.show(h.mattertags.startup.fadeInDuration))},b.exports=d},{"../conf":7,"../enum/RenderOrder":39,"../gui/offLine":70,"../shaders":126,"../util/lerp":152,"../util/texture":161,"../util/transitions":162,three:177}],106:[function(a,b,c){"use strict";function d(a,b,c){a=a.clone();var d=a.size(),f=new e.BoxGeometry(d.x,d.y,d.z);f.boundingBox=a,e.Mesh.call(this,f,b),this.position.copy(a.center()),this.frustumCulled=!1,c&&this.add(new e.WireframeHelper(this))}var e=a("three");d.prototype=Object.create(e.Mesh.prototype),d.prototype.constructor=d,b.exports=d},{three:177}],107:[function(a,b,c){(function(c){"use strict";function d(a){k.time("Computing a nice bounding cubemap");var b=new g({side:e.BackSide,transparent:!0});b.uniforms.modelAlpha.value=0,b.uniforms.opacity.value=1-h.modelAlpha,this.renderOrder=i.boundingSkybox,f.call(this,a,b),k.timeEnd("Computing a nice bounding cubemap")}var e=a("three"),f=(a("../enum/Viewmode"),a("../shaders"),a("./BoundingMesh")),g=a("../materials/ModelTextureMaterial"),h=a("../conf"),i=a("../enum/RenderOrder"),j=a("../util/logger"),k=new j(c);d.prototype=Object.create(f.prototype),d.prototype.constructor=d,b.exports=d}).call(this,"/js/objects/BoundingTextureSkybox.js")},{"../conf":7,"../enum/RenderOrder":39,"../enum/Viewmode":51,"../materials/ModelTextureMaterial":95,"../shaders":126,"../util/logger":153,"./BoundingMesh":106,three:177}],108:[function(a,b,c){"use strict";function d(a){this.materialInside=new h({side:e.DoubleSide}),this.materialOutside=new e.RawShaderMaterial({fragmentShader:f.modelOutside.fragmentShader,vertexShader:f.modelOutside.vertexShader,uniforms:e.UniformsUtils.clone(f.modelOutside.uniforms),side:e.FrontSide,name:"chunkOut"}),e.Mesh.call(this,a.geometry,this.materialInside),this.name=a.name||"",this.textureName=a.textureName,this.meshUrl=a.meshUrl}var e=a("three"),f=a("../shaders"),g=a("../enum/Viewmode"),h=a("../materials/ModelTextureMaterial");d.prototype=Object.create(e.Mesh.prototype),d.prototype.setTextureMap=function(a){this.materialInside.uniforms.map.value=a,this.materialOutside.uniforms.map.value=a},d.prototype.setMode=function(a){var b=a===g.DOLLHOUSE||a===g.FLOORPLAN?this.materialOutside:this.materialInside;b.side=a===g.PANORAMA?e.DoubleSide:e.FrontSide,b.transparent=this.material.transparent,b.uniforms.opacity.value=this.material.uniforms.opacity.value,this.material=b},b.exports=d},{"../enum/Viewmode":51,"../materials/ModelTextureMaterial":95,"../shaders":126,three:177}],109:[function(a,b,c){"use strict";function d(a){this.chunksize=a||10,this.chunks={},this.boundingBoxes={},this.children=[],this.offset=new e.Vector3(0,.5,0),this.material=new e.MeshBasicMaterial({color:16777215*Math.random(),side:e.DoubleSide})}var e=a("three");a("../enum/Viewmode"),d.prototype.add=function(a){var b,c,d,f,g,h,i,j,k,l,m,n,o,p=a.attributes,q=new e.Vector3;if(p?(b=p.position.array,c=void 0!==a.index?a.index.array:void 0):(b=a.vertices,a.faces),c)for(d=0,f=c.length;d<f;d+=3){var r=3*c[d],s=3*c[d+1],t=3*c[d+2];g=(b[r]+b[s]+b[t])/3,h=(b[r+1]+b[s+1]+b[t+1])/3,i=(b[r+2]+b[s+2]+b[t+2])/3,j=Math.floor(g/this.chunksize),k=Math.floor(h/this.chunksize),l=Math.floor(i/this.chunksize),m=j+"."+k+"."+l,m in this.chunks?(o=this.chunks[m],n=this.boundingBoxes[m]):(o=this.chunks[m]=[],n=this.boundingBoxes[m]=new e.Box3),o.push(b[r],b[r+1],b[r+2],b[s],b[s+1],b[s+2],b[t],b[t+1],b[t+2]),n.expandByPoint(q.set(b[r],b[r+1],b[r+2])),n.expandByPoint(q.set(b[s],b[s+1],b[s+2])),n.expandByPoint(q.set(b[t],b[t+1],b[t+2]))}else for(d=0,f=b.length;d<f;d+=9)g=(b[d]+b[d+3]+b[d+6])/3,h=(b[d+1]+b[d+4]+b[d+7])/3,i=(b[d+2]+b[d+5]+b[d+8])/3,j=Math.floor(g/this.chunksize),k=Math.floor(h/this.chunksize),l=Math.floor(i/this.chunksize),m=j+"."+k+"."+l,m in this.chunks?(o=this.chunks[m],n=this.boundingBoxes[m]):(o=this.chunks[m]=[],n=this.boundingBoxes[m]=new e.Box3),o.push(b[d],b[d+1],b[d+2],b[d+3],b[d+4],b[d+5],b[d+6],b[d+7],b[d+8]),n.expandByPoint(q.set(b[d],b[d+1],b[d+2])),n.expandByPoint(q.set(b[d+3],b[d+4],b[d+5])),n.expandByPoint(q.set(b[d+6],b[d+7],b[d+8]))},d.prototype.build=function(){var a=new e.Object3D;a.material=this.material;for(var b in this.chunks){var c=this.chunks[b],d=new e.BufferGeometry;d.addAttribute("position",new e.BufferAttribute(new Float32Array(c),3)),d.boundingBox=this.boundingBoxes[b];var f=new e.Mesh(d,this.material);f.material.visible=!1,a.add(f),this.chunks[b]=[]}return a},b.exports=d},{"../enum/Viewmode":51,three:177}],110:[function(a,b,c){"use strict";function d(b,c,d){var f=a("../enum/LanguageType");e.Object3D.call(this),this.model=b,this.floorIndex=c,location.host.indexOf(".biz")>-1&&(b.mlanguage_type=1),b.mlanguage_type===f.Chinese?this.name=d||c+1+" "+b.language.floor.level:this.name=d||b.language.floor.level+" "+(c+1),this.panos=[],this.chunks=[],this.colliderBuilder=new i(3),this.collider=null,this.center=null,this.boundingBox=new e.Box3,this.size=null,this.hidden=!1,this.conservativeBoundingBox=new e.Box3,this.debugColor=16777215*Math.random(),this.transition=null,this.pano360Position=null}var e=a("three"),f=a("../conf"),g=a("../util/common"),h=a("../util/lerp"),i=a("./ChunkedCollider"),j=a("../util/transitions"),k=a("../util/easing"),l=(a("../objects/Panorama"),a("../enum/RenderOrder"));d.prototype=Object.create(e.Object3D.prototype),d.prototype.enter=function(a){this.model.setFloor(this,a)},d.prototype.hide=function(a){if(!this.hidden||this.transition){this.chunks.forEach(function(a){a.material.transparent=!0}),j.cancel(this.transition);var b=a?0:f.hideFloorDuration+f.hideFloorDelay,c=a?0:f.hideFloorDelay/b;this.transition=j.start(h.allUniforms(this.chunks,"opacity",.08),b,function(){this.hidden=!0}.bind(this),c,k.easeInOutQuad)}},d.prototype.show=function(a){if(this.hidden||this.transition){this.hidden=!1,j.cancel(this.transition);var b=a?f.showFloorDuration:f.showFloorDuration+f.showFloorDelay,c=a?0:f.showFloorDelay/b;this.transition=j.start(h.allUniforms(this.chunks,"opacity",1),b,function(){this.hidden||this.chunks.forEach(function(a){a.material.transparent=!1})}.bind(this),c,k.easeInOutQuad)}},d.prototype.toggle=function(a,b){a=void 0===a?this.hidden:a,a?this.show(b):this.hide(b)},d.prototype.containsPoint=function(a){return this.collider.children.some(function(b){return b.geometry.boundingBox||b.geometry.computeBoundingBox(),b.geometry.boundingBox.containsPoint(a)})},d.prototype.distanceToPoint=function(a){var b=null,c=1/0;return this.collider.children.forEach(function(d){d.geometry.boundingBox||d.geometry.computeBoundingBox();var e=d.geometry.boundingBox.distanceToPoint(a);(!b||c>e)&&(c=e,b=d)}),c},d.prototype.addChunk=function(a){a.renderOrder=l.ghostFloor,this.add(a),this.chunks.push(a),this.boundingBox.union(a.geometry.boundingBox),this.size=this.boundingBox.size(),this.colliderBuilder.add(a.geometry)},d.prototype.addPano=function(a){this.panos.push(a),this.add(a.skyboxMesh),a.marker&&this.add(a.marker);var b=new e.Vector3(1,1,1);2==a.alignmentType&&(null==this.pano360Position&&(this.pano360Position=new e.Vector3((this.boundingBox.min.x+this.boundingBox.max.x)/2,this.boundingBox.min.y-2.1,(this.boundingBox.min.z+this.boundingBox.max.z)/2)),a.position=this.pano360Position,a.skyboxMesh.position.copy(a.position),b=new e.Vector3(4,4,4));var c=(new e.Box3).setFromCenterAndSize(a.position,b);this.boundingBox.union(c)},d.prototype.build=function(){this.collider=this.colliderBuilder.build(!0),this.add(this.collider),this.center=this.boundingBox.center(),this.conservativeBoundingBox.copy(this.boundingBox),this.conservativeBoundingBox.min.y=g.lowerMedian(this.collider.children.map(function(a){return a.geometry.boundingBox.min.y}),5),this.conservativeBoundingBox.max.y=g.lowerMedian(this.collider.children.map(function(a){return a.geometry.boundingBox.max.y}),5),this.colliderBuilder=null},d.prototype.toShortString=function(){return g.nth(this.floorIndex+1)},d.prototype.toString=function(){return this.name},b.exports=d},{"../conf":7,"../enum/LanguageType":26,"../enum/RenderOrder":39,"../objects/Panorama":113,"../util/common":145,"../util/easing":147,"../util/lerp":152,"../util/transitions":162,"./ChunkedCollider":109,three:177}],111:[function(a,b,c){function d(){function a(a){a+="",x=a.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var b=/(\d+)(\d{3})/;b.test(x1);)x1=x1.replace(b,"$1,$2");return x1+x2}var b=this;e.Object3D.call(this),this.points=[],this._showDistances=!0,this._showArea=!0,this._closed=!0,this.maxMarkers=Number.MAX_SAFE_INTEGER,this.spheres=[],this.edges=[],this.sphereLabels=[],this.edgeLabels=[],this.angleLabels=[],this.areaLabel=new f(""),this.areaLabel.setBorderColor({r:0,g:255,b:0,a:0}),this.areaLabel.setBackgroundColor({r:0,g:255,b:0,a:0}),this.areaLabel.setTextColor({r:180,g:220,b:180,a:1}),this.areaLabel.material.depthTest=!1,this.areaLabel.material.opacity=1,this.add(this.areaLabel);var c=new e.SphereGeometry(.4,10,10);this.color=new e.Color(4443610);var d=function(){return new e.MeshLambertMaterial({shading:e.SmoothShading,color:b.color,ambient:11184810,depthTest:!0})},g=function(a){a.target.material.emissive.setHex(8947848)},h=function(a){a.target.material.emissive.setHex(0)},i=function(a){var c=a.tool,d=(c.dragstart,c.mouse,c.getMousePointCloudIntersection());if(d){var e=b.spheres.indexOf(c.dragstart.object);b.setPosition(e,d)}a.event.stopImmediatePropagation()},j=function(a){};this.addMarker=function(a){this.points.push(a);var b=new e.Mesh(c,d());b.addEventListener("move",g),b.addEventListener("leave",h),b.addEventListener("drag",i),b.addEventListener("drop",j),this.add(b),this.spheres.push(b);var k=new e.Geometry;k.vertices.push(new e.Vector3,new e.Vector3),k.colors.push(this.color,this.color,this.color);var l=new e.LineBasicMaterial({linewidth:1});l.depthTest=!0;var m=new e.Line(k,l);m.visible=!0,this.add(m),this.edges.push(m);var n=new f(0);n.setBorderColor({r:0,g:255,b:0,a:0}),n.setBackgroundColor({r:0,g:255,b:0,a:0}),n.material.depthTest=!1,n.visible=!1,this.edgeLabels.push(n),this.add(n);var o=new f;o.setBorderColor({r:0,g:255,b:0,a:0}),o.setBackgroundColor({r:0,g:255,b:0,a:0}),o.material.depthTest=!1,o.material.opacity=1,o.visible=!1,this.angleLabels.push(o),this.add(o);var p={type:"marker_added",measurement:this};this.dispatchEvent(p),this.setPosition(this.points.length-1,a)},this.removeMarker=function(a,b){if(b||0!==a&&1!==a){this.points.splice(a,1),this.remove(this.spheres[a]);var c=0===a?0:a-1;this.remove(this.edges[c]),this.edges.splice(c,1),this.remove(this.edgeLabels[c]),this.edgeLabels.splice(c,1),this.spheres.splice(a,1),this.update()}},this.setPosition=function(a,b){this.points[a].copy(b);var c={type:"marker_moved",measure:this,index:a,position:b.clone()};this.dispatchEvent(c),this.update()},this.getArea=function(){for(var a=0,b=this.points.length-1,c=0;c<this.points.length;c++){var d=this.points[c],e=this.points[b];a+=(e.x+d.x)*(d.z-e.z),b=c}return Math.abs(a/2)},this.getAngleBetweenLines=function(a,b,c){var d=(new e.Vector3).subVectors(b,a),f=(new e.Vector3).subVectors(c,a);return d.angleTo(f)},this.update=function(){if(0!==this.points.length){if(1===this.points.length){var c=this.points[0];return this.spheres[0].position.copy(c),void(this.spheres[0].depthTest=!1)}for(var d=this.points.length-1,f=new e.Vector3,g=0;g<=d;g++){var c=this.points[g];f.add(c)}f.divideScalar(this.points.length);for(var g=0;g<=d;g++){var h=g,i=g+1>d?0:g+1,j=0===g?d:g-1,k="m",c=this.points[h],l=this.points[i],m=this.points[j],n=this.spheres[h];$(".unit-selection").hasClass("unit-toggle")?k="ft":!1===$(".unit-selection").hasClass("unit-toggle")&&(k="m"),n.position.copy(c),n.material.color=b.color;var o=this.edges[h];o.material.color=b.color,o.geometry.vertices[0].copy(c),o.geometry.vertices[1].copy(l),o.geometry.verticesNeedUpdate=!0,o.geometry.computeBoundingSphere(),o.visible=h<d||this.closed;var p=this.edgeLabels[g],q=(new e.Vector3).add(c);q.add(l),q=q.multiplyScalar(.5);var r=c.distanceTo(l);p.position.copy(q),"m"===k?p.setText(r.toFixed(2)+"m"):"ft"===k&&(r*=3.28,p.setText(r.toFixed(2)+"ft")),p.visible=this.showDistances&&(h<d||this.closed)&&this.points.length>=2&&r>0;var s=this.angleLabels[g],t=this.getAngleBetweenLines(c,m,l),u=l.clone().sub(m);u.multiplyScalar(.5),u=m.clone().add(u).sub(c).normalize();var v=Math.min(c.distanceTo(m),c.distanceTo(l));v/=9;var w=c.clone().add(u.multiplyScalar(v));s.position.copy(w);var x=a((t*(180/Math.PI)).toFixed(1))+"°";s.setText(x),s.visible=this.showAngles&&(h<d||this.closed)&&this.points.length>=3&&t>0}if(this.areaLabel.position.copy(f),this.areaLabel.visible=this.showArea&&this.points.length>=3,"m"===k)var x=a(this.getArea().toFixed(1))+"m²";else if("ft"===k)var x=a((10.764*this.getArea()).toFixed(1))+"ft²";this.areaLabel.setText(x)}}}var e=a("three"),f=(a("../conf"),a("../util/common"),a("./TextSprite"));a("./Panorama"),a("../enum/RenderOrder");d.prototype=Object.create(e.Object3D.prototype),Object.defineProperty(d.prototype,"showArea",{get:function(){return this._showArea},set:function(a){this._showArea=a,this.update()}}),Object.defineProperty(d.prototype,"closed",{get:function(){return this._closed},set:function(a){this._closed=a,this.update()}}),Object.defineProperty(d.prototype,"showDistances",{get:function(){return this._showDistances},set:function(a){this._showDistances=a,this.update()}}),b.exports=d},{"../conf":7,"../enum/RenderOrder":39,"../util/common":145,"./Panorama":113,"./TextSprite":119,three:177}],112:[function(a,b,c){"use strict";function d(a){this.player=a,this.obj3d=null,this.UP=new e.Vector3(0,1,0)}var e=a("three"),f=a("../conf");d.prototype.prefs={linewidth:3,height:.07,opacity:.45,endScale:.05},d.prototype.discard=function(){if(this.obj3d){var a=this.obj3d.parent;a&&a.remove(this.obj3d)}this.obj3d=null},d.prototype.draw=function(){if(this.discard(),f.showNeighbors){var a=this.player.currentPano.floor;this.obj3d=new e.Object3D;var b=this.player.model.panos.getNeighbours(this.player.currentPano),c=this.player.currentPano.floorPosition.clone().sub(this.player.model.position);c.y+=this.prefs.height;var d=.1525,g=.0127,h=.255,i=new e.Matrix4;for(var j in b)if(b[j]){var k=this.player.model.panos.get(j),l=(k.position.clone().sub(this.player.model.position),k.position.clone().sub(k.floorPosition)),m=k.floorPosition.clone().sub(this.player.model.position);m.y+=this.prefs.height;var n=new e.Geometry;n.vertices.push(new e.Vector3(0,-g,0),new e.Vector3(-g,0,0),new e.Vector3(0,g,0),new e.Vector3(g,0,0),new e.Vector3(0,-g,0)),n.vertices.push(new e.Vector3(0,-h,0),new e.Vector3(h,-h,0),new e.Vector3(h,d,0),new e.Vector3(-d,d,0),new e.Vector3(-d,.127,0),new e.Vector3(-.19,.1,0),new e.Vector3(-.19,-.2032,0),new e.Vector3(-d,-.2286,0),new e.Vector3(-d,-h,0),new e.Vector3(0,-h,0)),i.identity().setPosition(l),n.applyMatrix(i),n.vertices.push(new e.Vector3(0,-this.prefs.endScale,0)),n.vertices.push(new e.Vector3(-this.prefs.endScale,-this.prefs.endScale,0),new e.Vector3(-this.prefs.endScale,this.prefs.endScale,0),new e.Vector3(this.prefs.endScale,this.prefs.endScale,0),new e.Vector3(this.prefs.endScale,-this.prefs.endScale,0)),i.lookAt(m,c,this.UP).setPosition(m),n.applyMatrix(i),n.vertices.push(m,c);var o=new e.Line(n,new e.LineBasicMaterial({color:k.debugColor.getHex(),transparent:!0,opacity:this.prefs.opacity,depthWrite:!1,name:"sLine"+j,linewidth:this.prefs.linewidth
}));this.obj3d.add(o)}a.add(this.obj3d)}},d.prototype.update=function(){f.showNeighbors&&this.obj3d&&this.obj3d.updateMatrixWorld()},b.exports=d},{"../conf":7,three:177}],113:[function(a,b,c){(function(c){"use strict";function d(a,b,c,d){a.location_url&&(0==a.location_enable?C=1:1==a.location_enable&&(A=p.loadurl(f.splitUrl(a.location_url)))),this.model=a,this.enable=c.enable,this.id=b,this.alignmentType=c.alignmentType||l.ALIGNED,this.u=c.u||0,this.v=c.v||0,this.neighbourUUIDs=c.neighbours||null,this.neighbourPanos=null,this.floor=null,this.floorIndex=c.floor,this.failedLoadingAt=0,this.maxLoadRetries=4,this.adjustAngleEnable=c.angle_enable,this.adjustTAngleX=0,this.adjustTAngleY=0,this.adjustTAngleZ=0,this.adjustAngleX=c.angle_x,this.adjustAngleY=c.angle_y,this.adjustAngleZ=c.angle_z,this.color={brightness:c.color.brightness,contrast:c.color.contrast,gamma:c.color.gamma,hue:c.color.hue,saturation:c.color.saturation,vibrance:c.color.vibrance,balance:c.color.balance},this.origin=c.position.clone(),this.originPosition=c.position.clone(),this.position=this.alignmentType===l.UNALIGNED?new h.Vector3(0,-5,0):c.position.clone(),this.quaternion=c.quaternion.clone(),this.skyboxMesh=new h.Mesh(y),this.skyboxMesh.position.copy(this.position),this.skyboxMesh.quaternion.copy(this.quaternion),this.skyboxMesh.name="skybox",this.skyboxMesh.visible=!1,this.skyboxMesh.updateMatrix(),this.marker=null,this.isAligned()&&(this.marker=new h.Mesh(z,new h.MeshBasicMaterial({map:this.enable?A:B,side:h.DoubleSide,opacity:0,transparent:!0,depthWrite:!1})),this.marker.renderOrder=k.panoMarker,this.marker.name="marker",this.marker.pano=this,j.colorMarkerOnLoad&&this.on("load",function(){this.marker.material.color.set(65280)})),this.debugColor=(new h.Color).setHSL(.06+.53*Math.random(),.8+.2*Math.random(),.5+.2*Math.random()),this.floorPosition=c.puck?c.puck.clone():null,this.tiled=d,this.tiled?this.solidSkybox=null:(this.solidSkybox=new h.Texture([null,null,null,null,null,null]),this.solidSkybox.flipY=!1,j.minimalMemoryMode&&(this.solidSkybox.minFilter=h.LinearFilter,this.solidSkybox.magFilter=h.LinearFilter,this.solidSkybox.generateMipmaps=!1)),this.zoomed=!1,this.panoRenderer=null,this.qualityManager=null,this.tileDownloader=null,this.tiledPanoRenderTarget=null,this.minimumTiledPanoLoaded=!1,this.highestPartialTileRenderOpCompleted=0,this.highestFullTileRenderOpCompleted=0,this.shouldRedrawOnBaseLoaded=!1,this.lockUntilRenderingComplete=!1,j.colorMarkerOnLoad&&this.on("load",function(){this.marker.material.color.set(65280)}),1===C&&this.marker&&this.marker.visible&&(this.marker.visible=!1);var e=new h.TextureLoader;e.setCrossOrigin(!0);var g=e.load(f.splitUrl("https://template2.3dnest.cn/common/image/texture.jpg"));if(this.vrMarker=new h.Mesh(new h.OctahedronGeometry(.1,0),new h.MeshLambertMaterial({color:16777215,transparent:!0,opacity:.75,map:g})),this.vrMarker.boluoType="vr",this.vrMarker.position.z=1,this.vrMarker.enabled=!0,this.vrMarker.visible=!1,window.vrMarkers=window.vrMarkers||[],window.vrMarkers.push(this.vrMarker),this.marker&&this.marker.add(this.vrMarker),j.showAxis&&(this.skyboxMesh.add(new h.ArrowHelper(new h.Vector3(0,1,0),new h.Vector3(0,0,0),1,255)),this.skyboxMesh.add(new h.ArrowHelper(new h.Vector3(0,0,1),new h.Vector3(0,0,0),1,16711680)),this.skyboxMesh.add(new h.ArrowHelper(new h.Vector3(1,0,0),new h.Vector3(0,0,0),1,65280))),this.adjustAngleEnable){var i=new h.Quaternion;i.setFromAxisAngle(new h.Vector3(1,0,0),this.adjustAngleX),this.skyboxMesh.quaternion.multiply(i);var m=new h.Quaternion;m.setFromAxisAngle(new h.Vector3(0,1,0),this.adjustAngleY),this.skyboxMesh.quaternion.multiply(m);var n=new h.Quaternion;n.setFromAxisAngle(new h.Vector3(0,0,1),this.adjustAngleZ),this.skyboxMesh.quaternion.multiply(n),this.skyboxMesh.updateMatrix(),this.skyboxMesh.updateMatrixWorld(),this.model.updateProjectedPanos()}}var e=a("../gui/offLine"),f=new e,g=a("../util/browser"),h=a("three"),i=a("../util/logger"),j=a("../conf"),k=(a("../enum/Viewmode"),a("../enum/RenderOrder")),l=a("../enum/AlignmentType"),m=(a("../util/common"),a("../util/transitions")),n=a("../util/lerp"),o=a("../util/ajax"),p=a("../util/texture"),q=a("../util/panorama"),r=(a("../enum/TileDownloaderEvents"),a("../enum/PanoramaEvents")),s=a("../enum/PanoRendererEvents"),t=a("../enum/PanoSizeClass"),u=(a("../scene/SceneRenderer"),a("../enum/GLCubeFaces"),a("../exception/BasicException")),v=a("../tile/TileUtils"),w=a("events").EventEmitter,x=new i(c),y=new h.SphereBufferGeometry(.1),z=new h.PlaneBufferGeometry(.2,.2,1,1),A=p.loadurl(f.splitUrl("https://template2.3dnest.cn/common/image/location_512x512.png")),B=p.loadurl(f.splitUrl("https://template2.3dnest.cn/common/image/disable_512x512.png")),C=parseInt(g.getQueryString("reticule"));d.prototype=Object.create(w.prototype),d.prototype.enter=function(){this.emit("enter")},d.prototype.exit=function(){this.tiled?(this.clearWaitDeferreds(),this.minimumTiledPanoLoaded=!1,this.tiledPanoRenderTarget=null,this.setZoomed(!1),this.panoRenderer.deactivateTiledPano(this),this.highestPartialTileRenderOpCompleted=0,this.highestFullTileRenderOpCompleted=0):(this.solidSkybox.dispose(),this.solidSkybox.loaded=!1,this.solidSkybox.version=0),this.emit("exit")},d.prototype.hoverOn=function(a){this.marker&&(m.start(n.property(this.marker.material,"opacity",j[a].markerOpacityOnHover),250),j.navigation.panoScores&j.navigation.mouseDirection&&this.addTextSprite("HIT",12525854)),console.log("pano:",this.id)},d.prototype.hoverOff=function(a){this.marker&&m.start(n.property(this.marker.material,"opacity",j[a].markerOpacity),250)},d.prototype.build1=function(){this.floor=this.floor||this.model.floors.get(this.floorIndex)||this.raycastToFindFloor()||this.model.getFloorAtPoint(this.position),this.floor.addPano(this),this.floorPosition=this.floorPosition||this.raycastFloorPosition(),this.neighbourPanos=this.neighbourPanos||this.findNeighourPanos(),j.colorMarkerByFloor&&this.marker&&this.marker.material.color.set(this.floor.debugColor)},d.prototype.build2=function(){this.floorPosition=this.floorPosition||this.interpolateFloorPosition(),this.height=this.position.distanceTo(this.floorPosition),this.placeMarker()},d.prototype.updateAngleDisplay=function(){$("#x_adjust_value").text(this.adjustAngleX),$("#y_adjust_value").text(this.adjustAngleY),$("#z_adjust_value").text(this.adjustAngleZ)},d.prototype.updateColorDisplay=function(){$("input","#dat-brightness").val(parseInt(100*this.color.brightness)),$(".slider-fg","#dat-brightness").css("width",parseInt((this.color.brightness+1)/2*100)+"%"),$("input","#dat-contrast").val(parseInt(100*this.color.contrast)),$(".slider-fg","#dat-contrast").css("width",parseInt((this.color.contrast+1)/2*100)+"%"),$("input","#dat-gamma").val(parseInt(100*this.color.gamma)),$(".slider-fg","#dat-gamma").css("width",parseInt(this.color.gamma/3*100)+"%"),$("input","#dat-hue").val(parseInt(100*this.color.hue)),$(".slider-fg","#dat-hue").css("width",parseInt((this.color.hue+1)/2*100)+"%"),$("input","#dat-saturation").val(parseInt(100*this.color.saturation)),$(".slider-fg","#dat-saturation").css("width",parseInt((this.color.saturation+1)/2*100)+"%"),$("input","#dat-vibrance").val(parseInt(100*this.color.vibrance)),$(".slider-fg","#dat-vibrance").css("width",parseInt((this.color.vibrance+1)/2*100)+"%"),$("input","#dat-balance_R").val(parseInt(100*this.color.balance.x)),$(".slider-fg","#dat-balance_R").css("width",parseInt((this.color.balance.x+1)/2*100)+"%"),$("input","#dat-balance_G").val(parseInt(100*this.color.balance.y)),$(".slider-fg","#dat-balance_G").css("width",parseInt((this.color.balance.y+1)/2*100)+"%"),$("input","#dat-balance_B").val(parseInt(100*this.color.balance.z)),$(".slider-fg","#dat-balance_B").css("width",parseInt((this.color.balance.z+1)/2*100)+"%")},d.prototype.changeColor=function(a,b,c){"balance_R"===b?this.color.balance.x=c/100:"balance_G"===b?this.color.balance.y=c/100:"balance_B"===b?this.color.balance.z=c/100:this.color[b]=c/100,a.setProjectedPanos(this,this,!1)},d.prototype.resetColor=function(a){this.color.brightness=0,this.color.contrast=0,this.color.gamma=1,this.color.hue=0,this.color.saturation=0,this.color.vibrance=0,this.color.balance=new THREE.Vector3,this.updateColorDisplay(),a.setProjectedPanos(this,this,!1)},d.prototype.applyAllColor=function(a){for(var b=0;b<a.panos.list.length;b++)a.panos.list[b].color.brightness=this.color.brightness,a.panos.list[b].color.contrast=this.color.contrast,a.panos.list[b].color.gamma=this.color.gamma,a.panos.list[b].color.hue=this.color.hue,a.panos.list[b].color.saturation=this.color.saturation,a.panos.list[b].color.vibrance=this.color.vibrance,a.panos.list[b].color.balance.copy(this.color.balance)},d.prototype.updateTAngleDisplay=function(){$("#input_y").val(this.adjustTAngleY),$("#location_id").text(this.id)},d.prototype.updateAngle=function(a,b){function c(a){var b=parseFloat(a);if(!isNaN(b))return b=Math.round(1e3*a)/1e3}if("x"==a){var d=new h.Vector3(1,0,0);if(0==b){var e=new h.Quaternion;e.setFromAxisAngle(d,-this.adjustAngleX),this.skyboxMesh.quaternion.multiply(e),this.adjustAngleX=0}else if(1==b){var e=new h.Quaternion;void 0==this.adjustAngleX&&(this.adjustAngleX=0),this.adjustAngleX+=.005,this.adjustAngleX=c(this.adjustAngleX),e.setFromAxisAngle(d,.005),this.skyboxMesh.quaternion.multiply(e)}else if(2==b){var e=new h.Quaternion;void 0==this.adjustAngleX&&(this.adjustAngleX=0),this.adjustAngleX-=.005,this.adjustAngleX=c(this.adjustAngleX),e.setFromAxisAngle(d,-.005),this.skyboxMesh.quaternion.multiply(e)}$("#x_adjust_value").text(this.adjustAngleX)}else if("y"==a){var d=new h.Vector3(0,1,0);if(0==b){var e=new h.Quaternion;e.setFromAxisAngle(d,-this.adjustAngleY),this.skyboxMesh.quaternion.multiply(e),this.adjustAngleY=0}else if(1==b){var e=new h.Quaternion;void 0==this.adjustAngleY&&(this.adjustAngleY=0),this.adjustAngleY+=.005,this.adjustAngleY=c(this.adjustAngleY),e.setFromAxisAngle(d,.005),this.skyboxMesh.quaternion.multiply(e)}else if(2==b){var e=new h.Quaternion;void 0==this.adjustAngleY&&(this.adjustAngleY=0),this.adjustAngleY-=.005,this.adjustAngleY=c(this.adjustAngleY),e.setFromAxisAngle(d,-.005),this.skyboxMesh.quaternion.multiply(e)}$("#y_adjust_value").text(this.adjustAngleY)}else if("z"==a){var d=new h.Vector3(0,0,1);if(0==b){var e=new h.Quaternion;e.setFromAxisAngle(d,-this.adjustAngleZ),this.skyboxMesh.quaternion.multiply(e),this.adjustAngleZ=0}else if(1==b){var e=new h.Quaternion;void 0==this.adjustAngleZ&&(this.adjustAngleZ=0),this.adjustAngleZ+=.005,this.adjustAngleZ=c(this.adjustAngleZ),e.setFromAxisAngle(d,.005),this.skyboxMesh.quaternion.multiply(e)}else if(2==b){var e=new h.Quaternion;void 0==this.adjustAngleZ&&(this.adjustAngleZ=0),this.adjustAngleZ-=.005,this.adjustAngleZ=c(this.adjustAngleZ),e.setFromAxisAngle(d,-.005),this.skyboxMesh.quaternion.multiply(e)}$("#z_adjust_value").text(this.adjustAngleZ)}this.skyboxMesh.updateMatrix(),this.skyboxMesh.updateMatrixWorld(),this.model.updateProjectedPanos()},d.prototype.updateTAngle=function(a,b){function c(a){var b=parseFloat(a);if(!isNaN(b))return b=Math.round(1e3*a)/1e3}if(""!==b){if("y"==a){var d=new h.Vector4(0,c(b),0,0);d.applyMatrix4(this.skyboxMesh.matrix),this.adjustTAngleY=c(b),$("#input_y").val(this.adjustTAngleY),this.position.setX(this.originPosition.x+d.x),this.position.setY(this.originPosition.y+d.y),this.position.setZ(this.originPosition.z+d.z),this.skyboxMesh.position.copy(this.position)}this.skyboxMesh.updateMatrix(),this.skyboxMesh.updateMatrixWorld(),this.model.updateProjectedPanos(),this.position.setFromMatrixPosition(this.skyboxMesh.matrixWorld)}},d.prototype.update=function(a){this.skyboxMesh.updateMatrixWorld(),this.position.setFromMatrixPosition(this.skyboxMesh.matrixWorld),this.marker&&(this.marker.updateMatrixWorld(),this.floorPosition.setFromMatrixPosition(this.marker.matrixWorld))},d.prototype.interpolateFloorPosition=function(){var a=this.model.panos.filter(d.filters.isNeighbourPanoTo(this)).filter(function(a){return!!a.floorPosition}).sort(function(a,b){return a.position.distanceTo(this.position)-b.position.distanceTo(this.position)}.bind(this)),b=this.position.clone();return a.length>=2?b.y=(a[0].floorPosition.y+a[1].floorPosition.y)/2:b.add(j.noMeshFloorPositionOffset),b},d.prototype.raycastFloorPosition=function(){x.warn("Performance warning: Raycasting to find floor position");var a=new h.Raycaster(this.position,new h.Vector3(0,-1,0)),b=a.intersectObjects(this.model.colliders);return b.length?b[0].point:null},d.prototype.raycastToFindFloor=function(){var a=[new h.Vector3(0,-1,0),new h.Vector3(1,-1,0),new h.Vector3(0,-1,1),new h.Vector3(-1,-1,0),new h.Vector3(0,-1,-1),new h.Vector3(1,0,0),new h.Vector3(0,0,1),new h.Vector3(-1,0,0),new h.Vector3(0,0,-1)];return function(){x.warn("Performance warning: Raycasting to find floor index");for(var b=0;b<a.length;b++){var c=new h.Raycaster(this.position.clone(),a[b].clone()),d=c.intersectObjects(this.model.colliders);if(d.length)return d[0].object.parent.parent}return null}}(),d.prototype.placeMarker=function(){this.marker&&(this.marker.position.copy(this.floorPosition),this.marker.position.y+=.05,this.marker.lookAt(new h.Vector3(0,1,0).add(this.marker.position)))},d.prototype.findClosestMidtpointPanoTo=function(a){return(new h.Vector3).addVectors(this.position,a.position).divideScalar(2),this.model.panos.find([d.filters.notIn([this,a])],[d.sortFunctions.distanceToPoint(point)])},d.prototype.attachToPanoRenderer=function(a){this.panoRenderer=a,this.panoRenderer.on(s.TileRenderSuccess,this.onTileRendered.bind(this)),this.panoRenderer.on(s.PanoRenderComplete,this.onPanoRendered.bind(this)),this.panoRenderer.on(s.TileRenderFailure,this.onTileRenderFail.bind(this)),this.panoRenderer.on(s.UploadAttemptedForAllTiles,this.onUploadAttemptedForAllTiles.bind(this))};var D={};d.prototype.getWaitDeferred=function(a){var b=D[this.id];b||(b={},D[this.id]=b);var c=b[a];return c||(c={deferred:$.Deferred(),active:!1},b[a]=c),c},d.prototype.resetWaitDeferred=function(a){var b=this.getWaitDeferred(a);b.active=!1,b.deferred=$.Deferred()},d.prototype.clearWaitDeferreds=function(){var a=D[this.id];a||(a={},D[this.id]=a);for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];c.active=!1,c.deferred=$.Deferred()}},d.prototype.loadTiledPano=function(){var a=[],b=[];return function(c,d,e,f,g,h){null!==f&&void 0!==f||(f=!0),null!==g&&void 0!==g||(g=!0);var i=this.getWaitDeferred(c),j=i.deferred,k=null,l=null;if(e&&("number"==typeof e?k=e:(k=e.hFov,l=e.vFov)),!this.isLoaded(c)){if(!i.active){if(i.active=!0,e){var m=v.matchingTilesInDirection(this,c,d,k,l);a[this.id+":"+c]={tileCount:0,targetTileCount:m},x.info("Loading partial pano: "+this.id+" with "+m+" tiles")}b[this.id]||(b[this.id]=!0,this.on(r.LoadComplete,function(a,b){var c=this.getWaitDeferred(a).deferred;c&&"pending"===c.state()&&this.highestPartialTileRenderOpCompleted>=a&&(c.resolve(a,b),this.resetWaitDeferred(a))}.bind(this)),this.on(r.LoadFailed,function(a){var b=this.getWaitDeferred(a).deferred;b&&"pending"===b.state()&&this.highestPartialTileRenderOpCompleted>=a&&(b.reject(a),this.resetWaitDeferred(a))}.bind(this)),this.on(r.TileLoaded,function(b,c,d){var e=this.getWaitDeferred(b).deferred;if(e&&"pending"===e.state()){e.notify(b,c,d);var f=a[this.id+":"+b];f&&++f.tileCount===f.targetTileCount&&(this.onPanoRendered(this.id,b,d,!0),e.resolve(b,d),this.resetWaitDeferred(b))}}.bind(this)))}this.tileDownloader.forceQueueTilesForPano(this,c,d,k,l,h),this.tiledPanoRenderTarget=this.panoRenderer.activateTiledPano(this,this.qualityManager.getMaxPanoSize(),f,g),this.panoRenderer.renderPanoTiles(this.id,d,g)}return j.promise()}}(),d.prototype.onUploadAttemptedForAllTiles=function(a,b,c){if(!g.isMobile()&&a===this.id){b===this.qualityManager.getPanoSize(t.BASE)&&this.shouldRedrawOnBaseLoaded&&(this.shouldRedrawOnBaseLoaded=!1,this.panoRenderer.resetRenderStatus(a),this.panoRenderer.renderPanoTiles(this.id,null,!0,!0))}},d.prototype.onTileRendered=function(a,b,c,d){a===this.id&&this.emit(r.TileLoaded,b,c,d)},d.prototype.onPanoRendered=function(a,b,c,d){a===this.id&&(this.minimumTiledPanoLoaded=!0,this.skybox=this.tiledPanoRenderTarget.texture,b>this.highestPartialTileRenderOpCompleted&&(this.highestPartialTileRenderOpCompleted=b),!d&&b>this.highestFullTileRenderOpCompleted&&(this.highestFullTileRenderOpCompleted=b),this.emit("load",b),this.model.emit("load",this),this.emit(r.LoadComplete,b,c))},d.prototype.onTileRenderFail=function(a,b,c){a===this.id&&this.emit(r.LoadFailed,b)},d.prototype.getSkyboxTexture=function(){return this.tiled?this.minimumTiledPanoLoaded?this.zoomed?this.panoRenderer.zoomRenderTarget.texture:this.tiledPanoRenderTarget.texture:null:this.solidSkybox},d.prototype.isLoaded=function(a){if(this.tiled){if(a&&"string"==typeof a)throw new u("Wrong panoSize given to Panorama.isLoaded(); a tiled pano uses PanoSizeClass");return!!this.minimumTiledPanoLoaded&&(!a||this.highestPartialTileRenderOpCompleted>=a)}if(a&&"number"==typeof a)throw new u("Wrong panoSize given to Panorama.isLoaded(); a non-tiled pano uses high/low.");return!!this.solidSkybox.high||a in this.solidSkybox},d.prototype.getAjustedColors=function(){return this.color},d.prototype.loadCube=function(a){if(this.isLoaded(a))return x.info("Skipping load of pano, already loaded"),$.when();this.emit("loading",a),this.model.emit("loading",this);var b=q.getCubemapUrls(this.model.urls,this.id,a),c=b.filter(function(a){return!a});"low"===a&&c.length>0&&(x.info("Pano",this.id,"not available in low res, loading high res right away"),a="high",b=q.getCubemapUrls(this.model.urls,this.id,a));var d=0,e=[0,1,2,3,4,5].map(function(a,c,d){return o.getImage(b[c])}.bind(this)),f=a;return $.when(e[0],e[1],e[2],e[3],e[4],e[5]).then(function(a,b,c,d,e,g){return this.solidSkybox[f]=[a,b,c,d,e,g],"high"!==f&&this.solidSkybox.high||(this.solidSkybox.image=this.solidSkybox[f],this.solidSkybox.low=null),this.solidSkybox.needsUpdate=!0,this.emit("load",f),this.model.emit("load",this),this}.bind(this),function(){I.error("Downloading cubemap for pano",this.id,"failed"),this.failedLoadingAt=Date.now()}.bind(this),function(){return $.when(++d,6)})},d.raycastsSkipped=0,d.raycastsDone=0,d.prototype.findNeighourPanos=function(){return this.model.panos.setNeighbour(this.id,this.id,!1),this.model.panos.forEach(function(a){if(a!==this&&(!this.model.panos.neighbourMap[this.id]||void 0===this.model.panos.neighbourMap[this.id][a.id])){var b=this.position.distanceTo(a.position);if(b>j.panoramaNeighbourMaxDistance)return this.model.panos.setNeighbour(this,a,!1),void d.raycastsSkipped++;var c=a.position.clone().sub(this.position).normalize(),e=new h.Raycaster(this.position,c.clone(),0,b),f=e.intersectObjects(this.model.colliders);d.raycastsDone++,this.model.panos.setNeighbour(this,a,0===f.length),j.showNeighbourRaycasts&&(f.length?this.floor.model.add(new h.ArrowHelper(c,this.position,f[0].distance,16711680)):this.floor.model.add(new h.ArrowHelper(c,this.position,b,16777215,0,0)))}}.bind(this)),this.model.panos.neighbourMap[this.id]},d.prototype.worldPosition=function(){return this.position},d.prototype.addTextSprite=function(a,b){this.removeTextSprite();var c=document.createElement("canvas"),d=c.getContext("2d");c.width=256,c.height=256;d.font="bold 60px Arial",d.fillStyle="white";var e=d.measureText(a).width;d.fillText(a,(c.width-e)/2,(c.height+60)/2);var f=new h.Texture(c);f.needsUpdate=!0;var g=new h.SpriteMaterial({map:f,color:b||16428055});this.text3d=new h.Sprite(g),this.text3d.position.copy(this.skyboxMesh.position),this.floor.add(this.text3d)},d.prototype.removeTextSprite=function(){this.text3d&&(this.floor.remove(this.text3d),this.text3d=null)},d.prototype.removeLocationTextSprite=function(){this.locationText&&(this.floor.remove(this.locationText),this.locationText=null)},d.prototype.isAligned=function(){return this.alignmentType===l.ALIGNED},d.filters={inDirection:function(a,b,c){return function(d){return d.position.clone().sub(a).normalize().dot(b)>c}},inFloorDirection:function(a,b,c){return function(d){return d.floorPosition.clone().sub(a).normalize().dot(b)>c}},inPanoDirection:function(a,b,c){return c=j.navigation.panoScores?j.navigation.filterStrictness:c,function(d){var e=d.floorPosition.clone().sub(a).normalize(),f=d.position.clone().sub(a).normalize();return e.dot(b)>c||f.dot(b)>c}},atFloor:function(a){return function(b){return!a||b.floor===a}},not:function(a){return function(b){return b!=a}},notIn:function(a){return function(b){return-1===a.indexOf(b)}},isLoaded:function(){return function(a){return a.isLoaded()}},isNotLoaded:function(){return function(a){return!a.isLoaded()}},isCloseEnoughTo:function(a,b){return function(c){return a.distanceTo(c.floorPosition)<b}},hasMinimumHeightDifferenceTo:function(a,b){return function(c){return Math.abs(c.position.y-a.y)>b}},isNotBehindNormal:function(a,b){var c=new h.Vector3;return b=b.clone(),function(d){return c.copy(d.position).sub(a).normalize().dot(b)>0}},isNeighbourPanoTo:function(a){return function(b){return!a||!a.neighbourPanos||!!a.neighbourPanos[b.id]}},isNeighbourOfNeighbourTo:function(a){return function(b){return!!a.neighbourPanos[b.id]||a.neighbourUUIDs.some(function(c){var d=a.model.panos.get(c);return!!d&&d.neighbourPanos[b.id]})}},isNotRecentlyFailed:function(a){return function(b){return Date.now()-b.failedLoadingAt>a}},isOnVisibleFloor:function(){return function(a){return!a.floor.hidden}},isPanoAligned:function(){return function(a){return a.isAligned()}}},d.sortFunctions={distanceToPoint:function(a){return function(b,c){return b.position.distanceTo(a)-c.position.distanceTo(a)}},floorDistanceToPoint:function(a){return function(b,c){return b.floorPosition.distanceTo(a)-c.floorPosition.distanceTo(a)}},choose:function(a){return function(b,c){return a.id===b.id?-1:a.id===c.id?1:0}}},d.scoreFunctions={distance:function(a,b){return b=b||j.navigation.distanceFactor,function(c){return a?a.position.distanceTo(c.position)*b:0}},distanceSquared:function(a,b){return b=b||j.navigation.distanceFactor,function(c){return a?a.position.distanceToSquared(c.position)*b:0}},direction:function(a,b){return function(c){return c.position.clone().sub(a).normalize().dot(b)*j.navigation.directionFactor}},angle:function(a,b){return function(c){return c.position.clone().sub(a).normalize().angleTo(b)*j.navigation.angleFactor}},inFieldOfView:function(a,b){return function(c){return c.position.clone().sub(a).normalize().dot(b)>.75?10:-1}},optionality:function(a){return function(b){return b.neighbourUUIDs.filter(function(b){return!(b in a.neighbourUUIDs)&&b!==a.id}).length*j.navigation.optionalityFactor}},penalizeHeightDifferenceUnder:function(a,b){return function(c){return a.y-c.position.y<b?-20:0}}},d.prototype.setZoomed=function(a){this.zoomed=a,this.updateSkyboxForZoomLevel()},d.prototype.updateSkyboxForZoomLevel=function(){this.minimumTiledPanoLoaded&&this.model.updateProjectedPanos()},d.prototype.ensureSkyboxReadyForRender=function(){this.tiled||(this.solidSkybox.loaded||(this.solidSkybox.needsUpdate=!0),this.solidSkybox.loaded=!0)},b.exports=d}).call(this,"/js/objects/Panorama.js")},{"../conf":7,"../enum/AlignmentType":16,"../enum/GLCubeFaces":22,"../enum/PanoRendererEvents":32,"../enum/PanoSizeClass":33,"../enum/PanoramaEvents":34,"../enum/RenderOrder":39,"../enum/TileDownloaderEvents":45,"../enum/Viewmode":51,"../exception/BasicException":54,"../gui/offLine":70,"../scene/SceneRenderer":125,"../tile/TileUtils":133,"../util/ajax":141,"../util/browser":142,"../util/common":145,"../util/lerp":152,"../util/logger":153,"../util/panorama":155,"../util/texture":161,"../util/transitions":162,events:170,three:177}],114:[function(a,b,c){"use strict";function d(a){var b=g.UniformsUtils.clone(l.waypoint.uniforms);b.map.value=n,b.opacity.value=0,b.color.value.set(h.reticuleColor),g.Mesh.call(this,new g.PlaneBufferGeometry(.2,.2,1,1),new g.RawShaderMaterial({side:g.DoubleSide,depthWrite:!1,depthTest:!1,transparent:!0,vertexShader:l.waypoint.vertexShader,fragmentShader:l.waypoint.fragmentShader,uniforms:b,name:"waypoint",opacity:0})),this.renderOrder=m.reticule,this.player=a,this.direction=new g.Vector3,this.hidden=!0,this.mouseLastMoveTime=Date.now(),this.editHidden=!1}var e=a("../gui/offLine"),f=new e,g=a("three"),h=a("../conf"),i=a("../util/transitions"),j=a("../util/texture"),k=a("../util/lerp"),l=a("../shaders"),m=a("../enum/RenderOrder"),n=j.loadurl(f.splitUrl("https://template2.3dnest.cn/common/image/pointermain_512x512.png"));d.prototype=Object.create(g.Mesh.prototype),d.prototype.move=function(a,b,c){this.editHidden?this.hidden=!0:(this.hidden=c,this.mouseLastMoveTime=Date.now())},d.prototype.hide=function(){this.hidden||(this.hidden=!0,i.start(k.property(this.material.uniforms.opacity,"value",0),h.reticuleOpacityTransitionTime))},d.prototype.show=function(){this.hidden=!1,this.material.opacity<=0&&i.start(k.property(this.material.uniforms.opacity,"value",h[this.player.mode].reticuleOpacity),h.reticuleOpacityTransitionTime)},d.prototype.update=function(){this.editHidden||Date.now()-this.mouseLastMoveTime>h.hideReticuleTimeout&&!this.hidden&&this.hide()},d.prototype.updatePosition=function(a,b){if(!this.hidden){if(!b)return this.hide();var c=b.point,d=a.distanceTo(c),e=1+.01*d;d<1&&(e-=1-d),this.show(),this.scale.set(e,e,e),this.direction=this.direction.multiplyScalar(.8),this.direction.add(b.face.normal.clone().multiplyScalar(.2)),this.position.copy(c).add(b.face.normal.clone().multiplyScalar(.01)),this.lookAt(this.position.clone().add(this.direction))}},d.prototype.writeAsMattertag=function(){var a=Math.floor(4294967296*(1+Math.random())).toString(16)+Math.floor(16*(1+Math.random())).toString(16),b=new Date;this.tagCount=void 0===this.tagCount?1:this.tagCount+1;var c={enabled:!0,version:"0",created:b.toISOString(),created_by:"APITest",position:this.position.clone(),stem:{enabled:h.mattertags.pole.enabled,direction:this.direction.multiplyScalar(h.mattertags.pole.height)},label:"Mattertag "+this.tagCount,description:"Description "+a,floor:function(a){if(a.currentFloor){var b=a.floors.indexOf(a.currentFloor);return b>-1?b:void 0}}(this.player.model),type:"info",metadata:{preferred_camera:{mode:this.player.mode}}};console.log("--------------------------"),console.log(JSON.stringify(c));var d=this.player.model.addMattertag(a,c).build();d&&(d.disc&&this.player.mattertagDiscs.push(d.disc),d.visible||d.show(h.mattertags.startup.fadeInDuration))},b.exports=d},{"../conf":7,"../enum/RenderOrder":39,"../gui/offLine":70,"../shaders":126,"../util/lerp":152,"../util/texture":161,"../util/transitions":162,three:177}],115:[function(a,b,c){"use strict";function d(a,b){this.chunks=[],this.floorId=a,this.roomId=b,this.position=new e.Vector3}var e=a("three");d.prototype.addChunk=function(a){this.chunks.push(a)},d.prototype.calcBoundaries=function(){for(var a=new e.Vector3,b=new e.Vector3(0,0,0),c=new e.Vector3(0,0,0),d=new e.Vector3(0,0,0),f=0,g=0;g<this.chunks.length;g++){var h=this.chunks[g],i=h.geometry.attributes.position;if(i)for(var j=0;j<i.array.length;j+=3)a.set(i.array[j],i.array[j+1],i.array[j+2]),b.add(a),0===j?(c.copy(a),d.copy(a)):(c.max(a),d.min(a)),f++}f>0?(b.multiplyScalar(1/f),this.average=b):this.average=null,this.boundsMax=c,this.boundsMin=d,this.center=new e.Vector3,this.center.copy(c).sub(d).multiplyScalar(.5).add(d)},b.exports=d},{three:177}],116:[function(a,b,c){(function(c){"use strict";function d(a,b){this.obj3d=null,this.nodes=[],this.colorHull=[],this.shortPaths={},this.floorHull=null,this.cameraHull=null,this.floorPathDistance=0,this.floorCurvePoints=null,this.floorCurveColors=null,this.camCurvePoints=null,this.warpDestHeroLoc=null,this.warpDestPano=null,this.warpPathPoints=null,this.warpPathLengths=[0],this.warpLength=0,this.closeWarpDistance=4,this.UP=u.UP.clone(),this.longestStep=0,this.upcomingTransType=null,this.burnsDir=1,this.prevNextDist=0,this.nextI=0,this.activeTransType=null,this.bunnyObj=null,this.director=a,this.player=b,this.modelManager=b.modelManager,this.updateModel(),this.updateDefaultsFromModelData(),this.bindEvents(),this.warping=!1,this.warpInterrupted=!1,this.warpInterruptionBlackoutStyle=null,this.warpInterruptionTravelTime=null}var e=a("../gui/offLine"),f=new e,g=a("three"),h=a("../util/logger"),i=a("../enum/Viewmode"),j=a("../enum/RenderOrder"),k=a("../enum/WarpStyle"),l=a("../conf"),m=a("../util/math"),n=a("../util/lerp"),o=a("../util/easing"),p=a("../util/transitions"),q=a("../objects/Snapshot"),r=a("../effects"),s=a("../shaders"),t=(a("../gui/gui"),a("../util/texture")),u=a("../enum/Vectors"),h=(a("../model/ModelManager"),new h(c)),v=a("../enum/PlayerEvents"),w=a("../enum/BlackoutStyle"),x=a("../enum/ModelManagerEvents"),y={path:t.loadurl(f.splitUrl("https://template2.3dnest.cn/common/image/location_512x512.png")),pathEnd:t.loadurl(f.splitUrl("https://template2.3dnest.cn/common/image/location_512x512.png")),
pathStart:t.loadBase64("iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAfF0lEQVR4nO2dC7SVVbXH/xzllYiKPA5gIioUgYJCmelVQdDUFMRHqGVompVghtK1xs1Xd2T3mtdur9FDr2ZXzTTSqAwVUVO73CAFJBK9IqYIgs9Qnp5zxzz+t+6z1358e+/vMdf65m+MPc5hrY+z17e+Nec311pzzdmlvb0dhtf0BDAEwFAAAwHsDqAvfxZ+3w1ADwDdAHQv+SlsBbCl5OdmAK8C2ADgZX4Kv78IYBWA1QA22fDxF1MAfrAjgOEA9gcwCsDeFPi9ALRmfAdrATxLhfAMgCcALAWwEsB252pDFaYA9CFv6nEADqLAy2cE39w+IZbECioD+SwEsIiWhaEEUwDZ0w/AIUWfsUWmeWjI1GIxgEeKPutz+txVYAogfboCOBTAMfyMylsHlCBThrv5eRjANucKIzFMAaTDIADHU+CPBNArDzfdABsBzKcymAtgjXd34BmmAJJjAICTAXySb/wuod5oQrTTIrgNwB0A1gV5lxljCiBe+gA4hUJ/OICWkG4uQ9oAPEhlcDuAV3LbEzFjCiAejgBwLoCpXMU3kkN2EeYA+CmAB6yfm8MUQOP0BzAdwDkAhvl6E57zFIDrANwI4KW8d0YjmAKon9EALgIwjSv6RvbIzsEvAFwDYIk9j+iYAojO0QAuBjDRlwbnlPsAfBvAvLx3RBRMAVRnBwBnUPD3q3qloY1lVAQ3A3jbnk55TAGUp4Ur+ZfTB9/wl5V8jrdxN8EowhRAZ7pwJf8KACOdWsNnlgO4jDsINuiJKYD3mATg3wGMcWqMkHgcwFcA3GtP1RQAuIV3DV11jfwgrsYXcSsxt+TZU603gKt5GMWEP3/IM3+CY6B3XjshrxbAWQC+RWcewxAnoksA3JC3nsibAtgXwE8AjHdqDANYAOBzAJ7OS1/kZQqwIxd+lprwG1UYzzHyFY6Z4MmDBXAAgOv50zCi8hiAz/JnsIRuAVzIWHQm/Ea9HMCxc2HIPReqBbAbF3QmOzWGUT93ceH41dD6LkQFcBDdPoc4NYbROKvpHr4wpD4MbQowC8AfTfiNBBjCsTUrpM4NxQLow6AQ5tBjpMFcBoPxPjRZCArgYAaD2NOpMYzkeI5BYf7kcx/7PAWQk3uzATxkwm9kwJ4ce7N9jvjsqwXQg4Eepjo1hpE+cxg4xru0Zz4qgF0A/AbAYU6NYWSHWAMnAHjdp2fgmwKQ9Nd/YMJMw9CGuBF/nOnTvcAnBSDn9u9hSmzD0IqkSj/KlzgDviwCjmM2WRN+Qzt7cayO8+FJ+aAAJvKYZj+nxjB00o9jVn0Iee0KQPZZf2fZdA0P6cWxO01z0zUrgJkAbgHQzakxDD/oxjE8U2trtQY9uIyx3I36eJNx8J/kzw3Muf+PKh9h5yofeZP1ZX6ED/DnTvZcIiNOQt+lu/oV6hqncBdgJjvMqMwaZr55suTzfMX/ES97UBkUfyRz0iB7ZlW5AMD3ql2QNtoUwDSaTN66VibEei4q3c+P1i0m2aqdwM94W7h1EGE7nWdXVKBJAUzkoonN+YHXADxIYV/A8NW+uWyKEh9FRSAK4XAAuzpX5Y+tAI5jEtPM0aIAxnGg53m1X+bjdwC4iW6loeWxa6H79pkATuaaQ17ZSMW4KOv716AAhtFxIo/m4ttMUSVCfyeATc4VYdITwBQqg0nMwpw3ZFp3SNbTuawVgPj2P5pDD78lFHpZ71jr1OaLVs6LRRmMztm9i9vwx7I8O5ClAtiFpm5eDva08dioZCRa7NQawlhm6Jmao5wVSzk1yuQUYVYKQM7zz8vJkd7tAG4FcBWAFU6tUY4RAL4K4LScJOiQF+HRWcQTyEIByOrwrwCc6NSExVbGKZQ3/qrA7zUphtIimJ6D3aE5XBxNVSCzMLNmBy78bwH4DoC9AZxnwt8Uq9iHe7NP3/L4Xmoh056La1wTO2lbAAfT3AnVrLsdwJcBvODUGHEwGMC1AE4JtDe3c1qcWqDRNBVAH+ZZCzGAp2zlzGDAEiN5JODG97mFHBrPMS1ZKiHH05oCdOF8ODThl337S+kHb8KfHvewzy8N0HdiT8pKKqSlAGYFmLRD3JZHAvgGgC1OrZE0W9j3I/ksQkJk5aI07ieNKcBHOe/v6tT4yTouTN0VyP2EgiSC/TGAAYHczzauB/yPUxMjSSuA3TjvDyVX3wJ6reXde08rrfSuHB/I/azmekBiWYmTngLcEIjwtzGYw0QTftWs5TO6IpDDVEMoQ4mRpAUg22H/4ZT6x1pmfbk/gHvJExOYPao1gHv+Mv0gYicpBXAg5y6+z/vnU/jXOTWGDwygEjjS86cl6wEHcTodK0lMAcTJ5zrPhb+dcQmPMuH3mnV8hpd5GFClGJGl65NwoEtCAcziwoWvbONC35UBBuXII218lqfz2frKAZStWIl7CrAvjzf2dGr8YCN9su/Nu9QEyiQeuvE18tQmHp9/2qlpkLgtgJ94LPzruX1kwh8u9/IZr/f0DntSxmIjTgVwtsf7rxKZ5VANMdqMxFnEZy3P3EdExs6Kq91xTQF680BMf6dGP8sYjMGblM5GLEg4unk8U+AbL/Eg1BvNtjsuC+Drngr/o3S3NOHPH/LMD+MY8I3+lLmmicMCGMa49b5FbFnGAfCaU2PkiV15VsU3S2Ar8y40FVU4DgvgGg+F/1ma/Sb8xmscC76tCXSj7DVFsxbAJA/Pwa/nItBKp8bIM5L09GEP81Mc1czOVTMKQIJ8/AXAGKdGL2oyshgq8TFD1eN0vW9IkJuZAkz1TPi3sc0m/EYlFnGM+OQxOIZtbohGLYAWevyNdGp0oi4rq6Ea37JUL6eHYN2u641aAJ/0SPjBwyAm/EZUZKxc7lFvjaRM1k0jFoAkcvwrF018YD4XSuxgj1EPLVzg9uUosSxqf4gJZyPTiAVwhkfCXwjmYcJfno/yY7i0cez4EgFqONtbF41YAMvogKCdNm5TWiSfytzKmtMqXmFM4DabD8lKl9WbbLfemzraE+EHQ0ab8FdmEICT+BlU8Srjfo4lH9iPMhqZehVA6rnLGmQBg0AYlTmfkWa68nejMldyTPlAXTJazxRgNJ0OtLOOe6MWvbcykp797wD68ooNAN6fRXpqj2jl+Pch74CM/yVOaRnqsQBSyVQSA+eZ8NfkjCLhB3+vewEpZ6zl2PKByLIa1QIYwDeG9kCfvw0wBVkSLCmzWLSUVp5RHRljx1W9Inu20aKrGdA2qgXwGQ+EX+KlXeCUGqWMLyP8YFkoGXWSZKYHCUm7UmZrElUBnOOU6OObAFZ50M6s+VKV769WZ7yDjLGrPOiLSDIbZQpwhAcroE9xC8Sy9FZnKCPKVlL8bYzsbIq0Ot255z6s6lXZIxbdA9VaUWkgFHOuU6KPGSb8kZhZ45m38BqjOls45rRTU3ZrWQB9AKyhxtPK7QBOtQFbEznj/jyAXWpc+DqAPRg7wajOLwGcUvWKbJFt3cEAXqnUimpvA1CwNAv/W0ycaNRmegThB6+Z7pQa5fgyx6BWetR6OUZRAJqRJAkv2NCsSZc6TfuZHp2Fz5IX4k7UkQBVZbjaFKCVN6j1EIRERd3bFEAkjgXwuzr/j+x1/94pNUoRE/sZxYFx29jGss5x1YT7pBr1WXODCX9kGtnesy3BaLzAsaiVFspyWapZABIr/Z+cUh1s5/ln266qzQcZwKVek76dASb+5tQYpQxlQI7Y03fHxB+ZA8Oh0ht+EENna+VWE/7IfKnB+XwXswIis6ootoJGDq105LuSAjhe8SJQmyeeWBqQrDefbqIdn+bfMGpzleLIU10qnZGppACOcUr0IPndVyhunybEEWSnJtqzkyeOYBpYwbGplbIyXW4NoCsdB7QmRxjLhCRGdSR46/8BGFL1qtqsBrBPvcEmc8pYxXknNtKxr1POg3IWwKGKhX+JCX9kpsQg/ODfmOKUGuVYHDUQRwb0KreuV04BlDUVlHCTDbvIxLmAZ4uB0dE8Rh3ZLjcF0Br19236qJd1aDA6ISGhHou5Sw7wJCRc1rTyzMUOCtv2RGka9FILoJ/iqL/3mvBH5kJP/maIrG0mW2/CjCrNflyqAA5R/EDM/I9Gf+a2i5tp/NtGbTSP1U4y7osC+AeAO51SoxyfT+gEZ3f+baM2d3LMasRLBXCHB3HYNNA1YSH9vAexITWwiWNWIxUVQA/uY2rEzP9oSIbYgQn+/YGNZqHNIVrH7FjKegfFCmCc0iONr/FgklGbNKIiW+TlaDzEsauNbpT1DooVwEEKGys8aNl9I/ExAB9O4Xs+zO8yqtPGsauRd2W9WAGUixWvAUvwGY00nXXMMSgaWsfuu7JuCiAMxEFqaop3MpXfaVTHGwUggQxGOJdlz3oAyxW2SxvnpxyMYkfLKByJ5RzD2hhRGC8FBTBcafTfBYxMY1SmZ0ZHds/ldxuVaVeaVKc7Zf5dBWDmv798CsDuGbR+d363UR3V04CCAtDq/28KoDZZbsvZlmBttI7hDpkvKIB9nOrsWcOcf0ZljsxYeY9iG4zKPMWxrA0Jqf+uAthLYQOXOSVGKRq242xLsDYax7JEMlatAJ50Soxi9mHyjqw5TqkFqQmNY7lD5lu4ktvqVGePKYDq1Mr0mxaWUbg2GseyyHzPlpjixiWBKYDK7AzgrIq16XMW22SUR+tYHtJSmAsoxBRAZUTgelesTZ/eyhSSNrSO5aEtCR8fbZQ3GVfNcJEkDzOc0uyZYRmFK/I8x7Q2BrZk5ERSC3v7V0YW3YZVrM2OYUoWJbWyUmG7dhcF0Ncpzh5TAJXRvO1mW4KV0Zhkta9WC0CjttSAZOudqLh9E9lGw0WjU5taC+Blp8SAJ29YswLKs6FsabaotQC0RlTNkj6eHL75FNtqdEbjmO6wADQ+LFMALnL89n1OqT7eZxmFy6JxTO/WojQOgCmAzuzgWQCO85WmxsoSjWO6hykAP5AQXO/3qL3vTzlEmQ9oHNPdW5SGAt/olOQbHxfWbDGwMxrHdDetCsAsgPcYqzxnYyUOUZxoJgs0juluNgXQj89vUrMC3kPlFKBLe3v7doULNqKUtjql+WMAgOeUWmlRkGe4J4B1+puaOPIMtyhr09sazpMblfmCx8IPtv0LTqmhBrEA3lIY3rmveQN2CM9ztAJ8Zh2tgLxbdLsr9Abc1KLQLIEFl+hgWgDCD97DNKc0f2gc01talGpmUwBhhdy28OE6x/RWswB0cmhgW2hjeU95xiyAOsi7Aghx+yzvW4JqLYDNTnH25FkBiBvtiU6p/5zomTtz3Ggc05tFAbzqFGdPnhXAjEAP0uygNJZhWmgc06+2KN1u6+WU5AM5SntOwHd6jidHmpNA45je0KI1UolTkg8+HXgwjT68xzyiMvKWVgtguFOSD/KwXZbXLUGNY/plrRbAB5yS8JmUk4CaH+K95g2NY3qDWQB6yNM2WR63BNVaAC86xdmzE4A9FLYrKfYFcGyYt1aWY3nPeWEPjmltvCgKYJXSh5CnacAFOUur1SVnawFax/IqUQCrnWId5EUBSGLN6U5p+ExXluA0SbSO5dWiADYBWOtUZU9eFMDZOXV82pn3ngc0juW1hePAwrNOdfbkQQG05Nw7bgb7IHQ0juUOmS90vsZ1gP2ckvD4BIB9cnCfldiHfRA6Gsdyh8wXFMAzTnX2DFKaBjtO8n5CDjnog2Ecy9rokPmCAnhCYQOFCU5JOIwK/P6iMoF9ESpan3GHzBcUwFKnWgchC4i9/d8j5L7QOoY7ZF6CgsrPHZm5RFuOgPWMKdfu1PiNBIj8u8JgrFmxibECQgsE24VBUfs5NdmyhacTtxcsAMkNsEJZI8GOG+mU+s/nTPg70ZN9EhqjFAo/KOsi8522YGwakA5ibX0xsHuKgy+yb0JivNJ7eVfWTQGkz0k5O+cQlT3YNyGhev6PEgWw0LlMB4cH5ixii3+VCalvWjh2NbKwuJEFFimNELwrgMOcUj/5MICDA7mXJDiYfRQCh3HsamMrZb2DYgUg0YEXK+34M50SP7G3f21C6SOtY3ZxcSTwUtP6EedyHZwcwKr5QACnOqVGKaeyr3ymJ8esRjrJuC8KQE6OTXFK/UKy5Hb1/B7SoGsAGYWnKD7h2UnGC45ABWTP8iXnv+jgDwCOUdq2WnRnpt/+Na4z3uElZhTWmLYuCncD+LjStvWng10HpRbAesXnAiSQZKtT6genmfDXRX/2mY+0Kg56+kSx8KOMAgC1l0Yks8zpSttWC1v8qx9f++x0xZmdHNn2SQHA090A2Q4a45QatRjj6fav5jHqyHY5BfAwDwZpZLSHabPt7d84vvXdWI5RjWykbHeinALYBmC+U6qHSxS3rZQhACY7pUZUJrMPfUHz2JxP2e5EOQWAcqaCIqYCGKG4fcWEmuk3LXzKKDyCY1MrZWW6dBuwgIQwel5xrPqfe7AesBP7UKM7aIHCjo/miDyv8aDQm06NLm5SnPi0nX24prSikgWwptx8QRGyRTRUcftABaVR+F8B8EMAH2Gwyv34+w9Zp41dPVD2Q5VvWz5cTvhRRQEItzklethR+XxLW+YbCf7w+yI32/MB/Lmo/s8sK7gr/74QMEIJ2jMnXaI8lkFFWa40BQBDca2poSSyRE417Q3gBYVtO5qei1nzBE3TnzeQ/KWVJu2ZSqYI4lk3zynNnsGMsNtNYduENk7p1zk1NYRb/sODTqkepMMvVtq2LLevJK7eD3isVsz7qxvM/LSW/3c//q0fZByzT+uW4MWKhR+U4bLCjxoWgHAegB85pXp4i2mXNVkB0p6/pWyybufb8UYAv0kwroMM9BOY1+/olM1eGagfBLDSqcmOwWzP+xS1qZTPA/ixU0qqWQDC7cVnhxUiHX+tsmalOV8VE382V3glw84dCQd12crv+AS/c3aKZ0c0ZhS+Vrnwb6YMV6SWBSDc7IEPvryN7nFK02cXbv31SvCbxQy/lW97LQFcxtIqOI0hz5NiIxXP69nebgdHKV2TKOYWAGc4pUVEWeD7qVOij+8ryWnw2YSEX0z83zLIhCzozFQWvWkx2zSIbfxtQrsIvdjHWdOdY047NWU3igUAznO05+m7FMA3nNL0EGX6dMz+CcsA/AzAf1dbyFGK7CJ9CsBnYk6OKUkt9+XqdlZ8HcCVyvv/Ka5HVSXqFt91Tok+vpqxc9AJMX2/mPjfo1m9P4BrPBR+sM3X8B7G8p7i2EUYyr7OiqEca9qJJLNRLYD+nNtqD2n1uwzTTS8AcIRTGo3t9NW+keazxujMcdCNz2c6ozs1uovwQIZJN+T5HOeU6mIb10pqRveKqgCg3Ne5GInHdpdTmizyllvSwDcsLTLxtYZiS4r+RVOE/Rv4jtEZJLORsfVrp1Qfkc/K1KMApMMfd0r1sY7BJBpxfmmU6wGcHfH/buDqrLztH3Nq88kBtApkt6lvxB74r5QXBFs5/gc4NfoYE/WFVI8CEO4FMNEp1ccCtjONhaK+zPTbw6l5j4IvfsHEd85lGx10LZoiHFtjirCZGYU3ODXxI2tl9ynO9VfMffXEJKzXz//bTolOxnNXIA3OqyL8ooVncXtsMs1HE/7KbGMfTWafzaryJuvBvk+DSz0RftQro/VaAOC8K85tnaRooya8P8HvkDfWsxysBTbQeepGT6ZMPjCGVsEZJVMEOay2V8JKdQItXx/yUy6rdz2lkZvyxQpooSAmOWcrOOZs48Ljifz3hSb8sfI4+3QQ+/gu9vmghDPwDOAY8iU57dVOSQ0asQAkTNNfozgZKGE+3TaTWA/4EQ/+3Fwab91InH60CD7IAy9x00L38iM9eZTirPchAG87NVVoRAGAPt+3OKV6ucwDzy1DFzLvv8KjZ3I6z4jURaMKoIVrASOdGp20s4N+4Ul7jWyZxhec5ihExSzn3L9uK7fRuU0b36q+0IWOTFpTNhl6mMSx4ovwg7LY0BS3UQsA7KC/eJb1ZiO3cxY5NYYBjKMPSZLHueNGFkgPpJVbN82sbsoXfsUp1U0vOuT4soBppMdwjg2fhB+UwYbf4s1ub8j+6FynVDf9GMhhoGftNpJjIMdEP8/6eC5lsGGamQIUGMawUJoDI5ZjGZNPvlamzsgPknfgIU+c24rZymjNTzk1dRCHg4M04LtOqX724/FhzZl7jGTZlWPAN+EHZa4p4UdMFoDQm43p79ToZxljCr7oYduNximY/T4K/0u0vN9wauokLhfHNzzL2luMDIBHbWEwVwznM/dR+EFZa1r4EaMFUOB+j05NlbKeR1BtizBsxnG137cFvwILeEApFuJWAPvSQ7CnU+MHG5niuamVVUMt4uQzx8OtvgKb6PH3tFPTIHGfcpKGXe6U+kMvLgpN8/gejPJM47P1VfhB2YpN+JGABQBGcflfhnnylXZ29r9mHH7aaB55yf0Ln6dP7r2lPMY07rHmW0hCAYDCv9CDKMK1mM8jpz6G5TbeO8/vy5HeSkjsg4OSiCGZVKCDxzx0Ey7HkfS1jm3RxUiNCXx2vgs/KEuJBJBNMtLJdzIIz50ErVwUvNyjyDB5poXP6l4+O9+5i7KUCElNAQrsRs01xKnxkwWMK5BmyHEjOq08x+/rVnQpqzmdftWpiYmk32jS8E8GFAl3PM3KyU6NkTWT+WxCEf5tlJ3EhB8pmbQLPfYSLIcsLN3J+P5Z5iI03mEon8WdniTtiMollJ1ESXoKUMxvABzvlPqNOGZ8k9FYtwR2b9qRFN2zAXzNY8ezSsxNKwFqmgqgD9cD9nRq/EcOQs1gFFkjeY5ifn7tKesb4TnO+19J48vSXNV+hd5YsToyKGEYT5b9EsDgAO9PC4PZx/MCFf7tlJFUhB8ZbGv9iSZbqJzC+OzXmiKIlcHs05Xs41D5GmUkNdKcAhQQd8w7eOgmZCRiyw0A/g3AqsDvNSmGcjFsuocRp+plDrMcpSqQWSgAMLHjPIbkCp3tTNhwFYAVObjfOBgB4KtMQFMtQ3AoPMSgNJvTvp+sFICwC2+8rmSGHtNGLf8tAItzcs/1MpZv/Kk58rpcyhfh605NCmSpAMCwTI8yw2ueWMLkE7eYV2GH9554V54JYLRTGzaSWfpjWYajy1oBgKu5j3gcoaUZ3qbP+k10ZNnk763UhezbT6HQT2LC2bwhEagOiSOwZzNoUADwNCNL3PyDi6M3cWoUWhyCFpq6Z3Kxa2fnivygJkOVFgUgTGTEltBXe6MguQoeZIzF+5n8Uc2DikgXJo+dwM/hFoK9A9kdOg7AfU5NBmhSAPAwK2tarKeFVFAImZqNVRhWJPDjczqtq4a6LNXaFIAw09NEI2myhvkMniz5PJ9SG/YA8IGSj4TYHuRcaRRzAYDvaeoRjQoATHfsc3DRrHizSCGIlbCBawvFn40l/wbn44VPr5J/y6cv3+4Fod8pf13bNDKmr9TWKK0KALQE/tOmA4bniIB9Sdubv4BmBQCuCfzMFgYNT5EFv89omvOXol0BgLsDv875FqHhHzLVOlHLan8lfFAACCCdk5EvvEkz54sCABeh7smh27DhF88yYInWrdpO+HTg4in6TS91agxDB0s5Rr0Qfnh44upFupM+5NQYRrY8xLGZ2cGeRvDxyOXrPDs9x6kxjGyYwzGZyZHeZvD1zPVmHij550BjDBp+sJ1j8OQsgnnEgU+LgJU4mPusIUYbNvTyHP1UUo3hFzchRF35E8Moz3VqDCMZ5nLMeS38CCjs0itMDXVxQGnIDH1s4xibnGbo7iQJYQpQiuRRvy2ghKSGDlYzV1/i6brSJMTAiwtpnoWQmtzQwV0cU0EJPwKOvPoqY87NsimB0QTbOIamJJ2lNytCnAKUIpr7ev40jKhIHsvP8mew5CH2ujzAj3C/Ni9Rd43G2cSx8pHQhR85sQCK2RfATxivzjBKkbiLnwPwtFMTKHnJvlLgaQasFNPuJafWyCsyFs7m2MiN8COHFkAxvQF8nYEaLeJQPtnKALTfAPBGHnsgzwqggMQZuAbA8U6NETLizXeRT0d3kyBvU4ByyAA4gUEcHi9Tb4TF43zW8sxzLfwwBdAJydF3IE92LXdqDd9Zzmd7IJ917oFNASrSQrdPyU0wvNJFhhes5HO8LcB8i01jCqA6krX2DACzAYyqeqWhjScAXA3gZmZhNspgCiA6R/Mk2ERfGpxTJAz3twHMy3tHRMEUQP2M5uqxBIPo6lvjA2Ubg8LIbs6SvHdGPZgCaJwBzPpyDrcSjfSRVfzrmD1qnfV//ZgCiIcjAJwL4CQA3UO4IcVsAfArAD8F8EDeO6NZTAHESx8Ap/JzuG2zxoas3j8I4Jf8BBGNRwOmAJKjlRaBbCcealmO60YG5sPcvpM3/lrP2u8FpgDSYRBdjY8BcKQlOq2IJNScD+BuuuquqXShEQ+mANJHDh4dQmVwjPkXdOzX383PwxbBKV1MAWRPPyqEwmdswKcT5fTdYgCPFH3WO1cZqWEKQB89mA5dohvvz88ID3cXZLV+BRNmLmVAzUW+ZtAJFVMAfrAjzyTszynD3gCGMlV6a8Z3sJYpsVcBeIYm/VL64FvaNuWYAvCfnsyBIAphIIDdAfQt+bkbLYvunF50K/odNM238Gfh982MhPsygA0lP1+kwK+2OIseA+D/AVmCt37bocHPAAAAAElFTkSuQmCC")};d.prototype.setScene=function(a){a.location_url&&1==a.location_enable&&(y.pathEnd=t.loadurl(f.splitUrl(a.location_url))),this.createCpm(a),this.createBunnyObj(a)},d.prototype.updateModel=function(){this.model=this.modelManager.getActiveModel()},d.prototype.bindEvents=function(){this.modelManager.on(x.ActiveModelChanged,this.updateModel.bind(this))},d.prototype.updateDefaultsFromModelData=function(){this.model.data},d.prototype.pointPathDistance=function(a){for(var b=0,c=1;c<a.length;c+=1)b+=a[c-1].distanceTo(a[c]);return b},d.prototype.pointPathLengths=function(a){for(var b=[0],c=1;c<a.length;c+=1)b.push(b[c-1]+a[c-1].distanceTo(a[c]));return b},d.prototype.interpAlongPath=function(a,b,c){var d,e=new g.Vector3,f=b[b.length-1];if(c<1){d=c*f;for(var h=1;h<b.length;h+=1)if(b[h]>d){var i=(d-b[h-1])/(b[h]-b[h-1]);return e.copy(a[h]),e.sub(a[h-1]),e.multiplyScalar(i),e.add(a[h-1]),e}}else e.copy(a[a.length-1]);return e},d.prototype.pathHeight=function(){return this.player.mode!==i.FLOORPLAN?l.path.height:l.path.outsideHeight},d.prototype.createBunnyObj=function(a){this.bunnyObj||(this.bunnyObj=new g.AxisHelper(.1),this.bunnyObj.visible=l.warp.showBunny),this.bunnyObj.parent&&this.bunnyObj.parent.remove(bunnyObj),a.add(this.bunnyObj)},d.prototype.createCpm=function(a){if(!this.currentPanoMarker){var b=this.makeWaypointObj(y.pathEnd,"Current");b.material.uniforms.opacity.value=0,this.currentPanoMarker={mesh:b,placed:!1}}this.currentPanoMarker.mesh.parent&&this.currentPanoMarker.mesh.parent.remove(this.currentPanoMarker.mesh),this.placeCpm(),this.currentPanoMarker.mesh.parent||a.add(this.currentPanoMarker.mesh)},d.prototype.placeCpm=function(){l.path.mapGuides&&this.player.currentPano&&this.player.currentPano.isAligned()?(this.currentPanoMarker.mesh.parent!=this.player.currentPano.floor&&(this.currentPanoMarker.mesh.parent&&this.currentPanoMarker.mesh.parent.remove(this.currentPanoMarker.mesh),this.player.currentPano.floor.add(this.currentPanoMarker.mesh)),this.currentPanoMarker.mesh.position.copy(this.player.currentPano.floorPosition).sub(this.model.position),this.currentPanoMarker.mesh.position.y+=this.pathHeight(),this.currentPanoMarker.placed=!0):this.popOutCpm()},d.prototype.fadeInCpm=function(a){this.player.mode===i.PANORAMA&&this.player.currentPano&&!this.player.currentPano.isAligned()||l.path.mapGuides&&this.currentPanoMarker.placed&&p.start(n.property(this.currentPanoMarker.mesh.material.uniforms.opacity,"value",1),a)},d.prototype.fadeOutCpm=function(a){p.start(n.property(this.currentPanoMarker.mesh.material.uniforms.opacity,"value",0),a)},d.prototype.popInCpm=function(){l.path.mapGuides&&this.currentPanoMarker.placed&&this.fadeInCpm(2)},d.prototype.popOutCpm=function(){this.fadeOutCpm(2)},d.prototype.brushPrefs={linewidth:7,strokeWidth:15,cvSegments:48,paveStep:.1,paveWidth:.2,lookBlendDist:3,maxTurn:g.Math.degToRad(2)},d.prototype.panoPathDistance=function(a){var b=this.model.panos;if(!a||a.length<2)return 0;for(var c=[],d=0;d<a.length;d+=1)c.push(b.get(a[d]).floorPosition);return this.pointPathDistance(c)},d.prototype.loadTileTexture=function(a){var b=t.load(a,function(b){b.wrapS=g.RepeatWrapping,b.wrapT=g.RepeatWrapping,b.needsUpdate=!0,h.debug('path texture "'+a+'" is ready')},function(){h.error('path texture "'+a+'" failed')});return b.mapping=g.UVMapping,b},d.prototype.buildWarpDestinationDescriptor=function(a,b,c,d,e,f){return new q({cameraMode:d,position:a,quaternion:b,panoId:c,orthoZoom:f,floorVisibility:e,thumbUrl:null,name:null,isHero:!1})},d.prototype.buildWarpDestinationDescriptorFromHero=function(a){return this.buildWarpDestinationDescriptor(a.position,a.quaternion,this.getHeroId(a),a.cameraMode,a.floorVisibility,a.orthoZoom)},d.prototype.setWarpDestination=function(a){this.warpDestHeroLoc=a},d.prototype.setWarpDestinationByHeroIndex=function(a){var b=this.getHeroDescriptorByHeroIndex(a);return null!==b&&(this.setWarpDestination(b),!0)},d.prototype.setWarpDestinationByPano=function(a,b){return!!this.model.panos.get(a.id)&&this.setWarpDestinationByPanoId(a.id,b)},d.prototype.setWarpDestinationByPanoId=function(a,b){var c=this.model.panos.get(a);if(c){b=b||new g.Quaternion;var d=this.buildWarpDestinationDescriptor(c.position,b,c.id,"panorama",[],-1);return this.setWarpDestination(d),!0}return!1},d.prototype.getHeroDescriptorByHeroIndex=function(a){var b=this.model.heroCount();if(null!==this.warpDestHeroLoc&&b<2)return h.info("ShowPath.getHeroDescriptorByHeroIndex() -> Only one hero location is available."),this.model.getHeroDescriptorByIndex(0);var c=this.model.getHeroDescriptorByIndex(a);if(c){var d=c.isPano()?c.panoId:c.cameraMode;h.debug('ShowPath.getHeroDescriptorByHeroIndex() -> New brush/warp destination: "'+d+'" out of '+b+" choices.")}return c},d.prototype.getHeroDescriptorByPano=function(a){return this.model.panos.get(a.id)?this.getHeroDescriptorByPanoId(a.id):null},d.prototype.getHeroDescriptorByPanoId=function(a){var b=this.getHeroIndexFromPanoId(a);return this.getHeroDescriptorByHeroIndex(b)},d.prototype.getHeroIndexFromPanoId=function(a){for(var b=0;b<this.model.heroLocations.length;b++){var c=this.model.heroLocations[b],d=this.getHeroId(c);if(d&&d===a)return b}return-1},d.prototype.getHeroPano=function(a){if(null===a)return h.warn("getHeroPano(): no destination"),null;var b=this.getHeroId(a),c=this.model.panos.get(b);return void 0===c&&(c=null,""!==b&&h.debug('unable to find pano "'+b+'"')),c},d.prototype.getHeroId=function(a){return a.panoId},d.prototype.setWarpDestPano=function(){return this.warpDestPano=this.getHeroPano(this.warpDestHeroLoc),this.warpDestPano},d.prototype.brushToWarpPano=function(a,b){if(this.discardPathObject(),!this.setWarpDestPano())return!1;if(this.warpDestHeroLoc.cameraMode!==i.PANORAMA&&h.warn("Can only brush from pano to pano"),!this.warpDestPano)return h.info("No brush"),!1;if(!this.player.currentPano)return h.debug("No current pano, visibility undefined"),!1;if(!this.warpDestPano)return h.info("No wPano, visibility undefined"),!1;if(!this.warpDestPano.isAligned())return h.debug("Cannot brush to unaligned pano"),!1;var c=(a===k.STD||a===k.WALK)&&l.path.mapGuides,d=!0;if(this.player.currentPano.id===this.warpDestPano.id)h.debug("Already at destination pano");else{this.nodes=this.findShortestPath(this.player.currentPano,this.warpDestPano),d=void 0===this.nodes||null===this.nodes||this.nodes.length<1,this.obj3d=new g.Object3D,h.debug('Brushing from "'+this.player.currentPano.id+'" to "'+this.warpDestPano.id+'" ('+(this.nodes?this.nodes.length:0)+")"),d?(h.info('No "walkable" route, using fall-back warp style transition'),a=b):(this.setPathHulls(this.nodes),this.setFloorCurves(),c&&("chevron"===l.path.style?this.obj3d.add(this.drawPathPavement(this.floorCurvePoints)):"ribbon"===l.path.style&&this.obj3d.add(this.drawPathRibbon(this.floorCurvePoints,this.floorCurveColors)))),this.player.currentPano.floor.add(this.obj3d);var e=this.player.mode===i.DOLLHOUSE||this.player.mode===i.FLOORPLAN,f=a===k.STD;if(!d&&(c||f)){if(e){var j=this.makeStartMarker(this.floorHull[0],this.floorCurvePoints);this.obj3d.add(j)}var m=this.makeEndMarker(this.floorHull[this.floorHull.length-1]);this.obj3d.add(m)}this.appearSlow()}return this.upcomingTransType=a,!d},d.prototype.findShortestPath=function(a,b){if(!a||!b)return null;var c=l.warp.walkExtraPanosDistance,d=a.id+":"+b.id+":"+c;if(this.shortPaths.hasOwnProperty(d))return this.shortPaths[d]?this.shortPaths[d].slice():null;var e=b.id+":"+a.id+":"+c;if(this.shortPaths.hasOwnProperty(e))return this.shortPaths[e]?this.shortPaths[e].slice().reverse():null;var f=this.model.panos.aStarSearch(a,b);return this.model.panos.includeNodesNearPath(f,c),this.shortPaths[d]=f?f.slice():null,f},d.prototype.makePathHulls=function(a){var b,c,d,e,f,g=0,i=[],j=[],k=[],m=this.model.panos;b=m.get(a[0]),e=b.floor.floorIndex;for(var n=0;n<a.length;n+=1)b=m.get(a[n]),c=b.floorPosition.clone().sub(this.model.position),c.y+=this.pathHeight(),i.push(c),j.push(b.position.clone()),d=b.floor.floorIndex,k.push(d>e?l.path.colorUp:d<e?l.path.colorDown:l.path.color),n>0&&(f=j[n].distanceTo(j[n-1]))>g&&(g=f);return g>this.longestStep&&(this.longestStep=g,h.debug("path contains "+g+" meter segment")),{floor:i,camera:j,color:k}},d.prototype.makeFloorCurves=function(a,b,c){var d=this.player.mode===i.PANORAMA?l.path.waypointIndoorRadius:l.path.waypointRadius,e=this.pointPathDistance(a)-2*d,f=a.slice(0),h=f[1].clone().sub(f[0]);h.y=0,h.normalize().multiplyScalar(d),f[0]=(new g.Vector3).copy(f[0]).add(h),h=f[f.length-2].clone().sub(f[f.length-1]),h.y=0,h.normalize().multiplyScalar(d),f[f.length-1]=(new g.Vector3).copy(f[f.length-1]).add(h);var j=new g.CatmullRomCurve3(f),k=Math.floor(e/c);k=4*Math.floor(k/4),k=Math.max(4,k);for(var m,n,o=j.getSpacedPoints(k),p=[],q=new g.Vector3,r=0;r<o.length;r+=1){n=0,m=o[r].distanceTo(a[0]);for(var s=1;s<a.length;s+=1)q.copy(o[r]).sub(a[s]),q.y*=4,q.length()<m&&(n=s);p.push(b[n])}return{distance:e,points:o,colors:p}},d.prototype.makeCameraCurvePoints=function(a,b){var c=this.pointPathDistance(a);return new g.CatmullRomCurve3(a).getSpacedPoints(Math.max(2,Math.floor(c/b)))},d.prototype.makeCameraCurveTangents=function(a,b){var c=this.pointPathDistance(a),d=new g.CatmullRomCurve3(a),e=Math.max(2,Math.floor(c/b));e||(e=5);for(var f=[],h=0;h<=e;h++)f.push(d.getTangentAt(h/e));return f},d.prototype.setPathHulls=function(a){var b=this.makePathHulls(a);this.floorHull=b.floor,this.cameraHull=b.camera,this.colorHull=b.color},d.prototype.setFloorCurves=function(){var a=this.makeFloorCurves(this.floorHull,this.colorHull,this.brushPrefs.paveStep);this.floorPathDistance=a.distance,this.floorCurvePoints=a.points,this.floorCurveColors=a.colors},d.prototype.setCameraCurvePoints=function(){this.camCurvePoints=this.makeCameraCurvePoints(this.cameraHull,l.warp.stepFactor*this.brushPrefs.paveStep)},d.prototype.chooseWarpPath=function(a){var b,c,d,e=this.player.cameras[i.PANORAMA];if(this.player.currentPano===this.warpDestPano||!a)return this.warpPathPoints=null,this.warpLength=0,!1;this.nodes=this.findShortestPath(this.player.currentPano,this.warpDestPano),void 0===this.nodes||null===this.nodes||this.nodes.length<1?(h.debug("warp path to unreachable node"),b=this.warpDestPano.position.clone().sub(e.position),c=b.clone().negate(),b.multiplyScalar(.15).add(e.position),c.multiplyScalar(.15).add(this.warpDestPano.position),b.y=e.position.y,c.y=this.warpDestPano.position.y,d=new g.CubicBezierCurve3(e.position.clone(),b,c,this.warpDestPano.position.clone()),this.warpPathPoints=d.getSpacedPoints(this.brushPrefs.cvSegments)):(h.debug("follow warp path (path distance was "+this.nodes.length+" nodes, "+this.floorPathDistance+")"),this.setCameraCurvePoints(),this.warpPathPoints=this.camCurvePoints.slice(0)),this.warpLength=0,this.warpPathLengths=[0];for(var f=new g.Vector3,j=new g.Vector3,k=Math.cos(g.Math.degToRad(l.warp.minBrakeAngle)),m=Math.cos(g.Math.degToRad(l.warp.maxBrakeAngle)),n=1;n<this.warpPathPoints.length;n+=1){f.copy(this.warpPathPoints[n-1]).sub(this.warpPathPoints[n]);var o=f.length();f.y*=l.warp.climbEffort;var p=f.length()/o;if(n>1){f.setY(0).normalize(),j.copy(this.warpPathPoints[n-2]).sub(this.warpPathPoints[n-1]).setY(0).normalize();var q=Math.min(1,f.dot(j)),r=1+(l.warp.brakeStrength-1)*(1-g.Math.smoothstep(q,m,k));p=Math.max(r,p)}this.warpLength+=o*p,this.warpPathLengths[n]=this.warpLength}return!0},d.prototype.drawPathRibbon=function(a,b){this.bunnyObj.visible=l.warp.showBunny;for(var c=.6*l.path.ribbonWidth*.5,d=new g.Vector3,e=new g.Vector3(0,this.pathHeight(),0),f=new g.Geometry,h=new g.Vector3,k=0;k<a.length;k+=1){h.copy(a[k]),0===k?h.sub(a[k+1]):h.sub(a[k-1]).negate(),h.normalize(),d.crossVectors(h,u.UP),d.multiplyScalar(c);var m=(new g.Vector3).copy(a[k]).add(e);m.sub(d),f.vertices.push(m),m=(new g.Vector3).copy(a[k]).add(e),m.add(d),f.vertices.push(m)}var n,o=0;for(k=0;k<a.length-1;k+=1){var p=2*k,q=o;o+=a[k+1].distanceTo(a[k]);var r=o,t=b[k],v=b[k+1];n=new g.Face3(p,p+1,p+2),n.vertexColors=[new g.Color(t),new g.Color(t),new g.Color(v)],f.faces.push(n),f.faceVertexUvs[0].push([new g.Vector2(0,q),new g.Vector2(1,q),new g.Vector2(0,r)]),n=new g.Face3(p+2,p+1,p+3),n.vertexColors=[new g.Color(v),new g.Color(t),new g.Color(v)],f.faces.push(n),f.faceVertexUvs[0].push([new g.Vector2(0,r),new g.Vector2(1,q),new g.Vector2(1,r)])}f.computeFaceNormals(),f.computeVertexNormals();var w,x;this.player.mode===i.PANORAMA?(x=g.UniformsUtils.clone(s.ribbon.uniforms),x.map.value=y.path,x.opacity.value=0,x.color.value.set(l.path.color),w=new g.RawShaderMaterial({side:g.DoubleSide,depthWrite:!1,transparent:!0,vertexShader:s.ribbon.vertexShader,fragmentShader:s.ribbon.fragmentShader,uniforms:x,name:"ribbonT",opacity:0})):w=new g.MeshBasicMaterial({color:16777215,side:g.DoubleSide,name:"ribbonOut",vertexColors:g.VertexColors});var z=new g.Mesh(f,w);return z.name="ribbon",this.player.mode===i.PANORAMA&&(z.renderOrder=j.ribbon),z},d.prototype.drawPathPavement=function(a){for(var b,c=new g.Vector3,d=new g.Geometry,e=new g.Vector3,f=0;f<a.length;f+=1)e.copy(a[f]),0===f?e.sub(a[f+1]).negate():e.sub(a[f-1]),e.normalize(),c.crossVectors(e,u.UP),c.multiplyScalar(this.brushPrefs.paveWidth),b=(new g.Vector3).copy(a[f]),b.sub(c),d.vertices.push(b),d.vertices.push((new g.Vector3).copy(a[f])),b=(new g.Vector3).copy(a[f]),b.add(c),d.vertices.push(b);var h,j,k;for(f=0;f<a.length-1;f+=1)h=3*f+1,j=.25*f,k=j+.25,d.faces.push(new g.Face3(h-1,h,h+3)),d.faceVertexUvs[0].push([new g.Vector2(0,j),new g.Vector2(.5,j),new g.Vector2(.5,k)]),d.faces.push(new g.Face3(h+3,h+2,h-1)),d.faceVertexUvs[0].push([new g.Vector2(.5,k),new g.Vector2(0,k),new g.Vector2(0,j)]),d.faces.push(new g.Face3(h+3,h,h+1)),d.faceVertexUvs[0].push([new g.Vector2(.5,k),new g.Vector2(.5,j),new g.Vector2(1,j)]),d.faces.push(new g.Face3(h+3,h+1,h+4)),d.faceVertexUvs[0].push([new g.Vector2(.5,k),new g.Vector2(1,j),new g.Vector2(1,k)]);var m=this.player.mode===i.PANORAMA?new g.MeshBasicMaterial({color:l.path.color,side:g.DoubleSide,transparent:!0,depthWrite:!1,opacity:0,name:"paveT",map:y.path}):new g.MeshBasicMaterial({color:l.path.color,side:g.DoubleSide,transparent:!0,depthWrite:!1,opacity:1,name:"paveO",map:y.path});return new g.Mesh(d,m)},d.prototype.hintPrefs={rad:.18,width:.0125,depth:.0625,setBack:-.04,markRad:.25,markInnerRad:.16},d.prototype.makeWaypointObj=function(a,b){var c=new g.Geometry,d=this.player.mode===i.PANORAMA?l.path.waypointIndoorRadius:l.path.waypointRadius,e=this.pathHeight();c.vertices.push(new g.Vector3(-d,e,d),new g.Vector3(-d,e,-d),new g.Vector3(d,e,-d),new g.Vector3(d,e,d)),c.faces.push(new g.Face3(0,1,2),new g.Face3(2,3,0)),c.faceVertexUvs[0].push([new g.Vector2(0,0),new g.Vector2(1,0),new g.Vector2(1,1)]),c.faceVertexUvs[0].push([new g.Vector2(1,1),new g.Vector2(0,1),new g.Vector2(0,0)]);var f=g.UniformsUtils.clone(s.waypoint.uniforms);f.map.value=a,f.opacity.value=0,f.color.value.set(l.path.color);var h={side:g.DoubleSide,depthWrite:!1,transparent:!0,vertexShader:s.waypoint.vertexShader,fragmentShader:s.waypoint.fragmentShader,uniforms:f,name:"waypoint",opacity:0};this.player.mode!==i.PANORAMA&&(h.depthTest=!1,h.name="wayPtOut");var j=new g.RawShaderMaterial(h),k=new g.Mesh(c,j);return k.name=b,k},d.prototype.makeStartMarker=function(a,b){var c=(new g.Vector3).copy(b[1]).sub(b[0]);c.y=0,c.normalize();var d=Math.acos(c.x),e=this.makeWaypointObj(y.pathStart,"Start");return e.rotateOnAxis(new g.Vector3(0,1,0),d),e.position.copy(a),e},d.prototype.makeEndMarker=function(a){var b=this.makeWaypointObj(y.pathEnd,"End"),c=this.model.panos.get(this.nodes[0]).floor.floorIndex,d=this.model.panos.get(this.nodes[this.nodes.length-1]).floor.floorIndex;return c<d?b.material.uniforms.color.value.set(l.path.colorUp):c>d&&b.material.uniforms.color.value.set(l.path.colorDown),b.position.copy(a),b},d.prototype.pathClean=function(a){if(a){for(var b in a.children)this.pathClean(a.children[b]);a.geometry&&a.geometry.dispose(),a.material&&a.material.dispose()}},d.prototype.discardPathObject=function(){if(this.obj3d){var a=this.obj3d.parent;a&&a.remove(this.obj3d),this.pathClean(this.obj3d)}this.obj3d=null,this.popInCpm()},d.prototype.discardSlow=function(){if(this.obj3d){if(this.player.mode!==i.PANORAMA)return void this.discardPathObject();for(var a,b=this,c=0,d=function(){this.discardPathObject()}.bind(this),e=0;e<b.obj3d.children.length;e+=1)a=b.obj3d.children[e],void 0!==a.material&&!0===a.material.transparent&&(void 0!==a.material.uniforms?p.start(n.property(a.material.uniforms.opacity,"value",0),l.path.fadeOutTime,d,0,o[l.warp.blendEasing]):p.start(n.property(a.material,"opacity",0),l.path.fadeOutTime,d,0,o[l.warp.blendEasing]),c+=1,d=null);0===c&&this.discardPathObject(),this.player.mode!==i.PANORAMA&&this.fadeInCpm(l.path.fadeInTime-3)}},d.prototype.appearSlow=function(){var a,b=this;this.fadeOutCpm(l.path.fadeInTime);for(var c=this.player.mode===i.PANORAMA?l.path.opacity:1,d=0;d<b.obj3d.children.length;d+=1)a=b.obj3d.children[d],void 0!==a.material&&!0===a.material.transparent&&(void 0!==a.material.uniforms?p.start(n.property(a.material.uniforms.opacity,"value",c),l.path.fadeInTime,null,0,o[l.warp.blendEasing]):p.start(n.property(a.material,"opacity",c),l.path.fadeInTime,null,0,o[l.warp.blendEasing]))},d.prototype.update=function(){this.obj3d&&this.obj3d.updateMatrixWorld()},d.prototype.calcBurnsAmount=function(a){var b=g.Math.degToRad(l.warp.burnsAngle);if(this.player.mode===i.PANORAMA){var c=this.burnsDir*b;if(this.upcomingTransType===k.BLACK)return c;var d=a;if(null===d)return h.warn("Transition request for non-highlight"),c;var e=this.getHeroDescriptorByHeroIndex(d);if(null===e)return c;if(!e.isPano())return c;var f=this.getHeroPano(e),j=this.player.cameras[i.PANORAMA],m=u.FORWARD.clone().applyQuaternion(j.quaternion).setY(0).normalize(),n=Math.min(g.Math.degToRad(l.warp.minBurnsAngle),b),o=function(a){var c=Math.acos(Math.min(1,a.dot(m))),d=(new g.Vector3).crossVectors(m,a);return Math.max(n,Math.min(Math.abs(c),b))*Math.sign(d.y)};if(f==this.player.currentPano)return c=o(u.FORWARD.clone().applyQuaternion(e.quaternion).setY(0).normalize());var p=this.findShortestPath(this.player.currentPano,f);if(void 0===p||null===p||p.length<1)return h.debug("Empty path ahead..."),c;var q=this.makePathHulls(p),r=new g.CatmullRomCurve3(q.camera),s=Math.min(.1,l.warp.lookAheadDist/r.getLength());return c=o(r.getPointAt(s).clone().sub(j.position).setY(0).normalize())}if(this.player.mode===i.DOLLHOUSE){var t=this.player.cameras[i.DOLLHOUSE];return this.burnsDir*Math.min(t.controls.rotationAcceleration.x+.05,.02)}return this.burnsDir},d.prototype.waitNextStep=function(a,b){var c=new g.Euler,d=new g.Vector3;if(h.debug("Starting wait: "+(void 0!==b)),2===this.player.currentPano.alignmentType)var e=Math.PI/8,f=l.warp.tourStepDelay*l.warp.waitMultiplier1;else var e=this.calcBurnsAmount(a),f=l.warp.tourStepDelay;var j=function(){this.endWarpState(),this.player.mode===i.DOLLHOUSE&&(this.player.cameras[i.DOLLHOUSE].controls.rotationAcceleration.x=0),b&&b()}.bind(this),k=function(a,b){if(this.warpInterrupted)return j(),!0;var f=b||1e3/60;if(l.warp.doBurns)if(this.player.mode===i.PANORAMA){var g=this.player.cameras[i.PANORAMA];c.setFromQuaternion(g.quaternion,l.warp.eOrder);var h=l.warp.waitMultiplier2*f*e/l.warp.tourStepDelay;c.y+=h,d.set(0,0,-1),d.applyEuler(c),d.add(g.position),g.controls.lookAt(d),g.controls.lookVector.copy(d),g.lookAt(d)}else if(this.player.mode===i.DOLLHOUSE){var k=this.player.cameras[i.DOLLHOUSE];k.controls.rotationAcceleration.x=e}else this.player.controls[i.FLOORPLAN].absoluteScale*=.9996}.bind(this);this.startWarpState(),p.start(k,f,j,0,o.easeInOutQuad,"wait")},d.prototype.warpToNonPano=function(a){if(this.discardPathObject(),this.warpDestHeroLoc.cameraMode===i.DOLLHOUSE||this.warpDestHeroLoc.cameraMode===i.FLOORPLAN){var b=function(){a&&a()}.bind(this);this.player.flyToNewMode({mode:this.warpDestHeroLoc.cameraMode,duration:l.warp.outsideTime,warpDest:this.warpDestHeroLoc,callback:b,force:!0})}else h.warn("no warp destination!!!"),a&&a()},d.prototype._resetWarpShaderParams=function(a){this.player.mode===i.PANORAMA&&(void 0!==a.material.uniforms.blackout&&(a.material.uniforms.blackout.value=0),void 0!==a.material.uniforms.modelAlpha&&(a.material.uniforms.modelAlpha.value=0))},d.prototype._clearWarpShading=function(){for(var a=this.model.chunks,b=0;b<a.length;b+=1)this._resetWarpShaderParams(a[b]),a[b].visible=!0;this._resetWarpShaderParams(this.model.skybox)},d.prototype._warpStopFlying=function(){this.activeTransType=null,this.placeCpm()},d.prototype._wrapupTravelOnlyBits=function(){this._warpStopFlying(),this.warpPathPoints&&(this.player.currentPano.exit(),this.warpDestPano.enter(),this.player.currentPano=this.warpDestPano),this.player.spider.draw(),this.placeCpm()},d.prototype._wrapupTravel=function(a){this._wrapupTravelOnlyBits(),this.warpCameraAim(a)},d.prototype._wrapupWarpShading=function(a){this._clearWarpShading(),this._wrapupTravel(a)},d.prototype.wrapupWarpShadingOnly=function(a,b){b!==w.END&&this._clearWarpShading(),this._wrapupTravelOnlyBits(),this.upcomingTransType=null,a&&a()},d.prototype._warpCameraAim=function(a,b){
var c=this.warpDestHeroLoc.quaternion,d=this.player.cameras[i.PANORAMA],e=new g.Vector3(0,0,1).applyQuaternion(c).normalize(),f=new g.Vector3(0,0,1).applyQuaternion(d.quaternion).normalize(),j=f.dot(e),k=g.Math.radToDeg(Math.acos(j)),n=new g.Euler(0,0,0,l.warp.eOrder).setFromQuaternion(c,l.warp.eOrder),q=(new g.Euler).setFromQuaternion(d.quaternion,l.warp.eOrder),r=new g.Euler(n.x-q.x,n.y-q.y,n.z-q.z,l.warp.eOrder);r.y=m.constrainedTurn(r.y),this.burnsDir=Math.sign(r.y);var s=new g.Euler(0,0,0,l.warp.eOrder),t=new g.Vector3,u=function(a,b){return!!this.warpInterrupted||(s.x=q.x+a*r.x,s.y=q.y+a*r.y,s.z=q.z+a*r.z,t.set(0,0,-1),t.applyEuler(s),t.add(d.position),d.controls.lookAt(t),d.controls.lookVector.copy(t),void d.lookAt(t))}.bind(this);return k>l.warp.minRotation?p.start(u,a,b,0,o[l.warp.movementEasing]):(h.debug("Aim angle only is "+k.toPrecision(3)+" degrees, skipping explicit re-aim"),void(b&&b()))},d.prototype._warpBendAim=function(a,b,c,d){var e=d||0,f=this.player.cameras[i.PANORAMA],h=new g.Euler(0,0,0,l.warp.eOrder).setFromQuaternion(this.warpDestHeroLoc.quaternion,l.warp.eOrder),j=(new g.Euler).setFromQuaternion(f.quaternion,l.warp.eOrder),k=new g.Euler(h.x-j.x,h.y-j.y,h.z-j.z,l.warp.eOrder);k.y=m.constrainedTurn(k.y);var n=Math.min(g.Math.degToRad(l.warp.softBendTilt),Math.abs(k.x));k.x=n*Math.sign(k.x),n=Math.min(g.Math.degToRad(Math.max(0,l.warp.softBendAngle)),n),this.burnsDir=Math.sign(k.y),n*=Math.sign(k.y),k.y=n;var q=new g.Euler(0,0,0,l.warp.eOrder),r=new g.Vector3,s=function(a,b){if(a<.5)q.x=j.x+a*k.x,q.y=j.y+a*k.y,q.z=j.z+a*k.z;else{var c=(1-a)*l.warp.softBendEnd;q.x=h.x-c*k.x,q.y=h.y-c*k.y,q.z=h.z-c*k.z}r.set(0,0,-1),r.applyEuler(q),r.add(f.position),f.controls.lookAt(r),f.controls.lookVector.copy(r),f.lookAt(r)}.bind(this);return p.start(s,b,c,e,o[l.warp.movementEasing])},d.prototype._warpStepCameraAim=function(a,b,c){var d=this.player.cameras[i.PANORAMA],e=new g.Euler(0,0,0,l.warp.eOrder).setFromQuaternion(this.warpDestHeroLoc.quaternion,l.warp.eOrder),f=(new g.Euler).setFromQuaternion(d.quaternion,l.warp.eOrder),h=new g.Euler(e.x-f.x,e.y-f.y,e.z-f.z,l.warp.eOrder);h.y=m.constrainedTurn(h.y),this.burnsDir=Math.sign(h.y);var j=new g.Euler(0,0,0,l.warp.eOrder),k=new g.Vector3,n=function(a,b){a<.5?j.copy(f):j.copy(e),k.set(0,0,-1),k.applyEuler(j),k.add(d.position),d.controls.lookAt(k),d.controls.lookVector.copy(k),d.lookAt(k)}.bind(this);return p.start(n,b,c,0,o[l.warp.movementEasing])},d.prototype.setBurnsDir=function(){var a=this.player.cameras[i.PANORAMA],b=new g.Euler(0,0,0,l.warp.eOrder).setFromQuaternion(this.warpDestHeroLoc.quaternion,l.warp.eOrder),c=(new g.Euler).setFromQuaternion(a.quaternion,l.warp.eOrder),d=new g.Euler(b.x-c.x,b.y-c.y,b.z-c.z,l.warp.eOrder);d.y=m.constrainedTurn(d.y),this.burnsDir=Math.sign(d.y)},d.prototype.stepWarpPath=function(a,b){var c=this.player.cameras[i.PANORAMA];if(!this.warpPathPoints)return c.position.copy(this.warpDestPano.position),!0;var d=this.warpPathPoints[0],e=this.warpDestPano.position;if(null!==this.nodes&&this.cameraHull.length>1){var f=new g.Vector3;a<.5?f.copy(this.cameraHull[1]).sub(d).normalize().multiplyScalar(l.warp.softPushDist*a).add(d):f.copy(this.cameraHull[this.cameraHull.length-2]).sub(e).normalize().multiplyScalar(l.warp.softPushDist*l.warp.softPushEnd*(1-a)).add(e),c.position.copy(f)}else a<.5?c.position.copy(d):c.position.copy(e)},d.prototype.interruptAndFastForward=function(a,b){this.warping&&(this.warpInterrupted=!0,this.warpInterruptionBlackoutStyle=a,this.warpInterruptionTravelTime=b,null!==this.warpInterruptionBlackoutStyle&&void 0!==this.warpInterruptionBlackoutStyle||(this.warpInterruptionBlackoutStyle=w.MIDDLE),null!==this.warpInterruptionTravelTime&&void 0!==this.warpInterruptionTravelTime||(this.warpInterruptionTravelTime=l.minWarpTime))},d.prototype.warpCameraAim=function(a){var b=l.warp.minWarpTime;if(this.upcomingTransType===k.BLACK)b=l.warp.teleportTime;else{var c=this.player.cameras[i.PANORAMA],d=new g.Euler(0,0,0,l.warp.eOrder).setFromQuaternion(this.warpDestHeroLoc.quaternion,l.warp.eOrder),e=(new g.Euler).setFromQuaternion(c.quaternion,l.warp.eOrder),f=new g.Euler(d.x-e.x,d.y-e.y,d.z-e.z,l.warp.eOrder);f.y=m.constrainedTurn(f.y);var h=1e3*Math.abs(f.y)/g.Math.degToRad(l.warp.maxAimPerSec);b=Math.max(b,h)}var j=function(){this._warpStopFlying(),this.discardSlow(),a&&a()}.bind(this);this._warpCameraAim(b,j)},d.prototype.warpCommonParameters=function(a,b,c,d){this.model.skybox.material.uniforms.blackout.value=d;var e=n.uniform(this.model.skybox,"progress",1),f=n.allUniforms(this.model.chunks,"progress",1),g=!1,h=function(){if(this.warpInterrupted)return g=!0,!0}.bind(this),i=function(a,b){return c&&g?(this.model.skybox.material.uniforms.progress.value=0,!0):void e(a,b)}.bind(this),j=function(a,b){return c&&g?(f(0),!0):void f(a,b)}.bind(this);p.start(h,a,null,b,null,"safeHaltWatch"),p.start(i,a,null,b,o[l.warp.blendEasing],"skyboxProgress"),p.start(j,a,null,b,o[l.warp.blendEasing],"chunkProgress")},d.prototype.warpTravel_STD=function(a){var b,c=Math.min(l.warp.lookAheadMax,l.warp.lookAheadDist/this.warpLength),d=this.player.cameras[i.PANORAMA],e=(Math.min(.25,3/this.warpLength),Math.min(.35,7/this.warpLength)),f=new g.Euler(0,0,0,l.warp.eOrder),j=new g.Vector3,q=(new g.Euler).setFromQuaternion(d.quaternion,l.warp.eOrder),s=(new g.Euler).copy(q),t=d.position.clone(),v=new g.Matrix4,x=new g.Euler,y=l.warp.minWarpTime;y+=this.warpLength*l.warp.timePerMeter,l.warp.flySpeed>.01&&(y=1e3*this.warpLength/l.warp.flySpeed);var z=!1,A=this.warpDestHeroLoc.quaternion,B=new g.Vector3(0,0,-1).applyQuaternion(A).normalize(),C=this.warpPathPoints[this.warpPathPoints.length-1].clone().sub(this.warpPathPoints[this.warpPathPoints.length-2]).normalize(),D=C.dot(B),E=g.Math.radToDeg(Math.acos(D)),F=function(a){var b=e;return g.Math.smoothstep(a,0,b)*(1-g.Math.smoothstep(a,1-b,1))},G=function(){return v.lookAt(t,b,u.UP),f.setFromRotationMatrix(v,l.warp.eOrder),q.setFromQuaternion(d.quaternion,l.warp.eOrder),x.set(f.x-q.x,f.y-q.y,f.z-q.z,l.warp.eOrder),m.constrainedTurn(x.y)}.bind(this),H=function(a,b){if(this.warpInterrupted)return z=!0,!0}.bind(this),I=function(a,b){return z||!this.warpPathPoints?(r.blur(0),!0):void r.blur(a)}.bind(this),J=n.allUniforms(this.model.chunks,"modelAlpha",1),K=function(a,b){return z||!this.warpPathPoints?(J(0),!0):void J(a,b)}.bind(this),L=function(a,b){if(!this.warpPathPoints)return d.position.copy(this.warpDestPano.position),!0;if(z)return!0;var c=this.interpAlongPath(this.warpPathPoints,this.warpPathLengths,a);d.position.copy(c),t=this.interpAlongPath(this.warpPathPoints,this.warpPathLengths,.99*a)}.bind(this),M=function(a,d){return this.warpPathPoints?!!z||void(b=this.interpAlongPath(this.warpPathPoints,this.warpPathLengths,Math.min(a+c,1))):(h.debug("Lost bunny."),!0)}.bind(this),N=function(a,e){if(z)return h.debug(">>>> Walkthrough interupted at t="+a),!0;if(!this.warpPathPoints)return!0;var i=this.warpLength*a,k=g.Math.smoothstep(i,0,this.brushPrefs.lookBlendDist),n=g.Math.smoothstep(i,this.warpLength-this.brushPrefs.lookBlendDist,this.warpLength);l.warp.matchCam&&(k*=1-n),v.lookAt(t,b,u.UP),f.setFromRotationMatrix(v,l.warp.eOrder),q.setFromQuaternion(d.quaternion,l.warp.eOrder),x.set(f.x-q.x,f.y-q.y,f.z-q.z,l.warp.eOrder),x.y=m.constrainedTurn(x.y),f.x=q.x+k*x.x,f.y=q.y+k*x.y,f.z=q.z+k*x.z,x.set(f.x-s.x,f.y-s.y,f.z-s.z,l.warp.eOrder),x.y=m.constrainedTurn(x.y);var o=g.Math.degToRad(l.warp.maxTurnPerSec)*e/1e3;x.y=Math.sign(x.y)*Math.min(o,Math.abs(x.y)),s.x=s.x+x.x*l.warp.turnFriction,s.y=s.y+x.y*l.warp.turnFriction,s.z=s.z+x.z*l.warp.turnFriction,s.x=Math.max(g.Math.degToRad(l.warp.minDownAngle),s.x);var p=b.clone().sub(t).normalize();if(E<l.warp.maxAimRotation&&n>0){var r=1-n;p.x=p.x*r+n*C.x,p.y=p.y*r+n*C.y,p.z=p.z*r+n*C.z,p.normalize()}this.bunnyObj.position.copy(d.position).add(p),j.set(0,0,-1).applyEuler(s).normalize(),j.multiplyScalar(8),j.add(d.position),a>1-c&&l.warp.matchCam||(d.controls.lookAt(j),d.controls.lookVector.copy(j),d.lookAt(j))}.bind(this),O=function(){z?(this.discardSlow(),this.upcomingTransType=k.BLACK,this.warpTravel_BLACK(-.5,this.warpInterruptionTravelTime,w.BEGINNING,a)):this._wrapupWarpShading(a)}.bind(this);M(0);var P=l.warp.motionLeadTime+1e3*Math.abs(G())/g.Math.degToRad(l.warp.maxTurnPerSec);y+=P;var Q=P/y;this.warpCommonParameters(y,Q,!0,w.NONE),p.start(H,y,null,0,null,"_haltWatcher"),l.warp.blur>0&&(r.blurStrength=l.warp.blur,p.start(I,y,null,Q,F,"blurring")),p.start(K,y,null,Q,F,"modelAlpha"),p.start(L,y,null,Q,o[l.warp.blendEasing],"followPath"),p.start(M,y,null,Q,o[l.warp.blendEasing],"goBunny"),p.start(N,y,O,0,o[l.warp.blendEasing],"lookAtBunny")},d.prototype.warpTravel_BLACK=function(a,b,c,d){var e=a||0;void 0!==b&&null!==b||(b=l.warp.teleportTime),this.warpCommonParameters(b,e,!1,c),this.model.chunks.forEach(function(a){a.material.uniforms.blackout.value=c}),this._warpBendAim(null,b,null,e);var f=function(){this.wrapupWarpShadingOnly(d,c)}.bind(this);p.start(this.stepWarpPath.bind(this),b,f,e,o[l.warp.blendEasing],"stepMotion")},d.prototype.flightStepWalk=function(a,b,c){if(this.warpInterrupted)c&&c();else if(this.activeTransType!==k.WALK)this._clearWarpShading(),this._warpStopFlying(),this.player.spider.draw(),this.placeCpm(),c&&c();else if(this.player.currentPano!==a){var d={pano:a,lookAtPoint:b,duration:null,maxDistanceOverride:l.warp.walkMaxDist,skipWarpingCheck:!1,constantMoveSpeed:!0};this.player.nonInterruptingFlyToPano(d,c)}else c&&c()},d.prototype.makeWalkFlightFunc=function(a,b,c){return this.flightStepWalk.bind(this,a,b,c)},d.prototype.warpTravel_WALK=function(a){var b=this.nodes.length,c=this.player.model.panos,d=c.get(this.nodes[b-1]),e=d.position.clone().multiplyScalar(2).sub(c.get(this.nodes[b-2]).position),f=new Array(b+1);f[f.length-1]=function(){a&&a()}.bind(this);for(var g=b-1,h=f.length-1;h>0;h-=1){var i=this.nodes[g];d=c.get(i);var j=e.distanceTo(d.position)<.3?null:e;f[h-1]=this.makeWalkFlightFunc(d,j,f[h]),e=d.position.clone(),g--}f[0]()},d.prototype.warpCameraTravel=function(a,b,c,d){if(this.activeTransType=this.upcomingTransType,this.upcomingTransType=null,!a){var e=function(){this._wrapupTravel(d)}.bind(this),f={pano:this.warpDestPano,lookAtPoint:null,duration:null,maxDistanceOverride:null,skipWarpingCheck:!1};return void this.player.flyToPano(f,e)}this.activeTransType==k.BLACK?this.warpTravel_BLACK(null,c,b,d):this.activeTransType===k.WALK?this.warpTravel_WALK(function(){this._clearWarpShading(),this._warpStopFlying(),this.player.spider.draw(),this.placeCpm(),d&&d()}.bind(this)):this.warpTravel_STD(d)},d.prototype.startWarpState=function(){this.warping=!0,this.warpInterrupted=!1,this.warpInterruptionBlackoutStyle=null,this.warpInterruptionTravelTime=null},d.prototype.endWarpState=function(){this.warping=!1},d.prototype.warpToPano=function(a,b,c,d){if(this.warping)return void h.warn("Cannot warp when already warping");if(this.upcomingTransType=a,this.activeTransType=null,!this.setWarpDestPano())return this.upcomingTransType=null,void this.warpToNonPano(d);if(this.player.mode!==i.PANORAMA)return this.upcomingTransType=null,this.discardSlow(),void this.player.flyToNewMode({mode:i.PANORAMA,pano:this.warpDestPano,duration:l.warp.outsideTime,warpDest:this.warpDestHeroLoc,callback:d,force:!0});if(!this.warpDestPano)return h.warn("no warp destination, callback dropped"),void(this.upcomingTransType=null);var e=!(this.model.panos.isNeighbour(this.player.currentPano,this.warpDestPano)&&this.warpDestPano!==this.player.currentPano&&this.warpDestPano.position.distanceTo(this.player.currentPano.position)<l.warp.nearPanoDist),f=this.chooseWarpPath(e);if(f&&this.upcomingTransType!==k.WALK){var g=function(){this.warpToPano(a,b,c,d)}.bind(this);if(this.player.checkAndWaitForPanoLoad(this.warpDestPano,"high","low",this.player.basePanoSize,g))return}this.player.currentPano||(h.warn("Arrived at a very strange spot!"),this.player.currentPano=this.warpDestPano,this.placeCpm(),this.fadeOutCpm(l.path.fadeOutTime),this.player.spider.draw()),h.debug("Warping to pano ",this.warpDestPano.position),this.upcomingTransType!==k.WALK&&this.player.emit(v.PanoChosen,this.player.currentPano,this.warpDestPano),this.player.activeTag&&this.player.dismissActiveTag(),this.startWarpState();var j=function(){this.endWarpState(),d&&d()}.bind(this);f?this.warpCameraTravel(e,b,c,j):this.warpCameraAim(j),this.player.smoothZoomToDefault(l.zoom.restoreTime)},b.exports=d}).call(this,"/js/objects/ShowPath.js")},{"../conf":7,"../effects":15,"../enum/BlackoutStyle":17,"../enum/ModelManagerEvents":30,"../enum/PlayerEvents":38,"../enum/RenderOrder":39,"../enum/Vectors":50,"../enum/Viewmode":51,"../enum/WarpStyle":52,"../gui/gui":64,"../gui/offLine":70,"../model/ModelManager":103,"../objects/Snapshot":118,"../shaders":126,"../util/easing":147,"../util/lerp":152,"../util/logger":153,"../util/math":154,"../util/texture":161,"../util/transitions":162,three:177}],117:[function(a,b,c){"use strict";function d(){var a=new e.SphereBufferGeometry(g.skyboxRadius,20,5),b=new e.RawShaderMaterial({fragmentShader:f.skysphere.fragmentShader,vertexShader:f.skysphere.vertexShader,uniforms:e.UniformsUtils.clone(f.skysphere.uniforms),side:e.BackSide,name:"skysphere"});b.uniforms.radius.value=a.parameters.radius,e.Mesh.call(this,a,b)}var e=a("three"),f=a("../shaders"),g=a("../conf");d.prototype=Object.create(e.Mesh.prototype),d.prototype.constructor=d,b.exports=d},{"../conf":7,"../shaders":126,three:177}],118:[function(a,b,c){(function(c){"use strict";function d(a){f.call(this,a),this.panoId=a.panoId,this.orthoZoom=a.orthoZoom,this.floorVisibility=a.floorVisibility,this.thumbUrl=a.thumbUrl,this.name=a.name,this.isHero=a.isHero,this.script=a.script}var e=(a("three"),a("../util/logger")),f=(a("../conf"),a("../enum/Viewmode"),a("../util/common"),a("../util/transitions"),a("../util/lerp"),a("../util/ajax"),a("../util/texture"),a("./View"));a("events").EventEmitter,new e(c),d.prototype=Object.create(f.prototype),d.prototype.isPano=function(){return this.panoId&&""!==this.panoId},b.exports=d}).call(this,"/js/objects/Snapshot.js")},{"../conf":7,"../enum/Viewmode":51,"../util/ajax":141,"../util/common":145,"../util/lerp":152,"../util/logger":153,"../util/texture":161,"../util/transitions":162,"./View":120,events:170,three:177}],119:[function(a,b,c){function d(a){e.Object3D.call(this);var b=new e.Texture;b.minFilter=e.LinearFilter,b.magFilter=e.LinearFilter;var c=new e.SpriteMaterial({map:b,useScreenCoordinates:!1,depthTest:!0,depthWrite:!0});this.material=c,this.sprite=new e.Sprite(c),this.add(this.sprite),this.borderThickness=4,this.fontface="Arial",f.isMobile()?this.fontsize=40:this.fontsize=28,this.borderColor={r:0,g:0,b:0,a:1},this.backgroundColor={r:255,g:255,b:255,a:1},this.textColor={r:255,g:255,b:255,a:1},this.text="",this.setText(a)}var e=a("three"),f=(a("../conf"),a("../util/common"),a("../util/browser"));a("../objects/Panorama"),a("../enum/RenderOrder");d.prototype=new e.Object3D,d.prototype.setText=function(a){this.text=a,this.update()},d.prototype.setTextColor=function(a){this.textColor=a,this.update()},d.prototype.setBorderColor=function(a){this.borderColor=a,this.update()},d.prototype.setBackgroundColor=function(a){this.backgroundColor=a,this.update()},d.prototype.update=function(){var a=document.createElement("canvas"),b=a.getContext("2d");b.font="Bold "+this.fontsize+"px "+this.fontface;var c=b.measureText(this.text),d=c.width,f=d+2*this.borderThickness,g=1.4*this.fontsize+2*this.borderThickness,a=document.createElement("canvas"),b=a.getContext("2d");b.canvas.width=f,b.canvas.height=g,b.font="Bold "+this.fontsize+"px "+this.fontface,b.fillStyle="rgba("+this.backgroundColor.r+","+this.backgroundColor.g+","+this.backgroundColor.b+","+this.backgroundColor.a+")",b.strokeStyle="rgba("+this.borderColor.r+","+this.borderColor.g+","+this.borderColor.b+","+this.borderColor.a+")",b.lineWidth=this.borderThickness,this.roundRect(b,this.borderThickness/2,this.borderThickness/2,d+this.borderThickness,1.4*this.fontsize+this.borderThickness,6),b.strokeStyle="rgba(0, 0, 0, 1.0)",b.strokeText(this.text,this.borderThickness,this.fontsize+this.borderThickness),b.fillStyle="rgba("+this.textColor.r+","+this.textColor.g+","+this.textColor.b+","+this.textColor.a+")",b.fillText(this.text,this.borderThickness,this.fontsize+this.borderThickness);var h=new e.Texture(a);h.minFilter=e.LinearFilter,h.magFilter=e.LinearFilter,h.needsUpdate=!0,this.sprite.material.map=h,this.sprite.material.depthTest=!0,this.sprite.material.depthWrite=!0,this.sprite.scale.set(.01*f,.01*g,1)},d.prototype.roundRect=function(a,b,c,d,e,f){a.beginPath(),a.moveTo(b+f,c),a.lineTo(b+d-f,c),a.quadraticCurveTo(b+d,c,b+d,c+f),a.lineTo(b+d,c+e-f),a.quadraticCurveTo(b+d,c+e,b+d-f,c+e),a.lineTo(b+f,c+e),a.quadraticCurveTo(b,c+e,b,c+e-f),a.lineTo(b,c+f),a.quadraticCurveTo(b,c,b+f,c),a.closePath(),a.fill(),a.stroke()},b.exports=d},{"../conf":7,"../enum/RenderOrder":39,"../objects/Panorama":113,"../util/browser":142,"../util/common":145,three:177}],120:[function(a,b,c){(function(c){"use strict";function d(a){a=a||{},this.position=new e.Vector3,this.quaternion=new e.Quaternion,this.update(a)}var e=a("three"),f=a("events").EventEmitter,e=a("three"),g=a("../util/logger"),f=(a("../conf"),a("../enum/Viewmode"),a("../util/common"),a("../util/transitions"),a("../util/lerp"),a("../util/ajax"),a("../util/texture"),a("events").EventEmitter);new g(c),d.prototype=Object.create(f.prototype),d.prototype.isValid=function(){return!!this.cameraMode},d.prototype.update=function(a){return this.cameraMode=a.cameraMode||this.cameraMode,this.pano=a.pano||this.pano,a.position&&this.position.copy(a.position),a.quaternion&&this.quaternion.copy(a.quaternion),this},b.exports=d}).call(this,"/js/objects/View.js")},{"../conf":7,"../enum/Viewmode":51,"../util/ajax":141,"../util/common":145,"../util/lerp":152,"../util/logger":153,"../util/texture":161,"../util/transitions":162,events:170,three:177}],121:[function(a,b,c){(function(c){"use strict";function d(a){G.player=this,this.currentPano=null,this.nextPano=null,this.camera=null,this.paused=!1,this.flying=!1,this.sceneIntersectionPlane=null,this.target=new e.Vector3,this.mouse=new e.Vector3(1.1,1.1,.5),this.mouseAtMouseDown=new e.Vector2,this.mouseCouldBeClickToMove=!1,this.inMeasureMode=!1,this.mouseLastMoveTime=Date.now(),this.mouseDown=!1,this.mouseDownTimer=null,this.couldBeLongTap=!1,this.containsMouse=!0,this.isTouchEvent=!1,this.isPanoHover=!1,this.reticule=new g(this),this.addTagReticule=new h(this),this.panoMarkers=[],this.spider=new o(this),this.quaternion=new e.Quaternion,this.position=new e.Vector3(15,10,15),this.previousState=null,this.lastInsideView=new n,this.last360View=new n,this.raycaster=new e.Raycaster,this.intersect=null,this.lastChangeTime=Date.now(),this.history=new C,this.control=null,this.controls={},this.cameras={},this.path=null,this.model=null,this.domElement=null,this.cachedPanoCandidates=null,this.basePanoSize=0,this.standardPanoSize=0,this.highPanoSize=0,this.ultraHighPanoSize=0,this.zoomLevel=1,this.zooming=0,this.zoomSpeed=.5,this.scrollZoomSpeed=.06,this.zoomSpeedAdjust=.05,this.defaultZoomIncrement=.2,this.baseFov=s.insideFOV,this.zoomFov=this.baseFov,this.zoomEnabled=!0,this.preRenderingEnabled=!1,this.setupCustomProperties(a),this.urlPoint=Z,this.urlPoint3=_,this.urlHighlights=aa,this.normal_length=.1,this.zoomStats=new P,this.clock=new THREE.Clock,this.isShowTip=!0}var e=a("three"),f=a("./util/logger"),g=a("./objects/Reticule"),h=a("./objects/AddTagReticule"),i=a("./controls/PanoramaControls"),j=a("./controls/DollhouseControls"),k=a("./controls/FloorplanControls"),l=a("./objects/Panorama"),m=a("./objects/ShowPath"),n=a("./objects/View"),o=(a("./objects/Snapshot"),a("./objects/NSpider")),p=a("./enum/Viewmode"),q=(a("./enum/TagStates"),a("./enum/Vectors")),r=a("./enum/Keys"),s=(a("./enum/AlignmentType"),a("./conf")),t=a("./util/common"),u=(a("./util/browser"),a("./util/math")),v=a("./util/lerp"),w=a("./util/easing"),x=a("./util/transitions"),y=a("events").EventEmitter,z=a("./cameras/PanoramaCamera"),A=a("./cameras/DollhouseCamera"),B=a("./cameras/FloorplanCamera"),C=(a("./shaders"),a("./util/history")),D=(a("./util/camera"),a("./model/ModelManager"),a("./enum/PathDiscardMode")),E=a("./enum/PathDisplayMode"),F=a("./enum/PlayerEvents"),H=a("./enum/ControlEvents"),I=a("./enum/ModelManagerEvents"),J=a("./enum/WarpStyle"),K=a("./enum/BlackoutStyle"),L=a("./exception/BasicException"),M=a("./enum/PanoSizeClass"),N=(a("./tile/TileDownloader"),a("./tile/TilePrioritizer")),O=(a("./enum/PanoramaEvents"),a("./enum/ZoomEvents")),P=a("./util/ZoomStats"),Q=a("./constants"),R=a("./enum/StartupType"),S=a("./util/browser"),T=a("./enum/TagType"),U=a("./gui/buryPoint"),V=(a("./model/Chunks"),new f(c)),W=Object.freeze({FlyToPano:x.getUniqueId(),FlyToNewMode:x.getUniqueId(),FlyToSameMode:x.getUniqueId(),FlyToViewFloor:x.getUniqueId(),LookTransition:x.getUniqueId(),ZoomTransition:x.getUniqueId()}),X=a("./gui/offLine"),Y=new X,Z="/pc/add_label.html?",_="/nest/ifaddtag/?",aa="/nest/ifaddscenes/?",ba=a("./util/texture"),ca=a("./util/statistic_utils");d.prototype=Object.create(y.prototype),d.prototype.init=function(a){this.modelManager=a.modelManager,this.tileDownloader=a.tileDownloader,this.panoRenderer=a.panoRenderer,this.qualityManager=a.qualityManager,this.domElement=a.container,this.camera=a.camera,this.mattertagManager=a.mattertagManager,this.setUpControls(),this.path=new m(a.director,this),this.basePanoSize=this.qualityManager.getPanoSize(M.BASE),this.standardPanoSize=this.qualityManager.getPanoSize(M.STANDARD),this.highPanoSize=this.qualityManager.getPanoSize(M.HIGH),this.ultraHighPanoSize=this.qualityManager.getPanoSize(M.ULTRAHIGH),this.tileDownloader.processPriorityQueue=!1,this.tileDownloader.tilePrioritizer=new N(this.qualityManager,this.basePanoSize,this.standardPanoSize,this.highPanoSize,this.ultraHighPanoSize),this.bindEvents(a.container),this.updateModel()},d.prototype.setupCustomProperties=function(a){var b=a||p.PANORAMA;Object.defineProperty(this,"mode",{get:function(){return b},set:function(a){var c=b;b=a,this.onModeUpdated(c,b)}})},d.prototype.isInMode=function(){for(var a=0;a<arguments.length;a++)if(this.mode===arguments[a])return!0;return!1},d.prototype.isOutsideMode=function(a){return(a=a||this.mode)===p.DOLLHOUSE||a===p.FLOORPLAN},d.prototype.is360View=function(a,b){return a===p.PANORAMA&&b&&!b.isAligned()},d.prototype.setScene=function(a){this.sceneIntersectionPlane=a.plane,this.path.setScene(a),this.moveReticuleToScene(a)},d.prototype.moveReticuleToScene=function(a){this.reticule.parent&&this.reticule.parent.remove(this.reticule),a.add(this.reticule)},d.prototype.updateModel=function(){function a(a,b,d){this.mode===p.DOLLHOUSE&&a!==d&&c.call(this,a.center.y)}function b(a,b){if(this.mode===p.DOLLHOUSE){var e=a?this.model.center.y:d=b.center.y;c.call(this,e)}}function c(a){var b=this.cameras[p.DOLLHOUSE],c=this.controls[p.DOLLHOUSE],d=b.position.y+(a-c.target.y),e=s.showFloorDuration+s.showFloorDelay;x.start(v.property(c.target,"y",a),e,null,s.flydown.movementDelay,w[s.flydown.movementEasing],null,W.FlyToViewFloor),x.start(v.property(b.position,"y",d),e,null,s.flydown.movementDelay,w[s.flydown.movementEasing],null,W.FlyToViewFloor)}this.model=this.modelManager.getActiveModel(),this.model.on("floor.changed",a.bind(this)),this.model.on("allfloors.toggled",b.bind(this)),this.on(F.PanoChosen,this.model.setProjectedPanos.bind(this.model));var e=this;this.model.panos.list.forEach(function(a){a.vrMarker.addEventListener("click",function(){e.flyToPano({pano:a})})})},d.prototype.updateModelDependentData=function(){this.setModelForControls(this.model),this.getPanoMarkersFromModel(this.model)},d.prototype.onModelChanged=function(){this.updateModel(),this.updateModelDependentData()},d.prototype.getPanoMarkersFromModel=function(a){this.panoMarkers=a.panos.list.reduce(function(a,b){return b.marker?a.concat(b.marker):a},[])},d.prototype.setModelForControls=function(a){this.controls[p.DOLLHOUSE].setZoomBounds(a.boundingBox);var b=this.model.boundingBox.clone().expandByScalar(s.modelBoundsPadding);[p.DOLLHOUSE,p.FLOORPLAN].forEach(function(a){this.controls[a].setBounds(b)}.bind(this))},d.prototype.updateControlsForNewMode=function(a,b){this.controls[a]&&(this.controls[a].reset(),this.controls[a].enabled=!1),this.controls[b]&&(this.controls[b].enabled=!0),this.control=this.controls[b]},d.prototype.setUpControls=function(){var a={};a[p.PANORAMA]=new z,a[p.DOLLHOUSE]=new A,a[p.FLOORPLAN]=new B;var b={};b[p.PANORAMA]=new i(a[p.PANORAMA]),b[p.DOLLHOUSE]=new j(a[p.DOLLHOUSE]),b[p.FLOORPLAN]=new k(a[p.FLOORPLAN]);var c=this.handleControlMove.bind(this);b[p.PANORAMA].on(H.Move,c),b[p.DOLLHOUSE].on(H.Move,c),b[p.FLOORPLAN].on(H.Move,c);var d=this.handleControlInputStart.bind(this);b[p.PANORAMA].on(H.InputStart,d),b[p.DOLLHOUSE].on(H.InputStart,d),b[p.FLOORPLAN].on(H.InputStart,d),b[p.PANORAMA].on(H.Pinch,this.handleControlPinch.bind(this)),b[p.PANORAMA].on(H.Scroll,this.handleControlScroll.bind(this)),b[p.PANORAMA].on(H.RulersMove,this.handleControlRulersMove.bind(this)),b[p.PANORAMA].on(H.TtagsMove,this.handleControlTtagsMove.bind(this)),this.controls=b,this.cameras=a},d.prototype.handleControlRulersMove=function(){this.emit(F.RulersMove)},d.prototype.handleControlTtagsMove=function(){this.mattertagManager.ttposition(),S.isIe.versions.trident||S.isEdge.versions.Edge||this.mattertagManager.updateWtposition()},d.prototype.handleControlMove=function(a){this.emit(F.Move,a)},d.prototype.handleControlInputStart=function(a){this.emit(F.InputStart,a)},d.prototype.onModeUpdated=function(a,b){this.updateControlsForNewMode(a,b),this.emit(F.ModeChanged,a,b)},d.prototype.isWarping=function(){return this.path.warping},d.prototype.getLabelScaleFactor=function(){if(this.isOutsideMode()){return Math.sqrt(this.controls[p.FLOORPLAN].currentScale/10)}return.5},d.prototype.bindEvents=function(a){a!==document&&a.setAttribute("tabindex",-1),this.controls[p.PANORAMA].on(H.FlyInDirection,this.flyLocalDirection.bind(this)),a.addEventListener("mousedown",this.onMouseDown.bind(this)),a.addEventListener("mousemove",this.onMouseMove.bind(this)),a.addEventListener("mouseover",this.onMouseOver.bind(this)),a.addEventListener("mouseout",this.onMouseOut.bind(this)),a.addEventListener("mouseup",this.onMouseUp.bind(this)),this.modelManager.on(I.ActiveModelChanged,this.onModelChanged.bind(this)),a.addEventListener("touchstart",this.onTouchStart.bind(this)),a.addEventListener("touchmove",this.onTouchMove.bind(this)),a.addEventListener("touchend",this.onTouchEnd.bind(this)),a.addEventListener("pointerdown",this.onPointerDown.bind(this)),a.addEventListener("pointermove",this.onPointerMove.bind(this)),a.addEventListener("pointerup",this.onPointerUp.bind(this)),a.addEventListener("pointerout",this.onPointerOut.bind(this)),a.addEventListener("pointercancel",this.onPointerCancel.bind(this)),document.addEventListener("keydown",this.onKeyDown.bind(this));for(var b in this.controls)this.controls[b].bindEvents(a)},d.prototype.onMouseDown=function(a){function b(){d.model.panos.index[f.locationId].marker.material.map=ba.loadurl(Y.splitUrl("https://template2.3dnest.cn/common/image/location_512x512.png")),f.materials.free.map=ba.loadurl(Y.splitUrl("https://template2.3dnest.cn/common/image/disable_on_256x256.png")),f.materials.hover.map=ba.loadurl(Y.splitUrl("https://template2.3dnest.cn/common/image/disable_on_256x256.png")),f.disc.material.map=ba.loadurl(Y.splitUrl("https://template2.3dnest.cn/common/image/disable_on_256x256.png")),d.model.panos.index[f.locationId].enable=!0,console.log(f.locationId+": true")}function c(){d.model.panos.index[f.locationId].marker.material.map=ba.loadurl(Y.splitUrl("https://template2.3dnest.cn/common/image/disable_512x512.png")),f.materials.free.map=ba.loadurl(Y.splitUrl("https://template2.3dnest.cn/common/image/disable_off_256x256.png")),f.materials.hover.map=ba.loadurl(Y.splitUrl("https://template2.3dnest.cn/common/image/disable_off_256x256.png")),f.disc.material.map=ba.loadurl(Y.splitUrl("https://template2.3dnest.cn/common/image/disable_off_256x256.png")),d.model.panos.index[f.locationId].enable=!1,console.log(f.locationId+": false")}var d=this,e="/model/roam/hiddenpoint/";if(S.valueFromHash("h")&&(e="/manager_house"+e),this.mattertagManager.intersectTag&&(this.mattertagManager.intersectTag.type===T.Tag360T1||1===this.mattertagManager.intersectTag.subtype))return a.preventDefault(),a.stopImmediatePropagation(),a.currentTarget!==document&&a.currentTarget.focus(),0===a.button&&(this.handleInputStart.call(this,a.clientX,a.clientY,!1),this.updateIntersect()),void 0;if(this.mattertagManager.intersectTag&&this.mattertagManager.intersectTag.type==T.Pano){var f=this.mattertagManager.intersectTag;if(this.model.panos.index[f.locationId].enable){!function(a){if(G.settings.nestscenes&&G.settings.nestscenes.scenes&&G.settings.nestscenes.scenes.length){for(var b=G.settings.nestscenes.scenes,c=0;c<b.length;c++)if(b[c]._camera._locationid===a)return!1}else for(var e=d.model.panos,c=0;c<e.length;c++)if(2!=e.list[c].alignmentType)return e.list[c].id!==a;if(d.model.data.orientations){var f=!1;if(d.model.data.orientations.forEach(function(b,c){b.location_id===a&&(f=!0)}),f)return!1}return!0}(f.locationId)?G.toast("已设置为场景点、定位点或首入点，不能隐藏"):"sms"===G.u[window.location.host].type?s.isNewEditVersion?$.ajax({url:e,type:"POST",data:{point:f.locationId,enable:0}}).success(function(a){c()}).fail(function(a){alert("连接服务器失败")}):$.ajax({url:"/nest/hiddenpoint/",type:"POST",data:{point:f.locationId,enable:0}}).success(function(a){c()}).fail(function(a){alert("连接服务器失败")}):c()}else"sms"===G.u[window.location.host].type?s.isNewEditVersion?$.ajax({url:e,type:"POST",data:{point:f.locationId,enable:1}}).success(function(a){b()}).fail(function(a){alert("连接服务器失败")}):$.ajax({url:"/nest/hiddenpoint/",type:"POST",data:{point:f.locationId,enable:1}}).success(function(a){b()}).fail(function(a){alert("连接服务器失败")}):b()}a.currentTarget!==document&&a.currentTarget.focus(),0===a.button&&(this.handleInputStart.call(this,a.clientX,a.clientY,!1),this.updateIntersect()),s.isEditVersion&&$("#editversion-capture").css("display","none")},d.prototype.onMouseMove=function(a){this.isTouchEvent=!1,this.handleInputMove.call(this,a.clientX,a.clientY,!1)},d.prototype.onMouseOver=function(a){this.containsMouse=!0,!this.mouseDown||0!==a.which&&0!==a.buttons||(this.mouseDown=!1)},d.prototype.onMouseOut=function(a){this.containsMouse=!1},d.prototype.onMouseUp=function(a){if(this.handleInputEnd.call(this,a.clientX,a.clientY,!1,a),s.isEditVersion&&2==a.button){var b=parent.location.href;(b.indexOf("nest/tag")>-1||b.indexOf("nest/highlights")>-1||b.indexOf("nest/orientations")>-1)&&this.monitorSelect(this.intersect,a)}s.isNewEditVersion&&2==a.button&&this.monitorSelect(this.intersect,a)},d.prototype.monitorSelect=function(a,b){var c=new Object;if(c.type=this.currentPano.alignmentType,2!=this.currentPano.alignmentType){if(!a)return;var d={};d.point=a.point.clone(),d.normal=a.normal.clone();var e=d.point.x,f=d.point.y,g=d.point.z,h=d.normal.x,i=d.normal.y,j=d.normal.z;this.spot=new THREE.Vector3(e,f,g),this.spot.add(d.normal.clone().multiplyScalar(this.normal_length));var k=this.spot.x-e,l=this.spot.y-f,m=this.spot.z-g,n=this.currentPano.id,o=this.camera.quaternion;c.nest_floor=$(".floorChoice.active").attr("data-index"),c.locationid=n,c.x=e,c.y=f,c.z=g,c.nx=h,c.ny=i,c.nz=j,c.dx=k,c.dy=l,c.dz=m,c.qw=o.y,c.qx=o.z,c.qy=o.w,c.qz=o.x}else{var p=this.getMouseDirection(),d=Math.sqrt(4/(p.x*p.x+p.y*p.y+p.z*p.z));p.multiplyScalar(d),c.x=p.x,c.y=p.y,c.z=p.z,c.panoid=this.currentPano.id}this.emit(F.EditAddTagHighlight,c)},d.prototype.onTouchStart=function(a){if(a.currentTarget!==document&&a.currentTarget.focus(),!this.mouseDown){var b=t.average(a.changedTouches,"clientX"),c=t.average(a.changedTouches,"clientY");this.handleInputStart.call(this,b,c,!0)}},d.prototype.onTouchMove=function(a){
var b=t.average(a.changedTouches,"clientX"),c=t.average(a.changedTouches,"clientY");this.handleInputMove.call(this,b,c,!0)},d.prototype.onTouchEnd=function(a){this.updateIntersect();var b=t.average(a.changedTouches,"clientX"),c=t.average(a.changedTouches,"clientY");this.handleInputEnd.call(this,b,c,!0,a)},d.prototype.onPointerDown=function(a){},d.prototype.onPointerMove=function(a){},d.prototype.onPointerUp=function(a){},d.prototype.onPointerOut=function(a){},d.prototype.onPointerCancel=function(a){},d.prototype.onKeyDown=function(a){var b=function(){this.control&&this.control.emit(H.Move,"key")}.bind(this),c=a.which,d=this,e=function(a){a?d.currentPano.updateTAngle("y",d.currentPano.adjustTAngleY+.001):d.currentPano.updateTAngle("y",d.currentPano.adjustTAngleY-.001)};switch(c){case r.F:b(),this.changeFloor(-1);break;case r.R:b(),this.changeFloor(1)}if(s.isProduceVersion)switch(c){case r.Z:e(!0);break;case r.X:e(!1)}},d.prototype.handleScrollPinchZoom=function(){return function(a){var b=a,c=this.zoomLevel;this.zoomBy(b),this.currentPano&&this.zoomStats.addZoomAction(c,this.zoomLevel,this.currentPano.id)}}(),d.prototype.handleControlPinch=function(a){s.zoom.enabled?this.handleScrollPinchZoom(1-a):this.flyLocalDirection(new e.Vector3(0,0,a).normalize())},d.prototype.handleControlScroll=function(a){s.zoom.enabled?(a>0?a=1+this.scrollZoomSpeed:a<0&&(a=1-this.scrollZoomSpeed),0!==a&&this.handleScrollPinchZoom(a)):this.flyLocalDirection(new e.Vector3(0,0,-a).normalize())},d.prototype.handleInputStart=function(a,b,c){this.isTouchEvent=c,u.convertScreenPositionToNDC(a,b,this.mouse),u.convertScreenPositionToNDC(a,b,this.mouseAtMouseDown),this.mouseCouldBeClickToMove=!0,this.mouseDown=!0},d.prototype.handleInputMove=function(a,b,c){this.isTouchEvent=c,u.convertScreenPositionToNDC(a,b,this.mouse),!this.inMeasureMode&&this.mouseAtMouseDown.distanceTo(this.mouse)>.02&&(this.mouseCouldBeClickToMove=!1),this.mouseLastMoveTime=Date.now(),this.reticule.move(a,b,c)},d.prototype.handleInputEnd=function(a,b,c,d){if(this.inMeasureMode)this.isTouchEvent=c,this.mouseDown=!1,this.control&&this.control.emit(H.Move,this.isTouchEvent?"touch":"mouse"),this.history.invalidate();else if(this.isTouchEvent=c,this.mouseDown=!1,this.controls[p.PANORAMA].emit("interaction.direct"),this.mouseCouldBeClickToMove){if(this.checkMattertagClick(d))return this.control&&(this.control.enabled=!0,this.control.onMouseUp(d)),!0;if(this.control&&this.control.emit(H.Move,this.isTouchEvent?"touch":"mouse"),this.history.invalidate(),this.intersect)return this.flyToPanoClosestToMouse();if(this.mode===p.PANORAMA){var e=this.closestPanoInDirection(this.getMouseDirection());return e?this.flyToPano({pano:e}):this.bump(this.getMouseDirection())}}},d.prototype.checkMattertagClick=function(a){if(this.mattertagManager.intersectTag){var b=this.isTouchEvent,c=this.mattertagManager.clickedOnTag(b,this,a);return b||c||x.cancelById(W.LookTransition),!0}if(this.mattertagManager.activeTag)return!1},d.prototype.rankedMattertagInDirection=function(a,b){return this.mattertagManager.rankedMattertagInDirection(a,this.position,this.camera,b)},d.prototype.start=function(a){var b=a.mode,c=a.pano,d=a.position,e=a.quaternion,f=a.tag,g=a.quickstart,h=$.Deferred();this.updateModelDependentData(),this.updateFromControls(),this.model.has360Views&&this.findDefaultViews();var i=this.is360View(b,c);return!this.model.outsideAllowed()||i||g?this.startInside(c,d,e,f,h):this.startOutside(a,h),h.done(function(a){this.emit(F.Ready,i,a,f)}.bind(this)),h.promise()},d.prototype.startOutside=function(a,b){var c=a.mode,d=a.pano,e=a.position,f=a.quaternion,g=a.zoom,h=a.floorVisibility,i=a.tag;this.emit(F.StartOutside,s[c].transitionTime),this.isOutsideMode(c)?(this.model.warpDestFloors(h,!0),x.cancelById(W.FlyToViewFloor),c===p.FLOORPLAN?this.floorplanMode(e,f,g):this.dollhouseMode(e,f),b.resolve(!1)):this.startInsideWithFlyin(d,e,f,i,b)},d.prototype.startInside=function(a,b,c,d,e){e=e||$.Deferred(),this.currentPano=a;var f=a&&!a.isAligned();if(b=f?a.position:b||a.position,c=c||a.quaternion,a){f&&this.mattertagManager.update360Tags(a.id);var g=this.startInside.bind(this,a,b,c,d,e);if(this.checkAndWaitForPanoLoad(a,"high","low",this.basePanoSize,g))return}return this.mode=p.PANORAMA,a.floor.enter(this.mode),this.emit(F.PanoChosen,this.currentPano,this.currentPano),this.switchCameraMode(this.mode,c),this.emit(F.StartInside,f),e.resolve(!0),e},d.prototype.startInsideWithFlyin=function(a,b,c,d,e){function f(){return""!=S.valueFromHash("o","")}function g(){return""!=S.valueFromHash("l","")}if(e=e||$.Deferred(),this.dollhouseMode(),!a)return V.warn("Player.startInsideWithFlyin() -> targetPano is invalid."),e.resolve(!1),e;b=b||a.position;var h=c||this.control.camera.quaternion,i=a.position;return this.fitDollhouse(i,b,h),setTimeout(function(b){this.control&&(this.control.maxDistance=b);var d={mode:p.PANORAMA,pano:a,quaternion:c,callback:function(){e.resolve(!0)}.bind(this)};this.model.data.player_options.show3d?this.model.startup_type!==R.STAY3D||f()||g()?this.flyToNewMode(d):e.resolve(!0):this.flyToNewMode(d)}.bind(this,this.control.maxDistance),s.startupFlyinDelay),e},d.prototype.checkAndWaitForPanoLoad=function(a,b,c,d,e,f,g,h,i,j){return null!==h&&void 0!==h||(h=!0),this.model.supportsTiles?this.checkAndWaitForTiledPanoLoad(a,d,e,f,g,h,i,j):this.checkAndWaitForWholePanoLoad(a,b,c,e,h)},d.prototype.checkAndWaitForWholePanoLoad=function(a,b,c,d,e){if(!a)throw new L("Player.checkAndWaitForWholePanoLoad() -> Cannot load texture for null pano.");return e&&this.model.waitForLoad(a,function(){return a.isLoaded(c)}),!a.isLoaded(b)&&(a.loadCube(b).done(d),!0)},d.prototype.checkAndWaitForTiledPanoLoad=function(){var a=new e.Vector3,b=[];return function(c,d,e,f,g,h,i,j){if(!c)throw new L("Player.checkAndWaitForTiledPanoLoad() -> Cannot load texture for null pano.");if(a.copy(q.FORWARD),this.getDirection(a),c.isLoaded(d))return!1;var k=d+":"+c.id;return b[k]||(b[k]=!0,h&&this.model.waitForLoad(c,function(){return c.isLoaded(d)}),c.loadTiledPano(d,a,null,i,j).done(function(a,c){b[k]=!1,e&&e(a,c)}.bind(this)).fail(function(a){b[k]=!1,f&&f(a)}.bind(this)).progress(function(a,b,c){g&&g(a,b,c)}.bind(this))),!0}}(),d.prototype.switchCameraMode=function(a,b){var c=this.controls[a],d=c.camera;switch(a){case p.PANORAMA:d.position.copy(this.currentPano.position);var f=b?q.FORWARD.clone().applyQuaternion(b):this.getDirection().setY(0).normalize();c.lookAt(f.add(d.position));break;case p.DOLLHOUSE:var g=this.position.clone();this.mode===p.PANORAMA?g.add(new e.Vector3(0,6,0)).add(this.getDirection().multiplyScalar(-10)):g.add(q.DOWN.clone().applyQuaternion(this.quaternion).multiplyScalar(6)).setY(6),d.position.copy(g),c.target.copy(this.target.clone().setY(this.model.center.y));break;case p.FLOORPLAN:d.position.copy(this.model.center).setY(10),c.target.copy(this.model.center).setY(0),c.zoomToContain(this.model.size),c.rotateToView(this.model.size,this.getDirection())}c.update(0)},d.prototype.update=function(){var a=(new e.Vector3,{}),b=[];return function(c){this.updatePersistentZooming(c),this.updateFromControls(c),this.getCurrentNodePanos(b),this.hasChanged(a)&&(this.lastChangeTime=Date.now(),!this.mouseDown&&this.containsMouse&&this.updateIntersect(),this.model.supportsTiles&&this.updateTileDownloader(b),this.emit(F.ViewChanged)),this.model.supportsTiles&&(this.updateTileDownloader(a),this.updatePanoRenderer(a),this.updateZoomPano()),this.updatePreRendering(b),this.reticule.update(),this.path.update(),this.spider.update(),this.cachedPanoCandidates&&s.navigation.panoScores&&this.model.panos.showPanoScores(this.cachedPanoCandidates),this.updateControlLocks()}}(),d.prototype.updatePersistentZooming=function(a){1===this.zooming?this.zoomBy(1+this.zoomSpeed*a):-1===this.zooming&&this.zoomBy(1-this.zoomSpeed*a)},d.prototype.updateControlLocks=function(){this.currentPano&&this.model.supportsTiles&&(this.controls[p.PANORAMA].locked=!this.currentPano.highestFullTileRenderOpCompleted&&this.currentPano.lockUntilRenderingComplete)},d.prototype.updatePanoRenderer=function(){var a=new e.Vector3;return function(b){(this.nextPano||this.currentPano)&&(a.copy(q.FORWARD),this.getDirection(a),this.panoRenderer.updateDirection(a))}}(),d.prototype.cleanupInactivePanos=function(){var a=[],b=[];return function(){a.length=0,a.push(this.currentPano),this.nextPano&&a.push(this.nextPano),b.length=0;for(var c=0;c<this.panoRenderer.activePanos.length;c++)b.push(this.panoRenderer.activePanos[c]);for(var d=0;d<b.length;d++){for(var e=b[d],f=!0,g=0;g<a.length;g++)e.id===a[g].id&&(f=!1);f&&e.exit()}}}(),d.prototype.updatePreRendering=function(){var a={};return function(b){if(1===s.tiling.preRenderTourPanos&&this.preRenderingEnabled){var c=this.nextPano||this.currentPano;if(c&&b&&b.length>1){var d=b.findIndex(function(a){if(a.id===c.id)return!0});if(d>=0&&d+1<b.length){var e=b[d+1];e.isLoaded(this.basePanoSize)||a[e.id]||(window.setTimeout(function(b){this.checkAndWaitForPanoLoad(b,"high","low",this.basePanoSize,null,null,null,!1,!1,!1),window.setTimeout(function(b){a[b.id]=!1}.bind(this,b),s.tiling.panoPreRenderRepeatDelay)}.bind(this,e),s.tiling.panoPreRenderDelay),a[e.id]=!0)}}}}}(),d.prototype.enablePreRendering=function(){this.preRenderingEnabled=!0},d.prototype.disablePreRendering=function(){this.preRenderingEnabled=!1,this.cleanupInactivePanos()},d.prototype.updateTileDownloader=function(){var a=new e.Vector3;return function(b){var c=this.nextPano||this.currentPano;c&&(a.copy(q.FORWARD),this.getDirection(a),this.tileDownloader.tilePrioritizer.updateCriteria(c,this.position,a,b.length>0?b:null),this.tileDownloader.tilePrioritizer.zoomingActivated=this.zoomLevel>1,this.tileDownloader.processPriorityQueue=!0)}}(),d.prototype.updateFromControls=function(a){null!==a&&void 0!==a||(a=0),this.control&&(this.control.update(a),this.quaternion.copy(this.control.camera.quaternion),this.position.copy(this.control.camera.position),this.target.copy(this.control.target),this.control.camera.updateProjectionMatrix(),this.camera.projectionMatrix.copy(this.control.camera.projectionMatrix)),this.camera.position.copy(this.position),this.camera.quaternion.copy(this.quaternion),this.camera.updateMatrix(),this.camera.updateMatrixWorld()},d.prototype.hasChanged=function(a){if(!this.previousState)return this.previousState={allFloorsVisible:this.model.allFloorsVisible,position:this.position.clone(),quaternion:this.quaternion.clone(),mouse:this.mouse.clone(),zoom:this.getLabelScaleFactor(),currentFloor:this.model.currentFloor,projectionMatrix:this.camera.projectionMatrix.clone(),worldMatrix:this.camera.matrixWorld.clone(),mode:this.mode,modelPosition:this.model.position.clone(),modelCenter:this.model.center.clone(),zooming:this.zooming},!0;var b=this.model.allFloorsVisible===this.previousState.allFloorsVisible&&this.position.equals(this.previousState.position)&&this.quaternion.equals(this.previousState.quaternion)&&this.mouse.equals(this.previousState.mouse)&&this.getLabelScaleFactor()===this.previousState.zoom&&this.model.currentFloor===this.previousState.currentFloor&&this.camera.projectionMatrix.equals(this.previousState.projectionMatrix)&&this.camera.matrixWorld.equals(this.previousState.worldMatrix)&&this.mode===this.previousState.mode&&this.model.position.equals(this.previousState.modelPosition)&&this.model.center.equals(this.previousState.modelCenter)&&null!==this.nextPano&&this.zooming===this.previousState.zooming;return a.allFloorsVisible=this.model.allFloorsVisible!==this.previousState.allFloorsVisible,a.moved=!this.position.equals(this.previousState.position),a.rotated=!this.quaternion.equals(this.previousState.quaternion),a.mouseMoved=!this.mouse.equals(this.previousState.mouse),a.zoomed=this.getLabelScaleFactor()!==this.previousState.zoom,a.floorChanged=this.model.currentFloor!==this.previousState.currentFloor,a.cameraProjectionChanged=!this.camera.projectionMatrix.equals(this.previousState.projectionMatrix),a.cameraWorldMatrixChanged=!this.camera.matrixWorld.equals(this.previousState.worldMatrix),a.modeChanged=this.mode!==this.previousState.mode,a.modelPositionChanged=!this.model.position.equals(this.previousState.modelPosition),a.modelCenterChanged=!this.model.center.equals(this.previousState.modelCenter),a.nextPanoActive=null!==this.nextPano,a.zooming=this.zooming!==this.previousState.zooming,this.previousState.allFloorsVisible=this.model.allFloorsVisible,this.previousState.position.copy(this.position),this.previousState.quaternion.copy(this.quaternion),this.previousState.mouse.copy(this.mouse),this.previousState.zoom=this.getLabelScaleFactor(),this.previousState.currentFloor=this.model.currentFloor,this.previousState.projectionMatrix.copy(this.camera.projectionMatrix),this.previousState.worldMatrix.copy(this.camera.matrixWorld),this.previousState.mode=this.mode,this.previousState.modelPosition.copy(this.model.position),this.previousState.modelCenter.copy(this.model.center),this.previousState.zooming=this.zooming,!b},d.prototype.updateIntersect=function(){var a=this.flying||this.isWarping(),b=this.isOutsideMode()&&this.controls[this.mode].isEngaged(),c=x.getById(W.LookTransition),d=!(a||b||this.isTouchEvent||c.length&&c[0].running);this.mattertagManager.intersectMattertag(this.mouse,d,this.camera)||(this.intersect=this.getMouseIntersect(),this.intersect&&this.updateClosestPano(this.intersect),this.closestPano||this.closestPanoInDirection(this.getMouseDirection())?(this.reticule.updatePosition(this.position,this.intersect),s.navigation.panoScores&&!s.navigation.mouseDirection&&this.closestPanoInDirection(this.getDirection())):(this.reticule.updatePosition(this.position,this.intersect),s.isEditVersion&&this.addTagReticule.hide()))},d.prototype.getMouseDirection=function(a){a=a||this.mouse;var b=new e.Vector3(a.x,a.y,-1).unproject(this.camera);return new e.Vector3(a.x,a.y,1).unproject(this.camera).sub(b).normalize()},d.prototype.getMouseOnWholeIntersect=function(a){var b=a.clientX/window.innerWidth*2-1,c=-a.clientY/window.innerHeight*2+1,d=new THREE.Vector3(b,c,-1);return d.unproject(this.camera),d},d.prototype.getMouseIntersect=function(a,b){a=a||this.mouse.clone(),b=b||this.model.floors.reduce(function(a,b){return b.hidden?a:a.concat(b.collider.children)},this.mode===p.PANORAMA?this.panoMarkers:[]);var c=new e.Vector3(a.x,a.y,-1).unproject(this.camera);this.raycaster.set(c,this.getMouseDirection(a));var d=this.raycaster.intersectObjects(b);if(0===d.length)return null;if(s.isEditVersion||s.isNewEditVersion){var f=this.raycaster.intersectObjects(G.model.chunks);0!==f.length&&(G.interchunkid=f[0].object.id)}var g=d[0];if(g.face){g.normal=g.face.normal.applyQuaternion(g.object.quaternion);this.position.clone().sub(g.point).dot(g.normal)<0&&g.normal.negate(),this.currentPano?g.onFloor=g.point.y<this.position.y-.5*this.currentPano.height:g.onFloor=g.point.y<this.position.y-.5,g.horizontal=g.normal.y>.8}return g},d.prototype.updateClosestPano=function(a){if(this.currentPano){var b=[l.filters.isPanoAligned()];this.mode===p.PANORAMA?(b.push(l.filters.not(this.currentPano)),b.push(l.filters.inFloorDirection(this.currentPano.floorPosition,this.getDirection(),.25)),b.push(l.filters.isNeighbourPanoTo(this.currentPano)),b.push(l.filters.isCloseEnoughTo(a.point,s.panoFloorClickRadius)),b.push(l.filters.isNotBehindNormal(a.point,a.normal))):(b.push(l.filters.isOnVisibleFloor()),this.mode!==p.FLOORPLAN&&b.push(l.filters.inDirection(this.position,this.getDirection(),.25)));var c=this.model.panos.find(b,[l.sortFunctions.floorDistanceToPoint(a.point)]);c!=this.closestPano&&(this.emit(F.ClosestPanoChanging,this.closestPano,c,this.mode),this.closestPano=c)}},d.prototype.dollhouseMode=function(a,b){this.emit(F.ModeChanging,this.mode,p.DOLLHOUSE),this.mode=p.DOLLHOUSE,this.controls[p.DOLLHOUSE].reset();var c=new e.Vector3(this.model.center.x,0,this.model.center.z),d=new e.Vector3(15,10,15);if(a&&b){var f=q.FORWARD.clone().applyQuaternion(b),g=this.model.center.clone().sub(a),h=g.dot(f);h>0?(c=f.clone().multiplyScalar(h).add(a),d.copy(a)):V.warn("Tried to initiate dollhouse mode that wasn't looking at the model",a,b)}this.controls[p.DOLLHOUSE].resetRanges(0,!0),this.controls[p.DOLLHOUSE].target.copy(c),this.cameras[p.DOLLHOUSE].position.copy(d),this.updateFromControls(),this.model.alpha=1,this.model.skybox.material.uniforms.opacity.value=0},d.prototype.insideMode=function(a,b){var c=b||null;if(this.mode!==p.PANORAMA&&this.mode!==p.TRANSITIONING){var d=[l.filters.isPanoAligned()];this.model.currentFloor&&d.push(l.filters.atFloor(this.model.currentFloor)),a=a||this.currentPano||this.model.panos.find(d,[l.sortFunctions.distanceToPoint(this.control.target)]),this.flyToNewMode({mode:p.PANORAMA,pano:a,callback:c})}},d.prototype.fitDollhouse=function(a,b,c){var d=q.FORWARD.clone().applyQuaternion(c);this.control.target.copy(d).add(a);var f=q.RIGHT.clone().applyQuaternion(c),g=q.UP.clone(),h=f.clone().applyAxisAngle(g,Math.PI/2),i=this.model.boundingBox.max.clone(),j=this.model.boundingBox.min.clone(),k=[new e.Vector3(i.x,0,i.z).sub(a),new e.Vector3(i.x,0,j.z).sub(a),new e.Vector3(j.x,0,i.z).sub(a),new e.Vector3(j.x,0,j.z).sub(a)],l=0,m=0,n=0;k.forEach(function(a,b,c){var d=Math.abs(a.dot(f)),e=a.dot(h);d>l&&(l=d,m=e),e>n&&(n=e)});var o=Math.sqrt(Math.pow(i.x-j.x,2)+Math.pow(i.z-j.z,2)),p=o+1/Math.max(2*o,1);this.modellen=o;var r=Math.max(Math.abs(new e.Vector3(0,i.y,0).sub(a).dot(g)),Math.abs(new e.Vector3(0,j.y,0).sub(a).dot(g))),t=h.clone().multiplyScalar(m).add(b),u=h.clone().multiplyScalar(n).add(b);m=l/Math.tan(this.control.camera.fov/2*this.control.camera.aspect*(Math.PI/180)),n=r/Math.tan(this.control.camera.fov/2*(Math.PI/180)),m=Math.max(.5*m,p),n=Math.max(.5*n,p);var v=d.clone().multiplyScalar(-m).add(t).sub(b).length(),w=d.clone().multiplyScalar(-n).add(t).sub(b).length();this.control.maxDistance=s.skyboxRadius-1,v>=w?this.control.camera.position.set(0,6,0).add(t).add(d.multiplyScalar(1.1*-m)):this.control.camera.position.set(0,6,0).add(u).add(d.multiplyScalar(1.1*-n))},d.prototype.floorplanMode=function(a,b,c){this.mode=p.FLOORPLAN;var d=this.controls[p.FLOORPLAN];d.reset();var e=a||this.model.center;if(d.target.copy(e).setY(0),d.camera.position.copy(e).setY(10),c?(d.currentScale=c/(window.innerWidth/window.innerHeight),d.absoluteScale=d.currentScale):d.zoomToContain(this.model.size),b){var f=q.LEFT.clone().applyQuaternion(b);d.rotateLeft(-Math.atan2(f.x,f.z))}else d.rotateToView(this.model.size,this.getDirection());d.update(0)},d.prototype.nonInterruptingFlyToPano=function(a,b){return a.skipWarpingCheck=!0,this.flyToPano(a,b)},d.prototype.flyToPano=function(a,b){var c=this,d=a.pano,f=a.lookAtPoint,g=a.duration,h=a.maxDistanceOverride,i=a.skipWarpingCheck,j=a.constantMoveSpeed,k=null,l=null,m=U[window.location.hostname];if(this.isWarping()&&!i){if(this.path.activeTransType===J.BLACK)return V.warn("Player.flyToPano() -> Cannot fly when warping"),b&&b(),!1;k=t.deepExtend(a),k.skipWarpingCheck=!0;var n=this.flyToPano.bind(this,k,null);return this.emit(F.WarpInterruptedWithFlyTo,this.path.activeTransType,n),b&&b(),!1}if(this.updateLastView(),this.mode!==p.PANORAMA)return m&&G._hmt&&(G._hmt.push(["_trackEvent",m[12].desc,U.trigger,U.modelid]),G._hmt.push(["'"+U.type.custom+"'","'"+m[12].id+"'","'"+U.modelid+"'"]),ca.trackEvent(12)),void this.flyToNewMode({mode:p.PANORAMA,pano:d,callback:b});if(!d||(k=t.deepExtend(a),l=this.flyToPano.bind(this,k,b),!this.checkAndWaitForPanoLoad(d,"high","low",this.basePanoSize,l))){var o=function(a){b&&b(a)}.bind(this);this.currentPano||(this.currentPano=d,this.path.placeCpm(),this.path.fadeOutCpm(s.path.fadeOutTime),this.spider.draw());var r=g;if("number"!=typeof g){var u=h||s.transition.flytimeMaxDistanceThreshold;r=(Math.min(this.currentPano.position.distanceTo(d.position),u)*s.transition.flytimeDistanceMultiplier+s.transition.flyTime)*this.speedmultiplier()}if(s.transition.flySpeed>.01&&(r=1e3*this.currentPano.position.distanceTo(d.position)/s.transition.flySpeed),1!==this.zoomLevel)switch(s.zoom.transitionStyle){case 1:this.smoothZoomToDefault(r/2);break;case 2:return k=t.deepExtend(a),l=this.flyToPano.bind(this,k,b),void this.smoothZoomToDefault(s.zoom.restoreTime*(this.zoomLevel-1),l)}if(f){x.cancelById(W.LookTransition),r*=s.transition.aimSlowFactor;var y=this.control.camera.quaternion.clone(),z=(new e.Matrix4).lookAt(d.position,f,q.UP),A=(new e.Quaternion).setFromRotationMatrix(z),B=y.clone(),C=new e.Vector3;if(d===this.currentPano){var D=q.FORWARD.clone().applyQuaternion(y),E=q.FORWARD.clone().applyQuaternion(A),H=D.angleTo(E),I=1*Math.sqrt(H)/s.mattertags.navigate.rotateSpeedFactor*1e3;return this.mattertagManager&&(this.mattertagManager.ttflying=!0),void x.start(function(a){B.copy(y),v.quaternion(B,A)(a),C.copy(q.FORWARD).applyQuaternion(B).add(this.control.camera.position),this.control.lookAt(C)}.bind(this),I,o,0,w[s.transition.movementEasing],null,W.LookTransition)}}if(d===this.currentPano||this.flying)return void o();this.flying=!0;var K=this.position.clone(),L=this.currentPano;V.debug("Flying to pano ",d.position),this.emit(F.PanoChosen,this.currentPano,d),this.emit(F.FlyingStarted,d.position,K,d,L),f&&x.start(function(a){B.copy(y),v.quaternion(B,A)(a),C.copy(q.FORWARD).applyQuaternion(B).add(this.control.camera.position),this.control.lookAt(C)}.bind(this),r,null,0,w[s.transition.movementEasing],null,W.LookTransition);var M=j?null:w[s.transition.movementEasing];m&&G._hmt&&(G._hmt.push(["_trackEvent",m[11].desc,U.trigger,U.modelid]),ca.trackEvent(11,this.currentPano.id)),this.nextPano=d,x.start(v.uniform(this.model.skybox,"progress",1),r,null,0,w[s.transition.blendEasing],"skyFly",W.FlyToPano),x.start(v.allUniforms(this.model.chunks,"progress",1),r,null,0,w[s.transition.blendEasing],"chunkFly",W.FlyToPano),x.start(v.vector(this.cameras[p.PANORAMA].position,d.position),r,function(a){this.flying=!1,this.currentPano.exit(),d.enter(),this.currentPano=d,this.nextPano=null,this.path.placeCpm(),this.path.fadeOutCpm(s.path.fadeOutTime),this.spider.draw(),this.emit(F.FlyingEnded,d.position,K,d,L),o(a),c.currentPano&&console.log("flyToPano - entered:"+c.currentPano.id)}.bind(this),0,M,"camFly",W.FlyToPano)}},d.prototype.fastForwardActivePanoFlight=function(a){a=a||s.transition.fastForwardFactor/10*4+1;for(var b=x.getById(W.FlyToPano),c=0;c<b.length;c++)x.adjustSpeed(b[c],a)},d.prototype.speedmultiplier=function(){if("flex"===$("#multiplier-speed").css("display")){var a=1,b=1200;switch($("#multiplier-speed p").text()){case"0.3×":a=3,b*=1.5,s.warp.minWarpTime=b;break;case"0.5×":a=2,b*=1.2,s.warp.minWarpTime=b;break;case"1.0×":a=1;break;case"1.5×":a=.67;break;case"2.0×":a=.5;break;default:a=1}return a}return 1},d.prototype.flyToPanoClosestToMouse=function(){if(Date.now()-this.mouseLastMoveTime>50&&(this.intersect=this.getMouseIntersect(),this.intersect&&this.updateClosestPano(this.intersect)),this.closestPano)return this.flyToPano({pano:this.closestPano});var a=this.getMouseDirection();this.flyDirection(a)||this.flyToPano({pano:this.currentPano})},d.prototype.flyLocalDirection=function(a){var b=this.getDirection(a),c=1===a.z?.4:.75,d=1===Math.abs(a.x);this.flyDirection(b,c,d)},d.prototype.flyDirection=function(a,b,c){this.history.invalidate();var d=this.closestPanoInDirection(a,b,c);return d?(this.flyToPano({pano:d}),!0):(this.bump(a),!1)},d.prototype.closestPanoInDirection=function(a,b,c){return this.rankedPanoInDirection(0,a,b,c)},d.prototype.rankedPanoInDirection=function(){var a={pano:null,candidates:[]};return function(b,c,d,e){b||(b=0),d=void 0!==d?d:.75;var f=e?"angle":"direction";return this.model.panos.findRankedByScore(b,[l.filters.isPanoAligned(),l.filters.inPanoDirection(this.position,c,d),l.filters.isNeighbourPanoTo(this.currentPano),l.filters.not(this.currentPano)],[l.scoreFunctions.distanceSquared(this.currentPano),l.scoreFunctions[f](this.position,c)],a),this.cachedPanoCandidates=a.candidates,a.pano}}(),d.prototype.bump=function(a){if(this.mode===p.PANORAMA&&!this.flying&&!this.isWarping()){var b,c,d,e=s.transition,f=(e.flytimeMaxDistanceThreshold*e.flytimeDistanceMultiplier+e.flyTime)/8,g=this.camera.getWorldDirection().dot(a);if(Math.abs(g)>.5)b=function(){x.start(v.property(this.cameras[p.PANORAMA],"zoom",g>0?1.04:.96),f,c,0,w.easeInOutSine,"bumpZStart")}.bind(this),c=function(){x.start(v.property(this.cameras[p.PANORAMA],"zoom",1),5*f,d,0,w.easeInOutSine,"bumpZRelax")}.bind(this);else{var h=this.camera.position.clone(),i=a.clone();this.raycaster.set(h,i);var j=this.model.floors.reduce(function(a,b){return a.concat(b.collider.children)},[]),k=this.raycaster.intersectObjects(j),l=k.length>0?k[0].distance/25:.04,m=h.clone().add(i.multiplyScalar(l));b=function(){x.start(v.vector(this.cameras[p.PANORAMA].position,m),f,c,0,w.easeInOutSine,"bumpTStart")}.bind(this),c=function(){x.start(v.vector(this.cameras[p.PANORAMA].position,h),5*f,d,0,w.easeInOutSine,"bumpTRelax")}.bind(this)}d=function(){this.flying=!1}.bind(this),this.flying=!0,b()}},d.prototype.changeFloor=function(a,b){var c=this.controls[this.mode];if(c&&c.emit(H.Move,b),b&&this.controls[p.PANORAMA].emit(H.InteractionGui,"floor-control"),!this.is360View(this.mode,this.currentPano))if(this.mode===p.PANORAMA){var d=this.history.reversePano(a);d&&d.isAligned()?this.flyToPano({pano:d}):this.changeFloorByScore(a)}else this.model.setFloor(this.model.nextFloor(a)||this.model.currentFloor)},d.prototype.changeFloorByScore=function(){var a={pano:null,candidates:[]};return function(b){var c=this.model.nextFloor(b);return c?(this.model.panos.lowestByScore([l.filters.atFloor(c),l.filters.isPanoAligned()],[l.scoreFunctions.distance(this.currentPano),l.scoreFunctions.direction(this.position,new e.Vector3(0,b,0)),l.scoreFunctions.penalizeHeightDifferenceUnder(this.position,.5)],a),void(a.pano?(this.cachedPanoCandidates=a.candidates,this.history.push(b,this.currentPano),this.flyToPano({pano:a.pano})):V.warn("No pano found on selected floor, not moving there."))):void V.debug("player.changeFloor("+b+"): no such floor")}}(),d.prototype.gotoFloor=function(a,b){var c=a-this.model.currentFloor.floorIndex;this.changeFloor(c,b)},d.prototype.getDirection=function(a){return a=a||(new e.Vector3).copy(q.FORWARD),a.applyQuaternion(this.camera.quaternion)},d.prototype.getHighlightDirection=function(a){return a=a||(new e.Vector3).copy(q.FORWARD),a.applyQuaternion(this.model.heroImage._camera._rotation)},d.prototype.flyToSameMode=function(a,b,c,d){var f=this;if(this.mode===p.TRANSITIONING)return V.warn("should not be transitioning here"),void(d&&d(!1));var g=c||!1,h=c?c.position:this.position,i=this.position.clone(),j=this.currentPano;if(V.debug("New pose in mode "+this.mode),a){var k=this.flyToSameMode.bind(this,a,b,c,d);if(this.checkAndWaitForPanoLoad(a,"high","low",this.basePanoSize,k))return}var l=function(){this.emit(F.FlyingEnded,h,i,a,j),d&&d(!0),f.currentPano&&console.log(" flyToSameMode - entered:"+f.currentPano.id)}.bind(this),m=s[this.mode],n=void 0!==b?b:m.transitionTime,o=new e.Vector3,q=new e.Vector3;if(this.emit(F.FlyingStarted,h,i,a,j),this.mode===p.PANORAMA)V.warn("we should not be here for panorama views");else if(this.mode===p.DOLLHOUSE)if(g){var r=new e.Vector3(0,1,0);this.controls[p.DOLLHOUSE].resetRanges(1,!0),this.model.warpDestFloors(c.floorVisibility),q.copy(c.position);var t=new e.Vector3(0,0,-1).applyQuaternion(c.quaternion),u=new e.Raycaster(q.clone(),t.clone(),0,1/0),y=u.intersectObjects(this.model.colliders),z=3;y.length?(o.copy(y[0].point),z=.75*q.distanceTo(o)):(o.copy(t).multiplyScalar(3).add(q),V.debug("Tried to restore dollhouse mode that did not intersect...",c.position,c.quaternion));var A=(new e.Matrix4).lookAt(q,o,r),B=(new e.Euler).setFromRotationMatrix(A,s.warp.eOrder),C=o.distanceTo(q),D=(new e.Matrix4).lookAt(this.cameras[p.DOLLHOUSE].position,this.controls[p.DOLLHOUSE].target,r),E=(new e.Euler).setFromRotationMatrix(D,s.warp.eOrder),G=this.cameras[p.DOLLHOUSE].position.distanceTo(this.controls[p.DOLLHOUSE].target);this.controls[p.DOLLHOUSE].resetRanges(Math.min(G,z),!0);var H=new e.Euler(B.x-E.x,B.y-E.y,B.z-E.z,s.warp.eOrder);H.y=H.y>Math.PI?H.y-=2*Math.PI:H.y<-Math.PI?H.y+=2*Math.PI:H.y,this.path.burnsDir=Math.sign(H.y);var I=new e.Euler(0,0,0,s.warp.eOrder),J=new e.Vector3;x.start(v.vector(this.controls[p.DOLLHOUSE].target,o),n,null,s.flydown.movementDelay,w[s.flydown.movementEasing],null,W.FlyToSameMode),x.start(function(a,b){I.x=E.x+a*H.x,I.y=E.y+a*H.y,I.z=E.z+a*H.z;var c=G+a*(C-G);J.set(0,0,c).applyEuler(I).add(this.controls[p.DOLLHOUSE].target),this.cameras[p.DOLLHOUSE].position.copy(J).add(this.model.position)}.bind(this),n,null,s.flydown.movementDelay,w[s.flydown.movementEasing],null,W.FlyToSameMode),x.start(function(a,b){this.controls[p.DOLLHOUSE].update(),this.quaternion.copy(this.cameras[p.DOLLHOUSE].quaternion),this.position.copy(this.cameras[p.DOLLHOUSE].position)}.bind(this),n,null,s.flydown.movementDelay,w[s.flydown.movementEasing],null,W.FlyToSameMode)}else V.warn("invalid warp destination in flyToSameMode()? ignore it then");else if(this.path.placeCpm(),this.path.fadeInCpm(s.path.fadeInTime),c){this.model.warpDestFloors(c.floorVisibility);var K=this.cameras[p.FLOORPLAN],L=this.controls[p.FLOORPLAN],M=L.target.clone(),N=c.position.clone().sub(M),O=K.position.clone().sub(L.target),P=O.length(),Q=new e.Vector3(-1,0,0).applyQuaternion(c.quaternion).normalize(),R=Math.atan2(L.offset.x,L.offset.z),S=Math.atan2(Q.x,Q.z),T=L.absoluteScale,U=c.orthoZoom/(window.innerWidth/window.innerHeight);x.start(function(a,b){L.target.copy(N).multiplyScalar(a).add(M);var c=R+(S-R)*a;L.offset.x=P*Math.sin(c),L.offset.z=P*Math.cos(c),K.position.copy(L.target).add(L.offset),L.absoluteScale=T+a*(U-T),L.update(),this.quaternion.copy(K.quaternion),this.position.copy(K.position),this.target.copy(L.target),this.camera.projectionMatrix.copy(K.projectionMatrix)}.bind(this),n,null,0,w[s.flydown.movementEasing],null,W.FlyToSameMode)}else V.info("flyToSameMode() funny floorplan view? skipping");x.setTimeout(function(a){this.mode=a,l()}.bind(this,this.mode),n,W.FlyToSameMode),this.mode=p.TRANSITIONING},d.prototype.flyToNewMode=function(a){var b=this;a=a||{};var c=a.mode,d=a.pano,f=a.duration,g=a.warpDest,h=a.callback,i=a.force,j=a.quaternion;if(this.isWarping())return V.warn("Player.flyToNewMode() -> Cannot fly when warping"),void(h&&h(!1));if(this.mode===p.TRANSITIONING)return void(h&&h(!1));if(c===this.mode)return i?void this.flyToSameMode(d,f,g,h):void(h&&h(!1));var k=g||!1;V.debug("Switching mode to "+c);var l=this.flyToNewMode.bind(this,a);if(!d||!this.checkAndWaitForPanoLoad(d,"low","low",this.basePanoSize,l)){if(!!d&&this.mattertagManager.update360Tags(d.id),this.mattertagManager.hideShowTagsForBlackoutStyle(K.FADEIN,1e3),!this.model.meshTexturesLoaded&&this.isOutsideMode(c))return V.info("Waiting for model textures to be loaded before going out to dollhouse"),this.model.waitForLoad(this.model,function(){return this.model.meshTexturesLoaded}.bind(this)),void this.model.loadMeshTextures().done(l);this.history.invalidate(),this.updateLastView();var m=this.mode,n=this.cameras[c];a=t.deepExtend({},s[c],s[m+"-"+c]);var o=void 0!==f?f:a.transitionTime;this.emit(F.ModeChanging,m,c,d),d&&(this.currentPano=d),this.switchCameraMode(c,j),x.cancelById(W.LookTransition);var q=(new e.Vector3).copy(this.position);if(c===p.PANORAMA)this.emit(F.PanoChosen,d,d),setTimeout(function(){d.floor.enter(c)}.bind(this),o/2),this.path.fadeOutCpm(s.path.fadeOutTime);else if(c===p.DOLLHOUSE){if(k&&(this.model.stayPut=!0),g?(this.controls[p.DOLLHOUSE].resetRanges(1,!0),this.model.warpDestFloors(g.floorVisibility)):this.model.toggleAllFloors(!0),this.path.placeCpm(),this.path.fadeInCpm(s.path.fadeInTime),k){var r=new e.Vector3(this.model.center.x,0,this.model.center.z);q.set(15,10,15);var u=new e.Vector3(0,0,-1).applyQuaternion(g.quaternion),y=new e.Raycaster(g.position.clone(),u.clone(),0,1/0),z=y.intersectObjects([this.sceneIntersectionPlane]);z.length?(r.copy(z[0].point),
q.copy(g.position),this.controls[p.DOLLHOUSE].resetRanges(.75*q.distanceTo(r),!0)):(V.warn("Tried to restore dollhouse mode that did not intersect...",g.position,g.quaternion),this.controls[p.DOLLHOUSE].resetRanges(3,!0)),this.controls[p.DOLLHOUSE].target.copy(r),q.add(this.model.position),n.position.copy(q),this.controls[p.DOLLHOUSE].update()}}else if(this.path.placeCpm(),this.path.fadeInCpm(s.path.fadeInTime),g){this.model.warpDestFloors(g.floorVisibility);var A=this.cameras[p.FLOORPLAN],B=this.controls[p.FLOORPLAN],C=A.position.clone().sub(B.target),G=new e.Vector3(-1,0,0).applyQuaternion(g.quaternion).normalize(),H=Math.atan2(G.x,G.z);B.target.copy(g.position);var I=C.length();B.offset.x=I*Math.sin(H),B.offset.y=0,B.offset.z=I*Math.cos(H),A.position.copy(B.target).add(B.offset),B.target.clone().sub(n.position),n.quaternion.copy(g.quaternion),B.currentScale=g.orthoZoom/(window.innerWidth/window.innerHeight),B.absoluteScale=B.currentScale,B.update()}else this.model.currentFloor.enter(c);var L=this.currentPano,M=this.position.clone();this.emit(F.FlyingStarted,q,M,d,this.currentPano),this.flying=!0,this.isOutsideMode(c)&&this.is360View(m,L)?(k||c!==p.DOLLHOUSE||(n.position.set(15,10,15),n.controls.target.set(this.model.center.x,0,this.model.center.z),n.controls.update()),a.blackoutStyle=K.FADEIN,o=s.show360Views.transitionTime,this.fade360View(o,n,a)):this.isOutsideMode(m)&&this.is360View(c,d)?(k&&this.switchCameraMode(c,k.quaternion),this.mode=c,this.path&&this.path.popOutCpm(),a.blackoutStyle=K.END,o=s.show360Views.transitionTime,this.fade360View(o,n,a)):(x.start(v.property(this.model,"alpha",a.modelAlpha,null),o*a.modelAlphaLength,null,a.modelAlphaDelay,null,W.FlyToNewMode),x.start(v.vector(this.position,n.position),o,null,s.flydown.movementDelay,w[s.flydown.movementEasing],null,W.FlyToNewMode),x.start(v.quaternion(this.quaternion,n.quaternion),o*a.rotationDuration,null,a.rotationDelay,w[s.flydown.rotationEasing],null,W.FlyToNewMode),x.start(v.matrix4(this.camera.projectionMatrix,n.projectionMatrix),o*a.cameraMatrixDuration,null,a.cameraMatrixDelay,a.cameraMatrixEase,null,W.FlyToNewMode),x.start(v.uniform(this.model.skybox,"opacity",a.skyboxOpacity),o*a.skyboxOpacityLength,null,a.skyboxOpacityDelay,null,W.FlyToNewMode),x.start(v.property(this.reticule.material.uniforms.opacity,"value",0),o,null,W.FlyToNewMode)),x.setTimeout(function(){this.flying=!1,m===p.PANORAMA&&c!==p.PANORAMA?this.currentPano.exit():m!==p.PANORAMA&&c===p.PANORAMA&&(this.currentPano.enter(),this.path.placeCpm(),this.path.fadeOutCpm(s.path.fadeOutTime),this.spider.draw()),m===p.DOLLHOUSE&&this.controls[p.DOLLHOUSE].resetRanges(),this.mode=c,this.emit(F.FlyingEnded,q,M,this.currentPano,L),b.currentPano&&(console.log("flyToNewMode - entered:"+b.currentPano.id),b.currentPano.id&&ca.trackEvent(11,b.currentPano.id)),k&&m!==p.PANORAMA&&c===p.PANORAMA?this.startWarp(E.Retain,D.Retain,J.BLACK,null,null,h):h&&h()}.bind(this),o,W.FlyToNewMode),this.mode=p.TRANSITIONING}},d.prototype.fade360View=function(a,b,c){this.mattertagManager.hideShowTagsForBlackoutStyle(c.blackoutStyle,a),$(this.domElement).fadeOut(.5*a,function(){this.model.skybox.material.uniforms.opacity.value=c.skyboxOpacity,this.model.alpha=c.modelAlpha,this.position.copy(b.position),this.quaternion.copy(b.quaternion),this.camera.projectionMatrix.copy(b.projectionMatrix),$(this.domElement).fadeIn(.5*a)}.bind(this))},d.prototype.findDefaultViews=function(){this.findDefaultView(this.lastInsideView,!0),this.findDefaultView(this.last360View,!1)},d.prototype.findDefaultView=function(a,b){var c,d=this.model.heroLocations,e=this.model.panos,f=d.findIndex(function(a){if(a.cameraMode!==p.PANORAMA)return!1;var c=e.get(a.panoId);return c&&c.isAligned()===b});f>=0?(c=e.get(d[f].panoId),a.update({cameraMode:p.PANORAMA,pano:c,position:d[f].position,quaternion:d[f].quaternion})):(f=e.list.findIndex(function(a){return a.isAligned()===b}),f>=0?(c=e.list[f],a.update({cameraMode:p.PANORAMA,pano:c,position:c.position})):V.warn("There are no",b?"inside":"360Âº","views in this model"))},d.prototype.updateLastView=function(){if(this.mode===p.PANORAMA){(this.currentPano.isAligned()?this.lastInsideView:this.last360View).update({pano:this.currentPano,position:this.position,quaternion:this.quaternion})}},d.prototype.goToLastView=function(a){var b=a?this.lastInsideView:this.last360View;this.isInMode(p.PANORAMA)&&this.currentPano.isAligned()!==a&&this.updateLastView(),this.isInMode(p.PANORAMA)?(this.path&&this.path.popOutCpm(),this.fadeToView(a,b,s.show360Views.transitionTime)):this.isOutsideMode()&&this.flyToNewMode({mode:b.cameraMode,pano:b.pano,quaternion:b.quaternion})},d.prototype.fadeToView=function(a,b,c){if(!b.isValid()||b.cameraMode===p.PANORAMA&&!b.pano)return V.warn("Tried to fade to an illegal view",b.cameraMode),!1;var d=(s[b.cameraMode],function(){$(this.domElement).fadeIn(.5*c)}.bind(this)),e=a?K.FADEIN:K.END;this.mattertagManager.hideShowTagsForBlackoutStyle(e,c),$(this.domElement).fadeOut(.5*c,function(){this.model.fadePanoMarkers(a?s.panorama.markerOpacity:0),b.cameraMode===p.PANORAMA?this.flyToPano({pano:b.pano,lookAtPoint:q.FORWARD.clone().applyQuaternion(b.quaternion).add(b.pano.position),duration:0},d):this.flyToNewMode({mode:b.cameraMode,quaternion:b.quaternion,duration:0,callback:d})}.bind(this))},d.prototype.startWarp=function(a,b,c,d,e,f){if(this.control&&(this.control.enabled=!1),this.flying)return V.warn("Player.startWarp() -> Cannot warp when flying"),f&&f(),!1;null!==a&&void 0!==a||(a=E.Show),this.history.invalidate(),a!=E.Retain?this.path.brushToWarpPano(c,J.BLACK)||(c=J.BLACK):c=this.path.upcomingTransType;var g=this.path.warpDestPano&&!this.path.warpDestPano.isAligned();return this.emit(F.WarpStarted,g,c,d,e),d=d||K.MIDDLE,this.path.warpToPano(c,d,e,function(){b===D.Slow?this.path.discardSlow():b===D.Standard&&this.path.discardPathObject(),this.emit(F.WarpEnded,c),this.control&&(this.control.enabled=!0),f&&f()}.bind(this)),a===E.Hide&&this.path.discardPathObject(),!0},d.prototype.warpToPanoById=function(a,b,c,d,e,f,g,h){return this.path.setWarpDestinationByPanoId(a,b)?this.startWarp(c,d,e,f,g,h):(V.warn("Player.warpToPanoById() -> Could not setWarpDestinationByPanoId()"),h&&h(),!1)},d.prototype.warpToPanoByHeroIndex=function(a,b,c,d,e,f,g){if(-1!=b)return this.path.setWarpDestinationByHeroIndex(a)?this.startWarp(b,c,d,e,f,g):(console.log("Player.warpToPanoByHeroIndex() -> Could not setWarpDestinationByHeroIndex()"),g&&g(),!1);this.startWarp(b,c,d,e,f,g)},d.prototype.warpToPano=function(a,b,c,d,e,f,g,h){return this.warpToPanoById(a.id,b,c,d,e,f,g,h)},d.prototype.warpToNonPanoByHeroIndex=function(a,b){return this.path.setWarpDestinationByHeroIndex(a)?(this.path.warpToNonPano(b),!0):(V.warn("Player.warpToNonPanoByHeroIndex() -> Could not setWarpDestinationByHeroIndex()"),b&&b(),!1)},d.prototype.aimTourCamera=function(a,b,c,d){return this.warpToPanoByHeroIndex(a,b,c,null,null,null,d)},d.prototype.showPathToHeroLocation=function(a){this.mode!==p.PANORAMA&&this.path.setWarpDestinationByHeroIndex(a)&&this.path.brushToWarpPano(J.STD,J.BLACK)},d.prototype.tourInterlude=function(a,b){this.history.invalidate(),this.path.discardSlow(),this.path.waitNextStep(a,function(){b&&b()}.bind(this))},d.prototype.stopInterlude=function(){this.interruptAndFastForward(null,0)},d.prototype.interruptAndFastForward=function(a,b){this.isWarping()&&this.emit(F.WarpInterrupted,this.path.activeTransType,a,b),this.flying&&this.emit(F.FlyingInterrupted),this.path.interruptAndFastForward(a,b)},d.prototype.setSize=function(a,b){var c=a/b;for(var d in this.cameras)this.cameras[d].updateAspect(c)},d.prototype.toJSON=function(){var a={};return this.control?(a=this.control.toJSON(),a._type=p.toInt(this.mode),this.isOutsideMode()?this.model.allFloorsVisible?a.floor_visibility=[]:a.floor_visibility=this.model.floors.list.map(function(a){return a.hidden?0:1}):p.PANORAMA&&(a._locationid=this.currentPano.id),a):a},d.prototype.getCurrentNodePanos=function(a){if(this.model.panos.map,a.length=0,this.path.nodes)for(var b=0;b<this.path.nodes.length;b++){var c=this.path.nodes[b];a.push(this.model.panos.get(c))}},d.prototype.zoomIncrementally=function(a){var b=this.zoomLevel;this.zoomTo(this.zoomLevel+a),b!==this.zoomLevel&&this.currentPano&&this.zoomStats.addZoomAction(b,this.zoomLevel,this.currentPano.id)},d.prototype.zoomInIncrementally=function(a){a=a||this.defaultZoomIncrement,this.zoomIncrementally(a)},d.prototype.zoomOutIncrementally=function(a){a=a||-this.defaultZoomIncrement,this.zoomIncrementally(a)},d.prototype.zoomBy=function(a){this.zoomTo(this.zoomLevel*a)},d.prototype.zoomIn=function(){this.zoomBy(1+this.zoomSpeed)},d.prototype.zoomOut=function(){this.zoomBy(1-this.zoomSpeed)},d.prototype.jumpTo3D=function(){$("#gui-modes-outside").click(),G.d.jumpingto3d=!0},d.prototype.zoomTo=function(a,b){if((b||s.zoom.enabled&&this.mode===p.PANORAMA&&this.zoomEnabled)&&(a<s.zoom.min?this.zf?this.clock.getElapsedTime()-this.start>3?this.zf=!1:(this.len+=s.zoom.min-a,this.len>.26&&(this.jump=!0,this.zf=!1)):(this.start=this.clock.getElapsedTime(),this.zf=!0,this.len=0,this.jump=!1):(this.zf=!1,this.len=0,this.jump=!1),a<s.zoom.min&&(a=s.zoom.min,this.jump&&G.model.outsideAllowed()&&!this.isInMode(p.DOLLHOUSE,p.TRANSITIONING)&&this.jumpTo3D()),a>s.zoom.max&&(a=s.zoom.max),a>this.zoomLevel?(this.emit(O.ZoomIn),a===s.zoom.max&&this.emit(O.ZoomMax)):a<this.zoomLevel&&(this.emit(O.ZoomOut),a===s.zoom.min&&this.emit(O.ZoomMin)),this.control)){var c=this.control.camera;this.zoomLevel=a,c.fov=this.baseFov*(1/this.zoomLevel),c.updateProjectionMatrix(),this.zoomFov=c.fov}},d.prototype.increaseZoomSpeed=function(){this.zoomSpeed=this.clampZoomSpeed(this.zoomSpeed+this.zoomSpeedAdjust)},d.prototype.decreaseZoomSpeed=function(){this.zoomSpeed=this.clampZoomSpeed(this.zoomSpeed-this.zoomSpeedAdjust)},d.prototype.clampZoomSpeed=function(a){return a<0?0:a},d.prototype.activatePersistentZooming=function(a){this.zooming=a?1:-1},d.prototype.deactivatePersistentZooming=function(){this.zooming=0},d.prototype.zoomDefault=function(){this.zoomTo(1,!0)},d.prototype.smoothZoomToDefault=function(a,b){var c,d=this.zoomLevel,e=function(a){a>1&&(a=1),c=d*(1-a)+a,this.zoomTo(c,!0)}.bind(this),f=function(){this.zoomDefault(),b&&window.setTimeout(b,50)}.bind(this);x.start(e,a,f,null,0,w[s.transition.blendEasing])},d.prototype.updateZoomPano=function(){if(!this.panoRenderer.zoomPanoRenderingDisabled&&this.mode===p.PANORAMA){var a=this.currentPano;if(a){var b=this.zoomLevel>s.zoom.activationThreshold,c=this.flying&&this.nextPano&&this.nextPano!==this.currentPano,d=!c&&!this.isWarping(),e=b&&d;this.tileDownloader.tilePrioritizer.setZoomingActive(e),this.panoRenderer.setZoomingActive(e,a,!0);var f=function(a,b){this.panoRenderer.resetRenderStatus(a.id,!1,!0,this.qualityManager.getMaxNavPanoSize()),this.panoRenderer.clearAllQueuedUploadsForPano(a.id),this.panoRenderer.renderPanoTiles(a.id,null,!1,!1),a.setZoomed(b)}.bind(this);e&&!a.zoomed?(f(a,!0),this.panoRenderer.enableUltraHighQualityMode(function(){this.qualityManager.useUltraHighResolutionPanos&&!s.zoom.overridemax&&(s.zoom.max=Q.ultraHighQualityMaxZoom),e&&f(a,!0)}.bind(this))):!b&&a.zoomed&&f(a,!1)}}},b.exports=d}).call(this,"/js/player.js")},{"./cameras/DollhouseCamera":4,"./cameras/FloorplanCamera":5,"./cameras/PanoramaCamera":6,"./conf":7,"./constants":8,"./controls/DollhouseControls":9,"./controls/FloorplanControls":10,"./controls/PanoramaControls":12,"./enum/AlignmentType":16,"./enum/BlackoutStyle":17,"./enum/ControlEvents":19,"./enum/Keys":25,"./enum/ModelManagerEvents":30,"./enum/PanoSizeClass":33,"./enum/PanoramaEvents":34,"./enum/PathDiscardMode":35,"./enum/PathDisplayMode":36,"./enum/PlayerEvents":38,"./enum/StartupType":41,"./enum/TagStates":43,"./enum/TagType":44,"./enum/Vectors":50,"./enum/Viewmode":51,"./enum/WarpStyle":52,"./enum/ZoomEvents":53,"./exception/BasicException":54,"./gui/buryPoint":59,"./gui/offLine":70,"./model/Chunks":99,"./model/ModelManager":103,"./objects/AddTagReticule":105,"./objects/NSpider":112,"./objects/Panorama":113,"./objects/Reticule":114,"./objects/ShowPath":116,"./objects/Snapshot":118,"./objects/View":120,"./shaders":126,"./tile/TileDownloader":130,"./tile/TilePrioritizer":131,"./util/ZoomStats":139,"./util/browser":142,"./util/camera":143,"./util/common":145,"./util/easing":147,"./util/history":150,"./util/lerp":152,"./util/logger":153,"./util/math":154,"./util/statistic_utils":158,"./util/texture":161,"./util/transitions":162,events:170,three:177}],122:[function(a,b,c){"use strict";!function(){if("performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var a=Date.now();performance.timing&&performance.timing.navigationStart&&(a=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-a}}}();var d=d||{};!function(a){var b=0,c={Message:0,Response:1},d=function(b){var c=b.origin||b.originalEvent.origin;a.receiveMessage(c,b.data,b.source)},e=function(a,b,c,d){return{uid:a,message:b,type:c,waitForResponse:d}},f={},g={},h=null;window.addEventListener("message",d,!1),a.setReceiver=function(a){h=a},a.sendMessage=function(a,d,g,h){var i=b++;if(h){var j={targetWindow:a,uid:i,timestamp:performance.now(),onResponse:h};f[i]=j}var k=e(i,g,c.Message,!!h);a.postMessage(k,d)},a.receiveMessage=function(a,b,d){if(b){if(b.type===c.Message&&b.waitForResponse){var e={uid:b.uid,timestamp:performance.now(),sourceWindow:d};g[b.uid]=e}if(b.type===c.Response){var i=b.uid,j=f[i];f[i]=null,j.onResponse&&j.onResponse(b.message)}}h&&h(a,b.message,b.uid)},a.respondToMessage=function(a,b){var d=g[a];if(d&&d.sourceWindow){var f=e(a,b,c.Response,!1);d.sourceWindow.postMessage(f,"*"),g[f.uid]=null}}}(d),void 0!==b&&(b.exports=d)},{}],123:[function(a,b,c){(function(c){"use strict";function d(a,b){this.model=a,this.panos=a.panos,this.player=b,this.imagePanos=this.listImagePanos(),this.retryMinimumTime=1e4}var e=(a("three"),a("./enum/Viewmode")),f=(a("./conf"),a("./objects/Panorama")),g=a("./util/logger"),h=new g(c);d.prototype.start=function(){this.loadNextPano(function(a){a?this.start():(h.debug("No suitable pano loaded, waiting a little while before looking again"),setTimeout(function(){this.start()}.bind(this),1e3))}.bind(this))},d.prototype.validLoadTarget=function(a){return a&&!a.isLoaded("high")&&Date.now()-a.failedLoadingAt>this.retryMinimumTime},d.prototype.listImagePanos=function(){var a=[],b=this;return this.model.images.forEach(function(c){if(c._camera&&c._camera._locationid){var d=b.model.panos.get(c._camera._locationid);d&&!d.isLoaded("high")&&a.push(d)}}),a},d.prototype.nextNotLoadedImage=function(){for(;this.imagePanos.length>0;){var a=this.imagePanos[0];if(!a.isLoaded("high"))return a;this.imagePanos.shift()}return null},d.prototype.loadNextPano=function(a){var b,c,d=this.model.waitQueue.filter(function(a){return a.object instanceof f});d.length>0?(b=d[0].object,h.debug("Overrode pano selection: Flying to an unloaded pano "+b.id)):this.validLoadTarget(this.player.currentPano)?(b=this.player.currentPano,h.debug("Overrode pano selection: Currently at an unloaded pano "+b.id)):this.validLoadTarget(this.player.closestPano)?(b=this.player.closestPano,h.debug("Overrode pano selection: Hovering over an unloaded pano "+b.id)):this.validLoadTarget(this.nextNotLoadedImage())?(c="high",b=this.imagePanos[0],h.debug("Overrode pano selection: Highlight image "+b.id)):this.player.mode===e.PANORAMA&&(b=this.panos.lowestByScore([this.validLoadTarget.bind(this),f.filters.isNeighbourPanoTo(this.player.currentPano)],[f.scoreFunctions.distance(this.player.currentPano),f.scoreFunctions.direction(this.player.position,this.player.getDirection()),f.scoreFunctions.inFieldOfView(this.player.position,this.player.getDirection())]))&&h.debug("Normal pano selection: neighbor "+b.id),b?(c=c||b.isLoaded("low")?"high":"low",h.debug("Preloading "+c+"-res pano "+b.id),b.loadCube(c).done(a).fail(function(){h.warn("Failed preloading pano",b.id,", marking it as failed and forgetting it for a while"),a()})):a&&a(null)},b.exports=d}).call(this,"/js/preloaders.js")},{"./conf":7,"./enum/Viewmode":51,"./objects/Panorama":113,"./util/logger":153,three:177}],124:[function(a,b,c){(function(c){"use strict";function d(a,b,c,d){this.qualityManager=a,this.scene=b,this.camera=c,this.container=d,this.quickstartCamera=new n,this.endFOV=g.insideFOV,this.quickstartCamera.fov=this.endFOV+q.quickstart.fovChange,this.controls=new o(this.quickstartCamera),this.controls.bindEvents(d),this.controls.enabled=!0,this.controls.locked=!0,this.skybox=nul}var e=a("three"),f=a("../util/logger"),g=a("../constants"),h=a("../util/transitions"),i=a("../util/lerp"),j=a("../util/easing"),k=a("../enum/Vectors"),l=a("../enum/PanoSizeClass"),m=(a("../materials/ModelTextureMaterial"),a("../materials/CubemapMaterial")),n=a("../cameras/PanoramaCamera"),o=a("../controls/PanoramaControls"),p=(a("../tile/TileUtils"),a("../util/camera"),a("../util/cameraLight")),q=(a("../util/browser"),a("../conf")),r=a("../gui/helpManager"),s=new f(c);d.prototype.load=function(a){a.pano.shouldRedrawOnBaseLoaded=!0;var b,c,d=this,e=k.FORWARD.clone().applyQuaternion(a.quaternion),f=e.clone().negate();this.controls.lookAt(e.add(this.quickstartCamera.position));var g=this.qualityManager.getPanoSize(l.BASE),h=this.qualityManager.getPanoSize(l.STANDARD);if(a.pano.tiled){s.warn("Loading startPano, TILED",a.pano.id),a.pano.update();var i=p.getHFOVForCamera(this.quickstartCamera,window.innerWidth,window.innerHeight),j=this.quickstartCamera.fov;s.warn("Quickstart loading tiles in frustum: [horizontal FOV: "+i+", vertical FOV: "+j+"]"),b=a.pano.loadTiledPano(h,e,{hFov:i,vFov:j},!1,!1,!0),c=a.pano.loadTiledPano(g,f,null,!1,!1,!0)}else s.warn("Loading startPano",a.pano.id),b=a.pano.loadCube("high");return $.when(b).then(function(){d.init(a.pano,a.quaternion),a.pano.tiled?c.done(function(){a.pano.lockUntilRenderingComplete=!1,this.controls.locked=!1}.bind(this)):this.controls.locked=!1}.bind(this))},d.prototype.init=function(a,b){s.info("Quickstart done loading, adding scene objects"),a.lockUntilRenderingComplete=!0,this.skybox=new e.Mesh(new e.CubeGeometry(1,1,1),new m({side:e.BackSide})),this.skybox.material.uniforms.map.value=a.skybox,this.skybox.quaternion.copy(a.quaternion),this.scene.add(this.skybox),$(this.container).show()},d.prototype.update=function(a){this.controls.update(a),this.camera.copy(this.quickstartCamera)},d.prototype.setSize=function(a,b){this.quickstartCamera.updateAspect(a/b)},d.prototype.destroy=function(){this.scene.remove(this.skybox)},d.prototype.startLanding=function(){function a(){var a=h.getById("quickAnimation"),c=a.length>0?a[0].current:q.quickstart.animation,e=c<q.quickstart.animation?q.quickstart.animation-c:0;setTimeout(d,e),b()}function b(){e.forEach(function(b){document.body.removeEventListener(b,a,!0)})}var c=$.Deferred(),d=c.resolve.bind(c);h.start(i.property(this.quickstartCamera,"fov",this.endFOV,function(){this.quickstartCamera.updateProjectionMatrix()}.bind(this)),q.quickstart.animation,null,0,j.easeOutQuad,null,"quickAnimation");var e=["touchstart","mousedown","keydown"];e.forEach(function(b){document.body.addEventListener(b,a,!0)});var f=r.isQuickstartHelpEnabled()?q.quickstart.fadeOutDelay:q.quickstart.animation;return setTimeout(d,f),setTimeout(b,f),c.promise()},b.exports=d}).call(this,"/js/scene/QuickstartManager.js")},{"../cameras/PanoramaCamera":6,"../conf":7,"../constants":8,"../controls/PanoramaControls":12,"../enum/PanoSizeClass":33,"../enum/Vectors":50,"../gui/helpManager":66,"../materials/CubemapMaterial":94,"../materials/ModelTextureMaterial":95,"../tile/TileUtils":133,"../util/browser":142,"../util/camera":143,"../util/cameraLight":144,"../util/easing":147,"../util/lerp":152,"../util/logger":153,"../util/transitions":162,three:177}],125:[function(a,b,c){"use strict";function d(a,b,c){this.scene=a,this.camera=b,this.renderer=null,this.effects=c,this.animateCallback=null,this.composer=null,this.qualityManager=null,a.renderWidth=0,a.renderHeight=0,this.updateClock=new f.Clock,this.components=[],this.updateListeners=[],this.resizeListeners=[],this.forceUpdateSize=!1,this.started=!1}var e,f=a("three"),g=a("../shaders"),h=a("../enum/GLTextureType"),i=a("../enum/GLCubeFaces"),j=a("../enum/SceneRendererEvents"),k=a("../exception/BasicException"),l=a("../exception/RendererCreationException"),m=a("../util/browser"),n=a("../conf"),o=a("../lib/stats"),p=a("events").EventEmitter,q=a("../gui/offLine"),r=new q;n.fpsOn&&(e=new o,document.body.appendChild(e.domElement)),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame,d.prototype=Object.create(p.prototype),d.prototype.addComponent=function(a){this.components.push(a),a.update&&this.updateListeners.push(a),a.setSize&&(this.resizeListeners.push(a),this.forceUpdateSize=!0)},d.prototype.removeComponent=function(a){var b=function(b){return b!=a};this.components=this.components.filter(b),this.updateListeners=this.updateListeners.filter(b),this.resizeListeners=this.resizeListeners.filter(b)},d.prototype.start=function(a){if(this.started)throw new k("Can't start SceneRenderer, already started");this.createContext(a),this.boluoVrInit(),this.initComposer(),this.started=!0,(s=s.bind(this))()},d.prototype.createContext=function(a){try{2==n.thirdCustomer?this.renderer=new f.WebGLRenderer({preserveDrawingBuffer:!0}):this.renderer=new f.WebGLRenderer,this.renderer.autoClear=!0,this.renderer.setPixelRatio(window.devicePixelRatio?window.devicePixelRatio:1),this.renderer.setSize(window.innerWidth,window.innerHeight),this.emit(j.ContextCreated)}catch(a){throw new l("Unable to create a WebGL rendering context")}a.appendChild(this.renderer.domElement)},d.prototype.getTextureTypeFromTarget=function(a,b){switch(b){case a.TEXTURE_CUBE_MAP_POSITIVE_X:case a.TEXTURE_CUBE_MAP_NEGATIVE_X:case a.TEXTURE_CUBE_MAP_POSITIVE_Y:case a.TEXTURE_CUBE_MAP_NEGATIVE_Y:case a.TEXTURE_CUBE_MAP_POSITIVE_Z:case a.TEXTURE_CUBE_MAP_NEGATIVE_Z:return h.TextureCube;case a.TEXTURE_2D:return h.Texture2D;default:return null}},d.prototype.overrideTextures=function(){var a=this.renderer.context,b=0,c=a.createTexture;a.createTexture=function(){var d=c.call(a);return d.id=b++,this.textures[d.id]=d,d}.bind(this);var d=a.texImage2D;a.texImage2D=function(b,c,e,f,g,i,j,k,l){var m,n=this.getTextureTypeFromTarget(a,b);m=n===h.TextureCube?a.getParameter(a.TEXTURE_BINDING_CUBE_MAP):a.getParameter(a.TEXTURE_BINDING_2D),void 0!==j?d.call(a,b,c,e,f,g,i,j,k,l):(j=f,k=g,l=i,f=l.naturalWidth,g=l.naturalHeight,d.call(a,b,c,e,j,k,l));var o=this.textures[m.id];o.width=n===h.TextureCube?6*f:f,o.height=g}.bind(this);var e=a.deleteTexture;a.deleteTexture=function(b){delete this.textures[b.id],e.call(a,b)}.bind(this)},d.prototype.initComposer=function(){this.composer=new f.EffectComposer(this.renderer),this.composer.addPass(new f.RenderPass(this.scene,this.camera)),this.composer.addPass(this.effects.hblurPass),this.composer.addPass(this.effects.vblurPass)},d.prototype.setSize=function(a,b){this.renderWidth=a,this.renderHeight=b,this.effects.aspect=a/b,this.renderer.setSize(a,b),this.composer.setSize(a,b);for(var c=0;c<this.resizeListeners.length;c++)this.resizeListeners[c].setSize(a,b);G.render=this},d.prototype.render=function(){this.effects.currentBlur>0?this.composer.render():this.renderer.render(this.scene,this.camera)},d.prototype.boluoVrInit=function(){this.isHuawei5X=m.detectHUAWEI5X(),this.oldRenderer=this.renderer,this.newRenderer=new this.vrRenderer(this.renderer,this,this.camera);var a=this;window._vrEnabled=!1,Object.defineProperty(window,"vrEnabled",{get:function(){return window._vrEnabled},set:function(b){b=!!b,b?(a.renderer=a.newRenderer,window.vrMarkers.forEach(function(a){a.visible=!0})):(a.renderer=a.oldRenderer,window.vrMarkers.forEach(function(a){a.visible=!1})),a.cursor.visible=b,a.setSize(window.innerWidth,window.innerHeight),window._vrEnabled=b}}),this.createCursor(.5,!1,1,16777215,0);var b={setSize:function(b,c){a.camera.aspect=b/c}};this.resizeListeners.push(b),this.vrLoadingInit()},d.prototype.vrLoadingInit=function(){var a=function(){var a=this,b=new f.RingGeometry(1.3,1.5,32,32,0,1.2*Math.PI),c=new f.MeshBasicMaterial({color:4967932,side:f.DoubleSide}),d=new f.Mesh(b,c);this.mesh=d,d.position.z=-2,d.scale.set(.08,.08,.08),d.visible=!1,camera.add(d),a.enabled=!1,this.update=function(b){1==a.enabled&&(d.rotation.z+=15*b)}},a=new a(this.camera);window.Loading=a,this.updateListeners.push(a)},d.prototype.createCursor=function(a,b,c,d,e){var g,h=new f.SpriteMaterial({opacity:c,color:d,transparent:b,map:this.boluoGetTexture(r.splitUrl("https://template2.3dnest.cn/common/image/cursor.png")),needsUpdate:!0,side:f.DoubleSide});h.map.offset=new f.Vector2(1/17*e,0),h.map.repeat=new f.Vector2(1/17,1),h.depthTest=!1,h.blending=f.AdditiveBlending,g=new f.Sprite(h),g.scale.set(a,a,a),g.position.z=-2,g.visible=!1,g.name="cursor",this.camera.add(g),this.scene.add(this.camera),this.cursor=g;var i=new this.CursorAnimation(this.scene,g,this.camera);this.cursor.triggerTargetEvent=i.triggerTargetEvent,this.updateListeners.push(i)},d.prototype.CursorAnimation=function(a,b,c){function d(){g.orient=f.Math.degToRad(window.orientation||0)}function e(a){var b=f.Math.degToRad(a.alpha),c=f.Math.degToRad(a.beta),d=f.Math.degToRad(a.gamma);if(this.isHuawei5X?(-1e3===g.alpha&&(g.alpha=b),-1e3===g.beta&&(g.beta=c),-1e3===g.gamma&&(g.gamma=d),Math.abs(b-g.alpha)>.06&&(g.alpha=b),Math.abs(c-g.beta)>.006&&(g.beta=c),Math.abs(d-g.gamma)>.006&&(g.gamma=d)):(g.alpha=b,g.beta=c,g.gamma=d),n.vrDebug){$("#info-device-orientation").css("display","block");var e="";e+="alpha=("+g.alpha+")<BR/>",e+="beta=("+g.beta+")<BR/>",e+="gamma="+g.gamma+"<BR/>",document.getElementById("info-device-orientation").innerHTML=e}}this.cursor=b,this.raycaster=new f.Raycaster,this.targetEventObj={},this.type=1,this.tweenFlag=!0;var g=this;this.target=c,this.euler=new f.Euler,this.q0=new f.Quaternion,this.q1=new f.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),this.zee=new f.Vector3(0,0,1),this.alpha=-1e3,this.beta=-1e3,this.gamma=-1e3,this.orient=f.Math.degToRad(window.orientation||0),window.addEventListener("orientationchange",d),window.addEventListener("deviceorientation",e),this.setObjectQuaternion=function(a,b,d,e,f){g.euler.set(d,b,-e,"YXZ"),a.setFromEuler(g.euler),a.multiply(g.q1),a.multiply(g.q0.setFromAxisAngle(g.zee,-f)),c.updateMatrixWorld()},parent!==window&&window.addEventListener("message",function(a){var b=JSON.parse(a.data),c=-1!==window.navigator.userAgent.indexOf("KIW-TL00H");b&&b.alpha&&b.beta&&b.gamma&&function(a){var c=f.Math.degToRad(b.alpha),d=f.Math.degToRad(b.beta),e=f.Math.degToRad(b.gamma);a?(-1e3===g.alpha&&(g.alpha=c),-1e3===g.beta&&(g.beta=d),-1e3===g.gamma&&(g.gamma=e),Math.abs(c-g.alpha)>.06&&(g.alpha=c),Math.abs(d-g.beta)>.006&&(g.beta=d),Math.abs(e-g.gamma)>.006&&(g.gamma=e)):(g.alpha=c,g.beta=d,g.gamma=e)}(c)}),this.update=function(a){TWEEN.update(),window.vrEnabled&&(this.setObjectQuaternion(this.target.quaternion,this.alpha,this.beta,this.gamma,this.orient),this.triggerTargetEvent())},this.triggerTargetEvent=function(){var a=this.choseObj(),b=a?a.object:void 0;this.targetEventObj.currentObj=b,b!==this.targetEventObj.lastObj&&(b&&this.autoCursorPosition(a),1===this.type?(this.cursorAnimate&&this.cursorAnimate.stop(),b&&b.enabled&&this.startAnimate(function(){this.clickCallback(b)}.bind(this))):this.type,this.targetEventObj.lastObj=b)},this.choseObj=function(){this.raycaster.setFromCamera({x:0,y:0},c);var a=(this.raycaster.ray,window.vrMarkers),b=this.raycaster.intersectObjects(a);if(b.length>0)return b[0]},this.clickCallback=function(a){this.runTHREEAction(a,"onclick")},this.runTHREEAction=function(a,b){switch(b){case"onclick":a._listeners&&a._listeners.click&&a._listeners.click.forEach(function(a){a()});break;case"onhover":a._listeners&&a._listeners.hover&&a._listeners.hover.forEach(function(a){a()});break;case"onout":a._listeners&&a._listeners.out&&a._listeners.out.forEach(function(a){a()})}},this.startAnimate=function(a){this.tweenFlag&&this.initAnimation(a)},this.initAnimation=function(a){var b=this,c=this.cursor.material.map.offset,d=function(a){return Math.floor(17*a)/17};b.tweenFlag=!1,this.cursorAnimate=new TWEEN.Tween(c).to({x:1},1e3).onStart(function(){b.tweenFlag=!1}).onStop(function(){b.tweenFlag=!0,this.x=0,c.x=0}).onUpdate(function(){}).onComplete(function(){a(),c.x=0,setTimeout(function(){b.tweenFlag=!0},1500)}),this.cursorAnimate.easing(d),this.cursorAnimate.start()},this.autoCursorPosition=function(a){var b=Math.abs(a.distance-10);this.cursor.position.z=-b,b/=10,this.cursor.scale.set(b,b,b)}},d.prototype.vrRenderer=function(a,b,c){var d=new b.vrCamera(c);d.bananaAspect=.8,this.width,this.height;var b=this;this.setSize=function(c,d){a.setSize.call(this,c,d),b.width=c,b.height=d},this.render=function(b,c,e,f){var g,h;if(c.__RESS__SKIP__STEREO__)return a.render(b,c,e,f);if("PerspectiveCamera"===c.type)g=d.cameraL,h=d.cameraR,b.updateMatrixWorld(),null===c.parent&&c.updateMatrixWorld(),d.vrCameraUpdate(c);else{if("OrthographicCamera"!==c.type)return DEBUG&&console.error("Unsupported renderer: ",c.type);g=h=c}a.setScissorTest(!0),a.setScissor(0,0,this.width/2,this.height),a.setViewport(0,0,this.width/2,this.height),a.render.call(this,b,g,e,f),a.setScissor(this.width/2,0,this.width/2,this.height),a.setViewport(this.width/2,0,this.width/2,this.height),a.render.call(this,b,h,e,f),a.setScissorTest(!1)},this.__proto__={__proto__:a}},d.prototype.vrCamera=function(a){this.type="StereoCamera",this._aspect=1,this._overlap=.064,this.cameraL=new f.PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new f.PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this.eyeRight=new f.Matrix4,this.eyeLeft=new f.Matrix4,this.vrCameraNeedsUpdate=!0,Object.defineProperty(this,"bananaAspect",{get:function(){return this._aspect},set:function(a){this._aspect!==a&&(this.vrCameraNeedsUpdate=!0),this._aspect=a}}),Object.defineProperty(this,"overlap",{get:function(){return this._overlap},set:function(a){this._overlap!==a&&(this.vrCameraNeedsUpdate=!0),this._overlap=a}}),this.vrCameraUpdate=function(a){if(this.vrCameraNeedsUpdate=this.vrCameraNeedsUpdate||this.bananaFov!==a.fov||this.bananaReal_aspect!==a.aspect*this.bananaAspect||this.bananaNear!==a.near||this.bananaFar!==a.far,this.vrCameraNeedsUpdate){this.vrCameraNeedsUpdate=!1,console.debug("vrCameraUpdate"),this.bananaFocus=a.focus,this.bananaFov=a.fov,this.bananaReal_aspect=a.aspect*this.bananaAspect,this.bananaNear=a.near,this.bananaFar=a.far,console.debug(a.aspect),this.bananaFocus=10;var b,c,d=a.projectionMatrix.clone(),e=this.overlap/2,f=e*this.bananaNear/this.bananaFocus,g=this.bananaNear*Math.tan(Math.PI/180*this.bananaFov*.5);this.eyeLeft.elements[12]=-e,this.eyeRight.elements[12]=e,b=-g*this.bananaReal_aspect+f,c=g*this.bananaReal_aspect+f,d.elements[0]=2*this.bananaNear/(c-b),d.elements[8]=(c+b)/(c-b),this.cameraL.projectionMatrix.copy(d),b=-g*this.bananaReal_aspect-f,c=g*this.bananaReal_aspect-f,d.elements[0]=2*this.bananaNear/(c-b),d.elements[8]=(c+b)/(c-b),this.cameraR.projectionMatrix.copy(d)}this.cameraL.matrixWorld.copy(a.matrixWorld).multiply(this.eyeLeft),this.cameraR.matrixWorld.copy(a.matrixWorld).multiply(this.eyeRight)}},d.prototype.boluoGetTexture=function(a){var b=new f.TextureLoader;return b.crossOrigin="anonymous",b.load(a)},d.prototype.updateScreenSize=function(){(window.innerWidth!=this.renderWidth||window.innerHeight!=this.renderHeight||this.forceUpdateSize)&&(this.setSize(window.innerWidth,window.innerHeight),this.forceUpdateSize=!1)},d.prototype.updateComponents=function(){for(var a=Math.min(1,this.updateClock.getDelta()),b=0;b<this.updateListeners.length;b++)this.updateListeners[b].update(a)};var s=function(){window.requestAnimationFrame(s),this.updateScreenSize(),
this.updateComponents(),n.fpsOn&&e.begin(),this.render(),n.fpsOn&&e.end(),this.emit(j.AfterRender)};d.prototype.getImageData=function(){var a=document.createElement("canvas"),b=a.getContext("2d");return function(c,d,e){return a.width==d&&a.height==e||(a.width=d,a.height=e),b.drawImage(c,0,0,d,e),b.getImageData(0,0,d,e)}}(),d.prototype.initSizedTexture2D=function(a,b,c){var d=this.renderer,e=d.context,g=d.state,h=new f.Texture(null);h.flipY=!1,!0!==c&&(c=!1),h.generateMipmaps=c;var i=d.paramThreeToGL(h.format),j=d.paramThreeToGL(h.type),k=d.properties.get(h),l=e.createTexture();g.bindTexture(e.TEXTURE_2D,l),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,h.flipY),e.texImage2D(e.TEXTURE_2D,0,i,a,a,0,i,j,null),h.wrapS=b,h.wrapT=b;var m=d.paramThreeToGL(b);return e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,m),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,m),c?(h.magFilter=f.LinearFilter,h.minFilter=f.LinearMipMapLinearFilter,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.generateMipmap(e.TEXTURE_2D)):(h.magFilter=f.LinearFilter,h.minFilter=f.LinearFilter,e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)),g.bindTexture(e.TEXTURE_2D,null),k.__webglTexture=l,h},d.prototype.initSizedCubeMap=function(a,b){var c=this.renderer,d=c.context,e=c.state,g=new f.CubeTexture([null,null,null,null,null,null]);g.flipY=!1,g.generateMipmaps=b;var h=c.paramThreeToGL(g.format),i=c.paramThreeToGL(g.type),j=c.properties.get(g),k=d.createTexture();e.bindTexture(d.TEXTURE_CUBE_MAP,k),d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,g.flipY);for(var l=0;l<6;l++)d.texImage2D(d.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,h,a,a,0,h,i,null);return b?(g.magFilter=f.LinearFilter,g.minFilter=f.LinearMipMapLinearFilter,d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_LINEAR),d.texParameteri(d.TEXTURE_CUBE_MAP,d.GENERATE_MIPMAP,d.TRUE),d.generateMipmap(d.TEXTURE_CUBE_MAP)):(g.magFilter=f.LinearFilter,g.minFilter=f.LinearFilter,d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_CUBE_MAP,d.TEXTURE_MIN_FILTER,d.LINEAR)),e.bindTexture(d.TEXTURE_CUBE_MAP,null),j.__image__webglTextureCube=k,g},d.prototype.deallocateCubeTexture=function(a){var b=this.renderer,c=b.context,d=b.properties.get(a);c.deleteTexture(d.__image__webglTextureCube)},d.prototype.uploadTexture2D=function(a,b,c,d,e,f){var g=this.renderer,h=g.context,i=g.state,j=g.properties.get(b);i.bindTexture(h.TEXTURE_2D,j.__webglTexture),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,b.flipY),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha),h.pixelStorei(h.UNPACK_ALIGNMENT,b.unpackAlignment),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,g.paramThreeToGL(b.wrapS)),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,g.paramThreeToGL(b.wrapT)),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,g.paramThreeToGL(b.magFilter)),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,g.paramThreeToGL(b.minFilter)),h.texSubImage2D(h.TEXTURE_2D,0,c,d,h.RGBA,h.UNSIGNED_BYTE,a),b.generateMipmaps&&h.generateMipmap(h.TEXTURE_2D),i.bindTexture(h.TEXTURE_2D,null)},d.prototype.uploadTexture3D=function(a,b,c,d,e,f,g){var h=this.renderer,i=h.context,j=h.state,k=h.properties.get(b);j.bindTexture(i.TEXTURE_CUBE_MAP,k.__image__webglTextureCube),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,b.flipY),i.texSubImage2D(e,0,c,d,i.RGBA,i.UNSIGNED_BYTE,a),b.generateMipmaps&&i.generateMipmap(i.TEXTURE_CUBE_MAP),j.bindTexture(i.TEXTURE_CUBE_MAP,null)},d.prototype.rebuildMipMaps2D=function(a){var b=this.renderer,c=b.context,d=b.state;b.properties.get(a),c.generateMipmap(c.TEXTURE_2D),d.bindTexture(c.TEXTURE_2D,null)},d.prototype.rebuildMipMaps3D=function(a){var b=this.renderer,c=b.context,d=b.state,e=b.properties.get(a);d.bindTexture(c.TEXTURE_CUBE_MAP,e.__image__webglTextureCube),c.generateMipmap(c.TEXTURE_CUBE_MAP),d.bindTexture(c.TEXTURE_CUBE_MAP,null)},d.prototype.renderToCubeMap=function(){var a=!1,b=null,c=null,d=null,e=null,h=null;return function(i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){this.renderer.context,a||(c=new f.OrthographicCamera(-.5,.5,.5,-.5,-200,200),c.position.z=150,b=new f.Scene,b.add(c),d=new f.ShaderMaterial({uniforms:{tDiffuse:{type:"t",value:null},alpha:{type:"f",value:1}},vertexShader:g.basicTextured.vertexShader,fragmentShader:g.basicTextured.fragmentShader,depthWrite:!1,depthTest:!1,side:f.DoubleSide}),e=new f.PlaneBufferGeometry(1,1),h=new f.Mesh(e,d),h.position.z=0,b.add(h),a=!0);var y=e.getAttribute("uv");y.setDynamic(!0),y.needsUpdate=!0;var z=y.array,A=m/k,B=n/l,C=o/k,D=p/l;z[0]=A,z[1]=B+D,z[2]=A+C,z[3]=B+D,z[4]=A,z[5]=B,z[6]=A+C,z[7]=B;var E=e.getAttribute("position");E.setDynamic(!0),E.needsUpdate=!0;var F=E.array,G=q/j.width-.5,H=r/j.height-.5,I=s/j.width,J=t/j.height;F[0]=G,F[1]=H+J,F[3]=G+I,F[4]=H+J,F[6]=G,F[7]=H,F[9]=G+I,F[10]=H,this.renderer.properties.get(i),d.uniforms.tDiffuse.value=i,d.blending=v||f.NoBlending,d.transparent=!!w,void 0!==x&&null!==x||(x=1),d.uniforms.alpha.value=x,d.needUpdate=!0,j.activeCubeFace=u,j.viewport.set(0,0,j.width,j.height);var K=this.renderer.autoClear;this.renderer.autoClear=!1,this.renderer.render(b,c,j,!1),this.renderer.autoClear=K}}(),d.prototype.copyCubeMap=function(){var a=!1,b=null,c=null,e=null,h=null,i=null,j=new f.Euler;return new f.Vector3,function(k,l,m,n,o,p,q,r,s){if(this.renderer,!a){c=new f.OrthographicCamera(-1,1,1,-1,0,200),c.position.set(0,0,0),b=new f.Scene,b.add(c),e=new f.ShaderMaterial({uniforms:{tDiffuse:{type:"t",value:null},alpha:{type:"f",value:1}},vertexShader:g.copyCubeMap.vertexShader,fragmentShader:g.copyCubeMap.fragmentShader,depthWrite:!1,depthTest:!1,side:f.DoubleSide}),h=new f.BoxGeometry(2,2,2),i=new f.Mesh(h,e),b.add(i),a=!0}for(var t=0;t<6;t++)d.getCubeOrientationForCubeFace(t,j),i.rotation.copy(j),i.matrixWorldNeedsUpdate=!0,i.updateMatrixWorld(),e.uniforms.tDiffuse.value=k,e.blending=q||f.NoBlending,e.transparent=!!r,void 0!==s&&null!==s||(s=1),e.uniforms.alpha.value=s,e.needUpdate=!0,l.activeCubeFace=t,l.viewport.set(0,0,o,p),this.renderer.render(b,c,l,!1)}}(),d.getCubeOrientationForCubeFace=function(a,b){switch(a){case i.GL_TEXTURE_CUBE_MAP_POSITIVE_X:b.set(0,-Math.PI/2,0);break;case i.GL_TEXTURE_CUBE_MAP_NEGATIVE_X:b.set(0,Math.PI/2,0);break;case i.GL_TEXTURE_CUBE_MAP_POSITIVE_Y:b.set(Math.PI/2,Math.PI,0);break;case i.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:b.set(-Math.PI/2,Math.PI,0);break;case i.GL_TEXTURE_CUBE_MAP_POSITIVE_Z:b.set(0,-Math.PI,0);break;case i.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:b.set(0,0,0)}},d.prototype.renderSolidTileToCubeMap=function(){var a=!1,b=null,c=null,d=null,e=null,g=null;return function(h,i,j,k,l,m,n,o,p,q){if(this.renderer.context,!a){c=new f.OrthographicCamera(-.5,.5,.5,-.5,-200,200),c.position.z=150,b=new f.Scene,b.add(c);var r=["void main() { "," vec4 pos = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );"," gl_Position = pos; ","}"].join("\n"),s=["uniform vec4 blockColor;","uniform float alpha;","void main() {","  gl_FragColor = vec4(blockColor.rgb, alpha);","}"].join("\n");d=new f.ShaderMaterial({uniforms:{blockColor:{type:"v4",value:null},alpha:{type:"f",value:1}},vertexShader:r,fragmentShader:s,depthWrite:!1,depthTest:!1,side:f.DoubleSide}),e=new f.PlaneBufferGeometry(1,1),e.getAttribute("position"),g=new f.Mesh(e,d),g.position.z=0,b.add(g),a=!0}d.uniforms.blockColor.value=n,void 0!==q&&null!==q||(q=1),d.uniforms.alpha.value=q,d.blending=o||f.NoBlending,d.transparent=!!p,d.needUpdate=!0,h.activeCubeFace=m,h.viewport.set(i,j,k,l),this.renderer.render(b,c,h,!1)}}(),b.exports=d},{"../conf":7,"../enum/GLCubeFaces":22,"../enum/GLTextureType":23,"../enum/SceneRendererEvents":40,"../exception/BasicException":54,"../exception/RendererCreationException":56,"../gui/offLine":70,"../lib/stats":85,"../shaders":126,"../util/browser":142,events:170,three:177}],126:[function(a,b,c){"use strict";var d=a("three"),e=a("./conf"),f="precision highp float;\nprecision highp int;\n\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\n",g="precision highp float;\nprecision highp int;\n\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n";b.exports={basicTextured:{uniforms:{tDiffuse:{type:"t",value:null},alpha:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:"varying vec2 vUv;\nuniform float alpha;\nuniform sampler2D tDiffuse;\nvoid main() {\n  vec4 texColor = texture2D(tDiffuse, vUv);\n  gl_FragColor = vec4(texColor.rgb, texColor.a * alpha);\n}"},copyCubeMap:{uniforms:{tDiffuse:{type:"t",value:null},alpha:{type:"f",value:1}},vertexShader:"varying vec3 vWorldPos;\nvoid main() {\n  vWorldPos = vec3(-position.x, -position.y, position.z);\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:"varying vec3 vWorldPos;\nuniform float alpha;\nuniform samplerCube tDiffuse;\nvoid main() {\n  vec4 texColor = textureCube(tDiffuse, vWorldPos);\n  gl_FragColor = vec4(texColor.rgb, texColor.a * alpha);\n}"},cube:{uniforms:{map:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:f+"varying vec3 vWorldPosition;\n\nvoid main() {\n  vWorldPosition = position;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}\n",fragmentShader:g+"uniform samplerCube map;\nuniform float opacity;\n\nvarying vec3 vWorldPosition;\n\nvoid main() {\n  vec4 color = textureCube( map, vec3( -vWorldPosition.x, vWorldPosition.yz ) );\n  gl_FragColor = vec4(color.rgb, opacity);\n}\n"},model:{uniforms:{map:{type:"t",value:null},modelAlpha:{type:"f",value:e.modelAlpha},opacity:{type:"f",value:1},progress:{type:"f",value:0},blackout:{type:"i",value:0},pano0Map:{type:"t",value:null},pano0Position:{type:"v3",value:new d.Vector3},pano0Matrix:{type:"m4",value:new d.Matrix4},pano1Map:{type:"t",value:null},pano1Position:{type:"v3",value:new d.Vector3},pano1Matrix:{type:"m4",value:new d.Matrix4}},vertexShader:f+"uniform vec3 pano0Position;\nuniform mat4 pano0Matrix;\n\nuniform vec3 pano1Position;\nuniform mat4 pano1Matrix;\n\nvarying vec2 vUv;\nvarying vec3 vWorldPosition0;\nvarying vec3 vWorldPosition1;\n\nvoid main() {\n\n  vUv = uv;\n  vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n\n  vec3 positionLocalToPanoCenter0 = worldPosition.xyz - pano0Position;\n  vWorldPosition0 = (vec4(positionLocalToPanoCenter0, 1.0) * pano0Matrix).xyz;\n  vWorldPosition0.x *= -1.0;\n\n  vec3 positionLocalToPanoCenter1 = worldPosition.xyz - pano1Position;\n  vWorldPosition1 = (vec4(positionLocalToPanoCenter1, 1.0) * pano1Matrix).xyz;\n  vWorldPosition1.x *= -1.0;\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}\n",fragmentShader:g+"uniform sampler2D map;\nuniform float modelAlpha;\nuniform float opacity;\nuniform float progress;\nuniform int blackout;\n\nuniform vec3 pano0Position;\nuniform samplerCube pano0Map;\n\nuniform vec3 pano1Position;\nuniform samplerCube pano1Map;\n\nvarying vec2 vUv;\nvarying vec3 vWorldPosition0;\nvarying vec3 vWorldPosition1;\nuniform vec2 mousePosition;\nuniform int isEditVersion;\nvoid main() {\n\tconst vec4 BLACK = vec4(0.0, 0.0, 0.0, 1.0);\n\tconst vec4 GREY  = vec4(0.5, 0.5, 0.5, 1.0);\n\n\tvec4 colorFromPanos;\n\tvec4 colorFromPano0 = textureCube( pano0Map, vWorldPosition0.xyz);\n\tvec4 colorFromPano1 = textureCube( pano1Map, vWorldPosition1.xyz);\n\n\tif (blackout == 0) {\n\t\tcolorFromPanos = mix(colorFromPano0, colorFromPano1, progress);\n\t} else if (blackout == 1) {\n\t\tcolorFromPanos = mix(colorFromPano0, BLACK, min(1.0, progress*2.0));\n\t\tcolorFromPanos = mix(colorFromPanos, colorFromPano1, max(0.0, progress * 2.0 - 1.0));\n\t} else if (blackout == 2) {\n\t\tcolorFromPanos = mix(colorFromPano0, BLACK, progress);\n\t} else if (blackout == 3) {\n\t\tcolorFromPanos = mix(BLACK, colorFromPano1, max(0.0, progress * 2.0 - 1.0));\n\t} \n\n\tvec4 colorFromTexture = texture2D( map, vUv );\n\tcolorFromPanos = mix(colorFromPanos, colorFromTexture, modelAlpha);\n\n\tfloat whiteness = 1.0 - smoothstep(0.1, 0.2, opacity);\n\tcolorFromPanos = mix(colorFromPanos, GREY, whiteness);\n\tgl_FragColor = vec4(colorFromPanos.rgb, opacity);\n}\n"},model2:{uniforms:{map:{type:"t",value:null},modelAlpha:{type:"f",value:e.modelAlpha},opacity:{type:"f",value:1},progress:{type:"f",value:0},blackout:{type:"i",value:0},pano0Map:{type:"t",value:null},pano0Position:{type:"v3",value:new d.Vector3},pano0Matrix:{type:"m4",value:new d.Matrix4},pano1Map:{type:"t",value:null},pano1Position:{type:"v3",value:new d.Vector3},pano1Matrix:{type:"m4",value:new d.Matrix4},hue0:{type:"f",value:0},saturation0:{type:"f",value:0},brightness0:{type:"f",value:0},contrast0:{type:"f",value:0},gamma0:{type:"f",value:1},vibrance0:{type:"f",value:0},balance0:{type:"v3",value:new d.Vector3},hue1:{type:"f",value:0},saturation1:{type:"f",value:0},brightness1:{type:"f",value:0},contrast1:{type:"f",value:0},gamma1:{type:"f",value:1},vibrance1:{type:"f",value:0},balance1:{type:"v3",value:new d.Vector3},base:{type:"f",value:2}},vertexShader:f+"uniform vec3 pano0Position;\nuniform mat4 pano0Matrix;\n\nuniform vec3 pano1Position;\nuniform mat4 pano1Matrix;\n\nvarying vec2 vUv;\nvarying vec3 vWorldPosition0;\nvarying vec3 vWorldPosition1;\n\nvoid main() {\n\n  vUv = uv;\n  vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n\n  vec3 positionLocalToPanoCenter0 = worldPosition.xyz - pano0Position;\n  vWorldPosition0 = (vec4(positionLocalToPanoCenter0, 1.0) * pano0Matrix).xyz;\n  vWorldPosition0.x *= -1.0;\n\n  vec3 positionLocalToPanoCenter1 = worldPosition.xyz - pano1Position;\n  vWorldPosition1 = (vec4(positionLocalToPanoCenter1, 1.0) * pano1Matrix).xyz;\n  vWorldPosition1.x *= -1.0;\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}\n",fragmentShader:g+"uniform sampler2D map;\nuniform float modelAlpha;\nuniform float opacity;\nuniform float progress;\nuniform int blackout;\n\nuniform vec3 pano0Position;\nuniform samplerCube pano0Map;\n\nuniform vec3 pano1Position;\nuniform samplerCube pano1Map;\n\nvarying vec2 vUv;\nvarying vec3 vWorldPosition0;\nvarying vec3 vWorldPosition1;\nuniform vec2 mousePosition;\nuniform int isEditVersion;\nuniform float hue0;\nuniform float saturation0;\nuniform float brightness0;\nuniform float contrast0;\nuniform float gamma0;\nuniform float vibrance0;\nuniform float hue1;\nuniform vec3 balance0;\nuniform float saturation1;\nuniform float brightness1;\nuniform float contrast1;\nuniform float gamma1;\nuniform float vibrance1;\nuniform vec3 balance1;\nuniform float base;\n\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n    return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\n\nfloat bcolor( in float value, in float b ) {\n\treturn max(min(value * pow(base, b), 1.0), 0.0);\n}\n\nvoid main() {\n\tconst vec4 BLACK = vec4(0.0, 0.0, 0.0, 1.0);\n\tconst vec4 GREY  = vec4(0.5, 0.5, 0.5, 1.0);\n\n\tvec4 colorFromPanos;\n\tvec4 colorFromPano0 = textureCube( pano0Map, vWorldPosition0.xyz);\n\tvec4 colorFromPano1 = textureCube( pano1Map, vWorldPosition1.xyz);\n\n\tif (blackout == 0) {\n\t\tcolorFromPanos = mix(colorFromPano0, colorFromPano1, progress);\n\t} else if (blackout == 1) {\n\t\tcolorFromPanos = mix(colorFromPano0, BLACK, min(1.0, progress*2.0));\n\t\tcolorFromPanos = mix(colorFromPanos, colorFromPano1, max(0.0, progress * 2.0 - 1.0));\n\t} else if (blackout == 2) {\n\t\tcolorFromPanos = mix(colorFromPano0, BLACK, progress);\n\t} else if (blackout == 3) {\n\t\tcolorFromPanos = mix(BLACK, colorFromPano1, max(0.0, progress * 2.0 - 1.0));\n\t}\n\n\tvec4 colorFromTexture = texture2D( map, vUv );\n\tcolorFromPanos = mix(colorFromPanos, colorFromTexture, modelAlpha);\n\n\tfloat whiteness = 1.0 - smoothstep(0.1, 0.2, opacity);\n\tcolorFromPanos = mix(colorFromPanos, GREY, whiteness);\n\tgl_FragColor = vec4(colorFromPanos.rgb, opacity);\n\tfloat hue = mix(hue0, hue1, progress);\n\tfloat gamma = mix(gamma0, gamma1, progress);\n\tfloat brightness = mix(brightness0, brightness1, progress);\n\tfloat contrast = mix(contrast0, contrast1, progress);\n\tfloat saturation = mix(saturation0, saturation1, progress);\n\tfloat vibrance = mix(vibrance0, vibrance1, progress);\n\tvec3 balance = mix(balance0, balance1, progress);\n\tgl_FragColor.r = bcolor(gl_FragColor.r, balance.x);\n\tgl_FragColor.g = bcolor(gl_FragColor.g, balance.y);\n\tgl_FragColor.b = bcolor(gl_FragColor.b, balance.z);\n\tif (hue!=0.0){\n        float angle = hue * 3.14159265;\n        float s = sin(angle), c = cos(angle);\n        vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n        float len = length(gl_FragColor.rgb);\n        gl_FragColor.rgb = vec3(\n            dot(gl_FragColor.rgb, weights.xyz),\n            dot(gl_FragColor.rgb, weights.zxy),\n            dot(gl_FragColor.rgb, weights.yzx)\n        );\n    }\n    if (saturation!=0.0){\n        float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;\n        if (saturation > 0.0) {\n            gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));\n        } else {\n            gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);\n        }\n\t}\n    gl_FragColor.rgb += brightness;\n    if (contrast!=0.0){\n        if (contrast > 0.0) {\n            gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;\n        } else {\n            gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;\n        }\n\t}\n    if (vibrance!=0.0){\n        float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;\n        float mx = max(gl_FragColor.r, max(gl_FragColor.g, gl_FragColor.b));\n        float amt = (mx - average) * (-vibrance * 3.0);\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(mx), amt);\n    }\n    if (gamma!=1.0){\n        gl_FragColor = LinearToGamma( gl_FragColor, float( gamma ) );\n    }\n}\n"},modelOutside:{uniforms:{map:{type:"t",value:null},opacity:{type:"f",value:1},brightness:{type:"f",value:0}},vertexShader:f+"varying vec2 vUv;\n\nvoid main() {\n\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}\n",fragmentShader:g+"uniform sampler2D map;\nuniform float opacity;\nuniform float brightness;\nvarying vec2 vUv;\n\nvec4 white = vec4(0.5, 0.5, 0.5, 1.0);\n\nvoid main() {\n\n  vec4 colorFromTexture = texture2D( map, vUv );\n  float whiteness = 1.0 - smoothstep(0.1, 0.2, opacity);\n  colorFromTexture = mix(colorFromTexture, white, whiteness);\n  gl_FragColor = vec4(colorFromTexture.rgb, opacity);\n\n}\n"},ribbon:{uniforms:{map:{type:"t",value:null},opacity:{type:"f",value:1},color:{type:"c",value:new d.Color(e.path.color)}},vertexShader:f+"varying vec2 vUv;\nvarying vec3 vN;\nvarying vec4 vP;\n\nvoid main() {\n\n  vUv = uv;\n  vN= normalMatrix * normal;\n  vP = modelViewMatrix * vec4( position, 1.0 );\n  gl_Position = projectionMatrix * vP;\n}\n",fragmentShader:g+"uniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUv;\nuniform vec3 color;\nvarying vec3 vN; // show-1182\nvarying vec4 vP; // show-1182\n\nvoid main() {\n\t// TODO add scroll-in and pulsing behaviors\n\tvec3 vNn = normalize(vN);\n\tvec3 vPn = normalize(vP.xyz);\n\tfloat f = pow(1.0-abs(dot(vNn,vPn)),0.2);\n  vec4 colorFromTexture = texture2D( map, vUv );\n  colorFromTexture.a *= f;\n  gl_FragColor = vec4((color.rgb*colorFromTexture.rgb),\n  \t\t\t\t\t\t(opacity*colorFromTexture.a));\n}\n"},waypoint:{uniforms:{map:{type:"t",value:null},opacity:{type:"f",value:1},pulse:{type:"f",value:1},nearFade:{type:"v2",value:new d.Vector2(2*e.insideNear,2*e.path.waypointIndoorRadius)},color:{type:"c",value:new d.Color(e.reticuleColor)}},vertexShader:f+"varying vec2 vUv;\nvarying vec4 vPointView;\n\nvoid main() {\n\n  vUv = uv;\n  vPointView = modelViewMatrix * vec4( position, 1.0 );\n  gl_Position = projectionMatrix * vPointView;\n\n}\n",fragmentShader:g+"uniform sampler2D map;\nuniform float opacity;\nuniform float pulse; // another opacity, with a different clock\nuniform vec2 nearFade;\nvarying vec2 vUv;\nvarying vec4 vPointView;\nuniform vec3 color;\n\nvoid main() {\n\t// TODO add scroll-in and pulsing behaviors\n\tfloat depthFade = min(1.0, (abs(vPointView.z)-nearFade.x)/(nearFade.y-nearFade.x));\n  vec4 colorFromTexture = texture2D( map, vUv );\t\t// we only use the alpha!\n  gl_FragColor = vec4((color.rgb*colorFromTexture.rgb),\n  \t\t\t\t\t\t(pulse*opacity*colorFromTexture.a * depthFade));\n}\n"},modelDebug:{uniforms:{map:{type:"t",value:null},modelAlpha:{type:"f",value:e.modelAlpha},depthmapRatio:{type:"f",value:0},opacity:{type:"f",value:1},progress:{type:"f",value:0},considerOcclusion:{type:"i",value:e.fancierTransition},highlightPanoSelection:{type:"i",value:0},useThirdPano:{type:"i",value:e.useThirdPano},pano0Map:{type:"t",value:null},pano0Depth:{type:"t",value:null},pano0Position:{type:"v3",value:new d.Vector3},pano0Matrix:{type:"m4",value:new d.Matrix4},pano0Weight:{type:"f",value:e.transition.pano0Weight},pano1Map:{type:"t",value:null},pano1Depth:{type:"t",value:null},pano1Position:{type:"v3",value:new d.Vector3},pano1Matrix:{type:"m4",value:new d.Matrix4},pano1Weight:{type:"f",value:e.transition.pano1Weight},pano2Map:{type:"t",value:null},pano2Depth:{type:"t",value:null},pano2Position:{type:"v3",value:new d.Vector3},pano2Matrix:{type:"m4",value:new d.Matrix4},pano2Weight:{type:"f",value:e.transition.pano2Weight}},vertexShader:f+"uniform vec3 pano0Position;\nuniform mat4 pano0Matrix;\n\nuniform vec3 pano1Position;\nuniform mat4 pano1Matrix;\n\nuniform vec3 pano2Position;\nuniform mat4 pano2Matrix;\n\nvarying vec2 vUv;\nvarying vec3 vWorldPosition0;\nvarying vec3 vWorldPosition1;\nvarying vec3 vWorldPosition2;\n\nvarying vec4 worldPosition;\n\nvoid main() {\n\n  vUv = uv;\n  worldPosition = modelMatrix * vec4(position, 1.0);\n\n  vec3 positionLocalToPanoCenter0 = worldPosition.xyz - pano0Position;\n  vWorldPosition0 = (vec4(positionLocalToPanoCenter0, 1.0) * pano0Matrix).xyz;\n  vWorldPosition0.x *= -1.0;\n\n  vec3 positionLocalToPanoCenter1 = worldPosition.xyz - pano1Position;\n  vWorldPosition1 = (vec4(positionLocalToPanoCenter1, 1.0) * pano1Matrix).xyz;\n  vWorldPosition1.x *= -1.0;\n\n  vec3 positionLocalToPanoCenter2 = worldPosition.xyz - pano2Position;\n  vWorldPosition2 = (vec4(positionLocalToPanoCenter2, 2.0) * pano2Matrix).xyz;\n  vWorldPosition2.x *= -1.0;\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}\n",fragmentShader:g+"uniform sampler2D map;\nuniform float depthmapRatio;\nuniform float modelAlpha;\nuniform float opacity;\nuniform float progress;\nuniform int considerOcclusion;\nuniform int highlightPanoSelection;\nuniform int useThirdPano;\n\nuniform vec3 pano0Position;\nuniform samplerCube pano0Map;\nuniform samplerCube pano0Depth;\nuniform float pano0Weight;\n\nuniform vec3 pano1Position;\nuniform samplerCube pano1Map;\nuniform samplerCube pano1Depth;\nuniform float pano1Weight;\n\nuniform vec3 pano2Position;\nuniform samplerCube pano2Map;\nuniform samplerCube pano2Depth;\nuniform float pano2Weight;\n\nvarying vec2 vUv;\nvarying vec3 vWorldPosition0;\nvarying vec3 vWorldPosition1;\nvarying vec3 vWorldPosition2;\n\nvarying vec4 worldPosition;\n\nvoid main() {\n\n  vec4 depthFromPano0 = textureCube( pano0Depth, vWorldPosition0.xyz );\n  vec4 depthFromPano1 = textureCube( pano1Depth, vWorldPosition1.xyz );\n  vec4 depthFromPano2 = textureCube( pano2Depth, vWorldPosition2.xyz );\n\n  vec4 colorFromPano0 = textureCube( pano0Map, vWorldPosition0.xyz );\n  vec4 colorFromPano1 = textureCube( pano1Map, vWorldPosition1.xyz );\n  vec4 colorFromPano2 = textureCube( pano2Map, vWorldPosition2.xyz );\n\n  float distanceToPano0 = distance(worldPosition.xyz, pano0Position);\n  float distanceToPano1 = distance(worldPosition.xyz, pano1Position);\n  float distanceToPano2 = distance(worldPosition.xyz, pano2Position);\n\n  float cameraToPano0 = distance(cameraPosition.xyz, pano0Position);\n  float cameraToPano1 = distance(cameraPosition.xyz, pano1Position);\n  float cameraToPano2 = distance(cameraPosition.xyz, pano2Position);\n\n  float contributionFromPano0 = cameraToPano0 == 0.0 ? 1000.0 : pano0Weight / cameraToPano0;\n  float contributionFromPano1 = cameraToPano1 == 0.0 ? 1000.0 : pano1Weight / cameraToPano1;\n  float contributionFromPano2 = cameraToPano2 == 0.0 ? 1000.0 : pano2Weight / cameraToPano2;\n\n  contributionFromPano0 *= 1.0 / distanceToPano0;\n  contributionFromPano1 *= 1.0 / distanceToPano1;\n  contributionFromPano2 *= 1.0 / distanceToPano2;\n\n  if(considerOcclusion == 1) {\n    bool occludedFromPano0 = distanceToPano0 / 10.0 > 1.01 - depthFromPano0.x;\n    bool occludedFromPano1 = distanceToPano1 / 10.0 > 1.01 - depthFromPano1.x;\n    bool occludedFromPano2 = distanceToPano2 / 10.0 > 1.01 - depthFromPano2.x;\n\n    if(occludedFromPano0){contributionFromPano0 *= 0.1;}\n    if(occludedFromPano1){contributionFromPano1 *= 0.1;}\n    if(occludedFromPano2){contributionFromPano2 *= 0.1;}\n    //if(occludedFromPano0 && occludedFromPano1 && !occludedFromPano2) { contributionFromPano2 += 0.5; }\n  }\n\n  float contributionSum = contributionFromPano0 + contributionFromPano1 + contributionFromPano2;\n  contributionFromPano0 /= contributionSum;\n  contributionFromPano1 /= contributionSum;\n  contributionFromPano2 /= contributionSum;\n\n  vec4 colorFromPanos = colorFromPano0 * contributionFromPano0;\n  colorFromPanos += colorFromPano1 * contributionFromPano1;\n  colorFromPanos += colorFromPano2 * contributionFromPano2;\n\n  vec4 depthFromPanos = depthFromPano0 * contributionFromPano0;\n  depthFromPanos += depthFromPano1 * contributionFromPano1;\n  depthFromPanos += depthFromPano2 * contributionFromPano2;\n\n  vec4 colorFromTexture = texture2D( map, vUv );\n  colorFromPanos = mix(colorFromPanos, colorFromTexture, modelAlpha);\n\n  if(highlightPanoSelection == 1) {\n    colorFromPanos.r = contributionFromPano0;\n    colorFromPanos.g = contributionFromPano1;\n    colorFromPanos.b = contributionFromPano2;\n  }\n\n  gl_FragColor = vec4(mix(colorFromPanos, depthFromPanos, depthmapRatio).rgb, opacity);\n\n}\n"},customDepth:{uniforms:{panoPosition:{type:"v3",value:new d.Vector3}},vertexShader:f+"varying vec4 worldPosition;\n\nvoid main() {\n\n  worldPosition = modelMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}\n",fragmentShader:g+"uniform vec3 panoPosition;\nvarying vec4 worldPosition;\n\nvoid main() {\n\n  float depth = distance(worldPosition.xyz, panoPosition);\n  float color = 1.0 - depth / 10.0;\n  gl_FragColor = vec4(color, color, color, 1.0);\n\n}\n"},skysphere:{uniforms:{radius:{type:"f",value:0}},vertexShader:f+"varying vec4 worldPosition;\n\nvoid main() {\n\n  worldPosition = modelMatrix * vec4(position, 1.0);\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}\n",fragmentShader:g+"varying vec4 worldPosition;\nuniform float radius;\n\nvoid main() {\n\n  vec4 topColor = vec4(0.094, 0.102, 0.11, 1.0);\n  vec4 bottomColor = vec4(0.2, 0.216, 0.235, 1.0);\n  float normalizedHeight = (worldPosition.y + radius) / (radius * 2.0);\n  float ratio = smoothstep(0.0, 0.5, normalizedHeight);\n  gl_FragColor = mix(bottomColor, topColor, ratio);\n\n}\n"},tagDisc:{uniforms:{opacity:{type:"f",value:0},color:{type:"c",value:new d.Color},bg:{type:"t",value:null},mask:{type:"t",value:null}},vertexShader:f+"varying vec2 vUv;\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}",fragmentShader:g+"uniform float opacity;\nuniform vec3 color;\nuniform sampler2D bg;\nuniform sampler2D mask;\n\nvarying vec2 vUv;\n\nvoid main() {\n  vec4 maskColor = texture2D(mask, vUv);\n  vec4 bgColor = texture2D(bg, vUv);\n  vec3 mappedColor = mix(bgColor.rgb, color, maskColor.a);\n  gl_FragColor = vec4(mappedColor, bgColor.a * opacity);\n}\n"}}},{"./conf":7,three:177}],127:[function(a,b,c){(function(c){"use strict";var d=a("three"),e=(a("./util/ajax"),a("./conf")),f=a("./util/logger"),g=a("./util/math"),h=a("./util/showcase"),i=a("./objects/Panorama"),j=(new f(c),a("./model/Model")),k=a("./shaders"),l=a("./util/transitions"),m=a("./objects/Chunk"),n=a("./objects/Reticule"),o=a("./objects/Skybox"),p=a("./objects/Floor"),q=a("./cameras/DollhouseCamera"),r=a("./cameras/FloorplanCamera"),s=a("./cameras/PanoramaCamera"),t=a("./controls/DollhouseControls"),u=a("./controls/FloorplanControls"),v=a("./controls/PanoramaControls");d.ImageUtils.crossOrigin=e.crossOrigin,b.exports={shaders:k,transitions:l,Model:j,Chunk:m,Floor:p,Skybox:o,Reticule:n,Panorama:i,DollhouseCamera:q,FloorplanCamera:r,PanoramaCamera:s,DollhouseControls:t,FloorplanControls:u,PanoramaControls:v,initS:function(a,b,c){if(!a.url)throw'getModel(): missing parameter "url"';a.autoload=void 0===a.autoload||a.autoload;var d=h.parseModelid(a.url);a.urlBase=d.urlBase,a.urlModel=d.urlModel,a.urlFiles=d.urlFiles;var e=this._getPlatformError();return e?$.Deferred().reject(e).promise():(this.options=a,this._loadModel(c).then(this.createS.bind(this)))},_getPlatformError:function(){return"IE"===$.ua.browser.name&&parseInt($.ua.browser.major)<11?"webgl-unsupported":"iOS"===$.ua.os.name&&/^[0-7][$\.]/.test($.ua.os.version)?"webgl-ios":Modernizr.webgl?null:"webgl-unsupported"},_loadModel:function(a){return $.when(a)},createS:function(a){a.nestscenes=h.normalizeModeldata(a.nestscenes,g);var b=new j(this.options,a);return $.when(b)}}}).call(this,"/js/showcase.js")},{"./cameras/DollhouseCamera":4,"./cameras/FloorplanCamera":5,"./cameras/PanoramaCamera":6,"./conf":7,"./controls/DollhouseControls":9,"./controls/FloorplanControls":10,"./controls/PanoramaControls":12,"./model/Model":102,"./objects/Chunk":108,"./objects/Floor":110,"./objects/Panorama":113,"./objects/Reticule":114,"./objects/Skybox":117,"./shaders":126,"./util/ajax":141,"./util/logger":153,"./util/math":154,"./util/showcase":156,"./util/transitions":162,three:177}],128:[function(a,b,c){"use strict";function d(){return{renderTarget:null,inUse:!1,size:-1,pano:null}}function e(a){D.push(a)}function f(a){var b=d();return b.inUse=!0,b.size=a,e(b),b}function g(a){for(var b=0;b<D.length;b++){var c=D[b];if(!c.inUse&&c.size===a)return c.inUse=!0,c}return null}function h(a){for(var b=0;b<D.length;b++){var c=D[b];if(c.renderTarget===a)return c.inUse=!1,!0}return!1}function i(){this.tileDirectory={},this.activeRenderTargetDescriptors={},this.activePanos=[],this.panoLODDescriptors={},this.panoDescriptors={},this.tileTrees={},this.sceneRenderer=null,this.tileDownloader=null,this.forceQueue=[],this.uploadQueues={},this.uploadInterval=null,this.uploadIntervalCancelled=!1,this.usingTileOverlay=!1,this.overlayTilesLoaded=!1,this.overlayTileBase=null,this.overlayTilesBasic={},this.overlayTilesEnhanced={},this.zoomRenderTarget=null,this.zoomPano=null,this.zoomingActive=!1,this.zoomPanoId=null,this.zoomPanoRenderingDisabled=!1,this.direction=new k.Vector3,this.initTime=-1,this.maxBaseUploadsPerFrame=B,this.maxNonBaseUploadsPerFrame=A}function j(){this.uploadIntervalCancelled||(this.overlayTilesLoaded||!this.usingTileOverlay?(x=!0,this.updateUploadQueue(this.maxNonBaseUploadsPerFrame,this.maxBaseUploadsPerFrame),this.peekNextFromUploadQueue()?this.refreshUploadInterval(y):this.uploadInterval=null):this.refreshUploadInterval(this.uploadIntervalDelay))}var k=a("three"),l=a("../exception/BasicException"),m=a("../conf"),n=a("../enum/PanoSizeClass"),o=(a("../objects/Panorama"),
a("../enum/PanoRendererEvents")),p=a("../enum/SceneRendererEvents"),q=a("../enum/TileDownloaderEvents"),r=a("../enum/Vectors"),s=(a("../enum/GLCubeFaces"),a("../objects/Panorama"),a("./TileTree")),t=(a("./TileDownloader"),a("./TilePrioritizer")),u=a("./TileUtils"),n=a("../enum/PanoSizeClass"),v=(a("../util/browser"),a("../util/panorama")),w=a("events").EventEmitter,x=!1,y=m.tiling.uploadIntervalDelay,z=m.tiling.initialIntervalDelay,A=m.tiling.maxNonBaseUploadsPerFrame,B=m.tiling.maxBaseUploadsPerFrame,C={Base:0,Remaining:1},D=[];i.prototype=Object.create(w.prototype),i.prototype.init=function(a,b,c){this.sceneRenderer=a,this.tileDownloader=b,this.qualityManager=c,this.bindEvents(),this.sceneRenderer.on(p.ContextCreated,this.loadOverlayTiles.bind(this)),this.initTime=performance.now()},i.prototype.getActivePanoTextures=function(a){a=a||[];for(var b=0;b<D.length;b++){var c=D[b];c.renderTarget&&c.renderTarget.texture&&a.push(c.renderTarget.texture)}},i.prototype.hasQueuedTiles=function(){var a=this.peekNextFromUploadQueue();return null!==a&&void 0!==a},i.prototype.getActiveRenderTargetDescriptor=function(a){return this.activeRenderTargetDescriptors[a]},i.prototype.setActiveRenderTargetDescriptor=function(a,b){this.activeRenderTargetDescriptors[a]=b},i.prototype.loadOverlayTiles=function(){if(0!==m.tiling.overlayStyle){var a=0,b=function(b,d,e){b=d?b[d]=this.sceneRenderer.initSizedTexture2D(u.TILE_SIZE,k.ClampToEdgeWrapping):this.overlayTileBase=this.sceneRenderer.initSizedTexture2D(u.TILE_SIZE,k.ClampToEdgeWrapping),this.sceneRenderer.uploadTexture2D(e,b,0,0,u.TILE_SIZE,u.TILE_SIZE),++a===c.length&&(this.overlayTilesLoaded=!0)}.bind(this),c=[["images/outlineBase.png",b.bind(this,this.overlayTileBase,null)],["images/outlineBasic512.png",b.bind(this,this.overlayTilesBasic,256)],["images/outlineBasic512.png",b.bind(this,this.overlayTilesBasic,512)],["images/outlineBasic1024.png",b.bind(this,this.overlayTilesBasic,1024)],["images/outlineBasic2048.png",b.bind(this,this.overlayTilesBasic,2048)],["images/outlineBasic4096.png",b.bind(this,this.overlayTilesBasic,4096)],["images/outlineEnhanced512.png",b.bind(this,this.overlayTilesEnhanced,256)],["images/outlineEnhanced512.png",b.bind(this,this.overlayTilesEnhanced,512)],["images/outlineEnhanced1024.png",b.bind(this,this.overlayTilesEnhanced,1024)],["images/outlineEnhanced2048.png",b.bind(this,this.overlayTilesEnhanced,2048)],["images/outlineEnhanced4096.png",b.bind(this,this.overlayTilesEnhanced,4096)]];c.forEach(function(a){this.tileDownloader.loadImage(a[0],0,a[1])}.bind(this)),this.usingTileOverlay=!0}else this.usingTileOverlay=!1},i.prototype.bindEvents=function(){this.tileDownloader.on(q.TileDownloadSuccess,this.onTileDownloaded.bind(this))},i.prototype.setupZoomRenderTarget=function(){if(this.qualityManager.getMaxZoomPanoSize()>=this.qualityManager.getMaxNavPanoSize()){if(this.zoomRenderTarget&&this.zoomRenderTarget.width===this.qualityManager.getMaxZoomPanoSize())return;var a=this.zoomRenderTarget;if(this.zoomRenderTarget=this.initTiledPano(this.qualityManager.getMaxZoomPanoSize(),!1),a){var b=a.width,c=this.zoomRenderTarget.width;this.sceneRenderer.copyCubeMap(a.texture,this.zoomRenderTarget,b,b,c,c),a.texture.dispose(),a.texture.loaded=!1,a.texture.version=0,this.sceneRenderer.deallocateCubeTexture(a.texture),a.texture=null}this.zoomPanoRenderingDisabled=!1}else this.zoomPanoRenderingDisabled=!0},i.prototype.enableUltraHighQualityMode=function(a){if(!this.qualityManager.ultraHighQualityModeEnabled()){var b=this.qualityManager.getPanoSize(n.ULTRAHIGH);this.tileDownloader.testDownload(b,u.TILE_SIZE,function(b){b&&(this.qualityManager.enableUltraHighQualityMode(),this.setupZoomRenderTarget(),a())}.bind(this))}},i.prototype.activateTiledPano=function(a,b,c){c&&this.clearAllQueuedUploads();for(var d=0;d<u.FACES_PER_PANO;d++)this.initTileTree(a.id,d,this.qualityManager.getMaxPossiblePanoSize());this.linkAllTilesAndNodes(a);var e=this.getActiveRenderTargetDescriptor(a.id),i=b;if(i>this.qualityManager.getMaxNavPanoSize()&&(i=this.qualityManager.getMaxNavPanoSize()),!e||i!==e.size){if(e&&h(e.renderTarget),!(e=g(i))){var j=this.initTiledPano(i,!1);e=f(j.width),e.renderTarget=j}e.pano=a,this.resetPanoDescriptor(a.id),this.resetPanoLODDescriptors(a.id),this.resetRenderStatus(a.id,!0,!0)}this.setActiveRenderTargetDescriptor(a.id,e);var k=c?0:1;return this.updateActivePanos(a,k),e.renderTarget},i.prototype.deactivateTiledPano=function(a){var b=this.getActiveRenderTargetDescriptor(a.id);this.isRenderTargetDescriptorValid(b)&&h(b.renderTarget),this.setActiveRenderTargetDescriptor(a.id,null);var c=this.getUploadQueueForPano(a.id);this.clearUploadQueue(c),this.updateActivePanos()},i.prototype.updateActivePanos=function(){var a=[];return function(b,c){a.length=0;for(var d=0;d<this.activePanos.length;d++){b&&a.length===c&&a.push(b);var e=this.activePanos[d],f=this.getActiveRenderTargetDescriptor(e.id);b&&e.id===b.id||!this.isRenderTargetDescriptorValid(f)||a.push(e)}b&&c>=a.length&&a.push(b),this.activePanos.length=0,this.activePanos.push.apply(this.activePanos,a)}}(),i.prototype.getActivePanoCount=function(){return this.activePanos.length},i.prototype.resetRenderStatus=function(a,b,c,d){var e=null;d&&(e=s.getLevelCountForSize(u.TILE_SIZE,d)+1);for(var f=function(a,d,e,f){c&&(d.tile.zoomUploaded=!1),b&&(d.tile.uploaded=!1)},g=0;g<u.FACES_PER_PANO;g++){this.getTileTree(a,g).breadthFirst({callback:f.bind(this,g),minLevel:e})}},i.prototype.copyBaseRenderStatusToZoomed=function(a){for(var b=s.getLevelCountForSize(u.TILE_SIZE,this.qualityManager.getMaxNavPanoSize()),c=function(a,b,c,d){b.tile.zoomUploaded=b.tile.uploaded,b.zoomCovered=b.covered},d=0;d<u.FACES_PER_PANO;d++){this.getTileTree(a,d).breadthFirst({callback:c.bind(this,d),maxLevel:b})}},i.prototype.renderPanoTiles=function(){var a=[];return function(b,c,d,e){this.zoomRenderTarget&&this.zoomRenderTarget.width===this.qualityManager.getMaxZoomPanoSize()||this.zoomPanoRenderingDisabled||this.setupZoomRenderTarget(),c=c||this.direction||r.FORWARD;var f=this.getActiveRenderTargetDescriptor(b);if(!this.isRenderTargetDescriptorValid(f))throw new l("PanoRenderer.renderPanoTiles() -> Cannot render to a pano that is not activated.");for(var g=0;g<u.FACES_PER_PANO;g++){var h=this.getTileTree(b,g);a.length=0,h.breadthFirst({saveVisited:a});for(var i=0;i<a.length;i++){var j=a[i];this.queueTileUpload(j.tile,!1,e||0===i&&d)}}this.updateDirection(c)}}(),i.prototype.isRenderTargetDescriptorValid=function(a){return a&&a.renderTarget},i.prototype.isPanoActive=function(a){var b=this.getActiveRenderTargetDescriptor(a);return this.isRenderTargetDescriptorValid(b)},i.prototype.isPanoZoomed=function(a){return this.zoomingActive&&this.zoomPanoId===a},i.prototype.initTileTree=function(a,b,c){var d=this.tileTrees[a];d||(d=[],this.tileTrees[a]=d);var e=d[b];if(!e){var f=s.getLevelCountForSize(u.TILE_SIZE,c);e=new s(u.TILE_SIZE,f),d[b]=e}},i.prototype.getTileTree=function(a,b){var c=this.tileTrees[a];if(!c)throw new l("PanoRenderer.getTileTree() -> Tree array not yet initialized!");var d=c[b];if(!d)throw new l("PanoRenderer.getTileTree() -> Tree not yet initialized!");return d},i.prototype.initTiledPano=function(a,b){var c=this.sceneRenderer.renderer,d=(c.context,new k.WebGLRenderTargetCube(a,a,{stencilBuffer:!1})),e=new k.CubeTexture([]);d.texture=e,e.image=[null,null,null,null,null,null],e.flipY=!0,b?(e.generateMipmaps=!0,e.magFilter=k.LinearFilter,e.minFilter=k.LinearMipMapLinearFilter):(e.generateMipmaps=!1,e.magFilter=k.LinearFilter,e.minFilter=k.LinearFilter),e.format=k.RGBAFormat,c.setRenderTarget(d),c.setRenderTarget(null);var f=c.properties.get(e);return f.__image__webglTextureCube=f.__webglTexture,d},i.prototype.getUploadQueueForPano=function(a){var b=this.uploadQueues[a];return b||(b=[],this.uploadQueues[a]=b),b},i.prototype.isTileUploaded=function(a){return this.isPanoZoomed(a.panoId)?a.zoomUploaded:a.uploaded},i.prototype.setUploaded=function(a,b){this.isPanoZoomed(a.panoId)?a.zoomUploaded=b:a.uploaded=b},i.prototype.queueTileUpload=function(a,b,c){var d=this.getActiveRenderTargetDescriptor(a.panoId);if(this.isRenderTargetDescriptorValid(d)&&a.downloaded&&!this.isTileUploaded(a)&&(!a.uploadQueued||c)&&(!(a.panoSize>this.qualityManager.getMaxNavPanoSize())||this.zoomingActive)){var e=this.getUploadQueueForPano(a.panoId);c?this.uploadTile(a,!1):(this.shoulPushToFrontOfQueue(a)?this.forceQueue.push(a):b&&this.direction?t.insertSortedPanoTile(e,a,d.pano,this.direction):e.push(a),a.uploadQueued=!0,this.uploadInterval||this.uploadIntervalCancelled||this.refreshUploadInterval(0))}},i.prototype.shoulPushToFrontOfQueue=function(a){return 0===s.getLevelCountForSize(u.TILE_SIZE,a.panoSize)},i.prototype.getTopUploadQueue=function(){for(var a=null,b=null,c=C.Base;c<=C.Remaining;c++)for(var d=0;d<this.activePanos.length;d++)if(a=this.activePanos[d],b=this.getUploadQueueForPano(a.id),b.length>0)switch(c){case C.Base:if(0===b[0].level)return b;break;case C.Remaining:return b}return null},i.prototype.getNextFromUploadQueue=function(){var a=function(a){var b=a.shift();return b.uploadQueued=!1,b};return function(){if(this.forceQueue.length>0)return a(this.forceQueue);var b=this.getTopUploadQueue();return b&&b.length>0?a(b):null}}(),i.prototype.peekNextFromUploadQueue=function(){if(this.forceQueue.length>0)return this.forceQueue[0];var a=this.getTopUploadQueue();return a&&a.length>0?a[0]:null},i.prototype.clearAllQueuedUploads=function(){this.clearAllUploadQueues(null,0)},i.prototype.clearAllQueuedUploadsForPano=function(a){this.clearAllUploadQueues(a,0)},i.prototype.clearAllUploadQueues=function(a,b){if(a)this.clearUploadQueue(this.getUploadQueueForPano(a),b),this.clearUploadQueue(this.forceQueue,b,a);else{for(var c=0;c<this.activePanos.length;c++){var d=this.activePanos[c];this.clearUploadQueue(this.getUploadQueueForPano(d.id),b)}this.clearUploadQueue(this.forceQueue,b)}},i.prototype.clearUploadQueue=function(a,b,c){void 0!==b&&null!==b||(b=0);for(var d=0;d<a.length;){var e=a[d];(!c||c&&c===e.tile.panoId)&&e.level>=b?(e.uploadQueued=!1,a.splice(d,1)):d++}},i.prototype.refreshUploadInterval=function(){var a=null;return function(b){this.uploadIntervalCancelled||(a||(a=j.bind(this)),null!==b&&void 0!==b||(b=y),x||(b=z),this.uploadInterval=window.setTimeout(a,b),this.uploadIntervalDelay=b)}}(),i.prototype.update=function(){var a=performance.now(),b=0;return function(){this.uploadIntervalCancelled=!0,window.clearTimeout(this.uploadInterval),this.uploadInterval=null,!(performance.now()-a>y||0===b)||!this.overlayTilesLoaded&&this.usingTileOverlay||(this.updateUploadQueue(this.maxNonBaseUploadsPerFrame,this.maxBaseUploadsPerFrame),a=performance.now()),b++}}(),i.prototype.updateUploadQueue=function(a,b){a||(a=1);for(var c=0,d=0;!(d>=b||c>=a);){var e=this.getNextFromUploadQueue();if(!e)break;if(0!==e.level?c++:d++,!(e.panoSize>this.qualityManager.getMaxNavPanoSize())||this.zoomingActive){var f=this.getActiveRenderTargetDescriptor(e.panoId);this.isRenderTargetDescriptorValid(f)&&this.uploadTile(e,e.forceUpload)}}},i.prototype.updateDirection=function(a){if(a=a||this.direction){this.direction=a;for(var b=0;b<this.activePanos.length;b++){var c=this.activePanos[b],d=this.getUploadQueueForPano(c.id);t.sortPanoTiles(d,c,this.direction)}}},i.prototype.uploadTile=function(){var a={},b=(new k.Vector4,m.tiling.overlayStyle);return function(c,d){var e=c.panoId,f=c.image,g=c.tileSize,h=c.panoSize,i=c.tileIndex,j=(c.faceTileIndex,c.totalTiles),l=(c.face,c.tileX),m=c.tileY,n=!0,p=!1,q=(this.getPanoDescriptor(e),this.getPanoLODDescriptor(e,h)),r=this.getActiveRenderTargetDescriptor(e),s=r.renderTarget,t=r.size;if(this.isPanoZoomed(e)&&(s=this.zoomRenderTarget,t=this.qualityManager.getMaxZoomPanoSize()),this.isRenderTargetDescriptorValid(r)||(n=!1,p=!1),d||(this.anyUploaded(c.node)&&(n=!1,p=!0),this.isTileUploaded(c)&&(n=!1,p=!1)),n){var u=l*g,v=m*g,w=g/h*t,x=u/h*t,y=v/h*t;a[g]||(a[g]=this.sceneRenderer.initSizedTexture2D(g,k.ClampToEdgeWrapping));var z=a[g];if(this.sceneRenderer.uploadTexture2D(f,z,0,0,g,g),1===b||2===b){var A=1===b?this.overlayTilesBasic:this.overlayTilesEnhanced;this.sceneRenderer.renderToCubeMap(z,s,g,g,0,0,g,g,x,y,w,w,c.cubeFace),this.sceneRenderer.renderToCubeMap(A[h],s,g,g,0,0,g,g,x,y,w,w,c.cubeFace,k.NormalBlending,!0,.5)}else this.sceneRenderer.renderToCubeMap(z,s,g,g,0,0,g,g,x,y,w,w,c.cubeFace);q.uploadCount++,this.emit(o.TileRenderSuccess,e,h,i,j),q.uploadCount===j&&this.emit(o.PanoRenderComplete,e,h,j),this.setUploaded(c,!0),this.addCoverageForNode(c.node)}else this.setUploaded(c,!1);return c.uploadAttempted||(q.uploadAttempts++,this.emit(o.TileUploadAttempted,e,h,i,j)),c.uploadAttempted=!0,q.uploadAttempts===j&&this.emit(o.UploadAttemptedForAllTiles,e,h,j),p}}(),i.prototype.linkTileAndNode=function(a,b){b.tile=a,a.node=b},i.prototype.linkCallBack=function(a,b,c,d,e){var f=this.getTileDirectoryEntry(a.id,b,d,e);this.linkTileAndNode(f,c)},i.prototype.linkAllTilesAndNodes=function(a){for(var b=0;b<u.FACES_PER_PANO;b++){this.getTileTree(a.id,b).breadthFirst({callback:this.linkCallBack.bind(this,a,b)})}},i.prototype.anyUploaded=function(a){if(!a)return!1;if(a.tile&&this.isTileUploaded(a.tile))return!0;if(a.children)for(var b=0;b<a.children.length;b++){var c=a.children[b];if(this.anyUploaded(c))return!0}return!1},i.prototype.setNodeCovered=function(a,b){this.isPanoZoomed(a.tile.panoId)?a.zoomCovered=b:a.covered=b},i.prototype.isNodeCovered=function(a){return!!a&&(this.isPanoZoomed(a.tile.panoId)?a.zoomCovered:a.covered)},i.prototype.addCoverageForNode=function(a){if(this.setNodeCovered(a,!0),a.parent&&a.covered){var b=a.parent;this.nodeSubcovered(b)&&this.addCoverageForNode(b,!0)}},i.prototype.calcFullCoverage=function(a){var b=!1;if(a.children)for(var c=0;c<a.children.length;c++){var d=a.children[c];b=b||this.calcFullCoverage(d)}a.covered=a.tile.uploaded||b},i.prototype.nodeSubcovered=function(a){if(!a.children)return!1;for(var b=0;b<a.children.length;b++)if(!a.children[b]||!this.isNodeCovered(a.children[b]))return!1;return!0},i.prototype.resetPanoDescriptor=function(a){this.getPanoDescriptor(a)},i.prototype.getPanoDescriptor=function(a){var b=this.panoDescriptors[a];return b||(b={},this.panoDescriptors[a]=b),b},i.prototype.resetPanoLODDescriptors=function(a){var b=this.getPanoLODDescriptors(a);for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];d.uploadCount=0,d.uploadAttempts=0}},i.prototype.getPanoLODDescriptor=function(a,b){var c=this.getPanoLODDescriptors(a),d=c[b];return d||(d={uploadCount:0,uploadAttempts:0},c[b]=d),d},i.prototype.getPanoLODDescriptors=function(a){var b=this.panoLODDescriptors[a];return b||(b={},this.panoLODDescriptors[a]=b),b},i.prototype.onTileDownloaded=function(a){var b=s.getLevelCountForSize(u.TILE_SIZE,a.panoSize),c=this.getTileDirectoryEntry(a.panoId,a.face,b,a.faceTileIndex);if(c.downloaded=!0,c.image=a.image,c.panoSize=a.panoSize,c.tileX=a.tileX,c.tileY=a.tileY,c.totalTiles=a.totalTiles,c.tileIndex=a.tileIndex,c.faceTileIndex=a.faceTileIndex,c.face=a.face,c.cubeFace=v.mapFaceToCubemapFace(a.face),c.panoId=a.panoId,c.tileSize=a.tileSize,c.direction=(new k.Vector3).copy(a.direction),c.node=null,c.level=s.getLevelCountForSize(u.TILE_SIZE,c.panoSize),this.isPanoActive(c.panoId)){var d=this.getTileTree(c.panoId,c.face),e=d.getSubNode(c.panoSize,c.tileX,c.tileY);this.linkTileAndNode(c,e),this.queueTileUpload(c,!0)}},i.prototype.getTileDirectoryEntry=function(a,b,c,d){var e=this.tileDirectory[a];e||(e={},this.tileDirectory[a]=e);var f=16384*b+1024*c+d,g=e[f];return g||(g={downloaded:!1,uploaded:!1,zoomUploaded:!1},e[f]=g),g._key=a+":"+b+":"+c+":"+d,g._tileKey=f,g},i.prototype.setZoomingActive=function(a,b,c){this.zoomPanoRenderingDisabled||a===this.zoomingActive&&this.zoomPanoId===b.id||(this.zoomingActive=a,this.zoomPanoId=b.id,this.zoomingActive&&(this.zoomPanoId!==b.id||c)&&this.updateZoomedPanoFromBase(b))},i.prototype.updateZoomedPanoFromBase=function(a){if(!this.zoomPanoRenderingDisabled){var b=this.getActiveRenderTargetDescriptor(a.id);if(b&&b.renderTarget){var c=this.qualityManager.getMaxZoomPanoSize(),d=b.renderTarget,e=b.size;this.sceneRenderer.copyCubeMap(d.texture,this.zoomRenderTarget,e,e,c,c),this.copyBaseRenderStatusToZoomed(a.id)}}},b.exports=i},{"../conf":7,"../enum/GLCubeFaces":22,"../enum/PanoRendererEvents":32,"../enum/PanoSizeClass":33,"../enum/SceneRendererEvents":40,"../enum/TileDownloaderEvents":45,"../enum/Vectors":50,"../exception/BasicException":54,"../objects/Panorama":113,"../util/browser":142,"../util/panorama":155,"./TileDownloader":130,"./TilePrioritizer":131,"./TileTree":132,"./TileUtils":133,events:170,three:177}],129:[function(a,b,c){"use strict";function d(a,b,c){this.maxNavPanoSize=-1,this.maxZoomPanoSize=-1,this.devicePixelDensity=a,this.deviceScreenSize=b,this.clientBandwidth=c,this.panoSizeClassMap={},this.useHighResolutionPanos=!0,this.useUltraHighResolutionPanos=!1,this.modelHasUltraHighPanos=!1}var e=a("../enum/PanoSizeClass"),f=a("../conf"),g=a("../util/browser"),h=a("../constants"),i=(a("../util/showcase"),a("../enum/ModelManagerEvents"));d.prototype.init=function(a){this.buildPanoSizeClassMap(this.devicePixelDensity,this.deviceScreenSize,this.clientBandwidth),this.ultraHighSize=this.getPanoSize(e.ULTRAHIGH),this.highSize=this.getPanoSize(e.HIGH),this.standardSize=this.getPanoSize(e.STANDARD),this.baseSize=this.getPanoSize(e.BASE),f.tiling.maxZoomPanoQuality&&this.ultraHighSize<=f.tiling.maxZoomPanoQuality&&(f.tiling.allowUltraHighResolution=!0),this.highQualityThreshold=g.valueFromHash("threshold2k",h.windowHeightHighQualityThreshold),this.updateMaximums(),a.on(i.ActiveModelChanged,this.onModelChanged.bind(this))},d.prototype.updateFromModel=function(a){this.updateHighResolutionSettings(a),this.updateUltraHighResolutionSettings(a)},d.prototype.updateHighResolutionSettings=function(a){this.updateMaximums()},d.prototype.updateUltraHighResolutionSettings=function(a){f.tiling.allowUltraHighResolution&&this.modelHasUltraHighPanos?this.useUltraHighResolutionPanos=!0:this.useUltraHighResolutionPanos=!1,this.updateMaximums()},d.prototype.enableUltraHighQualityMode=function(){this.modelHasUltraHighPanos=!0,this.updateUltraHighResolutionSettings(null)},d.prototype.ultraHighQualityModeEnabled=function(){return this.modelHasUltraHighPanos},d.prototype.onModelChanged=function(a){this.updateFromModel(a.model),this.updateMaximums()},d.prototype.updateMaximums=function(){this.maxNavPanoSize=f.tiling.maxNavPanoQuality||this.detectMaxNavPanoSize(),this.maxZoomPanoSize=f.tiling.maxZoomPanoQuality||this.detectMaxZoomPanoSize(),this.maxZoomPanoSize<this.maxNavPanoSize&&(this.maxNavPanoSize=this.maxZoomPanoSize)},d.prototype.buildPanoSizeClassMap=function(){this.panoSizeClassMap[e.BASE]=512,this.panoSizeClassMap[e.STANDARD]=1024,this.panoSizeClassMap[e.HIGH]=2048,this.panoSizeClassMap[e.ULTRAHIGH]=4096},d.prototype.getPanoSize=function(a){return this.panoSizeClassMap[a]},d.prototype.getMaxPossiblePanoSize=function(){return this.getPanoSize(e.HIGH)},d.prototype.getMaxPanoSize=function(){return this.maxZoomPanoSize},d.prototype.getMaxNavPanoSize=function(){return this.maxNavPanoSize},d.prototype.getMaxZoomPanoSize=function(){return this.maxZoomPanoSize},d.prototype.detectMaxNavPanoSizeClass=function(){var a="";return a=f.panoramaSettings.loading_2k?e.HIGH:e.STANDARD,this.useHighResolutionPanos?g.isMobile()?a:window.innerHeight<this.highQualityThreshold?a:e.HIGH:e.STANDARD},d.prototype.detectMaxNavPanoSize=function(){var a=this.detectMaxNavPanoSizeClass();return this.getPanoSize(a)},d.prototype.detectMaxZoomPanoSize=function(){return this.useHighResolutionPanos?g.isMobile()?f.tiling.mobileHighQualityOverride?this.getPanoSize(e.HIGH):this.getPanoSize(e.STANDARD):this.useUltraHighResolutionPanos?this.getPanoSize(e.ULTRAHIGH):this.getPanoSize(e.HIGH):this.getPanoSize(e.STANDARD)},b.exports=d},{"../conf":7,"../constants":8,"../enum/ModelManagerEvents":30,"../enum/PanoSizeClass":33,"../util/browser":142,"../util/showcase":156}],130:[function(a,b,c){(function(c){"use strict";function d(a){this.panos=null,this.retryMinimumTime=1e4,this.urls=null,this.panoLoadCallbacks={},this.downloadDescriptors={},this.priorityQueue=[],this.forceQueue=[],this.activeDownloads=[],this.qualityManager=null,this.tilePrioritizer=null,this.refreshInterval=null,this.processPriorityQueue=!1,this.concurrentDownloads=a.concurrentDownloads||1,this.downloadTestResults={}}var e=a("three"),f=(a("../enum/Viewmode"),a("../conf")),g=(a("../objects/Panorama"),a("../util/logger")),h=(a("../enum/Vectors"),a("../enum/PanoSizeClass"),a("../enum/TileDownloaderEvents")),i=a("./TilePrioritizer"),j=a("./TileUtils"),k=(a("../enum/GLCubeFaces"),a("../enum/DownloadStatus")),l=a("../util/panorama"),m=a("../util/ajax"),n=a("events").EventEmitter,o=(new g(c),Object.freeze({Testing:1,Success:2,Fail:3}));d.prototype=Object.create(n.prototype),d.IDLE_REFRESH_DELAY=500,d.ACTIVE_REFRESH_DELAY=0,d.DOWNLOAD_RETRIES=4,d.prototype.init=function(a){this.qualityManager=a},d.prototype.setUrls=function(a){this.urls=a},d.prototype.setPanoData=function(a,b,c){this.panos=a,this.imagePanos=b,this.panoGroupId=c},d.prototype.start=function(){this.refreshUpdateInterval(0)},d.prototype.stop=function(){window.cancel(this.refreshInterval)},d.prototype.refreshUpdateInterval=function(a){a||(a=0),this.refreshInterval=window.setTimeout(function(){this.update()?this.refreshUpdateInterval(d.ACTIVE_REFRESH_DELAY):this.refreshUpdateInterval(d.IDLE_REFRESH_DELAY)}.bind(this),a)},d.prototype.update=function(){var a=this.forceQueue.length>0;return this.processQueueForDownloading(this.forceQueue),this.processPriorityQueue&&(this.queuePrioritizedTilesForPanos(this.panos),this.priorityQueue.length>0&&(a=!0),this.processQueueForDownloading(this.priorityQueue)),a},d.prototype.forceQueueTilesForPano=function(){var a=[],b=[];return function(c,d,e,f,g,h){a.length=0;for(var l=this.getTileDownloadDescriptors(c,d),m=0;m<l.length;m++){var n=l[m];n.status!==k.None&&n.status!==k.Queued||a.push(n)}if(e&&a.length>0){i.sortPanoTiles(a,c,e),b.length=0,j.matchingTilesInDirection(c,d,e,f,g,b);for(var o=0,p=function(a){return a.face===q.face&&a.faceTileIndex===q.faceTileIndex};o<a.length;){var q=a[o];b.findIndex(p)<0?a.splice(o,1):o++}}for(var r=0;r<a.length;r++)this.forceQueue.push(a[r]);this.setStatusForAllDescriptors(this.forceQueue,k.ForceQueued),this.clearFromQueue(this.priorityQueue,k.ForceQueued,!1),h&&this.processQueueForDownloading(this.forceQueue,!0)}}(),d.prototype.clearForceQueue=function(){this.clearQueue(this.forceQueue)},d.prototype.queuePrioritizedTilesForPanos=function(a){this.tilePrioritizer&&(this.clearQueue(this.priorityQueue),this.tilePrioritizer.filterAndPrioritize(this.priorityQueue,a,this),this.clearFromQueue(this.priorityQueue,k.None,!0),this.setStatusOrRemoveForAllDescriptors(this.priorityQueue,k.Queued))},d.prototype.clearQueue=function(a){this.setStatusForAllDescriptors(a,k.None),a.length=0},d.prototype.clearFromQueue=function(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];e&&(b===e.status&&!c||b!==e.status&&c)&&(a[d]=null)}},d.prototype.setStatusForAllDescriptors=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];d&&(d.status=b)}},d.prototype.setStatusOrRemoveForAllDescriptors=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];d&&(d.status!==b?d.status=b:a[c]=null)}},d.prototype.getTileDownloadDescriptors=function(a,b){var c=this.getAllTileDownloadDescriptorsForPano(a),d=c[b];return d||(d=this.buildDownloadDescriptorArray(b),c[b]=d,this.initTileDownloadDescriptors(d,a,b)),d},d.prototype.getAllTileDownloadDescriptorsForPano=function(a){var b=this.downloadDescriptors[a.id];return b||(b={},this.downloadDescriptors[a.id]=b),b},d.prototype.processQueueForDownloading=function(a,b){if(this.cleanupActiveDownloads(),this.activeDownloads.length<this.concurrentDownloads||b)for(var c=b?a.length:this.concurrentDownloads-this.activeDownloads.length,d=0,e=0;d<c&&a.length>0;e++){var f=a.shift();f&&(this.startDownload(f),d++)}},d.prototype.testDownload=function(a,b,c){var d=this.downloadTestResults[a];if(d)return void(d===o.Success?c(!0):d===o.Fail&&c(!1));this.downloadTestResults[a]=o.Testing;var e=this.panos.list[0],f=this.getTileUrl(e.id,a,b,0),g=function(b){this.downloadTestResults[a]=o.Success,c(!0)}.bind(this),h=function(){this.downloadTestResults[a]=o.Fail,c(!1)}.bind(this);this.loadImage(f,0,g,h)},d.prototype.startDownload=function(a){a.status=k.Downloading;var b=this.getTileUrl(a.pano.id,a.panoSize,a.tileSize,a.tileIndex);this.activeDownloads.push(a),this.loadImage(b,d.DOWNLOAD_RETRIES,this.downloadComplete.bind(this,a),this.downloadFailed.bind(this,a))},d.prototype.downloadFailed=function(a,b){},d.prototype.downloadComplete=function(a,b){if(a.panoGroupId===this.panoGroupId){var c=this.getPanoLoadCallbacks(a.pano,a.panoSize);a.status=k.Downloaded,c&&c.onProgress&&c.onProgress(a.pano,a.panoSize);var d={panoId:a.pano.id,image:b,tileSize:a.tileSize,panoSize:a.panoSize,tileIndex:a.tileIndex,faceTileIndex:a.faceTileIndex,totalTiles:a.totalTiles,face:a.face,tileX:a.tileX,tileY:a.tileY,direction:a.direction};a.image=b,this.emit(h.TileDownloadSuccess,d),this.isPanoDownloaded(a.pano,a.panoSize)&&(d={panoId:a.pano.id,tileSize:a.tileSize,panoSize:a.panoSize},this.emit(h.PanoDownloadComplete,d),c&&c.onLoad&&c.onLoad(a.pano,a.panoSize))}},d.prototype.cleanupActiveDownloads=function(){var a=[];return function(){a.length=0;for(var b=0;b<this.activeDownloads.length;b++){var c=this.activeDownloads[b];c.status!==k.Downloaded&&c.status!==k.Failed&&a.push(c)}this.activeDownloads.length=0,this.activeDownloads.push.apply(this.activeDownloads,a)}}(),d.prototype.isPanoDownloaded=function(a,b){var c=this.getTileDownloadDescriptors(a,b);if(c.length<=0)return!1;for(var d=0;d<c.length;d++){if(c[d].status!==k.Downloaded)return!1}return!0},d.prototype.setPanoLoadCallbacks=function(a,b,c,d,e){var f=a.id+":"+this.qualityManager.getPanoSize(b);this.panoLoadCallbacks[f]={onLoad:c,onFail:d,onProgress:e}},d.prototype.getPanoLoadCallbacks=function(a,b){var c=a.id+":"+b;return this.panoLoadCallbacks[c]},d.prototype.buildDownloadDescriptorArray=function(a){for(var b=j.getTileCountForSize(a),c=[],d=0;d<b;d++){var e=this.buildDownloadDescriptor();c.push(e)}return c},d.prototype.buildDownloadDescriptor=function(){return{panoGroupId:null,pano:null,panoSize:-1,tileSize:-1,tileIndex:-1,totalTiles:-1,faceTileIndex:-1,status:k.None,url:null,image:null,direction:new e.Vector3,face:-1,cubeFace:-1,tileX:-1,tileY:-1}},d.prototype.initTileDownloadDescriptors=function(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];this.initTileDownloadDescriptor(e,b,c,d)}},d.prototype.initTileDownloadDescriptor=function(a,b,c,d){var e=c>=j.TILE_SIZE?j.TILE_SIZE:c;a.face=j.getFaceForTile(c,d),a.cubeFace=l.mapFaceToCubemapFace(a.face),a.panoGroupId=this.panoGroupId,a.pano=b,a.panoSize=c,a.tileSize=e,a.tileIndex=d,a.totalTiles=j.getTileCountForSize(c),a.status=k.None,a.image=null,j.getTileLocation(a.panoSize,a.tileIndex,a),j.getTileVector(a.panoSize,a.tileSize,a.cubeFace,a.tileX,a.tileY,j.LocationOnTile.Center,0,a.direction)},d.prototype.getTileUrl=function(){var a={256:"256",512:"512",1024:"1k",2048:"2k",4096:"4k"},b={face:-1,faceTileIndex:-1,tileX:-1,tileY:-1};return function(c,d,e,g){j.getTileLocation(d,g,b);var h=Math.floor(d/e),i=h*h,k=Math.floor(g/i),l="";return 1===f.tiling.customCompression&&(l="_"+f.tiling["q"+a[d]]),this.urls.get("multiple/"+c+"/"+a[d]+l+"_face"+k+"_"+b.tileX+"_"+b.tileY+".jpg")}}(),d.prototype.loadImage=function(a,b,c,d){m.getImage(a,b).then(c).fail(d)},b.exports=d}).call(this,"/js/tile/TileDownloader.js")},{"../conf":7,"../enum/DownloadStatus":21,"../enum/GLCubeFaces":22,"../enum/PanoSizeClass":33,"../enum/TileDownloaderEvents":45,"../enum/Vectors":50,"../enum/Viewmode":51,"../objects/Panorama":113,"../util/ajax":141,"../util/logger":153,"../util/panorama":155,"./TilePrioritizer":131,"./TileUtils":133,events:170,three:177}],131:[function(a,b,c){(function(c){"use strict";function d(a,b,c,f,g){this.qualityManager=a,this.maxNavQuality=this.qualityManager.getMaxNavPanoSize(),this.maxZoomQuality=this.qualityManager.getMaxZoomPanoSize(),this.baseSize=b,this.standardSize=c,this.highSize=f,this.ultraHighSize=g,this.priorityCriteria=new d.PriorityCriteria(null,new e.Vector3(0,0,0),new e.Vector3(0,0,-1),new e.Vector3(0,0,-1))}var e=(a("../util/browser"),a("three")),f=(a("../enum/Viewmode"),a("../conf"),a("../objects/Panorama")),g=a("../util/logger"),h=(a("../enum/Vectors"),a("../enum/PanoSizeClass"),a("../enum/ModelManagerEvents"),a("../enum/GLCubeFaces"),a("../enum/DownloadStatus")),i=(a("../util/browser"),a("./TileUtils")),j=a("../util/math"),k=(a("events").EventEmitter,new g(c),Object.freeze({None:0,DirectionalFOV:1}));d.PriorityCriteria=function(a,b,c,d,f){this.pano=a,this.cameraPosition=(new e.Vector3).copy(b),this.cameraDir=(new e.Vector3).copy(c),this.panoSpaceDir=(new e.Vector3).copy(d),this.upcomingPanos=f,this.copy=function(a){this.pano=a.pano,this.cameraPosition.copy(a.cameraPosition),this.cameraDir.copy(a.cameraDir),this.panoSpaceDir.copy(a.panoSpaceDir),this.upcomingPanos=f},this.zoomingActive=!1},d.DIRECTIONAL_FOV=60,d.DIRECTIONAL_FOV_NARROW=6,d.MAX_SCORED_PANOS_TOCONSIDER=6,d.MAX_SCORED_PANOS_TOADD=2,d.MAX_UPCOMING_PANOS_TOADD=3,d.DIRECTION_SCORE_STRICTNESS=.75,d.appendQueue=function(a,b){if(a&&b)for(var c=0;c<b.length;c++)a.push(b[c])},d.prototype.updateCriteria=function(a,b,c,d){this.priorityCriteria.pano=a,this.priorityCriteria.cameraPosition.copy(b),this.priorityCriteria.cameraDir.copy(c),this.priorityCriteria.upcomingPanos=d,this.maxNavQuality=this.qualityManager.getMaxNavPanoSize(),this.maxZoomQuality=this.qualityManager.getMaxZoomPanoSize()},d.prototype.filterAndPrioritize=function(){var a=[],b=[],c=[];return function(e,f,g){this.populateNeighborPanos(this.priorityCriteria.pano,f,a),this.populateScoredPanos(this.priorityCriteria.pano,f,b,this.priorityCriteria.cameraDir,d.MAX_SCORED_PANOS_TOCONSIDER);var h=this.baseSize,i=this.standardSize,j=this.highSize,k=this.ultraHighSize;this.queueTilesForPano(e,g,this.priorityCriteria.pano,h),this.priorityCriteria.upcomingPanos&&this.queueTilesForPanos(e,this.priorityCriteria.upcomingPanos,g,h,d.MAX_UPCOMING_PANOS_TOADD),c.length=0,this.canDownloadSize(i)&&this.queueTilesInDirectionForPano(c,g,this.priorityCriteria.pano,i,this.priorityCriteria.cameraPosition,this.priorityCriteria.cameraDir,d.DIRECTIONAL_FOV_NARROW),d.sortPanoTiles(c,this.priorityCriteria.pano,this.priorityCriteria.cameraDir),d.appendQueue(e,c),this.queueTilesForPanos(e,b,g,h,d.MAX_SCORED_PANOS_TOADD),c.length=0,this.canDownloadSize(j)&&this.queueTilesInDirectionForPano(c,g,this.priorityCriteria.pano,j,this.priorityCriteria.cameraPosition,this.priorityCriteria.cameraDir,d.DIRECTIONAL_FOV_NARROW),this.canDownloadSize(k)&&this.queueTilesInDirectionForPano(c,g,this.priorityCriteria.pano,k,this.priorityCriteria.cameraPosition,this.priorityCriteria.cameraDir,d.DIRECTIONAL_FOV_NARROW),d.sortPanoTiles(c,this.priorityCriteria.pano,this.priorityCriteria.cameraDir),d.appendQueue(e,c),c.length=0,this.canDownloadSize(i)&&this.queueTilesInDirectionForPano(c,g,this.priorityCriteria.pano,i,this.priorityCriteria.cameraPosition,this.priorityCriteria.cameraDir,d.DIRECTIONAL_FOV),this.canDownloadSize(j)&&this.queueTilesInDirectionForPano(c,g,this.priorityCriteria.pano,j,this.priorityCriteria.cameraPosition,this.priorityCriteria.cameraDir,d.DIRECTIONAL_FOV),this.canDownloadSize(k)&&this.queueTilesInDirectionForPano(c,g,this.priorityCriteria.pano,k,this.priorityCriteria.cameraPosition,this.priorityCriteria.cameraDir,d.DIRECTIONAL_FOV),d.sortPanoTiles(c,this.priorityCriteria.pano,this.priorityCriteria.cameraDir),d.appendQueue(e,c),this.queueTilesForPanos(e,a,g,h)}}(),d.prototype.canDownloadSize=function(a){return this.maxNavQuality>=a||this.maxZoomQuality>=a&&this.zoomingActive},d.prototype.populateNeighborPanos=function(a,b,c){c=c||[],c.length=0;var d=b.getNeighbours(a),e=0;for(var f in d)if(d.hasOwnProperty(f)){
var g=b.get(f);if(a.id!==g.id&&(c.push(g),1==++e))break}return c},d.prototype.populateScoredPanos=function(a,b,c,e,g){c=c||[],c.length=0;var h=[f.filters.inPanoDirection(a.position,e,d.DIRECTION_SCORE_STRICTNESS),f.filters.not(a)],i=[f.scoreFunctions.distanceSquared(a),f.scoreFunctions.direction(a.position,e)],j=b.sortByScore(h,i);if(j)for(var k=0;k<j.length&&k<g;k++){var l=j[k].pano;c.push(l)}return c},d.prototype.queueTilesForPanos=function(a,b,c,d,e){for(var f=0,g=0;g<b.length;g++){var h=b[g];if(f+=this.queueTilesForPano(a,c,h,d)>0?1:0,e&&f>=e)break}return f},d.prototype.queueTilesForPano=function(){var a={filter:k.None};return function(b,c,d,e){return this.filterAndQueueTileDownloadDescriptors(b,c,d,e,a)}}(),d.prototype.queueTilesForPanosInDirection=function(){var a=new e.Vector3;return function(b,c,d,e,f,g,h,i){for(var k=0,l=0;l<d.length;l++){var m=d[l];a.copy(m.position),a.sub(f),a.normalize();if(Math.max(Math.min(g.dot(a),1),-1)>=j.getFOVDotThreshold(h)){if(k+=this.queueTilesInDirectionForPano(b,c,m,e,f,g,h)>0?1:0,i&&k>=i)break}}return k}}(),d.prototype.queueTilesInDirectionForPanos=function(a,b,c,d,e,f,g,h){for(var i=0,j=0;j<c.length;j++){var k=c[j];if(i+=this.queueTilesInDirectionForPano(a,b,k,d,f,g)>0?1:0,h&&i>=h)break}return i},d.prototype.queueTilesInDirectionForPano=function(){var a={filter:k.DirectionalFOV,direction:new e.Vector3,fov:60},b=new e.Vector3;return function(c,d,e,f,g,h,j){return b.copy(h),i.getRelativeDirection(e.quaternion,b),a.direction.copy(b),a.fov=j,this.filterAndQueueTileDownloadDescriptors(c,d,e,f,a)}}(),d.prototype.filterAndQueueTileDownloadDescriptors=function(){var a=[];return function(b,c,d,e,f){var g=c.getTileDownloadDescriptors(d,e);a.length=0,this.filterTileDownloadDescriptors(d,g,a,f);for(var h=0,i=0;i<a.length;i++){var j=a[i];j&&(b.push(j),h++)}return h}}(),d.prototype.filterTileDownloadDescriptors=function(){return function(a,b,c,d){var e,f;switch(d.filter){case k.DirectionalFOV:for(e=0;e<b.length;e++)f=b[e],i.isTileWithinFOV(f.panoSize,f.tileSize,f.face,f.tileX,f.tileY,d.direction,d.fov)&&c.push(f);break;default:for(e=0;e<b.length;e++)f=b[e],c.push(f)}for(e=0;e<c.length;e++)f=c[e],this.canIncludeDescriptor(f)||(c[e]=null)}}(),d.prototype.canIncludeDescriptor=function(a){return a.status!==h.Downloading&&a.status!==h.Downloaded},d.prototype.canIncludePano=function(a,b){return!a.isLoaded(b)},d.getFOVDotThreshold=function(a){return Math.cos(e.Math.degToRad(a/2))};var l=function(){var a=function a(b,c){var d=a._panoSpaceDir,e=a._fovThreshold,f=a._fovThresholdNarrow,g=Math.max(Math.min(d.dot(b.direction),1),-1),h=Math.max(Math.min(d.dot(c.direction),1),-1);return b._dot=g,c._dot=h,g>=e&&h<e?-1:g<e&&h>=e?1:g>=f&&h<f?-1:g<f&&h>=f?1:b.panoSize>c.panoSize?1:c.panoSize>b.panoSize?-1:-(g-h)};return a._panoSpaceDir=new e.Vector3,a._fovThreshold=-1,a._fovThresholdNarrow=-1,a}();d.sortPanoTiles=function(a,b,c){l._panoSpaceDir.copy(c),i.getRelativeDirection(b.quaternion,l._panoSpaceDir),l._fovThresholdNarrow=j.getFOVDotThreshold(d.DIRECTIONAL_FOV_NARROW),l._fovThreshold=j.getFOVDotThreshold(d.DIRECTIONAL_FOV),a.sort(l)},d.insertSortedPanoTile=function(a,b,c,e){l._panoSpaceDir.copy(e),i.getRelativeDirection(c.quaternion,l._panoSpaceDir),l._fovThresholdNarrow=j.getFOVDotThreshold(d.DIRECTIONAL_FOV_NARROW),l._fovThreshold=j.getFOVDotThreshold(d.DIRECTIONAL_FOV);for(var f=-1,g=0;g<a.length;g++){if(l(b,a[g])<=0){f=g;break}}if(-1===f)a[a.length]=b;else{for(var h=a.length;h>f;h--)a[h]=a[h-1];a[f]=b}},d.prototype.setZoomingActive=function(a){a!==this.zoomingActive&&(this.zoomingActive=a)},b.exports=d}).call(this,"/js/tile/TilePrioritizer.js")},{"../conf":7,"../enum/DownloadStatus":21,"../enum/GLCubeFaces":22,"../enum/ModelManagerEvents":30,"../enum/PanoSizeClass":33,"../enum/Vectors":50,"../enum/Viewmode":51,"../objects/Panorama":113,"../util/browser":142,"../util/logger":153,"../util/math":154,"./TileUtils":133,events:170,three:177}],132:[function(a,b,c){"use strict";function d(a,b){this.levels=b,this.tileSize=a,this.root=null,this.allNodes=[],g(this)}function e(a,b){this.tree=a,this.parent=b,this.children=[],this.id=++l}function f(a,b,c,e,g,h,i,k){if(a){i=i||d.TraversalType.PreOrder;var l=e*j+c;if(i===d.TraversalType.PreOrder&&(g&&g(a,b,l,c,e),h&&h.push(a)),a.children&&0!==a.children.length){for(var m=e*j,n=c*j,o=0;o<j;o++)for(var p=0;p<j;p++)f(a.children[p*j+o],b+1,n+o,m+p,g,h,i,k);i===d.TraversalType.PostOrder&&(g&&g(a,b,l,c,e),h&&h.push(a))}}}function g(a){a.root=h(a,null,0)}function h(a,b,c){if(c>a.levels)return null;var d=new e(a,b);a.allNodes.push(d);for(var f=0;f<k;f++)d.children[f]=h(a,d,c+1);return d}function i(a,b,c,d,e){if(!a)return null;if(0===c)return a;if(!a.children||0===a.children.length)return null;var f=Math.pow(j,c),g=f/j,h=d%g,k=e%g,l=Math.floor(e/g),m=Math.floor(d/g),n=l*j+m;return i(a.children[n],b+1,c-1,h,k)}var j=(a("three"),a("./TileUtils"),a("../objects/Panorama"),a("../util/panorama"),a("events").EventEmitter,2),k=j*j;d.TraversalType=Object.freeze({PreOrder:0,PostOrder:1});var l=0;d.getLevelCountForSize=function(a,b){var c=0;for(b<a&&(b=a);!((b/=j)<a);)c++;return c},d.getSizeForLevel=function(a,b){return Math.pow(j,b)*a},d.prototype.getSubNode=function(a,b,c){(!b||a<this.tileSize)&&(b=0),(!c||a<this.tileSize)&&(c=0),a<this.tileSize&&(a=this.tileSize);var e=d.getLevelCountForSize(this.tileSize,a);return i(this.root,0,e,b,c)},d.prototype.breadthFirst=function(a){a=a||{};var b=!!a.nullLevelEnd,c=a.maxLevel,d=a.minLevel,e=a.callback,f=a.saveVisited,g=[],h={},i=0,j=0;for(g.push(this.root),g.push(h);g.length>0&&!(c&&i>c);){var k=g.shift();if(k===h)(!d||i>=d)&&(e&&b&&e(null),f&&b&&f.push(null)),g.length>0&&g.push(h),i++,j=0;else{if(k.children)for(var l=0;l<k.children.length;l++){var m=k.children[l];m&&g.push(k.children[l])}var n=this.getFaceIndexFromNode(k);(!d||i>=d)&&(e&&e(k,i,n),f&&f.push(k)),j++}}},d.prototype.getFaceIndexFromNode=function(a){if(!a)return-1;for(var b=1,c=a,d=0,e=0;;){var f=c.parent;if(!f)break;for(var g=-1,h=0;h<f.children.length;h++)f.children[h]===c&&(g=h);var i=g%j,k=Math.floor(g/j);d=i*b+d,e=k*b+e,b*=j,c=f}return e*b+d},d.prototype.depthFirst=function(a,b,c){f(this.root,0,0,0,a,b,c,this.tileSize)},b.exports=d},{"../objects/Panorama":113,"../util/panorama":155,"./TileUtils":133,events:170,three:177}],133:[function(a,b,c){"use strict";var d=a("../enum/GLCubeFaces"),e=a("../util/MathLight"),f={};f.TILE_SIZE=512,f.FACES_PER_PANO=6,f.LocationOnTile={Center:0,UpperLeft:1,UpperRight:2,LowerRight:3,LowerLeft:4},f.getTileVector=function(){return function(a,b,c,g,h,i,j,k){i=i||f.LocationOnTile.Center;var l=a/b,m=g/l;h=l-1-h;var n=h/l,o=b/a,p=2*o,q=p/2,r=2*m-1+q,s=2*n-1+q;switch(i){case f.LocationOnTile.UpperLeft:r-=q,s+=q,r+=j*p;break;case f.LocationOnTile.UpperRight:r+=q,s+=q,s-=j*p;break;case f.LocationOnTile.LowerRight:r+=q,s-=q,r-=j*p;break;case f.LocationOnTile.LowerLeft:r-=q,s-=q,s+=j*p;break;case f.LocationOnTile.Center:}switch(c){case d.GL_TEXTURE_CUBE_MAP_POSITIVE_X:e.setVector(k,-1,s,-r);break;case d.GL_TEXTURE_CUBE_MAP_NEGATIVE_X:e.setVector(k,1,s,r);break;case d.GL_TEXTURE_CUBE_MAP_POSITIVE_Y:e.setVector(k,-r,1,-s);break;case d.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:e.setVector(k,-r,-1,s);break;case d.GL_TEXTURE_CUBE_MAP_POSITIVE_Z:e.setVector(k,-r,s,1);break;case d.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:e.setVector(k,r,s,-1)}e.normalize(k)}}(),f.getFaceForTile=function(a,b){var c=f.TILE_SIZE;a<f.TILE_SIZE&&(c=a);var d=Math.floor(a/c),e=d*d;return Math.floor(b/e)},f.getTileLocation=function(a,b,c){var d=f.TILE_SIZE;a<f.TILE_SIZE&&(d=a);var e=f.getFaceForTile(a,b),g=Math.floor(a/d),h=g*g,i=b-e*h;c.tileX=i%g,c.tileY=Math.floor(i/g),c.face=e,c.faceTileIndex=i},f.getTileCountForSize=function(a){if(a<=f.TILE_SIZE)return f.FACES_PER_PANO;var b=Math.floor(a/f.TILE_SIZE);return b*b*f.FACES_PER_PANO},f.getRelativeDirection=function(){var a=new e.Matrix4,b=new e.Quaternion;return function(c,d){b.copy(c),b.inverse(),a.makeRotationFromQuaternion(b),a.applyToVector3(d),e.normalize(d)}}(),f.matchingTilesInDirection=function(){var a=new e.Vector3,b=new e.Vector3(0,0,-1),c=new e.Quaternion,d=function(a,b){a.push({face:b.face,faceTileIndex:b.faceTileIndex,tileX:b.tileX,tileY:b.tileY})},g=function(){var a={face:-1,faceTileIndex:-1,tileX:-1,tileY:-1};return function(b,c,e){for(var g=f.getTileCountForSize(b),h=0,i=0;i<g;i++)f.getTileLocation(b,i,a),c&&!c(a)||(h++,e&&d(e,a));return h}}();return function(d,h,i,j,k,l){var m=h<f.TILE_SIZE?h:f.TILE_SIZE;if(f.getTileCountForSize(h),!j&&!k)return g(h,null,l);var n=!!k;if(k=k||j,k=Math.max(0,Math.min(k,360)),j=Math.max(0,Math.min(j,360)),e.copyVector(i,a),f.getRelativeDirection(d.quaternion,a),n){c.setFromUnitVectors(a,b);return g(h,function(a){return f.isTileWithinFrustum(h,m,a.face,a.tileX,a.tileY,c,j,k)},l)}return g(h,function(b){return f.isTileWithinFOV(h,m,b.face,b.tileX,b.tileY,a,j)},l)}}(),f.isTileWithinFrustum=function(){var a=new e.Vector3;return function(b,c,d,g,h,i,j,k){for(var l=Math.tan(.5*k*e.RADIANS_PER_DEGREE),m=-l,n=Math.tan(.5*j*e.RADIANS_PER_DEGREE),o=-n,p=f.mapFaceToCubemapFace(d),q=0,r=0,s=0,t=0,u=0,v=0,w=f.LocationOnTile.Center;w<=f.LocationOnTile.LowerLeft;w++)if(f.getTileVector(b,c,p,g,h,w,0,a),e.applyQuaternionToVector(i,a),a.z>=-1e-5)u++;else{var x=-1/a.z,y=a.x*x,z=a.y*x;z>l?q++:z<m&&r++,y>n?s++:y<o&&t++,v++}return r!==v&&q!==v&&s!==v&&t!==v}}(),f.isTileWithinFOV=function(){var a=new e.Vector3,b=new e.Vector3(0,1,0),c=new e.Vector3(1,0,0);return function(d,g,h,i,j,k,l){var m=f.mapFaceToCubemapFace(h);if(e.cross(k,b,c),f.getTileVector(d,g,m,i,j,f.LocationOnTile.Center,0,a),f.isWithinFOV(a,k,l,null))return!0;for(var n=l/360,o=Math.floor(1/n),p=0,q=0;q<o;q++){for(var r=f.LocationOnTile.UpperLeft;r<=f.LocationOnTile.LowerLeft;r++)if(f.getTileVector(d,g,m,i,j,r,p,a),f.isWithinFOV(a,k,l,null))return!0;p+=n}return!1}}(),f.isWithinFOV=function(){var a=new e.Vector3,b=new e.Vector3;return function(c,d,f,g){if(e.copyVector(c,b),g){e.copyVector(g,a),e.normalize(a);var h=e.dot(a,c);a.x*=h,a.y*=h,a.z*=h,e.subVector(b,a)}var i=f/2*e.RADIANS_PER_DEGREE,j=Math.cos(i);return e.dot(b,d)>=j}}(),f.mapFaceToCubemapFace=function(){var a={0:d.GL_TEXTURE_CUBE_MAP_POSITIVE_Y,1:d.GL_TEXTURE_CUBE_MAP_POSITIVE_Z,2:d.GL_TEXTURE_CUBE_MAP_POSITIVE_X,3:d.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z,4:d.GL_TEXTURE_CUBE_MAP_NEGATIVE_X,5:d.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y};return function(b){return a[b]}}(),b.exports=f},{"../enum/GLCubeFaces":22,"../util/MathLight":135}],134:[function(a,b,c){(function(c){"use strict";function d(){this.list=[],this.index={},Object.defineProperty(this,"length",{get:function(){return this.list.length}})}new(a("./common"),a("./logger"))(c),d.prototype.forEach=function(a){this.list.forEach(a)},d.prototype.add=function(a){this.list.push(a),this.index[this.getIndex(a)]=a},d.prototype.getIndex=function(a){throw new Error("IndexedCollection.getIndex not implemented in subclass.")},d.prototype.extend=function(a){for(var b=0;b<a.length;b++)this.add(a[b])},d.prototype.get=function(a){return this.index[a]},d.prototype.first=function(){return this.list[0]},d.prototype.last=function(){return this.list[this.list.length-1]},d.prototype.reIndex=function(){this.index={};var a=this;this.forEach(function(b){a.index[a.getIndex(b)]=b})},d.prototype.filter=function(a){var b=this.list.filter(a);return this.reIndex(),b},d.prototype.reduce=function(a,b){return this.list.reduce(a,b)},d.prototype.sort=function(a){return this.list.sort(a)},d.prototype.indexOf=function(a){for(var b=0;b<this.list.length;++b)if(this.list[b]===a)return b;return-1},d.prototype.getLength=function(){return this.list.length},b.exports=d}).call(this,"/js/util/IndexedCollection.js")},{"./common":145,"./logger":153}],135:[function(a,b,c){"use strict";var d={};d.RADIANS_PER_DEGREE=Math.PI/180,d.DEGREES_PER_RADIAN=180/Math.PI,d.Vector3=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0},d.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("MathLight.Matrix4: the constructor no longer reads arguments. use .set() instead.")},d.Matrix4.prototype={identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(a){return this.elements.set(a.elements),this},applyToVector3:function(a){var b=a.x,c=a.y,d=a.z,e=this.elements;return a.x=e[0]*b+e[4]*c+e[8]*d+e[12],a.y=e[1]*b+e[5]*c+e[9]*d+e[13],a.z=e[2]*b+e[6]*c+e[10]*d+e[14],this},getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[1],g=d[2],h=d[3],i=d[4],j=d[5],k=d[6],l=d[7],m=d[8],n=d[9],o=d[10],p=d[11],q=d[12],r=d[13],s=d[14],t=d[15],u=n*s*l-r*o*l+r*k*p-j*s*p-n*k*t+j*o*t,v=q*o*l-m*s*l-q*k*p+i*s*p+m*k*t-i*o*t,w=m*r*l-q*n*l+q*j*p-i*r*p-m*j*t+i*n*t,x=q*n*k-m*r*k-q*j*o+i*r*o+m*j*s-i*n*s,y=e*u+f*v+g*w+h*x;if(0===y){var z="MathLight.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(z);return console.warn(z),this.identity()}var A=1/y;return c[0]=u*A,c[1]=(r*o*h-n*s*h-r*g*p+f*s*p+n*g*t-f*o*t)*A,c[2]=(j*s*h-r*k*h+r*g*l-f*s*l-j*g*t+f*k*t)*A,c[3]=(n*k*h-j*o*h-n*g*l+f*o*l+j*g*p-f*k*p)*A,c[4]=v*A,c[5]=(m*s*h-q*o*h+q*g*p-e*s*p-m*g*t+e*o*t)*A,c[6]=(q*k*h-i*s*h-q*g*l+e*s*l+i*g*t-e*k*t)*A,c[7]=(i*o*h-m*k*h+m*g*l-e*o*l-i*g*p+e*k*p)*A,c[8]=w*A,c[9]=(q*n*h-m*r*h-q*f*p+e*r*p+m*f*t-e*n*t)*A,c[10]=(i*r*h-q*j*h+q*f*l-e*r*l-i*f*t+e*j*t)*A,c[11]=(m*j*h-i*n*h-m*f*l+e*n*l+i*f*p-e*j*p)*A,c[12]=x*A,c[13]=(m*r*g-q*n*g+q*f*o-e*r*o-m*f*s+e*n*s)*A,c[14]=(q*j*g-i*r*g-q*f*k+e*r*k+i*f*s-e*j*s)*A,c[15]=(i*n*g-m*j*g+m*f*k-e*n*k-i*f*o+e*j*o)*A,this},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[4]=k-r,b[8]=l+q,b[1]=k+r,b[5]=1-(j+o),b[9]=n-p,b[2]=l-q,b[6]=n+p,b[10]=1-(j+m),b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this}},d.Quaternion=function(a,b,c,d){this._x=a||0,this._y=b||0,this._z=c||0,this._w=void 0!==d?d:1},d.Quaternion.prototype={get x(){return this._x},set x(a){this._x=a},get y(){return this._y},set y(a){this._y=a},get z(){return this._z},set z(a){this._z=a},get w(){return this._w},set w(a){this._w=a},copy:function(a){this._x=a.x,this._y=a.y,this._z=a.z,this._w=a.w},inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();return 0===a?(this._x=0,this._y=0,this._z=0,this._w=1):(a=1/a,this._x=this._x*a,this._y=this._y*a,this._z=this._z*a,this._w=this._w*a),this},setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);return this._x=a.x*d,this._y=a.y*d,this._z=a.z*d,this._w=Math.cos(c),this},setFromUnitVectors:function(){var a,b;return function(c,e){return void 0===a&&(a=new d.Vector3),b=d.dot(c,e)+1,b<1e-6?(b=0,Math.abs(c.x)>Math.abs(c.z)?d.setVector(a,-c.y,c.x,0):d.setVector(a,0,-c.z,c.y)):d.cross(c,e,a),this._x=a.x,this._y=a.y,this._z=a.z,this._w=b,this.normalize()}}(),multiply:function(a){return this.multiplyQuaternions(this,a)},premultiply:function(a){return this.multiplyQuaternions(a,this)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,i=b._z,j=b._w;return this._x=c*j+f*g+d*i-e*h,this._y=d*j+f*h+e*g-c*i,this._z=e*j+f*i+c*h-d*g,this._w=f*j-c*g-d*h-e*i,this}},d.convertWorkshopVector=function(a){return new d.Vector3(-a.x,a.y,a.z)},d.convertWorkshopQuaternion=function(a){return new d.Quaternion(-a.x,a.y,a.z,-a.w).multiply(new d.Quaternion(Math.sqrt(2)/2,Math.sqrt(2)/2,0,0))},d.convertWorkshopOrthoZoom=function(a){return-1===a?-1:a/4},d.convertWorkshopPanoramaQuaternion=function(a){return new d.Quaternion(a.x,-a.y,-a.z,a.w).normalize().multiply((new d.Quaternion).setFromAxisAngle(new d.Vector3(0,1,0),270*d.RADIANS_PER_DEGREE))},d.normalize=function(a){var b=a.x*a.x+a.y*a.y+a.z*a.z,c=Math.sqrt(b);a.x/=c,a.y/=c,a.z/=c},d.dot=function(a,b){return a.x*b.x+a.y*b.y+a.z*b.z},d.cross=function(a,b,c){var d=a.x,e=a.y,f=a.z;c.x=e*b.z-f*b.y,c.y=f*b.x-d*b.z,c.z=d*b.y-e*b.x},d.setVector=function(a,b,c,d){a.x=b,a.y=c,a.z=d},d.copyVector=function(a,b){b.x=a.x,b.y=a.y,b.z=a.z},d.addVector=function(a,b){a.x+=b.x,a.y+=b.y,a.z+=b.z},d.subVector=function(a,b){a.x-=b.x,a.y-=b.y,a.z-=b.z},d.applyQuaternionToVector=function(a,b){var c=b.x,d=b.y,e=b.z,f=a.x,g=a.y,h=a.z,i=a.w,j=i*c+g*e-h*d,k=i*d+h*c-f*e,l=i*e+f*d-g*c,m=-f*c-g*d-h*e;b.x=j*i+m*-f+k*-h-l*-g,b.y=k*i+m*-g+l*-f-j*-h,b.z=l*i+m*-h+j*-g-k*-f},d.angleBetweenVectors=function(a,b){return Math.acos(d.dot(a,b))},b.exports=d},{}],136:[function(a,b,c){function d(a,b,c){function d(a,b,c,d){var e=1/Math.tan(b/2)/c;return e=e*d/2,a*e}function h(a){if(this.moved)return void(this.moved=!1);var b=r.getMousePointCloudIntersection(a);if(b){var c=b.clone();if(t===s.INSERT){r.activeMeasurement.addMarker(c),$("#meok").show(),$("#measure-back").show();var a={type:"newpoint",position:c.clone()};r.dispatchEvent(a),r.activeMeasurement.points.length>r.activeMeasurement.maxMarkers&&r.finishInsertion(!0)}}}function i(a){if(r.activeMeasurement&&r.activeMeasurement.points){for(var b,c=r.activeMeasurement.points,d=1e5,e=-1,f=0;f<c.length;f++)b=r.activeMeasurement.points[f].distanceTo(a),d>b&&(d=b,e=f);if(console.log("len="+d+", idx="+e),d<r.checkradius)return r.cp=a.clone(),e}return-1}function j(a){if(1===a.touches.length&&(a.clientX=a.touches[0].clientX,a.clientY=a.touches[0].clientY,t!==s.DEFAULT||r.inMeasureMode)){a.stopPropagation();var b=r.getMousePointCloudIntersection(a);(this.movingpointi=i(b.clone()))>=0&&(this.startMoving=!0)}}function k(a){if(1===a.touches.length&&(a.clientX=a.touches[0].clientX,a.clientY=a.touches[0].clientY,this.startMoving&&(this.moved=!0),this.startMoving&&t===s.INSERT)){var b=r.getMousePointCloudIntersection(a);this.movingpointi>=0&&r.activeMeasurement.setPosition(this.movingpointi,b)}}function l(a){1===a.touches.length&&(a.clientX=a.touches[0].clientX,a.clientY=a.touches[0].clientY,t===s.INSERT&&(this.startMoving=!1,this.moved=!1,this.movingpointi=-1))}function m(a){if(r.isPC){var b=r.domElement.getBoundingClientRect();if(r.mouse.x=(a.clientX-b.left)/r.domElement.clientWidth*2-1,r.mouse.y=-(a.clientY-b.top)/r.domElement.clientHeight*2+1,r.dragstart){var c={type:"drag",event:a,tool:r};r.dragstart.object.dispatchEvent(c)}else if(t==s.INSERT&&r.activeMeasurement){var d=r.getMousePointCloudIntersection(a);if(d){var e=r.activeMeasurement.points.length-1;r.activeMeasurement.setPosition(e,d)}}else{var d=q();d?(d.object.dispatchEvent({type:"move",target:d.object,event:a}),r.hoveredElement&&r.hoveredElement!==d.object&&r.hoveredElement.dispatchEvent({type:"leave",target:r.hoveredElement,event:a}),r.hoveredElement=d.object):(r.hoveredElement&&r.hoveredElement.dispatchEvent({type:"leave",target:r.hoveredElement,event:a}),r.hoveredElement=null)}}}function n(a){G.m.activeMeasurement&&G.m.activeMeasurement.points&&1===G.m.activeMeasurement.points.length||r.onDoubleClick(!0)}function o(a){if(1===a.which){(t!==s.DEFAULT||r.inMeasureMode)&&a.stopImmediatePropagation();var b=q();b&&(r.dragstart={object:b.object,sceneClickPos:b.point,sceneStartPos:r.sceneRoot.position.clone(),mousePos:{x:r.mouse.x,y:r.mouse.y}},a.stopImmediatePropagation())}else 3===a.which&&n(a)}function p(a){r.dragstart&&(r.dragstart.object.dispatchEvent({type:"drop",event:a}),r.dragstart=null)}function q(){var a=new f.Vector3(r.mouse.x,r.mouse.y,.5);a.unproject(r.camera);var b=new f.Raycaster;b.ray.set(r.camera.position,a.sub(r.camera.position).normalize());for(var c=[],d=0;d<r.measurements.length;d++)for(var e=r.measurements[d],g=0;g<e.spheres.length;g++)c.push(e.spheres[g]);var h=b.intersectObjects(c,!0);return h.length>0&&h[0]}G.m=this;var r=this;this.enabled=!1,this.camera=c.camera,this.renderer=b,this.player=c,this.domElement=b.domElement,this.mouse={x:0,y:0};var s={DEFAULT:0,INSERT:1},t=s.DEFAULT;this.mode=-1,this.activeMeasurement=null,this.measurements=[],this.backupDollhouseMeasurements=[],this.backupPanoramaMeasurements=[],this.backupFloorplanMeasurements=[],this.sceneMeasurement=a,this.sceneRoot=new f.Object3D,this.sceneMeasurement.add(this.sceneRoot),this.hoveredElement=null,this.modeScale=1,this.getPointType=1,this.inMeasureMode=!1,this.isPC=null,this.movingpointi=-1;var u=this.player.modellen;this.checkradius=u<10?1.5:u>100?5:(u-10)/90*3.5+1.5,this.deletePoint=function(a){console.log("delete:"+a),r.activeMeasurement.removeMarker(a)},this.addPoint=function(a){console.log("addpoint:"+a.x+","+a.y+","+a.z),r.activeMeasurement.addMarker(a.clone());var b={type:"newpoint",position:a.clone()};r.dispatchEvent(b),r.activeMeasurement.points.length>r.activeMeasurement.maxMarkers&&r.finishInsertion(!0),this.cp=null},this.getState=function(){return t},this.onDoubleClick=function(a){t!==s.DEFAULT&&($("#meok").hide(),$("#measure-back").hide(),window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),r.activeMeasurement&&t===s.INSERT&&(e.isMobile()?r.finishInsertion():(!0!==a&&r.activeMeasurement.removeMarker(r.activeMeasurement.points.length-1),r.finishInsertion(!0)),$("#area-tool").hasClass("measure-checked")&&$("#area-tool").removeClass("measure-checked"),$("#length-tool").hasClass("measure-checked")&&$("#length-tool").removeClass("measure-checked"),$("#area-tool-m").hasClass("measure-checked")&&$("#area-tool-m").removeClass("measure-checked"),$("#length-tool-m").hasClass("measure-checked")&&$("#length-tool-m").removeClass("measure-checked")),e.isMobile()?($("#area-tool-m").click(),$("#meok").hide(),$("#measure-back").hide()):$("#area-tool").click())},this.toast=function(a){setTimeout(function(){document.getElementsByClassName("toast-wrap")[0].getElementsByClassName("toast-msg")[0].innerHTML=a;var b=document.getElementsByClassName("toast-wrap")[0];$(".toast-wrap").addClass("me"),$(".toast-msg").addClass("me"),b.className=b.className.replace("toastAnimate",""),setTimeout(function(){b.className=b.className+" toastAnimate"},10)},10)},this.getMousePointCloudIntersection=function(a){var b=this.player.getMouseOnWholeIntersect(a);if(b){var c=b.clone();return 1==this.getPointType&&(c=c.setY(this.player.model.boundingBox.max.y)),c}return null},this.startInsertion=function(a,b){t=s.INSERT;var a=a||{},c=void 0===a.showDistances||a.showDistances,d=void 0!==a.showArea&&a.showArea,e=void 0!==a.showAngles&&a.showAngles,h=void 0!==a.closed&&a.closed,i=a.maxMarkers||Number.MAX_SAFE_INTEGER,j=new g;j.showDistances=c,j.showArea=d,j.showAngles=e,j.closed=h,j.maxMarkers=i,this.addMeasurement(j,1),b&&j.addMarker(new f.Vector3(0,0,0)),this.activeMeasurement=j},this.finishInsertion=function(a,b){a&&this.activeMeasurement&&this.activeMeasurement.points&&this.activeMeasurement.points.length&&this.activeMeasurement.removeMarker(this.activeMeasurement.points.length-1,b);var c={type:"insertion_finished",measurement:this.activeMeasurement};this.dispatchEvent(c),this.activeMeasurement=null,t=s.DEFAULT},this.addMeasurement=function(a,b){if(this.sceneMeasurement.add(a),this.measurements.push(a),1==b)switch(this.mode){case 1:this.backupDollhouseMeasurements.push(a);break;case 2:this.backupPanoramaMeasurements.push(a);break;case 3:this.backupFloorplanMeasurements.push(a)}this.dispatchEvent({type:"measurement_added",measurement:a}),a.addEventListener("marker_added",function(a){r.dispatchEvent(a)}),a.addEventListener("marker_removed",function(a){r.dispatchEvent(a)}),a.addEventListener("marker_moved",function(a){r.dispatchEvent(a)})},this.removeMeasurement=function(a,b){this.sceneMeasurement.remove(a);var c=this.measurements.indexOf(a);if(c>=0&&this.measurements.splice(c,1),1==b)switch(this.mode){case 1:var c=this.backupDollhouseMeasurements.indexOf(a);c>=0&&this.backupDollhouseMeasurements.splice(c,1);break;case 2:var c=this.backupPanoramaMeasurements.indexOf(a);c>=0&&this.backupPanoramaMeasurements.splice(c,1);break;case 3:var c=this.backupFloorplanMeasurements.indexOf(a);c>=0&&this.backupFloorplanMeasurements.splice(c,1)}},this.updateMode=function(a){switch(this.mode=a,this.mode){case 1:this.getPointType=2,this.modeScale=1;break;case 2:this.getPointType=2,this.modeScale=2;break;case 3:this.getPointType=1,this.modeScale=1}},this.backup=function(){for(var a=this.measurements.length-1;a>=0;a--){var b=this.measurements[a];this.removeMeasurement(b,2)}},this.restore=function(){var a=null;switch(this.mode){case 1:a=this.backupDollhouseMeasurements;break;case 2:a=this.backupPanoramaMeasurements;break;case 3:a=this.backupFloorplanMeasurements}for(var b=a.length,c=0;c<b;c++){var d=a[c];this.addMeasurement(d,2)}},this.intoMeasureMode=function(a){this.inMeasureMode=!0,this.player.inMeasureMode=!0,this.isPC=a},this.exitMeasureMode=function(a){this.inMeasureMode=!1,this.player.inMeasureMode=!1},this.deleteAll=function(){for(var a=this.measurements.length-1;a>=0;a--){var b=this.measurements[a];this.removeMeasurement(b,1)}},this.delete=function(a){this.removeMeasurement(a,1)},this.update=function(){for(var a=[],c=0;c<this.measurements.length;c++)a.push(this.measurements[c]);this.activeMeasurement&&a.push(this.activeMeasurement);for(var c=0;c<a.length;c++){for(var e=a[c],f=0;f<e.spheres.length;f++){var g=e.spheres[f],h=r.camera.position.distanceTo(g.getWorldPosition()),i=d(1,r.camera.fov*Math.PI/180,r.player.cameras.floorplan.top,b.domElement.clientHeight),j=30*this.modeScale/i;g.scale.set(j,j,j)}for(var f=0;f<e.edgeLabels.length;f++){var k=e.edgeLabels[f],h=r.camera.position.distanceTo(k.getWorldPosition()),i=d(1,r.camera.fov*Math.PI/180,r.player.cameras.floorplan.top,b.domElement.clientHeight),j=90*this.modeScale/i;k.scale.set(j,j,j)}for(var f=0;f<e.edgeLabels.length;f++){var k=e.angleLabels[f],h=r.camera.position.distanceTo(k.getWorldPosition()),i=d(1,r.camera.fov*Math.PI/180,h,b.domElement.clientHeight),j=70/i;k.scale.set(j,j,j)}var h=r.camera.position.distanceTo(e.areaLabel.getWorldPosition()),i=d(1,r.camera.fov*Math.PI/180,r.player.cameras.floorplan.top,b.domElement.clientHeight),j=90*this.modeScale/i;e.areaLabel.scale.set(j,j,j)}},this.domElement.addEventListener("click",h.bind(this),!1),this.domElement.addEventListener("dblclick",this.onDoubleClick.bind(this),!1),this.domElement.addEventListener("mousemove",m,!1),this.domElement.addEventListener("mousedown",o,!1),this.domElement.addEventListener("mouseup",p,!0),this.domElement.addEventListener("touchmove",k.bind(this),!1),this.domElement.addEventListener("touchstart",j.bind(this),!1),this.domElement.addEventListener("touchend",l.bind(this),!1)}var e=a("./browser"),f=a("three"),g=(a("../conf"),a("../util/common"),a("../objects/Measure"));a("../objects/Panorama"),a("../enum/RenderOrder"),a("../enum/Viewmode");d.prototype=Object.create(f.EventDispatcher.prototype),b.exports=d},{"../conf":7,"../enum/RenderOrder":39,"../enum/Viewmode":51,"../objects/Measure":111,"../objects/Panorama":113,"../util/common":145,"./browser":142,three:177}],137:[function(a,b,c){(function(c){"use strict";function d(a){this.cache=null,this.expires=0}function e(){this.baseUrl=null,this.cache=null,this.expires=0}function f(){this.baseUrl=null,this.expires=0}function g(a){this.initialLoadingPromise=null,this.endpoint=a+"?type=3",this.urlContainer=null,this.authorizationHeader=k.getAuthorizationHeader(),this.containerClasses=[f,e,d]}var h=a("./ajax"),i=a("./logger"),j=a("../constants"),k=a("./showcase"),l=new i(c);d.prototype={version:1,validate:function(a){return"catalog.json"in a&&Object.keys(a).length>0},update:function(a){return this.cache=a,this.expires=Date.now()+j.signedUrlDefaultExpireTime,$.when()},get:function(a){return this.cache[a]}},e.prototype={version:2,validate:function(a){return"catalog.json"in a&&"base.url"in a&&Object.keys(a).length>1},update:function(a){return this.baseUrl=a["base.url"],this.cache=a,this.expires=Date.now()+j.signedUrlDefaultExpireTime,$.when()},get:function(a){var b=this.cache[a];return b?this.baseUrl.replace("{{filename}}",a)+b:null}},f.prototype={version:3,validate:function(a){return!0},update:function(a){return this.baseUrl=a.locationpics,a.expires?this.expires=1e3*a.expires:this.expires=Date.now()+j.signedUrlDefaultExpireTime,$.when()},get:function(a){return this.baseUrl.replace("{{filename}}",a)}},g.prototype={init:function(){return this.initialLoadingPromise?this.initialLoadingPromise:(setInterval(function(){}.bind(this),j.signedUrlCheckInterval),this.initialLoadingPromise=this.refresh(),this.initialLoadingPromise)},refresh:function(a){a=a||{};var b=void 0===a.cache||a.cache;return h.get(this.endpoint,{responseType:"json",prefetchFrom:b?"basic":null,cache:b,auth:this.authorizationHeader}).then(function(a){if(this.urlContainer&&this.urlContainer.validate(a))return this.urlContainer.update(a);for(var c=0;c<this.containerClasses.length;c++){var d=this.containerClasses[c],e=new d;if(e.validate(a))return l.info("Using urls version "+e.version),this.urlContainer=e,this.urlContainer.update(a)}return b?this.refresh({cache:!1}):$.Deferred().reject("missing-urls")}.bind(this),function(a){return"loading-failed"})},get:function(a){return G.url.model+"/"+a}},b.exports=g}).call(this,"/js/util/ModelUrls.js")},{"../constants":8,"./ajax":141,"./logger":153,"./showcase":156}],138:[function(a,b,c){(function(c){"use strict";function d(){l.call(this),this.neighbourMap={},this.map=null}var e=a("three"),f=a("./common"),g=a("../conf"),h=a("../objects/Panorama"),i=a("./aStar"),j=a("./logger"),k=new j(c),l=a("./IndexedCollection"),m=a("./transitions");f.inherit(d,l),d.prototype.getIndex=function(a){return a.id},d.prototype.find=function(a,b){var c=f.filterAll(this.list,a);if(c.length>0)return b&&b.forEach(function(a){c=f.stableSort(c,a)}),c[0]},d.prototype.sortByScore=function(a,b){var c=f.filterAll(this.list,a);return c.length>0?c=c.map(function(a){return{pano:a,score:b.reduce(function(b,c){return b+c(a)},0)}}).sort(function(a,b){return b.score-a.score}):null},d.prototype.lowestByScore=function(a,b,c){return this.findRankedByScore(0,a,b,c)},d.prototype.findRankedByScore=function(a,b,c,d){d&&(d.candidates=null,d.pano=null),a||(a=0);var e=this.sortByScore(b,c);return e&&0!==e.length&&a<e.length?(d&&(d.candidates=e,d.pano=e[a].pano),e[a].pano):null},d.prototype.showPanoScores=function(a){this.list.forEach(function(a){a.removeTextSprite()});var b=6344768;a.forEach(function(a){a.pano.addTextSprite(a.score.toFixed(2),b),b=16428055})},d.prototype.isNeighbour=function(a,b){return this.neighbourMap[a.id][b.id]},d.prototype.getNeighbours=function(a){return this.neighbourMap[a.id]},d.prototype.setNeighbour=function(a,b,c){return this.neighbourMap[a.id]||(this.neighbourMap[a.id]={}),this.neighbourMap[b.id]||(this.neighbourMap[b.id]={}),this.neighbourMap[a.id][a.id]=!0,this.neighbourMap[b.id][b.id]=!0,this.neighbourMap[a.id][b.id]=c,this.neighbourMap[b.id][a.id]=c,this.neighbourMap[a.id]},d.prototype.findClosest=function(a,b){var c=[h.filters.isPanoAligned()];return b&&c.push(h.filters.inDirection(a,b,.75)),this.find(c,[h.sortFunctions.distanceToPoint(a)])},d.prototype.dualNeighbors=function(a,b){var c,d=[];for(c in this.neighbourMap[a.id])this.neighbourMap[b.id][c]&&d.push(c);return d},d.prototype.populate_path_graph=function(){var a,b,c,d,f,g,h,i,j=Date.now(),l={},m=0,n=new e.Vector3(0,0,0);for(a=0;a<this.list.length;a++){f=this.list[a],h={},i=!1,c=f.neighbourPanos||f.findNeighourPanos();for(b in c)if(c[b]){g=this.index[b],n.copy(f.floorPosition),n.sub(g.floorPosition);var o=Math.sqrt(n.x*n.x+n.z*n.z),p=(Math.abs(n.y),Math.max(o,.01),Math.max(0,Math.abs(n.y)-.2));p>0?(p=Math.pow(4*p,2),o=Math.pow(o,2),d=Math.sqrt(p*p+o*o)):d=n.length(),h[g.id]=d,i=!0}i?l[f.id]=h:m+=1}this.map=l,k.info("graph ready in "+(Date.now()-j)+"ms, "+m+" had no neighbors")},d.prototype.aStarSearch=function(a,b){var c=Date.now(),d=new i({start:a,isEnd:function(a){return a===b},neighbor:function(a){var b=a.neighbourPanos||a.findNeighourPanos(),c=[];for(var d in b)c.push(this.index[d]);return c}.bind(this),distance:function(a,b){return this.map[a.id][b.id]}.bind(this),heuristic:function(a,b){return 1}.bind(this),hash:function(a){
return a.id},timeout:5e3});if(k.debug("A* search in "+(Date.now()-c)+"ms"),"success"!==d.status)return k.debug("Did not find A* path from "+a+" to "+b),null;k.debug("Total cost "+d.cost.toPrecision(3)+", "+d.path.length+" steps");var e=[];return d.path.forEach(function(a){e.push(a.id)}),e},d.prototype.includeNodesNearPath=function(){var a=new e.Vector3,b=new e.Vector3,c=new e.Vector3,d=new e.Vector3,f=new e.Vector3,g=new e.Vector3,h=new e.Vector3,i=new e.Vector3,j=[],k=new e.Vector3,l=new e.Vector3;return function(e,m){if(e)for(var n=function(a,b,c){return f.copy(b).sub(a),f.dot(c)},o=function(a,b){return n(k,a.position,c)-n(k,b.position,c)},p=0;p<e.length-1;){var q=e[p],r=e[p+1],s=this.index[q],t=this.index[r];k.copy(s.position),l.copy(t.position),j.length=0,a.copy(l).sub(k),c.copy(a).normalize();for(var u=0;u<this.list.length;u++){var v=this.list[u];f.copy(v.position).sub(k);var w=f.dot(c);if(w>0){h.copy(c),h.multiplyScalar(w),g.copy(f),g.sub(h);var x=g.length();if(x<m){b.copy(a).negate(),d.copy(b).normalize(),i.copy(v.position).sub(l);var y=i.dot(d);y>0&&j.push(v)}}}if(j.length>0){j.sort(o);for(var z=e.length+j.length-1;z>=p+j.length;z--)e[z]=e[z-j.length];for(var A=0;A<j.length;A++)e[A+p+1]=j[A].id}p+=j.length+1}}}(),d.prototype.fadeMarkerOpacity=function(a,b){var c=void 0===a?g.panorama.markerOpacity:a,d=this.list.findIndex(function(a){return a.marker});if(d>=0){var e=this.list[d].marker.material.opacity;if(e!==a){var f=c-e;m.trigger({func:function(a,b){var c=e+a*f;this.forEach(function(a){a.marker&&(a.marker.material.opacity=c)})}.bind(this),duration:void 0===b?g.markerOpacityTransitionTime:b,name:"_fpm"})}}},d.prototype.update=function(a){this.forEach(function(b){b.update(a)})},b.exports=d}).call(this,"/js/util/PanoramaCollection.js")},{"../conf":7,"../objects/Panorama":113,"./IndexedCollection":134,"./aStar":140,"./common":145,"./logger":153,"./transitions":162,three:177}],139:[function(a,b,c){function d(){this.actionSequence=[],this.actionSequenceInProgress=!1}d.prototype.reset=function(a){this.actionSequenceInProgress=!1,this.actionSequence.length=0},d.prototype.addZoomAction=function(){var a=null,b=null,c=!1,d=function(){if(a=null,this.actionSequence.length>0){this.actionSequence[0].start,this.actionSequence[this.actionSequence.length-1].end}this.reset()};return function(e,f,g){if(e!==f){c||(d=d.bind(this),c=!0),a&&(window.clearTimeout(a),a=null),g===b&&this.actionSequenceInProgress||(this.reset(),b=g),this.actionSequenceInProgress=!0;var h={start:e,end:f};this.actionSequence.push(h),a=window.setTimeout(d,150)}}}(),b.exports=d},{}],140:[function(a,b,c){"use strict";function d(a){void 0===a.timeout&&(a.timeout=1/0);var b=a.hash||f,c={data:a.start,g:0,h:a.heuristic(a.start)},d=c;c.f=c.h;var k=new h,l=new i(g),m=j();l.push(c),m.set(b(c.data),c);for(var n=new Date;l.size();){if(new Date-n>a.timeout)return{status:"timeout",cost:d.g,path:e(d)};var o=l.pop();if(m.delete(b(o.data)),a.isEnd(o.data)){var p=e(o);return{status:"success",cost:o.g,path:p}}k.add(b(o.data));for(var q=a.neighbor(o.data),r=0;r<q.length;r++){var s=q[r];if(!k.contains(b(s))){var t=o.g+a.distance(o.data,s),u=m.get(b(s)),v=!1;if(void 0===u)u={data:s},m.set(b(s),u);else{if(u.g<t)continue;v=!0}u.parent=o,u.g=t,u.h=a.heuristic(s),u.f=t+u.h,u.h<d.h&&(d=u),v?l.heapify():l.push(u)}}}return{status:"noPath",cost:d.g,path:e(d)}}function e(a){if(void 0!==a.parent){var b=e(a.parent);return b.push(a.data),b}return[a.data]}function f(a){return a.toString()}function g(a,b){return a.f-b.f}var h=a("Set"),i=a("heap"),j=a("dict");b.exports=d},{Set:164,dict:169,heap:171}],141:[function(a,b,c){(function(c){"use strict";function d(a,b,c){var d=new XMLHttpRequest;if(c&&"withCredentials"in d)d.open(a,b,c);else if("undefined"!=typeof XDomainRequest)d=new XDomainRequest,d.open(a,b);else{if(c)throw"Browser does not support CORS!";d.open(a,b)}return d}function e(a,b,c){function f(){j.warn("Retrying ",b),e(a,b,c).done(i.resolve.bind(i)).progress(i.notify.bind(i)).fail(i.reject.bind(i))}function g(a,b){var c=a.response;if("json"===b&&"object"!=typeof c)try{c=JSON.parse(a.responseText)}catch(a){return void i.reject({error:"Failed parsing JSON"})}else if("image/jpeg"===b){var d=new Uint8Array(a.response),e=new Blob([d],{type:"image/jpeg"}),f=URL.createObjectURL(e);c=new Image,c.src=f,c.crossOrigin="Anonymous",c.onload=function(){URL.revokeObjectURL(f)}}return c}var h=d(a,b,!1);if(c=c||{},c.retries=void 0!==c.retries?c.retries:0,c.retry=void 0!==c.retry?c.retry:"get"===a.toLowerCase(),c.responseType)if(["arraybuffer","text","json"].indexOf(c.responseType)>-1)h.responseType=c.responseType;else{if("image/jpeg"!==c.responseType)throw new Error('reponseType can only be one of "arraybuffer", "text" or "json", "image/jpeg"');h.responseType="arraybuffer"}"json"===c.responseType&&h.setRequestHeader("Accept","application/json"),c.auth&&h.setRequestHeader("Authorization",c.auth),"object"==typeof c.data&&(c.data=JSON.stringify(c.data),h.setRequestHeader("Content-Type","application/json"));var i=$.Deferred();return h.onreadystatechange=function(a){if(4==this.readyState)if(this.status>=500&&this.status<=600&&c.retry&&c.retries<3)c.retries++,setTimeout(f,1e3);else if(200==this.status){var b=g(this,c.responseType);i.resolve(b)}else i.reject(this)},h.onprogress=function(a){i.notify(a)},h.send(c.data),i.promise()}function f(a){return window.REQUEST_CACHE?window.REQUEST_CACHE[a]:null}function g(a,b){window.REQUEST_CACHE&&(window.REQUEST_CACHE[a]=b)}function h(a,b,c){function d(c){j.warn("Retrying ",a),h(a,b-1,c)}c=c||$.Deferred();var e=new Image;return null!==b&&void 0!==b||(b=3),e.onerror=function(){e=null,b>0?setTimeout(d,1e3,c):c.reject()},e.onload=function(){c.resolve(e)},e.crossOrigin="anonymous",e.src=a,c}var i=a("./logger"),j=new i(c);window.URL=window.URL||window.webkitURL,window.REQUEST_CACHE=window.REQUEST_CACHE||{},G.basic=window.PREFETCHED_MODELDATA,window.PREFETCHED_MODELDATA=window.PREFETCHED_MODELDATA||{},setTimeout(function(){window.REQUEST_CACHE=null,window.PREFETCHED_MODELDATA={}},6e4),window.onpageshow=function(a){a.persisted&&(window.REQUEST_CACHE=null,window.PREFETCHED_MODELDATA={})},b.exports={get:function(a,b){b=b||{};var c=void 0===b.cache||b.cache;if(c){var d=f(a);if(d)return d}var h,c=b.fetchNum;return h=1===b.fetchNum&&b.prefetchFrom&&window.PREFETCHED_MODELDATA[b.prefetchFrom]?$.when(window.PREFETCHED_MODELDATA[b.prefetchFrom]):2===b.fetchNum&&b.prefetchFrom&&window.PREFETCHED_MODELDATA[b.prefetchFrom][b.prefetchFrom2]?$.when(window.PREFETCHED_MODELDATA[b.prefetchFrom][b.prefetchFrom2]):3===b.fetchNum&&b.prefetchFrom&&window.PREFETCHED_MODELDATA[b.prefetchFrom][b.prefetchFrom2][b.prefetchFrom3]?$.when(window.PREFETCHED_MODELDATA[b.prefetchFrom][b.prefetchFrom2][b.prefetchFrom3]):e("GET",a,b),c&&g(a,h),h},post:function(a,b){return e("POST",a,b)},patch:function(a,b){return e("PATCH",a,b)},getImage:h}}).call(this,"/js/util/ajax.js")},{"./logger":153}],142:[function(a,b,c){"use strict";function d(a,b){var c=window.navigator.userAgent,d=c.match(a);return d=d?d[1].split(b):[],{major:parseInt(d[0])||0,minor:parseInt(d[1])||0,patch:parseInt(d[2])||0}}var e=a("../exception/DeviceMismatchException");b.exports={isFullscreen:function(){return document.fullscreenElement||document.mozFullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},supportsFullscreen:function(){return document.fullscreenEnabled||document.mozFullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled},isPointerLocked:function(){return document.pointerLockElement||document.mozPointerLockElement||document.webkitPointerLockElement},requestFullscreen:function(a,b){a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):a.msRequestFullscreen&&a.msRequestFullscreen(),b&&$(document).on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",browser.requestPointerLock)},requestPointerLock:function(){var a;if(document.fullscreenElement)a=document.fullscreenElement();else if(document.mozFullscreenElement)a=document.mozFullscreenElement();else if(document.mozFullScreenElement)a=document.mozFullScreenElement();else{if(!document.webkitFullscreenElement)return;a=document.webkitFullscreenElement()}a.requestPointerLock=a.requestPointerLock||a.mozRequestPointerLock||a.webkitRequestPointerLock,a.requestPointerLock(),$(document).off("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",this)},exitPointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,document.exitPointerLock()},exitFullscreen:function(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()},details:function(){var a=navigator.userAgent.match("(Firefox|Chrome|Safari)/([\\d]+)");return a?{name:a[1],version:parseInt(a[2]),platform:navigator.platform}:{}},is:function(a){return this.details()&&this.details().name===a},inIframe:function(){return window.parent!==window},aspectRatio:function(){var a=window.innerWidth/window.innerHeight;return isFinite(a)?a:0},userAgent:function(){return window.navigator.userAgent},isMobile:function(){var a=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))},isWeixin:function(){return"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)},isSmallScreen:function(){return screen.width/window.devicePixelRatio<240},detectIE:function(){return-1!==window.navigator.userAgent.indexOf("MSIE ")||!!navigator.userAgent.match(/Trident.*rv\:11\./)},detectSafari:function(){return-1!==window.navigator.userAgent.indexOf("Safari")&&!this.detectChrome()},detectFirefox:function(){return-1!==window.navigator.userAgent.indexOf("Firefox")},detectChrome:function(){return-1!==window.navigator.userAgent.indexOf("Chrome")&&!this.detectOpera()},detectOpera:function(){return-1!==window.navigator.userAgent.indexOf("OPR")},detectIOS:function(){return/iPad|iPhone|iPod/.test(window.navigator.userAgent)},detectAndroid:function(){return-1!==window.navigator.userAgent.indexOf("Android")},detectAndroidMobile:function(){var a=window.navigator.userAgent;return this.detectAndroid()&&-1!==a.indexOf("Mobile")},detectSamsungNative:function(){var a=window.navigator.userAgent;return-1!==a.indexOf("SM-G900H")||-1!==a.indexOf("GT-I9500")||-1!==a.indexOf("SM-N900")},detectSamsungS6:function(){return-1!==window.navigator.userAgent.indexOf("SM-G92")},detectHUAWEI5X:function(){return-1!==window.navigator.userAgent.indexOf("KIW-TL00H")},iosVersion:function(){if(!this.detectIOS())throw new e("Did not detect an iDevice");return d(/((?:\d+\_?){1,3}) like Mac OS/,"_")},androidVersion:function(){if(!this.detectAndroid())throw new e("Did not detect an Android based device");return d(/Android ((?:\d+\.?){1,3})/,".")},valueFromCookie:function(a,b){var c=new RegExp(a+"=([0-9a-f]+)(; ?|$)").exec(document.cookie);if(!c)return b;var d=c[1];return"boolean"==typeof b?"true"===d||"1"===d:"number"==typeof b?parseFloat(d):d},valueFromHash:function(a,b){var c=new RegExp("[#&?]"+a+"=([^#&?]*)"),d=c.exec(window.location.href);if(!d)return b;var e=d[1];return"boolean"==typeof b?"true"===e||"1"===e:"number"==typeof b?parseFloat(e):window.decodeURIComponent(e)},getAllValueFromSearch:function(){var a=window.location.search,b={};if(-1!==a.indexOf("?"))for(var c=a.substr(1),d=c.split("&"),e="",f=0;f<d.length;f++)e=d[f].split("="),b[e[0]]=unescape(e[1]);return b},getQueryString:function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i"),c=window.location.search.substr(1).match(b);return null!=c?decodeURI(c[2]):null},getUuid:function(){function a(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},isIe:{versions:function(){var a=navigator.userAgent;navigator.appVersion;return{trident:a.indexOf("Trident")>-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()},isEdge:{versions:function(){var a=navigator.userAgent;navigator.appVersion;return{Edge:a.indexOf("Edge")>-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()}}},{"../exception/DeviceMismatchException":55}],143:[function(a,b,c){(function(c){"use strict";function d(a,b,c,d){var i={};if(d||(i=e(b)),""!=(i=f(a))&&i.enable){var k=i.location_id,l=i.rotation,n=b.list.length;if(1==i.type){i.mode=o.PANORAMA;for(var c=0;c<n;c++)b.list[c].id==k&&(i.pano=b.list[c],i.position=i.pano.position,i.quaternion=l);return i.quaternion&&(i.quaternion=m.convertWorkshopQuaternion(i.quaternion)),i}for(var c=0;c<n;c++)b.list[c].id==k&&(i.pano=b.list[c],i.position=i.pano.position,i.quaternion=i.pano.quaternion);return i}var p=g();if(""!=p){var k=p,n=b.list.length;i.mode=o.PANORAMA;for(var c=0;c<n;c++)b.list[c].id==k&&(i.pano=b.list[c],i.position=i.pano.position,i.quaternion=i.pano.quaternion);return i.quaternion&&(i.quaternion=m.convertWorkshopQuaternion(i.quaternion)),i}var r=a.data.camera_start;if(r)try{h(r),Object.keys(r).length>0&&0===Object.keys(i).length&&(i.mode=o.convertWorkshopModeInt(r.mode),i.position=r.camera.position,i.quaternion=r.camera.quaternion,i.zoom=m.convertWorkshopOrthoZoom(r.camera.zoom),r.pano&&(i.pano=b.get(r.pano.locationid),q.debug("Using camera_start"),q.debug("Modeldata pano: ",i.pano.quaternion),q.debug("Camera start pano: ",r.pano.quaternion)),i.mode!==o.PANORAMA&&(i.floorVisibility=a.heroImage._camera.floor_visibility))}catch(a){q.warn(a.message)}if(0===Object.keys(i).length&&(i=j(a,b)),a.outsideAllowed()||i.mode===o.PANORAMA||(i={}),0===Object.keys(i).length){var c;for(c=0;c<b.list.length&&1!=b.list[c].alignmentType;c++);i.pano=b.list[c],i.position=i.pano.position,i.quaternion=i.pano.quaternion,q.info("Starting at 1st pano "+i.pano.id)}return i.mode=i.mode||o.PANORAMA,i.pano||(q.debug("No pano selected, choosing the closest one to player location"),i.pano=b.findClosest(i.position||c)),i.mode===o.MESH&&(i.mode=o.PANORAMA,i.position=i.pano?i.pano.position:c),i}function e(a){var b=n.valueFromHash("start",""),c={};return""!==b&&(q.debug("Start override found in parameters, trying to parse..."),c=k(b)||{},c.tag=n.valueFromHash("tag",null),c.panoId&&(c.pano=a.get(c.panoId))),c}function f(a){var b=n.valueFromHash("o",""),c={};if(""!==b){var d=a.data.orientations;if(null!=d&&void 0!=d)for(var e=d.length,c=0;c<e;c++)if(d[c].key==b)return d[c]}return c}function g(){return n.valueFromHash("l","")}function h(a){a.camera&&(a.camera.quaternion=i(a.camera.quaternion)),a.pano&&(a.pano.quaternion=i(a.pano.quaternion))}function i(a){return a=a||new THREE.Quaternion,0===Math.abs(a.x)&&0===Math.abs(a.y)&&0===Math.abs(a.z)&&0===Math.abs(a.w)&&(a.w=1),a}function j(a,b){if(!a.heroImage||!a.heroImage._camera._viewpoint)return{};var c={},d=a.heroImage._camera;q.debug("Using start position from thumbnail image"),c.position=d._viewpoint,c.quaternion=d._rotation;try{c.mode=o.convertWorkshopModeInt(d._type),c.mode===o.PANORAMA?c.pano=b.get(d._locationid):c.floorVisibility=d.floor_visibility}catch(a){q.debug(a.message)}return c}function k(a){return l.deserialize(a)}var l=a("../controls/serializer"),m=a("../util/math"),n=a("./browser"),o=a("../enum/Viewmode"),p=a("../util/logger"),q=new p(c);b.exports={optionsFromString:k,getStartCameraOptions:d}}).call(this,"/js/util/camera.js")},{"../controls/serializer":13,"../enum/Viewmode":51,"../util/logger":153,"../util/math":154,"./browser":142}],144:[function(a,b,c){"use strict";function d(a,b,c){return f(a.fov,b,c)}var e=a("./MathLight"),f=function(a,b,c){var d=b,f=c;return 2*Math.atan(Math.tan(a*e.RADIANS_PER_DEGREE/2)*(d/f))*e.DEGREES_PER_RADIAN};b.exports={getHFOVForCamera:d,getHFOVFromVFov:f}},{"./MathLight":135}],145:[function(a,b,c){"use strict";var d=a("three");b.exports={normalizeUrl:function(a){return a.replace("https://","http://")},domainFromUrl:function(a){var b=/^([^:]*:\/\/)?(www\.)?([^\/]+)/.exec(a);return b?b[3]:a},average:function(a,b){if(0===a.length)return null;for(var c=0,d=0,e=0;e<a.length;e++){c+=b?a[e][b]:a[e],d++}return c/d},countUnique:function(a){for(var b={},c=0;c<a.length;c++)b[a[c]]=1+(b[a[c]]||0);return Object.keys(b).length},averageVectors:function(a,b){var c=new d.Vector3;if(0===a.length)return c;for(var e=0,f=0;f<a.length;f++){var g=b?a[f][b]:a[f];c.add(g),e++}return c.divideScalar(e)},equalLists:function(a,b){if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0},lowerMedian:function(a,b){return 0===a.length?null:(b=b||2,a.sort(function(a,b){return a-b}),a[Math.floor(a.length/b)])},stableSort:function(a,b){return a.map(function(a,b){return{value:a,index:b}}).sort(function(a,c){var d=b(a.value,c.value);return 0!==d?d:a.index-c.index}).map(function(a){return a.value})},filterAll:function(a,b){return a.filter(function(a){return b.every(function(b){return b(a)})})},formatDate:function(a){return[a.getFullYear(),a.getMonth()+1,a.getDate()].join("-")},formatDatetime:function(a){return[a.getFullYear(),a.getMonth()+1,a.getDate(),a.getHours(),a.getMinutes()].join("-")},randomString:function(a){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;d<a;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b},nth:function(a){return a%=10,1==a?a+"st":2==a?a+"nd":3==a?a+"rd":a+"th"},extendObject:function(a,b){return Object.keys(b).forEach(function(c){a[c]=b[c]}),a},deepExtend:function a(b){b=b||{};for(var c=1;c<arguments.length;c++){var d=arguments[c];if(d)for(var e in d)d.hasOwnProperty(e)&&("object"==typeof d[e]?b[e]=a(b[e],d[e]):b[e]=d[e])}return b},inherit:function(a,b){a.prototype=Object.create(b.prototype),a.prototype.constructor=a},extend:function(a,b){for(var c in b.prototype)a.prototype[c]=b.prototype[c]},convertWorldPositionToScreen:function(a,b){var c=new d.Vector3;c.copy(a);var e=c.project(b);window.innerWidth,window.innerHeight;return{x:(e.x+1)*window.innerWidth/2,y:(1-e.y)*window.innerHeight/2}}},Math.sign=function(a){return a<0?-1:1}},{three:177}],146:[function(a,b,c){b.exports={getId:function(){var a=function(){for(var a=[],b="0123456789abcdef",c=0;c<36;c++)a[c]=b.substr(Math.floor(16*Math.random()),1);return a[14]="4",a[19]=b.substr(3&a[19]|8,1),a[8]=a[13]=a[18]=a[23]="-",a.join("")}(),b=new Date;b.setTime(b.getTime()+2592e8);var c=function(a){for(var b=document.cookie,c=b.split("; "),d=0;d<c.length;d++){var e=c[d].split("="),f=e[0],g=e[1];if(f===a)return g}return!1}("nest_cookie");return c||(function(a,b,c,d,e,f){document.cookie=a+"="+b+(c?"; expires="+c:"")+(d?"; path="+d:"")+(e?"; domain="+e:"")+(f?"; secure="+f:"")}("nest_cookie",a,b.toGMTString(),"/","",""),a)},getOauth:function(a){for(var b=document.cookie,c=b.split("; "),d=0;d<c.length;d++){var e=c[d].split("="),f=e[0],g=e[1];if(f===a)return g}return!1},setWeixin:function(a,b,c,d,e,f){var g=new Date;g.setTime(g.getTime()+2592e8),document.cookie=a+"="+b+(c?"; expires="+g.toGMTString():"")+(d?"; path="+d:"")+(e?"; domain="+e:"")+(f?"; secure="+f:"")}}},{}],147:[function(a,b,c){"use strict";var d={};d.linearTween=function(a,b,c,d){return c*a/d+b},d.easeInQuad=function(a,b,c,d){return a/=d,c*a*a+b},d.easeOutQuad=function(a,b,c,d){return a/=d,-c*a*(a-2)+b},d.easeInOutQuad=function(a,b,c,d){return a/=d/2,a<1?c/2*a*a+b:(a--,-c/2*(a*(a-2)-1)+b)},d.easeInCubic=function(a,b,c,d){return a/=d,c*a*a*a+b},d.easeOutCubic=function(a,b,c,d){return a/=d,a--,c*(a*a*a+1)+b},d.easeInOutCubic=function(a,b,c,d){return a/=d/2,a<1?c/2*a*a*a+b:(a-=2,c/2*(a*a*a+2)+b)},d.easeInQuart=function(a,b,c,d){return a/=d,c*a*a*a*a+b},d.easeOutQuart=function(a,b,c,d){return a/=d,a--,-c*(a*a*a*a-1)+b},d.easeInOutQuart=function(a,b,c,d){return a/=d/2,a<1?c/2*a*a*a*a+b:(a-=2,-c/2*(a*a*a*a-2)+b)},d.easeInQuint=function(a,b,c,d){return a/=d,c*a*a*a*a*a+b},d.easeOutQuint=function(a,b,c,d){return a/=d,a--,c*(a*a*a*a*a+1)+b},d.easeInOutQuint=function(a,b,c,d){return a/=d/2,a<1?c/2*a*a*a*a*a+b:(a-=2,c/2*(a*a*a*a*a+2)+b)},d.easeInSine=function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},d.easeOutSine=function(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b},d.easeInOutSine=function(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b},d.easeInExpo=function(a,b,c,d){return c*Math.pow(2,10*(a/d-1))+b},d.easeOutExpo=function(a,b,c,d){return c*(1-Math.pow(2,-10*a/d))+b},d.easeInOutExpo=function(a,b,c,d){return a/=d/2,a<1?c/2*Math.pow(2,10*(a-1))+b:(a--,c/2*(2-Math.pow(2,-10*a))+b)},d.easeInCirc=function(a,b,c,d){return a/=d,-c*(Math.sqrt(1-a*a)-1)+b},d.easeOutCirc=function(a,b,c,d){return a/=d,a--,c*Math.sqrt(1-a*a)+b},d.easeInOutCirc=function(a,b,c,d){return a/=d/2,a<1?-c/2*(Math.sqrt(1-a*a)-1)+b:(a-=2,c/2*(Math.sqrt(1-a*a)+1)+b)},d.easeInElastic=function(a,b,c,d){var e=1.70158,f=0,g=c;return 0===a?b:1==(a/=d)?b+c:(f||(f=.3*d),g<Math.abs(c)?(g=c,e=f/4):e=f/(2*Math.PI)*Math.asin(c/g),-g*Math.pow(2,10*(a-=1))*Math.sin((a*d-e)*(2*Math.PI)/f)+b)},d.easeOutElastic=function(a,b,c,d){var e=1.70158,f=0,g=c;return 0===a?b:1==(a/=d)?b+c:(f||(f=.3*d),g<Math.abs(c)?(g=c,e=f/4):e=f/(2*Math.PI)*Math.asin(c/g),g*Math.pow(2,-10*a)*Math.sin((a*d-e)*(2*Math.PI)/f)+c+b)},d.easeInOutElastic=function(a,b,c,d){var e=1.70158,f=0,g=c;return 0===a?b:2==(a/=d/2)?b+c:(f||(f=d*(.3*1.5)),g<Math.abs(c)?(g=c,e=f/4):e=f/(2*Math.PI)*Math.asin(c/g),a<1?g*Math.pow(2,10*(a-=1))*Math.sin((a*d-e)*(2*Math.PI)/f)*-.5+b:g*Math.pow(2,-10*(a-=1))*Math.sin((a*d-e)*(2*Math.PI)/f)*.5+c+b)},d.easeInBack=function(a,b,c,d,e){return void 0===e&&(e=1.70158),c*(a/=d)*a*((e+1)*a-e)+b},d.easeOutBack=function(a,b,c,d,e){return void 0===e&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},d.easeInOutBack=function(a,b,c,d,e){return void 0===e&&(e=1.70158),(a/=d/2)<1?c/2*(a*a*((1+(e*=1.525))*a-e))+b:c/2*((a-=2)*a*((1+(e*=1.525))*a+e)+2)+b},d.easeOutBounce=function(a,b,c,d){return(a/=d)<1/2.75?c*(7.5625*a*a)+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},d.easeInBounce=function(a,b,c,d){return c-n.easeOutBounce(d-a,0,c,d)+b},d.easeInOutBounce=function(a,b,c,d){return a<d/2?.5*n.easeInBounce(2*a,0,c,d)+b:.5*n.easeOutBounce(x,2*a-d,0,c,d)+.5*c+b},b.exports=d},{}],148:[function(a,b,c){var d=a("../../enum/PlayerEvents"),e=a("../../gui/gui");a("../../objects/Panorama"),a("three"),a("../math");G.tagInfoS={};var f=0;G.getBasicInfo=function(){if("panorama"===G.player.mode&&null!=G.player.currentPano&&null!=G.player.currentPano.id){var a={};return a.location=G.player.currentPano.id,a.qx=G.player.camera.quaternion.z,a.qy=G.player.camera.quaternion.w,a.qz=G.player.camera.quaternion.x,a.qw=G.player.camera.quaternion.y,a}},G.getMoreInfo=function(){if("panorama"===G.player.mode&&null!=G.player.currentPano&&null!=G.player.currentPano.id){var a={};return a.location=G.player.currentPano.id,a.qx=G.player.camera.quaternion.z,a.qy=G.player.camera.quaternion.w,a.qz=G.player.camera.quaternion.x,a.qw=G.player.camera.quaternion.y,a}},G.setTagSizeAndBottom=function(a){G.media_scale=a},G.getFakePanoTag=function(){return G.fakePanoTag},G.setFakePanoTag=function(a){G.fakePanoTag=a},G.showFakeTagWithSize=function(a,b,c,d,e,f){G.media_size=f,G.pano_video_url=e,G.showFakeTag(a,b,c,d)},G.showFakeTag=function(a,b,c,d){if(console.log("model",d),"panorama"===G.player.mode&&null!=G.player.currentPano&&null!=G.player.currentPano.id){null!=G.player.reticule&&(G.player.reticule.editHidden=!0,G.player.reticule.hide());var e=G.model.mattertags,f=null;if(0==d&&e)for(var g in e)if("-1"==e[g].tagid){f=e[g];break}if(0==d){var h={};h.actiontype=1,h.base={x:0,y:0,z:0},h.details={description:"",subtype:0,tagpictype:1,tagpicurl:c,templatetype:1,time:"",title:""},h.tagid="-1",a&&38==parseInt(a)&&(G.mtype=a,G.mstyle=b,G.murl=c,G.mmodal=d,h.details.templatetype=a,h.details.media_scale=G.media_scale||5,h.details.mbottom=G.mbottom||1,h.details.media_size=G.media_size||1,h.details.pano_video_url=G.pano_video_url||""),h.enable=!0,h.locationid="location_01",h.normal={x:0,y:0,z:0},G.typeT=a;var i={x:0,y:0,z:0};h.stem={direction:i,enabled:!0},G.model.newBuildTagsForAddTag(h),G.setFakePanoTag(h)}else if(1==d)f&&(G.typeT=a,f.updateTagMaterial(c));else if(2==d){var h={};h.actiontype=1,h.base={x:0,y:0,z:0},h.details={description:"",subtype:0,tagpictype:1,tagpicurl:c,templatetype:1,time:"",title:""},h.enable=!0,h.locationid="location_01",h.normal={x:0,y:0,z:0},h.tagid="-2",h.rt360=!0,G.typeT=a;var i={x:0,y:0,z:0};h.stem={direction:i,enabled:!0},G.model.newBuildTagsForAddTag(h)}}},G.hideFakeTag=function(a){null!=G.player.reticule&&(G.player.reticule.editHidden=!1,G.player.reticule.show());var b=G.model.mattertags,c=null;for(var d in b)if(b[d]&&b[d].tagid&&b[d].tagid==a){c=b[d];break}null!=c&&(c.floor.remove(c.obj3d),delete b[d])},G.sendTag=function(a){var b=window.parent.NestP.addTagInfo,c=window.parent.NestP.addBuildingTagInfo;if(null!=b||null!=c)if(a.typeT=G.typeT,10==a.typeT&&(a.list=G.model.scenes360),0==a.typeT){window.parent.NestP.addBuildingTagInfo(a)}else{window.parent.NestP.addTagInfo(a)}},G.addTag=function(a){console.log(a),G.model.newBuildTagsForAddTag(a.data),G.player.mattertagManager.updateModel(),G.player.mattertagManager.updateTitleTags()},G.updateTag=function(a){if(a.data){var b=a.data.tagid;G.delTag(parseInt(b)),G.delTag(parseInt(b)),G.addTag(a)}},G.addScene=function(a,b){console.log(a),e.addHighlight(G.model,G.d,G.player,a.data,b)},G.removeScene=function(a){G.model.removeScene(a)},G.delTag=function(a){console.log(a),G.model.delTag(a),G.model.delTag(a),G.player.mattertagManager.updateModel()},G.goto3D=function(){if(!1===G.model.data.player_options.show3d)return!1;$("input[id='month']").get(0).checked=!0,$("#gui-modes-outside").hasClass("outside")&&G.d.changeMode("floorplan","gui")},G.changeMeasureUI=function(a){G.measurestarted&&$("#measure-tools").click(),a?(G.model.measure_enable=!0,$("#measure-tools").css("display","block")):(G.model.measure_enable=!1,$("#measure-tools").css("display","none"))},G.player.on(d.PanoChosen,function(a,b){if(console.log("xxxxx  "+G.player.mode+"  "+a.alignmentType+"   "+b.alignmentType+"  "+f),window.parent.NestP&&window.parent.NestP.intoTypedPano){if("dollhouse"==G.player.mode)a.alignmentType==b.alignmentType&&2==a.alignmentType?(window.parent.NestP.intoTypedPano(2),1==f&&G.hideFakeTag("-1")):a.alignmentType==b.alignmentType&&1==a.alignmentType&&(window.parent.NestP.intoTypedPano(1),2==f&&G.hideFakeTag("-2"));else if(a.alignmentType!=b.alignmentType){var c=!b.isAligned();c?(window.parent.NestP.intoTypedPano(2),G.hideFakeTag("-1")):(window.parent.NestP.intoTypedPano(1),G.hideFakeTag("-1"))}f=b.alignmentType}if(b&&window.parent.adjustPAngle&&window.parent.NestP&&window.parent.NestP.getPath&&window.parent.NestP.updateAngleValue){"/model/roam/"==window.parent.NestP.getPath()&&window.parent.NestP.updateAngleValue(b.id,b.adjustAngleX,b.adjustAngleY,b.adjustAngleZ)}}),G.gotoRoam=function(a){G.d.goToHighlightByLocation(a)},G.adjustAngle=function(a,b){G.player.currentPano.updateAngle(a,b)},G.compassAdjust=function(a,b){0==b?G.d.compassReset(0):G.d.compassAdd(a)},G.compassAdjustSetVisible=function(a){G.settings.basic.menu.compass_enable=a,a?"floorplan"===G.player.mode||"dollhouse"===G.player.mode?($(".indoordir").hide(),$(".indoorscale").hide(),$(".compass").show()):"panorama"===G.player.mode&&($(".compass").hide(),$(".indoordir").show(),$(".indoorscale").show()):($(".indoordir").hide(),$(".indoorscale").hide(),$(".compass").hide())}},{"../../enum/PlayerEvents":38,"../../gui/gui":64,"../../objects/Panorama":113,"../math":154,three:177}],149:[function(a,b,c){var d=function(){return window.navigator.userAgent.indexOf("Android")>-1||window.navigator.userAgent.indexOf("Linux")>-1?"Android":window.navigator.userAgent.indexOf("iPhone")>-1?"iOS":window.navigator.userAgent.indexOf("Windows Phone")>-1?"WP":"Others"},e=function(){var a="1.0",b=window.navigator.userAgent,c=b.indexOf("Android")>-1||b.indexOf("Linux")>-1,d=!!b.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);if(c){var e=/android [\d._]+/gi,f=b.match(e);f&&(a=(f+"").replace(/[^0-9|_.]/gi,"").replace(/_/gi,"."),a=parseInt(a.split(".")[0]))}return d&&(a=window.navigator.userAgent.split(";")[1].match(/(\d+)_(\d+)_?(\d+)?/)[0]),a},f=function(){var a;return window.screen&&window.screen.orientation&&window.screen.orientation.angle?(180!=window.screen.orientation.angle&&0!=window.screen.orientation.angle||(a="竖屏"),90!=window.screen.orientation.angle&&-90!=window.screen.orientation.angle||(a="横屏")):a="未知",a},g=function(){var a=window.navigator.userAgent.toLowerCase(),b="ipad"==a.match(/(ipad)/i),c="iphone os"==a.match(/iphone os/i),d="midp"==a.match(/midp/i),e="rv:1.2.3.4"==a.match(/rv:1.2.3.4/i),f="ucweb"==a.match(/ucweb/i),g="android"==a.match(/android/i),h="windows ce"==a.match(/windows ce/i),i="windows mobile"==a.match(/windows mobile/i);return b||c||d||e||f||g||h||i?c||d||e||f||g||h||i?"Phone":b?"ipad":"未知":"PC"},h=function(){var a;if(!window.navigator.connection)return"未知";switch(window.navigator.connection.effectiveType){case"wifi":a="wifi";break;case"4g":a="4G";break;case"2g":a="2G";break;case"3g":a="3G";break;case"ethernet":a="以太网";break;case"default":a="未知"}return a};b.exports={deviceInfo:function(){return{deviceType:g(),OS:d(),OSVersion:e(),userAgent:window.navigator.userAgent,appVersion:window.navigator.appVersion,screenHeight:window.screen.height,screenWidth:window.screen.width,language:window.navigator.language,netWork:h(),orientation:f()}}}},{}],150:[function(a,b,c){"use strict";function d(){this.events=[],this.valid=!1}var e=a("../enum/Joystick");d.prototype.push=function(a,b){this.events.push({direction:a,pano:b}),this.valid=!0},d.prototype.pop=function(a){var b=this.events.pop();return this.events.length<1&&(this.valid=!1),b},d.prototype.peek=function(){return this.events.length?this.events[this.events.length-1]:{direction:null,pano:null}},
d.prototype.invalidate=function(){this.events=[],this.valid=!1},d.prototype.reversePano=function(a){if(!this.valid)return null;var b=this.peek();return e.opposite(a)===b.direction?(this.pop(),b.pano):null},b.exports=d},{"../enum/Joystick":24}],151:[function(a,b,c){b.exports={getSize:function(a){var b=0,c=0;if(null!=a){var d=a.substring(a.lastIndexOf("_")+1,a.lastIndexOf("."));if(null!=d){var e=d.split("x");null!=e&&e.length>1&&(b=parseInt(e[0],0),c=parseInt(e[1],0))}}return{width:b,height:c}},getWinSize:function(a){var b=this.getSize(a);if(!b.width||!b.height||b.width<=window.innerWidth&&b.height<=window.innerHeight)return b;var c=b.width/b.height;return c>=window.innerWidth/window.innerHeight?(b.width=window.innerWidth,b.height=b.width/c):(b.height=window.innerHeight,b.width=b.height*c),b}}},{}],152:[function(a,b,c){"use strict";b.exports={vector:function(a,b){var c=a.clone();return b=b.clone(),function(d){a.set(c.x*(1-d)+b.x*d,c.y*(1-d)+b.y*d,c.z*(1-d)+b.z*d)}},quaternion:function(a,b){var c=a.clone();return function(d){a.copy(c).slerp(b,d)}},property:function(a,b,c,d){var e=a[b];return function(f){a[b]=e*(1-f)+c*f,d&&d(a[b])}},uniform:function(a,b,c){var d=a.material.uniforms[b].value;return function(e){a.material.uniforms[b]&&(a.material.uniforms[b].value=d*(1-e)+c*e)}},matrix4:function(a,b){var c=a.clone();return function(d){for(var e=a.elements,f=c.elements,g=b.elements,h=0;h<16;h++)e[h]=f[h]*(1-d)+g[h]*d}},allUniforms:function(a,b,c){var d=a.map(function(a){return this.uniform(a,b,c)}.bind(this));return function(a){d.forEach(function(b){b(a)})}}}},{}],153:[function(a,b,c){"use strict";function d(a){var b,c,f,g,h=a.split("/"),i="["+h[h.length-1].replace(".js","")+"]",j={};if(d.consoleEnabled){var k=function(a){$("#debug-console").append("<p>"+a+"</p>"),$("#debug-console")[0].scrollTop=$("#debug-console")[0].scrollHeight};b=function(a){k(Array.prototype.slice.call(arguments).join(" "))},c=function(a){k(Array.prototype.slice.call(arguments).join(" "))},f=function(a){k("WARN: "+Array.prototype.slice.call(arguments).join(" "))},g=function(a){k("ERROR: "+Array.prototype.slice.call(arguments).join(" "))}}else console.log?(b=console.log,c=console.info?console.info:console.log,f=console.warn?console.warn:console.log,g=console.error?console.error:console.log):b=c=f=g=function(){};var l=function(a){return[i,d.timestamp()].concat(Array.prototype.slice.call(a))},m=function(b,c){if(e){var f=Array.prototype.slice.call(b).join(" ");e.captureMessage(f,{level:c,path:a,timestamp:d.timestamp()})}},n=function(b,c){if(e){var f=Array.prototype.slice.call(b).join(" ");e.captureException(new Error(f),{level:c,path:a,timestamp:d.timestamp()})}};return{debug:function(){d.level>=d.levels.debug&&b.apply(console,l(arguments))},info:function(){d.level>=d.levels.info&&c.apply(console,l(arguments))},warn:function(){m(arguments,"warn"),d.level>=d.levels.warn&&f.apply(console,l(arguments))},error:function(){n(arguments,"error"),d.level>=d.levels.error&&g.apply(console,l(arguments))},v3str:function(a,b){var c=void 0===b?2:b;return"("+a.x.toPrecision(c)+", "+a.y.toPrecision(c)+", "+a.z.toPrecision(c)+")"},eulstr:function(a,b){var c=void 0===b?2:b;return"("+THREE.Math.radToDeg(a.x).toPrecision(c)+", "+THREE.Math.radToDeg(a.y).toPrecision(c)+", "+THREE.Math.radToDeg(a.z).toPrecision(c)+' "'+a.order+'")'},time:function(a){d.level>=d.levels.debug&&(j[a]=Date.now())},timeEnd:function(a){if(d.level>=d.levels.debug){var b=j[a];if(!b)return;var c=(Date.now()-b)/1e3;this.debug(a,c+"s")}}}}var e=window.Raven;d.timestamp=function(){return(Date.now()-window.navigationStart)/1e3+"s"},d.levels={debug:3,info:2,warn:1,error:0},d.level=d.levels.info,b.exports=d},{}],154:[function(a,b,c){"use strict";var d=a("three");b.exports={convertVisionVector:function(a){return new d.Vector3(a.x,a.z,-a.y)},convertVisionQuaternion:function(a){return new d.Quaternion(a.x,a.z,-a.y,a.w).multiply((new d.Quaternion).setFromAxisAngle(new d.Vector3(0,1,0),d.Math.degToRad(90)))},convertWorkshopVector:function(a){return new d.Vector3(-a.x,a.y,a.z)},convertWorkshopQuaternion:function(a){return new d.Quaternion(-a.x,a.y,a.z,-a.w).multiply(new d.Quaternion(Math.sqrt(2)/2,Math.sqrt(2)/2,0,0))},convertWorkshopPanoramaQuaternion:function(a){return new d.Quaternion(a.x,-a.y,-a.z,a.w).normalize().multiply((new d.Quaternion).setFromAxisAngle(new d.Vector3(0,1,0),d.Math.degToRad(270)))},convertWorkshopOrthoZoom:function(a){return-1===a?-1:a/4},toPrecision:function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},projectPositionToCanvas:function(a,b,c){c=c||new d.Vector3,c.copy(a);var e=.5*window.innerWidth,f=.5*window.innerHeight;return c.project(b),c.x=c.x*e+e,c.y=-c.y*f+f,c},convertScreenPositionToNDC:function(a,b,c){return c=c||new d.Vector2,c.x=a/window.innerWidth*2-1,c.y=-b/window.innerHeight*2+1,c},constrainedTurn:function(a){var b=a%(2*Math.PI);return b=b>Math.PI?b-=2*Math.PI:b<-Math.PI?b+=2*Math.PI:b},getFOVDotThreshold:function(a){return Math.cos(d.Math.degToRad(a/2))},compareFloats:function(a,b){return Math.abs(a-b)<Number.EPSILON*Math.pow(2,45)}}},{three:177}],155:[function(a,b,c){"use strict";function d(a,b,c){return h.map(function(a,d){var g=f.isMobile()?"mobile":"pc";return G.url.model+"/locations/"+g+"/"+c+"/"+b+"_"+e(a)+".jpg"}.bind(this))}function e(a){return i[a]}var f=a("./browser"),g=a("../enum/GLCubeFaces"),h=[0,1,2,3,4,5],i={0:g.GL_TEXTURE_CUBE_MAP_POSITIVE_Y,1:g.GL_TEXTURE_CUBE_MAP_POSITIVE_Z,2:g.GL_TEXTURE_CUBE_MAP_POSITIVE_X,3:g.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z,4:g.GL_TEXTURE_CUBE_MAP_NEGATIVE_X,5:g.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y};b.exports={mapFaceToCubemapFace:e,getCubemapUrls:d}},{"../enum/GLCubeFaces":22,"./browser":142}],156:[function(a,b,c){(function(c){"use strict";var d=a("./browser"),e=a("./logger"),f=new e(c);b.exports={getAuthorizationHeader:function(){var a=d.valueFromHash("auth");if(a)return a.replace(","," ");var b=d.valueFromCookie("token");return b?"Token "+b:null},parseModelid:function(a){var b,c;return a=a||"",b=window.location.protocol+"//"+window.location.host,c=b+"/api/player/models/"+a,{baseurl:window.location.protocol+"//"+window.location.host,playdir:"play",dataroot:"data",modelid:a,versiondir:"",locationpics:"",urlBase:b,urlModel:c,urlFiles:c+(c.match(/\/$/)?"files":"/files"),urlThumb:c+(c.match(/\/$/)?"thumb":"/thumb")}},getModelIDFromQueryString:function(){return d.valueFromHash("model")||d.valueFromHash("m")},normalizeModeldata:function(a,b){return a=JSON.parse(JSON.stringify(a)),a.scenes.forEach(function(a){if(a._camera&&"string"==typeof a._camera)try{a._camera=JSON.parse(a._camera)}catch(b){f.warn("Unable to parse scene camera"),a._camera=null}else"object"==typeof a._camera&&f.debug("scene.camera already a JSON object");a._camera&&(a._camera._rotation&&(a._camera._rotation=b.convertWorkshopQuaternion(a._camera._rotation)),a._camera._viewpoint&&(a._camera._viewpoint=b.convertWorkshopVector(a._camera._viewpoint)),a._camera._zoom=b.convertWorkshopOrthoZoom(a._camera._zoom))}),a},visionVersionToInt:function(){var a=new RegExp(["(?:[0-9.]+\\.){1,4}","([0-9]+)","[^\\.]*$"].join(""));return function(b){if(!b)throw new Error("Vision version is required");var c=a.exec(b);if(null===c)throw new Error("String is not a vision version: "+b);return parseInt(c[1])}}(),modelDataPromisesTiles:function(a){if(a.vision_version)try{return l.visionVersionToInt(a.vision_version)>=l.visionVersionToInt(r.visionTilingStartVersion)}catch(b){s.warn("Invalid vision version: "+a.vision_version)}var b=a.created?new Date(a.created):null;return b&&b>=r.visionTilingStartDate}}}).call(this,"/js/util/showcase.js")},{"./browser":142,"./logger":153}],157:[function(a,b,c){function d(){}d.prototype.init=function(a){$(".ck-slide").css("display","flex");var b=$(".ck-slide .ck-slide-wrapper").find("li").length,c=this,d=0;$(".ck-next").on("click",function(){var a=d;d>=b-1?d=0:d++,c.change(d,a)}),$(".ck-prev").on("click",function(){var a=d;d<=0?d=b-1:d--,c.change(d,a)}),$(".ck-slide").find(".ck-slidebox li").each(function(a){$(this).on("click.slidebox",function(){c.change(a,d),d=a})})},d.prototype.change=function(a,b){$(".ck-slide").find(".ck-slide-wrapper li").eq(b).stop().animate({opacity:0}),$(".ck-slide").find(".ck-slide-wrapper li").eq(a).show().css({opacity:0}).stop().animate({opacity:1}),$(".ck-slide").find(".ck-slidebox li").removeClass("current"),$(".ck-slide").find(".ck-slidebox li").eq(a).addClass("current")},b.exports=d},{}],158:[function(a,b,c){var d=a("./browser"),e=a("./storageUtil"),f=a("./getDeviceInfo"),g=function(){return e.getCookie("playUserUuid")},h=function(){var a=d.getUuid();return e.setCookie("playUserUuid",a,219e3),a},i=function(){return e.getSessionStorageItem("playPvUuid")},j=function(){var a=d.getUuid();return e.setSessionStorageItem("playPvUuid",a),a},k=function(a){var b="";for(var c in a)""!=b&&(b+="&"),b+=c+"="+encodeURIComponent(a[c]);new Image(1,1).src="https://nest-log.oss-cn-beijing.aliyuncs.com/a.gif?"+b},l=function(){return(new Date).getTime()/1e3};b.exports.setCustomVar=function(a,b){var c=f.deviceInfo(),d=g(),i=0;d||(d=h(),i=1);var m=j();b||(b=-1),e.setSessionStorageItem("modelId",a),e.setSessionStorageItem("groupId",b);var n={tp:1,ud:d,rd:m,md:a,cd:b||"-1",ht:window.location.host,ct:l(),gn:i,cn:"",dt:c.deviceType,op:c.OS,ov:c.OSVersion,ua:c.userAgent,av:c.appVersion,sh:c.screenHeight,sw:c.screenWidth,lg:c.language,nw:c.netWork,ot:c.orientation,rt:2};k(n)},b.exports.trackEvent=function(a,b){var c=e.getSessionStorageItem("modelId"),d=e.getSessionStorageItem("groupId"),f={tp:2,ud:g(),rd:i(),md:c,cd:d||"-1",ct:l(),ed:a||"",pd:b||"",rt:2};k(f)},b.exports.updatePageDuration=function(a){var a=e.getSessionStorageItem("modelId"),b=e.getSessionStorageItem("groupId"),c={tp:3,ud:g(),rd:i(),md:a,cd:b||"-1",ct:l(),rt:2};k(c)}},{"./browser":142,"./getDeviceInfo":149,"./storageUtil":159}],159:[function(a,b,c){b.exports={setCookie:function(a,b,c){var d=new Date;d.setDate(d.getDate()+c),document.cookie=a+"="+b+";expires="+d},delCookie:function(a){setCookie(a,1,-1)},getCookie:function(a){for(var b=document.cookie.split("; "),c=0;c<b.length;c++){var d=b[c].split("=");if(d[0]==a)return d[1]}return""},setCookieJson:function(a,b,c){var d=JSON.stringify(b);this.setCookie(a,d,c)},getCookieJson:function(a){var b,c=this.getCookie(a);return c&&(b=JSON.parse(c)),b},getSessionStorageItem:function(a){return window.sessionStorage.getItem(a)},setSessionStorageItem:function(a,b){window.sessionStorage.setItem(a,b)},removeSessionStorageItem:function(a){return window.sessionStorage.removeItem(a)},getLocalStorageItem:function(a){return window.localStorage.getItem(a)},setLocalStorageItem:function(a,b){window.localStorage.setItem(a,b)},removeLocalStorageItem:function(a){return window.localStorage.removeItem(a)}}},{}],160:[function(a,b,c){(function(){"use strict";var a,c=function(b,e){function f(a){return Math.floor(a)}function g(){var a=v.params.autoplay,b=v.slides.eq(v.activeIndex);b.attr("data-swiper-autoplay")&&(a=b.attr("data-swiper-autoplay")||v.params.autoplay),v.autoplayTimeoutId=setTimeout(function(){v.params.loop?(v.fixLoop(),v._slideNext(),v.emit("onAutoplay",v)):v.isEnd?e.autoplayStopOnLast?v.stopAutoplay():(v._slideTo(0),v.emit("onAutoplay",v)):(v._slideNext(),v.emit("onAutoplay",v))},a)}function h(b,c){var d=a(b.target);if(!d.is(c))if("string"==typeof c)d=d.parents(c);else if(c.nodeType){var e;return d.parents().each(function(a,b){b===c&&(e=c)}),e?c:void 0}if(0!==d.length)return d[0]}function i(a,b){b=b||{};var c=window.MutationObserver||window.WebkitMutationObserver,d=new c(function(a){a.forEach(function(a){v.onResize(!0),v.emit("onObserverUpdate",v,a)})});d.observe(a,{attributes:void 0===b.attributes||b.attributes,childList:void 0===b.childList||b.childList,characterData:void 0===b.characterData||b.characterData}),v.observers.push(d)}function j(a){a.originalEvent&&(a=a.originalEvent);var b=a.keyCode||a.charCode;if(!v.params.allowSwipeToNext&&(v.isHorizontal()&&39===b||!v.isHorizontal()&&40===b))return!1;if(!v.params.allowSwipeToPrev&&(v.isHorizontal()&&37===b||!v.isHorizontal()&&38===b))return!1;if(!(a.shiftKey||a.altKey||a.ctrlKey||a.metaKey||document.activeElement&&document.activeElement.nodeName&&("input"===document.activeElement.nodeName.toLowerCase()||"textarea"===document.activeElement.nodeName.toLowerCase()))){if(37===b||39===b||38===b||40===b){var c=!1;if(v.container.parents("."+v.params.slideClass).length>0&&0===v.container.parents("."+v.params.slideActiveClass).length)return;var d={left:window.pageXOffset,top:window.pageYOffset},e=window.innerWidth,f=window.innerHeight,g=v.container.offset();v.rtl&&(g.left=g.left-v.container[0].scrollLeft);for(var h=[[g.left,g.top],[g.left+v.width,g.top],[g.left,g.top+v.height],[g.left+v.width,g.top+v.height]],i=0;i<h.length;i++){var j=h[i];j[0]>=d.left&&j[0]<=d.left+e&&j[1]>=d.top&&j[1]<=d.top+f&&(c=!0)}if(!c)return}v.isHorizontal()?(37!==b&&39!==b||(a.preventDefault?a.preventDefault():a.returnValue=!1),(39===b&&!v.rtl||37===b&&v.rtl)&&v.slideNext(),(37===b&&!v.rtl||39===b&&v.rtl)&&v.slidePrev()):(38!==b&&40!==b||(a.preventDefault?a.preventDefault():a.returnValue=!1),40===b&&v.slideNext(),38===b&&v.slidePrev()),v.emit("onKeyPress",v,b)}}function k(a){var b=0,c=0,d=0,e=0;return"detail"in a&&(c=a.detail),"wheelDelta"in a&&(c=-a.wheelDelta/120),"wheelDeltaY"in a&&(c=-a.wheelDeltaY/120),"wheelDeltaX"in a&&(b=-a.wheelDeltaX/120),"axis"in a&&a.axis===a.HORIZONTAL_AXIS&&(b=c,c=0),d=10*b,e=10*c,"deltaY"in a&&(e=a.deltaY),"deltaX"in a&&(d=a.deltaX),(d||e)&&a.deltaMode&&(1===a.deltaMode?(d*=40,e*=40):(d*=800,e*=800)),d&&!b&&(b=d<1?-1:1),e&&!c&&(c=e<1?-1:1),{spinX:b,spinY:c,pixelX:d,pixelY:e}}function l(a){a.originalEvent&&(a=a.originalEvent);var b=0,c=v.rtl?-1:1,d=k(a);if(v.params.mousewheelForceToAxis)if(v.isHorizontal()){if(!(Math.abs(d.pixelX)>Math.abs(d.pixelY)))return;b=d.pixelX*c}else{if(!(Math.abs(d.pixelY)>Math.abs(d.pixelX)))return;b=d.pixelY}else b=Math.abs(d.pixelX)>Math.abs(d.pixelY)?-d.pixelX*c:-d.pixelY;if(0!==b){if(v.params.mousewheelInvert&&(b=-b),v.params.freeMode){var e=v.getWrapperTranslate()+b*v.params.mousewheelSensitivity,f=v.isBeginning,g=v.isEnd;if(e>=v.minTranslate()&&(e=v.minTranslate()),e<=v.maxTranslate()&&(e=v.maxTranslate()),v.setWrapperTransition(0),v.setWrapperTranslate(e),v.updateProgress(),v.updateActiveIndex(),(!f&&v.isBeginning||!g&&v.isEnd)&&v.updateClasses(),v.params.freeModeSticky?(clearTimeout(v.mousewheel.timeout),v.mousewheel.timeout=setTimeout(function(){v.slideReset()},300)):v.params.lazyLoading&&v.lazy&&v.lazy.load(),v.emit("onScroll",v,a),v.params.autoplay&&v.params.autoplayDisableOnInteraction&&v.stopAutoplay(),0===e||e===v.maxTranslate())return}else{if((new window.Date).getTime()-v.mousewheel.lastScrollTime>60)if(b<0)if(v.isEnd&&!v.params.loop||v.animating){if(v.params.mousewheelReleaseOnEdges)return!0}else v.slideNext(),v.emit("onScroll",v,a);else if(v.isBeginning&&!v.params.loop||v.animating){if(v.params.mousewheelReleaseOnEdges)return!0}else v.slidePrev(),v.emit("onScroll",v,a);v.mousewheel.lastScrollTime=(new window.Date).getTime()}return a.preventDefault?a.preventDefault():a.returnValue=!1,!1}}function m(b,c){b=a(b);var d,e,f,g=v.rtl?-1:1;d=b.attr("data-swiper-parallax")||"0",e=b.attr("data-swiper-parallax-x"),f=b.attr("data-swiper-parallax-y"),e||f?(e=e||"0",f=f||"0"):v.isHorizontal()?(e=d,f="0"):(f=d,e="0"),e=e.indexOf("%")>=0?parseInt(e,10)*c*g+"%":e*c*g+"px",f=f.indexOf("%")>=0?parseInt(f,10)*c+"%":f*c+"px",b.transform("translate3d("+e+", "+f+",0px)")}function n(a){return 0!==a.indexOf("on")&&(a=a[0]!==a[0].toUpperCase()?"on"+a[0].toUpperCase()+a.substring(1):"on"+a),a}if(!(this instanceof c))return new c(b,e);var o={direction:"horizontal",touchEventsTarget:"container",initialSlide:0,speed:300,autoplay:!1,autoplayDisableOnInteraction:!0,autoplayStopOnLast:!1,iOSEdgeSwipeDetection:!1,iOSEdgeSwipeThreshold:20,freeMode:!1,freeModeMomentum:!0,freeModeMomentumRatio:1,freeModeMomentumBounce:!0,freeModeMomentumBounceRatio:1,freeModeMomentumVelocityRatio:1,freeModeSticky:!1,freeModeMinimumVelocity:.02,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",coverflow:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},flip:{slideShadows:!0,limitRotation:!0},cube:{slideShadows:!0,shadow:!0,shadowOffset:20,shadowScale:.94},fade:{crossFade:!1},parallax:!1,zoom:!1,zoomMax:3,zoomMin:1,zoomToggle:!0,scrollbar:null,scrollbarHide:!0,scrollbarDraggable:!1,scrollbarSnapOnRelease:!1,keyboardControl:!1,mousewheelControl:!1,mousewheelReleaseOnEdges:!1,mousewheelInvert:!1,mousewheelForceToAxis:!1,mousewheelSensitivity:1,mousewheelEventsTarged:"container",hashnav:!1,hashnavWatchState:!1,history:!1,replaceState:!1,breakpoints:void 0,spaceBetween:0,slidesPerView:1,slidesPerColumn:1,slidesPerColumnFill:"column",slidesPerGroup:1,centeredSlides:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,onlyExternal:!1,threshold:0,touchMoveStopPropagation:!0,touchReleaseOnEdges:!1,uniqueNavElements:!0,pagination:null,paginationElement:"span",paginationClickable:!1,paginationHide:!1,paginationBulletRender:null,paginationProgressRender:null,paginationFractionRender:null,paginationCustomRender:null,paginationType:"bullets",resistance:!0,resistanceRatio:.85,nextButton:null,prevButton:null,watchSlidesProgress:!1,watchSlidesVisibility:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,lazyLoading:!1,lazyLoadingInPrevNext:!1,lazyLoadingInPrevNextAmount:1,lazyLoadingOnTransitionStart:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,control:void 0,controlInverse:!1,controlBy:"slide",normalizeSlideIndex:!0,allowSwipeToPrev:!0,allowSwipeToNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",passiveListeners:!0,containerModifierClass:"swiper-container-",slideClass:"swiper-slide",slideActiveClass:"swiper-slide-active",slideDuplicateActiveClass:"swiper-slide-duplicate-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slideDuplicateNextClass:"swiper-slide-duplicate-next",slidePrevClass:"swiper-slide-prev",slideDuplicatePrevClass:"swiper-slide-duplicate-prev",wrapperClass:"swiper-wrapper",bulletClass:"swiper-pagination-bullet",bulletActiveClass:"swiper-pagination-bullet-active",buttonDisabledClass:"swiper-button-disabled",paginationCurrentClass:"swiper-pagination-current",paginationTotalClass:"swiper-pagination-total",paginationHiddenClass:"swiper-pagination-hidden",paginationProgressbarClass:"swiper-pagination-progressbar",paginationClickableClass:"swiper-pagination-clickable",paginationModifierClass:"swiper-pagination-",lazyLoadingClass:"swiper-lazy",lazyStatusLoadingClass:"swiper-lazy-loading",lazyStatusLoadedClass:"swiper-lazy-loaded",lazyPreloaderClass:"swiper-lazy-preloader",notificationClass:"swiper-notification",preloaderClass:"preloader",zoomContainerClass:"swiper-zoom-container",observer:!1,observeParents:!1,a11y:!1,prevSlideMessage:"Previous slide",nextSlideMessage:"Next slide",firstSlideMessage:"This is the first slide",lastSlideMessage:"This is the last slide",paginationBulletMessage:"Go to slide {{index}}",runCallbacksOnInit:!0},p=e&&e.virtualTranslate;e=e||{};var q={};for(var r in e)if("object"!=typeof e[r]||null===e[r]||(e[r].nodeType||e[r]===window||e[r]===document||void 0!==d&&e[r]instanceof d||"undefined"!=typeof jQuery&&e[r]instanceof jQuery))q[r]=e[r];else{q[r]={};for(var s in e[r])q[r][s]=e[r][s]}for(var t in o)if(void 0===e[t])e[t]=o[t];else if("object"==typeof e[t])for(var u in o[t])void 0===e[t][u]&&(e[t][u]=o[t][u]);var v=this;if(v.params=e,v.originalParams=q,v.classNames=[],void 0!==a&&void 0!==d&&(a=d),(void 0!==a||(a=void 0===d?window.Dom7||window.Zepto||window.jQuery:d))&&(v.$=a,v.currentBreakpoint=void 0,v.getActiveBreakpoint=function(){if(!v.params.breakpoints)return!1;var a,b=!1,c=[];for(a in v.params.breakpoints)v.params.breakpoints.hasOwnProperty(a)&&c.push(a);c.sort(function(a,b){return parseInt(a,10)>parseInt(b,10)});for(var d=0;d<c.length;d++)(a=c[d])>=window.innerWidth&&!b&&(b=a);return b||"max"},v.setBreakpoint=function(){var a=v.getActiveBreakpoint();if(a&&v.currentBreakpoint!==a){var b=a in v.params.breakpoints?v.params.breakpoints[a]:v.originalParams,c=v.params.loop&&b.slidesPerView!==v.params.slidesPerView;for(var d in b)v.params[d]=b[d];v.currentBreakpoint=a,c&&v.destroyLoop&&v.reLoop(!0)}},v.params.breakpoints&&v.setBreakpoint(),v.container=a(b),0!==v.container.length)){if(v.container.length>1){var w=[];return v.container.each(function(){w.push(new c(this,e))}),w}v.container[0].swiper=v,v.container.data("swiper",v),v.classNames.push(v.params.containerModifierClass+v.params.direction),v.params.freeMode&&v.classNames.push(v.params.containerModifierClass+"free-mode"),v.support.flexbox||(v.classNames.push(v.params.containerModifierClass+"no-flexbox"),v.params.slidesPerColumn=1),v.params.autoHeight&&v.classNames.push(v.params.containerModifierClass+"autoheight"),(v.params.parallax||v.params.watchSlidesVisibility)&&(v.params.watchSlidesProgress=!0),v.params.touchReleaseOnEdges&&(v.params.resistanceRatio=0),["cube","coverflow","flip"].indexOf(v.params.effect)>=0&&(v.support.transforms3d?(v.params.watchSlidesProgress=!0,v.classNames.push(v.params.containerModifierClass+"3d")):v.params.effect="slide"),"slide"!==v.params.effect&&v.classNames.push(v.params.containerModifierClass+v.params.effect),"cube"===v.params.effect&&(v.params.resistanceRatio=0,v.params.slidesPerView=1,v.params.slidesPerColumn=1,v.params.slidesPerGroup=1,v.params.centeredSlides=!1,v.params.spaceBetween=0,v.params.virtualTranslate=!0),"fade"!==v.params.effect&&"flip"!==v.params.effect||(v.params.slidesPerView=1,v.params.slidesPerColumn=1,v.params.slidesPerGroup=1,v.params.watchSlidesProgress=!0,v.params.spaceBetween=0,void 0===p&&(v.params.virtualTranslate=!0)),v.params.grabCursor&&v.support.touch&&(v.params.grabCursor=!1),v.wrapper=v.container.children("."+v.params.wrapperClass),v.params.pagination&&(v.paginationContainer=a(v.params.pagination),v.params.uniqueNavElements&&"string"==typeof v.params.pagination&&v.paginationContainer.length>1&&1===v.container.find(v.params.pagination).length&&(v.paginationContainer=v.container.find(v.params.pagination)),"bullets"===v.params.paginationType&&v.params.paginationClickable?v.paginationContainer.addClass(v.params.paginationModifierClass+"clickable"):v.params.paginationClickable=!1,v.paginationContainer.addClass(v.params.paginationModifierClass+v.params.paginationType)),(v.params.nextButton||v.params.prevButton)&&(v.params.nextButton&&(v.nextButton=a(v.params.nextButton),v.params.uniqueNavElements&&"string"==typeof v.params.nextButton&&v.nextButton.length>1&&1===v.container.find(v.params.nextButton).length&&(v.nextButton=v.container.find(v.params.nextButton))),v.params.prevButton&&(v.prevButton=a(v.params.prevButton),v.params.uniqueNavElements&&"string"==typeof v.params.prevButton&&v.prevButton.length>1&&1===v.container.find(v.params.prevButton).length&&(v.prevButton=v.container.find(v.params.prevButton)))),v.isHorizontal=function(){return"horizontal"===v.params.direction},v.rtl=v.isHorizontal()&&("rtl"===v.container[0].dir.toLowerCase()||"rtl"===v.container.css("direction")),v.rtl&&v.classNames.push(v.params.containerModifierClass+"rtl"),v.rtl&&(v.wrongRTL="-webkit-box"===v.wrapper.css("display")),v.params.slidesPerColumn>1&&v.classNames.push(v.params.containerModifierClass+"multirow"),v.device.android&&v.classNames.push(v.params.containerModifierClass+"android"),v.container.addClass(v.classNames.join(" ")),v.translate=0,v.progress=0,v.velocity=0,v.lockSwipeToNext=function(){v.params.allowSwipeToNext=!1,!1===v.params.allowSwipeToPrev&&v.params.grabCursor&&v.unsetGrabCursor()},v.lockSwipeToPrev=function(){v.params.allowSwipeToPrev=!1,!1===v.params.allowSwipeToNext&&v.params.grabCursor&&v.unsetGrabCursor()},v.lockSwipes=function(){v.params.allowSwipeToNext=v.params.allowSwipeToPrev=!1,v.params.grabCursor&&v.unsetGrabCursor()},v.unlockSwipeToNext=function(){v.params.allowSwipeToNext=!0,!0===v.params.allowSwipeToPrev&&v.params.grabCursor&&v.setGrabCursor()},v.unlockSwipeToPrev=function(){v.params.allowSwipeToPrev=!0,!0===v.params.allowSwipeToNext&&v.params.grabCursor&&v.setGrabCursor()},v.unlockSwipes=function(){v.params.allowSwipeToNext=v.params.allowSwipeToPrev=!0,v.params.grabCursor&&v.setGrabCursor()},v.setGrabCursor=function(a){v.container[0].style.cursor="move",v.container[0].style.cursor=a?"-webkit-grabbing":"-webkit-grab",v.container[0].style.cursor=a?"-moz-grabbin":"-moz-grab",v.container[0].style.cursor=a?"grabbing":"grab"},v.unsetGrabCursor=function(){v.container[0].style.cursor=""},v.params.grabCursor&&v.setGrabCursor(),v.imagesToLoad=[],v.imagesLoaded=0,v.loadImage=function(a,b,c,d,e,f){function g(){f&&f()}var h;a.complete&&e?g():b?(h=new window.Image,h.onload=g,h.onerror=g,d&&(h.sizes=d),c&&(h.srcset=c),b&&(h.src=b)):g()},v.preloadImages=function(){function a(){void 0!==v&&null!==v&&v&&(void 0!==v.imagesLoaded&&v.imagesLoaded++,v.imagesLoaded===v.imagesToLoad.length&&(v.params.updateOnImagesReady&&v.update(),v.emit("onImagesReady",v)))}v.imagesToLoad=v.container.find("img");for(var b=0;b<v.imagesToLoad.length;b++)v.loadImage(v.imagesToLoad[b],v.imagesToLoad[b].currentSrc||v.imagesToLoad[b].getAttribute("src"),v.imagesToLoad[b].srcset||v.imagesToLoad[b].getAttribute("srcset"),v.imagesToLoad[b].sizes||v.imagesToLoad[b].getAttribute("sizes"),!0,a)},v.autoplayTimeoutId=void 0,v.autoplaying=!1,v.autoplayPaused=!1,v.startAutoplay=function(){return void 0===v.autoplayTimeoutId&&(!!v.params.autoplay&&(!v.autoplaying&&(v.autoplaying=!0,v.emit("onAutoplayStart",v),void g())))},v.stopAutoplay=function(a){v.autoplayTimeoutId&&(v.autoplayTimeoutId&&clearTimeout(v.autoplayTimeoutId),v.autoplaying=!1,v.autoplayTimeoutId=void 0,v.emit("onAutoplayStop",v))},v.pauseAutoplay=function(a){v.autoplayPaused||(v.autoplayTimeoutId&&clearTimeout(v.autoplayTimeoutId),v.autoplayPaused=!0,0===a?(v.autoplayPaused=!1,g()):v.wrapper.transitionEnd(function(){v&&(v.autoplayPaused=!1,v.autoplaying?g():v.stopAutoplay())}))},v.minTranslate=function(){return-v.snapGrid[0]},v.maxTranslate=function(){return-v.snapGrid[v.snapGrid.length-1]},v.updateAutoHeight=function(){var a,b=[],c=0;if("auto"!==v.params.slidesPerView&&v.params.slidesPerView>1)for(a=0;a<Math.ceil(v.params.slidesPerView);a++){var d=v.activeIndex+a;if(d>v.slides.length)break;b.push(v.slides.eq(d)[0])}else b.push(v.slides.eq(v.activeIndex)[0]);for(a=0;a<b.length;a++)if(void 0!==b[a]){var e=b[a].offsetHeight;c=e>c?e:c}c&&v.wrapper.css("height",c+"px")},v.updateContainerSize=function(){var a,b;a=void 0!==v.params.width?v.params.width:v.container[0].clientWidth,b=void 0!==v.params.height?v.params.height:v.container[0].clientHeight,0===a&&v.isHorizontal()||0===b&&!v.isHorizontal()||(a=a-parseInt(v.container.css("padding-left"),10)-parseInt(v.container.css("padding-right"),10),b=b-parseInt(v.container.css("padding-top"),10)-parseInt(v.container.css("padding-bottom"),10),v.width=a,v.height=b,v.size=v.isHorizontal()?v.width:v.height)},v.updateSlidesSize=function(){v.slides=v.wrapper.children("."+v.params.slideClass),v.snapGrid=[],v.slidesGrid=[],v.slidesSizesGrid=[];var a,b=v.params.spaceBetween,c=-v.params.slidesOffsetBefore,d=0,e=0;if(void 0!==v.size){"string"==typeof b&&b.indexOf("%")>=0&&(b=parseFloat(b.replace("%",""))/100*v.size),v.virtualSize=-b,v.rtl?v.slides.css({marginLeft:"",marginTop:""}):v.slides.css({marginRight:"",marginBottom:""});var g;v.params.slidesPerColumn>1&&(g=Math.floor(v.slides.length/v.params.slidesPerColumn)===v.slides.length/v.params.slidesPerColumn?v.slides.length:Math.ceil(v.slides.length/v.params.slidesPerColumn)*v.params.slidesPerColumn,"auto"!==v.params.slidesPerView&&"row"===v.params.slidesPerColumnFill&&(g=Math.max(g,v.params.slidesPerView*v.params.slidesPerColumn)));var h,i=v.params.slidesPerColumn,j=g/i,k=j-(v.params.slidesPerColumn*j-v.slides.length);for(a=0;a<v.slides.length;a++){h=0;var l=v.slides.eq(a);if(v.params.slidesPerColumn>1){var m,n,o;"column"===v.params.slidesPerColumnFill?(n=Math.floor(a/i),o=a-n*i,(n>k||n===k&&o===i-1)&&++o>=i&&(o=0,n++),m=n+o*g/i,l.css({"-webkit-box-ordinal-group":m,"-moz-box-ordinal-group":m,"-ms-flex-order":m,"-webkit-order":m,order:m})):(o=Math.floor(a/j),n=a-o*j),l.css("margin-"+(v.isHorizontal()?"top":"left"),0!==o&&v.params.spaceBetween&&v.params.spaceBetween+"px").attr("data-swiper-column",n).attr("data-swiper-row",o)}"none"!==l.css("display")&&("auto"===v.params.slidesPerView?(h=v.isHorizontal()?l.outerWidth(!0):l.outerHeight(!0),v.params.roundLengths&&(h=f(h))):(h=(v.size-(v.params.slidesPerView-1)*b)/v.params.slidesPerView,v.params.roundLengths&&(h=f(h)),v.isHorizontal()?v.slides[a].style.width=h+"px":v.slides[a].style.height=h+"px"),v.slides[a].swiperSlideSize=h,v.slidesSizesGrid.push(h),v.params.centeredSlides?(c=c+h/2+d/2+b,0===d&&0!==a&&(c=c-v.size/2-b),0===a&&(c=c-v.size/2-b),Math.abs(c)<.001&&(c=0),e%v.params.slidesPerGroup==0&&v.snapGrid.push(c),v.slidesGrid.push(c)):(e%v.params.slidesPerGroup==0&&v.snapGrid.push(c),v.slidesGrid.push(c),c=c+h+b),v.virtualSize+=h+b,d=h,e++)}v.virtualSize=Math.max(v.virtualSize,v.size)+v.params.slidesOffsetAfter;var p;if(v.rtl&&v.wrongRTL&&("slide"===v.params.effect||"coverflow"===v.params.effect)&&v.wrapper.css({width:v.virtualSize+v.params.spaceBetween+"px"}),v.support.flexbox&&!v.params.setWrapperSize||(v.isHorizontal()?v.wrapper.css({width:v.virtualSize+v.params.spaceBetween+"px"}):v.wrapper.css({height:v.virtualSize+v.params.spaceBetween+"px"})),v.params.slidesPerColumn>1&&(v.virtualSize=(h+v.params.spaceBetween)*g,v.virtualSize=Math.ceil(v.virtualSize/v.params.slidesPerColumn)-v.params.spaceBetween,v.isHorizontal()?v.wrapper.css({width:v.virtualSize+v.params.spaceBetween+"px"}):v.wrapper.css({height:v.virtualSize+v.params.spaceBetween+"px"}),v.params.centeredSlides)){for(p=[],a=0;a<v.snapGrid.length;a++)v.snapGrid[a]<v.virtualSize+v.snapGrid[0]&&p.push(v.snapGrid[a]);v.snapGrid=p}if(!v.params.centeredSlides){for(p=[],a=0;a<v.snapGrid.length;a++)v.snapGrid[a]<=v.virtualSize-v.size&&p.push(v.snapGrid[a]);v.snapGrid=p,Math.floor(v.virtualSize-v.size)-Math.floor(v.snapGrid[v.snapGrid.length-1])>1&&v.snapGrid.push(v.virtualSize-v.size)}0===v.snapGrid.length&&(v.snapGrid=[0]),0!==v.params.spaceBetween&&(v.isHorizontal()?v.rtl?v.slides.css({marginLeft:b+"px"}):v.slides.css({marginRight:b+"px"}):v.slides.css({marginBottom:b+"px"})),v.params.watchSlidesProgress&&v.updateSlidesOffset()}},v.updateSlidesOffset=function(){for(var a=0;a<v.slides.length;a++)v.slides[a].swiperSlideOffset=v.isHorizontal()?v.slides[a].offsetLeft:v.slides[a].offsetTop},v.currentSlidesPerView=function(){var a,b,c=1;if(v.params.centeredSlides){var d,e=v.slides[v.activeIndex].swiperSlideSize;for(a=v.activeIndex+1;a<v.slides.length;a++)v.slides[a]&&!d&&(e+=v.slides[a].swiperSlideSize,c++,e>v.size&&(d=!0));for(b=v.activeIndex-1;b>=0;b--)v.slides[b]&&!d&&(e+=v.slides[b].swiperSlideSize,c++,e>v.size&&(d=!0))}else for(a=v.activeIndex+1;a<v.slides.length;a++)v.slidesGrid[a]-v.slidesGrid[v.activeIndex]<v.size&&c++;return c},v.updateSlidesProgress=function(a){if(void 0===a&&(a=v.translate||0),0!==v.slides.length){void 0===v.slides[0].swiperSlideOffset&&v.updateSlidesOffset();var b=-a;v.rtl&&(b=a),v.slides.removeClass(v.params.slideVisibleClass);for(var c=0;c<v.slides.length;c++){var d=v.slides[c],e=(b+(v.params.centeredSlides?v.minTranslate():0)-d.swiperSlideOffset)/(d.swiperSlideSize+v.params.spaceBetween);if(v.params.watchSlidesVisibility){var f=-(b-d.swiperSlideOffset),g=f+v.slidesSizesGrid[c];(f>=0&&f<v.size||g>0&&g<=v.size||f<=0&&g>=v.size)&&v.slides.eq(c).addClass(v.params.slideVisibleClass)}d.progress=v.rtl?-e:e}}},v.updateProgress=function(a){void 0===a&&(a=v.translate||0)
;var b=v.maxTranslate()-v.minTranslate(),c=v.isBeginning,d=v.isEnd;0===b?(v.progress=0,v.isBeginning=v.isEnd=!0):(v.progress=(a-v.minTranslate())/b,v.isBeginning=v.progress<=0,v.isEnd=v.progress>=1),v.isBeginning&&!c&&v.emit("onReachBeginning",v),v.isEnd&&!d&&v.emit("onReachEnd",v),v.params.watchSlidesProgress&&v.updateSlidesProgress(a),v.emit("onProgress",v,v.progress)},v.updateActiveIndex=function(){var a,b,c,d=v.rtl?v.translate:-v.translate;for(b=0;b<v.slidesGrid.length;b++)void 0!==v.slidesGrid[b+1]?d>=v.slidesGrid[b]&&d<v.slidesGrid[b+1]-(v.slidesGrid[b+1]-v.slidesGrid[b])/2?a=b:d>=v.slidesGrid[b]&&d<v.slidesGrid[b+1]&&(a=b+1):d>=v.slidesGrid[b]&&(a=b);v.params.normalizeSlideIndex&&(a<0||void 0===a)&&(a=0),c=Math.floor(a/v.params.slidesPerGroup),c>=v.snapGrid.length&&(c=v.snapGrid.length-1),a!==v.activeIndex&&(v.snapIndex=c,v.previousIndex=v.activeIndex,v.activeIndex=a,v.updateClasses(),v.updateRealIndex())},v.updateRealIndex=function(){v.realIndex=parseInt(v.slides.eq(v.activeIndex).attr("data-swiper-slide-index")||v.activeIndex,10)},v.updateClasses=function(){v.slides.removeClass(v.params.slideActiveClass+" "+v.params.slideNextClass+" "+v.params.slidePrevClass+" "+v.params.slideDuplicateActiveClass+" "+v.params.slideDuplicateNextClass+" "+v.params.slideDuplicatePrevClass);var b=v.slides.eq(v.activeIndex);b.addClass(v.params.slideActiveClass),e.loop&&(b.hasClass(v.params.slideDuplicateClass)?v.wrapper.children("."+v.params.slideClass+":not(."+v.params.slideDuplicateClass+')[data-swiper-slide-index="'+v.realIndex+'"]').addClass(v.params.slideDuplicateActiveClass):v.wrapper.children("."+v.params.slideClass+"."+v.params.slideDuplicateClass+'[data-swiper-slide-index="'+v.realIndex+'"]').addClass(v.params.slideDuplicateActiveClass));var c=b.next("."+v.params.slideClass).addClass(v.params.slideNextClass);v.params.loop&&0===c.length&&(c=v.slides.eq(0),c.addClass(v.params.slideNextClass));var d=b.prev("."+v.params.slideClass).addClass(v.params.slidePrevClass);if(v.params.loop&&0===d.length&&(d=v.slides.eq(-1),d.addClass(v.params.slidePrevClass)),e.loop&&(c.hasClass(v.params.slideDuplicateClass)?v.wrapper.children("."+v.params.slideClass+":not(."+v.params.slideDuplicateClass+')[data-swiper-slide-index="'+c.attr("data-swiper-slide-index")+'"]').addClass(v.params.slideDuplicateNextClass):v.wrapper.children("."+v.params.slideClass+"."+v.params.slideDuplicateClass+'[data-swiper-slide-index="'+c.attr("data-swiper-slide-index")+'"]').addClass(v.params.slideDuplicateNextClass),d.hasClass(v.params.slideDuplicateClass)?v.wrapper.children("."+v.params.slideClass+":not(."+v.params.slideDuplicateClass+')[data-swiper-slide-index="'+d.attr("data-swiper-slide-index")+'"]').addClass(v.params.slideDuplicatePrevClass):v.wrapper.children("."+v.params.slideClass+"."+v.params.slideDuplicateClass+'[data-swiper-slide-index="'+d.attr("data-swiper-slide-index")+'"]').addClass(v.params.slideDuplicatePrevClass)),v.paginationContainer&&v.paginationContainer.length>0){var f,g=v.params.loop?Math.ceil((v.slides.length-2*v.loopedSlides)/v.params.slidesPerGroup):v.snapGrid.length;if(v.params.loop?(f=Math.ceil((v.activeIndex-v.loopedSlides)/v.params.slidesPerGroup),f>v.slides.length-1-2*v.loopedSlides&&(f-=v.slides.length-2*v.loopedSlides),f>g-1&&(f-=g),f<0&&"bullets"!==v.params.paginationType&&(f=g+f)):f=void 0!==v.snapIndex?v.snapIndex:v.activeIndex||0,"bullets"===v.params.paginationType&&v.bullets&&v.bullets.length>0&&(v.bullets.removeClass(v.params.bulletActiveClass),v.paginationContainer.length>1?v.bullets.each(function(){a(this).index()===f&&a(this).addClass(v.params.bulletActiveClass)}):v.bullets.eq(f).addClass(v.params.bulletActiveClass)),"fraction"===v.params.paginationType&&(v.paginationContainer.find("."+v.params.paginationCurrentClass).text(f+1),v.paginationContainer.find("."+v.params.paginationTotalClass).text(g)),"progress"===v.params.paginationType){var h=(f+1)/g,i=h,j=1;v.isHorizontal()||(j=h,i=1),v.paginationContainer.find("."+v.params.paginationProgressbarClass).transform("translate3d(0,0,0) scaleX("+i+") scaleY("+j+")").transition(v.params.speed)}"custom"===v.params.paginationType&&v.params.paginationCustomRender&&(v.paginationContainer.html(v.params.paginationCustomRender(v,f+1,g)),v.emit("onPaginationRendered",v,v.paginationContainer[0]))}v.params.loop||(v.params.prevButton&&v.prevButton&&v.prevButton.length>0&&(v.isBeginning?(v.prevButton.addClass(v.params.buttonDisabledClass),v.params.a11y&&v.a11y&&v.a11y.disable(v.prevButton)):(v.prevButton.removeClass(v.params.buttonDisabledClass),v.params.a11y&&v.a11y&&v.a11y.enable(v.prevButton))),v.params.nextButton&&v.nextButton&&v.nextButton.length>0&&(v.isEnd?(v.nextButton.addClass(v.params.buttonDisabledClass),v.params.a11y&&v.a11y&&v.a11y.disable(v.nextButton)):(v.nextButton.removeClass(v.params.buttonDisabledClass),v.params.a11y&&v.a11y&&v.a11y.enable(v.nextButton))))},v.updatePagination=function(){if(v.params.pagination&&v.paginationContainer&&v.paginationContainer.length>0){var a="";if("bullets"===v.params.paginationType){for(var b=v.params.loop?Math.ceil((v.slides.length-2*v.loopedSlides)/v.params.slidesPerGroup):v.snapGrid.length,c=0;c<b;c++)v.params.paginationBulletRender?a+=v.params.paginationBulletRender(v,c,v.params.bulletClass):a+="<"+v.params.paginationElement+' class="'+v.params.bulletClass+'"></'+v.params.paginationElement+">";v.paginationContainer.html(a),v.bullets=v.paginationContainer.find("."+v.params.bulletClass),v.params.paginationClickable&&v.params.a11y&&v.a11y&&v.a11y.initPagination()}"fraction"===v.params.paginationType&&(a=v.params.paginationFractionRender?v.params.paginationFractionRender(v,v.params.paginationCurrentClass,v.params.paginationTotalClass):'<span class="'+v.params.paginationCurrentClass+'"></span> / <span class="'+v.params.paginationTotalClass+'"></span>',v.paginationContainer.html(a)),"progress"===v.params.paginationType&&(a=v.params.paginationProgressRender?v.params.paginationProgressRender(v,v.params.paginationProgressbarClass):'<span class="'+v.params.paginationProgressbarClass+'"></span>',v.paginationContainer.html(a)),"custom"!==v.params.paginationType&&v.emit("onPaginationRendered",v,v.paginationContainer[0])}},v.update=function(a){function b(){v.rtl,v.translate;c=Math.min(Math.max(v.translate,v.maxTranslate()),v.minTranslate()),v.setWrapperTranslate(c),v.updateActiveIndex(),v.updateClasses()}if(v){v.updateContainerSize(),v.updateSlidesSize(),v.updateProgress(),v.updatePagination(),v.updateClasses(),v.params.scrollbar&&v.scrollbar&&v.scrollbar.set();var c;if(a){v.controller&&v.controller.spline&&(v.controller.spline=void 0),v.params.freeMode?(b(),v.params.autoHeight&&v.updateAutoHeight()):(("auto"===v.params.slidesPerView||v.params.slidesPerView>1)&&v.isEnd&&!v.params.centeredSlides?v.slideTo(v.slides.length-1,0,!1,!0):v.slideTo(v.activeIndex,0,!1,!0))||b()}else v.params.autoHeight&&v.updateAutoHeight()}},v.onResize=function(a){v.params.onBeforeResize&&v.params.onBeforeResize(v),v.params.breakpoints&&v.setBreakpoint();var b=v.params.allowSwipeToPrev,c=v.params.allowSwipeToNext;v.params.allowSwipeToPrev=v.params.allowSwipeToNext=!0,v.updateContainerSize(),v.updateSlidesSize(),("auto"===v.params.slidesPerView||v.params.freeMode||a)&&v.updatePagination(),v.params.scrollbar&&v.scrollbar&&v.scrollbar.set(),v.controller&&v.controller.spline&&(v.controller.spline=void 0);var d=!1;if(v.params.freeMode){var e=Math.min(Math.max(v.translate,v.maxTranslate()),v.minTranslate());v.setWrapperTranslate(e),v.updateActiveIndex(),v.updateClasses(),v.params.autoHeight&&v.updateAutoHeight()}else v.updateClasses(),d=("auto"===v.params.slidesPerView||v.params.slidesPerView>1)&&v.isEnd&&!v.params.centeredSlides?v.slideTo(v.slides.length-1,0,!1,!0):v.slideTo(v.activeIndex,0,!1,!0);v.params.lazyLoading&&!d&&v.lazy&&v.lazy.load(),v.params.allowSwipeToPrev=b,v.params.allowSwipeToNext=c,v.params.onAfterResize&&v.params.onAfterResize(v)},v.touchEventsDesktop={start:"mousedown",move:"mousemove",end:"mouseup"},window.navigator.pointerEnabled?v.touchEventsDesktop={start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled&&(v.touchEventsDesktop={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}),v.touchEvents={start:v.support.touch||!v.params.simulateTouch?"touchstart":v.touchEventsDesktop.start,move:v.support.touch||!v.params.simulateTouch?"touchmove":v.touchEventsDesktop.move,end:v.support.touch||!v.params.simulateTouch?"touchend":v.touchEventsDesktop.end},(window.navigator.pointerEnabled||window.navigator.msPointerEnabled)&&("container"===v.params.touchEventsTarget?v.container:v.wrapper).addClass("swiper-wp8-"+v.params.direction),v.initEvents=function(a){var b=a?"off":"on",c=a?"removeEventListener":"addEventListener",d="container"===v.params.touchEventsTarget?v.container[0]:v.wrapper[0],f=v.support.touch?d:document,g=!!v.params.nested;if(v.browser.ie)d[c](v.touchEvents.start,v.onTouchStart,!1),f[c](v.touchEvents.move,v.onTouchMove,g),f[c](v.touchEvents.end,v.onTouchEnd,!1);else{if(v.support.touch){var h=!("touchstart"!==v.touchEvents.start||!v.support.passiveListener||!v.params.passiveListeners)&&{passive:!0,capture:!1};d[c](v.touchEvents.start,v.onTouchStart,h),d[c](v.touchEvents.move,v.onTouchMove,g),d[c](v.touchEvents.end,v.onTouchEnd,h)}(e.simulateTouch&&!v.device.ios&&!v.device.android||e.simulateTouch&&!v.support.touch&&v.device.ios)&&(d[c]("mousedown",v.onTouchStart,!1),document[c]("mousemove",v.onTouchMove,g),document[c]("mouseup",v.onTouchEnd,!1))}window[c]("resize",v.onResize),v.params.nextButton&&v.nextButton&&v.nextButton.length>0&&(v.nextButton[b]("click",v.onClickNext),v.params.a11y&&v.a11y&&v.nextButton[b]("keydown",v.a11y.onEnterKey)),v.params.prevButton&&v.prevButton&&v.prevButton.length>0&&(v.prevButton[b]("click",v.onClickPrev),v.params.a11y&&v.a11y&&v.prevButton[b]("keydown",v.a11y.onEnterKey)),v.params.pagination&&v.params.paginationClickable&&(v.paginationContainer[b]("click","."+v.params.bulletClass,v.onClickIndex),v.params.a11y&&v.a11y&&v.paginationContainer[b]("keydown","."+v.params.bulletClass,v.a11y.onEnterKey)),(v.params.preventClicks||v.params.preventClicksPropagation)&&d[c]("click",v.preventClicks,!0)},v.attachEvents=function(){v.initEvents()},v.detachEvents=function(){v.initEvents(!0)},v.allowClick=!0,v.preventClicks=function(a){v.allowClick||(v.params.preventClicks&&a.preventDefault(),v.params.preventClicksPropagation&&v.animating&&(a.stopPropagation(),a.stopImmediatePropagation()))},v.onClickNext=function(a){a.preventDefault(),v.isEnd&&!v.params.loop||v.slideNext()},v.onClickPrev=function(a){a.preventDefault(),v.isBeginning&&!v.params.loop||v.slidePrev()},v.onClickIndex=function(b){b.preventDefault();var c=a(this).index()*v.params.slidesPerGroup;v.params.loop&&(c+=v.loopedSlides),v.slideTo(c)},v.updateClickedSlide=function(b){var c=h(b,"."+v.params.slideClass),d=!1;if(c)for(var e=0;e<v.slides.length;e++)v.slides[e]===c&&(d=!0);if(!c||!d)return v.clickedSlide=void 0,void(v.clickedIndex=void 0);if(v.clickedSlide=c,v.clickedIndex=a(c).index(),v.params.slideToClickedSlide&&void 0!==v.clickedIndex&&v.clickedIndex!==v.activeIndex){var f,g=v.clickedIndex,i="auto"===v.params.slidesPerView?v.currentSlidesPerView():v.params.slidesPerView;if(v.params.loop){if(v.animating)return;f=parseInt(a(v.clickedSlide).attr("data-swiper-slide-index"),10),v.params.centeredSlides?g<v.loopedSlides-i/2||g>v.slides.length-v.loopedSlides+i/2?(v.fixLoop(),g=v.wrapper.children("."+v.params.slideClass+'[data-swiper-slide-index="'+f+'"]:not(.'+v.params.slideDuplicateClass+")").eq(0).index(),setTimeout(function(){v.slideTo(g)},0)):v.slideTo(g):g>v.slides.length-i?(v.fixLoop(),g=v.wrapper.children("."+v.params.slideClass+'[data-swiper-slide-index="'+f+'"]:not(.'+v.params.slideDuplicateClass+")").eq(0).index(),setTimeout(function(){v.slideTo(g)},0)):v.slideTo(g)}else v.slideTo(g)}};var x,y,z,A,B,C,D,E,F,G,H="input, select, textarea, button, video",I=Date.now(),J=[];v.animating=!1,v.touches={startX:0,startY:0,currentX:0,currentY:0,diff:0};var K,L;v.onTouchStart=function(b){if(b.originalEvent&&(b=b.originalEvent),(K="touchstart"===b.type)||!("which"in b)||3!==b.which){if(v.params.noSwiping&&h(b,"."+v.params.noSwipingClass))return void(v.allowClick=!0);if(!v.params.swipeHandler||h(b,v.params.swipeHandler)){var c=v.touches.currentX="touchstart"===b.type?b.targetTouches[0].pageX:b.pageX,d=v.touches.currentY="touchstart"===b.type?b.targetTouches[0].pageY:b.pageY;if(!(v.device.ios&&v.params.iOSEdgeSwipeDetection&&c<=v.params.iOSEdgeSwipeThreshold)){if(x=!0,y=!1,z=!0,B=void 0,L=void 0,v.touches.startX=c,v.touches.startY=d,A=Date.now(),v.allowClick=!0,v.updateContainerSize(),v.swipeDirection=void 0,v.params.threshold>0&&(E=!1),"touchstart"!==b.type){var e=!0;a(b.target).is(H)&&(e=!1),document.activeElement&&a(document.activeElement).is(H)&&document.activeElement.blur(),e&&b.preventDefault()}v.emit("onTouchStart",v,b)}}}},v.onTouchMove=function(b){if(b.originalEvent&&(b=b.originalEvent),!K||"mousemove"!==b.type){if(b.preventedByNestedSwiper)return v.touches.startX="touchmove"===b.type?b.targetTouches[0].pageX:b.pageX,void(v.touches.startY="touchmove"===b.type?b.targetTouches[0].pageY:b.pageY);if(v.params.onlyExternal)return v.allowClick=!1,void(x&&(v.touches.startX=v.touches.currentX="touchmove"===b.type?b.targetTouches[0].pageX:b.pageX,v.touches.startY=v.touches.currentY="touchmove"===b.type?b.targetTouches[0].pageY:b.pageY,A=Date.now()));if(K&&v.params.touchReleaseOnEdges&&!v.params.loop)if(v.isHorizontal()){if(v.touches.currentX<v.touches.startX&&v.translate<=v.maxTranslate()||v.touches.currentX>v.touches.startX&&v.translate>=v.minTranslate())return}else if(v.touches.currentY<v.touches.startY&&v.translate<=v.maxTranslate()||v.touches.currentY>v.touches.startY&&v.translate>=v.minTranslate())return;if(K&&document.activeElement&&b.target===document.activeElement&&a(b.target).is(H))return y=!0,void(v.allowClick=!1);if(z&&v.emit("onTouchMove",v,b),!(b.targetTouches&&b.targetTouches.length>1)){if(v.touches.currentX="touchmove"===b.type?b.targetTouches[0].pageX:b.pageX,v.touches.currentY="touchmove"===b.type?b.targetTouches[0].pageY:b.pageY,void 0===B){var c;v.isHorizontal()&&v.touches.currentY===v.touches.startY||!v.isHorizontal()&&v.touches.currentX===v.touches.startX?B=!1:(c=180*Math.atan2(Math.abs(v.touches.currentY-v.touches.startY),Math.abs(v.touches.currentX-v.touches.startX))/Math.PI,B=v.isHorizontal()?c>v.params.touchAngle:90-c>v.params.touchAngle)}if(B&&v.emit("onTouchMoveOpposite",v,b),void 0===L&&(v.touches.currentX===v.touches.startX&&v.touches.currentY===v.touches.startY||(L=!0)),x){if(B)return void(x=!1);if(L){v.allowClick=!1,v.emit("onSliderMove",v,b),b.preventDefault(),v.params.touchMoveStopPropagation&&!v.params.nested&&b.stopPropagation(),y||(e.loop&&v.fixLoop(),D=v.getWrapperTranslate(),v.setWrapperTransition(0),v.animating&&v.wrapper.trigger("webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd msTransitionEnd"),v.params.autoplay&&v.autoplaying&&(v.params.autoplayDisableOnInteraction?v.stopAutoplay():v.pauseAutoplay()),G=!1,!v.params.grabCursor||!0!==v.params.allowSwipeToNext&&!0!==v.params.allowSwipeToPrev||v.setGrabCursor(!0)),y=!0;var d=v.touches.diff=v.isHorizontal()?v.touches.currentX-v.touches.startX:v.touches.currentY-v.touches.startY;d*=v.params.touchRatio,v.rtl&&(d=-d),v.swipeDirection=d>0?"prev":"next",C=d+D;var f=!0;if(d>0&&C>v.minTranslate()?(f=!1,v.params.resistance&&(C=v.minTranslate()-1+Math.pow(-v.minTranslate()+D+d,v.params.resistanceRatio))):d<0&&C<v.maxTranslate()&&(f=!1,v.params.resistance&&(C=v.maxTranslate()+1-Math.pow(v.maxTranslate()-D-d,v.params.resistanceRatio))),f&&(b.preventedByNestedSwiper=!0),!v.params.allowSwipeToNext&&"next"===v.swipeDirection&&C<D&&(C=D),!v.params.allowSwipeToPrev&&"prev"===v.swipeDirection&&C>D&&(C=D),v.params.threshold>0){if(!(Math.abs(d)>v.params.threshold||E))return void(C=D);if(!E)return E=!0,v.touches.startX=v.touches.currentX,v.touches.startY=v.touches.currentY,C=D,void(v.touches.diff=v.isHorizontal()?v.touches.currentX-v.touches.startX:v.touches.currentY-v.touches.startY)}v.params.followFinger&&((v.params.freeMode||v.params.watchSlidesProgress)&&v.updateActiveIndex(),v.params.freeMode&&(0===J.length&&J.push({position:v.touches[v.isHorizontal()?"startX":"startY"],time:A}),J.push({position:v.touches[v.isHorizontal()?"currentX":"currentY"],time:(new window.Date).getTime()})),v.updateProgress(C),v.setWrapperTranslate(C))}}}}},v.onTouchEnd=function(b){if(b.originalEvent&&(b=b.originalEvent),z&&v.emit("onTouchEnd",v,b),z=!1,x){v.params.grabCursor&&y&&x&&(!0===v.params.allowSwipeToNext||!0===v.params.allowSwipeToPrev)&&v.setGrabCursor(!1);var c=Date.now(),d=c-A;if(v.allowClick&&(v.updateClickedSlide(b),v.emit("onTap",v,b),d<300&&c-I>300&&(F&&clearTimeout(F),F=setTimeout(function(){v&&(v.params.paginationHide&&v.paginationContainer.length>0&&!a(b.target).hasClass(v.params.bulletClass)&&v.paginationContainer.toggleClass(v.params.paginationHiddenClass),v.emit("onClick",v,b))},300)),d<300&&c-I<300&&(F&&clearTimeout(F),v.emit("onDoubleTap",v,b))),I=Date.now(),setTimeout(function(){v&&(v.allowClick=!0)},0),!x||!y||!v.swipeDirection||0===v.touches.diff||C===D)return void(x=y=!1);x=y=!1;var e;if(e=v.params.followFinger?v.rtl?v.translate:-v.translate:-C,v.params.freeMode){if(e<-v.minTranslate())return void v.slideTo(v.activeIndex);if(e>-v.maxTranslate())return void(v.slides.length<v.snapGrid.length?v.slideTo(v.snapGrid.length-1):v.slideTo(v.slides.length-1));if(v.params.freeModeMomentum){if(J.length>1){var f=J.pop(),g=J.pop(),h=f.position-g.position,i=f.time-g.time;v.velocity=h/i,v.velocity=v.velocity/2,Math.abs(v.velocity)<v.params.freeModeMinimumVelocity&&(v.velocity=0),(i>150||(new window.Date).getTime()-f.time>300)&&(v.velocity=0)}else v.velocity=0;v.velocity=v.velocity*v.params.freeModeMomentumVelocityRatio,J.length=0;var j=1e3*v.params.freeModeMomentumRatio,k=v.velocity*j,l=v.translate+k;v.rtl&&(l=-l);var m,n=!1,o=20*Math.abs(v.velocity)*v.params.freeModeMomentumBounceRatio;if(l<v.maxTranslate())v.params.freeModeMomentumBounce?(l+v.maxTranslate()<-o&&(l=v.maxTranslate()-o),m=v.maxTranslate(),n=!0,G=!0):l=v.maxTranslate();else if(l>v.minTranslate())v.params.freeModeMomentumBounce?(l-v.minTranslate()>o&&(l=v.minTranslate()+o),m=v.minTranslate(),n=!0,G=!0):l=v.minTranslate();else if(v.params.freeModeSticky){var p,q=0;for(q=0;q<v.snapGrid.length;q+=1)if(v.snapGrid[q]>-l){p=q;break}l=Math.abs(v.snapGrid[p]-l)<Math.abs(v.snapGrid[p-1]-l)||"next"===v.swipeDirection?v.snapGrid[p]:v.snapGrid[p-1],v.rtl||(l=-l)}if(0!==v.velocity)j=v.rtl?Math.abs((-l-v.translate)/v.velocity):Math.abs((l-v.translate)/v.velocity);else if(v.params.freeModeSticky)return void v.slideReset();v.params.freeModeMomentumBounce&&n?(v.updateProgress(m),v.setWrapperTransition(j),v.setWrapperTranslate(l),v.onTransitionStart(),v.animating=!0,v.wrapper.transitionEnd(function(){v&&G&&(v.emit("onMomentumBounce",v),v.setWrapperTransition(v.params.speed),v.setWrapperTranslate(m),v.wrapper.transitionEnd(function(){v&&v.onTransitionEnd()}))})):v.velocity?(v.updateProgress(l),v.setWrapperTransition(j),v.setWrapperTranslate(l),v.onTransitionStart(),v.animating||(v.animating=!0,v.wrapper.transitionEnd(function(){v&&v.onTransitionEnd()}))):v.updateProgress(l),v.updateActiveIndex()}return void((!v.params.freeModeMomentum||d>=v.params.longSwipesMs)&&(v.updateProgress(),v.updateActiveIndex()))}var r,s=0,t=v.slidesSizesGrid[0];for(r=0;r<v.slidesGrid.length;r+=v.params.slidesPerGroup)void 0!==v.slidesGrid[r+v.params.slidesPerGroup]?e>=v.slidesGrid[r]&&e<v.slidesGrid[r+v.params.slidesPerGroup]&&(s=r,t=v.slidesGrid[r+v.params.slidesPerGroup]-v.slidesGrid[r]):e>=v.slidesGrid[r]&&(s=r,t=v.slidesGrid[v.slidesGrid.length-1]-v.slidesGrid[v.slidesGrid.length-2]);var u=(e-v.slidesGrid[s])/t;if(d>v.params.longSwipesMs){if(!v.params.longSwipes)return void v.slideTo(v.activeIndex);"next"===v.swipeDirection&&(u>=v.params.longSwipesRatio?v.slideTo(s+v.params.slidesPerGroup):v.slideTo(s)),"prev"===v.swipeDirection&&(u>1-v.params.longSwipesRatio?v.slideTo(s+v.params.slidesPerGroup):v.slideTo(s))}else{if(!v.params.shortSwipes)return void v.slideTo(v.activeIndex);"next"===v.swipeDirection&&v.slideTo(s+v.params.slidesPerGroup),"prev"===v.swipeDirection&&v.slideTo(s)}}},v._slideTo=function(a,b){return v.slideTo(a,b,!0,!0)},v.slideTo=function(a,b,c,d){void 0===c&&(c=!0),void 0===a&&(a=0),a<0&&(a=0),v.snapIndex=Math.floor(a/v.params.slidesPerGroup),v.snapIndex>=v.snapGrid.length&&(v.snapIndex=v.snapGrid.length-1);var e=-v.snapGrid[v.snapIndex];if(v.params.autoplay&&v.autoplaying&&(d||!v.params.autoplayDisableOnInteraction?v.pauseAutoplay(b):v.stopAutoplay()),v.updateProgress(e),v.params.normalizeSlideIndex)for(var f=0;f<v.slidesGrid.length;f++)-Math.floor(100*e)>=Math.floor(100*v.slidesGrid[f])&&(a=f);return!(!v.params.allowSwipeToNext&&e<v.translate&&e<v.minTranslate())&&(!(!v.params.allowSwipeToPrev&&e>v.translate&&e>v.maxTranslate()&&(v.activeIndex||0)!==a)&&(void 0===b&&(b=v.params.speed),v.previousIndex=v.activeIndex||0,v.activeIndex=a,v.updateRealIndex(),v.rtl&&-e===v.translate||!v.rtl&&e===v.translate?(v.params.autoHeight&&v.updateAutoHeight(),v.updateClasses(),"slide"!==v.params.effect&&v.setWrapperTranslate(e),!1):(v.updateClasses(),v.onTransitionStart(c),0===b||v.browser.lteIE9?(v.setWrapperTranslate(e),v.setWrapperTransition(0),v.onTransitionEnd(c)):(v.setWrapperTranslate(e),v.setWrapperTransition(b),v.animating||(v.animating=!0,v.wrapper.transitionEnd(function(){v&&v.onTransitionEnd(c)}))),!0)))},v.onTransitionStart=function(a){void 0===a&&(a=!0),v.params.autoHeight&&v.updateAutoHeight(),v.lazy&&v.lazy.onTransitionStart(),a&&(v.emit("onTransitionStart",v),v.activeIndex!==v.previousIndex&&(v.emit("onSlideChangeStart",v),v.activeIndex>v.previousIndex?v.emit("onSlideNextStart",v):v.emit("onSlidePrevStart",v)))},v.onTransitionEnd=function(a){v.animating=!1,v.setWrapperTransition(0),void 0===a&&(a=!0),v.lazy&&v.lazy.onTransitionEnd(),a&&(v.emit("onTransitionEnd",v),v.activeIndex!==v.previousIndex&&(v.emit("onSlideChangeEnd",v),v.activeIndex>v.previousIndex?v.emit("onSlideNextEnd",v):v.emit("onSlidePrevEnd",v))),v.params.history&&v.history&&v.history.setHistory(v.params.history,v.activeIndex),v.params.hashnav&&v.hashnav&&v.hashnav.setHash()},v.slideNext=function(a,b,c){if(v.params.loop){if(v.animating)return!1;v.fixLoop();v.container[0].clientLeft;return v.slideTo(v.activeIndex+v.params.slidesPerGroup,b,a,c)}return v.slideTo(v.activeIndex+v.params.slidesPerGroup,b,a,c)},v._slideNext=function(a){return v.slideNext(!0,a,!0)},v.slidePrev=function(a,b,c){if(v.params.loop){if(v.animating)return!1;v.fixLoop();v.container[0].clientLeft;return v.slideTo(v.activeIndex-1,b,a,c)}return v.slideTo(v.activeIndex-1,b,a,c)},v._slidePrev=function(a){return v.slidePrev(!0,a,!0)},v.slideReset=function(a,b,c){return v.slideTo(v.activeIndex,b,a)},v.disableTouchControl=function(){return v.params.onlyExternal=!0,!0},v.enableTouchControl=function(){return v.params.onlyExternal=!1,!0},v.setWrapperTransition=function(a,b){v.wrapper.transition(a),"slide"!==v.params.effect&&v.effects[v.params.effect]&&v.effects[v.params.effect].setTransition(a),v.params.parallax&&v.parallax&&v.parallax.setTransition(a),v.params.scrollbar&&v.scrollbar&&v.scrollbar.setTransition(a),v.params.control&&v.controller&&v.controller.setTransition(a,b),v.emit("onSetTransition",v,a)},v.setWrapperTranslate=function(a,b,c){var d=0,e=0;v.isHorizontal()?d=v.rtl?-a:a:e=a,v.params.roundLengths&&(d=f(d),e=f(e)),v.params.virtualTranslate||(v.support.transforms3d?v.wrapper.transform("translate3d("+d+"px, "+e+"px, 0px)"):v.wrapper.transform("translate("+d+"px, "+e+"px)")),v.translate=v.isHorizontal()?d:e;var g,h=v.maxTranslate()-v.minTranslate();g=0===h?0:(a-v.minTranslate())/h,g!==v.progress&&v.updateProgress(a),b&&v.updateActiveIndex(),"slide"!==v.params.effect&&v.effects[v.params.effect]&&v.effects[v.params.effect].setTranslate(v.translate),v.params.parallax&&v.parallax&&v.parallax.setTranslate(v.translate),v.params.scrollbar&&v.scrollbar&&v.scrollbar.setTranslate(v.translate),v.params.control&&v.controller&&v.controller.setTranslate(v.translate,c),v.emit("onSetTranslate",v,v.translate)},v.getTranslate=function(a,b){var c,d,e,f;return void 0===b&&(b="x"),v.params.virtualTranslate?v.rtl?-v.translate:v.translate:(e=window.getComputedStyle(a,null),window.WebKitCSSMatrix?(d=e.transform||e.webkitTransform,d.split(",").length>6&&(d=d.split(", ").map(function(a){return a.replace(",",".")}).join(", ")),f=new window.WebKitCSSMatrix("none"===d?"":d)):(f=e.MozTransform||e.OTransform||e.MsTransform||e.msTransform||e.transform||e.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),c=f.toString().split(",")),"x"===b&&(d=window.WebKitCSSMatrix?f.m41:16===c.length?parseFloat(c[12]):parseFloat(c[4])),"y"===b&&(d=window.WebKitCSSMatrix?f.m42:16===c.length?parseFloat(c[13]):parseFloat(c[5])),v.rtl&&d&&(d=-d),d||0)},v.getWrapperTranslate=function(a){return void 0===a&&(a=v.isHorizontal()?"x":"y"),v.getTranslate(v.wrapper[0],a)},v.observers=[],v.initObservers=function(){if(v.params.observeParents)for(var a=v.container.parents(),b=0;b<a.length;b++)i(a[b]);i(v.container[0],{childList:!1}),i(v.wrapper[0],{attributes:!1})},v.disconnectObservers=function(){for(var a=0;a<v.observers.length;a++)v.observers[a].disconnect();v.observers=[]},v.createLoop=function(){v.wrapper.children("."+v.params.slideClass+"."+v.params.slideDuplicateClass).remove();var b=v.wrapper.children("."+v.params.slideClass);"auto"!==v.params.slidesPerView||v.params.loopedSlides||(v.params.loopedSlides=b.length),v.loopedSlides=parseInt(v.params.loopedSlides||v.params.slidesPerView,10),v.loopedSlides=v.loopedSlides+v.params.loopAdditionalSlides,v.loopedSlides>b.length&&(v.loopedSlides=b.length);var c,d=[],e=[];for(b.each(function(c,f){var g=a(this);c<v.loopedSlides&&e.push(f),c<b.length&&c>=b.length-v.loopedSlides&&d.push(f),g.attr("data-swiper-slide-index",c)}),c=0;c<e.length;c++)v.wrapper.append(a(e[c].cloneNode(!0)).addClass(v.params.slideDuplicateClass));for(c=d.length-1;c>=0;c--)v.wrapper.prepend(a(d[c].cloneNode(!0)).addClass(v.params.slideDuplicateClass))},v.destroyLoop=function(){v.wrapper.children("."+v.params.slideClass+"."+v.params.slideDuplicateClass).remove(),v.slides.removeAttr("data-swiper-slide-index")},v.reLoop=function(a){var b=v.activeIndex-v.loopedSlides;v.destroyLoop(),v.createLoop(),v.updateSlidesSize(),a&&v.slideTo(b+v.loopedSlides,0,!1)},v.fixLoop=function(){var a;v.activeIndex<v.loopedSlides?(a=v.slides.length-3*v.loopedSlides+v.activeIndex,a+=v.loopedSlides,v.slideTo(a,0,!1,!0)):("auto"===v.params.slidesPerView&&v.activeIndex>=2*v.loopedSlides||v.activeIndex>v.slides.length-2*v.params.slidesPerView)&&(a=-v.slides.length+v.activeIndex+v.loopedSlides,a+=v.loopedSlides,v.slideTo(a,0,!1,!0))},v.appendSlide=function(a){if(v.params.loop&&v.destroyLoop(),"object"==typeof a&&a.length)for(var b=0;b<a.length;b++)a[b]&&v.wrapper.append(a[b]);else v.wrapper.append(a);v.params.loop&&v.createLoop(),v.params.observer&&v.support.observer||v.update(!0)},v.prependSlide=function(a){v.params.loop&&v.destroyLoop();var b=v.activeIndex+1;if("object"==typeof a&&a.length){for(var c=0;c<a.length;c++)a[c]&&v.wrapper.prepend(a[c]);b=v.activeIndex+a.length}else v.wrapper.prepend(a);v.params.loop&&v.createLoop(),v.params.observer&&v.support.observer||v.update(!0),v.slideTo(b,0,!1)},v.removeSlide=function(a){v.params.loop&&(v.destroyLoop(),v.slides=v.wrapper.children("."+v.params.slideClass));var b,c=v.activeIndex;if("object"==typeof a&&a.length){for(var d=0;d<a.length;d++)b=a[d],v.slides[b]&&v.slides.eq(b).remove(),b<c&&c--;c=Math.max(c,0)}else b=a,v.slides[b]&&v.slides.eq(b).remove(),b<c&&c--,c=Math.max(c,0);v.params.loop&&v.createLoop(),v.params.observer&&v.support.observer||v.update(!0),v.params.loop?v.slideTo(c+v.loopedSlides,0,!1):v.slideTo(c,0,!1)},v.removeAllSlides=function(){for(var a=[],b=0;b<v.slides.length;b++)a.push(b);v.removeSlide(a)},v.effects={fade:{setTranslate:function(){for(var a=0;a<v.slides.length;a++){var b=v.slides.eq(a),c=b[0].swiperSlideOffset,d=-c;v.params.virtualTranslate||(d-=v.translate);var e=0;v.isHorizontal()||(e=d,d=0);var f=v.params.fade.crossFade?Math.max(1-Math.abs(b[0].progress),0):1+Math.min(Math.max(b[0].progress,-1),0);b.css({opacity:f}).transform("translate3d("+d+"px, "+e+"px, 0px)")}},setTransition:function(a){if(v.slides.transition(a),v.params.virtualTranslate&&0!==a){var b=!1;v.slides.transitionEnd(function(){if(!b&&v){b=!0,v.animating=!1;for(var a=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],c=0;c<a.length;c++)v.wrapper.trigger(a[c])}})}}},flip:{setTranslate:function(){for(var b=0;b<v.slides.length;b++){var c=v.slides.eq(b),d=c[0].progress;v.params.flip.limitRotation&&(d=Math.max(Math.min(c[0].progress,1),-1));var e=c[0].swiperSlideOffset,f=-180*d,g=f,h=0,i=-e,j=0;if(v.isHorizontal()?v.rtl&&(g=-g):(j=i,i=0,h=-g,g=0),c[0].style.zIndex=-Math.abs(Math.round(d))+v.slides.length,v.params.flip.slideShadows){var k=v.isHorizontal()?c.find(".swiper-slide-shadow-left"):c.find(".swiper-slide-shadow-top"),l=v.isHorizontal()?c.find(".swiper-slide-shadow-right"):c.find(".swiper-slide-shadow-bottom");0===k.length&&(k=a('<div class="swiper-slide-shadow-'+(v.isHorizontal()?"left":"top")+'"></div>'),c.append(k)),0===l.length&&(l=a('<div class="swiper-slide-shadow-'+(v.isHorizontal()?"right":"bottom")+'"></div>'),c.append(l)),k.length&&(k[0].style.opacity=Math.max(-d,0)),l.length&&(l[0].style.opacity=Math.max(d,0))}c.transform("translate3d("+i+"px, "+j+"px, 0px) rotateX("+h+"deg) rotateY("+g+"deg)")}},setTransition:function(b){if(v.slides.transition(b).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(b),v.params.virtualTranslate&&0!==b){var c=!1;v.slides.eq(v.activeIndex).transitionEnd(function(){if(!c&&v&&a(this).hasClass(v.params.slideActiveClass)){c=!0,v.animating=!1;for(var b=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],d=0;d<b.length;d++)v.wrapper.trigger(b[d])}})}}},cube:{setTranslate:function(){var b,c=0;v.params.cube.shadow&&(v.isHorizontal()?(b=v.wrapper.find(".swiper-cube-shadow"),0===b.length&&(b=a('<div class="swiper-cube-shadow"></div>'),v.wrapper.append(b)),b.css({height:v.width+"px"})):(b=v.container.find(".swiper-cube-shadow"),0===b.length&&(b=a('<div class="swiper-cube-shadow"></div>'),v.container.append(b))));for(var d=0;d<v.slides.length;d++){var e=v.slides.eq(d),f=90*d,g=Math.floor(f/360);v.rtl&&(f=-f,g=Math.floor(-f/360));var h=Math.max(Math.min(e[0].progress,1),-1),i=0,j=0,k=0;d%4==0?(i=4*-g*v.size,k=0):(d-1)%4==0?(i=0,k=4*-g*v.size):(d-2)%4==0?(i=v.size+4*g*v.size,k=v.size):(d-3)%4==0&&(i=-v.size,k=3*v.size+4*v.size*g),v.rtl&&(i=-i),v.isHorizontal()||(j=i,i=0);var l="rotateX("+(v.isHorizontal()?0:-f)+"deg) rotateY("+(v.isHorizontal()?f:0)+"deg) translate3d("+i+"px, "+j+"px, "+k+"px)";if(h<=1&&h>-1&&(c=90*d+90*h,v.rtl&&(c=90*-d-90*h)),e.transform(l),v.params.cube.slideShadows){var m=v.isHorizontal()?e.find(".swiper-slide-shadow-left"):e.find(".swiper-slide-shadow-top"),n=v.isHorizontal()?e.find(".swiper-slide-shadow-right"):e.find(".swiper-slide-shadow-bottom");0===m.length&&(m=a('<div class="swiper-slide-shadow-'+(v.isHorizontal()?"left":"top")+'"></div>'),e.append(m)),0===n.length&&(n=a('<div class="swiper-slide-shadow-'+(v.isHorizontal()?"right":"bottom")+'"></div>'),e.append(n)),m.length&&(m[0].style.opacity=Math.max(-h,0)),n.length&&(n[0].style.opacity=Math.max(h,0))}}if(v.wrapper.css({"-webkit-transform-origin":"50% 50% -"+v.size/2+"px","-moz-transform-origin":"50% 50% -"+v.size/2+"px","-ms-transform-origin":"50% 50% -"+v.size/2+"px","transform-origin":"50% 50% -"+v.size/2+"px"}),
v.params.cube.shadow)if(v.isHorizontal())b.transform("translate3d(0px, "+(v.width/2+v.params.cube.shadowOffset)+"px, "+-v.width/2+"px) rotateX(90deg) rotateZ(0deg) scale("+v.params.cube.shadowScale+")");else{var o=Math.abs(c)-90*Math.floor(Math.abs(c)/90),p=1.5-(Math.sin(2*o*Math.PI/360)/2+Math.cos(2*o*Math.PI/360)/2),q=v.params.cube.shadowScale,r=v.params.cube.shadowScale/p,s=v.params.cube.shadowOffset;b.transform("scale3d("+q+", 1, "+r+") translate3d(0px, "+(v.height/2+s)+"px, "+-v.height/2/r+"px) rotateX(-90deg)")}var t=v.isSafari||v.isUiWebView?-v.size/2:0;v.wrapper.transform("translate3d(0px,0,"+t+"px) rotateX("+(v.isHorizontal()?0:c)+"deg) rotateY("+(v.isHorizontal()?-c:0)+"deg)")},setTransition:function(a){v.slides.transition(a).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(a),v.params.cube.shadow&&!v.isHorizontal()&&v.container.find(".swiper-cube-shadow").transition(a)}},coverflow:{setTranslate:function(){for(var b=v.translate,c=v.isHorizontal()?-b+v.width/2:-b+v.height/2,d=v.isHorizontal()?v.params.coverflow.rotate:-v.params.coverflow.rotate,e=v.params.coverflow.depth,f=0,g=v.slides.length;f<g;f++){var h=v.slides.eq(f),i=v.slidesSizesGrid[f],j=h[0].swiperSlideOffset,k=(c-j-i/2)/i*v.params.coverflow.modifier,l=v.isHorizontal()?d*k:0,m=v.isHorizontal()?0:d*k,n=-e*Math.abs(k),o=v.isHorizontal()?0:v.params.coverflow.stretch*k,p=v.isHorizontal()?v.params.coverflow.stretch*k:0;Math.abs(p)<.001&&(p=0),Math.abs(o)<.001&&(o=0),Math.abs(n)<.001&&(n=0),Math.abs(l)<.001&&(l=0),Math.abs(m)<.001&&(m=0);var q="translate3d("+p+"px,"+o+"px,"+n+"px)  rotateX("+m+"deg) rotateY("+l+"deg)";if(h.transform(q),h[0].style.zIndex=1-Math.abs(Math.round(k)),v.params.coverflow.slideShadows){var r=v.isHorizontal()?h.find(".swiper-slide-shadow-left"):h.find(".swiper-slide-shadow-top"),s=v.isHorizontal()?h.find(".swiper-slide-shadow-right"):h.find(".swiper-slide-shadow-bottom");0===r.length&&(r=a('<div class="swiper-slide-shadow-'+(v.isHorizontal()?"left":"top")+'"></div>'),h.append(r)),0===s.length&&(s=a('<div class="swiper-slide-shadow-'+(v.isHorizontal()?"right":"bottom")+'"></div>'),h.append(s)),r.length&&(r[0].style.opacity=k>0?k:0),s.length&&(s[0].style.opacity=-k>0?-k:0)}}if(v.browser.ie){v.wrapper[0].style.perspectiveOrigin=c+"px 50%"}},setTransition:function(a){v.slides.transition(a).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(a)}}},v.lazy={initialImageLoaded:!1,loadImageInSlide:function(b,c){if(void 0!==b&&(void 0===c&&(c=!0),0!==v.slides.length)){var d=v.slides.eq(b),e=d.find("."+v.params.lazyLoadingClass+":not(."+v.params.lazyStatusLoadedClass+"):not(."+v.params.lazyStatusLoadingClass+")");!d.hasClass(v.params.lazyLoadingClass)||d.hasClass(v.params.lazyStatusLoadedClass)||d.hasClass(v.params.lazyStatusLoadingClass)||(e=e.add(d[0])),0!==e.length&&e.each(function(){var b=a(this);b.addClass(v.params.lazyStatusLoadingClass);var e=b.attr("data-background"),f=b.attr("data-src"),g=b.attr("data-srcset"),h=b.attr("data-sizes");v.loadImage(b[0],f||e,g,h,!1,function(){if(void 0!==v&&null!==v&&v){if(e?(b.css("background-image",'url("'+e+'")'),b.removeAttr("data-background")):(g&&(b.attr("srcset",g),b.removeAttr("data-srcset")),h&&(b.attr("sizes",h),b.removeAttr("data-sizes")),f&&(b.attr("src",f),b.removeAttr("data-src"))),b.addClass(v.params.lazyStatusLoadedClass).removeClass(v.params.lazyStatusLoadingClass),d.find("."+v.params.lazyPreloaderClass+", ."+v.params.preloaderClass).remove(),v.params.loop&&c){var a=d.attr("data-swiper-slide-index");if(d.hasClass(v.params.slideDuplicateClass)){var i=v.wrapper.children('[data-swiper-slide-index="'+a+'"]:not(.'+v.params.slideDuplicateClass+")");v.lazy.loadImageInSlide(i.index(),!1)}else{var j=v.wrapper.children("."+v.params.slideDuplicateClass+'[data-swiper-slide-index="'+a+'"]');v.lazy.loadImageInSlide(j.index(),!1)}}v.emit("onLazyImageReady",v,d[0],b[0])}}),v.emit("onLazyImageLoad",v,d[0],b[0])})}},load:function(){var b,c=v.params.slidesPerView;if("auto"===c&&(c=0),v.lazy.initialImageLoaded||(v.lazy.initialImageLoaded=!0),v.params.watchSlidesVisibility)v.wrapper.children("."+v.params.slideVisibleClass).each(function(){v.lazy.loadImageInSlide(a(this).index())});else if(c>1)for(b=v.activeIndex;b<v.activeIndex+c;b++)v.slides[b]&&v.lazy.loadImageInSlide(b);else v.lazy.loadImageInSlide(v.activeIndex);if(v.params.lazyLoadingInPrevNext)if(c>1||v.params.lazyLoadingInPrevNextAmount&&v.params.lazyLoadingInPrevNextAmount>1){var d=v.params.lazyLoadingInPrevNextAmount,e=c,f=Math.min(v.activeIndex+e+Math.max(d,e),v.slides.length),g=Math.max(v.activeIndex-Math.max(e,d),0);for(b=v.activeIndex+c;b<f;b++)v.slides[b]&&v.lazy.loadImageInSlide(b);for(b=g;b<v.activeIndex;b++)v.slides[b]&&v.lazy.loadImageInSlide(b)}else{var h=v.wrapper.children("."+v.params.slideNextClass);h.length>0&&v.lazy.loadImageInSlide(h.index());var i=v.wrapper.children("."+v.params.slidePrevClass);i.length>0&&v.lazy.loadImageInSlide(i.index())}},onTransitionStart:function(){v.params.lazyLoading&&(v.params.lazyLoadingOnTransitionStart||!v.params.lazyLoadingOnTransitionStart&&!v.lazy.initialImageLoaded)&&v.lazy.load()},onTransitionEnd:function(){v.params.lazyLoading&&!v.params.lazyLoadingOnTransitionStart&&v.lazy.load()}},v.scrollbar={isTouched:!1,setDragPosition:function(a){var b=v.scrollbar,c=v.isHorizontal()?"touchstart"===a.type||"touchmove"===a.type?a.targetTouches[0].pageX:a.pageX||a.clientX:"touchstart"===a.type||"touchmove"===a.type?a.targetTouches[0].pageY:a.pageY||a.clientY,d=c-b.track.offset()[v.isHorizontal()?"left":"top"]-b.dragSize/2,e=-v.minTranslate()*b.moveDivider,f=-v.maxTranslate()*b.moveDivider;d<e?d=e:d>f&&(d=f),d=-d/b.moveDivider,v.updateProgress(d),v.setWrapperTranslate(d,!0)},dragStart:function(a){var b=v.scrollbar;b.isTouched=!0,a.preventDefault(),a.stopPropagation(),b.setDragPosition(a),clearTimeout(b.dragTimeout),b.track.transition(0),v.params.scrollbarHide&&b.track.css("opacity",1),v.wrapper.transition(100),b.drag.transition(100),v.emit("onScrollbarDragStart",v)},dragMove:function(a){var b=v.scrollbar;b.isTouched&&(a.preventDefault?a.preventDefault():a.returnValue=!1,b.setDragPosition(a),v.wrapper.transition(0),b.track.transition(0),b.drag.transition(0),v.emit("onScrollbarDragMove",v))},dragEnd:function(a){var b=v.scrollbar;b.isTouched&&(b.isTouched=!1,v.params.scrollbarHide&&(clearTimeout(b.dragTimeout),b.dragTimeout=setTimeout(function(){b.track.css("opacity",0),b.track.transition(400)},1e3)),v.emit("onScrollbarDragEnd",v),v.params.scrollbarSnapOnRelease&&v.slideReset())},draggableEvents:function(){return!1!==v.params.simulateTouch||v.support.touch?v.touchEvents:v.touchEventsDesktop}(),enableDraggable:function(){var b=v.scrollbar,c=v.support.touch?b.track:document;a(b.track).on(b.draggableEvents.start,b.dragStart),a(c).on(b.draggableEvents.move,b.dragMove),a(c).on(b.draggableEvents.end,b.dragEnd)},disableDraggable:function(){var b=v.scrollbar,c=v.support.touch?b.track:document;a(b.track).off(b.draggableEvents.start,b.dragStart),a(c).off(b.draggableEvents.move,b.dragMove),a(c).off(b.draggableEvents.end,b.dragEnd)},set:function(){if(v.params.scrollbar){var b=v.scrollbar;b.track=a(v.params.scrollbar),v.params.uniqueNavElements&&"string"==typeof v.params.scrollbar&&b.track.length>1&&1===v.container.find(v.params.scrollbar).length&&(b.track=v.container.find(v.params.scrollbar)),b.drag=b.track.find(".swiper-scrollbar-drag"),0===b.drag.length&&(b.drag=a('<div class="swiper-scrollbar-drag"></div>'),b.track.append(b.drag)),b.drag[0].style.width="",b.drag[0].style.height="",b.trackSize=v.isHorizontal()?b.track[0].offsetWidth:b.track[0].offsetHeight,b.divider=v.size/v.virtualSize,b.moveDivider=b.divider*(b.trackSize/v.size),b.dragSize=b.trackSize*b.divider,v.isHorizontal()?b.drag[0].style.width=b.dragSize+"px":b.drag[0].style.height=b.dragSize+"px",b.divider>=1?b.track[0].style.display="none":b.track[0].style.display="",v.params.scrollbarHide&&(b.track[0].style.opacity=0)}},setTranslate:function(){if(v.params.scrollbar){var a,b=v.scrollbar,c=(v.translate,b.dragSize);a=(b.trackSize-b.dragSize)*v.progress,v.rtl&&v.isHorizontal()?(a=-a,a>0?(c=b.dragSize-a,a=0):-a+b.dragSize>b.trackSize&&(c=b.trackSize+a)):a<0?(c=b.dragSize+a,a=0):a+b.dragSize>b.trackSize&&(c=b.trackSize-a),v.isHorizontal()?(v.support.transforms3d?b.drag.transform("translate3d("+a+"px, 0, 0)"):b.drag.transform("translateX("+a+"px)"),b.drag[0].style.width=c+"px"):(v.support.transforms3d?b.drag.transform("translate3d(0px, "+a+"px, 0)"):b.drag.transform("translateY("+a+"px)"),b.drag[0].style.height=c+"px"),v.params.scrollbarHide&&(clearTimeout(b.timeout),b.track[0].style.opacity=1,b.timeout=setTimeout(function(){b.track[0].style.opacity=0,b.track.transition(400)},1e3))}},setTransition:function(a){v.params.scrollbar&&v.scrollbar.drag.transition(a)}},v.controller={LinearSpline:function(a,b){var c=function(){var a,b,c;return function(d,e){for(b=-1,a=d.length;a-b>1;)d[c=a+b>>1]<=e?b=c:a=c;return a}}();this.x=a,this.y=b,this.lastIndex=a.length-1;var d,e;this.x.length;this.interpolate=function(a){return a?(e=c(this.x,a),d=e-1,(a-this.x[d])*(this.y[e]-this.y[d])/(this.x[e]-this.x[d])+this.y[d]):0}},getInterpolateFunction:function(a){v.controller.spline||(v.controller.spline=v.params.loop?new v.controller.LinearSpline(v.slidesGrid,a.slidesGrid):new v.controller.LinearSpline(v.snapGrid,a.snapGrid))},setTranslate:function(a,b){function d(b){a=b.rtl&&"horizontal"===b.params.direction?-v.translate:v.translate,"slide"===v.params.controlBy&&(v.controller.getInterpolateFunction(b),f=-v.controller.spline.interpolate(-a)),f&&"container"!==v.params.controlBy||(e=(b.maxTranslate()-b.minTranslate())/(v.maxTranslate()-v.minTranslate()),f=(a-v.minTranslate())*e+b.minTranslate()),v.params.controlInverse&&(f=b.maxTranslate()-f),b.updateProgress(f),b.setWrapperTranslate(f,!1,v),b.updateActiveIndex()}var e,f,g=v.params.control;if(Array.isArray(g))for(var h=0;h<g.length;h++)g[h]!==b&&g[h]instanceof c&&d(g[h]);else g instanceof c&&b!==g&&d(g)},setTransition:function(a,b){function d(b){b.setWrapperTransition(a,v),0!==a&&(b.onTransitionStart(),b.wrapper.transitionEnd(function(){f&&(b.params.loop&&"slide"===v.params.controlBy&&b.fixLoop(),b.onTransitionEnd())}))}var e,f=v.params.control;if(Array.isArray(f))for(e=0;e<f.length;e++)f[e]!==b&&f[e]instanceof c&&d(f[e]);else f instanceof c&&b!==f&&d(f)}},v.hashnav={onHashCange:function(a,b){var c=document.location.hash.replace("#","");c!==v.slides.eq(v.activeIndex).attr("data-hash")&&v.slideTo(v.wrapper.children("."+v.params.slideClass+'[data-hash="'+c+'"]').index())},attachEvents:function(b){var c=b?"off":"on";a(window)[c]("hashchange",v.hashnav.onHashCange)},setHash:function(){if(v.hashnav.initialized&&v.params.hashnav)if(v.params.replaceState&&window.history&&window.history.replaceState)window.history.replaceState(null,null,"#"+v.slides.eq(v.activeIndex).attr("data-hash")||"");else{var a=v.slides.eq(v.activeIndex),b=a.attr("data-hash")||a.attr("data-history");document.location.hash=b||""}},init:function(){if(v.params.hashnav&&!v.params.history){v.hashnav.initialized=!0;var a=document.location.hash.replace("#","");if(a)for(var b=0,c=v.slides.length;b<c;b++){var d=v.slides.eq(b),e=d.attr("data-hash")||d.attr("data-history");if(e===a&&!d.hasClass(v.params.slideDuplicateClass)){var f=d.index();v.slideTo(f,0,v.params.runCallbacksOnInit,!0)}}v.params.hashnavWatchState&&v.hashnav.attachEvents()}},destroy:function(){v.params.hashnavWatchState&&v.hashnav.attachEvents(!0)}},v.history={init:function(){if(v.params.history){if(!window.history||!window.history.pushState)return v.params.history=!1,void(v.params.hashnav=!0);v.history.initialized=!0,this.paths=this.getPathValues(),(this.paths.key||this.paths.value)&&(this.scrollToSlide(0,this.paths.value,v.params.runCallbacksOnInit),v.params.replaceState||window.addEventListener("popstate",this.setHistoryPopState))}},setHistoryPopState:function(){v.history.paths=v.history.getPathValues(),v.history.scrollToSlide(v.params.speed,v.history.paths.value,!1)},getPathValues:function(){var a=window.location.pathname.slice(1).split("/"),b=a.length;return{key:a[b-2],value:a[b-1]}},setHistory:function(a,b){if(v.history.initialized&&v.params.history){var c=v.slides.eq(b),d=this.slugify(c.attr("data-history"));window.location.pathname.includes(a)||(d=a+"/"+d),v.params.replaceState?window.history.replaceState(null,null,d):window.history.pushState(null,null,d)}},slugify:function(a){return a.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},scrollToSlide:function(a,b,c){if(b)for(var d=0,e=v.slides.length;d<e;d++){var f=v.slides.eq(d),g=this.slugify(f.attr("data-history"));if(g===b&&!f.hasClass(v.params.slideDuplicateClass)){var h=f.index();v.slideTo(h,a,c)}}else v.slideTo(0,a,c)}},v.disableKeyboardControl=function(){v.params.keyboardControl=!1,a(document).off("keydown",j)},v.enableKeyboardControl=function(){v.params.keyboardControl=!0,a(document).on("keydown",j)},v.mousewheel={event:!1,lastScrollTime:(new window.Date).getTime()},v.params.mousewheelControl&&(v.mousewheel.event=navigator.userAgent.indexOf("firefox")>-1?"DOMMouseScroll":function(){var a="onwheel"in document;if(!a){var b=document.createElement("div");b.setAttribute("onwheel","return;"),a="function"==typeof b.onwheel}return!a&&document.implementation&&document.implementation.hasFeature&&!0!==document.implementation.hasFeature("","")&&(a=document.implementation.hasFeature("Events.wheel","3.0")),a}()?"wheel":"mousewheel"),v.disableMousewheelControl=function(){if(!v.mousewheel.event)return!1;var b=v.container;return"container"!==v.params.mousewheelEventsTarged&&(b=a(v.params.mousewheelEventsTarged)),b.off(v.mousewheel.event,l),v.params.mousewheelControl=!1,!0},v.enableMousewheelControl=function(){if(!v.mousewheel.event)return!1;var b=v.container;return"container"!==v.params.mousewheelEventsTarged&&(b=a(v.params.mousewheelEventsTarged)),b.on(v.mousewheel.event,l),v.params.mousewheelControl=!0,!0},v.parallax={setTranslate:function(){v.container.children("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){m(this,v.progress)}),v.slides.each(function(){var b=a(this);b.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){m(this,Math.min(Math.max(b[0].progress,-1),1))})})},setTransition:function(b){void 0===b&&(b=v.params.speed),v.container.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){var c=a(this),d=parseInt(c.attr("data-swiper-parallax-duration"),10)||b;0===b&&(d=0),c.transition(d)})}},v.zoom={scale:1,currentScale:1,isScaling:!1,gesture:{slide:void 0,slideWidth:void 0,slideHeight:void 0,image:void 0,imageWrap:void 0,zoomMax:v.params.zoomMax},image:{isTouched:void 0,isMoved:void 0,currentX:void 0,currentY:void 0,minX:void 0,minY:void 0,maxX:void 0,maxY:void 0,width:void 0,height:void 0,startX:void 0,startY:void 0,touchesStart:{},touchesCurrent:{}},velocity:{x:void 0,y:void 0,prevPositionX:void 0,prevPositionY:void 0,prevTime:void 0},getDistanceBetweenTouches:function(a){if(a.targetTouches.length<2)return 1;var b=a.targetTouches[0].pageX,c=a.targetTouches[0].pageY,d=a.targetTouches[1].pageX,e=a.targetTouches[1].pageY;return Math.sqrt(Math.pow(d-b,2)+Math.pow(e-c,2))},onGestureStart:function(b){var c=v.zoom;if(!v.support.gestures){if("touchstart"!==b.type||"touchstart"===b.type&&b.targetTouches.length<2)return;c.gesture.scaleStart=c.getDistanceBetweenTouches(b)}if(!(c.gesture.slide&&c.gesture.slide.length||(c.gesture.slide=a(this),0===c.gesture.slide.length&&(c.gesture.slide=v.slides.eq(v.activeIndex)),c.gesture.image=c.gesture.slide.find("img, svg, canvas"),c.gesture.imageWrap=c.gesture.image.parent("."+v.params.zoomContainerClass),c.gesture.zoomMax=c.gesture.imageWrap.attr("data-swiper-zoom")||v.params.zoomMax,0!==c.gesture.imageWrap.length)))return void(c.gesture.image=void 0);c.gesture.image.transition(0),c.isScaling=!0},onGestureChange:function(a){var b=v.zoom;if(!v.support.gestures){if("touchmove"!==a.type||"touchmove"===a.type&&a.targetTouches.length<2)return;b.gesture.scaleMove=b.getDistanceBetweenTouches(a)}b.gesture.image&&0!==b.gesture.image.length&&(v.support.gestures?b.scale=a.scale*b.currentScale:b.scale=b.gesture.scaleMove/b.gesture.scaleStart*b.currentScale,b.scale>b.gesture.zoomMax&&(b.scale=b.gesture.zoomMax-1+Math.pow(b.scale-b.gesture.zoomMax+1,.5)),b.scale<v.params.zoomMin&&(b.scale=v.params.zoomMin+1-Math.pow(v.params.zoomMin-b.scale+1,.5)),b.gesture.image.transform("translate3d(0,0,0) scale("+b.scale+")"))},onGestureEnd:function(a){var b=v.zoom;!v.support.gestures&&("touchend"!==a.type||"touchend"===a.type&&a.changedTouches.length<2)||b.gesture.image&&0!==b.gesture.image.length&&(b.scale=Math.max(Math.min(b.scale,b.gesture.zoomMax),v.params.zoomMin),b.gesture.image.transition(v.params.speed).transform("translate3d(0,0,0) scale("+b.scale+")"),b.currentScale=b.scale,b.isScaling=!1,1===b.scale&&(b.gesture.slide=void 0))},onTouchStart:function(a,b){var c=a.zoom;c.gesture.image&&0!==c.gesture.image.length&&(c.image.isTouched||("android"===a.device.os&&b.preventDefault(),c.image.isTouched=!0,c.image.touchesStart.x="touchstart"===b.type?b.targetTouches[0].pageX:b.pageX,c.image.touchesStart.y="touchstart"===b.type?b.targetTouches[0].pageY:b.pageY))},onTouchMove:function(a){var b=v.zoom;if(b.gesture.image&&0!==b.gesture.image.length&&(v.allowClick=!1,b.image.isTouched&&b.gesture.slide)){b.image.isMoved||(b.image.width=b.gesture.image[0].offsetWidth,b.image.height=b.gesture.image[0].offsetHeight,b.image.startX=v.getTranslate(b.gesture.imageWrap[0],"x")||0,b.image.startY=v.getTranslate(b.gesture.imageWrap[0],"y")||0,b.gesture.slideWidth=b.gesture.slide[0].offsetWidth,b.gesture.slideHeight=b.gesture.slide[0].offsetHeight,b.gesture.imageWrap.transition(0),v.rtl&&(b.image.startX=-b.image.startX),v.rtl&&(b.image.startY=-b.image.startY));var c=b.image.width*b.scale,d=b.image.height*b.scale;if(!(c<b.gesture.slideWidth&&d<b.gesture.slideHeight)){if(b.image.minX=Math.min(b.gesture.slideWidth/2-c/2,0),b.image.maxX=-b.image.minX,b.image.minY=Math.min(b.gesture.slideHeight/2-d/2,0),b.image.maxY=-b.image.minY,b.image.touchesCurrent.x="touchmove"===a.type?a.targetTouches[0].pageX:a.pageX,b.image.touchesCurrent.y="touchmove"===a.type?a.targetTouches[0].pageY:a.pageY,!b.image.isMoved&&!b.isScaling){if(v.isHorizontal()&&Math.floor(b.image.minX)===Math.floor(b.image.startX)&&b.image.touchesCurrent.x<b.image.touchesStart.x||Math.floor(b.image.maxX)===Math.floor(b.image.startX)&&b.image.touchesCurrent.x>b.image.touchesStart.x)return void(b.image.isTouched=!1);if(!v.isHorizontal()&&Math.floor(b.image.minY)===Math.floor(b.image.startY)&&b.image.touchesCurrent.y<b.image.touchesStart.y||Math.floor(b.image.maxY)===Math.floor(b.image.startY)&&b.image.touchesCurrent.y>b.image.touchesStart.y)return void(b.image.isTouched=!1)}a.preventDefault(),a.stopPropagation(),b.image.isMoved=!0,b.image.currentX=b.image.touchesCurrent.x-b.image.touchesStart.x+b.image.startX,b.image.currentY=b.image.touchesCurrent.y-b.image.touchesStart.y+b.image.startY,b.image.currentX<b.image.minX&&(b.image.currentX=b.image.minX+1-Math.pow(b.image.minX-b.image.currentX+1,.8)),b.image.currentX>b.image.maxX&&(b.image.currentX=b.image.maxX-1+Math.pow(b.image.currentX-b.image.maxX+1,.8)),b.image.currentY<b.image.minY&&(b.image.currentY=b.image.minY+1-Math.pow(b.image.minY-b.image.currentY+1,.8)),b.image.currentY>b.image.maxY&&(b.image.currentY=b.image.maxY-1+Math.pow(b.image.currentY-b.image.maxY+1,.8)),b.velocity.prevPositionX||(b.velocity.prevPositionX=b.image.touchesCurrent.x),b.velocity.prevPositionY||(b.velocity.prevPositionY=b.image.touchesCurrent.y),b.velocity.prevTime||(b.velocity.prevTime=Date.now()),b.velocity.x=(b.image.touchesCurrent.x-b.velocity.prevPositionX)/(Date.now()-b.velocity.prevTime)/2,b.velocity.y=(b.image.touchesCurrent.y-b.velocity.prevPositionY)/(Date.now()-b.velocity.prevTime)/2,Math.abs(b.image.touchesCurrent.x-b.velocity.prevPositionX)<2&&(b.velocity.x=0),Math.abs(b.image.touchesCurrent.y-b.velocity.prevPositionY)<2&&(b.velocity.y=0),b.velocity.prevPositionX=b.image.touchesCurrent.x,b.velocity.prevPositionY=b.image.touchesCurrent.y,b.velocity.prevTime=Date.now(),b.gesture.imageWrap.transform("translate3d("+b.image.currentX+"px, "+b.image.currentY+"px,0)")}}},onTouchEnd:function(a,b){var c=a.zoom;if(c.gesture.image&&0!==c.gesture.image.length){if(!c.image.isTouched||!c.image.isMoved)return c.image.isTouched=!1,void(c.image.isMoved=!1);c.image.isTouched=!1,c.image.isMoved=!1;var d=300,e=300,f=c.velocity.x*d,g=c.image.currentX+f,h=c.velocity.y*e,i=c.image.currentY+h;0!==c.velocity.x&&(d=Math.abs((g-c.image.currentX)/c.velocity.x)),0!==c.velocity.y&&(e=Math.abs((i-c.image.currentY)/c.velocity.y));var j=Math.max(d,e);c.image.currentX=g,c.image.currentY=i;var k=c.image.width*c.scale,l=c.image.height*c.scale;c.image.minX=Math.min(c.gesture.slideWidth/2-k/2,0),c.image.maxX=-c.image.minX,c.image.minY=Math.min(c.gesture.slideHeight/2-l/2,0),c.image.maxY=-c.image.minY,c.image.currentX=Math.max(Math.min(c.image.currentX,c.image.maxX),c.image.minX),c.image.currentY=Math.max(Math.min(c.image.currentY,c.image.maxY),c.image.minY),c.gesture.imageWrap.transition(j).transform("translate3d("+c.image.currentX+"px, "+c.image.currentY+"px,0)")}},onTransitionEnd:function(a){var b=a.zoom;b.gesture.slide&&a.previousIndex!==a.activeIndex&&(b.gesture.image.transform("translate3d(0,0,0) scale(1)"),b.gesture.imageWrap.transform("translate3d(0,0,0)"),b.gesture.slide=b.gesture.image=b.gesture.imageWrap=void 0,b.scale=b.currentScale=1)},toggleZoom:function(b,c){var d=b.zoom;if(d.gesture.slide||(d.gesture.slide=b.clickedSlide?a(b.clickedSlide):b.slides.eq(b.activeIndex),d.gesture.image=d.gesture.slide.find("img, svg, canvas"),d.gesture.imageWrap=d.gesture.image.parent("."+b.params.zoomContainerClass)),d.gesture.image&&0!==d.gesture.image.length){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;void 0===d.image.touchesStart.x&&c?(e="touchend"===c.type?c.changedTouches[0].pageX:c.pageX,f="touchend"===c.type?c.changedTouches[0].pageY:c.pageY):(e=d.image.touchesStart.x,f=d.image.touchesStart.y),d.scale&&1!==d.scale?(d.scale=d.currentScale=1,d.gesture.imageWrap.transition(300).transform("translate3d(0,0,0)"),d.gesture.image.transition(300).transform("translate3d(0,0,0) scale(1)"),d.gesture.slide=void 0):(d.scale=d.currentScale=d.gesture.imageWrap.attr("data-swiper-zoom")||b.params.zoomMax,c?(u=d.gesture.slide[0].offsetWidth,v=d.gesture.slide[0].offsetHeight,g=d.gesture.slide.offset().left,h=d.gesture.slide.offset().top,i=g+u/2-e,j=h+v/2-f,m=d.gesture.image[0].offsetWidth,n=d.gesture.image[0].offsetHeight,o=m*d.scale,p=n*d.scale,q=Math.min(u/2-o/2,0),r=Math.min(v/2-p/2,0),s=-q,t=-r,k=i*d.scale,l=j*d.scale,k<q&&(k=q),k>s&&(k=s),l<r&&(l=r),l>t&&(l=t)):(k=0,l=0),d.gesture.imageWrap.transition(300).transform("translate3d("+k+"px, "+l+"px,0)"),d.gesture.image.transition(300).transform("translate3d(0,0,0) scale("+d.scale+")"))}},attachEvents:function(b){var c=b?"off":"on";if(v.params.zoom){var d=(v.slides,!("touchstart"!==v.touchEvents.start||!v.support.passiveListener||!v.params.passiveListeners)&&{passive:!0,capture:!1});v.support.gestures?(v.slides[c]("gesturestart",v.zoom.onGestureStart,d),v.slides[c]("gesturechange",v.zoom.onGestureChange,d),v.slides[c]("gestureend",v.zoom.onGestureEnd,d)):"touchstart"===v.touchEvents.start&&(v.slides[c](v.touchEvents.start,v.zoom.onGestureStart,d),v.slides[c](v.touchEvents.move,v.zoom.onGestureChange,d),v.slides[c](v.touchEvents.end,v.zoom.onGestureEnd,d)),v[c]("touchStart",v.zoom.onTouchStart),v.slides.each(function(b,d){a(d).find("."+v.params.zoomContainerClass).length>0&&a(d)[c](v.touchEvents.move,v.zoom.onTouchMove)}),v[c]("touchEnd",v.zoom.onTouchEnd),v[c]("transitionEnd",v.zoom.onTransitionEnd),v.params.zoomToggle&&v.on("doubleTap",v.zoom.toggleZoom)}},init:function(){v.zoom.attachEvents()},destroy:function(){v.zoom.attachEvents(!0)}},v._plugins=[];for(var M in v.plugins){var N=v.plugins[M](v,v.params[M]);N&&v._plugins.push(N)}return v.callPlugins=function(a){for(var b=0;b<v._plugins.length;b++)a in v._plugins[b]&&v._plugins[b][a](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},v.emitterEventListeners={},v.emit=function(a){v.params[a]&&v.params[a](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);var b;if(v.emitterEventListeners[a])for(b=0;b<v.emitterEventListeners[a].length;b++)v.emitterEventListeners[a][b](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);v.callPlugins&&v.callPlugins(a,arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},v.on=function(a,b){return a=n(a),v.emitterEventListeners[a]||(v.emitterEventListeners[a]=[]),v.emitterEventListeners[a].push(b),v},v.off=function(a,b){var c;if(a=n(a),void 0===b)return v.emitterEventListeners[a]=[],v;if(v.emitterEventListeners[a]&&0!==v.emitterEventListeners[a].length){for(c=0;c<v.emitterEventListeners[a].length;c++)v.emitterEventListeners[a][c]===b&&v.emitterEventListeners[a].splice(c,1);return v}},v.once=function(a,b){a=n(a);var c=function(){b(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]),v.off(a,c)};return v.on(a,c),v},v.a11y={makeFocusable:function(a){return a.attr("tabIndex","0"),a},addRole:function(a,b){return a.attr("role",b),a},addLabel:function(a,b){return a.attr("aria-label",b),a},disable:function(a){return a.attr("aria-disabled",!0),a},enable:function(a){return a.attr("aria-disabled",!1),a},onEnterKey:function(b){13===b.keyCode&&(a(b.target).is(v.params.nextButton)?(v.onClickNext(b),v.isEnd?v.a11y.notify(v.params.lastSlideMessage):v.a11y.notify(v.params.nextSlideMessage)):a(b.target).is(v.params.prevButton)&&(v.onClickPrev(b),v.isBeginning?v.a11y.notify(v.params.firstSlideMessage):v.a11y.notify(v.params.prevSlideMessage)),a(b.target).is("."+v.params.bulletClass)&&a(b.target)[0].click())},liveRegion:a('<span class="'+v.params.notificationClass+'" aria-live="assertive" aria-atomic="true"></span>'),notify:function(a){var b=v.a11y.liveRegion;0!==b.length&&(b.html(""),b.html(a))},init:function(){v.params.nextButton&&v.nextButton&&v.nextButton.length>0&&(v.a11y.makeFocusable(v.nextButton),v.a11y.addRole(v.nextButton,"button"),v.a11y.addLabel(v.nextButton,v.params.nextSlideMessage)),v.params.prevButton&&v.prevButton&&v.prevButton.length>0&&(v.a11y.makeFocusable(v.prevButton),v.a11y.addRole(v.prevButton,"button"),v.a11y.addLabel(v.prevButton,v.params.prevSlideMessage)),a(v.container).append(v.a11y.liveRegion)},initPagination:function(){v.params.pagination&&v.params.paginationClickable&&v.bullets&&v.bullets.length&&v.bullets.each(function(){var b=a(this);v.a11y.makeFocusable(b),v.a11y.addRole(b,"button"),v.a11y.addLabel(b,v.params.paginationBulletMessage.replace(/{{index}}/,b.index()+1))})},destroy:function(){v.a11y.liveRegion&&v.a11y.liveRegion.length>0&&v.a11y.liveRegion.remove()}},v.init=function(){v.params.loop&&v.createLoop(),v.updateContainerSize(),v.updateSlidesSize(),v.updatePagination(),v.params.scrollbar&&v.scrollbar&&(v.scrollbar.set(),v.params.scrollbarDraggable&&v.scrollbar.enableDraggable()),"slide"!==v.params.effect&&v.effects[v.params.effect]&&(v.params.loop||v.updateProgress(),v.effects[v.params.effect].setTranslate()),v.params.loop?v.slideTo(v.params.initialSlide+v.loopedSlides,0,v.params.runCallbacksOnInit):(v.slideTo(v.params.initialSlide,0,v.params.runCallbacksOnInit),0===v.params.initialSlide&&(v.parallax&&v.params.parallax&&v.parallax.setTranslate(),v.lazy&&v.params.lazyLoading&&(v.lazy.load(),v.lazy.initialImageLoaded=!0))),v.attachEvents(),v.params.observer&&v.support.observer&&v.initObservers(),v.params.preloadImages&&!v.params.lazyLoading&&v.preloadImages(),v.params.zoom&&v.zoom&&v.zoom.init(),v.params.autoplay&&v.startAutoplay(),v.params.keyboardControl&&v.enableKeyboardControl&&v.enableKeyboardControl(),v.params.mousewheelControl&&v.enableMousewheelControl&&v.enableMousewheelControl(),v.params.hashnavReplaceState&&(v.params.replaceState=v.params.hashnavReplaceState),v.params.history&&v.history&&v.history.init(),v.params.hashnav&&v.hashnav&&v.hashnav.init(),v.params.a11y&&v.a11y&&v.a11y.init(),v.emit("onInit",v)},v.cleanupStyles=function(){v.container.removeClass(v.classNames.join(" ")).removeAttr("style"),v.wrapper.removeAttr("style"),v.slides&&v.slides.length&&v.slides.removeClass([v.params.slideVisibleClass,v.params.slideActiveClass,v.params.slideNextClass,v.params.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-column").removeAttr("data-swiper-row"),v.paginationContainer&&v.paginationContainer.length&&v.paginationContainer.removeClass(v.params.paginationHiddenClass),v.bullets&&v.bullets.length&&v.bullets.removeClass(v.params.bulletActiveClass),v.params.prevButton&&a(v.params.prevButton).removeClass(v.params.buttonDisabledClass),v.params.nextButton&&a(v.params.nextButton).removeClass(v.params.buttonDisabledClass),v.params.scrollbar&&v.scrollbar&&(v.scrollbar.track&&v.scrollbar.track.length&&v.scrollbar.track.removeAttr("style"),v.scrollbar.drag&&v.scrollbar.drag.length&&v.scrollbar.drag.removeAttr("style"))},v.destroy=function(a,b){v.detachEvents(),v.stopAutoplay(),v.params.scrollbar&&v.scrollbar&&v.params.scrollbarDraggable&&v.scrollbar.disableDraggable(),v.params.loop&&v.destroyLoop(),b&&v.cleanupStyles(),v.disconnectObservers(),v.params.zoom&&v.zoom&&v.zoom.destroy(),v.params.keyboardControl&&v.disableKeyboardControl&&v.disableKeyboardControl(),v.params.mousewheelControl&&v.disableMousewheelControl&&v.disableMousewheelControl(),v.params.a11y&&v.a11y&&v.a11y.destroy(),v.params.history&&!v.params.replaceState&&window.removeEventListener("popstate",v.history.setHistoryPopState),v.params.hashnav&&v.hashnav&&v.hashnav.destroy(),v.emit("onDestroy"),!1!==a&&(v=null)},v.init(),v}};c.prototype={isSafari:function(){var a=window.navigator.userAgent.toLowerCase();return a.indexOf("safari")>=0&&a.indexOf("chrome")<0&&a.indexOf("android")<0}(),isUiWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(window.navigator.userAgent),isArray:function(a){return"[object Array]"===Object.prototype.toString.apply(a)},browser:{ie:window.navigator.pointerEnabled||window.navigator.msPointerEnabled,ieTouch:window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>1||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>1,lteIE9:function(){var a=document.createElement("div");return a.innerHTML="\x3c!--[if lte IE 9]><i></i><![endif]--\x3e",1===a.getElementsByTagName("i").length}()},device:function(){var a=window.navigator.userAgent,b=a.match(/(Android);?[\s\/]+([\d.]+)?/),c=a.match(/(iPad).*OS\s([\d_]+)/),d=a.match(/(iPod)(.*OS\s([\d_]+))?/),e=!c&&a.match(/(iPhone\sOS|iOS)\s([\d_]+)/);return{ios:c||e||d,android:b}}(),support:{touch:window.Modernizr&&!0===Modernizr.touch||function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}(),transforms3d:window.Modernizr&&!0===Modernizr.csstransforms3d||function(){var a=document.createElement("div").style;return"webkitPerspective"in a||"MozPerspective"in a||"OPerspective"in a||"MsPerspective"in a||"perspective"in a}(),flexbox:function(){for(var a=document.createElement("div").style,b="alignItems webkitAlignItems webkitBoxAlign msFlexAlign mozBoxAlign webkitFlexDirection msFlexDirection mozBoxDirection mozBoxOrient webkitBoxDirection webkitBoxOrient".split(" "),c=0;c<b.length;c++)if(b[c]in a)return!0}(),observer:function(){return"MutationObserver"in window||"WebkitMutationObserver"in window}(),passiveListener:function(){var a=!1;try{var b=Object.defineProperty({},"passive",{get:function(){a=!0}});window.addEventListener("testPassiveListener",null,b)}catch(a){}return a}(),gestures:function(){return"ongesturestart"in window
}()},plugins:{}};for(var d=(function(){var a=function(a){var b=this,c=0;for(c=0;c<a.length;c++)b[c]=a[c];return b.length=a.length,this},b=function(b,c){var d=[],e=0;if(b&&!c&&b instanceof a)return b;if(b)if("string"==typeof b){var f,g,h=b.trim();if(h.indexOf("<")>=0&&h.indexOf(">")>=0){var i="div";for(0===h.indexOf("<li")&&(i="ul"),0===h.indexOf("<tr")&&(i="tbody"),0!==h.indexOf("<td")&&0!==h.indexOf("<th")||(i="tr"),0===h.indexOf("<tbody")&&(i="table"),0===h.indexOf("<option")&&(i="select"),g=document.createElement(i),g.innerHTML=b,e=0;e<g.childNodes.length;e++)d.push(g.childNodes[e])}else for(f=c||"#"!==b[0]||b.match(/[ .<>:~]/)?(c||document).querySelectorAll(b):[document.getElementById(b.split("#")[1])],e=0;e<f.length;e++)f[e]&&d.push(f[e])}else if(b.nodeType||b===window||b===document)d.push(b);else if(b.length>0&&b[0].nodeType)for(e=0;e<b.length;e++)d.push(b[e]);return new a(d)};return a.prototype={addClass:function(a){if(void 0===a)return this;for(var b=a.split(" "),c=0;c<b.length;c++)for(var d=0;d<this.length;d++)this[d].classList.add(b[c]);return this},removeClass:function(a){for(var b=a.split(" "),c=0;c<b.length;c++)for(var d=0;d<this.length;d++)this[d].classList.remove(b[c]);return this},hasClass:function(a){return!!this[0]&&this[0].classList.contains(a)},toggleClass:function(a){for(var b=a.split(" "),c=0;c<b.length;c++)for(var d=0;d<this.length;d++)this[d].classList.toggle(b[c]);return this},attr:function(a,b){if(1===arguments.length&&"string"==typeof a)return this[0]?this[0].getAttribute(a):void 0;for(var c=0;c<this.length;c++)if(2===arguments.length)this[c].setAttribute(a,b);else for(var d in a)this[c][d]=a[d],this[c].setAttribute(d,a[d]);return this},removeAttr:function(a){for(var b=0;b<this.length;b++)this[b].removeAttribute(a);return this},data:function(a,b){if(void 0!==b){for(var c=0;c<this.length;c++){var d=this[c];d.dom7ElementDataStorage||(d.dom7ElementDataStorage={}),d.dom7ElementDataStorage[a]=b}return this}if(this[0]){var e=this[0].getAttribute("data-"+a);return e||(this[0].dom7ElementDataStorage&&a in this[0].dom7ElementDataStorage?this[0].dom7ElementDataStorage[a]:void 0)}},transform:function(a){for(var b=0;b<this.length;b++){var c=this[b].style;c.webkitTransform=c.MsTransform=c.msTransform=c.MozTransform=c.OTransform=c.transform=a}return this},transition:function(a){"string"!=typeof a&&(a+="ms");for(var b=0;b<this.length;b++){var c=this[b].style;c.webkitTransitionDuration=c.MsTransitionDuration=c.msTransitionDuration=c.MozTransitionDuration=c.OTransitionDuration=c.transitionDuration=a}return this},on:function(a,c,d,e){function f(a){var e=a.target;if(b(e).is(c))d.call(e,a);else for(var f=b(e).parents(),g=0;g<f.length;g++)b(f[g]).is(c)&&d.call(f[g],a)}var g,h,i=a.split(" ");for(g=0;g<this.length;g++)if("function"==typeof c||!1===c)for("function"==typeof c&&(d=arguments[1],e=arguments[2]||!1),h=0;h<i.length;h++)this[g].addEventListener(i[h],d,e);else for(h=0;h<i.length;h++)this[g].dom7LiveListeners||(this[g].dom7LiveListeners=[]),this[g].dom7LiveListeners.push({listener:d,liveListener:f}),this[g].addEventListener(i[h],f,e);return this},off:function(a,b,c,d){for(var e=a.split(" "),f=0;f<e.length;f++)for(var g=0;g<this.length;g++)if("function"==typeof b||!1===b)"function"==typeof b&&(c=arguments[1],d=arguments[2]||!1),this[g].removeEventListener(e[f],c,d);else if(this[g].dom7LiveListeners)for(var h=0;h<this[g].dom7LiveListeners.length;h++)this[g].dom7LiveListeners[h].listener===c&&this[g].removeEventListener(e[f],this[g].dom7LiveListeners[h].liveListener,d);return this},once:function(a,b,c,d){function e(g){c(g),f.off(a,b,e,d)}var f=this;"function"==typeof b&&(b=!1,c=arguments[1],d=arguments[2]),f.on(a,b,e,d)},trigger:function(a,b){for(var c=0;c<this.length;c++){var d;try{d=new window.CustomEvent(a,{detail:b,bubbles:!0,cancelable:!0})}catch(c){d=document.createEvent("Event"),d.initEvent(a,!0,!0),d.detail=b}this[c].dispatchEvent(d)}return this},transitionEnd:function(a){function b(f){if(f.target===this)for(a.call(this,f),c=0;c<d.length;c++)e.off(d[c],b)}var c,d=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],e=this;if(a)for(c=0;c<d.length;c++)e.on(d[c],b);return this},width:function(){return this[0]===window?window.innerWidth:this.length>0?parseFloat(this.css("width")):null},outerWidth:function(a){return this.length>0?a?this[0].offsetWidth+parseFloat(this.css("margin-right"))+parseFloat(this.css("margin-left")):this[0].offsetWidth:null},height:function(){return this[0]===window?window.innerHeight:this.length>0?parseFloat(this.css("height")):null},outerHeight:function(a){return this.length>0?a?this[0].offsetHeight+parseFloat(this.css("margin-top"))+parseFloat(this.css("margin-bottom")):this[0].offsetHeight:null},offset:function(){if(this.length>0){var a=this[0],b=a.getBoundingClientRect(),c=document.body,d=a.clientTop||c.clientTop||0,e=a.clientLeft||c.clientLeft||0,f=window.pageYOffset||a.scrollTop,g=window.pageXOffset||a.scrollLeft;return{top:b.top+f-d,left:b.left+g-e}}return null},css:function(a,b){var c;if(1===arguments.length){if("string"!=typeof a){for(c=0;c<this.length;c++)for(var d in a)this[c].style[d]=a[d];return this}if(this[0])return window.getComputedStyle(this[0],null).getPropertyValue(a)}if(2===arguments.length&&"string"==typeof a){for(c=0;c<this.length;c++)this[c].style[a]=b;return this}return this},each:function(a){for(var b=0;b<this.length;b++)a.call(this[b],b,this[b]);return this},html:function(a){if(void 0===a)return this[0]?this[0].innerHTML:void 0;for(var b=0;b<this.length;b++)this[b].innerHTML=a;return this},text:function(a){if(void 0===a)return this[0]?this[0].textContent.trim():null;for(var b=0;b<this.length;b++)this[b].textContent=a;return this},is:function(c){if(!this[0])return!1;var d,e;if("string"==typeof c){var f=this[0];if(f===document)return c===document;if(f===window)return c===window;if(f.matches)return f.matches(c);if(f.webkitMatchesSelector)return f.webkitMatchesSelector(c);if(f.mozMatchesSelector)return f.mozMatchesSelector(c);if(f.msMatchesSelector)return f.msMatchesSelector(c);for(d=b(c),e=0;e<d.length;e++)if(d[e]===this[0])return!0;return!1}if(c===document)return this[0]===document;if(c===window)return this[0]===window;if(c.nodeType||c instanceof a){for(d=c.nodeType?[c]:c,e=0;e<d.length;e++)if(d[e]===this[0])return!0;return!1}return!1},index:function(){if(this[0]){for(var a=this[0],b=0;null!==(a=a.previousSibling);)1===a.nodeType&&b++;return b}},eq:function(b){if(void 0===b)return this;var c,d=this.length;return b>d-1?new a([]):b<0?(c=d+b,new a(c<0?[]:[this[c]])):new a([this[b]])},append:function(b){var c,d;for(c=0;c<this.length;c++)if("string"==typeof b){var e=document.createElement("div");for(e.innerHTML=b;e.firstChild;)this[c].appendChild(e.firstChild)}else if(b instanceof a)for(d=0;d<b.length;d++)this[c].appendChild(b[d]);else this[c].appendChild(b);return this},prepend:function(b){var c,d;for(c=0;c<this.length;c++)if("string"==typeof b){var e=document.createElement("div");for(e.innerHTML=b,d=e.childNodes.length-1;d>=0;d--)this[c].insertBefore(e.childNodes[d],this[c].childNodes[0])}else if(b instanceof a)for(d=0;d<b.length;d++)this[c].insertBefore(b[d],this[c].childNodes[0]);else this[c].insertBefore(b,this[c].childNodes[0]);return this},insertBefore:function(a){for(var c=b(a),d=0;d<this.length;d++)if(1===c.length)c[0].parentNode.insertBefore(this[d],c[0]);else if(c.length>1)for(var e=0;e<c.length;e++)c[e].parentNode.insertBefore(this[d].cloneNode(!0),c[e])},insertAfter:function(a){for(var c=b(a),d=0;d<this.length;d++)if(1===c.length)c[0].parentNode.insertBefore(this[d],c[0].nextSibling);else if(c.length>1)for(var e=0;e<c.length;e++)c[e].parentNode.insertBefore(this[d].cloneNode(!0),c[e].nextSibling)},next:function(c){return new a(this.length>0?c?this[0].nextElementSibling&&b(this[0].nextElementSibling).is(c)?[this[0].nextElementSibling]:[]:this[0].nextElementSibling?[this[0].nextElementSibling]:[]:[])},nextAll:function(c){var d=[],e=this[0];if(!e)return new a([]);for(;e.nextElementSibling;){var f=e.nextElementSibling;c?b(f).is(c)&&d.push(f):d.push(f),e=f}return new a(d)},prev:function(c){return new a(this.length>0?c?this[0].previousElementSibling&&b(this[0].previousElementSibling).is(c)?[this[0].previousElementSibling]:[]:this[0].previousElementSibling?[this[0].previousElementSibling]:[]:[])},prevAll:function(c){var d=[],e=this[0];if(!e)return new a([]);for(;e.previousElementSibling;){var f=e.previousElementSibling;c?b(f).is(c)&&d.push(f):d.push(f),e=f}return new a(d)},parent:function(a){for(var c=[],d=0;d<this.length;d++)a?b(this[d].parentNode).is(a)&&c.push(this[d].parentNode):c.push(this[d].parentNode);return b(b.unique(c))},parents:function(a){for(var c=[],d=0;d<this.length;d++)for(var e=this[d].parentNode;e;)a?b(e).is(a)&&c.push(e):c.push(e),e=e.parentNode;return b(b.unique(c))},find:function(b){for(var c=[],d=0;d<this.length;d++)for(var e=this[d].querySelectorAll(b),f=0;f<e.length;f++)c.push(e[f]);return new a(c)},children:function(c){for(var d=[],e=0;e<this.length;e++)for(var f=this[e].childNodes,g=0;g<f.length;g++)c?1===f[g].nodeType&&b(f[g]).is(c)&&d.push(f[g]):1===f[g].nodeType&&d.push(f[g]);return new a(b.unique(d))},remove:function(){for(var a=0;a<this.length;a++)this[a].parentNode&&this[a].parentNode.removeChild(this[a]);return this},add:function(){var a,c,d=this;for(a=0;a<arguments.length;a++){var e=b(arguments[a]);for(c=0;c<e.length;c++)d[d.length]=e[c],d.length++}return d}},b.fn=a.prototype,b.unique=function(a){for(var b=[],c=0;c<a.length;c++)-1===b.indexOf(a[c])&&b.push(a[c]);return b},b}()),e=["jQuery","Zepto","Dom7"],f=0;f<e.length;f++)window[e[f]]&&function(a){a.fn.swiper=function(b){var d;return a(this).each(function(){var a=new c(this,b);d||(d=a)}),d}}(window[e[f]]);var g;g=void 0===d?window.Dom7||window.Zepto||window.jQuery:d,g&&("transitionEnd"in g.fn||(g.fn.transitionEnd=function(a){function b(f){if(f.target===this)for(a.call(this,f),c=0;c<d.length;c++)e.off(d[c],b)}var c,d=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],e=this;if(a)for(c=0;c<d.length;c++)e.on(d[c],b);return this}),"transform"in g.fn||(g.fn.transform=function(a){for(var b=0;b<this.length;b++){var c=this[b].style;c.webkitTransform=c.MsTransform=c.msTransform=c.MozTransform=c.OTransform=c.transform=a}return this}),"transition"in g.fn||(g.fn.transition=function(a){"string"!=typeof a&&(a+="ms");for(var b=0;b<this.length;b++){var c=this[b].style;c.webkitTransitionDuration=c.MsTransitionDuration=c.msTransitionDuration=c.MozTransitionDuration=c.OTransitionDuration=c.transitionDuration=a}return this}),"outerWidth"in g.fn||(g.fn.outerWidth=function(a){return this.length>0?a?this[0].offsetWidth+parseFloat(this.css("margin-right"))+parseFloat(this.css("margin-left")):this[0].offsetWidth:null})),b.exports=c}).call(this,"/js/util/Swiper.js")},{}],161:[function(a,b,c){"use strict";var d=a("../util/ajax"),e=a("three"),f={};b.exports={load:function(a,b,c){var g=f[a];return g?(b&&setTimeout(function(){b(g)},1),g):(g=new e.Texture,g.sourceFile=a,f[a]=g,d.getImage(a).then(function(a){g.image=a,g.needsUpdate=!0,b&&b(g)}).fail(c),g)},loadBase64:function(a,b){b=b||"png";var c=new e.Texture;return c.image=document.createElement("img"),c.image.setAttribute("src","data:image/"+b+";base64,"+a),c.needsUpdate=!0,c},loadurl:function(a){var b=new e.TextureLoader;return b.setCrossOrigin(!0),b.load(a)},loadCanvas:function(a){var b=a.replace(/\s*/g,""),c=new RegExp("^[a-zA-Z]+$"),d="rgba(0,0,0,.4)",e="rgba(0,0,0,.4)",f=document.createElement("canvas"),g=f.getContext("2d");g.font="100px Arial";var h,i=g.measureText(a);h=c.test(b)?1.05*i.width+120:i.width+60;var j=h+4,f=document.createElement("canvas"),g=f.getContext("2d");g.canvas.width=j,g.canvas.height=144,g.font="Bold 100px Arial",function(a,b,c,f,g,h){a.beginPath(),a.moveTo(b+h,c),a.lineWidth=1,a.strokeStyle=e,a.fillStyle=d,a.arcTo(b+f,c,b+f,c+g,h),a.arcTo(b+f,c+g,b,c+g,h),a.arcTo(b,c+g,b,c,h),a.arcTo(b,c,b+f,c,h),a.stroke(),a.fill(),a.closePath()}(g,1,1,h+2,142,30),g.fillStyle="rgba(255,255,255, .85)";var h;c.test(b)?g.fillText(a,62,102):g.fillText(a,32,102);var k=new THREE.Texture(f);return k.minFilter=THREE.LinearFilter,k.magFilter=THREE.LinearFilter,k.needsUpdate=!0,k},loadCanvas2:function(a,b){a=a||"";var c=document.createElement("canvas"),d=c.getContext("2d");document.getElementsByTagName("body")[0].appendChild(c),c.width=640,c.height=256;d.font="bold 36px Arial";d.measureText(a).width;d.fillStyle="rgba(255,255,255,.85)";var f=new e.Texture(c);return f.needsUpdate=!0,b.ctx=d,b.text=f,f},loadCanvasIn:function(a,b,c){var d=b||"rgba(255,255,255, .85)",e=c||"rgba(0,0,0,.4)",f=c||"rgba(0,0,0,.4)",g=document.createElement("canvas"),h=g.getContext("2d");h.font="100px Arial";var i=h.measureText(a),j=i.width+60,k=j+4,g=document.createElement("canvas"),h=g.getContext("2d");h.canvas.width=k,h.canvas.height=144,h.font="Bold 100px Arial",function(a,b,c,d,g,h){a.beginPath(),a.moveTo(b+h,c),a.lineWidth=1,a.strokeStyle=f,a.fillStyle=e,a.arcTo(b+d,c,b+d,c+g,h),a.arcTo(b+d,c+g,b,c+g,h),a.arcTo(b,c+g,b,c,h),a.arcTo(b,c,b+d,c,h),a.stroke(),a.fill(),a.closePath()}(h,1,1,j+2,142,30),h.fillStyle=d,h.fillText(a,32,102);var l=new THREE.Texture(g);return l.minFilter=THREE.LinearFilter,l.magFilter=THREE.LinearFilter,l.needsUpdate=!0,l},isLoaded:function(a){return!!f[a]}}},{"../util/ajax":141,three:177}],162:[function(a,b,c){"use strict";var d=a("./easing");b.exports={globalDone:null,funcs:[],counter:0,uniqueID:0,start:function(a,b,c,e,f,g,h){return e=e||0,this.funcs.push({func:a,current:-e*Math.abs(b),duration:(1-Math.max(e,0))*Math.abs(b),done:c,easing:f||d.linearTween,cycling:b<0,running:!0,debug:e<0,name:g||"T"+this.counter,id:void 0===h?this.counter:h,paused:!1}),a(0,16),this.counter+=1,a},trigger:function(a){var b=void 0===a.delayRatio?0:a.delayRatio,c=a.func||function(){},e=void 0===a.duration?0:a.duration;void 0!==a.cycling&&a.cycling&&(e=-Math.abs(e));var f=a.done||null,g=a.easing||d.linearTween,h=a.name||"R"+this.counter,i=void 0===a.id?this.counter:a.id;return this.start(c,e,f,b,g,h,i)},setTimeout:function(a,b,c){var d=void 0===c?this.counter:c;return this.trigger({done:a,duration:void 0===b?0:b,name:"O"+this.counter,id:d})},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(a){this.funcs.forEach(function(b){if(!(b.paused||(b.current+=1e3*a,b.current<0)))if(b.current>=b.duration&&!b.cycling){var c=b.easing(1,0,1,1);b.func(c,1e3*a),b.done&&b.done(),b.running=!1}else{var d=b.easing(b.current%b.duration/b.duration,0,1,1),e=b.func(d,1e3*a)||!1;e&&(b.done&&b.done(),b.running=!1)}});var b=this.funcs.length;this.funcs=this.funcs.filter(function(a){return a.running});var c=this.funcs.length;if(b>0&&0===c&&this.globalDone){var d=this.globalDone;this.globalDone=null,d()}},adjustSpeed:function(a,b){var c=this.get(a);c&&(c.duration/=b,c.current/=b)},getById:function(a){return this.funcs.filter(function(b){return a===b.id})},get:function(a){for(var b=0;b<this.funcs.length;b+=1)if(this.funcs[b].func==a)return this.funcs[b];return null},isRunning:function(a){var b=this.get(a);return null!==b&&b.running},countActive:function(){for(var a=0,b=0;b<this.funcs.length;b+=1)a+=this.funcs[b].running;return a},listActive:function(){for(var a=[],b=0;b<this.funcs.length;b+=1)this.funcs[b].running&&a.push(this.funcs[b].name);return a},done:function(a){this.globalDone=a},cancelById:function(a){var b=void 0===a?0:a;this.funcs=this.funcs.filter(function(a){return a.id!==b})},cancel:function(a){this.funcs=this.funcs.filter(function(b){return b.func!==a})},getUniqueId:function(){return this.uniqueID-=1,this.uniqueID}}},{"./easing":147}],163:[function(a,b,c){var d=function(){$.ajax({url:"https://devnest.3dnest.cn/php/weixin.class.php",data:{callback:"getSignature"},dataType:"script",error:function(a,b,c){},success:function(a){}})};window.getSignature=function(a){a.debug=!1,a.jsApiList=["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","translateVoice","startRecord","stopRecord","onRecordEnd","chooseImage","previewImage","uploadImage","downloadImage","getNetworkType","openLocation","getLocation","closeWindow","scanQRCode","chooseWXPay","openProductSpecificView"],wx.config(a),wx.ready(window.onWxReady),wx.error(function(b){console.log("config error! res="+JSON.stringify(b)),console.log(b.errMsg),console.log("config error! obj="+JSON.stringify(a))})},window.onWxReady=function(){var a=G.settings.nestscenes.backgroundimgurl.replace("http:","https:"),b=G.settings.basic.model.name,c=G.settings.basic.menu.description||G.settings.basic.model.name;c=c.replace(/<br\/>/g,"\n"),c=c.replace(/&nbsp;/g," ");var d={title:b,desc:c,imgUrl:a,success:function(){},cancel:function(){}};wx.onMenuShareAppMessage(d),wx.onMenuShareTimeline(d),wx.onMenuShareQQ(d),wx.onMenuShareWeibo(d),wx.onMenuShareQZone(d)},b.exports=d},{}],164:[function(a,b,c){function d(a){if(this.set={},this.infContains=function(){return!0},"object"==typeof a)if(a instanceof Array)for(var b=0;b<a.length;b++)this.set[a[b]]=!0;else this.set=a;else if("function"==typeof a)this.infContains=a;else if(void 0!==a)throw new Error("set must be either an array or an object.")}b.exports=d,d.prototype.contains=function(a){return!!this.set[a]},d.prototype.has=d.prototype.contains,d.prototype.add=function(a){if(1==arguments.length)this.set[a]=!0;else for(var b=0;b<arguments.length;b++)this.set[arguments[b]]=!0},d.prototype.addAll=function(a){if("object"!=typeof a&&!(a instanceof Array))throw new Error("arr must be an array.");for(var b=0;b<a.length;b++)this.add(a[b])},d.prototype.remove=function(a){if(1==arguments.length)delete this.set[a];else for(var b=0;b<arguments.length;b++)delete this.set[arguments[b]]},d.prototype.delete=d.prototype.remove,d.prototype.clear=function(){this.set={}},d.prototype.size=function(){return Object.keys(this.set).length},d.prototype.toString=function(){return"{"+Object.keys(this.set).toString()+"}"},d.prototype.toArray=function(){return void 0===this.set?[]:Object.keys(this.set)},d.prototype["*values"]=d.prototype.toArray},{}],165:[function(a,b,c){"use strict";function d(a){var b=a.length;if(b%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var c=a.indexOf("=");return-1===c&&(c=b),[c,c===b?0:4-c%4]}function e(a){var b=d(a),c=b[0],e=b[1];return 3*(c+e)/4-e}function f(a,b,c){return 3*(b+c)/4-c}function g(a){for(var b,c=d(a),e=c[0],g=c[1],h=new m(f(a,e,g)),i=0,j=g>0?e-4:e,k=0;k<j;k+=4)b=l[a.charCodeAt(k)]<<18|l[a.charCodeAt(k+1)]<<12|l[a.charCodeAt(k+2)]<<6|l[a.charCodeAt(k+3)],h[i++]=b>>16&255,h[i++]=b>>8&255,h[i++]=255&b;return 2===g&&(b=l[a.charCodeAt(k)]<<2|l[a.charCodeAt(k+1)]>>4,h[i++]=255&b),1===g&&(b=l[a.charCodeAt(k)]<<10|l[a.charCodeAt(k+1)]<<4|l[a.charCodeAt(k+2)]>>2,h[i++]=b>>8&255,h[i++]=255&b),h}function h(a){return k[a>>18&63]+k[a>>12&63]+k[a>>6&63]+k[63&a]}function i(a,b,c){for(var d,e=[],f=b;f<c;f+=3)d=(a[f]<<16&16711680)+(a[f+1]<<8&65280)+(255&a[f+2]),e.push(h(d));return e.join("")}function j(a){for(var b,c=a.length,d=c%3,e=[],f=0,g=c-d;f<g;f+=16383)e.push(i(a,f,f+16383>g?g:f+16383));return 1===d?(b=a[c-1],e.push(k[b>>2]+k[b<<4&63]+"==")):2===d&&(b=(a[c-2]<<8)+a[c-1],e.push(k[b>>10]+k[b>>4&63]+k[b<<2&63]+"=")),e.join("")}c.byteLength=e,c.toByteArray=g,c.fromByteArray=j;for(var k=[],l=[],m="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,p=n.length;o<p;++o)k[o]=n[o],l[n.charCodeAt(o)]=o;l["-".charCodeAt(0)]=62,l["_".charCodeAt(0)]=63},{}],166:[function(a,b,c){},{}],167:[function(a,b,c){"use strict";function d(a){if(a>X)throw new RangeError('The value "'+a+'" is invalid for option "size"');var b=new Uint8Array(a);return b.__proto__=e.prototype,b}function e(a,b,c){if("number"==typeof a){if("string"==typeof b)throw new TypeError('The "string" argument must be of type string. Received type number');return i(a)}return f(a,b,c)}function f(a,b,c){if("string"==typeof a)return j(a,b);if(ArrayBuffer.isView(a))return k(a);if(null==a)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof a);if(T(a,ArrayBuffer)||a&&T(a.buffer,ArrayBuffer))return l(a,b,c);if("number"==typeof a)throw new TypeError('The "value" argument must not be of type number. Received type number');var d=a.valueOf&&a.valueOf();if(null!=d&&d!==a)return e.from(d,b,c);var f=m(a);if(f)return f;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof a[Symbol.toPrimitive])return e.from(a[Symbol.toPrimitive]("string"),b,c);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof a)}function g(a){if("number"!=typeof a)throw new TypeError('"size" argument must be of type number');if(a<0)throw new RangeError('The value "'+a+'" is invalid for option "size"')}function h(a,b,c){return g(a),a<=0?d(a):void 0!==b?"string"==typeof c?d(a).fill(b,c):d(a).fill(b):d(a)}function i(a){return g(a),d(a<0?0:0|n(a))}function j(a,b){if("string"==typeof b&&""!==b||(b="utf8"),!e.isEncoding(b))throw new TypeError("Unknown encoding: "+b);var c=0|p(a,b),f=d(c),g=f.write(a,b);return g!==c&&(f=f.slice(0,g)),f}function k(a){for(var b=a.length<0?0:0|n(a.length),c=d(b),e=0;e<b;e+=1)c[e]=255&a[e];return c}function l(a,b,c){if(b<0||a.byteLength<b)throw new RangeError('"offset" is outside of buffer bounds');if(a.byteLength<b+(c||0))throw new RangeError('"length" is outside of buffer bounds');var d;return d=void 0===b&&void 0===c?new Uint8Array(a):void 0===c?new Uint8Array(a,b):new Uint8Array(a,b,c),d.__proto__=e.prototype,d}function m(a){if(e.isBuffer(a)){var b=0|n(a.length),c=d(b);return 0===c.length?c:(a.copy(c,0,0,b),c)}return void 0!==a.length?"number"!=typeof a.length||U(a.length)?d(0):k(a):"Buffer"===a.type&&Array.isArray(a.data)?k(a.data):void 0}function n(a){if(a>=X)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+X.toString(16)+" bytes");return 0|a}function o(a){return+a!=a&&(a=0),e.alloc(+a)}function p(a,b){if(e.isBuffer(a))return a.length;if(ArrayBuffer.isView(a)||T(a,ArrayBuffer))return a.byteLength;if("string"!=typeof a)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof a);var c=a.length,d=arguments.length>2&&!0===arguments[2];if(!d&&0===c)return 0;for(var f=!1;;)switch(b){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":return O(a).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*c;case"hex":return c>>>1;case"base64":return R(a).length;default:if(f)return d?-1:O(a).length;b=(""+b).toLowerCase(),f=!0}}function q(a,b,c){var d=!1;if((void 0===b||b<0)&&(b=0),b>this.length)return"";if((void 0===c||c>this.length)&&(c=this.length),c<=0)return"";if(c>>>=0,b>>>=0,c<=b)return"";for(a||(a="utf8");;)switch(a){case"hex":return F(this,b,c);case"utf8":case"utf-8":return B(this,b,c);case"ascii":return D(this,b,c);case"latin1":case"binary":return E(this,b,c);case"base64":return A(this,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return G(this,b,c);default:if(d)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),d=!0}}function r(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}function s(a,b,c,d,f){if(0===a.length)return-1;if("string"==typeof c?(d=c,c=0):c>2147483647?c=2147483647:c<-2147483648&&(c=-2147483648),c=+c,U(c)&&(c=f?0:a.length-1),c<0&&(c=a.length+c),c>=a.length){if(f)return-1;c=a.length-1}else if(c<0){if(!f)return-1;c=0}if("string"==typeof b&&(b=e.from(b,d)),e.isBuffer(b))return 0===b.length?-1:t(a,b,c,d,f);if("number"==typeof b)return b&=255,"function"==typeof Uint8Array.prototype.indexOf?f?Uint8Array.prototype.indexOf.call(a,b,c):Uint8Array.prototype.lastIndexOf.call(a,b,c):t(a,[b],c,d,f);throw new TypeError("val must be string, number or Buffer")}function t(a,b,c,d,e){function f(a,b){return 1===g?a[b]:a.readUInt16BE(b*g)}var g=1,h=a.length,i=b.length;if(void 0!==d&&("ucs2"===(d=String(d).toLowerCase())||"ucs-2"===d||"utf16le"===d||"utf-16le"===d)){if(a.length<2||b.length<2)return-1;g=2,h/=2,i/=2,c/=2}var j;if(e){var k=-1;for(j=c;j<h;j++)if(f(a,j)===f(b,-1===k?0:j-k)){if(-1===k&&(k=j),j-k+1===i)return k*g}else-1!==k&&(j-=j-k),k=-1}else for(c+i>h&&(c=h-i),j=c;j>=0;j--){for(var l=!0,m=0;m<i;m++)if(f(a,j+m)!==f(b,m)){l=!1;break}if(l)return j}return-1}function u(a,b,c,d){c=Number(c)||0;var e=a.length-c;d?(d=Number(d))>e&&(d=e):d=e;var f=b.length;d>f/2&&(d=f/2);for(var g=0;g<d;++g){var h=parseInt(b.substr(2*g,2),16);if(U(h))return g;a[c+g]=h}return g}function v(a,b,c,d){return S(O(b,a.length-c),a,c,d)}function w(a,b,c,d){return S(P(b),a,c,d)}function x(a,b,c,d){return w(a,b,c,d)}function y(a,b,c,d){return S(R(b),a,c,d)}function z(a,b,c,d){return S(Q(b,a.length-c),a,c,d)}function A(a,b,c){return 0===b&&c===a.length?V.fromByteArray(a):V.fromByteArray(a.slice(b,c))}function B(a,b,c){c=Math.min(a.length,c);for(var d=[],e=b;e<c;){var f=a[e],g=null,h=f>239?4:f>223?3:f>191?2:1;if(e+h<=c){var i,j,k,l;switch(h){case 1:f<128&&(g=f);break;case 2:i=a[e+1],128==(192&i)&&(l=(31&f)<<6|63&i)>127&&(g=l);break;case 3:i=a[e+1],j=a[e+2],128==(192&i)&&128==(192&j)&&(l=(15&f)<<12|(63&i)<<6|63&j)>2047&&(l<55296||l>57343)&&(g=l);break;case 4:i=a[e+1],j=a[e+2],k=a[e+3],128==(192&i)&&128==(192&j)&&128==(192&k)&&(l=(15&f)<<18|(63&i)<<12|(63&j)<<6|63&k)>65535&&l<1114112&&(g=l)}}null===g?(g=65533,h=1):g>65535&&(g-=65536,d.push(g>>>10&1023|55296),g=56320|1023&g),d.push(g),e+=h}return C(d)}function C(a){var b=a.length;if(b<=Y)return String.fromCharCode.apply(String,a);for(var c="",d=0;d<b;)c+=String.fromCharCode.apply(String,a.slice(d,d+=Y));return c}function D(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;e<c;++e)d+=String.fromCharCode(127&a[e]);return d}function E(a,b,c){var d="";c=Math.min(a.length,c);for(var e=b;e<c;++e)d+=String.fromCharCode(a[e]);return d}function F(a,b,c){var d=a.length;(!b||b<0)&&(b=0),(!c||c<0||c>d)&&(c=d);for(var e="",f=b;f<c;++f)e+=N(a[f]);return e}function G(a,b,c){for(var d=a.slice(b,c),e="",f=0;f<d.length;f+=2)e+=String.fromCharCode(d[f]+256*d[f+1]);return e}function H(a,b,c){if(a%1!=0||a<0)throw new RangeError("offset is not uint");if(a+b>c)throw new RangeError("Trying to access beyond buffer length")}function I(a,b,c,d,f,g){if(!e.isBuffer(a))throw new TypeError('"buffer" argument must be a Buffer instance');if(b>f||b<g)throw new RangeError('"value" argument is out of bounds');if(c+d>a.length)throw new RangeError("Index out of range")}function J(a,b,c,d,e,f){if(c+d>a.length)throw new RangeError("Index out of range");if(c<0)throw new RangeError("Index out of range")}function K(a,b,c,d,e){return b=+b,c>>>=0,e||J(a,b,c,4,3.4028234663852886e38,-3.4028234663852886e38),W.write(a,b,c,d,23,4),c+4}function L(a,b,c,d,e){return b=+b,c>>>=0,e||J(a,b,c,8,1.7976931348623157e308,-1.7976931348623157e308),W.write(a,b,c,d,52,8),c+8}function M(a){if(a=a.split("=")[0],a=a.trim().replace(Z,""),a.length<2)return"";for(;a.length%4!=0;)a+="=";return a}function N(a){return a<16?"0"+a.toString(16):a.toString(16)}function O(a,b){b=b||1/0;for(var c,d=a.length,e=null,f=[],g=0;g<d;++g){if((c=a.charCodeAt(g))>55295&&c<57344){if(!e){if(c>56319){(b-=3)>-1&&f.push(239,191,189);continue}if(g+1===d){(b-=3)>-1&&f.push(239,191,189);continue}e=c;continue}if(c<56320){(b-=3)>-1&&f.push(239,191,189),e=c;continue}c=65536+(e-55296<<10|c-56320)}else e&&(b-=3)>-1&&f.push(239,191,189);if(e=null,c<128){if((b-=1)<0)break;f.push(c)}else if(c<2048){if((b-=2)<0)break;f.push(c>>6|192,63&c|128)}else if(c<65536){if((b-=3)<0)break;f.push(c>>12|224,c>>6&63|128,63&c|128)}else{if(!(c<1114112))throw new Error("Invalid code point");if((b-=4)<0)break;f.push(c>>18|240,c>>12&63|128,c>>6&63|128,63&c|128)}}return f}function P(a){for(var b=[],c=0;c<a.length;++c)b.push(255&a.charCodeAt(c));return b}function Q(a,b){for(var c,d,e,f=[],g=0;g<a.length&&!((b-=2)<0);++g)c=a.charCodeAt(g),d=c>>8,e=c%256,f.push(e),f.push(d);return f}function R(a){return V.toByteArray(M(a))}function S(a,b,c,d){for(var e=0;e<d&&!(e+c>=b.length||e>=a.length);++e)b[e+c]=a[e];return e}function T(a,b){return a instanceof b||null!=a&&null!=a.constructor&&null!=a.constructor.name&&a.constructor.name===b.name}function U(a){return a!==a}var V=a("base64-js"),W=a("ieee754");c.Buffer=e,c.SlowBuffer=o,c.INSPECT_MAX_BYTES=50;var X=2147483647;c.kMaxLength=X,e.TYPED_ARRAY_SUPPORT=function(){try{var a=new Uint8Array(1);return a.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===a.foo()}catch(a){return!1}}(),e.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(e.prototype,"parent",{enumerable:!0,get:function(){if(e.isBuffer(this))return this.buffer}}),Object.defineProperty(e.prototype,"offset",{enumerable:!0,get:function(){if(e.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&e[Symbol.species]===e&&Object.defineProperty(e,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),e.poolSize=8192,e.from=function(a,b,c){return f(a,b,c)},e.prototype.__proto__=Uint8Array.prototype,e.__proto__=Uint8Array,e.alloc=function(a,b,c){return h(a,b,c)},e.allocUnsafe=function(a){return i(a)},e.allocUnsafeSlow=function(a){return i(a)},e.isBuffer=function(a){return null!=a&&!0===a._isBuffer&&a!==e.prototype},e.compare=function(a,b){if(T(a,Uint8Array)&&(a=e.from(a,a.offset,a.byteLength)),T(b,Uint8Array)&&(b=e.from(b,b.offset,b.byteLength)),!e.isBuffer(a)||!e.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===b)return 0;for(var c=a.length,d=b.length,f=0,g=Math.min(c,d);f<g;++f)if(a[f]!==b[f]){c=a[f],d=b[f];break}return c<d?-1:d<c?1:0},e.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},e.concat=function(a,b){if(!Array.isArray(a))throw new TypeError('"list" argument must be an Array of Buffers');if(0===a.length)return e.alloc(0);var c;if(void 0===b)for(b=0,c=0;c<a.length;++c)b+=a[c].length;var d=e.allocUnsafe(b),f=0;for(c=0;c<a.length;++c){var g=a[c];if(T(g,Uint8Array)&&(g=e.from(g)),!e.isBuffer(g))throw new TypeError('"list" argument must be an Array of Buffers');g.copy(d,f),f+=g.length}return d},e.byteLength=p,e.prototype._isBuffer=!0,e.prototype.swap16=function(){var a=this.length;if(a%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var b=0;b<a;b+=2)r(this,b,b+1);return this},e.prototype.swap32=function(){var a=this.length;if(a%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var b=0;b<a;b+=4)r(this,b,b+3),r(this,b+1,b+2);return this},e.prototype.swap64=function(){var a=this.length;if(a%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var b=0;b<a;b+=8)r(this,b,b+7),r(this,b+1,b+6),r(this,b+2,b+5),r(this,b+3,b+4);return this},e.prototype.toString=function(){var a=this.length;return 0===a?"":0===arguments.length?B(this,0,a):q.apply(this,arguments)},e.prototype.toLocaleString=e.prototype.toString,e.prototype.equals=function(a){if(!e.isBuffer(a))throw new TypeError("Argument must be a Buffer");return this===a||0===e.compare(this,a)},e.prototype.inspect=function(){var a="",b=c.INSPECT_MAX_BYTES;return a=this.toString("hex",0,b).replace(/(.{2})/g,"$1 ").trim(),this.length>b&&(a+=" ... "),"<Buffer "+a+">"},e.prototype.compare=function(a,b,c,d,f){if(T(a,Uint8Array)&&(a=e.from(a,a.offset,a.byteLength)),!e.isBuffer(a))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof a)
;if(void 0===b&&(b=0),void 0===c&&(c=a?a.length:0),void 0===d&&(d=0),void 0===f&&(f=this.length),b<0||c>a.length||d<0||f>this.length)throw new RangeError("out of range index");if(d>=f&&b>=c)return 0;if(d>=f)return-1;if(b>=c)return 1;if(b>>>=0,c>>>=0,d>>>=0,f>>>=0,this===a)return 0;for(var g=f-d,h=c-b,i=Math.min(g,h),j=this.slice(d,f),k=a.slice(b,c),l=0;l<i;++l)if(j[l]!==k[l]){g=j[l],h=k[l];break}return g<h?-1:h<g?1:0},e.prototype.includes=function(a,b,c){return-1!==this.indexOf(a,b,c)},e.prototype.indexOf=function(a,b,c){return s(this,a,b,c,!0)},e.prototype.lastIndexOf=function(a,b,c){return s(this,a,b,c,!1)},e.prototype.write=function(a,b,c,d){if(void 0===b)d="utf8",c=this.length,b=0;else if(void 0===c&&"string"==typeof b)d=b,c=this.length,b=0;else{if(!isFinite(b))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");b>>>=0,isFinite(c)?(c>>>=0,void 0===d&&(d="utf8")):(d=c,c=void 0)}var e=this.length-b;if((void 0===c||c>e)&&(c=e),a.length>0&&(c<0||b<0)||b>this.length)throw new RangeError("Attempt to write outside buffer bounds");d||(d="utf8");for(var f=!1;;)switch(d){case"hex":return u(this,a,b,c);case"utf8":case"utf-8":return v(this,a,b,c);case"ascii":return w(this,a,b,c);case"latin1":case"binary":return x(this,a,b,c);case"base64":return y(this,a,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return z(this,a,b,c);default:if(f)throw new TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase(),f=!0}},e.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Y=4096;e.prototype.slice=function(a,b){var c=this.length;a=~~a,b=void 0===b?c:~~b,a<0?(a+=c)<0&&(a=0):a>c&&(a=c),b<0?(b+=c)<0&&(b=0):b>c&&(b=c),b<a&&(b=a);var d=this.subarray(a,b);return d.__proto__=e.prototype,d},e.prototype.readUIntLE=function(a,b,c){a>>>=0,b>>>=0,c||H(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return d},e.prototype.readUIntBE=function(a,b,c){a>>>=0,b>>>=0,c||H(a,b,this.length);for(var d=this[a+--b],e=1;b>0&&(e*=256);)d+=this[a+--b]*e;return d},e.prototype.readUInt8=function(a,b){return a>>>=0,b||H(a,1,this.length),this[a]},e.prototype.readUInt16LE=function(a,b){return a>>>=0,b||H(a,2,this.length),this[a]|this[a+1]<<8},e.prototype.readUInt16BE=function(a,b){return a>>>=0,b||H(a,2,this.length),this[a]<<8|this[a+1]},e.prototype.readUInt32LE=function(a,b){return a>>>=0,b||H(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},e.prototype.readUInt32BE=function(a,b){return a>>>=0,b||H(a,4,this.length),16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},e.prototype.readIntLE=function(a,b,c){a>>>=0,b>>>=0,c||H(a,b,this.length);for(var d=this[a],e=1,f=0;++f<b&&(e*=256);)d+=this[a+f]*e;return e*=128,d>=e&&(d-=Math.pow(2,8*b)),d},e.prototype.readIntBE=function(a,b,c){a>>>=0,b>>>=0,c||H(a,b,this.length);for(var d=b,e=1,f=this[a+--d];d>0&&(e*=256);)f+=this[a+--d]*e;return e*=128,f>=e&&(f-=Math.pow(2,8*b)),f},e.prototype.readInt8=function(a,b){return a>>>=0,b||H(a,1,this.length),128&this[a]?-1*(255-this[a]+1):this[a]},e.prototype.readInt16LE=function(a,b){a>>>=0,b||H(a,2,this.length);var c=this[a]|this[a+1]<<8;return 32768&c?4294901760|c:c},e.prototype.readInt16BE=function(a,b){a>>>=0,b||H(a,2,this.length);var c=this[a+1]|this[a]<<8;return 32768&c?4294901760|c:c},e.prototype.readInt32LE=function(a,b){return a>>>=0,b||H(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},e.prototype.readInt32BE=function(a,b){return a>>>=0,b||H(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},e.prototype.readFloatLE=function(a,b){return a>>>=0,b||H(a,4,this.length),W.read(this,a,!0,23,4)},e.prototype.readFloatBE=function(a,b){return a>>>=0,b||H(a,4,this.length),W.read(this,a,!1,23,4)},e.prototype.readDoubleLE=function(a,b){return a>>>=0,b||H(a,8,this.length),W.read(this,a,!0,52,8)},e.prototype.readDoubleBE=function(a,b){return a>>>=0,b||H(a,8,this.length),W.read(this,a,!1,52,8)},e.prototype.writeUIntLE=function(a,b,c,d){if(a=+a,b>>>=0,c>>>=0,!d){I(this,a,b,c,Math.pow(2,8*c)-1,0)}var e=1,f=0;for(this[b]=255&a;++f<c&&(e*=256);)this[b+f]=a/e&255;return b+c},e.prototype.writeUIntBE=function(a,b,c,d){if(a=+a,b>>>=0,c>>>=0,!d){I(this,a,b,c,Math.pow(2,8*c)-1,0)}var e=c-1,f=1;for(this[b+e]=255&a;--e>=0&&(f*=256);)this[b+e]=a/f&255;return b+c},e.prototype.writeUInt8=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,1,255,0),this[b]=255&a,b+1},e.prototype.writeUInt16LE=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,2,65535,0),this[b]=255&a,this[b+1]=a>>>8,b+2},e.prototype.writeUInt16BE=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,2,65535,0),this[b]=a>>>8,this[b+1]=255&a,b+2},e.prototype.writeUInt32LE=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,4,4294967295,0),this[b+3]=a>>>24,this[b+2]=a>>>16,this[b+1]=a>>>8,this[b]=255&a,b+4},e.prototype.writeUInt32BE=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,4,4294967295,0),this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a,b+4},e.prototype.writeIntLE=function(a,b,c,d){if(a=+a,b>>>=0,!d){var e=Math.pow(2,8*c-1);I(this,a,b,c,e-1,-e)}var f=0,g=1,h=0;for(this[b]=255&a;++f<c&&(g*=256);)a<0&&0===h&&0!==this[b+f-1]&&(h=1),this[b+f]=(a/g>>0)-h&255;return b+c},e.prototype.writeIntBE=function(a,b,c,d){if(a=+a,b>>>=0,!d){var e=Math.pow(2,8*c-1);I(this,a,b,c,e-1,-e)}var f=c-1,g=1,h=0;for(this[b+f]=255&a;--f>=0&&(g*=256);)a<0&&0===h&&0!==this[b+f+1]&&(h=1),this[b+f]=(a/g>>0)-h&255;return b+c},e.prototype.writeInt8=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,1,127,-128),a<0&&(a=255+a+1),this[b]=255&a,b+1},e.prototype.writeInt16LE=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,2,32767,-32768),this[b]=255&a,this[b+1]=a>>>8,b+2},e.prototype.writeInt16BE=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,2,32767,-32768),this[b]=a>>>8,this[b+1]=255&a,b+2},e.prototype.writeInt32LE=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,4,2147483647,-2147483648),this[b]=255&a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24,b+4},e.prototype.writeInt32BE=function(a,b,c){return a=+a,b>>>=0,c||I(this,a,b,4,2147483647,-2147483648),a<0&&(a=4294967295+a+1),this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a,b+4},e.prototype.writeFloatLE=function(a,b,c){return K(this,a,b,!0,c)},e.prototype.writeFloatBE=function(a,b,c){return K(this,a,b,!1,c)},e.prototype.writeDoubleLE=function(a,b,c){return L(this,a,b,!0,c)},e.prototype.writeDoubleBE=function(a,b,c){return L(this,a,b,!1,c)},e.prototype.copy=function(a,b,c,d){if(!e.isBuffer(a))throw new TypeError("argument should be a Buffer");if(c||(c=0),d||0===d||(d=this.length),b>=a.length&&(b=a.length),b||(b=0),d>0&&d<c&&(d=c),d===c)return 0;if(0===a.length||0===this.length)return 0;if(b<0)throw new RangeError("targetStart out of bounds");if(c<0||c>=this.length)throw new RangeError("Index out of range");if(d<0)throw new RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c);var f=d-c;if(this===a&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(b,c,d);else if(this===a&&c<b&&b<d)for(var g=f-1;g>=0;--g)a[g+b]=this[g+c];else Uint8Array.prototype.set.call(a,this.subarray(c,d),b);return f},e.prototype.fill=function(a,b,c,d){if("string"==typeof a){if("string"==typeof b?(d=b,b=0,c=this.length):"string"==typeof c&&(d=c,c=this.length),void 0!==d&&"string"!=typeof d)throw new TypeError("encoding must be a string");if("string"==typeof d&&!e.isEncoding(d))throw new TypeError("Unknown encoding: "+d);if(1===a.length){var f=a.charCodeAt(0);("utf8"===d&&f<128||"latin1"===d)&&(a=f)}}else"number"==typeof a&&(a&=255);if(b<0||this.length<b||this.length<c)throw new RangeError("Out of range index");if(c<=b)return this;b>>>=0,c=void 0===c?this.length:c>>>0,a||(a=0);var g;if("number"==typeof a)for(g=b;g<c;++g)this[g]=a;else{var h=e.isBuffer(a)?a:e.from(a,d),i=h.length;if(0===i)throw new TypeError('The value "'+a+'" is invalid for argument "value"');for(g=0;g<c-b;++g)this[g+b]=h[g%i]}return this};var Z=/[^+/0-9A-Za-z-_]/g},{"base64-js":165,ieee754:173}],168:[function(a,b,c){!function(c,d){"function"==typeof define&&define.amd?define(["long"],d):"function"==typeof a&&"object"==typeof b&&b&&b.exports?b.exports=function(){var b;try{b=a("long")}catch(a){}return d(b)}():(c.dcodeIO=c.dcodeIO||{}).ByteBuffer=d(c.dcodeIO.Long)}(this,function(a){"use strict";function b(a){var b=0;return function(){return b<a.length?a.charCodeAt(b++):null}}function c(){var a=[],b=[];return function(){if(0===arguments.length)return b.join("")+i.apply(String,a);a.length+arguments.length>1024&&(b.push(i.apply(String,a)),a.length=0),Array.prototype.push.apply(a,arguments)}}function d(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:1/0*(n?-1:1);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)}function e(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=b<0||0===b&&1/b<0?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}var f=function(a,b,c){if(void 0===a&&(a=f.DEFAULT_CAPACITY),void 0===b&&(b=f.DEFAULT_ENDIAN),void 0===c&&(c=f.DEFAULT_NOASSERT),!c){if((a|=0)<0)throw RangeError("Illegal capacity");b=!!b,c=!!c}this.buffer=0===a?h:new ArrayBuffer(a),this.view=0===a?null:new Uint8Array(this.buffer),this.offset=0,this.markedOffset=-1,this.limit=a,this.littleEndian=b,this.noAssert=c};f.VERSION="5.0.1",f.LITTLE_ENDIAN=!0,f.BIG_ENDIAN=!1,f.DEFAULT_CAPACITY=16,f.DEFAULT_ENDIAN=f.BIG_ENDIAN,f.DEFAULT_NOASSERT=!1,f.Long=a||null;var g=f.prototype;g.__isByteBuffer__,Object.defineProperty(g,"__isByteBuffer__",{value:!0,enumerable:!1,configurable:!1});var h=new ArrayBuffer(0),i=String.fromCharCode;f.accessor=function(){return Uint8Array},f.allocate=function(a,b,c){return new f(a,b,c)},f.concat=function(a,b,c,d){"boolean"!=typeof b&&"string"==typeof b||(d=c,c=b,b=void 0);for(var e,g=0,h=0,i=a.length;h<i;++h)f.isByteBuffer(a[h])||(a[h]=f.wrap(a[h],b)),(e=a[h].limit-a[h].offset)>0&&(g+=e);if(0===g)return new f(0,c,d);var j,k=new f(g,c,d);for(h=0;h<i;)j=a[h++],(e=j.limit-j.offset)<=0||(k.view.set(j.view.subarray(j.offset,j.limit),k.offset),k.offset+=e);return k.limit=k.offset,k.offset=0,k},f.isByteBuffer=function(a){return!0===(a&&a.__isByteBuffer__)},f.type=function(){return ArrayBuffer},f.wrap=function(a,b,c,d){if("string"!=typeof b&&(d=c,c=b,b=void 0),"string"==typeof a)switch(void 0===b&&(b="utf8"),b){case"base64":return f.fromBase64(a,c);case"hex":return f.fromHex(a,c);case"binary":return f.fromBinary(a,c);case"utf8":return f.fromUTF8(a,c);case"debug":return f.fromDebug(a,c);default:throw Error("Unsupported encoding: "+b)}if(null===a||"object"!=typeof a)throw TypeError("Illegal buffer");var e;if(f.isByteBuffer(a))return e=g.clone.call(a),e.markedOffset=-1,e;if(a instanceof Uint8Array)e=new f(0,c,d),a.length>0&&(e.buffer=a.buffer,e.offset=a.byteOffset,e.limit=a.byteOffset+a.byteLength,e.view=new Uint8Array(a.buffer));else if(a instanceof ArrayBuffer)e=new f(0,c,d),a.byteLength>0&&(e.buffer=a,e.offset=0,e.limit=a.byteLength,e.view=a.byteLength>0?new Uint8Array(a):null);else{if("[object Array]"!==Object.prototype.toString.call(a))throw TypeError("Illegal buffer");e=new f(a.length,c,d),e.limit=a.length;for(var h=0;h<a.length;++h)e.view[h]=a[h]}return e},g.writeBitSet=function(a,b){var c=void 0===b;if(c&&(b=this.offset),!this.noAssert){if(!(a instanceof Array))throw TypeError("Illegal BitSet: Not an array");if("number"!=typeof b||b%1!=0)throw TypeError("Illegal offset: "+b+" (not an integer)");if((b>>>=0)<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}var d,e=b,f=a.length,g=f>>3,h=0;for(b+=this.writeVarint32(f,b);g--;)d=1&!!a[h++]|(1&!!a[h++])<<1|(1&!!a[h++])<<2|(1&!!a[h++])<<3|(1&!!a[h++])<<4|(1&!!a[h++])<<5|(1&!!a[h++])<<6|(1&!!a[h++])<<7,this.writeByte(d,b++);if(h<f){var i=0;for(d=0;h<f;)d|=(1&!!a[h++])<<i++;this.writeByte(d,b++)}return c?(this.offset=b,this):b-e},g.readBitSet=function(a){var b=void 0===a;b&&(a=this.offset);var c,d=this.readVarint32(a),e=d.value,f=e>>3,g=0,h=[];for(a+=d.length;f--;)c=this.readByte(a++),h[g++]=!!(1&c),h[g++]=!!(2&c),h[g++]=!!(4&c),h[g++]=!!(8&c),h[g++]=!!(16&c),h[g++]=!!(32&c),h[g++]=!!(64&c),h[g++]=!!(128&c);if(g<e){var i=0;for(c=this.readByte(a++);g<e;)h[g++]=!!(c>>i++&1)}return b&&(this.offset=a),h},g.readBytes=function(a,b){var c=void 0===b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!=0)throw TypeError("Illegal offset: "+b+" (not an integer)");if((b>>>=0)<0||b+a>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+"+a+") <= "+this.buffer.byteLength)}var d=this.slice(b,b+a);return c&&(this.offset+=a),d},g.writeBytes=g.append,g.writeInt8=function(a,b){var c=void 0===b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!=0)throw TypeError("Illegal offset: "+b+" (not an integer)");if((b>>>=0)<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=1;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=1,this.view[b]=a,c&&(this.offset+=1),this},g.writeByte=g.writeInt8,g.readInt8=function(a){var b=void 0===a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c=this.view[a];return 128==(128&c)&&(c=-(255-c+1)),b&&(this.offset+=1),c},g.readByte=g.readInt8,g.writeUint8=function(a,b){var c=void 0===b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,"number"!=typeof b||b%1!=0)throw TypeError("Illegal offset: "+b+" (not an integer)");if((b>>>=0)<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=1;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=1,this.view[b]=a,c&&(this.offset+=1),this},g.writeUInt8=g.writeUint8,g.readUint8=function(a){var b=void 0===a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c=this.view[a];return b&&(this.offset+=1),c},g.readUInt8=g.readUint8,g.writeInt16=function(a,b){var c=void 0===b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!=0)throw TypeError("Illegal offset: "+b+" (not an integer)");if((b>>>=0)<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=2;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=2,this.littleEndian?(this.view[b+1]=(65280&a)>>>8,this.view[b]=255&a):(this.view[b]=(65280&a)>>>8,this.view[b+1]=255&a),c&&(this.offset+=2),this},g.writeShort=g.writeInt16,g.readInt16=function(a){var b=void 0===a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+2) <= "+this.buffer.byteLength)}var c=0;return this.littleEndian?(c=this.view[a],c|=this.view[a+1]<<8):(c=this.view[a]<<8,c|=this.view[a+1]),32768==(32768&c)&&(c=-(65535-c+1)),b&&(this.offset+=2),c},g.readShort=g.readInt16,g.writeUint16=function(a,b){var c=void 0===b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,"number"!=typeof b||b%1!=0)throw TypeError("Illegal offset: "+b+" (not an integer)");if((b>>>=0)<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=2;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=2,this.littleEndian?(this.view[b+1]=(65280&a)>>>8,this.view[b]=255&a):(this.view[b]=(65280&a)>>>8,this.view[b+1]=255&a),c&&(this.offset+=2),this},g.writeUInt16=g.writeUint16,g.readUint16=function(a){var b=void 0===a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+2>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+2) <= "+this.buffer.byteLength)}var c=0;return this.littleEndian?(c=this.view[a],c|=this.view[a+1]<<8):(c=this.view[a]<<8,c|=this.view[a+1]),b&&(this.offset+=2),c},g.readUInt16=g.readUint16,g.writeInt32=function(a,b){var c=void 0===b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!=0)throw TypeError("Illegal offset: "+b+" (not an integer)");if((b>>>=0)<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=4;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=4,this.littleEndian?(this.view[b+3]=a>>>24&255,this.view[b+2]=a>>>16&255,this.view[b+1]=a>>>8&255,this.view[b]=255&a):(this.view[b]=a>>>24&255,this.view[b+1]=a>>>16&255,this.view[b+2]=a>>>8&255,this.view[b+3]=255&a),c&&(this.offset+=4),this},g.writeInt=g.writeInt32,g.readInt32=function(a){var b=void 0===a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=0;return this.littleEndian?(c=this.view[a+2]<<16,c|=this.view[a+1]<<8,c|=this.view[a],c+=this.view[a+3]<<24>>>0):(c=this.view[a+1]<<16,c|=this.view[a+2]<<8,c|=this.view[a+3],c+=this.view[a]<<24>>>0),c|=0,b&&(this.offset+=4),c},g.readInt=g.readInt32,g.writeUint32=function(a,b){var c=void 0===b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a>>>=0,"number"!=typeof b||b%1!=0)throw TypeError("Illegal offset: "+b+" (not an integer)");if((b>>>=0)<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=4;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=4,this.littleEndian?(this.view[b+3]=a>>>24&255,this.view[b+2]=a>>>16&255,this.view[b+1]=a>>>8&255,this.view[b]=255&a):(this.view[b]=a>>>24&255,this.view[b+1]=a>>>16&255,this.view[b+2]=a>>>8&255,this.view[b+3]=255&a),c&&(this.offset+=4),this},g.writeUInt32=g.writeUint32,g.readUint32=function(a){var b=void 0===a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=0;return this.littleEndian?(c=this.view[a+2]<<16,c|=this.view[a+1]<<8,c|=this.view[a],c+=this.view[a+3]<<24>>>0):(c=this.view[a+1]<<16,c|=this.view[a+2]<<8,c|=this.view[a+3],c+=this.view[a]<<24>>>0),b&&(this.offset+=4),c},g.readUInt32=g.readUint32,a&&(g.writeInt64=function(b,c){var d=void 0===c;if(d&&(c=this.offset),!this.noAssert){if("number"==typeof b)b=a.fromNumber(b);else if("string"==typeof b)b=a.fromString(b);else if(!(b&&b instanceof a))throw TypeError("Illegal value: "+b+" (not an integer or Long)");if("number"!=typeof c||c%1!=0)throw TypeError("Illegal offset: "+c+" (not an integer)");if((c>>>=0)<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}"number"==typeof b?b=a.fromNumber(b):"string"==typeof b&&(b=a.fromString(b)),c+=8;var e=this.buffer.byteLength;c>e&&this.resize((e*=2)>c?e:c),c-=8;var f=b.low,g=b.high;return this.littleEndian?(this.view[c+3]=f>>>24&255,this.view[c+2]=f>>>16&255,this.view[c+1]=f>>>8&255,this.view[c]=255&f,c+=4,this.view[c+3]=g>>>24&255,this.view[c+2]=g>>>16&255,this.view[c+1]=g>>>8&255,this.view[c]=255&g):(this.view[c]=g>>>24&255,this.view[c+1]=g>>>16&255,this.view[c+2]=g>>>8&255,this.view[c+3]=255&g,c+=4,this.view[c]=f>>>24&255,this.view[c+1]=f>>>16&255,this.view[c+2]=f>>>8&255,this.view[c+3]=255&f),d&&(this.offset+=8),this},g.writeLong=g.writeInt64,g.readInt64=function(b){var c=void 0===b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!=0)throw TypeError("Illegal offset: "+b+" (not an integer)");if((b>>>=0)<0||b+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+8) <= "+this.buffer.byteLength)}var d=0,e=0;this.littleEndian?(d=this.view[b+2]<<16,d|=this.view[b+1]<<8,d|=this.view[b],d+=this.view[b+3]<<24>>>0,b+=4,e=this.view[b+2]<<16,e|=this.view[b+1]<<8,e|=this.view[b],e+=this.view[b+3]<<24>>>0):(e=this.view[b+1]<<16,e|=this.view[b+2]<<8,e|=this.view[b+3],e+=this.view[b]<<24>>>0,b+=4,d=this.view[b+1]<<16,d|=this.view[b+2]<<8,d|=this.view[b+3],d+=this.view[b]<<24>>>0);var f=new a(d,e,!1);return c&&(this.offset+=8),f},g.readLong=g.readInt64,g.writeUint64=function(b,c){var d=void 0===c;if(d&&(c=this.offset),!this.noAssert){if("number"==typeof b)b=a.fromNumber(b);else if("string"==typeof b)b=a.fromString(b);else if(!(b&&b instanceof a))throw TypeError("Illegal value: "+b+" (not an integer or Long)");if("number"!=typeof c||c%1!=0)throw TypeError("Illegal offset: "+c+" (not an integer)");if((c>>>=0)<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}"number"==typeof b?b=a.fromNumber(b):"string"==typeof b&&(b=a.fromString(b)),c+=8;var e=this.buffer.byteLength;c>e&&this.resize((e*=2)>c?e:c),c-=8;var f=b.low,g=b.high;return this.littleEndian?(this.view[c+3]=f>>>24&255,this.view[c+2]=f>>>16&255,this.view[c+1]=f>>>8&255,this.view[c]=255&f,c+=4,this.view[c+3]=g>>>24&255,this.view[c+2]=g>>>16&255,this.view[c+1]=g>>>8&255,this.view[c]=255&g):(this.view[c]=g>>>24&255,this.view[c+1]=g>>>16&255,this.view[c+2]=g>>>8&255,this.view[c+3]=255&g,c+=4,this.view[c]=f>>>24&255,this.view[c+1]=f>>>16&255,this.view[c+2]=f>>>8&255,this.view[c+3]=255&f),d&&(this.offset+=8),this},g.writeUInt64=g.writeUint64,g.readUint64=function(b){var c=void 0===b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!=0)throw TypeError("Illegal offset: "+b+" (not an integer)");if((b>>>=0)<0||b+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+8) <= "+this.buffer.byteLength)}var d=0,e=0;this.littleEndian?(d=this.view[b+2]<<16,d|=this.view[b+1]<<8,d|=this.view[b],d+=this.view[b+3]<<24>>>0,b+=4,e=this.view[b+2]<<16,e|=this.view[b+1]<<8,e|=this.view[b],e+=this.view[b+3]<<24>>>0):(e=this.view[b+1]<<16,e|=this.view[b+2]<<8,e|=this.view[b+3],e+=this.view[b]<<24>>>0,b+=4,d=this.view[b+1]<<16,d|=this.view[b+2]<<8,d|=this.view[b+3],d+=this.view[b]<<24>>>0);var f=new a(d,e,!0);return c&&(this.offset+=8),f},g.readUInt64=g.readUint64),g.writeFloat32=function(a,b){var c=void 0===b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a)throw TypeError("Illegal value: "+a+" (not a number)");if("number"!=typeof b||b%1!=0)throw TypeError("Illegal offset: "+b+" (not an integer)");if((b>>>=0)<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=4;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=4,e(this.view,a,b,this.littleEndian,23,4),c&&(this.offset+=4),this},g.writeFloat=g.writeFloat32,g.readFloat32=function(a){var b=void 0===a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=d(this.view,a,this.littleEndian,23,4);return b&&(this.offset+=4),c},g.readFloat=g.readFloat32,g.writeFloat64=function(a,b){var c=void 0===b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a)throw TypeError("Illegal value: "+a+" (not a number)");if("number"!=typeof b||b%1!=0)throw TypeError("Illegal offset: "+b+" (not an integer)");if((b>>>=0)<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}b+=8;var d=this.buffer.byteLength;return b>d&&this.resize((d*=2)>b?d:b),b-=8,e(this.view,a,b,this.littleEndian,52,8),c&&(this.offset+=8),this},g.writeDouble=g.writeFloat64,g.readFloat64=function(a){var b=void 0===a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+8>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+8) <= "+this.buffer.byteLength)}var c=d(this.view,a,this.littleEndian,52,8);return b&&(this.offset+=8),c},g.readDouble=g.readFloat64,f.MAX_VARINT32_BYTES=5,f.calculateVarint32=function(a){return a>>>=0,a<128?1:a<16384?2:a<1<<21?3:a<1<<28?4:5},f.zigZagEncode32=function(a){return((a|=0)<<1^a>>31)>>>0},f.zigZagDecode32=function(a){return a>>>1^-(1&a)|0},g.writeVarint32=function(a,b){var c=void 0===b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!=0)throw TypeError("Illegal offset: "+b+" (not an integer)");if((b>>>=0)<0||b+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+0) <= "+this.buffer.byteLength)}var d,e=f.calculateVarint32(a);b+=e;var g=this.buffer.byteLength;for(b>g&&this.resize((g*=2)>b?g:b),b-=e,a>>>=0;a>=128;)d=127&a|128,this.view[b++]=d,a>>>=7;return this.view[b++]=a,c?(this.offset=b,this):e},g.writeVarint32ZigZag=function(a,b){return this.writeVarint32(f.zigZagEncode32(a),b)},g.readVarint32=function(a){var b=void 0===a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c,d=0,e=0;do{if(!this.noAssert&&a>this.limit){var f=Error("Truncated");throw f.truncated=!0,f}c=this.view[a++],d<5&&(e|=(127&c)<<7*d),++d}while(0!=(128&c));return e|=0,b?(this.offset=a,e):{value:e,length:d}},g.readVarint32ZigZag=function(a){var b=this.readVarint32(a);return"object"==typeof b?b.value=f.zigZagDecode32(b.value):b=f.zigZagDecode32(b),b},a&&(f.MAX_VARINT64_BYTES=10,f.calculateVarint64=function(b){"number"==typeof b?b=a.fromNumber(b):"string"==typeof b&&(b=a.fromString(b));var c=b.toInt()>>>0,d=b.shiftRightUnsigned(28).toInt()>>>0,e=b.shiftRightUnsigned(56).toInt()>>>0;return 0==e?0==d?c<16384?c<128?1:2:c<1<<21?3:4:d<16384?d<128?5:6:d<1<<21?7:8:e<128?9:10},f.zigZagEncode64=function(b){return"number"==typeof b?b=a.fromNumber(b,!1):"string"==typeof b?b=a.fromString(b,!1):!1!==b.unsigned&&(b=b.toSigned()),b.shiftLeft(1).xor(b.shiftRight(63)).toUnsigned()},f.zigZagDecode64=function(b){return"number"==typeof b?b=a.fromNumber(b,!1):"string"==typeof b?b=a.fromString(b,!1):!1!==b.unsigned&&(b=b.toSigned()),b.shiftRightUnsigned(1).xor(b.and(a.ONE).toSigned().negate()).toSigned()},g.writeVarint64=function(b,c){var d=void 0===c;if(d&&(c=this.offset),!this.noAssert){if("number"==typeof b)b=a.fromNumber(b);else if("string"==typeof b)b=a.fromString(b);else if(!(b&&b instanceof a))throw TypeError("Illegal value: "+b+" (not an integer or Long)");if("number"!=typeof c||c%1!=0)throw TypeError("Illegal offset: "+c+" (not an integer)");if((c>>>=0)<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}"number"==typeof b?b=a.fromNumber(b,!1):"string"==typeof b?b=a.fromString(b,!1):!1!==b.unsigned&&(b=b.toSigned());var e=f.calculateVarint64(b),g=b.toInt()>>>0,h=b.shiftRightUnsigned(28).toInt()>>>0,i=b.shiftRightUnsigned(56).toInt()>>>0;c+=e;var j=this.buffer.byteLength;switch(c>j&&this.resize((j*=2)>c?j:c),c-=e,e){case 10:this.view[c+9]=i>>>7&1;case 9:this.view[c+8]=9!==e?128|i:127&i;case 8:this.view[c+7]=8!==e?h>>>21|128:h>>>21&127;case 7:this.view[c+6]=7!==e?h>>>14|128:h>>>14&127;case 6:this.view[c+5]=6!==e?h>>>7|128:h>>>7&127;case 5:this.view[c+4]=5!==e?128|h:127&h;case 4:this.view[c+3]=4!==e?g>>>21|128:g>>>21&127;case 3:this.view[c+2]=3!==e?g>>>14|128:g>>>14&127;case 2:this.view[c+1]=2!==e?g>>>7|128:g>>>7&127;case 1:this.view[c]=1!==e?128|g:127&g}return d?(this.offset+=e,this):e},g.writeVarint64ZigZag=function(a,b){return this.writeVarint64(f.zigZagEncode64(a),b)},g.readVarint64=function(b){var c=void 0===b;if(c&&(b=this.offset),!this.noAssert){if("number"!=typeof b||b%1!=0)throw TypeError("Illegal offset: "+b+" (not an integer)");if((b>>>=0)<0||b+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+b+" (+1) <= "+this.buffer.byteLength)}var d=b,e=0,f=0,g=0,h=0;if(h=this.view[b++],e=127&h,128&h&&(h=this.view[b++],e|=(127&h)<<7,(128&h||this.noAssert&&void 0===h)&&(h=this.view[b++],e|=(127&h)<<14,(128&h||this.noAssert&&void 0===h)&&(h=this.view[b++],e|=(127&h)<<21,(128&h||this.noAssert&&void 0===h)&&(h=this.view[b++],f=127&h,(128&h||this.noAssert&&void 0===h)&&(h=this.view[b++],f|=(127&h)<<7,(128&h||this.noAssert&&void 0===h)&&(h=this.view[b++],f|=(127&h)<<14,(128&h||this.noAssert&&void 0===h)&&(h=this.view[b++],f|=(127&h)<<21,(128&h||this.noAssert&&void 0===h)&&(h=this.view[b++],g=127&h,(128&h||this.noAssert&&void 0===h)&&(h=this.view[b++],g|=(127&h)<<7,128&h||this.noAssert&&void 0===h))))))))))throw Error("Buffer overrun");var i=a.fromBits(e|f<<28,f>>>4|g<<24,!1);return c?(this.offset=b,i):{value:i,length:b-d}},g.readVarint64ZigZag=function(b){var c=this.readVarint64(b);return c&&c.value instanceof a?c.value=f.zigZagDecode64(c.value):c=f.zigZagDecode64(c),c}),g.writeCString=function(a,c){var d=void 0===c;d&&(c=this.offset);var e,f=a.length;if(!this.noAssert){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");for(e=0;e<f;++e)if(0===a.charCodeAt(e))throw RangeError("Illegal str: Contains NULL-characters");if("number"!=typeof c||c%1!=0)throw TypeError("Illegal offset: "+c+" (not an integer)");if((c>>>=0)<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}f=k.calculateUTF16asUTF8(b(a))[1],c+=f+1;var g=this.buffer.byteLength;return c>g&&this.resize((g*=2)>c?g:c),c-=f+1,k.encodeUTF16toUTF8(b(a),function(a){this.view[c++]=a}.bind(this)),this.view[c++]=0,d?(this.offset=c,this):f},g.readCString=function(a){var b=void 0===a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var d,e=a,f=-1;return k.decodeUTF8toUTF16(function(){if(0===f)return null;if(a>=this.limit)throw RangeError("Illegal range: Truncated data, "+a+" < "+this.limit);return f=this.view[a++],0===f?null:f}.bind(this),d=c(),!0),b?(this.offset=a,d()):{string:d(),length:a-e}},g.writeIString=function(a,c){var d=void 0===c;if(d&&(c=this.offset),!this.noAssert){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if("number"!=typeof c||c%1!=0)throw TypeError("Illegal offset: "+c+" (not an integer)");if((c>>>=0)<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}var e,f=c;e=k.calculateUTF16asUTF8(b(a),this.noAssert)[1],c+=4+e;var g=this.buffer.byteLength;if(c>g&&this.resize((g*=2)>c?g:c),c-=4+e,this.littleEndian?(this.view[c+3]=e>>>24&255,
this.view[c+2]=e>>>16&255,this.view[c+1]=e>>>8&255,this.view[c]=255&e):(this.view[c]=e>>>24&255,this.view[c+1]=e>>>16&255,this.view[c+2]=e>>>8&255,this.view[c+3]=255&e),c+=4,k.encodeUTF16toUTF8(b(a),function(a){this.view[c++]=a}.bind(this)),c!==f+4+e)throw RangeError("Illegal range: Truncated data, "+c+" == "+(c+4+e));return d?(this.offset=c,this):c-f},g.readIString=function(a){var b=void 0===a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+4>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+4) <= "+this.buffer.byteLength)}var c=a,d=this.readUint32(a),e=this.readUTF8String(d,f.METRICS_BYTES,a+=4);return a+=e.length,b?(this.offset=a,e.string):{string:e.string,length:a-c}},f.METRICS_CHARS="c",f.METRICS_BYTES="b",g.writeUTF8String=function(a,c){var d=void 0===c;if(d&&(c=this.offset),!this.noAssert){if("number"!=typeof c||c%1!=0)throw TypeError("Illegal offset: "+c+" (not an integer)");if((c>>>=0)<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}var e,f=c;e=k.calculateUTF16asUTF8(b(a))[1],c+=e;var g=this.buffer.byteLength;return c>g&&this.resize((g*=2)>c?g:c),c-=e,k.encodeUTF16toUTF8(b(a),function(a){this.view[c++]=a}.bind(this)),d?(this.offset=c,this):c-f},g.writeString=g.writeUTF8String,f.calculateUTF8Chars=function(a){return k.calculateUTF16asUTF8(b(a))[0]},f.calculateUTF8Bytes=function(a){return k.calculateUTF16asUTF8(b(a))[1]},f.calculateString=f.calculateUTF8Bytes,g.readUTF8String=function(a,b,d){"number"==typeof b&&(d=b,b=void 0);var e=void 0===d;if(e&&(d=this.offset),void 0===b&&(b=f.METRICS_CHARS),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal length: "+a+" (not an integer)");if(a|=0,"number"!=typeof d||d%1!=0)throw TypeError("Illegal offset: "+d+" (not an integer)");if((d>>>=0)<0||d+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+d+" (+0) <= "+this.buffer.byteLength)}var g,h=0,i=d;if(b===f.METRICS_CHARS){if(g=c(),k.decodeUTF8(function(){return h<a&&d<this.limit?this.view[d++]:null}.bind(this),function(a){++h,k.UTF8toUTF16(a,g)}),h!==a)throw RangeError("Illegal range: Truncated data, "+h+" == "+a);return e?(this.offset=d,g()):{string:g(),length:d-i}}if(b===f.METRICS_BYTES){if(!this.noAssert){if("number"!=typeof d||d%1!=0)throw TypeError("Illegal offset: "+d+" (not an integer)");if((d>>>=0)<0||d+a>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+d+" (+"+a+") <= "+this.buffer.byteLength)}var j=d+a;if(k.decodeUTF8toUTF16(function(){return d<j?this.view[d++]:null}.bind(this),g=c(),this.noAssert),d!==j)throw RangeError("Illegal range: Truncated data, "+d+" == "+j);return e?(this.offset=d,g()):{string:g(),length:d-i}}throw TypeError("Unsupported metrics: "+b)},g.readString=g.readUTF8String,g.writeVString=function(a,c){var d=void 0===c;if(d&&(c=this.offset),!this.noAssert){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if("number"!=typeof c||c%1!=0)throw TypeError("Illegal offset: "+c+" (not an integer)");if((c>>>=0)<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}var e,g,h=c;e=k.calculateUTF16asUTF8(b(a),this.noAssert)[1],g=f.calculateVarint32(e),c+=g+e;var i=this.buffer.byteLength;if(c>i&&this.resize((i*=2)>c?i:c),c-=g+e,c+=this.writeVarint32(e,c),k.encodeUTF16toUTF8(b(a),function(a){this.view[c++]=a}.bind(this)),c!==h+e+g)throw RangeError("Illegal range: Truncated data, "+c+" == "+(c+e+g));return d?(this.offset=c,this):c-h},g.readVString=function(a){var b=void 0===a;if(b&&(a=this.offset),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+1>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+1) <= "+this.buffer.byteLength)}var c=a,d=this.readVarint32(a),e=this.readUTF8String(d.value,f.METRICS_BYTES,a+=d.length);return a+=e.length,b?(this.offset=a,e.string):{string:e.string,length:a-c}},g.append=function(a,b,c){"number"!=typeof b&&"string"==typeof b||(c=b,b=void 0);var d=void 0===c;if(d&&(c=this.offset),!this.noAssert){if("number"!=typeof c||c%1!=0)throw TypeError("Illegal offset: "+c+" (not an integer)");if((c>>>=0)<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}a instanceof f||(a=f.wrap(a,b));var e=a.limit-a.offset;if(e<=0)return this;c+=e;var g=this.buffer.byteLength;return c>g&&this.resize((g*=2)>c?g:c),c-=e,this.view.set(a.view.subarray(a.offset,a.limit),c),a.offset+=e,d&&(this.offset+=e),this},g.appendTo=function(a,b){return a.append(this,b),this},g.assert=function(a){return this.noAssert=!a,this},g.capacity=function(){return this.buffer.byteLength},g.clear=function(){return this.offset=0,this.limit=this.buffer.byteLength,this.markedOffset=-1,this},g.clone=function(a){var b=new f(0,this.littleEndian,this.noAssert);return a?(b.buffer=new ArrayBuffer(this.buffer.byteLength),b.view=new Uint8Array(b.buffer)):(b.buffer=this.buffer,b.view=this.view),b.offset=this.offset,b.markedOffset=this.markedOffset,b.limit=this.limit,b},g.compact=function(a,b){if(void 0===a&&(a=this.offset),void 0===b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!=0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}if(0===a&&b===this.buffer.byteLength)return this;var c=b-a;if(0===c)return this.buffer=h,this.view=null,this.markedOffset>=0&&(this.markedOffset-=a),this.offset=0,this.limit=0,this;var d=new ArrayBuffer(c),e=new Uint8Array(d);return e.set(this.view.subarray(a,b)),this.buffer=d,this.view=e,this.markedOffset>=0&&(this.markedOffset-=a),this.offset=0,this.limit=c,this},g.copy=function(a,b){if(void 0===a&&(a=this.offset),void 0===b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!=0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}if(a===b)return new f(0,this.littleEndian,this.noAssert);var c=b-a,d=new f(c,this.littleEndian,this.noAssert);return d.offset=0,d.limit=c,d.markedOffset>=0&&(d.markedOffset-=a),this.copyTo(d,0,a,b),d},g.copyTo=function(a,b,c,d){var e,g;if(!this.noAssert&&!f.isByteBuffer(a))throw TypeError("Illegal target: Not a ByteBuffer");if(b=(g=void 0===b)?a.offset:0|b,c=(e=void 0===c)?this.offset:0|c,d=void 0===d?this.limit:0|d,b<0||b>a.buffer.byteLength)throw RangeError("Illegal target range: 0 <= "+b+" <= "+a.buffer.byteLength);if(c<0||d>this.buffer.byteLength)throw RangeError("Illegal source range: 0 <= "+c+" <= "+this.buffer.byteLength);var h=d-c;return 0===h?a:(a.ensureCapacity(b+h),a.view.set(this.view.subarray(c,d),b),e&&(this.offset+=h),g&&(a.offset+=h),this)},g.ensureCapacity=function(a){var b=this.buffer.byteLength;return b<a?this.resize((b*=2)>a?b:a):this},g.fill=function(a,b,c){var d=void 0===b;if(d&&(b=this.offset),"string"==typeof a&&a.length>0&&(a=a.charCodeAt(0)),void 0===b&&(b=this.offset),void 0===c&&(c=this.limit),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal value: "+a+" (not an integer)");if(a|=0,"number"!=typeof b||b%1!=0)throw TypeError("Illegal begin: Not an integer");if(b>>>=0,"number"!=typeof c||c%1!=0)throw TypeError("Illegal end: Not an integer");if(c>>>=0,b<0||b>c||c>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+b+" <= "+c+" <= "+this.buffer.byteLength)}if(b>=c)return this;for(;b<c;)this.view[b++]=a;return d&&(this.offset=b),this},g.flip=function(){return this.limit=this.offset,this.offset=0,this},g.mark=function(a){if(a=void 0===a?this.offset:a,!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal offset: "+a+" (not an integer)");if((a>>>=0)<0||a+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+a+" (+0) <= "+this.buffer.byteLength)}return this.markedOffset=a,this},g.order=function(a){if(!this.noAssert&&"boolean"!=typeof a)throw TypeError("Illegal littleEndian: Not a boolean");return this.littleEndian=!!a,this},g.LE=function(a){return this.littleEndian=void 0===a||!!a,this},g.BE=function(a){return this.littleEndian=void 0!==a&&!a,this},g.prepend=function(a,b,c){"number"!=typeof b&&"string"==typeof b||(c=b,b=void 0);var d=void 0===c;if(d&&(c=this.offset),!this.noAssert){if("number"!=typeof c||c%1!=0)throw TypeError("Illegal offset: "+c+" (not an integer)");if((c>>>=0)<0||c+0>this.buffer.byteLength)throw RangeError("Illegal offset: 0 <= "+c+" (+0) <= "+this.buffer.byteLength)}a instanceof f||(a=f.wrap(a,b));var e=a.limit-a.offset;if(e<=0)return this;var g=e-c;if(g>0){var h=new ArrayBuffer(this.buffer.byteLength+g),i=new Uint8Array(h);i.set(this.view.subarray(c,this.buffer.byteLength),e),this.buffer=h,this.view=i,this.offset+=g,this.markedOffset>=0&&(this.markedOffset+=g),this.limit+=g,c+=g}else{new Uint8Array(this.buffer)}return this.view.set(a.view.subarray(a.offset,a.limit),c-e),a.offset=a.limit,d&&(this.offset-=e),this},g.prependTo=function(a,b){return a.prepend(this,b),this},g.printDebug=function(a){"function"!=typeof a&&(a=console.log.bind(console)),a(this.toString()+"\n-------------------------------------------------------------------\n"+this.toDebug(!0))},g.remaining=function(){return this.limit-this.offset},g.reset=function(){return this.markedOffset>=0?(this.offset=this.markedOffset,this.markedOffset=-1):this.offset=0,this},g.resize=function(a){if(!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal capacity: "+a+" (not an integer)");if((a|=0)<0)throw RangeError("Illegal capacity: 0 <= "+a)}if(this.buffer.byteLength<a){var b=new ArrayBuffer(a),c=new Uint8Array(b);c.set(this.view),this.buffer=b,this.view=c}return this},g.reverse=function(a,b){if(void 0===a&&(a=this.offset),void 0===b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!=0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}return a===b?this:(Array.prototype.reverse.call(this.view.subarray(a,b)),this)},g.skip=function(a){if(!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal length: "+a+" (not an integer)");a|=0}var b=this.offset+a;if(!this.noAssert&&(b<0||b>this.buffer.byteLength))throw RangeError("Illegal length: 0 <= "+this.offset+" + "+a+" <= "+this.buffer.byteLength);return this.offset=b,this},g.slice=function(a,b){if(void 0===a&&(a=this.offset),void 0===b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!=0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}var c=this.clone();return c.offset=a,c.limit=b,c},g.toBuffer=function(a){var b=this.offset,c=this.limit;if(!this.noAssert){if("number"!=typeof b||b%1!=0)throw TypeError("Illegal offset: Not an integer");if(b>>>=0,"number"!=typeof c||c%1!=0)throw TypeError("Illegal limit: Not an integer");if(c>>>=0,b<0||b>c||c>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+b+" <= "+c+" <= "+this.buffer.byteLength)}if(!a&&0===b&&c===this.buffer.byteLength)return this.buffer;if(b===c)return h;var d=new ArrayBuffer(c-b);return new Uint8Array(d).set(new Uint8Array(this.buffer).subarray(b,c),0),d},g.toArrayBuffer=g.toBuffer,g.toString=function(a,b,c){if(void 0===a)return"ByteBufferAB(offset="+this.offset+",markedOffset="+this.markedOffset+",limit="+this.limit+",capacity="+this.capacity()+")";switch("number"==typeof a&&(a="utf8",b=a,c=b),a){case"utf8":return this.toUTF8(b,c);case"base64":return this.toBase64(b,c);case"hex":return this.toHex(b,c);case"binary":return this.toBinary(b,c);case"debug":return this.toDebug();case"columns":return this.toColumns();default:throw Error("Unsupported encoding: "+a)}};var j=function(){for(var a={},b=[65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,48,49,50,51,52,53,54,55,56,57,43,47],c=[],d=0,e=b.length;d<e;++d)c[b[d]]=d;return a.encode=function(a,c){for(var d,e;null!==(d=a());)c(b[d>>2&63]),e=(3&d)<<4,null!==(d=a())?(e|=d>>4&15,c(b[63&(e|d>>4&15)]),e=(15&d)<<2,null!==(d=a())?(c(b[63&(e|d>>6&3)]),c(b[63&d])):(c(b[63&e]),c(61))):(c(b[63&e]),c(61),c(61))},a.decode=function(a,b){function d(a){throw Error("Illegal character code: "+a)}for(var e,f,g;null!==(e=a());)if(f=c[e],void 0===f&&d(e),null!==(e=a())&&(g=c[e],void 0===g&&d(e),b(f<<2>>>0|(48&g)>>4),null!==(e=a()))){if(void 0===(f=c[e])){if(61===e)break;d(e)}if(b((15&g)<<4>>>0|(60&f)>>2),null!==(e=a())){if(void 0===(g=c[e])){if(61===e)break;d(e)}b((3&f)<<6>>>0|g)}}},a.test=function(a){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(a)},a}();g.toBase64=function(a,b){if(void 0===a&&(a=this.offset),void 0===b&&(b=this.limit),a|=0,b|=0,a<0||b>this.capacity||a>b)throw RangeError("begin, end");var d;return j.encode(function(){return a<b?this.view[a++]:null}.bind(this),d=c()),d()},f.fromBase64=function(a,c){if("string"!=typeof a)throw TypeError("str");var d=new f(a.length/4*3,c),e=0;return j.decode(b(a),function(a){d.view[e++]=a}),d.limit=e,d},f.btoa=function(a){return f.fromBinary(a).toBase64()},f.atob=function(a){return f.fromBase64(a).toBinary()},g.toBinary=function(a,b){if(void 0===a&&(a=this.offset),void 0===b&&(b=this.limit),a|=0,b|=0,a<0||b>this.capacity()||a>b)throw RangeError("begin, end");if(a===b)return"";for(var c=[],d=[];a<b;)c.push(this.view[a++]),c.length>=1024&&(d.push(String.fromCharCode.apply(String,c)),c=[]);return d.join("")+String.fromCharCode.apply(String,c)},f.fromBinary=function(a,b){if("string"!=typeof a)throw TypeError("str");for(var c,d=0,e=a.length,g=new f(e,b);d<e;){if((c=a.charCodeAt(d))>255)throw RangeError("illegal char code: "+c);g.view[d++]=c}return g.limit=e,g},g.toDebug=function(a){for(var b,c=-1,d=this.buffer.byteLength,e="",f="",g="";c<d;){if(-1!==c&&(b=this.view[c],e+=b<16?"0"+b.toString(16).toUpperCase():b.toString(16).toUpperCase(),a&&(f+=b>32&&b<127?String.fromCharCode(b):".")),++c,a&&c>0&&c%16==0&&c!==d){for(;e.length<51;)e+=" ";g+=e+f+"\n",e=f=""}c===this.offset&&c===this.limit?e+=c===this.markedOffset?"!":"|":c===this.offset?e+=c===this.markedOffset?"[":"<":c===this.limit?e+=c===this.markedOffset?"]":">":e+=c===this.markedOffset?"'":a||0!==c&&c!==d?" ":""}if(a&&" "!==e){for(;e.length<51;)e+=" ";g+=e+f+"\n"}return a?g:e},f.fromDebug=function(a,b,c){for(var d,e,g=a.length,h=new f((g+1)/3|0,b,c),i=0,j=0,k=!1,l=!1,m=!1,n=!1,o=!1;i<g;){switch(d=a.charAt(i++)){case"!":if(!c){if(l||m||n){o=!0;break}l=m=n=!0}h.offset=h.markedOffset=h.limit=j,k=!1;break;case"|":if(!c){if(l||n){o=!0;break}l=n=!0}h.offset=h.limit=j,k=!1;break;case"[":if(!c){if(l||m){o=!0;break}l=m=!0}h.offset=h.markedOffset=j,k=!1;break;case"<":if(!c){if(l){o=!0;break}l=!0}h.offset=j,k=!1;break;case"]":if(!c){if(n||m){o=!0;break}n=m=!0}h.limit=h.markedOffset=j,k=!1;break;case">":if(!c){if(n){o=!0;break}n=!0}h.limit=j,k=!1;break;case"'":if(!c){if(m){o=!0;break}m=!0}h.markedOffset=j,k=!1;break;case" ":k=!1;break;default:if(!c&&k){o=!0;break}if(e=parseInt(d+a.charAt(i++),16),!c&&(isNaN(e)||e<0||e>255))throw TypeError("Illegal str: Not a debug encoded string");h.view[j++]=e,k=!0}if(o)throw TypeError("Illegal str: Invalid symbol at "+i)}if(!c){if(!l||!n)throw TypeError("Illegal str: Missing offset or limit");if(j<h.buffer.byteLength)throw TypeError("Illegal str: Not a debug encoded string (is it hex?) "+j+" < "+g)}return h},g.toHex=function(a,b){if(a=void 0===a?this.offset:a,b=void 0===b?this.limit:b,!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!=0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}for(var c,d=new Array(b-a);a<b;)c=this.view[a++],c<16?d.push("0",c.toString(16)):d.push(c.toString(16));return d.join("")},f.fromHex=function(a,b,c){if(!c){if("string"!=typeof a)throw TypeError("Illegal str: Not a string");if(a.length%2!=0)throw TypeError("Illegal str: Length not a multiple of 2")}for(var d,e=a.length,g=new f(e/2|0,b),h=0,i=0;h<e;h+=2){if(d=parseInt(a.substring(h,h+2),16),!c&&(!isFinite(d)||d<0||d>255))throw TypeError("Illegal str: Contains non-hex characters");g.view[i++]=d}return g.limit=i,g};var k=function(){var a={};return a.MAX_CODEPOINT=1114111,a.encodeUTF8=function(a,b){var c=null;for("number"==typeof a&&(c=a,a=function(){return null});null!==c||null!==(c=a());)c<128?b(127&c):c<2048?(b(c>>6&31|192),b(63&c|128)):c<65536?(b(c>>12&15|224),b(c>>6&63|128),b(63&c|128)):(b(c>>18&7|240),b(c>>12&63|128),b(c>>6&63|128),b(63&c|128)),c=null},a.decodeUTF8=function(a,b){for(var c,d,e,f,g=function(a){a=a.slice(0,a.indexOf(null));var b=Error(a.toString());throw b.name="TruncatedError",b.bytes=a,b};null!==(c=a());)if(0==(128&c))b(c);else if(192==(224&c))null===(d=a())&&g([c,d]),b((31&c)<<6|63&d);else if(224==(240&c))(null===(d=a())||null===(e=a()))&&g([c,d,e]),b((15&c)<<12|(63&d)<<6|63&e);else{if(240!=(248&c))throw RangeError("Illegal starting byte: "+c);(null===(d=a())||null===(e=a())||null===(f=a()))&&g([c,d,e,f]),b((7&c)<<18|(63&d)<<12|(63&e)<<6|63&f)}},a.UTF16toUTF8=function(a,b){for(var c,d=null;;){if(null===(c=null!==d?d:a()))break;c>=55296&&c<=57343&&null!==(d=a())&&d>=56320&&d<=57343?(b(1024*(c-55296)+d-56320+65536),d=null):b(c)}null!==d&&b(d)},a.UTF8toUTF16=function(a,b){var c=null;for("number"==typeof a&&(c=a,a=function(){return null});null!==c||null!==(c=a());)c<=65535?b(c):(c-=65536,b(55296+(c>>10)),b(c%1024+56320)),c=null},a.encodeUTF16toUTF8=function(b,c){a.UTF16toUTF8(b,function(b){a.encodeUTF8(b,c)})},a.decodeUTF8toUTF16=function(b,c){a.decodeUTF8(b,function(b){a.UTF8toUTF16(b,c)})},a.calculateCodePoint=function(a){return a<128?1:a<2048?2:a<65536?3:4},a.calculateUTF8=function(a){for(var b,c=0;null!==(b=a());)c+=b<128?1:b<2048?2:b<65536?3:4;return c},a.calculateUTF16asUTF8=function(b){var c=0,d=0;return a.UTF16toUTF8(b,function(a){++c,d+=a<128?1:a<2048?2:a<65536?3:4}),[c,d]},a}();return g.toUTF8=function(a,b){if(void 0===a&&(a=this.offset),void 0===b&&(b=this.limit),!this.noAssert){if("number"!=typeof a||a%1!=0)throw TypeError("Illegal begin: Not an integer");if(a>>>=0,"number"!=typeof b||b%1!=0)throw TypeError("Illegal end: Not an integer");if(b>>>=0,a<0||a>b||b>this.buffer.byteLength)throw RangeError("Illegal range: 0 <= "+a+" <= "+b+" <= "+this.buffer.byteLength)}var d;try{k.decodeUTF8toUTF16(function(){return a<b?this.view[a++]:null}.bind(this),d=c())}catch(c){if(a!==b)throw RangeError("Illegal range: Truncated data, "+a+" != "+b)}return d()},f.fromUTF8=function(a,c,d){if(!d&&"string"!=typeof a)throw TypeError("Illegal str: Not a string");var e=new f(k.calculateUTF16asUTF8(b(a),!0)[1],c,d),g=0;return k.encodeUTF16toUTF8(b(a),function(a){e.view[g++]=a}),e.limit=g,e},f})},{long:174}],169:[function(a,b,c){"use strict";function d(a){return i+a}function e(a){return a.substring(i.length)}function f(a,b){for(var c in b)Object.defineProperty(a,c,{value:b[c],configurable:!0,writable:!0})}function g(a){if("string"!=typeof a)throw new TypeError("key must be a string.")}var h=Object.prototype.hasOwnProperty,i="~";b.exports=function(a){var b=Object.create(null),c=0,i={};return f(i,{get:function(a,c){g(a);var e=d(a);return e in b?b[e]:c},set:function(a,e){g(a);var f=d(a);return f in b||++c,b[f]=e},has:function(a){return g(a),d(a)in b},delete:function(a){g(a);var e=d(a);return e in b&&(--c,delete b[e],!0)},clear:function(){b=Object.create(null),c=0},forEach:function(a,c){if("function"!=typeof a)throw new TypeError("`callback` must be a function");for(var d in b)if(h.call(b,d)){var f=e(d),g=b[d];a.call(c,g,f,i)}}}),Object.defineProperty(i,"size",{get:function(){return c},configurable:!0}),"object"==typeof a&&null!==a&&Object.keys(a).forEach(function(b){i.set(b,a[b])}),i}},{}],170:[function(a,b,c){function d(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=v(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}function e(a){return void 0===a._maxListeners?d.defaultMaxListeners:a._maxListeners}function f(a,b,c){if(b)a.call(c);else for(var d=a.length,e=q(a,d),f=0;f<d;++f)e[f].call(c)}function g(a,b,c,d){if(b)a.call(c,d);else for(var e=a.length,f=q(a,e),g=0;g<e;++g)f[g].call(c,d)}function h(a,b,c,d,e){if(b)a.call(c,d,e);else for(var f=a.length,g=q(a,f),h=0;h<f;++h)g[h].call(c,d,e)}function i(a,b,c,d,e,f){if(b)a.call(c,d,e,f);else for(var g=a.length,h=q(a,g),i=0;i<g;++i)h[i].call(c,d,e,f)}function j(a,b,c,d){if(b)a.apply(c,d);else for(var e=a.length,f=q(a,e),g=0;g<e;++g)f[g].apply(c,d)}function k(a,b,c,d){var f,g,h;if("function"!=typeof c)throw new TypeError('"listener" argument must be a function');if(g=a._events,g?(g.newListener&&(a.emit("newListener",b,c.listener?c.listener:c),g=a._events),h=g[b]):(g=a._events=v(null),a._eventsCount=0),h){if("function"==typeof h?h=g[b]=d?[c,h]:[h,c]:d?h.unshift(c):h.push(c),!h.warned&&(f=e(a))&&f>0&&h.length>f){h.warned=!0;var i=new Error("Possible EventEmitter memory leak detected. "+h.length+' "'+String(b)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');i.name="MaxListenersExceededWarning",i.emitter=a,i.type=b,i.count=h.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",i.name,i.message)}}else h=g[b]=c,++a._eventsCount;return a}function l(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var a=new Array(arguments.length),b=0;b<a.length;++b)a[b]=arguments[b];this.listener.apply(this.target,a)}}function m(a,b,c){var d={fired:!1,wrapFn:void 0,target:a,type:b,listener:c},e=x.call(l,d);return e.listener=c,d.wrapFn=e,e}function n(a,b,c){var d=a._events;if(!d)return[];var e=d[b];return e?"function"==typeof e?c?[e.listener||e]:[e]:c?r(e):q(e,e.length):[]}function o(a){var b=this._events;if(b){var c=b[a];if("function"==typeof c)return 1;if(c)return c.length}return 0}function p(a,b){for(var c=b,d=c+1,e=a.length;d<e;c+=1,d+=1)a[c]=a[d];a.pop()}function q(a,b){for(var c=new Array(b),d=0;d<b;++d)c[d]=a[d];return c}function r(a){for(var b=new Array(a.length),c=0;c<b.length;++c)b[c]=a[c].listener||a[c];return b}function s(a){var b=function(){};return b.prototype=a,new b}function t(a){var b=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return c}function u(a){var b=this;return function(){return b.apply(a,arguments)}}var v=Object.create||s,w=Object.keys||t,x=Function.prototype.bind||u;b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0;var y,z=10;try{var A={};Object.defineProperty&&Object.defineProperty(A,"x",{value:0}),y=0===A.x}catch(a){y=!1}y?Object.defineProperty(d,"defaultMaxListeners",{enumerable:!0,get:function(){return z},set:function(a){if("number"!=typeof a||a<0||a!==a)throw new TypeError('"defaultMaxListeners" must be a positive number');z=a}}):d.defaultMaxListeners=z,d.prototype.setMaxListeners=function(a){if("number"!=typeof a||a<0||isNaN(a))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=a,this},d.prototype.getMaxListeners=function(){return e(this)},d.prototype.emit=function(a){var b,c,d,e,k,l,m="error"===a;if(l=this._events)m=m&&null==l.error;else if(!m)return!1;if(m){if(arguments.length>1&&(b=arguments[1]),b instanceof Error)throw b;var n=new Error('Unhandled "error" event. ('+b+")");throw n.context=b,n}if(!(c=l[a]))return!1;var o="function"==typeof c;switch(d=arguments.length){case 1:f(c,o,this);break;case 2:g(c,o,this,arguments[1]);break;case 3:h(c,o,this,arguments[1],arguments[2]);break;case 4:i(c,o,this,arguments[1],arguments[2],arguments[3]);break;default:for(e=new Array(d-1),k=1;k<d;k++)e[k-1]=arguments[k];j(c,o,this,e)}return!0},d.prototype.addListener=function(a,b){return k(this,a,b,!1)},d.prototype.on=d.prototype.addListener,d.prototype.prependListener=function(a,b){return k(this,a,b,!0)},d.prototype.once=function(a,b){if("function"!=typeof b)throw new TypeError('"listener" argument must be a function');return this.on(a,m(this,a,b)),this},d.prototype.prependOnceListener=function(a,b){if("function"!=typeof b)throw new TypeError('"listener" argument must be a function');return this.prependListener(a,m(this,a,b)),this},d.prototype.removeListener=function(a,b){var c,d,e,f,g;if("function"!=typeof b)throw new TypeError('"listener" argument must be a function');if(!(d=this._events))return this;if(!(c=d[a]))return this;if(c===b||c.listener===b)0==--this._eventsCount?this._events=v(null):(delete d[a],d.removeListener&&this.emit("removeListener",a,c.listener||b));else if("function"!=typeof c){for(e=-1,f=c.length-1;f>=0;f--)if(c[f]===b||c[f].listener===b){g=c[f].listener,e=f;break}if(e<0)return this;0===e?c.shift():p(c,e),1===c.length&&(d[a]=c[0]),d.removeListener&&this.emit("removeListener",a,g||b)}return this},d.prototype.removeAllListeners=function(a){var b,c,d;if(!(c=this._events))return this;if(!c.removeListener)return 0===arguments.length?(this._events=v(null),this._eventsCount=0):c[a]&&(0==--this._eventsCount?this._events=v(null):delete c[a]),this;if(0===arguments.length){var e,f=w(c);for(d=0;d<f.length;++d)"removeListener"!==(e=f[d])&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events=v(null),this._eventsCount=0,this}if("function"==typeof(b=c[a]))this.removeListener(a,b);else if(b)for(d=b.length-1;d>=0;d--)this.removeListener(a,b[d]);return this},d.prototype.listeners=function(a){return n(this,a,!0)},d.prototype.rawListeners=function(a){return n(this,a,!1)},d.listenerCount=function(a,b){return"function"==typeof a.listenerCount?a.listenerCount(b):o.call(a,b)},d.prototype.listenerCount=o,d.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],171:[function(a,b,c){b.exports=a("./lib/heap")},{"./lib/heap":172}],172:[function(a,b,c){(function(){var a,d,e,f,g,h,i,j,k,l,m,n,o,p,q;e=Math.floor,l=Math.min,d=function(a,b){return a<b?-1:a>b?1:0},k=function(a,b,c,f,g){var h;if(null==c&&(c=0),null==g&&(g=d),c<0)throw new Error("lo must be non-negative");for(null==f&&(f=a.length);c<f;)h=e((c+f)/2),g(b,a[h])<0?f=h:c=h+1;return[].splice.apply(a,[c,c-c].concat(b)),b},h=function(a,b,c){return null==c&&(c=d),a.push(b),p(a,0,a.length-1,c)},g=function(a,b){var c,e;return null==b&&(b=d),c=a.pop(),a.length?(e=a[0],a[0]=c,q(a,0,b)):e=c,e},j=function(a,b,c){var e;return null==c&&(c=d),e=a[0],a[0]=b,q(a,0,c),e},i=function(a,b,c){var e;return null==c&&(c=d),a.length&&c(a[0],b)<0&&(e=[a[0],b],b=e[0],a[0]=e[1],q(a,0,c)),b},f=function(a,b){var c,f,g,h,i,j;for(null==b&&(b=d),h=function(){j=[];for(var b=0,c=e(a.length/2);0<=c?b<c:b>c;0<=c?b++:b--)j.push(b);return j}.apply(this).reverse(),i=[],f=0,g=h.length;f<g;f++)c=h[f],i.push(q(a,c,b));return i},o=function(a,b,c){var e;if(null==c&&(c=d),-1!==(e=a.indexOf(b)))return p(a,0,e,c),q(a,e,c)},m=function(a,b,c){var e,g,h,j,k;if(null==c&&(c=d),g=a.slice(0,b),!g.length)return g;for(f(g,c),k=a.slice(b),h=0,j=k.length;h<j;h++)e=k[h],i(g,e,c);return g.sort(c).reverse()},n=function(a,b,c){var e,h,i,j,m,n,o,p,q;if(null==c&&(c=d),10*b<=a.length){if(i=a.slice(0,b).sort(c),!i.length)return i;for(h=i[i.length-1],o=a.slice(b),j=0,n=o.length;j<n;j++)e=o[j],c(e,h)<0&&(k(i,e,0,null,c),i.pop(),h=i[i.length-1]);return i}for(f(a,c),q=[],m=0,p=l(b,a.length);0<=p?m<p:m>p;0<=p?++m:--m)q.push(g(a,c));return q},p=function(a,b,c,e){var f,g,h;for(null==e&&(e=d),f=a[c];c>b&&(h=c-1>>1,g=a[h],e(f,g)<0);)a[c]=g,c=h;return a[c]=f},q=function(a,b,c){var e,f,g,h,i;for(null==c&&(c=d),f=a.length,i=b,g=a[b],e=2*b+1;e<f;)h=e+1,h<f&&!(c(a[e],a[h])<0)&&(e=h),a[b]=a[e],b=e,e=2*b+1;return a[b]=g,p(a,i,b,c)},a=function(){function a(a){this.cmp=null!=a?a:d,this.nodes=[]}return a.push=h,a.pop=g,a.replace=j,a.pushpop=i,a.heapify=f,a.updateItem=o,a.nlargest=m,a.nsmallest=n,a.prototype.push=function(a){return h(this.nodes,a,this.cmp)},a.prototype.pop=function(){return g(this.nodes,this.cmp)},a.prototype.peek=function(){return this.nodes[0]},a.prototype.contains=function(a){return-1!==this.nodes.indexOf(a)},a.prototype.replace=function(a){return j(this.nodes,a,this.cmp)},a.prototype.pushpop=function(a){return i(this.nodes,a,this.cmp)},a.prototype.heapify=function(){return f(this.nodes,this.cmp)},a.prototype.updateItem=function(a){return o(this.nodes,a,this.cmp)},a.prototype.clear=function(){return this.nodes=[]},a.prototype.empty=function(){return 0===this.nodes.length},a.prototype.size=function(){return this.nodes.length},a.prototype.clone=function(){var b;return b=new a,b.nodes=this.nodes.slice(0),b},a.prototype.toArray=function(){return this.nodes.slice(0)},a.prototype.insert=a.prototype.push,a.prototype.top=a.prototype.peek,a.prototype.front=a.prototype.peek,a.prototype.has=a.prototype.contains,a.prototype.copy=a.prototype.clone,a}(),function(a,d){"function"==typeof define&&define.amd?define([],d):"object"==typeof c?b.exports=d():a.Heap=d()}(this,function(){return a})}).call(this)},{}],173:[function(a,b,c){c.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:1/0*(n?-1:1);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},c.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=23===e?Math.pow(2,-24)-Math.pow(2,-77):0,n=d?0:f-1,o=d?1:-1,p=b<0||0===b&&1/b<0?1:0;for(b=Math.abs(b),isNaN(b)||b===1/0?(h=isNaN(b)?1:0,g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),b+=g+l>=1?m/i:m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}},{}],174:[function(a,b,c){!function(c,d){"function"==typeof define&&define.amd?define([],d):"function"==typeof a&&"object"==typeof b&&b&&b.exports?b.exports=d():(c.dcodeIO=c.dcodeIO||{}).Long=d()}(this,function(){"use strict";function a(a,b,c){this.low=0|a,this.high=0|b,this.unsigned=!!c}function b(a){return!0===(a&&a.__isLong__)}function c(a,b){var c,d,f;return b?(a>>>=0,(f=0<=a&&a<256)&&(d=i[a])?d:(c=e(a,(0|a)<0?-1:0,!0),f&&(i[a]=c),c)):(a|=0,(f=-128<=a&&a<128)&&(d=h[a])?d:(c=e(a,a<0?-1:0,!1),f&&(h[a]=c),c))}function d(a,b){if(isNaN(a)||!isFinite(a))return b?p:o;if(b){if(a<0)return p;if(a>=l)return u}else{if(a<=-m)return v;if(a+1>=m)return t}return a<0?d(-a,b).neg():e(a%k|0,a/k|0,b)}function e(b,c,d){return new a(b,c,d)}function f(a,b,c){if(0===a.length)throw Error("empty string");if("NaN"===a||"Infinity"===a||"+Infinity"===a||"-Infinity"===a)return o;if("number"==typeof b?(c=b,b=!1):b=!!b,(c=c||10)<2||36<c)throw RangeError("radix");var e;if((e=a.indexOf("-"))>0)throw Error("interior hyphen");if(0===e)return f(a.substring(1),b,c).neg();for(var g=d(j(c,8)),h=o,i=0;i<a.length;i+=8){var k=Math.min(8,a.length-i),l=parseInt(a.substring(i,i+k),c);if(k<8){var m=d(j(c,k));h=h.mul(m).add(d(l))}else h=h.mul(g),h=h.add(d(l))
}return h.unsigned=b,h}function g(b){return b instanceof a?b:"number"==typeof b?d(b):"string"==typeof b?f(b):e(b.low,b.high,b.unsigned)}a.prototype.__isLong__,Object.defineProperty(a.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),a.isLong=b;var h={},i={};a.fromInt=c,a.fromNumber=d,a.fromBits=e;var j=Math.pow;a.fromString=f,a.fromValue=g;var k=4294967296,l=k*k,m=l/2,n=c(1<<24),o=c(0);a.ZERO=o;var p=c(0,!0);a.UZERO=p;var q=c(1);a.ONE=q;var r=c(1,!0);a.UONE=r;var s=c(-1);a.NEG_ONE=s;var t=e(-1,2147483647,!1);a.MAX_VALUE=t;var u=e(-1,-1,!0);a.MAX_UNSIGNED_VALUE=u;var v=e(0,-2147483648,!1);a.MIN_VALUE=v;var w=a.prototype;return w.toInt=function(){return this.unsigned?this.low>>>0:this.low},w.toNumber=function(){return this.unsigned?(this.high>>>0)*k+(this.low>>>0):this.high*k+(this.low>>>0)},w.toString=function(a){if((a=a||10)<2||36<a)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(v)){var b=d(a),c=this.div(b),e=c.mul(b).sub(this);return c.toString(a)+e.toInt().toString(a)}return"-"+this.neg().toString(a)}for(var f=d(j(a,6),this.unsigned),g=this,h="";;){var i=g.div(f),k=g.sub(i.mul(f)).toInt()>>>0,l=k.toString(a);if(g=i,g.isZero())return l+h;for(;l.length<6;)l="0"+l;h=""+l+h}},w.getHighBits=function(){return this.high},w.getHighBitsUnsigned=function(){return this.high>>>0},w.getLowBits=function(){return this.low},w.getLowBitsUnsigned=function(){return this.low>>>0},w.getNumBitsAbs=function(){if(this.isNegative())return this.eq(v)?64:this.neg().getNumBitsAbs();for(var a=0!=this.high?this.high:this.low,b=31;b>0&&0==(a&1<<b);b--);return 0!=this.high?b+33:b+1},w.isZero=function(){return 0===this.high&&0===this.low},w.isNegative=function(){return!this.unsigned&&this.high<0},w.isPositive=function(){return this.unsigned||this.high>=0},w.isOdd=function(){return 1==(1&this.low)},w.isEven=function(){return 0==(1&this.low)},w.equals=function(a){return b(a)||(a=g(a)),(this.unsigned===a.unsigned||this.high>>>31!=1||a.high>>>31!=1)&&(this.high===a.high&&this.low===a.low)},w.eq=w.equals,w.notEquals=function(a){return!this.eq(a)},w.neq=w.notEquals,w.lessThan=function(a){return this.comp(a)<0},w.lt=w.lessThan,w.lessThanOrEqual=function(a){return this.comp(a)<=0},w.lte=w.lessThanOrEqual,w.greaterThan=function(a){return this.comp(a)>0},w.gt=w.greaterThan,w.greaterThanOrEqual=function(a){return this.comp(a)>=0},w.gte=w.greaterThanOrEqual,w.compare=function(a){if(b(a)||(a=g(a)),this.eq(a))return 0;var c=this.isNegative(),d=a.isNegative();return c&&!d?-1:!c&&d?1:this.unsigned?a.high>>>0>this.high>>>0||a.high===this.high&&a.low>>>0>this.low>>>0?-1:1:this.sub(a).isNegative()?-1:1},w.comp=w.compare,w.negate=function(){return!this.unsigned&&this.eq(v)?v:this.not().add(q)},w.neg=w.negate,w.add=function(a){b(a)||(a=g(a));var c=this.high>>>16,d=65535&this.high,f=this.low>>>16,h=65535&this.low,i=a.high>>>16,j=65535&a.high,k=a.low>>>16,l=65535&a.low,m=0,n=0,o=0,p=0;return p+=h+l,o+=p>>>16,p&=65535,o+=f+k,n+=o>>>16,o&=65535,n+=d+j,m+=n>>>16,n&=65535,m+=c+i,m&=65535,e(o<<16|p,m<<16|n,this.unsigned)},w.subtract=function(a){return b(a)||(a=g(a)),this.add(a.neg())},w.sub=w.subtract,w.multiply=function(a){if(this.isZero())return o;if(b(a)||(a=g(a)),a.isZero())return o;if(this.eq(v))return a.isOdd()?v:o;if(a.eq(v))return this.isOdd()?v:o;if(this.isNegative())return a.isNegative()?this.neg().mul(a.neg()):this.neg().mul(a).neg();if(a.isNegative())return this.mul(a.neg()).neg();if(this.lt(n)&&a.lt(n))return d(this.toNumber()*a.toNumber(),this.unsigned);var c=this.high>>>16,f=65535&this.high,h=this.low>>>16,i=65535&this.low,j=a.high>>>16,k=65535&a.high,l=a.low>>>16,m=65535&a.low,p=0,q=0,r=0,s=0;return s+=i*m,r+=s>>>16,s&=65535,r+=h*m,q+=r>>>16,r&=65535,r+=i*l,q+=r>>>16,r&=65535,q+=f*m,p+=q>>>16,q&=65535,q+=h*l,p+=q>>>16,q&=65535,q+=i*k,p+=q>>>16,q&=65535,p+=c*m+f*l+h*k+i*j,p&=65535,e(r<<16|s,p<<16|q,this.unsigned)},w.mul=w.multiply,w.divide=function(a){if(b(a)||(a=g(a)),a.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?p:o;var c,e,f;if(this.unsigned){if(a.unsigned||(a=a.toUnsigned()),a.gt(this))return p;if(a.gt(this.shru(1)))return r;f=p}else{if(this.eq(v)){if(a.eq(q)||a.eq(s))return v;if(a.eq(v))return q;return c=this.shr(1).div(a).shl(1),c.eq(o)?a.isNegative()?q:s:(e=this.sub(a.mul(c)),f=c.add(e.div(a)))}if(a.eq(v))return this.unsigned?p:o;if(this.isNegative())return a.isNegative()?this.neg().div(a.neg()):this.neg().div(a).neg();if(a.isNegative())return this.div(a.neg()).neg();f=o}for(e=this;e.gte(a);){c=Math.max(1,Math.floor(e.toNumber()/a.toNumber()));for(var h=Math.ceil(Math.log(c)/Math.LN2),i=h<=48?1:j(2,h-48),k=d(c),l=k.mul(a);l.isNegative()||l.gt(e);)c-=i,k=d(c,this.unsigned),l=k.mul(a);k.isZero()&&(k=q),f=f.add(k),e=e.sub(l)}return f},w.div=w.divide,w.modulo=function(a){return b(a)||(a=g(a)),this.sub(this.div(a).mul(a))},w.mod=w.modulo,w.not=function(){return e(~this.low,~this.high,this.unsigned)},w.and=function(a){return b(a)||(a=g(a)),e(this.low&a.low,this.high&a.high,this.unsigned)},w.or=function(a){return b(a)||(a=g(a)),e(this.low|a.low,this.high|a.high,this.unsigned)},w.xor=function(a){return b(a)||(a=g(a)),e(this.low^a.low,this.high^a.high,this.unsigned)},w.shiftLeft=function(a){return b(a)&&(a=a.toInt()),0==(a&=63)?this:a<32?e(this.low<<a,this.high<<a|this.low>>>32-a,this.unsigned):e(0,this.low<<a-32,this.unsigned)},w.shl=w.shiftLeft,w.shiftRight=function(a){return b(a)&&(a=a.toInt()),0==(a&=63)?this:a<32?e(this.low>>>a|this.high<<32-a,this.high>>a,this.unsigned):e(this.high>>a-32,this.high>=0?0:-1,this.unsigned)},w.shr=w.shiftRight,w.shiftRightUnsigned=function(a){if(b(a)&&(a=a.toInt()),0===(a&=63))return this;var c=this.high;if(a<32){return e(this.low>>>a|c<<32-a,c>>>a,this.unsigned)}return 32===a?e(c,0,this.unsigned):e(c>>>a-32,0,this.unsigned)},w.shru=w.shiftRightUnsigned,w.toSigned=function(){return this.unsigned?e(this.low,this.high,!1):this},w.toUnsigned=function(){return this.unsigned?this:e(this.low,this.high,!0)},w.toBytes=function(a){return a?this.toBytesLE():this.toBytesBE()},w.toBytesLE=function(){var a=this.high,b=this.low;return[255&b,b>>>8&255,b>>>16&255,b>>>24&255,255&a,a>>>8&255,a>>>16&255,a>>>24&255]},w.toBytesBE=function(){var a=this.high,b=this.low;return[a>>>24&255,a>>>16&255,a>>>8&255,255&a,b>>>24&255,b>>>16&255,b>>>8&255,255&b]},a})},{}],175:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.prependListener=k,n.prependOnceListener=k,n.listeners=function(a){return[]},n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],176:[function(a,b,c){(function(c){!function(c,d){"function"==typeof define&&define.amd?define(["bytebuffer"],d):"function"==typeof a&&"object"==typeof b&&b&&b.exports?b.exports=d(a("bytebuffer"),!0):(c.dcodeIO=c.dcodeIO||{}).ProtoBuf=d(c.dcodeIO.ByteBuffer)}(this,function(b,d){"use strict";var e={};return e.ByteBuffer=b,e.Long=b.Long||null,e.VERSION="5.0.3",e.WIRE_TYPES={},e.WIRE_TYPES.VARINT=0,e.WIRE_TYPES.BITS64=1,e.WIRE_TYPES.LDELIM=2,e.WIRE_TYPES.STARTGROUP=3,e.WIRE_TYPES.ENDGROUP=4,e.WIRE_TYPES.BITS32=5,e.PACKABLE_WIRE_TYPES=[e.WIRE_TYPES.VARINT,e.WIRE_TYPES.BITS64,e.WIRE_TYPES.BITS32],e.TYPES={int32:{name:"int32",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},uint32:{name:"uint32",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},sint32:{name:"sint32",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},int64:{name:"int64",wireType:e.WIRE_TYPES.VARINT,defaultValue:e.Long?e.Long.ZERO:void 0},uint64:{name:"uint64",wireType:e.WIRE_TYPES.VARINT,defaultValue:e.Long?e.Long.UZERO:void 0},sint64:{name:"sint64",wireType:e.WIRE_TYPES.VARINT,defaultValue:e.Long?e.Long.ZERO:void 0},bool:{name:"bool",wireType:e.WIRE_TYPES.VARINT,defaultValue:!1},double:{name:"double",wireType:e.WIRE_TYPES.BITS64,defaultValue:0},string:{name:"string",wireType:e.WIRE_TYPES.LDELIM,defaultValue:""},bytes:{name:"bytes",wireType:e.WIRE_TYPES.LDELIM,defaultValue:null},fixed32:{name:"fixed32",wireType:e.WIRE_TYPES.BITS32,defaultValue:0},sfixed32:{name:"sfixed32",wireType:e.WIRE_TYPES.BITS32,defaultValue:0},fixed64:{name:"fixed64",wireType:e.WIRE_TYPES.BITS64,defaultValue:e.Long?e.Long.UZERO:void 0},sfixed64:{name:"sfixed64",wireType:e.WIRE_TYPES.BITS64,defaultValue:e.Long?e.Long.ZERO:void 0},float:{name:"float",wireType:e.WIRE_TYPES.BITS32,defaultValue:0},enum:{name:"enum",wireType:e.WIRE_TYPES.VARINT,defaultValue:0},message:{name:"message",wireType:e.WIRE_TYPES.LDELIM,defaultValue:null},group:{name:"group",wireType:e.WIRE_TYPES.STARTGROUP,defaultValue:null}},e.MAP_KEY_TYPES=[e.TYPES.int32,e.TYPES.sint32,e.TYPES.sfixed32,e.TYPES.uint32,e.TYPES.fixed32,e.TYPES.int64,e.TYPES.sint64,e.TYPES.sfixed64,e.TYPES.uint64,e.TYPES.fixed64,e.TYPES.bool,e.TYPES.string,e.TYPES.bytes],e.ID_MIN=1,e.ID_MAX=536870911,e.convertFieldsToCamelCase=!1,e.populateAccessors=!0,e.populateDefaults=!0,e.Util=function(){var b={};return b.IS_NODE=!("object"!=typeof c||c+""!="[object process]"||c.browser),b.XHR=function(){for(var a=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],b=null,c=0;c<a.length;c++){try{b=a[c]()}catch(a){continue}break}if(!b)throw Error("XMLHttpRequest is not supported");return b},b.fetch=function(c,d){if(d&&"function"!=typeof d&&(d=null),b.IS_NODE){var e=a("fs");if(d)e.readFile(c,function(a,b){d(a?null:""+b)});else try{return e.readFileSync(c)}catch(a){return null}}else{var f=b.XHR();if(f.open("GET",c,!!d),f.setRequestHeader("Accept","text/plain"),"function"==typeof f.overrideMimeType&&f.overrideMimeType("text/plain"),!d)return f.send(null),200==f.status||0==f.status&&"string"==typeof f.responseText?f.responseText:null;if(f.onreadystatechange=function(){4==f.readyState&&d(200==f.status||0==f.status&&"string"==typeof f.responseText?f.responseText:null)},4==f.readyState)return;f.send(null)}},b.toCamelCase=function(a){return a.replace(/_([a-zA-Z])/g,function(a,b){return b.toUpperCase()})},b}(),e.Lang={DELIM:/[\s\{\}=;:\[\],'"\(\)<>]/g,RULE:/^(?:required|optional|repeated|map)$/,TYPE:/^(?:double|float|int32|uint32|sint32|int64|uint64|sint64|fixed32|sfixed32|fixed64|sfixed64|bool|string|bytes)$/,NAME:/^[a-zA-Z_][a-zA-Z_0-9]*$/,TYPEDEF:/^[a-zA-Z][a-zA-Z_0-9]*$/,TYPEREF:/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,FQTYPEREF:/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/,NUMBER:/^-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+|([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?)|inf|nan)$/,NUMBER_DEC:/^(?:[1-9][0-9]*|0)$/,NUMBER_HEX:/^0[xX][0-9a-fA-F]+$/,NUMBER_OCT:/^0[0-7]+$/,NUMBER_FLT:/^([0-9]*(\.[0-9]*)?([Ee][+-]?[0-9]+)?|inf|nan)$/,BOOL:/^(?:true|false)$/i,ID:/^(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,NEGID:/^\-?(?:[1-9][0-9]*|0|0[xX][0-9a-fA-F]+|0[0-7]+)$/,WHITESPACE:/\s/,STRING:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")|(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,STRING_DQ:/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,STRING_SQ:/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g},e.DotProto=function(a,b){function c(a,c){var d=-1,e=1;if("-"==a.charAt(0)&&(e=-1,a=a.substring(1)),b.NUMBER_DEC.test(a))d=parseInt(a);else if(b.NUMBER_HEX.test(a))d=parseInt(a.substring(2),16);else{if(!b.NUMBER_OCT.test(a))throw Error("illegal id value: "+(e<0?"-":"")+a);d=parseInt(a.substring(1),8)}if(d=e*d|0,!c&&d<0)throw Error("illegal id value: "+(e<0?"-":"")+a);return d}function d(a){var c=1;if("-"==a.charAt(0)&&(c=-1,a=a.substring(1)),b.NUMBER_DEC.test(a))return c*parseInt(a,10);if(b.NUMBER_HEX.test(a))return c*parseInt(a.substring(2),16);if(b.NUMBER_OCT.test(a))return c*parseInt(a.substring(1),8);if("inf"===a)return c*(1/0);if("nan"===a)return NaN;if(b.NUMBER_FLT.test(a))return c*parseFloat(a);throw Error("illegal number value: "+(c<0?"-":"")+a)}function e(a,b,c){void 0===a[b]?a[b]=c:(Array.isArray(a[b])||(a[b]=[a[b]]),a[b].push(c))}var f={},g=function(a){this.source=a+"",this.index=0,this.line=1,this.stack=[],this._stringOpen=null},h=g.prototype;h._readString=function(){var a='"'===this._stringOpen?b.STRING_DQ:b.STRING_SQ;a.lastIndex=this.index-1;var c=a.exec(this.source);if(!c)throw Error("unterminated string");return this.index=a.lastIndex,this.stack.push(this._stringOpen),this._stringOpen=null,c[1]},h.next=function(){if(this.stack.length>0)return this.stack.shift();if(this.index>=this.source.length)return null;if(null!==this._stringOpen)return this._readString();var a,c,d;do{for(a=!1;b.WHITESPACE.test(d=this.source.charAt(this.index));)if("\n"===d&&++this.line,++this.index===this.source.length)return null;if("/"===this.source.charAt(this.index))if(++this.index,"/"===this.source.charAt(this.index)){for(;"\n"!==this.source.charAt(++this.index);)if(this.index==this.source.length)return null;++this.index,++this.line,a=!0}else{if("*"!==(d=this.source.charAt(this.index)))return"/";do{if("\n"===d&&++this.line,++this.index===this.source.length)return null;c=d,d=this.source.charAt(this.index)}while("*"!==c||"/"!==d);++this.index,a=!0}}while(a);if(this.index===this.source.length)return null;var e=this.index;if(b.DELIM.lastIndex=0,!b.DELIM.test(this.source.charAt(e++)))for(;e<this.source.length&&!b.DELIM.test(this.source.charAt(e));)++e;var f=this.source.substring(this.index,this.index=e);return'"'!==f&&"'"!==f||(this._stringOpen=f),f},h.peek=function(){if(0===this.stack.length){var a=this.next();if(null===a)return null;this.stack.push(a)}return this.stack[0]},h.skip=function(a){var b=this.next();if(b!==a)throw Error("illegal '"+b+"', '"+a+"' expected")},h.omit=function(a){return this.peek()===a&&(this.next(),!0)},h.toString=function(){return"Tokenizer ("+this.index+"/"+this.source.length+" at line "+this.line+")"},f.Tokenizer=g;var i=function(a){this.tn=new g(a),this.proto3=!1},j=i.prototype;return j.parse=function(){var a,c,d={name:"[ROOT]",package:null,messages:[],enums:[],imports:[],options:{},services:[]},e=!0;try{for(;a=this.tn.next();)switch(a){case"package":if(!e||null!==d.package)throw Error("unexpected 'package'");if(a=this.tn.next(),!b.TYPEREF.test(a))throw Error("illegal package name: "+a);this.tn.skip(";"),d.package=a;break;case"import":if(!e)throw Error("unexpected 'import'");a=this.tn.peek(),("public"===a||(c="weak"===a))&&this.tn.next(),a=this._readString(),this.tn.skip(";"),c||d.imports.push(a);break;case"syntax":if(!e)throw Error("unexpected 'syntax'");this.tn.skip("="),"proto3"===(d.syntax=this._readString())&&(this.proto3=!0),this.tn.skip(";");break;case"message":this._parseMessage(d,null),e=!1;break;case"enum":this._parseEnum(d),e=!1;break;case"option":this._parseOption(d);break;case"service":this._parseService(d);break;case"extend":this._parseExtend(d);break;default:throw Error("unexpected '"+a+"'")}}catch(a){throw a.message="Parse error at line "+this.tn.line+": "+a.message,a}return delete d.name,d},i.parse=function(a){return new i(a).parse()},j._readString=function(){var a,b,c="";do{if("'"!==(b=this.tn.next())&&'"'!==b)throw Error("illegal string delimiter: "+b);c+=this.tn.next(),this.tn.skip(b),a=this.tn.peek()}while('"'===a||'"'===a);return c},j._readValue=function(a){var c=this.tn.peek();if('"'===c||"'"===c)return this._readString();if(this.tn.next(),b.NUMBER.test(c))return d(c);if(b.BOOL.test(c))return"true"===c.toLowerCase();if(a&&b.TYPEREF.test(c))return c;throw Error("illegal value: "+c)},j._parseOption=function(a,c){var d=this.tn.next(),e=!1;if("("===d&&(e=!0,d=this.tn.next()),!b.TYPEREF.test(d))throw Error("illegal option name: "+d);var f=d;e&&(this.tn.skip(")"),f="("+f+")",d=this.tn.peek(),b.FQTYPEREF.test(d)&&(f+=d,this.tn.next())),this.tn.skip("="),this._parseOptionValue(a,f),c||this.tn.skip(";")},j._parseOptionValue=function(a,c){var d=this.tn.peek();if("{"!==d)e(a.options,c,this._readValue(!0));else for(this.tn.skip("{");"}"!==(d=this.tn.next());){if(!b.NAME.test(d))throw Error("illegal option name: "+c+"."+d);this.tn.omit(":")?e(a.options,c+"."+d,this._readValue(!0)):this._parseOptionValue(a,c+"."+d)}},j._parseService=function(a){var c=this.tn.next();if(!b.NAME.test(c))throw Error("illegal service name at line "+this.tn.line+": "+c);var d=c,e={name:d,rpc:{},options:{}};for(this.tn.skip("{");"}"!==(c=this.tn.next());)if("option"===c)this._parseOption(e);else{if("rpc"!==c)throw Error("illegal service token: "+c);this._parseServiceRPC(e)}this.tn.omit(";"),a.services.push(e)},j._parseServiceRPC=function(a){var c=this.tn.next();if(!b.NAME.test(c))throw Error("illegal rpc service method name: "+c);var d=c,e={request:null,response:null,request_stream:!1,response_stream:!1,options:{}};if(this.tn.skip("("),c=this.tn.next(),"stream"===c.toLowerCase()&&(e.request_stream=!0,c=this.tn.next()),!b.TYPEREF.test(c))throw Error("illegal rpc service request type: "+c);if(e.request=c,this.tn.skip(")"),c=this.tn.next(),"returns"!==c.toLowerCase())throw Error("illegal rpc service request type delimiter: "+c);if(this.tn.skip("("),c=this.tn.next(),"stream"===c.toLowerCase()&&(e.response_stream=!0,c=this.tn.next()),e.response=c,this.tn.skip(")"),"{"===(c=this.tn.peek())){for(this.tn.next();"}"!==(c=this.tn.next());){if("option"!==c)throw Error("illegal rpc service token: "+c);this._parseOption(e)}this.tn.omit(";")}else this.tn.skip(";");void 0===a.rpc&&(a.rpc={}),a.rpc[d]=e},j._parseMessage=function(a,d){var e=!!d,f=this.tn.next(),g={name:"",fields:[],enums:[],messages:[],options:{},services:[],oneofs:{}};if(!b.NAME.test(f))throw Error("illegal "+(e?"group":"message")+" name: "+f);for(g.name=f,e&&(this.tn.skip("="),d.id=c(this.tn.next()),g.isGroup=!0),f=this.tn.peek(),"["===f&&d&&this._parseFieldOptions(d),this.tn.skip("{");"}"!==(f=this.tn.next());)if(b.RULE.test(f))this._parseMessageField(g,f);else if("oneof"===f)this._parseMessageOneOf(g);else if("enum"===f)this._parseEnum(g);else if("message"===f)this._parseMessage(g);else if("option"===f)this._parseOption(g);else if("service"===f)this._parseService(g);else if("extensions"===f)g.hasOwnProperty("extensions")?g.extensions=g.extensions.concat(this._parseExtensionRanges()):g.extensions=this._parseExtensionRanges();else if("reserved"===f)this._parseIgnored();else if("extend"===f)this._parseExtend(g);else{if(!b.TYPEREF.test(f))throw Error("illegal message token: "+f);if(!this.proto3)throw Error("illegal field rule: "+f);this._parseMessageField(g,"optional",f)}return this.tn.omit(";"),a.messages.push(g),g},j._parseIgnored=function(){for(;";"!==this.tn.peek();)this.tn.next();this.tn.skip(";")},j._parseMessageField=function(a,d,e){if(!b.RULE.test(d))throw Error("illegal message field rule: "+d);var f,g={rule:d,type:"",name:"",options:{},id:0};if("map"===d){if(e)throw Error("illegal type: "+e);if(this.tn.skip("<"),f=this.tn.next(),!b.TYPE.test(f)&&!b.TYPEREF.test(f))throw Error("illegal message field type: "+f);if(g.keytype=f,this.tn.skip(","),f=this.tn.next(),!b.TYPE.test(f)&&!b.TYPEREF.test(f))throw Error("illegal message field: "+f);if(g.type=f,this.tn.skip(">"),f=this.tn.next(),!b.NAME.test(f))throw Error("illegal message field name: "+f);g.name=f,this.tn.skip("="),g.id=c(this.tn.next()),f=this.tn.peek(),"["===f&&this._parseFieldOptions(g),this.tn.skip(";")}else if("group"===(e=void 0!==e?e:this.tn.next())){var h=this._parseMessage(a,g);if(!/^[A-Z]/.test(h.name))throw Error("illegal group name: "+h.name);g.type=h.name,g.name=h.name.toLowerCase(),this.tn.omit(";")}else{if(!b.TYPE.test(e)&&!b.TYPEREF.test(e))throw Error("illegal message field type: "+e);if(g.type=e,f=this.tn.next(),!b.NAME.test(f))throw Error("illegal message field name: "+f);g.name=f,this.tn.skip("="),g.id=c(this.tn.next()),f=this.tn.peek(),"["===f&&this._parseFieldOptions(g),this.tn.skip(";")}return a.fields.push(g),g},j._parseMessageOneOf=function(a){var c=this.tn.next();if(!b.NAME.test(c))throw Error("illegal oneof name: "+c);var d,e=c,f=[];for(this.tn.skip("{");"}"!==(c=this.tn.next());)d=this._parseMessageField(a,"optional",c),d.oneof=e,f.push(d.id);this.tn.omit(";"),a.oneofs[e]=f},j._parseFieldOptions=function(a){this.tn.skip("[");for(var b=!0;"]"!==this.tn.peek();)b||this.tn.skip(","),this._parseOption(a,!0),b=!1;this.tn.next()},j._parseEnum=function(a){var d={name:"",values:[],options:{}},e=this.tn.next();if(!b.NAME.test(e))throw Error("illegal name: "+e);for(d.name=e,this.tn.skip("{");"}"!==(e=this.tn.next());)if("option"===e)this._parseOption(d);else{if(!b.NAME.test(e))throw Error("illegal name: "+e);this.tn.skip("=");var f={name:e,id:c(this.tn.next(),!0)};e=this.tn.peek(),"["===e&&this._parseFieldOptions({options:{}}),this.tn.skip(";"),d.values.push(f)}this.tn.omit(";"),a.enums.push(d)},j._parseExtensionRanges=function(){var b,c,e,f=[];do{for(c=[];;){switch(b=this.tn.next()){case"min":e=a.ID_MIN;break;case"max":e=a.ID_MAX;break;default:e=d(b)}if(c.push(e),2===c.length)break;if("to"!==this.tn.peek()){c.push(e);break}this.tn.next()}f.push(c)}while(this.tn.omit(","));return this.tn.skip(";"),f},j._parseExtend=function(a){var c=this.tn.next();if(!b.TYPEREF.test(c))throw Error("illegal extend reference: "+c);var d={ref:c,fields:[]};for(this.tn.skip("{");"}"!==(c=this.tn.next());)if(b.RULE.test(c))this._parseMessageField(d,c);else{if(!b.TYPEREF.test(c))throw Error("illegal extend token: "+c);if(!this.proto3)throw Error("illegal field rule: "+c);this._parseMessageField(d,"optional",c)}return this.tn.omit(";"),a.messages.push(d),d},j.toString=function(){return"Parser at line "+this.tn.line},f.Parser=i,f}(e,e.Lang),e.Reflect=function(a){function c(c){if("string"==typeof c&&(c=a.TYPES[c]),void 0===c.defaultValue)throw Error("default value for type "+c.name+" is not supported");return c==a.TYPES.bytes?new b(0):c.defaultValue}function d(b,c){if(b&&"number"==typeof b.low&&"number"==typeof b.high&&"boolean"==typeof b.unsigned&&b.low===b.low&&b.high===b.high)return new a.Long(b.low,b.high,void 0===c?b.unsigned:c);if("string"==typeof b)return a.Long.fromString(b,c||!1,10);if("number"==typeof b)return a.Long.fromNumber(b,c||!1);throw Error("not convertible to Long")}function e(b,c){var d=c.readVarint32(),f=7&d,g=d>>>3;switch(f){case a.WIRE_TYPES.VARINT:do{d=c.readUint8()}while(128==(128&d));break;case a.WIRE_TYPES.BITS64:c.offset+=8;break;case a.WIRE_TYPES.LDELIM:d=c.readVarint32(),c.offset+=d;break;case a.WIRE_TYPES.STARTGROUP:e(g,c);break;case a.WIRE_TYPES.ENDGROUP:if(g===b)return!1;throw Error("Illegal GROUPEND after unknown group: "+g+" ("+b+" expected)");case a.WIRE_TYPES.BITS32:c.offset+=4;break;default:throw Error("Illegal wire type in unknown group "+b+": "+f)}return!0}var f={},g=function(a,b,c){this.builder=a,this.parent=b,this.name=c,this.className},h=g.prototype;h.fqn=function(){for(var a=this.name,b=this;;){if(null==(b=b.parent))break;a=b.name+"."+a}return a},h.toString=function(a){return(a?this.className+" ":"")+this.fqn()},h.build=function(){throw Error(this.toString(!0)+" cannot be built directly")},f.T=g;var i=function(a,b,c,d,e){g.call(this,a,b,c),this.className="Namespace",this.children=[],this.options=d||{},this.syntax=e||"proto2"},j=i.prototype=Object.create(g.prototype);j.getChildren=function(a){if(null==(a=a||null))return this.children.slice();for(var b=[],c=0,d=this.children.length;c<d;++c)this.children[c]instanceof a&&b.push(this.children[c]);return b},j.addChild=function(a){var b;if(b=this.getChild(a.name))if(b instanceof m.Field&&b.name!==b.originalName&&null===this.getChild(b.originalName))b.name=b.originalName;else{if(!(a instanceof m.Field&&a.name!==a.originalName&&null===this.getChild(a.originalName)))throw Error("Duplicate name in namespace "+this.toString(!0)+": "+a.name);a.name=a.originalName}this.children.push(a)},j.getChild=function(a){for(var b="number"==typeof a?"id":"name",c=0,d=this.children.length;c<d;++c)if(this.children[c][b]===a)return this.children[c];return null},j.resolve=function(a,b){var c="string"==typeof a?a.split("."):a,d=this,e=0;if(""===c[e]){for(;null!==d.parent;)d=d.parent;e++}var g;do{do{if(!(d instanceof f.Namespace)){d=null;break}if(!(g=d.getChild(c[e]))||!(g instanceof f.T)||b&&!(g instanceof f.Namespace)){d=null;break}d=g,e++}while(e<c.length);if(null!=d)break;if(null!==this.parent)return this.parent.resolve(a,b)}while(null!=d);return d},j.qn=function(a){var b=[],c=a;do{b.unshift(c.name),c=c.parent}while(null!==c);for(var d=1;d<=b.length;d++){var e=b.slice(b.length-d);if(a===this.resolve(e,a instanceof f.Namespace))return e.join(".")}return a.fqn()},j.build=function(){for(var a,b={},c=this.children,d=0,e=c.length;d<e;++d)(a=c[d])instanceof i&&(b[a.name]=a.build());return Object.defineProperty&&Object.defineProperty(b,"$options",{value:this.buildOpt()}),b},j.buildOpt=function(){for(var a={},b=Object.keys(this.options),c=0,d=b.length;c<d;++c){var e=b[c],f=this.options[b[c]];a[e]=f}return a},j.getOption=function(a){return void 0===a?this.options:void 0!==this.options[a]?this.options[a]:null},f.Namespace=i;var k=function(b,c,d,e,f){if(this.type=b,this.resolvedType=c,this.isMapKey=d,this.syntax=e,this.name=f,d&&a.MAP_KEY_TYPES.indexOf(b)<0)throw Error("Invalid map key type: "+b.name)},l=k.prototype;k.defaultFieldValue=c,l.toString=function(){return(this.name||"")+(this.isMapKey?"map":"value")+" element"},l.verifyValue=function(c){function e(a,b){throw Error("Illegal value for "+f.toString(!0)+" of type "+f.type.name+": "+a+" ("+b+")")}var f=this;switch(this.type){case a.TYPES.int32:case a.TYPES.sint32:case a.TYPES.sfixed32:return("number"!=typeof c||c===c&&c%1!=0)&&e(typeof c,"not an integer"),c>4294967295?0|c:c;case a.TYPES.uint32:case a.TYPES.fixed32:return("number"!=typeof c||c===c&&c%1!=0)&&e(typeof c,"not an integer"),c<0?c>>>0:c;case a.TYPES.int64:case a.TYPES.sint64:case a.TYPES.sfixed64:if(a.Long)try{return d(c,!1)}catch(a){e(typeof c,a.message)}else e(typeof c,"requires Long.js");case a.TYPES.uint64:case a.TYPES.fixed64:if(a.Long)try{return d(c,!0)}catch(a){e(typeof c,a.message)}else e(typeof c,"requires Long.js");case a.TYPES.bool:return"boolean"!=typeof c&&e(typeof c,"not a boolean"),c;case a.TYPES.float:case a.TYPES.double:return"number"!=typeof c&&e(typeof c,"not a number"),c;case a.TYPES.string:return"string"==typeof c||c&&c instanceof String||e(typeof c,"not a string"),""+c;case a.TYPES.bytes:return b.isByteBuffer(c)?c:b.wrap(c,"base64");case a.TYPES.enum:var g=this.resolvedType.getChildren(a.Reflect.Enum.Value);for(i=0;i<g.length;i++){if(g[i].name==c)return g[i].id;if(g[i].id==c)return g[i].id}if("proto3"===this.syntax)return("number"!=typeof c||c===c&&c%1!=0)&&e(typeof c,"not an integer"),(c>4294967295||c<0)&&e(typeof c,"not in range for uint32"),c;e(c,"not a valid enum value");case a.TYPES.group:case a.TYPES.message:if(c&&"object"==typeof c||e(typeof c,"object expected"),c instanceof this.resolvedType.clazz)return c;if(c instanceof a.Builder.Message){var h={};for(var i in c)c.hasOwnProperty(i)&&(h[i]=c[i]);c=h}return new this.resolvedType.clazz(c)}throw Error("[INTERNAL] Illegal value for "+this.toString(!0)+": "+c+" (undefined type "+this.type+")")},l.calculateLength=function(c,d){if(null===d)return 0;var e;switch(this.type){case a.TYPES.int32:return d<0?b.calculateVarint64(d):b.calculateVarint32(d);case a.TYPES.uint32:return b.calculateVarint32(d);case a.TYPES.sint32:return b.calculateVarint32(b.zigZagEncode32(d));case a.TYPES.fixed32:case a.TYPES.sfixed32:case a.TYPES.float:return 4;case a.TYPES.int64:case a.TYPES.uint64:return b.calculateVarint64(d);case a.TYPES.sint64:return b.calculateVarint64(b.zigZagEncode64(d));case a.TYPES.fixed64:case a.TYPES.sfixed64:return 8;case a.TYPES.bool:return 1;case a.TYPES.enum:return b.calculateVarint32(d);case a.TYPES.double:return 8;case a.TYPES.string:return e=b.calculateUTF8Bytes(d),b.calculateVarint32(e)+e;case a.TYPES.bytes:if(d.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+d.remaining()+" bytes remaining");return b.calculateVarint32(d.remaining())+d.remaining();case a.TYPES.message:return e=this.resolvedType.calculate(d),b.calculateVarint32(e)+e;case a.TYPES.group:return(e=this.resolvedType.calculate(d))+b.calculateVarint32(c<<3|a.WIRE_TYPES.ENDGROUP)}throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+d+" (unknown type)")},l.encodeValue=function(c,d,e){if(null===d)return e;switch(this.type){case a.TYPES.int32:d<0?e.writeVarint64(d):e.writeVarint32(d);break;case a.TYPES.uint32:e.writeVarint32(d);break;case a.TYPES.sint32:e.writeVarint32ZigZag(d);break;case a.TYPES.fixed32:e.writeUint32(d);break;case a.TYPES.sfixed32:e.writeInt32(d);break;case a.TYPES.int64:case a.TYPES.uint64:e.writeVarint64(d);break;case a.TYPES.sint64:e.writeVarint64ZigZag(d);break;case a.TYPES.fixed64:e.writeUint64(d);break;case a.TYPES.sfixed64:e.writeInt64(d);break;case a.TYPES.bool:"string"==typeof d?e.writeVarint32("false"===d.toLowerCase()?0:!!d):e.writeVarint32(d?1:0);break;case a.TYPES.enum:e.writeVarint32(d);break;case a.TYPES.float:e.writeFloat32(d);break;case a.TYPES.double:e.writeFloat64(d);break;case a.TYPES.string:e.writeVString(d);break;case a.TYPES.bytes:if(d.remaining()<0)throw Error("Illegal value for "+this.toString(!0)+": "+d.remaining()+" bytes remaining");var f=d.offset;e.writeVarint32(d.remaining()),e.append(d),d.offset=f;break;case a.TYPES.message:var g=(new b).LE();this.resolvedType.encode(d,g),e.writeVarint32(g.offset),e.append(g.flip());break;case a.TYPES.group:this.resolvedType.encode(d,e),e.writeVarint32(c<<3|a.WIRE_TYPES.ENDGROUP);break;default:throw Error("[INTERNAL] Illegal value to encode in "+this.toString(!0)+": "+d+" (unknown type)")}return e},l.decode=function(b,c,d){if(c!=this.type.wireType)throw Error("Unexpected wire type for element");var e,f;switch(this.type){case a.TYPES.int32:return 0|b.readVarint32();case a.TYPES.uint32:return b.readVarint32()>>>0;case a.TYPES.sint32:return 0|b.readVarint32ZigZag();case a.TYPES.fixed32:return b.readUint32()>>>0;case a.TYPES.sfixed32:return 0|b.readInt32();case a.TYPES.int64:return b.readVarint64();case a.TYPES.uint64:return b.readVarint64().toUnsigned();case a.TYPES.sint64:return b.readVarint64ZigZag();case a.TYPES.fixed64:return b.readUint64();case a.TYPES.sfixed64:return b.readInt64();case a.TYPES.bool:return!!b.readVarint32();case a.TYPES.enum:return b.readVarint32();case a.TYPES.float:return b.readFloat();case a.TYPES.double:return b.readDouble();case a.TYPES.string:return b.readVString();case a.TYPES.bytes:if(f=b.readVarint32(),b.remaining()<f)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+f+" required but got only "+b.remaining());return e=b.clone(),e.limit=e.offset+f,b.offset+=f,e;case a.TYPES.message:return f=b.readVarint32(),this.resolvedType.decode(b,f);case a.TYPES.group:return this.resolvedType.decode(b,-1,d)}
throw Error("[INTERNAL] Illegal decode type")},l.valueFromString=function(c){if(!this.isMapKey)throw Error("valueFromString() called on non-map-key element");switch(this.type){case a.TYPES.int32:case a.TYPES.sint32:case a.TYPES.sfixed32:case a.TYPES.uint32:case a.TYPES.fixed32:return this.verifyValue(parseInt(c));case a.TYPES.int64:case a.TYPES.sint64:case a.TYPES.sfixed64:case a.TYPES.uint64:case a.TYPES.fixed64:return this.verifyValue(c);case a.TYPES.bool:return"true"===c;case a.TYPES.string:return this.verifyValue(c);case a.TYPES.bytes:return b.fromBinary(c)}},l.valueToString=function(b){if(!this.isMapKey)throw Error("valueToString() called on non-map-key element");return this.type===a.TYPES.bytes?b.toString("binary"):b.toString()},f.Element=k;var m=function(a,b,c,d,e,f){i.call(this,a,b,c,d,f),this.className="Message",this.extensions=void 0,this.clazz=null,this.isGroup=!!e,this._fields=null,this._fieldsById=null,this._fieldsByName=null},n=m.prototype=Object.create(i.prototype);n.build=function(c){if(this.clazz&&!c)return this.clazz;var d=function(a,c){function d(c,e,f,g){if(null===c||"object"!=typeof c){if(g&&g instanceof a.Reflect.Enum){var h=a.Reflect.Enum.getName(g.object,c);if(null!==h)return h}return c}if(b.isByteBuffer(c))return e?c.toBase64():c.toBuffer();if(a.Long.isLong(c))return f?c.toString():a.Long.fromValue(c);var i;if(Array.isArray(c))return i=[],c.forEach(function(a,b){i[b]=d(a,e,f,g)}),i;if(i={},c instanceof a.Map){for(var j=c.entries(),k=j.next();!k.done;k=j.next())i[c.keyElem.valueToString(k.value[0])]=d(k.value[1],e,f,c.valueElem.resolvedType);return i}var l=c.$type,m=void 0;for(var n in c)c.hasOwnProperty(n)&&(l&&(m=l.getChild(n))?i[n]=d(c[n],e,f,m.resolvedType):i[n]=d(c[n],e,f));return i}var e=c.getChildren(a.Reflect.Message.Field),f=c.getChildren(a.Reflect.Message.OneOf),g=function(d,h){a.Builder.Message.call(this);for(var i=0,j=f.length;i<j;++i)this[f[i].name]=null;for(i=0,j=e.length;i<j;++i){var k=e[i];this[k.name]=k.repeated?[]:k.map?new a.Map(k):null,!k.required&&"proto3"!==c.syntax||null===k.defaultValue||(this[k.name]=k.defaultValue)}if(arguments.length>0){var l;if(1!==arguments.length||null===d||"object"!=typeof d||!("function"!=typeof d.encode||d instanceof g)||Array.isArray(d)||d instanceof a.Map||b.isByteBuffer(d)||d instanceof ArrayBuffer||a.Long&&d instanceof a.Long)for(i=0,j=arguments.length;i<j;++i)void 0!==(l=arguments[i])&&this.$set(e[i].name,l);else this.$set(d)}},h=g.prototype=Object.create(a.Builder.Message.prototype);h.add=function(b,d,e){var f=c._fieldsByName[b];if(!e){if(!f)throw Error(this+"#"+b+" is undefined");if(!(f instanceof a.Reflect.Message.Field))throw Error(this+"#"+b+" is not a field: "+f.toString(!0));if(!f.repeated)throw Error(this+"#"+b+" is not a repeated field");d=f.verifyValue(d,!0)}return null===this[b]&&(this[b]=[]),this[b].push(d),this},h.$add=h.add,h.set=function(b,d,e){if(b&&"object"==typeof b){e=d;for(var f in b)b.hasOwnProperty(f)&&void 0!==(d=b[f])&&void 0===c._oneofsByName[f]&&this.$set(f,d,e);return this}var g=c._fieldsByName[b];if(e)this[b]=d;else{if(!g)throw Error(this+"#"+b+" is not a field: undefined");if(!(g instanceof a.Reflect.Message.Field))throw Error(this+"#"+b+" is not a field: "+g.toString(!0));this[g.name]=d=g.verifyValue(d)}if(g&&g.oneof){var h=this[g.oneof.name];null!==d?(null!==h&&h!==g.name&&(this[h]=null),this[g.oneof.name]=g.name):h===b&&(this[g.oneof.name]=null)}return this},h.$set=h.set,h.get=function(b,d){if(d)return this[b];var e=c._fieldsByName[b];if(!(e&&e instanceof a.Reflect.Message.Field))throw Error(this+"#"+b+" is not a field: undefined");if(!(e instanceof a.Reflect.Message.Field))throw Error(this+"#"+b+" is not a field: "+e.toString(!0));return this[e.name]},h.$get=h.get;for(var i=0;i<e.length;i++){var j=e[i];j instanceof a.Reflect.Message.ExtensionField||c.builder.options.populateAccessors&&function(a){var b=a.originalName.replace(/(_[a-zA-Z])/g,function(a){return a.toUpperCase().replace("_","")});b=b.substring(0,1).toUpperCase()+b.substring(1);var d=a.originalName.replace(/([A-Z])/g,function(a){return"_"+a}),e=function(b,c){return this[a.name]=c?b:a.verifyValue(b),this},f=function(){return this[a.name]};null===c.getChild("set"+b)&&(h["set"+b]=e),null===c.getChild("set_"+d)&&(h["set_"+d]=e),null===c.getChild("get"+b)&&(h["get"+b]=f),null===c.getChild("get_"+d)&&(h["get_"+d]=f)}(j)}h.encode=function(a,d){"boolean"==typeof a&&(d=a,a=void 0);var e=!1;a||(a=new b,e=!0);var f=a.littleEndian;try{return c.encode(this,a.LE(),d),(e?a.flip():a).LE(f)}catch(b){throw a.LE(f),b}},g.encode=function(a,b,c){return new g(a).encode(b,c)},h.calculate=function(){return c.calculate(this)},h.encodeDelimited=function(a,d){var e=!1;a||(a=new b,e=!0);var f=(new b).LE();return c.encode(this,f,d).flip(),a.writeVarint32(f.remaining()),a.append(f),e?a.flip():a},h.encodeAB=function(){try{return this.encode().toArrayBuffer()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toArrayBuffer()),a}},h.toArrayBuffer=h.encodeAB,h.encodeNB=function(){try{return this.encode().toBuffer()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toBuffer()),a}},h.toBuffer=h.encodeNB,h.encode64=function(){try{return this.encode().toBase64()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toBase64()),a}},h.toBase64=h.encode64,h.encodeHex=function(){try{return this.encode().toHex()}catch(a){throw a.encoded&&(a.encoded=a.encoded.toHex()),a}},h.toHex=h.encodeHex,h.toRaw=function(a,b){return d(this,!!a,!!b,this.$type)},h.encodeJSON=function(){return JSON.stringify(d(this,!0,!0,this.$type))},g.decode=function(a,d,e){"string"==typeof d&&(e=d,d=-1),"string"==typeof a?a=b.wrap(a,e||"base64"):b.isByteBuffer(a)||(a=b.wrap(a));var f=a.littleEndian;try{var g=c.decode(a.LE(),d);return a.LE(f),g}catch(b){throw a.LE(f),b}},g.decodeDelimited=function(a,d){if("string"==typeof a?a=b.wrap(a,d||"base64"):b.isByteBuffer(a)||(a=b.wrap(a)),a.remaining()<1)return null;var e=a.offset,f=a.readVarint32();if(a.remaining()<f)return a.offset=e,null;try{var g=c.decode(a.slice(a.offset,a.offset+f).LE());return a.offset+=f,g}catch(b){throw a.offset+=f,b}},g.decode64=function(a){return g.decode(a,"base64")},g.decodeHex=function(a){return g.decode(a,"hex")},g.decodeJSON=function(a){return new g(JSON.parse(a))},h.toString=function(){return c.toString()};return Object.defineProperty&&(Object.defineProperty(g,"$options",{value:c.buildOpt()}),Object.defineProperty(h,"$options",{value:g.$options}),Object.defineProperty(g,"$type",{value:c}),Object.defineProperty(h,"$type",{value:c})),g}(a,this);this._fields=[],this._fieldsById={},this._fieldsByName={},this._oneofsByName={};for(var e,f=0,g=this.children.length;f<g;f++)if((e=this.children[f])instanceof s||e instanceof m||e instanceof v){if(d.hasOwnProperty(e.name))throw Error("Illegal reflect child of "+this.toString(!0)+": "+e.toString(!0)+" cannot override static property '"+e.name+"'");d[e.name]=e.build()}else if(e instanceof m.Field)e.build(),this._fields.push(e),this._fieldsById[e.id]=e,this._fieldsByName[e.name]=e;else if(e instanceof m.OneOf)this._oneofsByName[e.name]=e;else if(!(e instanceof m.OneOf||e instanceof u))throw Error("Illegal reflect child of "+this.toString(!0)+": "+this.children[f].toString(!0));return this.clazz=d},n.encode=function(a,b,c){for(var d,e,f=null,g=0,h=this._fields.length;g<h;++g)d=this._fields[g],e=a[d.name],d.required&&null===e?null===f&&(f=d):d.encode(c?e:d.verifyValue(e),b,a);if(null!==f){var i=Error("Missing at least one required field for "+this.toString(!0)+": "+f);throw i.encoded=b,i}return b},n.calculate=function(a){for(var b,c,d=0,e=0,f=this._fields.length;e<f;++e){if(b=this._fields[e],c=a[b.name],b.required&&null===c)throw Error("Missing at least one required field for "+this.toString(!0)+": "+b);d+=b.calculate(c,a)}return d},n.decode=function(b,c,d){"number"!=typeof c&&(c=-1);for(var f,g,h,i,j=b.offset,k=new this.clazz;b.offset<j+c||-1===c&&b.remaining()>0;){if(f=b.readVarint32(),g=7&f,h=f>>>3,g===a.WIRE_TYPES.ENDGROUP){if(h!==d)throw Error("Illegal group end indicator for "+this.toString(!0)+": "+h+" ("+(d?d+" expected":"not a group")+")");break}if(i=this._fieldsById[h]){if(i.repeated&&!i.options.packed)k[i.name].push(i.decode(g,b));else if(i.map){var l=i.decode(g,b);k[i.name].set(l[0],l[1])}else if(k[i.name]=i.decode(g,b),i.oneof){var m=k[i.oneof.name];null!==m&&m!==i.name&&(k[m]=null),k[i.oneof.name]=i.name}}else switch(g){case a.WIRE_TYPES.VARINT:b.readVarint32();break;case a.WIRE_TYPES.BITS32:b.offset+=4;break;case a.WIRE_TYPES.BITS64:b.offset+=8;break;case a.WIRE_TYPES.LDELIM:var n=b.readVarint32();b.offset+=n;break;case a.WIRE_TYPES.STARTGROUP:for(;e(h,b););break;default:throw Error("Illegal wire type for unknown field "+h+" in "+this.toString(!0)+"#decode: "+g)}}for(var o=0,p=this._fields.length;o<p;++o)if(i=this._fields[o],null===k[i.name])if("proto3"===this.syntax)k[i.name]=i.defaultValue;else{if(i.required){var q=Error("Missing at least one required field for "+this.toString(!0)+": "+i.name);throw q.decoded=k,q}a.populateDefaults&&null!==i.defaultValue&&(k[i.name]=i.defaultValue)}return k},f.Message=m;var o=function(b,c,d,e,f,h,i,j,k,l){g.call(this,b,c,h),this.className="Message.Field",this.required="required"===d,this.repeated="repeated"===d,this.map="map"===d,this.keyType=e||null,this.type=f,this.resolvedType=null,this.id=i,this.options=j||{},this.defaultValue=null,this.oneof=k||null,this.syntax=l||"proto2",this.originalName=this.name,this.element=null,this.keyElement=null,!this.builder.options.convertFieldsToCamelCase||this instanceof m.ExtensionField||(this.name=a.Util.toCamelCase(this.name))},p=o.prototype=Object.create(g.prototype);p.build=function(){this.element=new k(this.type,this.resolvedType,!1,this.syntax,this.name),this.map&&(this.keyElement=new k(this.keyType,void 0,!0,this.syntax,this.name)),"proto3"!==this.syntax||this.repeated||this.map?void 0!==this.options.default&&(this.defaultValue=this.verifyValue(this.options.default)):this.defaultValue=k.defaultFieldValue(this.type)},p.verifyValue=function(b,c){function d(a,b){throw Error("Illegal value for "+e.toString(!0)+" of type "+e.type.name+": "+a+" ("+b+")")}c=c||!1;var e=this;if(null===b)return this.required&&d(typeof b,"required"),"proto3"===this.syntax&&this.type!==a.TYPES.message&&d(typeof b,"proto3 field without field presence cannot be null"),null;var f;if(this.repeated&&!c){Array.isArray(b)||(b=[b]);var g=[];for(f=0;f<b.length;f++)g.push(this.element.verifyValue(b[f]));return g}return this.map&&!c?b instanceof a.Map?b:(b instanceof Object||d(typeof b,"expected ProtoBuf.Map or raw object for map field"),new a.Map(this,b)):(!this.repeated&&Array.isArray(b)&&d(typeof b,"no array expected"),this.element.verifyValue(b))},p.hasWirePresence=function(b,c){if("proto3"!==this.syntax)return null!==b;if(this.oneof&&c[this.oneof.name]===this.name)return!0;switch(this.type){case a.TYPES.int32:case a.TYPES.sint32:case a.TYPES.sfixed32:case a.TYPES.uint32:case a.TYPES.fixed32:return 0!==b;case a.TYPES.int64:case a.TYPES.sint64:case a.TYPES.sfixed64:case a.TYPES.uint64:case a.TYPES.fixed64:return 0!==b.low||0!==b.high;case a.TYPES.bool:return b;case a.TYPES.float:case a.TYPES.double:return 0!==b;case a.TYPES.string:return b.length>0;case a.TYPES.bytes:return b.remaining()>0;case a.TYPES.enum:return 0!==b;case a.TYPES.message:return null!==b;default:return!0}},p.encode=function(c,d,e){if(null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===c||this.repeated&&0==c.length)return d;try{if(this.repeated){var f;if(this.options.packed&&a.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){d.writeVarint32(this.id<<3|a.WIRE_TYPES.LDELIM),d.ensureCapacity(d.offset+=1);var g=d.offset;for(f=0;f<c.length;f++)this.element.encodeValue(this.id,c[f],d);var h=d.offset-g,i=b.calculateVarint32(h);if(i>1){var j=d.slice(g,d.offset);g+=i-1,d.offset=g,d.append(j)}d.writeVarint32(h,g-i)}else for(f=0;f<c.length;f++)d.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,c[f],d)}else this.map?c.forEach(function(c,e,f){var g=b.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,e)+b.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,c);d.writeVarint32(this.id<<3|a.WIRE_TYPES.LDELIM),d.writeVarint32(g),d.writeVarint32(8|this.keyType.wireType),this.keyElement.encodeValue(1,e,d),d.writeVarint32(16|this.type.wireType),this.element.encodeValue(2,c,d)},this):this.hasWirePresence(c,e)&&(d.writeVarint32(this.id<<3|this.type.wireType),this.element.encodeValue(this.id,c,d))}catch(a){throw Error("Illegal value for "+this.toString(!0)+": "+c+" ("+a+")")}return d},p.calculate=function(c,d){if(c=this.verifyValue(c),null===this.type||"object"!=typeof this.type)throw Error("[INTERNAL] Unresolved type in "+this.toString(!0)+": "+this.type);if(null===c||this.repeated&&0==c.length)return 0;var e=0;try{if(this.repeated){var f,g;if(this.options.packed&&a.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0){for(e+=b.calculateVarint32(this.id<<3|a.WIRE_TYPES.LDELIM),g=0,f=0;f<c.length;f++)g+=this.element.calculateLength(this.id,c[f]);e+=b.calculateVarint32(g),e+=g}else for(f=0;f<c.length;f++)e+=b.calculateVarint32(this.id<<3|this.type.wireType),e+=this.element.calculateLength(this.id,c[f])}else this.map?c.forEach(function(c,d,f){var g=b.calculateVarint32(8|this.keyType.wireType)+this.keyElement.calculateLength(1,d)+b.calculateVarint32(16|this.type.wireType)+this.element.calculateLength(2,c);e+=b.calculateVarint32(this.id<<3|a.WIRE_TYPES.LDELIM),e+=b.calculateVarint32(g),e+=g},this):this.hasWirePresence(c,d)&&(e+=b.calculateVarint32(this.id<<3|this.type.wireType),e+=this.element.calculateLength(this.id,c))}catch(a){throw Error("Illegal value for "+this.toString(!0)+": "+c+" ("+a+")")}return e},p.decode=function(b,c,d){var e,f;if(!(!this.map&&b==this.type.wireType||!d&&this.repeated&&this.options.packed&&b==a.WIRE_TYPES.LDELIM||this.map&&b==a.WIRE_TYPES.LDELIM))throw Error("Illegal wire type for field "+this.toString(!0)+": "+b+" ("+this.type.wireType+" expected)");if(b==a.WIRE_TYPES.LDELIM&&this.repeated&&this.options.packed&&a.PACKABLE_WIRE_TYPES.indexOf(this.type.wireType)>=0&&!d){f=c.readVarint32(),f=c.offset+f;for(var g=[];c.offset<f;)g.push(this.decode(this.type.wireType,c,!0));return g}if(this.map){var h=k.defaultFieldValue(this.keyType);if(e=k.defaultFieldValue(this.type),f=c.readVarint32(),c.remaining()<f)throw Error("Illegal number of bytes for "+this.toString(!0)+": "+f+" required but got only "+c.remaining());var i=c.clone();for(i.limit=i.offset+f,c.offset+=f;i.remaining()>0;){var j=i.readVarint32();b=7&j;var l=j>>>3;if(1===l)h=this.keyElement.decode(i,b,l);else{if(2!==l)throw Error("Unexpected tag in map field key/value submessage");e=this.element.decode(i,b,l)}}return[h,e]}return this.element.decode(c,b,this.id)},f.Message.Field=o;var q=function(a,b,c,d,e,f,g){o.call(this,a,b,c,null,d,e,f,g),this.extension};q.prototype=Object.create(o.prototype),f.Message.ExtensionField=q;var r=function(a,b,c){g.call(this,a,b,c),this.fields=[]};f.Message.OneOf=r;var s=function(a,b,c,d,e){i.call(this,a,b,c,d,e),this.className="Enum",this.object=null};s.getName=function(a,b){for(var c,d=Object.keys(a),e=0;e<d.length;++e)if(a[c=d[e]]===b)return c;return null},(s.prototype=Object.create(i.prototype)).build=function(b){if(this.object&&!b)return this.object;for(var c=new a.Builder.Enum,d=this.getChildren(s.Value),e=0,f=d.length;e<f;++e)c[d[e].name]=d[e].id;return Object.defineProperty&&Object.defineProperty(c,"$options",{value:this.buildOpt(),enumerable:!1}),this.object=c},f.Enum=s;var t=function(a,b,c,d){g.call(this,a,b,c),this.className="Enum.Value",this.id=d};t.prototype=Object.create(g.prototype),f.Enum.Value=t;var u=function(a,b,c,d){g.call(this,a,b,c),this.field=d};u.prototype=Object.create(g.prototype),f.Extension=u;var v=function(a,b,c,d){i.call(this,a,b,c,d),this.className="Service",this.clazz=null};(v.prototype=Object.create(i.prototype)).build=function(c){return this.clazz&&!c?this.clazz:this.clazz=function(a,c){for(var d=function(b){a.Builder.Service.call(this),this.rpcImpl=b||function(a,b,c){setTimeout(c.bind(this,Error("Not implemented, see: https://github.com/dcodeIO/ProtoBuf.js/wiki/Services")),0)}},e=d.prototype=Object.create(a.Builder.Service.prototype),f=c.getChildren(a.Reflect.Service.RPCMethod),g=0;g<f.length;g++)!function(a){e[a.name]=function(d,e){try{try{d=a.resolvedRequestType.clazz.decode(b.wrap(d))}catch(a){if(!(a instanceof TypeError))throw a}if(null===d||"object"!=typeof d)throw Error("Illegal arguments");d instanceof a.resolvedRequestType.clazz||(d=new a.resolvedRequestType.clazz(d)),this.rpcImpl(a.fqn(),d,function(b,d){if(b)return void e(b);null===d&&(d="");try{d=a.resolvedResponseType.clazz.decode(d)}catch(a){}if(!(d&&d instanceof a.resolvedResponseType.clazz))return void e(Error("Illegal response type received in service method "+c.name+"#"+a.name));e(null,d)})}catch(a){setTimeout(e.bind(this,a),0)}},d[a.name]=function(b,c,e){new d(b)[a.name](c,e)},Object.defineProperty&&(Object.defineProperty(d[a.name],"$options",{value:a.buildOpt()}),Object.defineProperty(e[a.name],"$options",{value:d[a.name].$options}))}(f[g]);return Object.defineProperty&&(Object.defineProperty(d,"$options",{value:c.buildOpt()}),Object.defineProperty(e,"$options",{value:d.$options}),Object.defineProperty(d,"$type",{value:c}),Object.defineProperty(e,"$type",{value:c})),d}(a,this)},f.Service=v;var w=function(a,b,c,d){g.call(this,a,b,c),this.className="Service.Method",this.options=d||{}};(w.prototype=Object.create(g.prototype)).buildOpt=j.buildOpt,f.Service.Method=w;var x=function(a,b,c,d,e,f,g,h){w.call(this,a,b,c,h),this.className="Service.RPCMethod",this.requestName=d,this.responseName=e,this.requestStream=f,this.responseStream=g,this.resolvedRequestType=null,this.resolvedResponseType=null};return x.prototype=Object.create(w.prototype),f.Service.RPCMethod=x,f}(e),e.Builder=function(b,c,d){function e(a){a.messages&&a.messages.forEach(function(b){b.syntax=a.syntax,e(b)}),a.enums&&a.enums.forEach(function(b){b.syntax=a.syntax})}var f=function(a){this.ns=new d.Namespace(this,null,""),this.ptr=this.ns,this.resolved=!1,this.result=null,this.files={},this.importRoot=null,this.options=a||{}},g=f.prototype;return f.isMessage=function(a){return"string"==typeof a.name&&(void 0===a.values&&void 0===a.rpc)},f.isMessageField=function(a){return"string"==typeof a.rule&&"string"==typeof a.name&&"string"==typeof a.type&&void 0!==a.id},f.isEnum=function(a){return"string"==typeof a.name&&!(void 0===a.values||!Array.isArray(a.values)||0===a.values.length)},f.isService=function(a){return!("string"!=typeof a.name||"object"!=typeof a.rpc||!a.rpc)},f.isExtend=function(a){return"string"==typeof a.ref},g.reset=function(){return this.ptr=this.ns,this},g.define=function(a){if("string"!=typeof a||!c.TYPEREF.test(a))throw Error("illegal namespace: "+a);return a.split(".").forEach(function(a){var b=this.ptr.getChild(a);null===b&&this.ptr.addChild(b=new d.Namespace(this,this.ptr,a)),this.ptr=b},this),this},g.create=function(a){if(!a)return this;if(Array.isArray(a)){if(0===a.length)return this;a=a.slice()}else a=[a];for(var c=[a];c.length>0;){if(a=c.pop(),!Array.isArray(a))throw Error("not a valid namespace: "+JSON.stringify(a));for(;a.length>0;){var e=a.shift();if(f.isMessage(e)){var g=new d.Message(this,this.ptr,e.name,e.options,e.isGroup,e.syntax),h={};e.oneofs&&Object.keys(e.oneofs).forEach(function(a){g.addChild(h[a]=new d.Message.OneOf(this,g,a))},this),e.fields&&e.fields.forEach(function(a){if(null!==g.getChild(0|a.id))throw Error("duplicate or invalid field id in "+g.name+": "+a.id);if(a.options&&"object"!=typeof a.options)throw Error("illegal field options in "+g.name+"#"+a.name);var b=null;if("string"==typeof a.oneof&&!(b=h[a.oneof]))throw Error("illegal oneof in "+g.name+"#"+a.name+": "+a.oneof);a=new d.Message.Field(this,g,a.rule,a.keytype,a.type,a.name,a.id,a.options,b,e.syntax),b&&b.fields.push(a),g.addChild(a)},this);var i=[];if(e.enums&&e.enums.forEach(function(a){i.push(a)}),e.messages&&e.messages.forEach(function(a){i.push(a)}),e.services&&e.services.forEach(function(a){i.push(a)}),e.extensions&&("number"==typeof e.extensions[0]?g.extensions=[e.extensions]:g.extensions=e.extensions),this.ptr.addChild(g),i.length>0){c.push(a),a=i,i=null,this.ptr=g,g=null;continue}i=null}else if(f.isEnum(e))g=new d.Enum(this,this.ptr,e.name,e.options,e.syntax),e.values.forEach(function(a){g.addChild(new d.Enum.Value(this,g,a.name,a.id))},this),this.ptr.addChild(g);else if(f.isService(e))g=new d.Service(this,this.ptr,e.name,e.options),Object.keys(e.rpc).forEach(function(a){var b=e.rpc[a];g.addChild(new d.Service.RPCMethod(this,g,a,b.request,b.response,!!b.request_stream,!!b.response_stream,b.options))},this),this.ptr.addChild(g);else{if(!f.isExtend(e))throw Error("not a valid definition: "+JSON.stringify(e));if(g=this.ptr.resolve(e.ref,!0))e.fields.forEach(function(a){if(null!==g.getChild(0|a.id))throw Error("duplicate extended field id in "+g.name+": "+a.id);if(g.extensions){var c=!1;if(g.extensions.forEach(function(b){a.id>=b[0]&&a.id<=b[1]&&(c=!0)}),!c)throw Error("illegal extended field id in "+g.name+": "+a.id+" (not within valid ranges)")}var e=a.name;this.options.convertFieldsToCamelCase&&(e=b.Util.toCamelCase(e));var f=new d.Message.ExtensionField(this,g,a.rule,a.type,this.ptr.fqn()+"."+e,a.id,a.options),h=new d.Extension(this,this.ptr,a.name,f);f.extension=h,this.ptr.addChild(h),g.addChild(f)},this);else if(!/\.?google\.protobuf\./.test(e.ref))throw Error("extended message "+e.ref+" is not defined")}e=null,g=null}a=null,this.ptr=this.ptr.parent}return this.resolved=!1,this.result=null,this},g.import=function(c,d){var f="/";if("string"==typeof d){if(b.Util.IS_NODE&&(d=a("path").resolve(d)),!0===this.files[d])return this.reset();this.files[d]=!0}else if("object"==typeof d){var g=d.root;b.Util.IS_NODE&&(g=a("path").resolve(g)),(g.indexOf("\\")>=0||d.file.indexOf("\\")>=0)&&(f="\\");var h;if(h=b.Util.IS_NODE?a("path").join(g,d.file):g+f+d.file,!0===this.files[h])return this.reset();this.files[h]=!0}if(c.imports&&c.imports.length>0){var i,j=!1;"object"==typeof d?(this.importRoot=d.root,j=!0,i=this.importRoot,d=d.file,(i.indexOf("\\")>=0||d.indexOf("\\")>=0)&&(f="\\")):"string"==typeof d?this.importRoot?i=this.importRoot:d.indexOf("/")>=0?""===(i=d.replace(/\/[^\/]*$/,""))&&(i="/"):d.indexOf("\\")>=0?(i=d.replace(/\\[^\\]*$/,""),f="\\"):i=".":i=null;for(var k=0;k<c.imports.length;k++)if("string"==typeof c.imports[k]){if(!i)throw Error("cannot determine import root");var l=c.imports[k];if("google/protobuf/descriptor.proto"===l)continue;if(l=b.Util.IS_NODE?a("path").join(i,l):i+f+l,!0===this.files[l])continue;/\.proto$/i.test(l)&&!b.DotProto&&(l=l.replace(/\.proto$/,".json"));var m=b.Util.fetch(l);if(null===m)throw Error("failed to import '"+l+"' in '"+d+"': file not found");/\.json$/i.test(l)?this.import(JSON.parse(m+""),l):this.import(b.DotProto.Parser.parse(m),l)}else d?/\.(\w+)$/.test(d)?this.import(c.imports[k],d.replace(/^(.+)\.(\w+)$/,function(a,b,c){return b+"_import"+k+"."+c})):this.import(c.imports[k],d+"_import"+k):this.import(c.imports[k]);j&&(this.importRoot=null)}c.package&&this.define(c.package),c.syntax&&e(c);var n=this.ptr;return c.options&&Object.keys(c.options).forEach(function(a){n.options[a]=c.options[a]}),c.messages&&(this.create(c.messages),this.ptr=n),c.enums&&(this.create(c.enums),this.ptr=n),c.services&&(this.create(c.services),this.ptr=n),c.extends&&this.create(c.extends),this.reset()},g.resolveAll=function(){var a;if(null==this.ptr||"object"==typeof this.ptr.type)return this;if(this.ptr instanceof d.Namespace)this.ptr.children.forEach(function(a){this.ptr=a,this.resolveAll()},this);else if(this.ptr instanceof d.Message.Field){if(c.TYPE.test(this.ptr.type))this.ptr.type=b.TYPES[this.ptr.type];else{if(!c.TYPEREF.test(this.ptr.type))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(!(a=(this.ptr instanceof d.Message.ExtensionField?this.ptr.extension.parent:this.ptr.parent).resolve(this.ptr.type,!0)))throw Error("unresolvable type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);if(this.ptr.resolvedType=a,a instanceof d.Enum){if(this.ptr.type=b.TYPES.enum,"proto3"===this.ptr.syntax&&"proto3"!==a.syntax)throw Error("proto3 message cannot reference proto2 enum")}else{if(!(a instanceof d.Message))throw Error("illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.type);this.ptr.type=a.isGroup?b.TYPES.group:b.TYPES.message}}if(this.ptr.map){if(!c.TYPE.test(this.ptr.keyType))throw Error("illegal key type for map field in "+this.ptr.toString(!0)+": "+this.ptr.keyType);this.ptr.keyType=b.TYPES[this.ptr.keyType]}"proto3"===this.ptr.syntax&&this.ptr.repeated&&void 0===this.ptr.options.packed&&-1!==b.PACKABLE_WIRE_TYPES.indexOf(this.ptr.type.wireType)&&(this.ptr.options.packed=!0)}else if(this.ptr instanceof b.Reflect.Service.Method){if(!(this.ptr instanceof b.Reflect.Service.RPCMethod))throw Error("illegal service type in "+this.ptr.toString(!0));if(!((a=this.ptr.parent.resolve(this.ptr.requestName,!0))&&a instanceof b.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.requestName);if(this.ptr.resolvedRequestType=a,!((a=this.ptr.parent.resolve(this.ptr.responseName,!0))&&a instanceof b.Reflect.Message))throw Error("Illegal type reference in "+this.ptr.toString(!0)+": "+this.ptr.responseName);this.ptr.resolvedResponseType=a}else if(!(this.ptr instanceof b.Reflect.Message.OneOf||this.ptr instanceof b.Reflect.Extension||this.ptr instanceof b.Reflect.Enum.Value))throw Error("illegal object in namespace: "+typeof this.ptr+": "+this.ptr);return this.reset()},g.build=function(a){if(this.reset(),this.resolved||(this.resolveAll(),this.resolved=!0,this.result=null),null===this.result&&(this.result=this.ns.build()),!a)return this.result;for(var b="string"==typeof a?a.split("."):a,c=this.result,d=0;d<b.length;d++){if(!c[b[d]]){c=null;break}c=c[b[d]]}return c},g.lookup=function(a,b){return a?this.ns.resolve(a,b):this.ns},g.toString=function(){return"Builder"},f.Message=function(){},f.Enum=function(){},f.Service=function(){},f}(e,e.Lang,e.Reflect),e.Map=function(a,b){function c(a){var b=0;return{next:function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}}var d=function(a,c){if(!a.map)throw Error("field is not a map");if(this.field=a,this.keyElem=new b.Element(a.keyType,null,!0,a.syntax),this.valueElem=new b.Element(a.type,a.resolvedType,!1,a.syntax),this.map={},Object.defineProperty(this,"size",{get:function(){return Object.keys(this.map).length}}),c)for(var d=Object.keys(c),e=0;e<d.length;e++){var f=this.keyElem.valueFromString(d[e]),g=this.valueElem.verifyValue(c[d[e]]);this.map[this.keyElem.valueToString(f)]={key:f,value:g}}},e=d.prototype;return e.clear=function(){this.map={}},e.delete=function(a){var b=this.keyElem.valueToString(this.keyElem.verifyValue(a)),c=b in this.map;return delete this.map[b],c},e.entries=function(){for(var a,b=[],d=Object.keys(this.map),e=0;e<d.length;e++)b.push([(a=this.map[d[e]]).key,a.value]);return c(b)},e.keys=function(){for(var a=[],b=Object.keys(this.map),d=0;d<b.length;d++)a.push(this.map[b[d]].key);return c(a)},e.values=function(){for(var a=[],b=Object.keys(this.map),d=0;d<b.length;d++)a.push(this.map[b[d]].value);return c(a)},e.forEach=function(a,b){for(var c,d=Object.keys(this.map),e=0;e<d.length;e++)a.call(b,(c=this.map[d[e]]).value,c.key,this)},e.set=function(a,b){var c=this.keyElem.verifyValue(a),d=this.valueElem.verifyValue(b);return this.map[this.keyElem.valueToString(c)]={key:c,value:d},this},e.get=function(a){var b=this.keyElem.valueToString(this.keyElem.verifyValue(a));if(b in this.map)return this.map[b].value},e.has=function(a){return this.keyElem.valueToString(this.keyElem.verifyValue(a))in this.map},d}(0,e.Reflect),e.loadProto=function(a,b,c){return("string"==typeof b||b&&"string"==typeof b.file&&"string"==typeof b.root)&&(c=b,b=void 0),e.loadJson(e.DotProto.Parser.parse(a),b,c)},e.protoFromString=e.loadProto,e.loadProtoFile=function(a,b,c){if(b&&"object"==typeof b?(c=b,b=null):b&&"function"==typeof b||(b=null),b)return e.Util.fetch("string"==typeof a?a:a.root+"/"+a.file,function(d){if(null===d)return void b(Error("Failed to fetch file"));try{b(null,e.loadProto(d,c,a))}catch(a){b(a)}});var d=e.Util.fetch("object"==typeof a?a.root+"/"+a.file:a);return null===d?null:e.loadProto(d,c,a)},e.protoFromFile=e.loadProtoFile,e.newBuilder=function(a){return a=a||{},void 0===a.convertFieldsToCamelCase&&(a.convertFieldsToCamelCase=e.convertFieldsToCamelCase),void 0===a.populateAccessors&&(a.populateAccessors=e.populateAccessors),new e.Builder(a)},e.loadJson=function(a,b,c){return("string"==typeof b||b&&"string"==typeof b.file&&"string"==typeof b.root)&&(c=b,b=null),b&&"object"==typeof b||(b=e.newBuilder()),"string"==typeof a&&(a=JSON.parse(a)),b.import(a,c),b.resolveAll(),b},e.loadJsonFile=function(a,b,c){if(b&&"object"==typeof b?(c=b,b=null):b&&"function"==typeof b||(b=null),b)return e.Util.fetch("string"==typeof a?a:a.root+"/"+a.file,function(d){if(null===d)return void b(Error("Failed to fetch file"));try{b(null,e.loadJson(JSON.parse(d),c,a))}catch(a){b(a)}});var d=e.Util.fetch("object"==typeof a?a.root+"/"+a.file:a);return null===d?null:e.loadJson(JSON.parse(d),c,a)},e})}).call(this,a("_process"))},{_process:175,bytebuffer:168,fs:166,path:166}],177:[function(a,b,c){var d={REVISION:"75"};"function"==typeof define&&define.amd?define("three",d):void 0!==c&&void 0!==b&&(b.exports=d),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(a){return a<0?-1:a>0?1:+a}),void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]}}),void 0===Object.assign&&Object.defineProperty(Object,"assign",{writable:!0,configurable:!0,value:function(a){"use strict";if(void 0===a||null===a)throw new TypeError("Cannot convert first argument to object");for(var b=Object(a),c=1,d=arguments.length;c!==d;++c){var e=arguments[c];if(void 0!==e&&null!==e){e=Object(e);for(var f=Object.keys(e),g=0,h=f.length;g!==h;++g){var i=f[g],j=Object.getOwnPropertyDescriptor(e,i);void 0!==j&&j.enumerable&&(b[i]=e[i])}}}return b}}),d.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2},d.CullFaceNone=0,d.CullFaceBack=1,d.CullFaceFront=2,d.CullFaceFrontBack=3,d.FrontFaceDirectionCW=0,d.FrontFaceDirectionCCW=1,d.BasicShadowMap=0,d.PCFShadowMap=1,d.PCFSoftShadowMap=2,d.FrontSide=0,d.BackSide=1,d.DoubleSide=2,d.FlatShading=1,d.SmoothShading=2,d.NoColors=0,d.FaceColors=1,d.VertexColors=2,d.NoBlending=0,d.NormalBlending=1,d.AdditiveBlending=2,d.SubtractiveBlending=3,d.MultiplyBlending=4,d.CustomBlending=5,d.AddEquation=100,d.SubtractEquation=101,d.ReverseSubtractEquation=102,d.MinEquation=103,d.MaxEquation=104,d.ZeroFactor=200,d.OneFactor=201,d.SrcColorFactor=202,d.OneMinusSrcColorFactor=203,d.SrcAlphaFactor=204,d.OneMinusSrcAlphaFactor=205,d.DstAlphaFactor=206,d.OneMinusDstAlphaFactor=207,d.DstColorFactor=208,d.OneMinusDstColorFactor=209,d.SrcAlphaSaturateFactor=210,d.NeverDepth=0,d.AlwaysDepth=1,d.LessDepth=2,d.LessEqualDepth=3,d.EqualDepth=4,d.GreaterEqualDepth=5,d.GreaterDepth=6,d.NotEqualDepth=7,d.MultiplyOperation=0,d.MixOperation=1,d.AddOperation=2,d.NoToneMapping=0,d.LinearToneMapping=1,d.ReinhardToneMapping=2,d.Uncharted2ToneMapping=3,d.CineonToneMapping=4,d.UVMapping=300,d.CubeReflectionMapping=301,d.CubeRefractionMapping=302,d.EquirectangularReflectionMapping=303,d.EquirectangularRefractionMapping=304,d.SphericalReflectionMapping=305,d.CubeUVReflectionMapping=306,d.CubeUVRefractionMapping=307,d.RepeatWrapping=1e3,d.ClampToEdgeWrapping=1001,d.MirroredRepeatWrapping=1002,d.NearestFilter=1003,d.NearestMipMapNearestFilter=1004,d.NearestMipMapLinearFilter=1005,d.LinearFilter=1006,
d.LinearMipMapNearestFilter=1007,d.LinearMipMapLinearFilter=1008,d.UnsignedByteType=1009,d.ByteType=1010,d.ShortType=1011,d.UnsignedShortType=1012,d.IntType=1013,d.UnsignedIntType=1014,d.FloatType=1015,d.HalfFloatType=1025,d.UnsignedShort4444Type=1016,d.UnsignedShort5551Type=1017,d.UnsignedShort565Type=1018,d.AlphaFormat=1019,d.RGBFormat=1020,d.RGBAFormat=1021,d.LuminanceFormat=1022,d.LuminanceAlphaFormat=1023,d.RGBEFormat=d.RGBAFormat,d.RGB_S3TC_DXT1_Format=2001,d.RGBA_S3TC_DXT1_Format=2002,d.RGBA_S3TC_DXT3_Format=2003,d.RGBA_S3TC_DXT5_Format=2004,d.RGB_PVRTC_4BPPV1_Format=2100,d.RGB_PVRTC_2BPPV1_Format=2101,d.RGBA_PVRTC_4BPPV1_Format=2102,d.RGBA_PVRTC_2BPPV1_Format=2103,d.RGB_ETC1_Format=2151,d.LoopOnce=2200,d.LoopRepeat=2201,d.LoopPingPong=2202,d.InterpolateDiscrete=2300,d.InterpolateLinear=2301,d.InterpolateSmooth=2302,d.ZeroCurvatureEnding=2400,d.ZeroSlopeEnding=2401,d.WrapAroundEnding=2402,d.TrianglesDrawMode=0,d.TriangleStripDrawMode=1,d.TriangleFanDrawMode=2,d.LinearEncoding=3e3,d.sRGBEncoding=3001,d.GammaEncoding=3007,d.RGBEEncoding=3002,d.LogLuvEncoding=3003,d.RGBM7Encoding=3004,d.RGBM16Encoding=3005,d.RGBDEncoding=3006,d.Color=function(a){return 3===arguments.length?this.fromArray(arguments):this.set(a)},d.Color.prototype={constructor:d.Color,r:1,g:1,b:1,set:function(a){return a instanceof d.Color?this.copy(a):"number"==typeof a?this.setHex(a):"string"==typeof a&&this.setStyle(a),this},setScalar:function(a){this.r=a,this.g=a,this.b=a},setHex:function(a){return a=Math.floor(a),this.r=(a>>16&255)/255,this.g=(a>>8&255)/255,this.b=(255&a)/255,this},setRGB:function(a,b,c){return this.r=a,this.g=b,this.b=c,this},setHSL:function(){function a(a,b,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?a+6*(b-a)*c:c<.5?b:c<2/3?a+6*(b-a)*(2/3-c):a}return function(b,c,e){if(b=d.Math.euclideanModulo(b,1),c=d.Math.clamp(c,0,1),e=d.Math.clamp(e,0,1),0===c)this.r=this.g=this.b=e;else{var f=e<=.5?e*(1+c):e+c-e*c,g=2*e-f;this.r=a(g,f,b+1/3),this.g=a(g,f,b),this.b=a(g,f,b-1/3)}return this}}(),setStyle:function(a){function b(b){void 0!==b&&parseFloat(b)<1&&console.warn("THREE.Color: Alpha component of "+a+" will be ignored.")}var c;if(c=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(a)){var e,f=c[1],g=c[2];switch(f){case"rgb":case"rgba":if(e=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(g))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,b(e[5]),this;if(e=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(g))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,b(e[5]),this;break;case"hsl":case"hsla":if(e=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(g)){var h=parseFloat(e[1])/360,i=parseInt(e[2],10)/100,j=parseInt(e[3],10)/100;return b(e[5]),this.setHSL(h,i,j)}}}else if(c=/^\#([A-Fa-f0-9]+)$/.exec(a)){var k=c[1],l=k.length;if(3===l)return this.r=parseInt(k.charAt(0)+k.charAt(0),16)/255,this.g=parseInt(k.charAt(1)+k.charAt(1),16)/255,this.b=parseInt(k.charAt(2)+k.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(k.charAt(0)+k.charAt(1),16)/255,this.g=parseInt(k.charAt(2)+k.charAt(3),16)/255,this.b=parseInt(k.charAt(4)+k.charAt(5),16)/255,this}if(a&&a.length>0){var k=d.ColorKeywords[a];void 0!==k?this.setHex(k):console.warn("THREE.Color: Unknown color "+a)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(a){return this.r=a.r,this.g=a.g,this.b=a.b,this},copyGammaToLinear:function(a,b){return void 0===b&&(b=2),this.r=Math.pow(a.r,b),this.g=Math.pow(a.g,b),this.b=Math.pow(a.b,b),this},copyLinearToGamma:function(a,b){void 0===b&&(b=2);var c=b>0?1/b:1;return this.r=Math.pow(a.r,c),this.g=Math.pow(a.g,c),this.b=Math.pow(a.b,c),this},convertGammaToLinear:function(){var a=this.r,b=this.g,c=this.b;return this.r=a*a,this.g=b*b,this.b=c*c,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(a){var b,c,d=a||{h:0,s:0,l:0},e=this.r,f=this.g,g=this.b,h=Math.max(e,f,g),i=Math.min(e,f,g),j=(i+h)/2;if(i===h)b=0,c=0;else{var k=h-i;switch(c=j<=.5?k/(h+i):k/(2-h-i),h){case e:b=(f-g)/k+(f<g?6:0);break;case f:b=(g-e)/k+2;break;case g:b=(e-f)/k+4}b/=6}return d.h=b,d.s=c,d.l=j,d},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(a,b,c){var d=this.getHSL();return d.h+=a,d.s+=b,d.l+=c,this.setHSL(d.h,d.s,d.l),this},add:function(a){return this.r+=a.r,this.g+=a.g,this.b+=a.b,this},addColors:function(a,b){return this.r=a.r+b.r,this.g=a.g+b.g,this.b=a.b+b.b,this},addScalar:function(a){return this.r+=a,this.g+=a,this.b+=a,this},multiply:function(a){return this.r*=a.r,this.g*=a.g,this.b*=a.b,this},multiplyScalar:function(a){return this.r*=a,this.g*=a,this.b*=a,this},lerp:function(a,b){return this.r+=(a.r-this.r)*b,this.g+=(a.g-this.g)*b,this.b+=(a.b-this.b)*b,this},equals:function(a){return a.r===this.r&&a.g===this.g&&a.b===this.b},fromArray:function(a,b){return void 0===b&&(b=0),this.r=a[b],this.g=a[b+1],this.b=a[b+2],this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this.r,a[b+1]=this.g,a[b+2]=this.b,a}},d.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},d.Quaternion=function(a,b,c,d){this._x=a||0,this._y=b||0,this._z=c||0,this._w=void 0!==d?d:1},d.Quaternion.prototype={constructor:d.Quaternion,get x(){return this._x},set x(a){this._x=a,this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a,this.onChangeCallback()},get w(){return this._w},set w(a){this._w=a,this.onChangeCallback()},set:function(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._w=d,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(a){return this._x=a.x,this._y=a.y,this._z=a.z,this._w=a.w,this.onChangeCallback(),this},setFromEuler:function(a,b){if(a instanceof d.Euler==!1)throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var c=Math.cos(a._x/2),e=Math.cos(a._y/2),f=Math.cos(a._z/2),g=Math.sin(a._x/2),h=Math.sin(a._y/2),i=Math.sin(a._z/2),j=a.order;return"XYZ"===j?(this._x=g*e*f+c*h*i,this._y=c*h*f-g*e*i,this._z=c*e*i+g*h*f,this._w=c*e*f-g*h*i):"YXZ"===j?(this._x=g*e*f+c*h*i,this._y=c*h*f-g*e*i,this._z=c*e*i-g*h*f,this._w=c*e*f+g*h*i):"ZXY"===j?(this._x=g*e*f-c*h*i,this._y=c*h*f+g*e*i,this._z=c*e*i+g*h*f,this._w=c*e*f-g*h*i):"ZYX"===j?(this._x=g*e*f-c*h*i,this._y=c*h*f+g*e*i,this._z=c*e*i-g*h*f,this._w=c*e*f+g*h*i):"YZX"===j?(this._x=g*e*f+c*h*i,this._y=c*h*f+g*e*i,this._z=c*e*i-g*h*f,this._w=c*e*f-g*h*i):"XZY"===j&&(this._x=g*e*f-c*h*i,this._y=c*h*f-g*e*i,this._z=c*e*i+g*h*f,this._w=c*e*f+g*h*i),!1!==b&&this.onChangeCallback(),this},setFromAxisAngle:function(a,b){var c=b/2,d=Math.sin(c);return this._x=a.x*d,this._y=a.y*d,this._z=a.z*d,this._w=Math.cos(c),this.onChangeCallback(),this},setFromRotationMatrix:function(a){var b,c=a.elements,d=c[0],e=c[4],f=c[8],g=c[1],h=c[5],i=c[9],j=c[2],k=c[6],l=c[10],m=d+h+l;return m>0?(b=.5/Math.sqrt(m+1),this._w=.25/b,this._x=(k-i)*b,this._y=(f-j)*b,this._z=(g-e)*b):d>h&&d>l?(b=2*Math.sqrt(1+d-h-l),this._w=(k-i)/b,this._x=.25*b,this._y=(e+g)/b,this._z=(f+j)/b):h>l?(b=2*Math.sqrt(1+h-d-l),this._w=(f-j)/b,this._x=(e+g)/b,this._y=.25*b,this._z=(i+k)/b):(b=2*Math.sqrt(1+l-d-h),this._w=(g-e)/b,this._x=(f+j)/b,this._y=(i+k)/b,this._z=.25*b),this.onChangeCallback(),this},setFromUnitVectors:function(){var a,b;return function(c,e){return void 0===a&&(a=new d.Vector3),b=c.dot(e)+1,b<1e-6?(b=0,Math.abs(c.x)>Math.abs(c.z)?a.set(-c.y,c.x,0):a.set(0,-c.z,c.y)):a.crossVectors(c,e),this._x=a.x,this._y=a.y,this._z=a.z,this._w=b,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(a){return this._x*a._x+this._y*a._y+this._z*a._z+this._w*a._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var a=this.length();return 0===a?(this._x=0,this._y=0,this._z=0,this._w=1):(a=1/a,this._x=this._x*a,this._y=this._y*a,this._z=this._z*a,this._w=this._w*a),this.onChangeCallback(),this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(a,b)):this.multiplyQuaternions(this,a)},multiplyQuaternions:function(a,b){var c=a._x,d=a._y,e=a._z,f=a._w,g=b._x,h=b._y,i=b._z,j=b._w;return this._x=c*j+f*g+d*i-e*h,this._y=d*j+f*h+e*g-c*i,this._z=e*j+f*i+c*h-d*g,this._w=f*j-c*g-d*h-e*i,this.onChangeCallback(),this},slerp:function(a,b){if(0===b)return this;if(1===b)return this.copy(a);var c=this._x,d=this._y,e=this._z,f=this._w,g=f*a._w+c*a._x+d*a._y+e*a._z;if(g<0?(this._w=-a._w,this._x=-a._x,this._y=-a._y,this._z=-a._z,g=-g):this.copy(a),g>=1)return this._w=f,this._x=c,this._y=d,this._z=e,this;var h=Math.sqrt(1-g*g);if(Math.abs(h)<.001)return this._w=.5*(f+this._w),this._x=.5*(c+this._x),this._y=.5*(d+this._y),this._z=.5*(e+this._z),this;var i=Math.atan2(h,g),j=Math.sin((1-b)*i)/h,k=Math.sin(b*i)/h;return this._w=f*j+this._w*k,this._x=c*j+this._x*k,this._y=d*j+this._y*k,this._z=e*j+this._z*k,this.onChangeCallback(),this},equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._w===this._w},fromArray:function(a,b){return void 0===b&&(b=0),this._x=a[b],this._y=a[b+1],this._z=a[b+2],this._w=a[b+3],this.onChangeCallback(),this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this._x,a[b+1]=this._y,a[b+2]=this._z,a[b+3]=this._w,a},onChange:function(a){return this.onChangeCallback=a,this},onChangeCallback:function(){}},Object.assign(d.Quaternion,{slerp:function(a,b,c,d){return c.copy(a).slerp(b,d)},slerpFlat:function(a,b,c,d,e,f,g){var h=c[d+0],i=c[d+1],j=c[d+2],k=c[d+3],l=e[f+0],m=e[f+1],n=e[f+2],o=e[f+3];if(k!==o||h!==l||i!==m||j!==n){var p=1-g,q=h*l+i*m+j*n+k*o,r=q>=0?1:-1,s=1-q*q;if(s>Number.EPSILON){var t=Math.sqrt(s),u=Math.atan2(t,q*r);p=Math.sin(p*u)/t,g=Math.sin(g*u)/t}var v=g*r;if(h=h*p+l*v,i=i*p+m*v,j=j*p+n*v,k=k*p+o*v,p===1-g){var w=1/Math.sqrt(h*h+i*i+j*j+k*k);h*=w,i*=w,j*=w,k*=w}}a[b]=h,a[b+1]=i,a[b+2]=j,a[b+3]=k}}),d.Vector2=function(a,b){this.x=a||0,this.y=b||0},d.Vector2.prototype={constructor:d.Vector2,get width(){return this.x},set width(a){this.x=a},get height(){return this.y},set height(a){this.y=a},set:function(a,b){return this.x=a,this.y=b,this},setScalar:function(a){return this.x=a,this.y=a,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+a)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(a){return this.x=a.x,this.y=a.y,this},add:function(a,b){return void 0!==b?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this)},addScalar:function(a){return this.x+=a,this.y+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addScaledVector:function(a,b){return this.x+=a.x*b,this.y+=a.y*b,this},sub:function(a,b){return void 0!==b?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this)},subScalar:function(a){return this.x-=a,this.y-=a,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},multiply:function(a){return this.x*=a.x,this.y*=a.y,this},multiplyScalar:function(a){return isFinite(a)?(this.x*=a,this.y*=a):(this.x=0,this.y=0),this},divide:function(a){return this.x/=a.x,this.y/=a.y,this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this},max:function(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this},clamp:function(a,b){return this.x=Math.max(a.x,Math.min(b.x,this.x)),this.y=Math.max(a.y,Math.min(b.y,this.y)),this},clampScalar:function(){var a,b;return function(c,e){return void 0===a&&(a=new d.Vector2,b=new d.Vector2),a.set(c,c),b.set(e,e),this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.multiplyScalar(Math.max(a,Math.min(b,c))/c),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length())},angle:function(){var a=Math.atan2(this.y,this.x);return a<0&&(a+=2*Math.PI),a},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;return b*b+c*c},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a),this},equals:function(a){return a.x===this.x&&a.y===this.y},fromArray:function(a,b){return void 0===b&&(b=0),this.x=a[b],this.y=a[b+1],this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,a},fromAttribute:function(a,b,c){return void 0===c&&(c=0),b=b*a.itemSize+c,this.x=a.array[b],this.y=a.array[b+1],this},rotateAround:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=this.x-a.x,f=this.y-a.y;return this.x=e*c-f*d+a.x,this.y=e*d+f*c+a.y,this}},d.Vector3=function(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0},d.Vector3.prototype={constructor:d.Vector3,set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setScalar:function(a){return this.x=a,this.y=a,this.z=a,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+a)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this},add:function(a,b){return void 0!==b?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this.z+=a.z,this)},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},addScaledVector:function(a,b){return this.x+=a.x*b,this.y+=a.y*b,this.z+=a.z*b,this},sub:function(a,b){return void 0!==b?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this.z-=a.z,this)},subScalar:function(a){return this.x-=a,this.y-=a,this.z-=a,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiply:function(a,b){return void 0!==b?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(a,b)):(this.x*=a.x,this.y*=a.y,this.z*=a.z,this)},multiplyScalar:function(a){return isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):(this.x=0,this.y=0,this.z=0),this},multiplyVectors:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},applyEuler:function(){var a;return function(b){return b instanceof d.Euler==!1&&console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),void 0===a&&(a=new d.Quaternion),this.applyQuaternion(a.setFromEuler(b)),this}}(),applyAxisAngle:function(){var a;return function(b,c){return void 0===a&&(a=new d.Quaternion),this.applyQuaternion(a.setFromAxisAngle(b,c)),this}}(),applyMatrix3:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[3]*c+e[6]*d,this.y=e[1]*b+e[4]*c+e[7]*d,this.z=e[2]*b+e[5]*c+e[8]*d,this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d+e[12],this.y=e[1]*b+e[5]*c+e[9]*d+e[13],this.z=e[2]*b+e[6]*c+e[10]*d+e[14],this},applyProjection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements,f=1/(e[3]*b+e[7]*c+e[11]*d+e[15]);return this.x=(e[0]*b+e[4]*c+e[8]*d+e[12])*f,this.y=(e[1]*b+e[5]*c+e[9]*d+e[13])*f,this.z=(e[2]*b+e[6]*c+e[10]*d+e[14])*f,this},applyQuaternion:function(a){var b=this.x,c=this.y,d=this.z,e=a.x,f=a.y,g=a.z,h=a.w,i=h*b+f*d-g*c,j=h*c+g*b-e*d,k=h*d+e*c-f*b,l=-e*b-f*c-g*d;return this.x=i*h+l*-e+j*-g-k*-f,this.y=j*h+l*-f+k*-e-i*-g,this.z=k*h+l*-g+i*-f-j*-e,this},project:function(){var a;return function(b){return void 0===a&&(a=new d.Matrix4),a.multiplyMatrices(b.projectionMatrix,a.getInverse(b.matrixWorld)),this.applyProjection(a)}}(),unproject:function(){var a;return function(b){return void 0===a&&(a=new d.Matrix4),a.multiplyMatrices(b.matrixWorld,a.getInverse(b.projectionMatrix)),this.applyProjection(a)}}(),transformDirection:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d,this.y=e[1]*b+e[5]*c+e[9]*d,this.z=e[2]*b+e[6]*c+e[10]*d,this.normalize(),this},divide:function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this},divideScalar:function(a){return this.multiplyScalar(1/a)},min:function(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this},max:function(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this},clamp:function(a,b){return this.x=Math.max(a.x,Math.min(b.x,this.x)),this.y=Math.max(a.y,Math.min(b.y,this.y)),this.z=Math.max(a.z,Math.min(b.z,this.z)),this},clampScalar:function(){var a,b;return function(c,e){return void 0===a&&(a=new d.Vector3,b=new d.Vector3),a.set(c,c,c),b.set(e,e,e),this.clamp(a,b)}}(),clampLength:function(a,b){var c=this.length();return this.multiplyScalar(Math.max(a,Math.min(b,c))/c),this},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a),this},cross:function(a,b){if(void 0!==b)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(a,b);var c=this.x,d=this.y,e=this.z;return this.x=d*a.z-e*a.y,this.y=e*a.x-c*a.z,this.z=c*a.y-d*a.x,this},crossVectors:function(a,b){var c=a.x,d=a.y,e=a.z,f=b.x,g=b.y,h=b.z;return this.x=d*h-e*g,this.y=e*f-c*h,this.z=c*g-d*f,this},projectOnVector:function(){var a,b;return function(c){return void 0===a&&(a=new d.Vector3),a.copy(c).normalize(),b=this.dot(a),this.copy(a).multiplyScalar(b)}}(),projectOnPlane:function(){var a;return function(b){return void 0===a&&(a=new d.Vector3),a.copy(this).projectOnVector(b),this.sub(a)}}(),reflect:function(){var a;return function(b){return void 0===a&&(a=new d.Vector3),this.sub(a.copy(b).multiplyScalar(2*this.dot(b)))}}(),angleTo:function(a){var b=this.dot(a)/Math.sqrt(this.lengthSq()*a.lengthSq());return Math.acos(d.Math.clamp(b,-1,1))},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d},setFromSpherical:function(a){var b=Math.sin(a.phi)*a.radius;return this.x=b*Math.sin(a.theta),this.y=Math.cos(a.phi)*a.radius,this.z=b*Math.cos(a.theta),this},setFromMatrixPosition:function(a){return this.setFromMatrixColumn(a,3)},setFromMatrixScale:function(a){var b=this.setFromMatrixColumn(a,0).length(),c=this.setFromMatrixColumn(a,1).length(),d=this.setFromMatrixColumn(a,2).length();return this.x=b,this.y=c,this.z=d,this},setFromMatrixColumn:function(a,b){return"number"==typeof a&&(console.warn("THREE.Vector3: setFromMatrixColumn now expects ( matrix, index )."),a=arguments[1],b=arguments[0]),this.fromArray(a.elements,4*b)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},fromArray:function(a,b){return void 0===b&&(b=0),this.x=a[b],this.y=a[b+1],this.z=a[b+2],this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a},fromAttribute:function(a,b,c){return void 0===c&&(c=0),b=b*a.itemSize+c,this.x=a.array[b],this.y=a.array[b+1],this.z=a.array[b+2],this}},d.Vector4=function(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=void 0!==d?d:1},d.Vector4.prototype={constructor:d.Vector4,set:function(a,b,c,d){return this.x=a,this.y=b,this.z=c,this.w=d,this},setScalar:function(a){return this.x=a,this.y=a,this.z=a,this.w=a,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},setW:function(a){return this.w=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;case 2:this.z=b;break;case 3:this.w=b;break;default:throw new Error("index is out of range: "+a)}},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+a)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this.w=void 0!==a.w?a.w:1,this},add:function(a,b){return void 0!==b?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(a,b)):(this.x+=a.x,this.y+=a.y,this.z+=a.z,this.w+=a.w,this)},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this.w+=a,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this},addScaledVector:function(a,b){return this.x+=a.x*b,this.y+=a.y*b,this.z+=a.z*b,this.w+=a.w*b,this},sub:function(a,b){return void 0!==b?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(a,b)):(this.x-=a.x,this.y-=a.y,this.z-=a.z,this.w-=a.w,this)},subScalar:function(a){return this.x-=a,this.y-=a,this.z-=a,this.w-=a,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this},multiplyScalar:function(a){return isFinite(a)?(this.x*=a,this.y*=a,this.z*=a,this.w*=a):(this.x=0,this.y=0,this.z=0,this.w=0),this},applyMatrix4:function(a){var b=this.x,c=this.y,d=this.z,e=this.w,f=a.elements;return this.x=f[0]*b+f[4]*c+f[8]*d+f[12]*e,this.y=f[1]*b+f[5]*c+f[9]*d+f[13]*e,this.z=f[2]*b+f[6]*c+f[10]*d+f[14]*e,this.w=f[3]*b+f[7]*c+f[11]*d+f[15]*e,this},divideScalar:function(a){return this.multiplyScalar(1/a)},setAxisAngleFromQuaternion:function(a){this.w=2*Math.acos(a.w);var b=Math.sqrt(1-a.w*a.w);return b<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=a.x/b,this.y=a.y/b,this.z=a.z/b),this},setAxisAngleFromRotationMatrix:function(a){var b,c,d,e,f=a.elements,g=f[0],h=f[4],i=f[8],j=f[1],k=f[5],l=f[9],m=f[2],n=f[6],o=f[10];if(Math.abs(h-j)<.01&&Math.abs(i-m)<.01&&Math.abs(l-n)<.01){if(Math.abs(h+j)<.1&&Math.abs(i+m)<.1&&Math.abs(l+n)<.1&&Math.abs(g+k+o-3)<.1)return this.set(1,0,0,0),this;b=Math.PI;var p=(g+1)/2,q=(k+1)/2,r=(o+1)/2,s=(h+j)/4,t=(i+m)/4,u=(l+n)/4;return p>q&&p>r?p<.01?(c=0,d=.707106781,e=.707106781):(c=Math.sqrt(p),d=s/c,e=t/c):q>r?q<.01?(c=.707106781,d=0,e=.707106781):(d=Math.sqrt(q),c=s/d,e=u/d):r<.01?(c=.707106781,d=.707106781,e=0):(e=Math.sqrt(r),c=t/e,d=u/e),this.set(c,d,e,b),this}var v=Math.sqrt((n-l)*(n-l)+(i-m)*(i-m)+(j-h)*(j-h));return Math.abs(v)<.001&&(v=1),this.x=(n-l)/v,this.y=(i-m)/v,this.z=(j-h)/v,this.w=Math.acos((g+k+o-1)/2),this},min:function(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this.w=Math.min(this.w,a.w),this},max:function(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this.w=Math.max(this.w,a.w),this},clamp:function(a,b){return this.x=Math.max(a.x,Math.min(b.x,this.x)),this.y=Math.max(a.y,Math.min(b.y,this.y)),this.z=Math.max(a.z,Math.min(b.z,this.z)),this.w=Math.max(a.w,Math.min(b.w,this.w)),this},clampScalar:function(){var a,b;return function(c,e){return void 0===a&&(a=new d.Vector4,b=new d.Vector4),a.set(c,c,c,c),b.set(e,e,e,e),this.clamp(a,b)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(a){return this.multiplyScalar(a/this.length())},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this.w+=(a.w-this.w)*b,this},lerpVectors:function(a,b,c){return this.subVectors(b,a).multiplyScalar(c).add(a),this},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},fromArray:function(a,b){return void 0===b&&(b=0),this.x=a[b],this.y=a[b+1],this.z=a[b+2],this.w=a[b+3],this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a[b+3]=this.w,a},fromAttribute:function(a,b,c){return void 0===c&&(c=0),b=b*a.itemSize+c,this.x=a.array[b],this.y=a.array[b+1],this.z=a.array[b+2],this.w=a.array[b+3],this}},d.Euler=function(a,b,c,e){this._x=a||0,this._y=b||0,this._z=c||0,this._order=e||d.Euler.DefaultOrder},d.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],d.Euler.DefaultOrder="XYZ",d.Euler.prototype={constructor:d.Euler,get x(){return this._x},set x(a){this._x=a,this.onChangeCallback()},get y(){return this._y},set y(a){this._y=a,this.onChangeCallback()},get z(){return this._z},set z(a){this._z=a,this.onChangeCallback()},get order(){return this._order},set order(a){this._order=a,this.onChangeCallback()},set:function(a,b,c,d){return this._x=a,this._y=b,this._z=c,this._order=d||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(a){return this._x=a._x,this._y=a._y,this._z=a._z,this._order=a._order,this.onChangeCallback(),this},setFromRotationMatrix:function(a,b,c){var e=d.Math.clamp,f=a.elements,g=f[0],h=f[4],i=f[8],j=f[1],k=f[5],l=f[9],m=f[2],n=f[6],o=f[10];return b=b||this._order,"XYZ"===b?(this._y=Math.asin(e(i,-1,1)),
Math.abs(i)<.99999?(this._x=Math.atan2(-l,o),this._z=Math.atan2(-h,g)):(this._x=Math.atan2(n,k),this._z=0)):"YXZ"===b?(this._x=Math.asin(-e(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(i,o),this._z=Math.atan2(j,k)):(this._y=Math.atan2(-m,g),this._z=0)):"ZXY"===b?(this._x=Math.asin(e(n,-1,1)),Math.abs(n)<.99999?(this._y=Math.atan2(-m,o),this._z=Math.atan2(-h,k)):(this._y=0,this._z=Math.atan2(j,g))):"ZYX"===b?(this._y=Math.asin(-e(m,-1,1)),Math.abs(m)<.99999?(this._x=Math.atan2(n,o),this._z=Math.atan2(j,g)):(this._x=0,this._z=Math.atan2(-h,k))):"YZX"===b?(this._z=Math.asin(e(j,-1,1)),Math.abs(j)<.99999?(this._x=Math.atan2(-l,k),this._y=Math.atan2(-m,g)):(this._x=0,this._y=Math.atan2(i,o))):"XZY"===b?(this._z=Math.asin(-e(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(n,k),this._y=Math.atan2(i,g)):(this._x=Math.atan2(-l,o),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+b),this._order=b,!1!==c&&this.onChangeCallback(),this},setFromQuaternion:function(){var a;return function(b,c,e){return void 0===a&&(a=new d.Matrix4),a.makeRotationFromQuaternion(b),this.setFromRotationMatrix(a,c,e),this}}(),setFromVector3:function(a,b){return this.set(a.x,a.y,a.z,b||this._order)},reorder:function(){var a=new d.Quaternion;return function(b){a.setFromEuler(this),this.setFromQuaternion(a,b)}}(),equals:function(a){return a._x===this._x&&a._y===this._y&&a._z===this._z&&a._order===this._order},fromArray:function(a){return this._x=a[0],this._y=a[1],this._z=a[2],void 0!==a[3]&&(this._order=a[3]),this.onChangeCallback(),this},toArray:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this._x,a[b+1]=this._y,a[b+2]=this._z,a[b+3]=this._order,a},toVector3:function(a){return a?a.set(this._x,this._y,this._z):new d.Vector3(this._x,this._y,this._z)},onChange:function(a){return this.onChangeCallback=a,this},onChangeCallback:function(){}},d.Line3=function(a,b){this.start=void 0!==a?a:new d.Vector3,this.end=void 0!==b?b:new d.Vector3},d.Line3.prototype={constructor:d.Line3,set:function(a,b){return this.start.copy(a),this.end.copy(b),this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.start.copy(a.start),this.end.copy(a.end),this},center:function(a){return(a||new d.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(a){return(a||new d.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(a,b){var c=b||new d.Vector3;return this.delta(c).multiplyScalar(a).add(this.start)},closestPointToPointParameter:function(){var a=new d.Vector3,b=new d.Vector3;return function(c,e){a.subVectors(c,this.start),b.subVectors(this.end,this.start);var f=b.dot(b),g=b.dot(a),h=g/f;return e&&(h=d.Math.clamp(h,0,1)),h}}(),closestPointToPoint:function(a,b,c){var e=this.closestPointToPointParameter(a,b),f=c||new d.Vector3;return this.delta(f).multiplyScalar(e).add(this.start)},applyMatrix4:function(a){return this.start.applyMatrix4(a),this.end.applyMatrix4(a),this},equals:function(a){return a.start.equals(this.start)&&a.end.equals(this.end)}},d.Box2=function(a,b){this.min=void 0!==a?a:new d.Vector2(1/0,1/0),this.max=void 0!==b?b:new d.Vector2(-1/0,-1/0)},d.Box2.prototype={constructor:d.Box2,set:function(a,b){return this.min.copy(a),this.max.copy(b),this},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new d.Vector2;return function(b,c){var d=a.copy(c).multiplyScalar(.5);return this.min.copy(b).sub(d),this.max.copy(b).add(d),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.min.copy(a.min),this.max.copy(a.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(a){return(a||new d.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new d.Vector2).subVectors(this.max,this.min)},expandByPoint:function(a){return this.min.min(a),this.max.max(a),this},expandByVector:function(a){return this.min.sub(a),this.max.add(a),this},expandByScalar:function(a){return this.min.addScalar(-a),this.max.addScalar(a),this},containsPoint:function(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y)},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y},getParameter:function(a,b){return(b||new d.Vector2).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y)},clampPoint:function(a,b){return(b||new d.Vector2).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new d.Vector2;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),intersect:function(a){return this.min.max(a.min),this.max.min(a.max),this},union:function(a){return this.min.min(a.min),this.max.max(a.max),this},translate:function(a){return this.min.add(a),this.max.add(a),this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}},d.Box3=function(a,b){this.min=void 0!==a?a:new d.Vector3(1/0,1/0,1/0),this.max=void 0!==b?b:new d.Vector3(-1/0,-1/0,-1/0)},d.Box3.prototype={constructor:d.Box3,set:function(a,b){return this.min.copy(a),this.max.copy(b),this},setFromArray:function(a){this.makeEmpty();for(var b=1/0,c=1/0,d=1/0,e=-1/0,f=-1/0,g=-1/0,h=0,i=a.length;h<i;h+=3){var j=a[h],k=a[h+1],l=a[h+2];j<b&&(b=j),k<c&&(c=k),l<d&&(d=l),j>e&&(e=j),k>f&&(f=k),l>g&&(g=l)}this.min.set(b,c,d),this.max.set(e,f,g)},setFromPoints:function(a){this.makeEmpty();for(var b=0,c=a.length;b<c;b++)this.expandByPoint(a[b]);return this},setFromCenterAndSize:function(){var a=new d.Vector3;return function(b,c){var d=a.copy(c).multiplyScalar(.5);return this.min.copy(b).sub(d),this.max.copy(b).add(d),this}}(),setFromObject:function(){var a;return function(b){void 0===a&&(a=new d.Box3);var c=this;return this.makeEmpty(),b.updateMatrixWorld(!0),b.traverse(function(b){var d=b.geometry;void 0!==d&&(null===d.boundingBox&&d.computeBoundingBox(),!1===d.boundingBox.isEmpty()&&(a.copy(d.boundingBox),a.applyMatrix4(b.matrixWorld),c.union(a)))}),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.min.copy(a.min),this.max.copy(a.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(a){return(a||new d.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(a){return(a||new d.Vector3).subVectors(this.max,this.min)},expandByPoint:function(a){return this.min.min(a),this.max.max(a),this},expandByVector:function(a){return this.min.sub(a),this.max.add(a),this},expandByScalar:function(a){return this.min.addScalar(-a),this.max.addScalar(a),this},containsPoint:function(a){return!(a.x<this.min.x||a.x>this.max.x||a.y<this.min.y||a.y>this.max.y||a.z<this.min.z||a.z>this.max.z)},containsBox:function(a){return this.min.x<=a.min.x&&a.max.x<=this.max.x&&this.min.y<=a.min.y&&a.max.y<=this.max.y&&this.min.z<=a.min.z&&a.max.z<=this.max.z},getParameter:function(a,b){return(b||new d.Vector3).set((a.x-this.min.x)/(this.max.x-this.min.x),(a.y-this.min.y)/(this.max.y-this.min.y),(a.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z)},intersectsSphere:function(){var a;return function(b){return void 0===a&&(a=new d.Vector3),this.clampPoint(b.center,a),a.distanceToSquared(b.center)<=b.radius*b.radius}}(),intersectsPlane:function(a){var b,c;return a.normal.x>0?(b=a.normal.x*this.min.x,c=a.normal.x*this.max.x):(b=a.normal.x*this.max.x,c=a.normal.x*this.min.x),a.normal.y>0?(b+=a.normal.y*this.min.y,c+=a.normal.y*this.max.y):(b+=a.normal.y*this.max.y,c+=a.normal.y*this.min.y),a.normal.z>0?(b+=a.normal.z*this.min.z,c+=a.normal.z*this.max.z):(b+=a.normal.z*this.max.z,c+=a.normal.z*this.min.z),b<=a.constant&&c>=a.constant},clampPoint:function(a,b){return(b||new d.Vector3).copy(a).clamp(this.min,this.max)},distanceToPoint:function(){var a=new d.Vector3;return function(b){return a.copy(b).clamp(this.min,this.max).sub(b).length()}}(),getBoundingSphere:function(){var a=new d.Vector3;return function(b){var c=b||new d.Sphere;return c.center=this.center(),c.radius=.5*this.size(a).length(),c}}(),intersect:function(a){return this.min.max(a.min),this.max.min(a.max),this},union:function(a){return this.min.min(a.min),this.max.max(a.max),this},applyMatrix4:function(){var a=[new d.Vector3,new d.Vector3,new d.Vector3,new d.Vector3,new d.Vector3,new d.Vector3,new d.Vector3,new d.Vector3];return function(b){return a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(b),a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(b),a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(b),a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(b),a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(b),a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(b),a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(b),a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(b),this.makeEmpty(),this.setFromPoints(a),this}}(),translate:function(a){return this.min.add(a),this.max.add(a),this},equals:function(a){return a.min.equals(this.min)&&a.max.equals(this.max)}},d.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")},d.Matrix3.prototype={constructor:d.Matrix3,set:function(a,b,c,d,e,f,g,h,i){var j=this.elements;return j[0]=a,j[1]=d,j[2]=g,j[3]=b,j[4]=e,j[5]=h,j[6]=c,j[7]=f,j[8]=i,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(a){var b=a.elements;return this.set(b[0],b[3],b[6],b[1],b[4],b[7],b[2],b[5],b[8]),this},setFromMatrix4:function(a){var b=a.elements;return this.set(b[0],b[4],b[8],b[1],b[5],b[9],b[2],b[6],b[10]),this},applyToVector3Array:function(){var a;return function(b,c,e){void 0===a&&(a=new d.Vector3),void 0===c&&(c=0),void 0===e&&(e=b.length);for(var f=0,g=c;f<e;f+=3,g+=3)a.fromArray(b,g),a.applyMatrix3(this),a.toArray(b,g);return b}}(),applyToBuffer:function(){var a;return function(b,c,e){void 0===a&&(a=new d.Vector3),void 0===c&&(c=0),void 0===e&&(e=b.length/b.itemSize);for(var f=0,g=c;f<e;f++,g++)a.x=b.getX(g),a.y=b.getY(g),a.z=b.getZ(g),a.applyMatrix3(this),b.setXYZ(a.x,a.y,a.z);return b}}(),multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[3]*=a,b[6]*=a,b[1]*=a,b[4]*=a,b[7]*=a,b[2]*=a,b[5]*=a,b[8]*=a,this},determinant:function(){var a=this.elements,b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*f*j-b*g*i-c*e*j+c*g*h+d*e*i-d*f*h},getInverse:function(a,b){a instanceof d.Matrix4&&console.warn("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var c=a.elements,e=this.elements,f=c[0],g=c[1],h=c[2],i=c[3],j=c[4],k=c[5],l=c[6],m=c[7],n=c[8],o=n*j-k*m,p=k*l-n*i,q=m*i-j*l,r=f*o+g*p+h*q;if(0===r){var s="THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(s);return console.warn(s),this.identity()}return e[0]=o,e[1]=h*m-n*g,e[2]=k*g-h*j,e[3]=p,e[4]=n*f-h*l,e[5]=h*i-k*f,e[6]=q,e[7]=g*l-m*f,e[8]=j*f-g*i,this.multiplyScalar(1/r)},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[3],b[3]=a,a=b[2],b[2]=b[6],b[6]=a,a=b[5],b[5]=b[7],b[7]=a,this},flattenToArrayOffset:function(a,b){var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a},getNormalMatrix:function(a){return this.setFromMatrix4(a).getInverse(this).transpose()},transposeIntoArray:function(a){var b=this.elements;return a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8],this},fromArray:function(a){return this.elements.set(a),this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]]}},d.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")},d.Matrix4.prototype={constructor:d.Matrix4,set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new d.Matrix4).fromArray(this.elements)},copy:function(a){return this.elements.set(a.elements),this},copyPosition:function(a){var b=this.elements,c=a.elements;return b[12]=c[12],b[13]=c[13],b[14]=c[14],this},extractBasis:function(a,b,c){return a.setFromMatrixColumn(this,0),b.setFromMatrixColumn(this,1),c.setFromMatrixColumn(this,2),this},makeBasis:function(a,b,c){return this.set(a.x,b.x,c.x,0,a.y,b.y,c.y,0,a.z,b.z,c.z,0,0,0,0,1),this},extractRotation:function(){var a;return function(b){void 0===a&&(a=new d.Vector3);var c=this.elements,e=b.elements,f=1/a.setFromMatrixColumn(b,0).length(),g=1/a.setFromMatrixColumn(b,1).length(),h=1/a.setFromMatrixColumn(b,2).length();return c[0]=e[0]*f,c[1]=e[1]*f,c[2]=e[2]*f,c[4]=e[4]*g,c[5]=e[5]*g,c[6]=e[6]*g,c[8]=e[8]*h,c[9]=e[9]*h,c[10]=e[10]*h,this}}(),makeRotationFromEuler:function(a){a instanceof d.Euler==!1&&console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var b=this.elements,c=a.x,e=a.y,f=a.z,g=Math.cos(c),h=Math.sin(c),i=Math.cos(e),j=Math.sin(e),k=Math.cos(f),l=Math.sin(f);if("XYZ"===a.order){var m=g*k,n=g*l,o=h*k,p=h*l;b[0]=i*k,b[4]=-i*l,b[8]=j,b[1]=n+o*j,b[5]=m-p*j,b[9]=-h*i,b[2]=p-m*j,b[6]=o+n*j,b[10]=g*i}else if("YXZ"===a.order){var q=i*k,r=i*l,s=j*k,t=j*l;b[0]=q+t*h,b[4]=s*h-r,b[8]=g*j,b[1]=g*l,b[5]=g*k,b[9]=-h,b[2]=r*h-s,b[6]=t+q*h,b[10]=g*i}else if("ZXY"===a.order){var q=i*k,r=i*l,s=j*k,t=j*l;b[0]=q-t*h,b[4]=-g*l,b[8]=s+r*h,b[1]=r+s*h,b[5]=g*k,b[9]=t-q*h,b[2]=-g*j,b[6]=h,b[10]=g*i}else if("ZYX"===a.order){var m=g*k,n=g*l,o=h*k,p=h*l;b[0]=i*k,b[4]=o*j-n,b[8]=m*j+p,b[1]=i*l,b[5]=p*j+m,b[9]=n*j-o,b[2]=-j,b[6]=h*i,b[10]=g*i}else if("YZX"===a.order){var u=g*i,v=g*j,w=h*i,x=h*j;b[0]=i*k,b[4]=x-u*l,b[8]=w*l+v,b[1]=l,b[5]=g*k,b[9]=-h*k,b[2]=-j*k,b[6]=v*l+w,b[10]=u-x*l}else if("XZY"===a.order){var u=g*i,v=g*j,w=h*i,x=h*j;b[0]=i*k,b[4]=-l,b[8]=j*k,b[1]=u*l+x,b[5]=g*k,b[9]=v*l-w,b[2]=w*l-v,b[6]=h*k,b[10]=x*l+u}return b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[4]=k-r,b[8]=l+q,b[1]=k+r,b[5]=1-(j+o),b[9]=n-p,b[2]=l-q,b[6]=n+p,b[10]=1-(j+m),b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},lookAt:function(){var a,b,c;return function(e,f,g){void 0===a&&(a=new d.Vector3),void 0===b&&(b=new d.Vector3),void 0===c&&(c=new d.Vector3);var h=this.elements;return c.subVectors(e,f).normalize(),0===c.lengthSq()&&(c.z=1),a.crossVectors(g,c).normalize(),0===a.lengthSq()&&(c.x+=1e-4,a.crossVectors(g,c).normalize()),b.crossVectors(c,a),h[0]=a.x,h[4]=b.x,h[8]=c.x,h[1]=a.y,h[5]=b.y,h[9]=c.y,h[2]=a.z,h[6]=b.z,h[10]=c.z,this}}(),multiply:function(a,b){return void 0!==b?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(a,b)):this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this},multiplyToArray:function(a,b,c){var d=this.elements;return this.multiplyMatrices(a,b),c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],this},multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this},applyToVector3Array:function(){var a;return function(b,c,e){void 0===a&&(a=new d.Vector3),void 0===c&&(c=0),void 0===e&&(e=b.length);for(var f=0,g=c;f<e;f+=3,g+=3)a.fromArray(b,g),a.applyMatrix4(this),a.toArray(b,g);return b}}(),applyToBuffer:function(){var a;return function(b,c,e){void 0===a&&(a=new d.Vector3),void 0===c&&(c=0),void 0===e&&(e=b.length/b.itemSize);for(var f=0,g=c;f<e;f++,g++)a.x=b.getX(g),a.y=b.getY(g),a.z=b.getZ(g),a.applyMatrix4(this),b.setXYZ(a.x,a.y,a.z);return b}}(),determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14];return a[3]*(+e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+a[7]*(+b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+a[11]*(+b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+a[15]*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j)},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[4],b[4]=a,a=b[2],b[2]=b[8],b[8]=a,a=b[6],b[6]=b[9],b[9]=a,a=b[3],b[3]=b[12],b[12]=a,a=b[7],b[7]=b[13],b[13]=a,a=b[11],b[11]=b[14],b[14]=a,this},flattenToArrayOffset:function(a,b){var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a[b+9]=c[9],a[b+10]=c[10],a[b+11]=c[11],a[b+12]=c[12],a[b+13]=c[13],a[b+14]=c[14],a[b+15]=c[15],a},getPosition:function(){var a;return function(){return void 0===a&&(a=new d.Vector3),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),a.setFromMatrixColumn(this,3)}}(),setPosition:function(a){var b=this.elements;return b[12]=a.x,b[13]=a.y,b[14]=a.z,this},getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[1],g=d[2],h=d[3],i=d[4],j=d[5],k=d[6],l=d[7],m=d[8],n=d[9],o=d[10],p=d[11],q=d[12],r=d[13],s=d[14],t=d[15],u=n*s*l-r*o*l+r*k*p-j*s*p-n*k*t+j*o*t,v=q*o*l-m*s*l-q*k*p+i*s*p+m*k*t-i*o*t,w=m*r*l-q*n*l+q*j*p-i*r*p-m*j*t+i*n*t,x=q*n*k-m*r*k-q*j*o+i*r*o+m*j*s-i*n*s,y=e*u+f*v+g*w+h*x;if(0===y){var z="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(z);return console.warn(z),this.identity()}return c[0]=u,c[1]=r*o*h-n*s*h-r*g*p+f*s*p+n*g*t-f*o*t,c[2]=j*s*h-r*k*h+r*g*l-f*s*l-j*g*t+f*k*t,c[3]=n*k*h-j*o*h-n*g*l+f*o*l+j*g*p-f*k*p,c[4]=v,c[5]=m*s*h-q*o*h+q*g*p-e*s*p-m*g*t+e*o*t,c[6]=q*k*h-i*s*h-q*g*l+e*s*l+i*g*t-e*k*t,c[7]=i*o*h-m*k*h+m*g*l-e*o*l-i*g*p+e*k*p,c[8]=w,c[9]=q*n*h-m*r*h-q*f*p+e*r*p+m*f*t-e*n*t,c[10]=i*r*h-q*j*h+q*f*l-e*r*l-i*f*t+e*j*t,c[11]=m*j*h-i*n*h-m*f*l+e*n*l+i*f*p-e*j*p,c[12]=x,c[13]=m*r*g-q*n*g+q*f*o-e*r*o-m*f*s+e*n*s,c[14]=q*j*g-i*r*g-q*f*k+e*r*k+i*f*s-e*j*s,c[15]=i*n*g-m*j*g+m*f*k-e*n*k-i*f*o+e*j*o,this.multiplyScalar(1/y)},scale:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return b[0]*=c,b[4]*=d,b[8]*=e,b[1]*=c,b[5]*=d,b[9]*=e,b[2]*=c,b[6]*=d,b[10]*=e,b[3]*=c,b[7]*=d,b[11]*=e,this},getMaxScaleOnAxis:function(){var a=this.elements,b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],c=a[4]*a[4]+a[5]*a[5]+a[6]*a[6],d=a[8]*a[8]+a[9]*a[9]+a[10]*a[10];return Math.sqrt(Math.max(b,c,d))},makeTranslation:function(a,b,c){return this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this},makeRotationX:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1),this},makeRotationY:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1),this},makeRotationZ:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,i=e*f,j=e*g;return this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1),this},makeScale:function(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this},compose:function(a,b,c){return this.makeRotationFromQuaternion(b),this.scale(c),this.setPosition(a),this},decompose:function(){var a,b;return function(c,e,f){void 0===a&&(a=new d.Vector3),void 0===b&&(b=new d.Matrix4);var g=this.elements,h=a.set(g[0],g[1],g[2]).length(),i=a.set(g[4],g[5],g[6]).length(),j=a.set(g[8],g[9],g[10]).length();this.determinant()<0&&(h=-h),c.x=g[12],c.y=g[13],c.z=g[14],b.elements.set(this.elements);var k=1/h,l=1/i,m=1/j;return b.elements[0]*=k,b.elements[1]*=k,b.elements[2]*=k,b.elements[4]*=l,b.elements[5]*=l,b.elements[6]*=l,b.elements[8]*=m,b.elements[9]*=m,b.elements[10]*=m,e.setFromRotationMatrix(b),f.x=h,f.y=i,f.z=j,this}}(),makeFrustum:function(a,b,c,d,e,f){var g=this.elements,h=2*e/(b-a),i=2*e/(d-c),j=(b+a)/(b-a),k=(d+c)/(d-c),l=-(f+e)/(f-e),m=-2*f*e/(f-e);return g[0]=h,g[4]=0,g[8]=j,g[12]=0,g[1]=0,g[5]=i,g[9]=k,g[13]=0,g[2]=0,g[6]=0,g[10]=l,g[14]=m,g[3]=0,g[7]=0,g[11]=-1,g[15]=0,this},makePerspective:function(a,b,c,e){var f=c*Math.tan(d.Math.degToRad(.5*a)),g=-f,h=g*b,i=f*b;return this.makeFrustum(h,i,g,f,c,e)},makeOrthographic:function(a,b,c,d,e,f){var g=this.elements,h=1/(b-a),i=1/(c-d),j=1/(f-e),k=(b+a)*h,l=(c+d)*i,m=(f+e)*j;return g[0]=2*h,g[4]=0,g[8]=0,g[12]=-k,g[1]=0,g[5]=2*i,g[9]=0,g[13]=-l,g[2]=0,g[6]=0,g[10]=-2*j,g[14]=-m,g[3]=0,g[7]=0,g[11]=0,g[15]=1,this},equals:function(a){for(var b=this.elements,c=a.elements,d=0;d<16;d++)if(b[d]!==c[d])return!1;return!0},fromArray:function(a){return this.elements.set(a),this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]}},d.Ray=function(a,b){this.origin=void 0!==a?a:new d.Vector3,this.direction=void 0!==b?b:new d.Vector3},d.Ray.prototype={constructor:d.Ray,set:function(a,b){return this.origin.copy(a),this.direction.copy(b),this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.origin.copy(a.origin),this.direction.copy(a.direction),this},at:function(a,b){return(b||new d.Vector3).copy(this.direction).multiplyScalar(a).add(this.origin)},lookAt:function(a){this.direction.copy(a).sub(this.origin).normalize()},recast:function(){var a=new d.Vector3;return function(b){return this.origin.copy(this.at(b,a)),this}}(),closestPointToPoint:function(a,b){var c=b||new d.Vector3;c.subVectors(a,this.origin);var e=c.dot(this.direction);return e<0?c.copy(this.origin):c.copy(this.direction).multiplyScalar(e).add(this.origin)},distanceToPoint:function(a){return Math.sqrt(this.distanceSqToPoint(a))},distanceSqToPoint:function(){var a=new d.Vector3;return function(b){var c=a.subVectors(b,this.origin).dot(this.direction);return c<0?this.origin.distanceToSquared(b):(a.copy(this.direction).multiplyScalar(c).add(this.origin),a.distanceToSquared(b))}}(),distanceSqToSegment:function(){var a=new d.Vector3,b=new d.Vector3,c=new d.Vector3;return function(d,e,f,g){a.copy(d).add(e).multiplyScalar(.5),b.copy(e).sub(d).normalize(),c.copy(this.origin).sub(a);var h,i,j,k,l=.5*d.distanceTo(e),m=-this.direction.dot(b),n=c.dot(this.direction),o=-c.dot(b),p=c.lengthSq(),q=Math.abs(1-m*m);if(q>0)if(h=m*o-n,i=m*n-o,k=l*q,h>=0)if(i>=-k)if(i<=k){var r=1/q;h*=r,i*=r,j=h*(h+m*i+2*n)+i*(m*h+i+2*o)+p}else i=l,h=Math.max(0,-(m*i+n)),j=-h*h+i*(i+2*o)+p;else i=-l,h=Math.max(0,-(m*i+n)),j=-h*h+i*(i+2*o)+p;else i<=-k?(h=Math.max(0,-(-m*l+n)),i=h>0?-l:Math.min(Math.max(-l,-o),l),j=-h*h+i*(i+2*o)+p):i<=k?(h=0,i=Math.min(Math.max(-l,-o),l),j=i*(i+2*o)+p):(h=Math.max(0,-(m*l+n)),i=h>0?l:Math.min(Math.max(-l,-o),l),j=-h*h+i*(i+2*o)+p);else i=m>0?-l:l,h=Math.max(0,-(m*i+n)),j=-h*h+i*(i+2*o)+p;return f&&f.copy(this.direction).multiplyScalar(h).add(this.origin),g&&g.copy(b).multiplyScalar(i).add(a),j}}(),intersectSphere:function(){var a=new d.Vector3;return function(b,c){a.subVectors(b.center,this.origin);var d=a.dot(this.direction),e=a.dot(a)-d*d,f=b.radius*b.radius;if(e>f)return null;var g=Math.sqrt(f-e),h=d-g,i=d+g;return h<0&&i<0?null:h<0?this.at(i,c):this.at(h,c)}}(),intersectsSphere:function(a){return this.distanceToPoint(a.center)<=a.radius},distanceToPlane:function(a){var b=a.normal.dot(this.direction);if(0===b)return 0===a.distanceToPoint(this.origin)?0:null;var c=-(this.origin.dot(a.normal)+a.constant)/b;return c>=0?c:null},intersectPlane:function(a,b){var c=this.distanceToPlane(a);return null===c?null:this.at(c,b)},intersectsPlane:function(a){var b=a.distanceToPoint(this.origin);return 0===b||a.normal.dot(this.direction)*b<0},intersectBox:function(a,b){var c,d,e,f,g,h,i=1/this.direction.x,j=1/this.direction.y,k=1/this.direction.z,l=this.origin;return i>=0?(c=(a.min.x-l.x)*i,d=(a.max.x-l.x)*i):(c=(a.max.x-l.x)*i,d=(a.min.x-l.x)*i),j>=0?(e=(a.min.y-l.y)*j,f=(a.max.y-l.y)*j):(e=(a.max.y-l.y)*j,f=(a.min.y-l.y)*j),c>f||e>d?null:((e>c||c!==c)&&(c=e),(f<d||d!==d)&&(d=f),k>=0?(g=(a.min.z-l.z)*k,h=(a.max.z-l.z)*k):(g=(a.max.z-l.z)*k,h=(a.min.z-l.z)*k),c>h||g>d?null:((g>c||c!==c)&&(c=g),(h<d||d!==d)&&(d=h),d<0?null:this.at(c>=0?c:d,b)))},intersectsBox:function(){var a=new d.Vector3;return function(b){return null!==this.intersectBox(b,a)}}(),intersectTriangle:function(){var a=new d.Vector3,b=new d.Vector3,c=new d.Vector3,e=new d.Vector3;return function(d,f,g,h,i){b.subVectors(f,d),c.subVectors(g,d),e.crossVectors(b,c);var j,k=this.direction.dot(e);if(k>0){if(h)return null;j=1}else{if(!(k<0))return null;j=-1,k=-k}a.subVectors(this.origin,d);var l=j*this.direction.dot(c.crossVectors(a,c));if(l<0)return null;var m=j*this.direction.dot(b.cross(a));if(m<0)return null;if(l+m>k)return null;var n=-j*a.dot(e);return n<0?null:this.at(n/k,i)}}(),applyMatrix4:function(a){return this.direction.add(this.origin).applyMatrix4(a),this.origin.applyMatrix4(a),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(a){return a.origin.equals(this.origin)&&a.direction.equals(this.direction)}},d.Sphere=function(a,b){this.center=void 0!==a?a:new d.Vector3,this.radius=void 0!==b?b:0},d.Sphere.prototype={constructor:d.Sphere,set:function(a,b){return this.center.copy(a),this.radius=b,this},setFromPoints:function(){var a=new d.Box3;return function(b,c){var d=this.center;void 0!==c?d.copy(c):a.setFromPoints(b).center(d);for(var e=0,f=0,g=b.length;f<g;f++)e=Math.max(e,d.distanceToSquared(b[f]));return this.radius=Math.sqrt(e),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.center.copy(a.center),this.radius=a.radius,this},empty:function(){return this.radius<=0},containsPoint:function(a){return a.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(a){return a.distanceTo(this.center)-this.radius},intersectsSphere:function(a){var b=this.radius+a.radius;return a.center.distanceToSquared(this.center)<=b*b},intersectsBox:function(a){return a.intersectsSphere(this)},intersectsPlane:function(a){return Math.abs(this.center.dot(a.normal)-a.constant)<=this.radius},clampPoint:function(a,b){var c=this.center.distanceToSquared(a),e=b||new d.Vector3;return e.copy(a),c>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(a){var b=a||new d.Box3;return b.set(this.center,this.center),b.expandByScalar(this.radius),b},applyMatrix4:function(a){return this.center.applyMatrix4(a),this.radius=this.radius*a.getMaxScaleOnAxis(),this},translate:function(a){return this.center.add(a),this},equals:function(a){return a.center.equals(this.center)&&a.radius===this.radius}},d.Frustum=function(a,b,c,e,f,g){this.planes=[void 0!==a?a:new d.Plane,void 0!==b?b:new d.Plane,void 0!==c?c:new d.Plane,void 0!==e?e:new d.Plane,void 0!==f?f:new d.Plane,void 0!==g?g:new d.Plane]},d.Frustum.prototype={constructor:d.Frustum,set:function(a,b,c,d,e,f){var g=this.planes;return g[0].copy(a),g[1].copy(b),g[2].copy(c),g[3].copy(d),g[4].copy(e),g[5].copy(f),this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){for(var b=this.planes,c=0;c<6;c++)b[c].copy(a.planes[c]);return this},setFromMatrix:function(a){var b=this.planes,c=a.elements,d=c[0],e=c[1],f=c[2],g=c[3],h=c[4],i=c[5],j=c[6],k=c[7],l=c[8],m=c[9],n=c[10],o=c[11],p=c[12],q=c[13],r=c[14],s=c[15];return b[0].setComponents(g-d,k-h,o-l,s-p).normalize(),b[1].setComponents(g+d,k+h,o+l,s+p).normalize(),b[2].setComponents(g+e,k+i,o+m,s+q).normalize(),b[3].setComponents(g-e,k-i,o-m,s-q).normalize(),b[4].setComponents(g-f,k-j,o-n,s-r).normalize(),b[5].setComponents(g+f,k+j,o+n,s+r).normalize(),this},intersectsObject:function(){var a=new d.Sphere;return function(b){var c=b.geometry;return null===c.boundingSphere&&c.computeBoundingSphere(),a.copy(c.boundingSphere),a.applyMatrix4(b.matrixWorld),this.intersectsSphere(a)}}(),intersectsSphere:function(a){for(var b=this.planes,c=a.center,d=-a.radius,e=0;e<6;e++){if(b[e].distanceToPoint(c)<d)return!1}return!0},intersectsBox:function(){var a=new d.Vector3,b=new d.Vector3;return function(c){for(var d=this.planes,e=0;e<6;e++){var f=d[e];a.x=f.normal.x>0?c.min.x:c.max.x,b.x=f.normal.x>0?c.max.x:c.min.x,a.y=f.normal.y>0?c.min.y:c.max.y,b.y=f.normal.y>0?c.max.y:c.min.y,a.z=f.normal.z>0?c.min.z:c.max.z,b.z=f.normal.z>0?c.max.z:c.min.z;var g=f.distanceToPoint(a),h=f.distanceToPoint(b);if(g<0&&h<0)return!1}return!0}}(),containsPoint:function(a){for(var b=this.planes,c=0;c<6;c++)if(b[c].distanceToPoint(a)<0)return!1;return!0}},d.Plane=function(a,b){this.normal=void 0!==a?a:new d.Vector3(1,0,0),this.constant=void 0!==b?b:0},d.Plane.prototype={constructor:d.Plane,set:function(a,b){return this.normal.copy(a),this.constant=b,this},setComponents:function(a,b,c,d){return this.normal.set(a,b,c),this.constant=d,this},setFromNormalAndCoplanarPoint:function(a,b){return this.normal.copy(a),this.constant=-b.dot(this.normal),this},setFromCoplanarPoints:function(){var a=new d.Vector3,b=new d.Vector3;return function(c,d,e){var f=a.subVectors(e,d).cross(b.subVectors(c,d)).normalize();return this.setFromNormalAndCoplanarPoint(f,c),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.normal.copy(a.normal),this.constant=a.constant,this},normalize:function(){var a=1/this.normal.length();return this.normal.multiplyScalar(a),this.constant*=a,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(a){return this.normal.dot(a)+this.constant},distanceToSphere:function(a){return this.distanceToPoint(a.center)-a.radius},projectPoint:function(a,b){return this.orthoPoint(a,b).sub(a).negate()},orthoPoint:function(a,b){var c=this.distanceToPoint(a);return(b||new d.Vector3).copy(this.normal).multiplyScalar(c)},intersectLine:function(){var a=new d.Vector3;return function(b,c){var e=c||new d.Vector3,f=b.delta(a),g=this.normal.dot(f);if(0!==g){var h=-(b.start.dot(this.normal)+this.constant)/g;if(!(h<0||h>1))return e.copy(f).multiplyScalar(h).add(b.start)}else if(0===this.distanceToPoint(b.start))return e.copy(b.start)}}(),intersectsLine:function(a){var b=this.distanceToPoint(a.start),c=this.distanceToPoint(a.end);return b<0&&c>0||c<0&&b>0},intersectsBox:function(a){return a.intersectsPlane(this)},intersectsSphere:function(a){return a.intersectsPlane(this)},coplanarPoint:function(a){
return(a||new d.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var a=new d.Vector3,b=new d.Vector3,c=new d.Matrix3;return function(d,e){var f=e||c.getNormalMatrix(d),g=a.copy(this.normal).applyMatrix3(f),h=this.coplanarPoint(b);return h.applyMatrix4(d),this.setFromNormalAndCoplanarPoint(g,h),this}}(),translate:function(a){return this.constant=this.constant-a.dot(this.normal),this},equals:function(a){return a.normal.equals(this.normal)&&a.constant===this.constant}},d.Spherical=function(a,b,c){return this.radius=void 0!==a?a:1,this.phi=void 0!==b?b:0,this.theta=void 0!==c?c:0,this},d.Spherical.prototype={constructor:d.Spherical,set:function(a,b,c){this.radius=a,this.phi=b,this.theta=c},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.radius.copy(a.radius),this.phi.copy(a.phi),this.theta.copy(a.theta),this},makeSafe:function(){this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi))},setFromVector3:function(a){return this.radius=a.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(a.x,a.z),this.phi=Math.acos(d.Math.clamp(a.y/this.radius,-1,1))),this}},d.Math={generateUUID:function(){var a,b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),c=new Array(36),d=0;return function(){for(var e=0;e<36;e++)8===e||13===e||18===e||23===e?c[e]="-":14===e?c[e]="4":(d<=2&&(d=33554432+16777216*Math.random()|0),a=15&d,d>>=4,c[e]=b[19===e?3&a|8:a]);return c.join("")}}(),clamp:function(a,b,c){return Math.max(b,Math.min(c,a))},euclideanModulo:function(a,b){return(a%b+b)%b},mapLinear:function(a,b,c,d,e){return d+(a-b)*(e-d)/(c-b)},smoothstep:function(a,b,c){return a<=b?0:a>=c?1:(a=(a-b)/(c-b))*a*(3-2*a)},smootherstep:function(a,b,c){return a<=b?0:a>=c?1:(a=(a-b)/(c-b))*a*a*(a*(6*a-15)+10)},random16:function(){return console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead."),Math.random()},randInt:function(a,b){return a+Math.floor(Math.random()*(b-a+1))},randFloat:function(a,b){return a+Math.random()*(b-a)},randFloatSpread:function(a){return a*(.5-Math.random())},degToRad:function(){var a=Math.PI/180;return function(b){return b*a}}(),radToDeg:function(){var a=180/Math.PI;return function(b){return b*a}}(),isPowerOfTwo:function(a){return 0==(a&a-1)&&0!==a},nearestPowerOfTwo:function(a){return Math.pow(2,Math.round(Math.log(a)/Math.LN2))},nextPowerOfTwo:function(a){return a--,a|=a>>1,a|=a>>2,a|=a>>4,a|=a>>8,a|=a>>16,++a}},d.Spline=function(a){function b(a,b,c,d,e,f,g){var h=.5*(c-a),i=.5*(d-b);return(2*(b-c)+h+i)*g+(-3*(b-c)-2*h-i)*f+h*e+b}this.points=a;var c,e,f,g,h,i,j,k,l,m=[],n={x:0,y:0,z:0};this.initFromArray=function(a){this.points=[];for(var b=0;b<a.length;b++)this.points[b]={x:a[b][0],y:a[b][1],z:a[b][2]}},this.getPoint=function(a){return c=(this.points.length-1)*a,e=Math.floor(c),f=c-e,m[0]=0===e?e:e-1,m[1]=e,m[2]=e>this.points.length-2?this.points.length-1:e+1,m[3]=e>this.points.length-3?this.points.length-1:e+2,i=this.points[m[0]],j=this.points[m[1]],k=this.points[m[2]],l=this.points[m[3]],g=f*f,h=f*g,n.x=b(i.x,j.x,k.x,l.x,f,g,h),n.y=b(i.y,j.y,k.y,l.y,f,g,h),n.z=b(i.z,j.z,k.z,l.z,f,g,h),n},this.getControlPointsArray=function(){var a,b,c=this.points.length,d=[];for(a=0;a<c;a++)b=this.points[a],d[a]=[b.x,b.y,b.z];return d},this.getLength=function(a){var b,c,e,f,g=0,h=0,i=0,j=new d.Vector3,k=new d.Vector3,l=[],m=0;for(l[0]=0,a||(a=100),e=this.points.length*a,j.copy(this.points[0]),b=1;b<e;b++)c=b/e,f=this.getPoint(c),k.copy(f),m+=k.distanceTo(j),j.copy(f),g=(this.points.length-1)*c,(h=Math.floor(g))!==i&&(l[h]=m,i=h);return l[l.length]=m,{chunks:l,total:m}},this.reparametrizeByArcLength=function(a){var b,c,e,f,g,h,i,j,k=[],l=new d.Vector3,m=this.getLength();for(k.push(l.copy(this.points[0]).clone()),b=1;b<this.points.length;b++){for(h=m.chunks[b]-m.chunks[b-1],i=Math.ceil(a*h/m.total),f=(b-1)/(this.points.length-1),g=b/(this.points.length-1),c=1;c<i-1;c++)e=f+c*(1/i)*(g-f),j=this.getPoint(e),k.push(l.copy(j).clone());k.push(l.copy(this.points[b]).clone())}this.points=k}},d.Triangle=function(a,b,c){this.a=void 0!==a?a:new d.Vector3,this.b=void 0!==b?b:new d.Vector3,this.c=void 0!==c?c:new d.Vector3},d.Triangle.normal=function(){var a=new d.Vector3;return function(b,c,e,f){var g=f||new d.Vector3;g.subVectors(e,c),a.subVectors(b,c),g.cross(a);var h=g.lengthSq();return h>0?g.multiplyScalar(1/Math.sqrt(h)):g.set(0,0,0)}}(),d.Triangle.barycoordFromPoint=function(){var a=new d.Vector3,b=new d.Vector3,c=new d.Vector3;return function(e,f,g,h,i){a.subVectors(h,f),b.subVectors(g,f),c.subVectors(e,f);var j=a.dot(a),k=a.dot(b),l=a.dot(c),m=b.dot(b),n=b.dot(c),o=j*m-k*k,p=i||new d.Vector3;if(0===o)return p.set(-2,-1,-1);var q=1/o,r=(m*l-k*n)*q,s=(j*n-k*l)*q;return p.set(1-r-s,s,r)}}(),d.Triangle.containsPoint=function(){var a=new d.Vector3;return function(b,c,e,f){var g=d.Triangle.barycoordFromPoint(b,c,e,f,a);return g.x>=0&&g.y>=0&&g.x+g.y<=1}}(),d.Triangle.prototype={constructor:d.Triangle,set:function(a,b,c){return this.a.copy(a),this.b.copy(b),this.c.copy(c),this},setFromPointsAndIndices:function(a,b,c,d){return this.a.copy(a[b]),this.b.copy(a[c]),this.c.copy(a[d]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.a.copy(a.a),this.b.copy(a.b),this.c.copy(a.c),this},area:function(){var a=new d.Vector3,b=new d.Vector3;return function(){return a.subVectors(this.c,this.b),b.subVectors(this.a,this.b),.5*a.cross(b).length()}}(),midpoint:function(a){return(a||new d.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(a){return d.Triangle.normal(this.a,this.b,this.c,a)},plane:function(a){return(a||new d.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(a,b){return d.Triangle.barycoordFromPoint(a,this.a,this.b,this.c,b)},containsPoint:function(a){return d.Triangle.containsPoint(a,this.a,this.b,this.c)},equals:function(a){return a.a.equals(this.a)&&a.b.equals(this.b)&&a.c.equals(this.c)}},d.Interpolant=function(a,b,c,d){this.parameterPositions=a,this._cachedIndex=0,this.resultBuffer=void 0!==d?d:new b.constructor(c),this.sampleValues=b,this.valueSize=c},d.Interpolant.prototype={constructor:d.Interpolant,evaluate:function(a){var b=this.parameterPositions,c=this._cachedIndex,d=b[c],e=b[c-1];a:{b:{var f;c:{d:if(!(a<d)){for(var g=c+2;;){if(void 0===d){if(a<e)break d;return c=b.length,this._cachedIndex=c,this.afterEnd_(c-1,a,e)}if(c===g)break;if(e=d,d=b[++c],a<d)break b}f=b.length;break c}{if(a>=e)break a;var h=b[1];a<h&&(c=2,e=h);for(var g=c-2;;){if(void 0===e)return this._cachedIndex=0,this.beforeStart_(0,a,d);if(c===g)break;if(d=e,e=b[--c-1],a>=e)break b}f=c,c=0}}for(;c<f;){var i=c+f>>>1;a<b[i]?f=i:c=i+1}if(d=b[c],void 0===(e=b[c-1]))return this._cachedIndex=0,this.beforeStart_(0,a,d);if(void 0===d)return c=b.length,this._cachedIndex=c,this.afterEnd_(c-1,e,a)}this._cachedIndex=c,this.intervalChanged_(c,e,d)}return this.interpolate_(c,e,a,d)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(a){for(var b=this.resultBuffer,c=this.sampleValues,d=this.valueSize,e=a*d,f=0;f!==d;++f)b[f]=c[e+f];return b},interpolate_:function(a,b,c,d){throw new Error("call to abstract method")},intervalChanged_:function(a,b,c){}},Object.assign(d.Interpolant.prototype,{beforeStart_:d.Interpolant.prototype.copySampleValue_,afterEnd_:d.Interpolant.prototype.copySampleValue_}),d.CubicInterpolant=function(a,b,c,e){d.Interpolant.call(this,a,b,c,e),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0},d.CubicInterpolant.prototype=Object.assign(Object.create(d.Interpolant.prototype),{constructor:d.CubicInterpolant,DefaultSettings_:{endingStart:d.ZeroCurvatureEnding,endingEnd:d.ZeroCurvatureEnding},intervalChanged_:function(a,b,c){var e=this.parameterPositions,f=a-2,g=a+1,h=e[f],i=e[g];if(void 0===h)switch(this.getSettings_().endingStart){case d.ZeroSlopeEnding:f=a,h=2*b-c;break;case d.WrapAroundEnding:f=e.length-2,h=b+e[f]-e[f+1];break;default:f=a,h=c}if(void 0===i)switch(this.getSettings_().endingEnd){case d.ZeroSlopeEnding:g=a,i=2*c-b;break;case d.WrapAroundEnding:g=1,i=c+e[1]-e[0];break;default:g=a-1,i=b}var j=.5*(c-b),k=this.valueSize;this._weightPrev=j/(b-h),this._weightNext=j/(i-c),this._offsetPrev=f*k,this._offsetNext=g*k},interpolate_:function(a,b,c,d){for(var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize,h=a*g,i=h-g,j=this._offsetPrev,k=this._offsetNext,l=this._weightPrev,m=this._weightNext,n=(c-b)/(d-b),o=n*n,p=o*n,q=-l*p+2*l*o-l*n,r=(1+l)*p+(-1.5-2*l)*o+(-.5+l)*n+1,s=(-1-m)*p+(1.5+m)*o+.5*n,t=m*p-m*o,u=0;u!==g;++u)e[u]=q*f[j+u]+r*f[i+u]+s*f[h+u]+t*f[k+u];return e}}),d.DiscreteInterpolant=function(a,b,c,e){d.Interpolant.call(this,a,b,c,e)},d.DiscreteInterpolant.prototype=Object.assign(Object.create(d.Interpolant.prototype),{constructor:d.DiscreteInterpolant,interpolate_:function(a,b,c,d){return this.copySampleValue_(a-1)}}),d.LinearInterpolant=function(a,b,c,e){d.Interpolant.call(this,a,b,c,e)},d.LinearInterpolant.prototype=Object.assign(Object.create(d.Interpolant.prototype),{constructor:d.LinearInterpolant,interpolate_:function(a,b,c,d){for(var e=this.resultBuffer,f=this.sampleValues,g=this.valueSize,h=a*g,i=h-g,j=(c-b)/(d-b),k=1-j,l=0;l!==g;++l)e[l]=f[i+l]*k+f[h+l]*j;return e}}),d.QuaternionLinearInterpolant=function(a,b,c,e){d.Interpolant.call(this,a,b,c,e)},d.QuaternionLinearInterpolant.prototype=Object.assign(Object.create(d.Interpolant.prototype),{constructor:d.QuaternionLinearInterpolant,interpolate_:function(a,b,c,e){for(var f=this.resultBuffer,g=this.sampleValues,h=this.valueSize,i=a*h,j=(c-b)/(e-b),k=i+h;i!==k;i+=4)d.Quaternion.slerpFlat(f,0,g,i-h,g,i,j);return f}}),d.Clock=function(a){this.autoStart=void 0===a||a,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},d.Clock.prototype={constructor:d.Clock,start:function(){this.startTime=performance.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var a=0;if(this.autoStart&&!this.running&&this.start(),this.running){var b=performance.now();a=.001*(b-this.oldTime),this.oldTime=b,this.elapsedTime+=a}return a}},d.EventDispatcher=function(){},d.EventDispatcher.prototype={constructor:d.EventDispatcher,apply:function(a){a.addEventListener=d.EventDispatcher.prototype.addEventListener,a.hasEventListener=d.EventDispatcher.prototype.hasEventListener,a.removeEventListener=d.EventDispatcher.prototype.removeEventListener,a.dispatchEvent=d.EventDispatcher.prototype.dispatchEvent},addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]),-1===c[a].indexOf(b)&&c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)},removeEventListener:function(a,b){if(void 0!==this._listeners){var c=this._listeners,d=c[a];if(void 0!==d){var e=d.indexOf(b);-1!==e&&d.splice(e,1)}}},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners,c=b[a.type];if(void 0!==c){a.target=this;for(var d=[],e=c.length,f=0;f<e;f++)d[f]=c[f];for(var f=0;f<e;f++)d[f].call(this,a)}}}},d.Layers=function(){this.mask=1},d.Layers.prototype={constructor:d.Layers,set:function(a){this.mask=1<<a},enable:function(a){this.mask|=1<<a},toggle:function(a){this.mask^=1<<a},disable:function(a){this.mask&=~(1<<a)},test:function(a){return 0!=(this.mask&a.mask)}},function(a){function b(a,b){return a.distance-b.distance}function c(a,b,d,e){if(!1!==a.visible&&(a.raycast(b,d),!0===e))for(var f=a.children,g=0,h=f.length;g<h;g++)c(f[g],b,d,!0)}a.Raycaster=function(b,c,d,e){this.ray=new a.Ray(b,c),this.near=d||0,this.far=e||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})},a.Raycaster.prototype={constructor:a.Raycaster,linePrecision:1,set:function(a,b){this.ray.set(a,b)},setFromCamera:function(b,c){c instanceof a.PerspectiveCamera?(this.ray.origin.setFromMatrixPosition(c.matrixWorld),this.ray.direction.set(b.x,b.y,.5).unproject(c).sub(this.ray.origin).normalize()):c instanceof a.OrthographicCamera?(this.ray.origin.set(b.x,b.y,-1).unproject(c),this.ray.direction.set(0,0,-1).transformDirection(c.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(a,d){var e=[];return c(a,this,e,d),e.sort(b),e},intersectObjects:function(a,d){var e=[];if(!1===Array.isArray(a))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),e;for(var f=0,g=a.length;f<g;f++)c(a[f],this,e,d);return e.sort(b),e}}}(d),d.Object3D=function(){function a(){f.setFromEuler(e,!1)}function b(){e.setFromQuaternion(f,void 0,!1)}Object.defineProperty(this,"id",{value:d.Object3DIdCount++}),this.uuid=d.Math.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=d.Object3D.DefaultUp.clone();var c=new d.Vector3,e=new d.Euler,f=new d.Quaternion,g=new d.Vector3(1,1,1);e.onChange(a),f.onChange(b),Object.defineProperties(this,{position:{enumerable:!0,value:c},rotation:{enumerable:!0,value:e},quaternion:{enumerable:!0,value:f},scale:{enumerable:!0,value:g},modelViewMatrix:{value:new d.Matrix4},normalMatrix:{value:new d.Matrix3}}),this.rotationAutoUpdate=!0,this.matrix=new d.Matrix4,this.matrixWorld=new d.Matrix4,this.matrixAutoUpdate=d.Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new d.Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}},d.Object3D.DefaultUp=new d.Vector3(0,1,0),d.Object3D.DefaultMatrixAutoUpdate=!0,d.Object3D.prototype={constructor:d.Object3D,applyMatrix:function(a){this.matrix.multiplyMatrices(a,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(a,b){this.quaternion.setFromAxisAngle(a,b)},setRotationFromEuler:function(a){this.quaternion.setFromEuler(a,!0)},setRotationFromMatrix:function(a){this.quaternion.setFromRotationMatrix(a)},setRotationFromQuaternion:function(a){this.quaternion.copy(a)},rotateOnAxis:function(){var a=new d.Quaternion;return function(b,c){return a.setFromAxisAngle(b,c),this.quaternion.multiply(a),this}}(),rotateX:function(){var a=new d.Vector3(1,0,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateY:function(){var a=new d.Vector3(0,1,0);return function(b){return this.rotateOnAxis(a,b)}}(),rotateZ:function(){var a=new d.Vector3(0,0,1);return function(b){return this.rotateOnAxis(a,b)}}(),translateOnAxis:function(){var a=new d.Vector3;return function(b,c){return a.copy(b).applyQuaternion(this.quaternion),this.position.add(a.multiplyScalar(c)),this}}(),translateX:function(){var a=new d.Vector3(1,0,0);return function(b){return this.translateOnAxis(a,b)}}(),translateY:function(){var a=new d.Vector3(0,1,0);return function(b){return this.translateOnAxis(a,b)}}(),translateZ:function(){var a=new d.Vector3(0,0,1);return function(b){return this.translateOnAxis(a,b)}}(),localToWorld:function(a){return a.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var a=new d.Matrix4;return function(b){return b.applyMatrix4(a.getInverse(this.matrixWorld))}}(),lookAt:function(){var a=new d.Matrix4;return function(b){a.lookAt(b,this.position,this.up),this.quaternion.setFromRotationMatrix(a)}}(),add:function(a){if(arguments.length>1){for(var b=0;b<arguments.length;b++)this.add(arguments[b]);return this}return a===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",a),this):(a instanceof d.Object3D?(null!==a.parent&&a.parent.remove(a),a.parent=this,a.dispatchEvent({type:"added"}),this.children.push(a)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",a),this)},remove:function(a){if(arguments.length>1)for(var b=0;b<arguments.length;b++)this.remove(arguments[b]);var c=this.children.indexOf(a);-1!==c&&(a.parent=null,a.dispatchEvent({type:"removed"}),this.children.splice(c,1))},getObjectById:function(a){return this.getObjectByProperty("id",a)},getObjectByName:function(a){return this.getObjectByProperty("name",a)},getObjectByProperty:function(a,b){if(this[a]===b)return this;for(var c=0,d=this.children.length;c<d;c++){var e=this.children[c],f=e.getObjectByProperty(a,b);if(void 0!==f)return f}},getWorldPosition:function(a){var b=a||new d.Vector3;return this.updateMatrixWorld(!0),b.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var a=new d.Vector3,b=new d.Vector3;return function(c){var e=c||new d.Quaternion;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(a,e,b),e}}(),getWorldRotation:function(){var a=new d.Quaternion;return function(b){var c=b||new d.Euler;return this.getWorldQuaternion(a),c.setFromQuaternion(a,this.rotation.order,!1)}}(),getWorldScale:function(){var a=new d.Vector3,b=new d.Quaternion;return function(c){var e=c||new d.Vector3;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(a,b,e),e}}(),getWorldDirection:function(){var a=new d.Quaternion;return function(b){var c=b||new d.Vector3;return this.getWorldQuaternion(a),c.set(0,0,1).applyQuaternion(a)}}(),raycast:function(){},traverse:function(a){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverse(a)},traverseVisible:function(a){if(!1!==this.visible){a(this);for(var b=this.children,c=0,d=b.length;c<d;c++)b[c].traverseVisible(a)}},traverseAncestors:function(a){var b=this.parent;null!==b&&(a(b),b.traverseAncestors(a))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(a){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==a||(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,a=!0);for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)},toJSON:function(a){function b(a){var b=[];for(var c in a){var d=a[c];delete d.metadata,b.push(d)}return b}var c=void 0===a,d={};c&&(a={geometries:{},materials:{},textures:{},images:{}},d.metadata={version:4.4,type:"Object",generator:"Object3D.toJSON"});var e={};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),"{}"!==JSON.stringify(this.userData)&&(e.userData=this.userData),!0===this.castShadow&&(e.castShadow=!0),!0===this.receiveShadow&&(e.receiveShadow=!0),!1===this.visible&&(e.visible=!1),e.matrix=this.matrix.toArray(),void 0!==this.geometry&&(void 0===a.geometries[this.geometry.uuid]&&(a.geometries[this.geometry.uuid]=this.geometry.toJSON(a)),e.geometry=this.geometry.uuid),void 0!==this.material&&(void 0===a.materials[this.material.uuid]&&(a.materials[this.material.uuid]=this.material.toJSON(a)),e.material=this.material.uuid),this.children.length>0){e.children=[];for(var f=0;f<this.children.length;f++)e.children.push(this.children[f].toJSON(a).object)}if(c){var g=b(a.geometries),h=b(a.materials),i=b(a.textures),j=b(a.images);g.length>0&&(d.geometries=g),h.length>0&&(d.materials=h),i.length>0&&(d.textures=i),j.length>0&&(d.images=j)}return d.object=e,d},clone:function(a){return(new this.constructor).copy(this,a)},copy:function(a,b){if(void 0===b&&(b=!0),this.name=a.name,this.up.copy(a.up),this.position.copy(a.position),this.quaternion.copy(a.quaternion),this.scale.copy(a.scale),this.rotationAutoUpdate=a.rotationAutoUpdate,this.matrix.copy(a.matrix),this.matrixWorld.copy(a.matrixWorld),this.matrixAutoUpdate=a.matrixAutoUpdate,this.matrixWorldNeedsUpdate=a.matrixWorldNeedsUpdate,this.visible=a.visible,this.castShadow=a.castShadow,this.receiveShadow=a.receiveShadow,this.frustumCulled=a.frustumCulled,this.renderOrder=a.renderOrder,this.userData=JSON.parse(JSON.stringify(a.userData)),!0===b)for(var c=0;c<a.children.length;c++){var d=a.children[c];this.add(d.clone())}return this}},d.EventDispatcher.prototype.apply(d.Object3D.prototype),d.Object3DIdCount=0,d.Face3=function(a,b,c,e,f,g){this.a=a,this.b=b,this.c=c,this.normal=e instanceof d.Vector3?e:new d.Vector3,this.vertexNormals=Array.isArray(e)?e:[],this.color=f instanceof d.Color?f:new d.Color,this.vertexColors=Array.isArray(f)?f:[],this.materialIndex=void 0!==g?g:0},d.Face3.prototype={constructor:d.Face3,clone:function(){return(new this.constructor).copy(this)},copy:function(a){this.a=a.a,this.b=a.b,this.c=a.c,this.normal.copy(a.normal),this.color.copy(a.color),this.materialIndex=a.materialIndex;for(var b=0,c=a.vertexNormals.length;b<c;b++)this.vertexNormals[b]=a.vertexNormals[b].clone();for(var b=0,c=a.vertexColors.length;b<c;b++)this.vertexColors[b]=a.vertexColors[b].clone();return this}},d.BufferAttribute=function(a,b){this.uuid=d.Math.generateUUID(),this.array=a,this.itemSize=b,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},d.BufferAttribute.prototype={constructor:d.BufferAttribute,get count(){return this.array.length/this.itemSize},set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){return this.dynamic=a,this},copy:function(a){return this.array=new a.array.constructor(a.array),this.itemSize=a.itemSize,this.dynamic=a.dynamic,this},copyAt:function(a,b,c){a*=this.itemSize,c*=b.itemSize;for(var d=0,e=this.itemSize;d<e;d++)this.array[a+d]=b.array[c+d];return this},copyArray:function(a){return this.array.set(a),this},copyColorsArray:function(a){for(var b=this.array,c=0,e=0,f=a.length;e<f;e++){var g=a[e];void 0===g&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",e),g=new d.Color),b[c++]=g.r,b[c++]=g.g,b[c++]=g.b}return this},copyIndicesArray:function(a){for(var b=this.array,c=0,d=0,e=a.length;d<e;d++){var f=a[d];b[c++]=f.a,b[c++]=f.b,b[c++]=f.c}return this},copyVector2sArray:function(a){for(var b=this.array,c=0,e=0,f=a.length;e<f;e++){var g=a[e];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",e),g=new d.Vector2),b[c++]=g.x,b[c++]=g.y}return this},copyVector3sArray:function(a){for(var b=this.array,c=0,e=0,f=a.length;e<f;e++){var g=a[e];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",e),g=new d.Vector3),b[c++]=g.x,b[c++]=g.y,b[c++]=g.z}return this},copyVector4sArray:function(a){for(var b=this.array,c=0,e=0,f=a.length;e<f;e++){var g=a[e];void 0===g&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",e),g=new d.Vector4),b[c++]=g.x,b[c++]=g.y,b[c++]=g.z,b[c++]=g.w}return this},set:function(a,b){return void 0===b&&(b=0),this.array.set(a,b),this},getX:function(a){return this.array[a*this.itemSize]},setX:function(a,b){return this.array[a*this.itemSize]=b,this},getY:function(a){return this.array[a*this.itemSize+1]},setY:function(a,b){return this.array[a*this.itemSize+1]=b,this},getZ:function(a){return this.array[a*this.itemSize+2]},setZ:function(a,b){return this.array[a*this.itemSize+2]=b,this},getW:function(a){return this.array[a*this.itemSize+3]},setW:function(a,b){return this.array[a*this.itemSize+3]=b,this},setXY:function(a,b,c){return a*=this.itemSize,this.array[a+0]=b,this.array[a+1]=c,this},setXYZ:function(a,b,c,d){return a*=this.itemSize,this.array[a+0]=b,this.array[a+1]=c,this.array[a+2]=d,this},setXYZW:function(a,b,c,d,e){return a*=this.itemSize,this.array[a+0]=b,this.array[a+1]=c,this.array[a+2]=d,this.array[a+3]=e,this},clone:function(){return(new this.constructor).copy(this)}},d.Int8Attribute=function(a,b){return new d.BufferAttribute(new Int8Array(a),b)},d.Uint8Attribute=function(a,b){return new d.BufferAttribute(new Uint8Array(a),b)},d.Uint8ClampedAttribute=function(a,b){return new d.BufferAttribute(new Uint8ClampedArray(a),b)},d.Int16Attribute=function(a,b){return new d.BufferAttribute(new Int16Array(a),b)},d.Uint16Attribute=function(a,b){return new d.BufferAttribute(new Uint16Array(a),b)};d.Int32Attribute=function(a,b){return new d.BufferAttribute(new Int32Array(a),b)},d.Uint32Attribute=function(a,b){return new d.BufferAttribute(new Uint32Array(a),b)},d.Float32Attribute=function(a,b){return new d.BufferAttribute(new Float32Array(a),b)},d.Float64Attribute=function(a,b){return new d.BufferAttribute(new Float64Array(a),b)},d.DynamicBufferAttribute=function(a,b){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new d.BufferAttribute(a,b).setDynamic(!0)},d.InstancedBufferAttribute=function(a,b,c){d.BufferAttribute.call(this,a,b),this.meshPerAttribute=c||1},d.InstancedBufferAttribute.prototype=Object.create(d.BufferAttribute.prototype),d.InstancedBufferAttribute.prototype.constructor=d.InstancedBufferAttribute,d.InstancedBufferAttribute.prototype.copy=function(a){return d.BufferAttribute.prototype.copy.call(this,a),this.meshPerAttribute=a.meshPerAttribute,this},d.InterleavedBuffer=function(a,b){this.uuid=d.Math.generateUUID(),this.array=a,this.stride=b,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.version=0},d.InterleavedBuffer.prototype={constructor:d.InterleavedBuffer,get length(){return this.array.length},get count(){return this.array.length/this.stride},set needsUpdate(a){!0===a&&this.version++},setDynamic:function(a){return this.dynamic=a,this},copy:function(a){return this.array=new a.array.constructor(a.array),this.stride=a.stride,this.dynamic=a.dynamic,this},copyAt:function(a,b,c){a*=this.stride,c*=b.stride;for(var d=0,e=this.stride;d<e;d++)this.array[a+d]=b.array[c+d];return this},set:function(a,b){return void 0===b&&(b=0),this.array.set(a,b),this},clone:function(){return(new this.constructor).copy(this)}},d.InstancedInterleavedBuffer=function(a,b,c){d.InterleavedBuffer.call(this,a,b),this.meshPerAttribute=c||1},d.InstancedInterleavedBuffer.prototype=Object.create(d.InterleavedBuffer.prototype),d.InstancedInterleavedBuffer.prototype.constructor=d.InstancedInterleavedBuffer,d.InstancedInterleavedBuffer.prototype.copy=function(a){return d.InterleavedBuffer.prototype.copy.call(this,a),this.meshPerAttribute=a.meshPerAttribute,this},d.InterleavedBufferAttribute=function(a,b,c){this.uuid=d.Math.generateUUID(),this.data=a,this.itemSize=b,this.offset=c},d.InterleavedBufferAttribute.prototype={constructor:d.InterleavedBufferAttribute,get length(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length},get count(){return this.data.count},setX:function(a,b){return this.data.array[a*this.data.stride+this.offset]=b,this},setY:function(a,b){return this.data.array[a*this.data.stride+this.offset+1]=b,this},setZ:function(a,b){return this.data.array[a*this.data.stride+this.offset+2]=b,this},setW:function(a,b){return this.data.array[a*this.data.stride+this.offset+3]=b,this},getX:function(a){return this.data.array[a*this.data.stride+this.offset]},getY:function(a){return this.data.array[a*this.data.stride+this.offset+1]},getZ:function(a){return this.data.array[a*this.data.stride+this.offset+2]},getW:function(a){return this.data.array[a*this.data.stride+this.offset+3]},setXY:function(a,b,c){return a=a*this.data.stride+this.offset,this.data.array[a+0]=b,this.data.array[a+1]=c,this},setXYZ:function(a,b,c,d){return a=a*this.data.stride+this.offset,this.data.array[a+0]=b,this.data.array[a+1]=c,this.data.array[a+2]=d,this},setXYZW:function(a,b,c,d,e){return a=a*this.data.stride+this.offset,this.data.array[a+0]=b,this.data.array[a+1]=c,this.data.array[a+2]=d,this.data.array[a+3]=e,this}},d.Geometry=function(){Object.defineProperty(this,"id",{value:d.GeometryIdCount++}),this.uuid=d.Math.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1},d.Geometry.prototype={constructor:d.Geometry,applyMatrix:function(a){for(var b=(new d.Matrix3).getNormalMatrix(a),c=0,e=this.vertices.length;c<e;c++){this.vertices[c].applyMatrix4(a)}for(var c=0,e=this.faces.length;c<e;c++){var f=this.faces[c];f.normal.applyMatrix3(b).normalize();for(var g=0,h=f.vertexNormals.length;g<h;g++)f.vertexNormals[g].applyMatrix3(b).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var a;return function(b){return void 0===a&&(a=new d.Matrix4),a.makeRotationX(b),this.applyMatrix(a),this}}(),rotateY:function(){var a;return function(b){return void 0===a&&(a=new d.Matrix4),a.makeRotationY(b),this.applyMatrix(a),this}}(),rotateZ:function(){var a;return function(b){return void 0===a&&(a=new d.Matrix4),a.makeRotationZ(b),this.applyMatrix(a),this}}(),translate:function(){var a;return function(b,c,e){return void 0===a&&(a=new d.Matrix4),a.makeTranslation(b,c,e),this.applyMatrix(a),this}}(),scale:function(){var a;return function(b,c,e){return void 0===a&&(a=new d.Matrix4),a.makeScale(b,c,e),this.applyMatrix(a),this}}(),lookAt:function(){var a;return function(b){void 0===a&&(a=new d.Object3D),a.lookAt(b),a.updateMatrix(),this.applyMatrix(a.matrix)}}(),fromBufferGeometry:function(a){function b(a,b,e,f){var g=void 0!==h?[l[a].clone(),l[b].clone(),l[e].clone()]:[],o=void 0!==i?[c.colors[a].clone(),c.colors[b].clone(),c.colors[e].clone()]:[],p=new d.Face3(a,b,e,g,o,f);c.faces.push(p),void 0!==j&&c.faceVertexUvs[0].push([m[a].clone(),m[b].clone(),m[e].clone()]),void 0!==k&&c.faceVertexUvs[1].push([n[a].clone(),n[b].clone(),n[e].clone()])}var c=this,e=null!==a.index?a.index.array:void 0,f=a.attributes,g=f.position.array,h=void 0!==f.normal?f.normal.array:void 0,i=void 0!==f.color?f.color.array:void 0,j=void 0!==f.uv?f.uv.array:void 0,k=void 0!==f.uv2?f.uv2.array:void 0;void 0!==k&&(this.faceVertexUvs[1]=[]);for(var l=[],m=[],n=[],o=0,p=0;o<g.length;o+=3,p+=2)c.vertices.push(new d.Vector3(g[o],g[o+1],g[o+2])),void 0!==h&&l.push(new d.Vector3(h[o],h[o+1],h[o+2])),void 0!==i&&c.colors.push(new d.Color(i[o],i[o+1],i[o+2])),void 0!==j&&m.push(new d.Vector2(j[p],j[p+1])),void 0!==k&&n.push(new d.Vector2(k[p],k[p+1]));if(void 0!==e){var q=a.groups;if(q.length>0)for(var o=0;o<q.length;o++)for(var r=q[o],s=r.start,t=r.count,p=s,u=s+t;p<u;p+=3)b(e[p],e[p+1],e[p+2],r.materialIndex);else for(var o=0;o<e.length;o+=3)b(e[o],e[o+1],e[o+2])}else for(var o=0;o<g.length/3;o+=3)b(o,o+1,o+2);return this.computeFaceNormals(),null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone()),null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();return this.translate(a.x,a.y,a.z),a},normalize:function(){this.computeBoundingSphere();var a=this.boundingSphere.center,b=this.boundingSphere.radius,c=0===b?1:1/b,e=new d.Matrix4;return e.set(c,0,0,-c*a.x,0,c,0,-c*a.y,0,0,c,-c*a.z,0,0,0,1),this.applyMatrix(e),this},computeFaceNormals:function(){for(var a=new d.Vector3,b=new d.Vector3,c=0,e=this.faces.length;c<e;c++){var f=this.faces[c],g=this.vertices[f.a],h=this.vertices[f.b],i=this.vertices[f.c];a.subVectors(i,h),b.subVectors(g,h),a.cross(b),a.normalize(),f.normal.copy(a)}},computeVertexNormals:function(a){void 0===a&&(a=!0);var b,c,e,f,g,h;for(h=new Array(this.vertices.length),b=0,c=this.vertices.length;b<c;b++)h[b]=new d.Vector3;if(a){var i,j,k,l=new d.Vector3,m=new d.Vector3;for(e=0,f=this.faces.length;e<f;e++)g=this.faces[e],i=this.vertices[g.a],j=this.vertices[g.b],k=this.vertices[g.c],l.subVectors(k,j),m.subVectors(i,j),
l.cross(m),h[g.a].add(l),h[g.b].add(l),h[g.c].add(l)}else for(e=0,f=this.faces.length;e<f;e++)g=this.faces[e],h[g.a].add(g.normal),h[g.b].add(g.normal),h[g.c].add(g.normal);for(b=0,c=this.vertices.length;b<c;b++)h[b].normalize();for(e=0,f=this.faces.length;e<f;e++){g=this.faces[e];var n=g.vertexNormals;3===n.length?(n[0].copy(h[g.a]),n[1].copy(h[g.b]),n[2].copy(h[g.c])):(n[0]=h[g.a].clone(),n[1]=h[g.b].clone(),n[2]=h[g.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var a,b,c,e,f;for(c=0,e=this.faces.length;c<e;c++)for(f=this.faces[c],f.__originalFaceNormal?f.__originalFaceNormal.copy(f.normal):f.__originalFaceNormal=f.normal.clone(),f.__originalVertexNormals||(f.__originalVertexNormals=[]),a=0,b=f.vertexNormals.length;a<b;a++)f.__originalVertexNormals[a]?f.__originalVertexNormals[a].copy(f.vertexNormals[a]):f.__originalVertexNormals[a]=f.vertexNormals[a].clone();var g=new d.Geometry;for(g.faces=this.faces,a=0,b=this.morphTargets.length;a<b;a++){if(!this.morphNormals[a]){this.morphNormals[a]={},this.morphNormals[a].faceNormals=[],this.morphNormals[a].vertexNormals=[];var h,i,j=this.morphNormals[a].faceNormals,k=this.morphNormals[a].vertexNormals;for(c=0,e=this.faces.length;c<e;c++)h=new d.Vector3,i={a:new d.Vector3,b:new d.Vector3,c:new d.Vector3},j.push(h),k.push(i)}var l=this.morphNormals[a];g.vertices=this.morphTargets[a].vertices,g.computeFaceNormals(),g.computeVertexNormals();var h,i;for(c=0,e=this.faces.length;c<e;c++)f=this.faces[c],h=l.faceNormals[c],i=l.vertexNormals[c],h.copy(f.normal),i.a.copy(f.vertexNormals[0]),i.b.copy(f.vertexNormals[1]),i.c.copy(f.vertexNormals[2])}for(c=0,e=this.faces.length;c<e;c++)f=this.faces[c],f.normal=f.__originalFaceNormal,f.vertexNormals=f.__originalVertexNormals},computeTangents:function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){for(var a=0,b=this.vertices,c=0,d=b.length;c<d;c++)c>0&&(a+=b[c].distanceTo(b[c-1])),this.lineDistances[c]=a},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new d.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new d.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(a,b,c){if(a instanceof d.Geometry==!1)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",a);var e,f=this.vertices.length,g=this.vertices,h=a.vertices,i=this.faces,j=a.faces,k=this.faceVertexUvs[0],l=a.faceVertexUvs[0];void 0===c&&(c=0),void 0!==b&&(e=(new d.Matrix3).getNormalMatrix(b));for(var m=0,n=h.length;m<n;m++){var o=h[m],p=o.clone();void 0!==b&&p.applyMatrix4(b),g.push(p)}for(m=0,n=j.length;m<n;m++){var q,r,s,t=j[m],u=t.vertexNormals,v=t.vertexColors;q=new d.Face3(t.a+f,t.b+f,t.c+f),q.normal.copy(t.normal),void 0!==e&&q.normal.applyMatrix3(e).normalize();for(var w=0,x=u.length;w<x;w++)r=u[w].clone(),void 0!==e&&r.applyMatrix3(e).normalize(),q.vertexNormals.push(r);q.color.copy(t.color);for(var w=0,x=v.length;w<x;w++)s=v[w],q.vertexColors.push(s.clone());q.materialIndex=t.materialIndex+c,i.push(q)}for(m=0,n=l.length;m<n;m++){var y=l[m],z=[];if(void 0!==y){for(var w=0,x=y.length;w<x;w++)z.push(y[w].clone());k.push(z)}}},mergeMesh:function(a){if(a instanceof d.Mesh==!1)return void console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",a);a.matrixAutoUpdate&&a.updateMatrix(),this.merge(a.geometry,a.matrix)},mergeVertices:function(){var a,b,c,d,e,f,g,h,i={},j=[],k=[],l=Math.pow(10,4);for(c=0,d=this.vertices.length;c<d;c++)a=this.vertices[c],b=Math.round(a.x*l)+"_"+Math.round(a.y*l)+"_"+Math.round(a.z*l),void 0===i[b]?(i[b]=c,j.push(this.vertices[c]),k[c]=j.length-1):k[c]=k[i[b]];var m=[];for(c=0,d=this.faces.length;c<d;c++){e=this.faces[c],e.a=k[e.a],e.b=k[e.b],e.c=k[e.c],f=[e.a,e.b,e.c];for(var n=0;n<3;n++)if(f[n]===f[(n+1)%3]){n,m.push(c);break}}for(c=m.length-1;c>=0;c--){var o=m[c];for(this.faces.splice(o,1),g=0,h=this.faceVertexUvs.length;g<h;g++)this.faceVertexUvs[g].splice(o,1)}var p=this.vertices.length-j.length;return this.vertices=j,p},sortFacesByMaterialIndex:function(){function a(a,b){return a.materialIndex-b.materialIndex}for(var b=this.faces,c=b.length,d=0;d<c;d++)b[d]._id=d;b.sort(a);var e,f,g=this.faceVertexUvs[0],h=this.faceVertexUvs[1];g&&g.length===c&&(e=[]),h&&h.length===c&&(f=[]);for(var d=0;d<c;d++){var i=b[d]._id;e&&e.push(g[i]),f&&f.push(h[i])}e&&(this.faceVertexUvs[0]=e),f&&(this.faceVertexUvs[1]=f)},toJSON:function(){function a(a,b,c){return c?a|1<<b:a&~(1<<b)}function b(a){var b=a.x.toString()+a.y.toString()+a.z.toString();return void 0!==m[b]?m[b]:(m[b]=l.length/3,l.push(a.x,a.y,a.z),m[b])}function c(a){var b=a.r.toString()+a.g.toString()+a.b.toString();return void 0!==o[b]?o[b]:(o[b]=n.length,n.push(a.getHex()),o[b])}function d(a){var b=a.x.toString()+a.y.toString();return void 0!==q[b]?q[b]:(q[b]=p.length/2,p.push(a.x,a.y),q[b])}var e={metadata:{version:4.4,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var f=this.parameters;for(var g in f)void 0!==f[g]&&(e[g]=f[g]);return e}for(var h=[],i=0;i<this.vertices.length;i++){var j=this.vertices[i];h.push(j.x,j.y,j.z)}for(var k=[],l=[],m={},n=[],o={},p=[],q={},i=0;i<this.faces.length;i++){var r=this.faces[i],s=void 0!==this.faceVertexUvs[0][i],t=r.normal.length()>0,u=r.vertexNormals.length>0,v=1!==r.color.r||1!==r.color.g||1!==r.color.b,w=r.vertexColors.length>0,x=0;if(x=a(x,0,0),x=a(x,1,!0),x=a(x,2,!1),x=a(x,3,s),x=a(x,4,t),x=a(x,5,u),x=a(x,6,v),x=a(x,7,w),k.push(x),k.push(r.a,r.b,r.c),k.push(r.materialIndex),s){var y=this.faceVertexUvs[0][i];k.push(d(y[0]),d(y[1]),d(y[2]))}if(t&&k.push(b(r.normal)),u){var z=r.vertexNormals;k.push(b(z[0]),b(z[1]),b(z[2]))}if(v&&k.push(c(r.color)),w){var A=r.vertexColors;k.push(c(A[0]),c(A[1]),c(A[2]))}}return e.data={},e.data.vertices=h,e.data.normals=l,n.length>0&&(e.data.colors=n),p.length>0&&(e.data.uvs=[p]),e.data.faces=k,e},clone:function(){return(new d.Geometry).copy(this)},copy:function(a){this.vertices=[],this.faces=[],this.faceVertexUvs=[[]];for(var b=a.vertices,c=0,d=b.length;c<d;c++)this.vertices.push(b[c].clone());for(var e=a.faces,c=0,d=e.length;c<d;c++)this.faces.push(e[c].clone());for(var c=0,d=a.faceVertexUvs.length;c<d;c++){var f=a.faceVertexUvs[c];void 0===this.faceVertexUvs[c]&&(this.faceVertexUvs[c]=[]);for(var g=0,h=f.length;g<h;g++){for(var i=f[g],j=[],k=0,l=i.length;k<l;k++){var m=i[k];j.push(m.clone())}this.faceVertexUvs[c].push(j)}}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},d.EventDispatcher.prototype.apply(d.Geometry.prototype),d.GeometryIdCount=0,d.DirectGeometry=function(){Object.defineProperty(this,"id",{value:d.GeometryIdCount++}),this.uuid=d.Math.generateUUID(),this.name="",this.type="DirectGeometry",this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1},d.DirectGeometry.prototype={constructor:d.DirectGeometry,computeBoundingBox:d.Geometry.prototype.computeBoundingBox,computeBoundingSphere:d.Geometry.prototype.computeBoundingSphere,computeFaceNormals:function(){console.warn("THREE.DirectGeometry: computeFaceNormals() is not a method of this type of geometry.")},computeVertexNormals:function(){console.warn("THREE.DirectGeometry: computeVertexNormals() is not a method of this type of geometry.")},computeGroups:function(a){for(var b,c,d=[],e=a.faces,f=0;f<e.length;f++){var g=e[f];g.materialIndex!==c&&(c=g.materialIndex,void 0!==b&&(b.count=3*f-b.start,d.push(b)),b={start:3*f,materialIndex:c})}void 0!==b&&(b.count=3*f-b.start,d.push(b)),this.groups=d},fromGeometry:function(a){var b,c=a.faces,e=a.vertices,f=a.faceVertexUvs,g=f[0]&&f[0].length>0,h=f[1]&&f[1].length>0,i=a.morphTargets,j=i.length;if(j>0){b=[];for(var k=0;k<j;k++)b[k]=[];this.morphTargets.position=b}var l,m=a.morphNormals,n=m.length;if(n>0){l=[];for(var k=0;k<n;k++)l[k]=[];this.morphTargets.normal=l}for(var o=a.skinIndices,p=a.skinWeights,q=o.length===e.length,r=p.length===e.length,k=0;k<c.length;k++){var s=c[k];this.vertices.push(e[s.a],e[s.b],e[s.c]);var t=s.vertexNormals;if(3===t.length)this.normals.push(t[0],t[1],t[2]);else{var u=s.normal;this.normals.push(u,u,u)}var v=s.vertexColors;if(3===v.length)this.colors.push(v[0],v[1],v[2]);else{var w=s.color;this.colors.push(w,w,w)}if(!0===g){var x=f[0][k];void 0!==x?this.uvs.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",k),this.uvs.push(new d.Vector2,new d.Vector2,new d.Vector2))}if(!0===h){var x=f[1][k];void 0!==x?this.uvs2.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",k),this.uvs2.push(new d.Vector2,new d.Vector2,new d.Vector2))}for(var y=0;y<j;y++){var z=i[y].vertices;b[y].push(z[s.a],z[s.b],z[s.c])}for(var y=0;y<n;y++){var A=m[y].vertexNormals[k];l[y].push(A.a,A.b,A.c)}q&&this.skinIndices.push(o[s.a],o[s.b],o[s.c]),r&&this.skinWeights.push(p[s.a],p[s.b],p[s.c])}return this.computeGroups(a),this.verticesNeedUpdate=a.verticesNeedUpdate,this.normalsNeedUpdate=a.normalsNeedUpdate,this.colorsNeedUpdate=a.colorsNeedUpdate,this.uvsNeedUpdate=a.uvsNeedUpdate,this.groupsNeedUpdate=a.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},d.EventDispatcher.prototype.apply(d.DirectGeometry.prototype),d.BufferGeometry=function(){Object.defineProperty(this,"id",{value:d.GeometryIdCount++}),this.uuid=d.Math.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}},d.BufferGeometry.prototype={constructor:d.BufferGeometry,getIndex:function(){return this.index},setIndex:function(a){this.index=a},addAttribute:function(a,b){return b instanceof d.BufferAttribute==!1&&b instanceof d.InterleavedBufferAttribute==!1?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(a,new d.BufferAttribute(arguments[1],arguments[2]))):"index"===a?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(b)):(this.attributes[a]=b,this)},getAttribute:function(a){return this.attributes[a]},removeAttribute:function(a){return delete this.attributes[a],this},addGroup:function(a,b,c){this.groups.push({start:a,count:b,materialIndex:void 0!==c?c:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(a,b){this.drawRange.start=a,this.drawRange.count=b},applyMatrix:function(a){var b=this.attributes.position;void 0!==b&&(a.applyToVector3Array(b.array),b.needsUpdate=!0);var c=this.attributes.normal;if(void 0!==c){(new d.Matrix3).getNormalMatrix(a).applyToVector3Array(c.array),c.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var a;return function(b){return void 0===a&&(a=new d.Matrix4),a.makeRotationX(b),this.applyMatrix(a),this}}(),rotateY:function(){var a;return function(b){return void 0===a&&(a=new d.Matrix4),a.makeRotationY(b),this.applyMatrix(a),this}}(),rotateZ:function(){var a;return function(b){return void 0===a&&(a=new d.Matrix4),a.makeRotationZ(b),this.applyMatrix(a),this}}(),translate:function(){var a;return function(b,c,e){return void 0===a&&(a=new d.Matrix4),a.makeTranslation(b,c,e),this.applyMatrix(a),this}}(),scale:function(){var a;return function(b,c,e){return void 0===a&&(a=new d.Matrix4),a.makeScale(b,c,e),this.applyMatrix(a),this}}(),lookAt:function(){var a;return function(b){void 0===a&&(a=new d.Object3D),a.lookAt(b),a.updateMatrix(),this.applyMatrix(a.matrix)}}(),center:function(){this.computeBoundingBox();var a=this.boundingBox.center().negate();return this.translate(a.x,a.y,a.z),a},setFromObject:function(a){var b=a.geometry;if(a instanceof d.Points||a instanceof d.Line){var c=new d.Float32Attribute(3*b.vertices.length,3),e=new d.Float32Attribute(3*b.colors.length,3);if(this.addAttribute("position",c.copyVector3sArray(b.vertices)),this.addAttribute("color",e.copyColorsArray(b.colors)),b.lineDistances&&b.lineDistances.length===b.vertices.length){var f=new d.Float32Attribute(b.lineDistances.length,1);this.addAttribute("lineDistance",f.copyArray(b.lineDistances))}null!==b.boundingSphere&&(this.boundingSphere=b.boundingSphere.clone()),null!==b.boundingBox&&(this.boundingBox=b.boundingBox.clone())}else a instanceof d.Mesh&&b instanceof d.Geometry&&this.fromGeometry(b);return this},updateFromObject:function(a){var b=a.geometry;if(a instanceof d.Mesh){var c=b.__directGeometry;if(void 0===c)return this.fromGeometry(b);c.verticesNeedUpdate=b.verticesNeedUpdate,c.normalsNeedUpdate=b.normalsNeedUpdate,c.colorsNeedUpdate=b.colorsNeedUpdate,c.uvsNeedUpdate=b.uvsNeedUpdate,c.groupsNeedUpdate=b.groupsNeedUpdate,b.verticesNeedUpdate=!1,b.normalsNeedUpdate=!1,b.colorsNeedUpdate=!1,b.uvsNeedUpdate=!1,b.groupsNeedUpdate=!1,b=c}if(!0===b.verticesNeedUpdate){var e=this.attributes.position;void 0!==e&&(e.copyVector3sArray(b.vertices),e.needsUpdate=!0),b.verticesNeedUpdate=!1}if(!0===b.normalsNeedUpdate){var e=this.attributes.normal;void 0!==e&&(e.copyVector3sArray(b.normals),e.needsUpdate=!0),b.normalsNeedUpdate=!1}if(!0===b.colorsNeedUpdate){var e=this.attributes.color;void 0!==e&&(e.copyColorsArray(b.colors),e.needsUpdate=!0),b.colorsNeedUpdate=!1}if(b.uvsNeedUpdate){var e=this.attributes.uv;void 0!==e&&(e.copyVector2sArray(b.uvs),e.needsUpdate=!0),b.uvsNeedUpdate=!1}if(b.lineDistancesNeedUpdate){var e=this.attributes.lineDistance;void 0!==e&&(e.copyArray(b.lineDistances),e.needsUpdate=!0),b.lineDistancesNeedUpdate=!1}return b.groupsNeedUpdate&&(b.computeGroups(a.geometry),this.groups=b.groups,b.groupsNeedUpdate=!1),this},fromGeometry:function(a){return a.__directGeometry=(new d.DirectGeometry).fromGeometry(a),this.fromDirectGeometry(a.__directGeometry)},fromDirectGeometry:function(a){var b=new Float32Array(3*a.vertices.length);if(this.addAttribute("position",new d.BufferAttribute(b,3).copyVector3sArray(a.vertices)),a.normals.length>0){var c=new Float32Array(3*a.normals.length);this.addAttribute("normal",new d.BufferAttribute(c,3).copyVector3sArray(a.normals))}if(a.colors.length>0){var e=new Float32Array(3*a.colors.length);this.addAttribute("color",new d.BufferAttribute(e,3).copyColorsArray(a.colors))}if(a.uvs.length>0){var f=new Float32Array(2*a.uvs.length);this.addAttribute("uv",new d.BufferAttribute(f,2).copyVector2sArray(a.uvs))}if(a.uvs2.length>0){var g=new Float32Array(2*a.uvs2.length);this.addAttribute("uv2",new d.BufferAttribute(g,2).copyVector2sArray(a.uvs2))}if(a.indices.length>0){var h=a.vertices.length>65535?Uint32Array:Uint16Array,i=new h(3*a.indices.length);this.setIndex(new d.BufferAttribute(i,1).copyIndicesArray(a.indices))}this.groups=a.groups;for(var j in a.morphTargets){for(var k=[],l=a.morphTargets[j],m=0,n=l.length;m<n;m++){var o=l[m],p=new d.Float32Attribute(3*o.length,3);k.push(p.copyVector3sArray(o))}this.morphAttributes[j]=k}if(a.skinIndices.length>0){var q=new d.Float32Attribute(4*a.skinIndices.length,4);this.addAttribute("skinIndex",q.copyVector4sArray(a.skinIndices))}if(a.skinWeights.length>0){var r=new d.Float32Attribute(4*a.skinWeights.length,4);this.addAttribute("skinWeight",r.copyVector4sArray(a.skinWeights))}return null!==a.boundingSphere&&(this.boundingSphere=a.boundingSphere.clone()),null!==a.boundingBox&&(this.boundingBox=a.boundingBox.clone()),this},computeBoundingBox:function(){new d.Vector3;return function(){null===this.boundingBox&&(this.boundingBox=new d.Box3);var a=this.attributes.position.array;a&&this.boundingBox.setFromArray(a),void 0!==a&&0!==a.length||(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}}(),computeBoundingSphere:function(){var a=new d.Box3,b=new d.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new d.Sphere);var c=this.attributes.position.array;if(c){var e=this.boundingSphere.center;a.setFromArray(c),a.center(e);for(var f=0,g=0,h=c.length;g<h;g+=3)b.fromArray(c,g),f=Math.max(f,e.distanceToSquared(b));this.boundingSphere.radius=Math.sqrt(f),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var a=this.index,b=this.attributes,c=this.groups;if(b.position){var e=b.position.array;if(void 0===b.normal)this.addAttribute("normal",new d.BufferAttribute(new Float32Array(e.length),3));else for(var f=b.normal.array,g=0,h=f.length;g<h;g++)f[g]=0;var i,j,k,l=b.normal.array,m=new d.Vector3,n=new d.Vector3,o=new d.Vector3,p=new d.Vector3,q=new d.Vector3;if(a){var r=a.array;0===c.length&&this.addGroup(0,r.length);for(var s=0,t=c.length;s<t;++s)for(var u=c[s],v=u.start,w=u.count,g=v,h=v+w;g<h;g+=3)i=3*r[g+0],j=3*r[g+1],k=3*r[g+2],m.fromArray(e,i),n.fromArray(e,j),o.fromArray(e,k),p.subVectors(o,n),q.subVectors(m,n),p.cross(q),l[i]+=p.x,l[i+1]+=p.y,l[i+2]+=p.z,l[j]+=p.x,l[j+1]+=p.y,l[j+2]+=p.z,l[k]+=p.x,l[k+1]+=p.y,l[k+2]+=p.z}else for(var g=0,h=e.length;g<h;g+=9)m.fromArray(e,g),n.fromArray(e,g+3),o.fromArray(e,g+6),p.subVectors(o,n),q.subVectors(m,n),p.cross(q),l[g]=p.x,l[g+1]=p.y,l[g+2]=p.z,l[g+3]=p.x,l[g+4]=p.y,l[g+5]=p.z,l[g+6]=p.x,l[g+7]=p.y,l[g+8]=p.z;this.normalizeNormals(),b.normal.needsUpdate=!0}},merge:function(a,b){if(a instanceof d.BufferGeometry==!1)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",a);void 0===b&&(b=0);var c=this.attributes;for(var e in c)if(void 0!==a.attributes[e])for(var f=c[e],g=f.array,h=a.attributes[e],i=h.array,j=h.itemSize,k=0,l=j*b;k<i.length;k++,l++)g[l]=i[k];return this},normalizeNormals:function(){for(var a,b,c,d,e=this.attributes.normal.array,f=0,g=e.length;f<g;f+=3)a=e[f],b=e[f+1],c=e[f+2],d=1/Math.sqrt(a*a+b*b+c*c),e[f]*=d,e[f+1]*=d,e[f+2]*=d},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var a=new d.BufferGeometry,b=this.index.array,c=this.attributes;for(var e in c){for(var f=c[e],g=f.array,h=f.itemSize,i=new g.constructor(b.length*h),j=0,k=0,l=0,m=b.length;l<m;l++){j=b[l]*h;for(var n=0;n<h;n++)i[k++]=g[j++]}a.addAttribute(e,new d.BufferAttribute(i,h))}return a},toJSON:function(){var a={metadata:{version:4.4,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(a.uuid=this.uuid,a.type=this.type,""!==this.name&&(a.name=this.name),void 0!==this.parameters){var b=this.parameters;for(var c in b)void 0!==b[c]&&(a[c]=b[c]);return a}a.data={attributes:{}};var d=this.index;if(null!==d){var e=Array.prototype.slice.call(d.array);a.data.index={type:d.array.constructor.name,array:e}}var f=this.attributes;for(var c in f){var g=f[c],e=Array.prototype.slice.call(g.array);a.data.attributes[c]={itemSize:g.itemSize,type:g.array.constructor.name,array:e}}var h=this.groups;h.length>0&&(a.data.groups=JSON.parse(JSON.stringify(h)));var i=this.boundingSphere;return null!==i&&(a.data.boundingSphere={center:i.center.toArray(),radius:i.radius}),a},clone:function(){return(new d.BufferGeometry).copy(this)},copy:function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var c=a.attributes;for(var d in c){var e=c[d];this.addAttribute(d,e.clone())}for(var f=a.groups,g=0,h=f.length;g<h;g++){var i=f[g];this.addGroup(i.start,i.count)}return this},dispose:function(){this.dispatchEvent({type:"dispose"})}},d.EventDispatcher.prototype.apply(d.BufferGeometry.prototype),d.BufferGeometry.MaxIndex=65535,d.InstancedBufferGeometry=function(){d.BufferGeometry.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0},d.InstancedBufferGeometry.prototype=Object.create(d.BufferGeometry.prototype),d.InstancedBufferGeometry.prototype.constructor=d.InstancedBufferGeometry,d.InstancedBufferGeometry.prototype.addGroup=function(a,b,c){this.groups.push({start:a,count:b,instances:c})},d.InstancedBufferGeometry.prototype.copy=function(a){var b=a.index;null!==b&&this.setIndex(b.clone());var c=a.attributes;for(var d in c){var e=c[d];this.addAttribute(d,e.clone())}for(var f=a.groups,g=0,h=f.length;g<h;g++){var i=f[g];this.addGroup(i.start,i.count,i.instances)}return this},d.EventDispatcher.prototype.apply(d.InstancedBufferGeometry.prototype),d.Uniform=function(a,b){this.type=a,this.value=b,this.dynamic=!1},d.Uniform.prototype={constructor:d.Uniform,onUpdate:function(a){return this.dynamic=!0,this.onUpdateCallback=a,this}},d.AnimationClip=function(a,b,c){this.name=a||d.Math.generateUUID(),this.tracks=c,this.duration=void 0!==b?b:-1,this.duration<0&&this.resetDuration(),this.trim(),this.optimize()},d.AnimationClip.prototype={constructor:d.AnimationClip,resetDuration:function(){for(var a=this.tracks,b=0,c=0,d=a.length;c!==d;++c){var e=this.tracks[c];b=Math.max(b,e.times[e.times.length-1])}this.duration=b},trim:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].trim(0,this.duration);return this},optimize:function(){for(var a=0;a<this.tracks.length;a++)this.tracks[a].optimize();return this}},Object.assign(d.AnimationClip,{parse:function(a){for(var b=[],c=a.tracks,e=1/(a.fps||1),f=0,g=c.length;f!==g;++f)b.push(d.KeyframeTrack.parse(c[f]).scale(e));return new d.AnimationClip(a.name,a.duration,b)},toJSON:function(a){for(var b=[],c=a.tracks,e={name:a.name,duration:a.duration,tracks:b},f=0,g=c.length;f!==g;++f)b.push(d.KeyframeTrack.toJSON(c[f]));return e},CreateFromMorphTargetSequence:function(a,b,c){for(var e=b.length,f=[],g=0;g<e;g++){var h=[],i=[];h.push((g+e-1)%e,g,(g+1)%e),i.push(0,1,0);var j=d.AnimationUtils.getKeyframeOrder(h);h=d.AnimationUtils.sortedArray(h,1,j),i=d.AnimationUtils.sortedArray(i,1,j),0===h[0]&&(h.push(e),i.push(i[0])),f.push(new d.NumberKeyframeTrack(".morphTargetInfluences["+b[g].name+"]",h,i).scale(1/c))}return new d.AnimationClip(a,-1,f)},findByName:function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return a[c];return null},CreateClipsFromMorphTargetSequences:function(a,b){for(var c={},e=/^([\w-]*?)([\d]+)$/,f=0,g=a.length;f<g;f++){var h=a[f],i=h.name.match(e);if(i&&i.length>1){var j=i[1],k=c[j];k||(c[j]=k=[]),k.push(h)}}var l=[];for(var j in c)l.push(d.AnimationClip.CreateFromMorphTargetSequence(j,c[j],b));return l},parseAnimation:function(a,b,c){if(!a)return console.error("  no animation in JSONLoader data"),null;for(var e=function(a,b,c,e,f){if(0!==c.length){var g=[],h=[];d.AnimationUtils.flattenJSON(c,g,h,e),0!==g.length&&f.push(new a(b,g,h))}},f=[],g=a.name||"default",h=a.length||-1,i=a.fps||30,j=a.hierarchy||[],k=0;k<j.length;k++){var l=j[k].keys;if(l&&0!=l.length)if(l[0].morphTargets){for(var m={},n=0;n<l.length;n++)if(l[n].morphTargets)for(var o=0;o<l[n].morphTargets.length;o++)m[l[n].morphTargets[o]]=-1;for(var p in m){for(var q=[],r=[],o=0;o!==l[n].morphTargets.length;++o){var s=l[n];q.push(s.time),r.push(s.morphTarget===p?1:0)}f.push(new d.NumberKeyframeTrack(".morphTargetInfluence["+p+"]",q,r))}h=m.length*(i||1)}else{var t=".bones["+b[k].name+"]";e(d.VectorKeyframeTrack,t+".position",l,"pos",f),e(d.QuaternionKeyframeTrack,t+".quaternion",l,"rot",f),e(d.VectorKeyframeTrack,t+".scale",l,"scl",f)}}return 0===f.length?null:new d.AnimationClip(g,h,f)}}),d.AnimationMixer=function(a){this._root=a,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1},d.AnimationMixer.prototype={constructor:d.AnimationMixer,clipAction:function(a,b){var c,e=b||this._root,f=e.uuid,g="string"==typeof a?a:a.name,h=a!==g?a:null,i=this._actionsByClip[g];if(void 0!==i){var j=i.actionByRoot[f];if(void 0!==j)return j;if(c=i.knownActions[0],h=c._clip,a!==g&&a!==h)throw new Error("Different clips with the same name detected!")}if(null===h)return null;var k=new d.AnimationMixer._Action(this,h,b);return this._bindAction(k,c),this._addInactiveAction(k,g,f),k},existingAction:function(a,b){var c=b||this._root,d=c.uuid,e="string"==typeof a?a:a.name,f=this._actionsByClip[e];return void 0!==f?f.actionByRoot[d]||null:null},stopAllAction:function(){var a=this._actions,b=this._nActiveActions,c=this._bindings,d=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var e=0;e!==b;++e)a[e].reset();for(var e=0;e!==d;++e)c[e].useCount=0;return this},update:function(a){a*=this.timeScale;for(var b=this._actions,c=this._nActiveActions,d=this.time+=a,e=Math.sign(a),f=this._accuIndex^=1,g=0;g!==c;++g){var h=b[g];h.enabled&&h._update(d,a,e,f)}for(var i=this._bindings,j=this._nActiveBindings,g=0;g!==j;++g)i[g].apply(f);return this},getRoot:function(){return this._root},uncacheClip:function(a){var b=this._actions,c=a.name,d=this._actionsByClip,e=d[c];if(void 0!==e){for(var f=e.knownActions,g=0,h=f.length;g!==h;++g){var i=f[g];this._deactivateAction(i);var j=i._cacheIndex,k=b[b.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,k._cacheIndex=j,b[j]=k,b.pop(),this._removeInactiveBindingsForAction(i)}delete d[c]}},uncacheRoot:function(a){var b=a.uuid,c=this._actionsByClip;for(var d in c){var e=c[d].actionByRoot,f=e[b];void 0!==f&&(this._deactivateAction(f),this._removeInactiveAction(f))}var g=this._bindingsByRootAndName,h=g[b];if(void 0!==h)for(var i in h){var j=h[i];j.restoreOriginalState(),this._removeInactiveBinding(j)}},uncacheAction:function(a,b){var c=this.existingAction(a,b);null!==c&&(this._deactivateAction(c),this._removeInactiveAction(c))}},d.EventDispatcher.prototype.apply(d.AnimationMixer.prototype),d.AnimationMixer._Action=function(a,b,c){this._mixer=a,this._clip=b,this._localRoot=c||null;for(var e=b.tracks,f=e.length,g=new Array(f),h={endingStart:d.ZeroCurvatureEnding,endingEnd:d.ZeroCurvatureEnding},i=0;i!==f;++i){var j=e[i].createInterpolant(null);g[i]=j,j.settings=h}this._interpolantSettings=h,this._interpolants=g,this._propertyBindings=new Array(f),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=d.LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0},d.AnimationMixer._Action.prototype={constructor:d.AnimationMixer._Action,play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){this._startTime;return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(a){return this._startTime=a,this},setLoop:function(a,b){return this.loop=a,this.repetitions=b,this},setEffectiveWeight:function(a){return this.weight=a,this._effectiveWeight=this.enabled?a:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(a){return this._scheduleFading(a,0,1)},fadeOut:function(a){return this._scheduleFading(a,1,0)},crossFadeFrom:function(a,b,c){this._mixer;if(a.fadeOut(b),this.fadeIn(b),c){var d=this._clip.duration,e=a._clip.duration,f=e/d,g=d/e;a.warp(1,f,b),this.warp(g,1,b)}return this},crossFadeTo:function(a,b,c){return a.crossFadeFrom(this,b,c)},stopFading:function(){var a=this._weightInterpolant;return null!==a&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(a)),this},setEffectiveTimeScale:function(a){return this.timeScale=a,this._effectiveTimeScale=this.paused?0:a,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(a){return this.timeScale=this._clip.duration/a,this.stopWarping()},syncWith:function(a){return this.time=a.time,this.timeScale=a.timeScale,this.stopWarping()},halt:function(a){return this.warp(this._currentTimeScale,0,a)},warp:function(a,b,c){var d=this._mixer,e=d.time,f=this._timeScaleInterpolant,g=this.timeScale;null===f&&(f=d._lendControlInterpolant(),this._timeScaleInterpolant=f);var h=f.parameterPositions,i=f.sampleValues;return h[0]=e,h[1]=e+c,i[0]=a/g,i[1]=b/g,this},stopWarping:function(){var a=this._timeScaleInterpolant;return null!==a&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(a)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(a,b,c,d){var e=this._startTime;if(null!==e){var f=(a-e)*c;if(f<0||0===c)return;this._startTime=null,b=c*f}b*=this._updateTimeScale(a);var g=this._updateTime(b),h=this._updateWeight(a);if(h>0)for(var i=this._interpolants,j=this._propertyBindings,k=0,l=i.length;k!==l;++k)i[k].evaluate(g),j[k].accumulate(d,h)},_updateWeight:function(a){var b=0;if(this.enabled){b=this.weight;var c=this._weightInterpolant;if(null!==c){var d=c.evaluate(a)[0];b*=d,a>c.parameterPositions[1]&&(this.stopFading(),0===d&&(this.enabled=!1))}}return this._effectiveWeight=b,b},_updateTimeScale:function(a){var b=0;if(!this.paused){b=this.timeScale;var c=this._timeScaleInterpolant;if(null!==c){b*=c.evaluate(a)[0],a>c.parameterPositions[1]&&(this.stopWarping(),0===b?this.pause=!0:this.timeScale=b)}}return this._effectiveTimeScale=b,b},_updateTime:function(a){var b=this.time+a;if(0===a)return b;var c=this._clip.duration,e=this.loop,f=this._loopCount,g=!1;switch(e){case d.LoopOnce:if(-1===f&&(this.loopCount=0,this._setEndings(!0,!0,!1)),b>=c)b=c;else{if(!(b<0))break;b=0}this.clampWhenFinished?this.pause=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:a<0?-1:1});break;case d.LoopPingPong:g=!0;case d.LoopRepeat:if(-1===f&&(a>0?(f=0,this._setEndings(!0,0===this.repetitions,g)):this._setEndings(0===this.repetitions,!0,g)),b>=c||b<0){var h=Math.floor(b/c);b-=c*h,f+=Math.abs(h);var i=this.repetitions-f;if(i<0){this.clampWhenFinished?this.paused=!0:this.enabled=!1,b=a>0?c:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:a>0?1:-1});break}if(0===i){var j=a<0;this._setEndings(j,!j,g)}else this._setEndings(!1,!1,g);this._loopCount=f,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:h})}if(e===d.LoopPingPong&&1==(1&f))return this.time=b,c-b}return this.time=b,b},_setEndings:function(a,b,c){var e=this._interpolantSettings;c?(e.endingStart=d.ZeroSlopeEnding,e.endingEnd=d.ZeroSlopeEnding):(e.endingStart=a?this.zeroSlopeAtStart?d.ZeroSlopeEnding:d.ZeroCurvatureEnding:d.WrapAroundEnding,e.endingEnd=b?this.zeroSlopeAtEnd?d.ZeroSlopeEnding:d.ZeroCurvatureEnding:d.WrapAroundEnding)},_scheduleFading:function(a,b,c){var d=this._mixer,e=d.time,f=this._weightInterpolant;null===f&&(f=d._lendControlInterpolant(),this._weightInterpolant=f);var g=f.parameterPositions,h=f.sampleValues;return g[0]=e,h[0]=b,g[1]=e+a,h[1]=c,this}},Object.assign(d.AnimationMixer.prototype,{_bindAction:function(a,b){var c=a._localRoot||this._root,e=a._clip.tracks,f=e.length,g=a._propertyBindings,h=a._interpolants,i=c.uuid,j=this._bindingsByRootAndName,k=j[i];void 0===k&&(k={},j[i]=k);for(var l=0;l!==f;++l){var m=e[l],n=m.name,o=k[n];if(void 0!==o)g[l]=o;else{if(void 0!==(o=g[l])){null===o._cacheIndex&&(++o.referenceCount,this._addInactiveBinding(o,i,n));continue}
var p=b&&b._propertyBindings[l].binding.parsedPath;o=new d.PropertyMixer(d.PropertyBinding.create(c,n,p),m.ValueTypeName,m.getValueSize()),++o.referenceCount,this._addInactiveBinding(o,i,n),g[l]=o}h[l].resultBuffer=o.buffer}},_activateAction:function(a){if(!this._isActiveAction(a)){if(null===a._cacheIndex){var b=(a._localRoot||this._root).uuid,c=a._clip.name,d=this._actionsByClip[c];this._bindAction(a,d&&d.knownActions[0]),this._addInactiveAction(a,c,b)}for(var e=a._propertyBindings,f=0,g=e.length;f!==g;++f){var h=e[f];0==h.useCount++&&(this._lendBinding(h),h.saveOriginalState())}this._lendAction(a)}},_deactivateAction:function(a){if(this._isActiveAction(a)){for(var b=a._propertyBindings,c=0,d=b.length;c!==d;++c){var e=b[c];0==--e.useCount&&(e.restoreOriginalState(),this._takeBackBinding(e))}this._takeBackAction(a)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var a=this;this.stats={actions:{get total(){return a._actions.length},get inUse(){return a._nActiveActions}},bindings:{get total(){return a._bindings.length},get inUse(){return a._nActiveBindings}},controlInterpolants:{get total(){return a._controlInterpolants.length},get inUse(){return a._nActiveControlInterpolants}}}},_isActiveAction:function(a){var b=a._cacheIndex;return null!==b&&b<this._nActiveActions},_addInactiveAction:function(a,b,c){var d=this._actions,e=this._actionsByClip,f=e[b];if(void 0===f)f={knownActions:[a],actionByRoot:{}},a._byClipCacheIndex=0,e[b]=f;else{var g=f.knownActions;a._byClipCacheIndex=g.length,g.push(a)}a._cacheIndex=d.length,d.push(a),f.actionByRoot[c]=a},_removeInactiveAction:function(a){var b=this._actions,c=b[b.length-1],d=a._cacheIndex;c._cacheIndex=d,b[d]=c,b.pop(),a._cacheIndex=null;var e=a._clip.name,f=this._actionsByClip,g=f[e],h=g.knownActions,i=h[h.length-1],j=a._byClipCacheIndex;i._byClipCacheIndex=j,h[j]=i,h.pop(),a._byClipCacheIndex=null,delete g.actionByRoot[(b._localRoot||this._root).uuid],0===h.length&&delete f[e],this._removeInactiveBindingsForAction(a)},_removeInactiveBindingsForAction:function(a){for(var b=a._propertyBindings,c=0,d=b.length;c!==d;++c){var e=b[c];0==--e.referenceCount&&this._removeInactiveBinding(e)}},_lendAction:function(a){var b=this._actions,c=a._cacheIndex,d=this._nActiveActions++,e=b[d];a._cacheIndex=d,b[d]=a,e._cacheIndex=c,b[c]=e},_takeBackAction:function(a){var b=this._actions,c=a._cacheIndex,d=--this._nActiveActions,e=b[d];a._cacheIndex=d,b[d]=a,e._cacheIndex=c,b[c]=e},_addInactiveBinding:function(a,b,c){var d=this._bindingsByRootAndName,e=d[b],f=this._bindings;void 0===e&&(e={},d[b]=e),e[c]=a,a._cacheIndex=f.length,f.push(a)},_removeInactiveBinding:function(a){var b=this._bindings,c=a.binding,d=c.rootNode.uuid,e=c.path,f=this._bindingsByRootAndName,g=f[d],h=b[b.length-1],i=a._cacheIndex;h._cacheIndex=i,b[i]=h,b.pop(),delete g[e];a:{for(var j in g)break a;delete f[d]}},_lendBinding:function(a){var b=this._bindings,c=a._cacheIndex,d=this._nActiveBindings++,e=b[d];a._cacheIndex=d,b[d]=a,e._cacheIndex=c,b[c]=e},_takeBackBinding:function(a){var b=this._bindings,c=a._cacheIndex,d=--this._nActiveBindings,e=b[d];a._cacheIndex=d,b[d]=a,e._cacheIndex=c,b[c]=e},_lendControlInterpolant:function(){var a=this._controlInterpolants,b=this._nActiveControlInterpolants++,c=a[b];return void 0===c&&(c=new d.LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),c.__cacheIndex=b,a[b]=c),c},_takeBackControlInterpolant:function(a){var b=this._controlInterpolants,c=a.__cacheIndex,d=--this._nActiveControlInterpolants,e=b[d];a.__cacheIndex=d,b[d]=a,e.__cacheIndex=c,b[c]=e},_controlInterpolantsResultBuffer:new Float32Array(1)}),d.AnimationObjectGroup=function(a){this.uuid=d.Math.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var b={};this._indicesByUUID=b;for(var c=0,e=arguments.length;c!==e;++c)b[arguments[c].uuid]=c;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var f=this;this.stats={objects:{get total(){return f._objects.length},get inUse(){return this.total-f.nCachedObjects_}},get bindingsPerObject(){return f._bindings.length}}},d.AnimationObjectGroup.prototype={constructor:d.AnimationObjectGroup,add:function(a){for(var b=this._objects,c=b.length,e=this.nCachedObjects_,f=this._indicesByUUID,g=this._paths,h=this._parsedPaths,i=this._bindings,j=i.length,k=0,l=arguments.length;k!==l;++k){var m=arguments[k],n=m.uuid,o=f[n];if(void 0===o){o=c++,f[n]=o,b.push(m);for(var p=0,q=j;p!==q;++p)i[p].push(new d.PropertyBinding(m,g[p],h[p]))}else if(o<e){var r=b[o],s=--e,t=b[s];f[t.uuid]=o,b[o]=t,f[n]=s,b[s]=m;for(var p=0,q=j;p!==q;++p){var u=i[p],v=u[s],w=u[o];u[o]=v,void 0===w&&(w=new d.PropertyBinding(m,g[p],h[p])),u[s]=w}}else b[o]!==r&&console.error("Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes...")}this.nCachedObjects_=e},remove:function(a){for(var b=this._objects,c=(b.length,this.nCachedObjects_),d=this._indicesByUUID,e=this._bindings,f=e.length,g=0,h=arguments.length;g!==h;++g){var i=arguments[g],j=i.uuid,k=d[j];if(void 0!==k&&k>=c){var l=c++,m=b[l];d[m.uuid]=k,b[k]=m,d[j]=l,b[l]=i;for(var n=0,o=f;n!==o;++n){var p=e[n],q=p[l],r=p[k];p[k]=q,p[l]=r}}}this.nCachedObjects_=c},uncache:function(a){for(var b=this._objects,c=b.length,d=this.nCachedObjects_,e=this._indicesByUUID,f=this._bindings,g=f.length,h=0,i=arguments.length;h!==i;++h){var j=arguments[h],k=j.uuid,l=e[k];if(void 0!==l)if(delete e[k],l<d){var m=--d,n=b[m],o=--c,p=b[o];e[n.uuid]=l,b[l]=n,e[p.uuid]=m,b[m]=p,b.pop();for(var q=0,r=g;q!==r;++q){var s=f[q],t=s[m],u=s[o];s[l]=t,s[m]=u,s.pop()}}else{var o=--c,p=b[o];e[p.uuid]=l,b[l]=p,b.pop();for(var q=0,r=g;q!==r;++q){var s=f[q];s[l]=s[o],s.pop()}}}this.nCachedObjects_=d},subscribe_:function(a,b){var c=this._bindingsIndicesByPath,e=c[a],f=this._bindings;if(void 0!==e)return f[e];var g=this._paths,h=this._parsedPaths,i=this._objects,j=i.length,k=this.nCachedObjects_,l=new Array(j);e=f.length,c[a]=e,g.push(a),h.push(b),f.push(l);for(var m=k,n=i.length;m!==n;++m){var o=i[m];l[m]=new d.PropertyBinding(o,a,b)}return l},unsubscribe_:function(a){var b=this._bindingsIndicesByPath,c=b[a];if(void 0!==c){var d=this._paths,e=this._parsedPaths,f=this._bindings,g=f.length-1,h=f[g];b[a[g]]=c,f[c]=h,f.pop(),e[c]=e[g],e.pop(),d[c]=d[g],d.pop()}}},d.AnimationUtils={arraySlice:function(a,b,c){return d.AnimationUtils.isTypedArray(a)?new a.constructor(a.subarray(b,c)):a.slice(b,c)},convertArray:function(a,b,c){return!a||!c&&a.constructor===b?a:"number"==typeof b.BYTES_PER_ELEMENT?new b(a):Array.prototype.slice.call(a)},isTypedArray:function(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)},getKeyframeOrder:function(a){function b(b,c){return a[b]-a[c]}for(var c=a.length,d=new Array(c),e=0;e!==c;++e)d[e]=e;return d.sort(b),d},sortedArray:function(a,b,c){for(var d=a.length,e=new a.constructor(d),f=0,g=0;g!==d;++f)for(var h=c[f]*b,i=0;i!==b;++i)e[g++]=a[h+i];return e},flattenJSON:function(a,b,c,d){for(var e=1,f=a[0];void 0!==f&&void 0===f[d];)f=a[e++];if(void 0!==f){var g=f[d];if(void 0!==g)if(Array.isArray(g))do{g=f[d],void 0!==g&&(b.push(f.time),c.push.apply(c,g)),f=a[e++]}while(void 0!==f);else if(void 0!==g.toArray)do{g=f[d],void 0!==g&&(b.push(f.time),g.toArray(c,c.length)),f=a[e++]}while(void 0!==f);else do{g=f[d],void 0!==g&&(b.push(f.time),c.push(g)),f=a[e++]}while(void 0!==f)}}},d.KeyframeTrack=function(a,b,c,e){if(void 0===a)throw new Error("track name is undefined");if(void 0===b||0===b.length)throw new Error("no keyframes in track named "+a);this.name=a,this.times=d.AnimationUtils.convertArray(b,this.TimeBufferType),this.values=d.AnimationUtils.convertArray(c,this.ValueBufferType),this.setInterpolation(e||this.DefaultInterpolation),this.validate(),this.optimize()},d.KeyframeTrack.prototype={constructor:d.KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:d.InterpolateLinear,InterpolantFactoryMethodDiscrete:function(a){return new d.DiscreteInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodLinear:function(a){return new d.LinearInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:function(a){return new d.CubicInterpolant(this.times,this.values,this.getValueSize(),a)},setInterpolation:function(a){var b=void 0;switch(a){case d.InterpolateDiscrete:b=this.InterpolantFactoryMethodDiscrete;break;case d.InterpolateLinear:b=this.InterpolantFactoryMethodLinear;break;case d.InterpolateSmooth:b=this.InterpolantFactoryMethodSmooth}if(void 0===b){var c="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(a===this.DefaultInterpolation)throw new Error(c);this.setInterpolation(this.DefaultInterpolation)}return void console.warn(c)}this.createInterpolant=b},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return d.InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return d.InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return d.InterpolateSmooth}},getValueSize:function(){return this.values.length/this.times.length},shift:function(a){if(0!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]+=a;return this},scale:function(a){if(1!==a)for(var b=this.times,c=0,d=b.length;c!==d;++c)b[c]*=a;return this},trim:function(a,b){for(var c=this.times,e=c.length,f=0,g=e-1;f!==e&&c[f]<a;)++f;for(;-1!==g&&c[g]>b;)--g;if(++g,0!==f||g!==e){f>=g&&(g=Math.max(g,1),f=g-1);var h=this.getValueSize();this.times=d.AnimationUtils.arraySlice(c,f,g),this.values=d.AnimationUtils.arraySlice(this.values,f*h,g*h)}return this},validate:function(){var a=!0,b=this.getValueSize();b-Math.floor(b)!=0&&(console.error("invalid value size in track",this),a=!1);var c=this.times,e=this.values,f=c.length;0===f&&(console.error("track is empty",this),a=!1);for(var g=null,h=0;h!==f;h++){var i=c[h];if("number"==typeof i&&isNaN(i)){console.error("time is not a valid number",this,h,i),a=!1;break}if(null!==g&&g>i){console.error("out of order keys",this,h,i,g),a=!1;break}g=i}if(void 0!==e&&d.AnimationUtils.isTypedArray(e))for(var h=0,j=e.length;h!==j;++h){var k=e[h];if(isNaN(k)){console.error("value is not a valid number",this,h,k),a=!1;break}}return a},optimize:function(){for(var a=this.times,b=this.values,c=this.getValueSize(),e=1,f=1,g=a.length-1;f<=g;++f){var h=!1,i=a[f];if(i!==a[f+1]&&(1!==f||i!==i[0]))for(var j=f*c,k=j-c,l=j+c,m=0;m!==c;++m){var n=b[j+m];if(n!==b[k+m]||n!==b[l+m]){h=!0;break}}if(h){if(f!==e){a[e]=a[f];for(var o=f*c,p=e*c,m=0;m!==c;++m)b[p+m]=b[o+m]}++e}}return e!==a.length&&(this.times=d.AnimationUtils.arraySlice(a,0,e),this.values=d.AnimationUtils.arraySlice(b,0,e*c)),this}},Object.assign(d.KeyframeTrack,{parse:function(a){if(void 0===a.type)throw new Error("track type undefined, can not parse");var b=d.KeyframeTrack._getTrackTypeForValueTypeName(a.type);if(void 0===a.times){console.warn("legacy JSON format detected, converting");var c=[],e=[];d.AnimationUtils.flattenJSON(a.keys,c,e,"value"),a.times=c,a.values=e}return void 0!==b.parse?b.parse(a):new b(a.name,a.times,a.values,a.interpolation)},toJSON:function(a){var b,c=a.constructor;if(void 0!==c.toJSON)b=c.toJSON(a);else{b={name:a.name,times:d.AnimationUtils.convertArray(a.times,Array),values:d.AnimationUtils.convertArray(a.values,Array)};var e=a.getInterpolation();e!==a.DefaultInterpolation&&(b.interpolation=e)}return b.type=a.ValueTypeName,b},_getTrackTypeForValueTypeName:function(a){switch(a.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return d.NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return d.VectorKeyframeTrack;case"color":return d.ColorKeyframeTrack;case"quaternion":return d.QuaternionKeyframeTrack;case"bool":case"boolean":return d.BooleanKeyframeTrack;case"string":return d.StringKeyframeTrack}throw new Error("Unsupported typeName: "+a)}}),d.PropertyBinding=function(a,b,c){this.path=b,this.parsedPath=c||d.PropertyBinding.parseTrackName(b),this.node=d.PropertyBinding.findNode(a,this.parsedPath.nodeName)||a,this.rootNode=a},d.PropertyBinding.prototype={constructor:d.PropertyBinding,getValue:function(a,b){this.bind(),this.getValue(a,b)},setValue:function(a,b){this.bind(),this.setValue(a,b)},bind:function(){var a=this.node,b=this.parsedPath,c=b.objectName,e=b.propertyName,f=b.propertyIndex;if(a||(a=d.PropertyBinding.findNode(this.rootNode,b.nodeName)||this.rootNode,this.node=a),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!a)return void console.error("  trying to update node for track: "+this.path+" but it wasn't found.");if(c){var g=b.objectIndex;switch(c){case"materials":if(!a.material)return void console.error("  can not bind to material as node does not have a material",this);if(!a.material.materials)return void console.error("  can not bind to material.materials as node.material does not have a materials array",this);a=a.material.materials;break;case"bones":if(!a.skeleton)return void console.error("  can not bind to bones as node does not have a skeleton",this);a=a.skeleton.bones;for(var h=0;h<a.length;h++)if(a[h].name===g){g=h;break}break;default:if(void 0===a[c])return void console.error("  can not bind to objectName of node, undefined",this);a=a[c]}if(void 0!==g){if(void 0===a[g])return void console.error("  trying to bind to objectIndex of objectName, but is undefined:",this,a);a=a[g]}}var i=a[e];if(!i){var j=b.nodeName;return void console.error("  trying to update property for track: "+j+"."+e+" but it wasn't found.",a)}var k=this.Versioning.None;void 0!==a.needsUpdate?(k=this.Versioning.NeedsUpdate,this.targetObject=a):void 0!==a.matrixWorldNeedsUpdate&&(k=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=a);var l=this.BindingType.Direct;if(void 0!==f){if("morphTargetInfluences"===e){if(!a.geometry)return void console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry",this);if(!a.geometry.morphTargets)return void console.error("  can not bind to morphTargetInfluences becasuse node does not have a geometry.morphTargets",this);for(var h=0;h<this.node.geometry.morphTargets.length;h++)if(a.geometry.morphTargets[h].name===f){f=h;break}}l=this.BindingType.ArrayElement,this.resolvedProperty=i,this.propertyIndex=f}else void 0!==i.fromArray&&void 0!==i.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=i):void 0!==i.length?(l=this.BindingType.EntireArray,this.resolvedProperty=i):this.propertyName=e;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][k]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}},Object.assign(d.PropertyBinding.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},_getValue_unbound:d.PropertyBinding.prototype.getValue,_setValue_unbound:d.PropertyBinding.prototype.setValue,BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(a,b){a[b]=this.node[this.propertyName]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)a[b++]=c[d]},function(a,b){a[b]=this.resolvedProperty[this.propertyIndex]},function(a,b){this.resolvedProperty.toArray(a,b)}],SetterByBindingTypeAndVersioning:[[function(a,b){this.node[this.propertyName]=a[b]},function(a,b){this.node[this.propertyName]=a[b],this.targetObject.needsUpdate=!0},function(a,b){this.node[this.propertyName]=a[b],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++]},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.needsUpdate=!0},function(a,b){for(var c=this.resolvedProperty,d=0,e=c.length;d!==e;++d)c[d]=a[b++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty[this.propertyIndex]=a[b]},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b],this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty[this.propertyIndex]=a[b],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(a,b){this.resolvedProperty.fromArray(a,b)},function(a,b){this.resolvedProperty.fromArray(a,b),this.targetObject.needsUpdate=!0},function(a,b){this.resolvedProperty.fromArray(a,b),this.targetObject.matrixWorldNeedsUpdate=!0}]]}),d.PropertyBinding.Composite=function(a,b,c){var e=c||d.PropertyBinding.parseTrackName(b);this._targetGroup=a,this._bindings=a.subscribe_(b,e)},d.PropertyBinding.Composite.prototype={constructor:d.PropertyBinding.Composite,getValue:function(a,b){this.bind();var c=this._targetGroup.nCachedObjects_,d=this._bindings[c];void 0!==d&&d.getValue(a,b)},setValue:function(a,b){for(var c=this._bindings,d=this._targetGroup.nCachedObjects_,e=c.length;d!==e;++d)c[d].setValue(a,b)},bind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].bind()},unbind:function(){for(var a=this._bindings,b=this._targetGroup.nCachedObjects_,c=a.length;b!==c;++b)a[b].unbind()}},d.PropertyBinding.create=function(a,b,c){return a instanceof d.AnimationObjectGroup?new d.PropertyBinding.Composite(a,b,c):new d.PropertyBinding(a,b,c)},d.PropertyBinding.parseTrackName=function(a){var b=/^(([\w]+\/)*)([\w-\d]+)?(\.([\w]+)(\[([\w\d\[\]\_.:\- ]+)\])?)?(\.([\w.]+)(\[([\w\d\[\]\_. ]+)\])?)$/,c=b.exec(a);if(!c)throw new Error("cannot parse trackName at all: "+a);c.index===b.lastIndex&&b.lastIndex++;var d={nodeName:c[3],objectName:c[5],objectIndex:c[7],propertyName:c[9],propertyIndex:c[11]};if(null===d.propertyName||0===d.propertyName.length)throw new Error("can not parse propertyName from trackName: "+a);return d},d.PropertyBinding.findNode=function(a,b){if(!b||""===b||"root"===b||"."===b||-1===b||b===a.name||b===a.uuid)return a;if(a.skeleton){var c=function(a){for(var c=0;c<a.bones.length;c++){var d=a.bones[c];if(d.name===b)return d}return null}(a.skeleton);if(c)return c}if(a.children){var d=function(a){for(var c=0;c<a.length;c++){var e=a[c];if(e.name===b||e.uuid===b)return e;var f=d(e.children);if(f)return f}return null},e=d(a.children);if(e)return e}return null},d.PropertyMixer=function(a,b,c){this.binding=a,this.valueSize=c;var d,e=Float64Array;switch(b){case"quaternion":d=this._slerp;break;case"string":case"bool":e=Array,d=this._select;break;default:d=this._lerp}this.buffer=new e(4*c),this._mixBufferRegion=d,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0},d.PropertyMixer.prototype={constructor:d.PropertyMixer,accumulate:function(a,b){var c=this.buffer,d=this.valueSize,e=a*d+d,f=this.cumulativeWeight;if(0===f){for(var g=0;g!==d;++g)c[e+g]=c[g];f=b}else{f+=b;var h=b/f;this._mixBufferRegion(c,e,0,h,d)}this.cumulativeWeight=f},apply:function(a){var b=this.valueSize,c=this.buffer,d=a*b+b,e=this.cumulativeWeight,f=this.binding;if(this.cumulativeWeight=0,e<1){var g=3*b;this._mixBufferRegion(c,d,g,1-e,b)}for(var h=b,i=b+b;h!==i;++h)if(c[h]!==c[h+b]){f.setValue(c,d);break}},saveOriginalState:function(){var a=this.binding,b=this.buffer,c=this.valueSize,d=3*c;a.getValue(b,d);for(var e=c,f=d;e!==f;++e)b[e]=b[d+e%c];this.cumulativeWeight=0},restoreOriginalState:function(){var a=3*this.valueSize;this.binding.setValue(this.buffer,a)},_select:function(a,b,c,d,e){if(d>=.5)for(var f=0;f!==e;++f)a[b+f]=a[c+f]},_slerp:function(a,b,c,e,f){d.Quaternion.slerpFlat(a,b,a,b,a,c,e)},_lerp:function(a,b,c,d,e){for(var f=1-d,g=0;g!==e;++g){var h=b+g;a[h]=a[h]*f+a[c+g]*d}}},d.BooleanKeyframeTrack=function(a,b,c){d.KeyframeTrack.call(this,a,b,c)},d.BooleanKeyframeTrack.prototype=Object.assign(Object.create(d.KeyframeTrack.prototype),{constructor:d.BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:d.IntepolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),d.NumberKeyframeTrack=function(a,b,c,e){d.KeyframeTrack.call(this,a,b,c,e)},d.NumberKeyframeTrack.prototype=Object.assign(Object.create(d.KeyframeTrack.prototype),{constructor:d.NumberKeyframeTrack,ValueTypeName:"number"}),d.QuaternionKeyframeTrack=function(a,b,c,e){d.KeyframeTrack.call(this,a,b,c,e)},d.QuaternionKeyframeTrack.prototype=Object.assign(Object.create(d.KeyframeTrack.prototype),{constructor:d.QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:d.InterpolateLinear,InterpolantFactoryMethodLinear:function(a){return new d.QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),a)},InterpolantFactoryMethodSmooth:void 0}),d.StringKeyframeTrack=function(a,b,c,e){d.KeyframeTrack.call(this,a,b,c,e)},d.StringKeyframeTrack.prototype=Object.assign(Object.create(d.KeyframeTrack.prototype),{constructor:d.StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:d.IntepolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),d.VectorKeyframeTrack=function(a,b,c,e){d.KeyframeTrack.call(this,a,b,c,e)},d.VectorKeyframeTrack.prototype=Object.assign(Object.create(d.KeyframeTrack.prototype),{constructor:d.VectorKeyframeTrack,ValueTypeName:"vector"}),d.Audio=function(a){d.Object3D.call(this),this.type="Audio",this.context=a.context,this.source=this.context.createBufferSource(),this.source.onended=this.onEnded.bind(this),this.gain=this.context.createGain(),this.gain.connect(a.getInput()),this.autoplay=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filter=null},d.Audio.prototype=Object.create(d.Object3D.prototype),d.Audio.prototype.constructor=d.Audio,d.Audio.prototype.getOutput=function(){return this.gain},d.Audio.prototype.load=function(a){var b=new d.AudioBuffer(this.context);return b.load(a),this.setBuffer(b),this},d.Audio.prototype.setNodeSource=function(a){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=a,this.connect(),this},d.Audio.prototype.setBuffer=function(a){var b=this;return a.onReady(function(a){b.source.buffer=a,b.sourceType="buffer",b.autoplay&&b.play()}),this},d.Audio.prototype.play=function(){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");var a=this.context.createBufferSource();a.buffer=this.source.buffer,a.loop=this.source.loop,a.onended=this.source.onended,a.start(0,this.startTime),a.playbackRate.value=this.playbackRate,this.isPlaying=!0,this.source=a,this.connect()},d.Audio.prototype.pause=function(){if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this.source.stop(),this.startTime=this.context.currentTime},d.Audio.prototype.stop=function(){if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this.source.stop(),this.startTime=0},d.Audio.prototype.connect=function(){null!==this.filter?(this.source.connect(this.filter),this.filter.connect(this.getOutput())):this.source.connect(this.getOutput())},d.Audio.prototype.disconnect=function(){null!==this.filter?(this.source.disconnect(this.filter),this.filter.disconnect(this.getOutput())):this.source.disconnect(this.getOutput())},d.Audio.prototype.getFilter=function(){return this.filter},d.Audio.prototype.setFilter=function(a){void 0===a&&(a=null),!0===this.isPlaying?(this.disconnect(),this.filter=a,this.connect()):this.filter=a},d.Audio.prototype.setPlaybackRate=function(a){if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this.playbackRate=a,!0===this.isPlaying&&(this.source.playbackRate.value=this.playbackRate)},d.Audio.prototype.getPlaybackRate=function(){return this.playbackRate},d.Audio.prototype.onEnded=function(){this.isPlaying=!1},d.Audio.prototype.setLoop=function(a){if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this.source.loop=a},d.Audio.prototype.getLoop=function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.source.loop},d.Audio.prototype.setVolume=function(a){this.gain.gain.value=a},d.Audio.prototype.getVolume=function(){return this.gain.gain.value},d.AudioAnalyser=function(a,b){this.analyser=a.context.createAnalyser(),this.analyser.fftSize=void 0!==b?b:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),a.getOutput().connect(this.analyser)},d.AudioAnalyser.prototype={constructor:d.AudioAnalyser,getData:function(){return this.analyser.getByteFrequencyData(this.data),this.data}},d.AudioBuffer=function(a){this.context=a,this.ready=!1,this.readyCallbacks=[]},d.AudioBuffer.prototype.load=function(a){var b=this,c=new XMLHttpRequest;return c.open("GET",a,!0),c.responseType="arraybuffer",c.onload=function(a){b.context.decodeAudioData(this.response,function(a){b.buffer=a,b.ready=!0;for(var c=0;c<b.readyCallbacks.length;c++)b.readyCallbacks[c](b.buffer);b.readyCallbacks=[]})},c.send(),this},d.AudioBuffer.prototype.onReady=function(a){this.ready?a(this.buffer):this.readyCallbacks.push(a)},d.PositionalAudio=function(a){d.Audio.call(this,a),this.panner=this.context.createPanner(),this.panner.connect(this.gain)},d.PositionalAudio.prototype=Object.create(d.Audio.prototype),d.PositionalAudio.prototype.constructor=d.PositionalAudio,d.PositionalAudio.prototype.getOutput=function(){return this.panner},d.PositionalAudio.prototype.setRefDistance=function(a){this.panner.refDistance=a},d.PositionalAudio.prototype.getRefDistance=function(){return this.panner.refDistance},d.PositionalAudio.prototype.setRolloffFactor=function(a){this.panner.rolloffFactor=a},d.PositionalAudio.prototype.getRolloffFactor=function(){return this.panner.rolloffFactor},d.PositionalAudio.prototype.setDistanceModel=function(a){this.panner.distanceModel=a},d.PositionalAudio.prototype.getDistanceModel=function(){return this.panner.distanceModel},d.PositionalAudio.prototype.setMaxDistance=function(a){this.panner.maxDistance=a},d.PositionalAudio.prototype.getMaxDistance=function(){return this.panner.maxDistance},d.PositionalAudio.prototype.updateMatrixWorld=function(){var a=new d.Vector3;return function(b){d.Object3D.prototype.updateMatrixWorld.call(this,b),a.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(a.x,a.y,a.z)}}(),d.AudioListener=function(){d.Object3D.call(this),this.type="AudioListener",this.context=new(window.AudioContext||window.webkitAudioContext),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null},d.AudioListener.prototype=Object.create(d.Object3D.prototype),d.AudioListener.prototype.constructor=d.AudioListener,d.AudioListener.prototype.getInput=function(){return this.gain},d.AudioListener.prototype.removeFilter=function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},d.AudioListener.prototype.setFilter=function(a){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=a,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},d.AudioListener.prototype.getFilter=function(){return this.filter},d.AudioListener.prototype.setMasterVolume=function(a){this.gain.gain.value=a},d.AudioListener.prototype.getMasterVolume=function(){return this.gain.gain.value},d.AudioListener.prototype.updateMatrixWorld=function(){var a=new d.Vector3,b=new d.Quaternion,c=new d.Vector3,e=new d.Vector3;return function(f){d.Object3D.prototype.updateMatrixWorld.call(this,f);var g=this.context.listener,h=this.up;this.matrixWorld.decompose(a,b,c),e.set(0,0,-1).applyQuaternion(b),g.setPosition(a.x,a.y,a.z),g.setOrientation(e.x,e.y,e.z,h.x,h.y,h.z)}}(),d.Camera=function(){d.Object3D.call(this),this.type="Camera",this.matrixWorldInverse=new d.Matrix4,this.projectionMatrix=new d.Matrix4},d.Camera.prototype=Object.create(d.Object3D.prototype),d.Camera.prototype.constructor=d.Camera,d.Camera.prototype.getWorldDirection=function(){var a=new d.Quaternion;return function(b){var c=b||new d.Vector3;return this.getWorldQuaternion(a),c.set(0,0,-1).applyQuaternion(a)}}(),d.Camera.prototype.lookAt=function(){var a=new d.Matrix4;return function(b){a.lookAt(this.position,b,this.up),this.quaternion.setFromRotationMatrix(a)}}(),d.Camera.prototype.clone=function(){return(new this.constructor).copy(this)},d.Camera.prototype.copy=function(a){return d.Object3D.prototype.copy.call(this,a),this.matrixWorldInverse.copy(a.matrixWorldInverse),this.projectionMatrix.copy(a.projectionMatrix),this},d.CubeCamera=function(a,b,c){d.Object3D.call(this),this.type="CubeCamera";var e=new d.PerspectiveCamera(90,1,a,b);e.up.set(0,-1,0),e.lookAt(new d.Vector3(1,0,0)),this.add(e);var f=new d.PerspectiveCamera(90,1,a,b);f.up.set(0,-1,0),f.lookAt(new d.Vector3(-1,0,0)),this.add(f);var g=new d.PerspectiveCamera(90,1,a,b);g.up.set(0,0,1),g.lookAt(new d.Vector3(0,1,0)),this.add(g);var h=new d.PerspectiveCamera(90,1,a,b);h.up.set(0,0,-1),h.lookAt(new d.Vector3(0,-1,0)),this.add(h);var i=new d.PerspectiveCamera(90,1,a,b);i.up.set(0,-1,0),i.lookAt(new d.Vector3(0,0,1)),this.add(i);var j=new d.PerspectiveCamera(90,1,a,b);j.up.set(0,-1,0),j.lookAt(new d.Vector3(0,0,-1)),this.add(j);var k={format:d.RGBFormat,magFilter:d.LinearFilter,minFilter:d.LinearFilter};this.renderTarget=new d.WebGLRenderTargetCube(c,c,k),this.updateCubeMap=function(a,b){null===this.parent&&this.updateMatrixWorld();var c=this.renderTarget,d=c.texture.generateMipmaps;c.texture.generateMipmaps=!1,c.activeCubeFace=0,a.render(b,e,c),c.activeCubeFace=1,a.render(b,f,c),c.activeCubeFace=2,a.render(b,g,c),c.activeCubeFace=3,a.render(b,h,c),c.activeCubeFace=4,a.render(b,i,c),c.texture.generateMipmaps=d,c.activeCubeFace=5,a.render(b,j,c),a.setRenderTarget(null)}},d.CubeCamera.prototype=Object.create(d.Object3D.prototype),d.CubeCamera.prototype.constructor=d.CubeCamera,d.OrthographicCamera=function(a,b,c,e,f,g){d.Camera.call(this),this.type="OrthographicCamera",this.zoom=1,this.left=a,this.right=b,this.top=c,this.bottom=e,this.near=void 0!==f?f:.1,this.far=void 0!==g?g:2e3,this.updateProjectionMatrix()},d.OrthographicCamera.prototype=Object.create(d.Camera.prototype),d.OrthographicCamera.prototype.constructor=d.OrthographicCamera,d.OrthographicCamera.prototype.updateProjectionMatrix=function(){var a=(this.right-this.left)/(2*this.zoom),b=(this.top-this.bottom)/(2*this.zoom),c=(this.right+this.left)/2,d=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(c-a,c+a,d+b,d-b,this.near,this.far)},d.OrthographicCamera.prototype.copy=function(a){return d.Camera.prototype.copy.call(this,a),this.left=a.left,this.right=a.right,this.top=a.top,this.bottom=a.bottom,this.near=a.near,this.far=a.far,this.zoom=a.zoom,this},d.OrthographicCamera.prototype.toJSON=function(a){var b=d.Object3D.prototype.toJSON.call(this,a);return b.object.zoom=this.zoom,b.object.left=this.left,b.object.right=this.right,b.object.top=this.top,b.object.bottom=this.bottom,b.object.near=this.near,b.object.far=this.far,b},d.PerspectiveCamera=function(a,b,c,e){d.Camera.call(this),this.type="PerspectiveCamera",this.focalLength=10,this.zoom=1,this.fov=void 0!==a?a:50,this.aspect=void 0!==b?b:1,this.near=void 0!==c?c:.1,this.far=void 0!==e?e:2e3,this.updateProjectionMatrix()},d.PerspectiveCamera.prototype=Object.create(d.Camera.prototype),d.PerspectiveCamera.prototype.constructor=d.PerspectiveCamera,d.PerspectiveCamera.prototype.setLens=function(a,b){void 0===b&&(b=24),
this.fov=2*d.Math.radToDeg(Math.atan(b/(2*a))),this.updateProjectionMatrix()},d.PerspectiveCamera.prototype.setViewOffset=function(a,b,c,d,e,f){this.fullWidth=a,this.fullHeight=b,this.x=c,this.y=d,this.width=e,this.height=f,this.updateProjectionMatrix()},d.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var a=d.Math.radToDeg(2*Math.atan(Math.tan(.5*d.Math.degToRad(this.fov))/this.zoom));if(this.fullWidth){var b=this.fullWidth/this.fullHeight,c=Math.tan(d.Math.degToRad(.5*a))*this.near,e=-c,f=b*e,g=b*c,h=Math.abs(g-f),i=Math.abs(c-e);this.projectionMatrix.makeFrustum(f+this.x*h/this.fullWidth,f+(this.x+this.width)*h/this.fullWidth,c-(this.y+this.height)*i/this.fullHeight,c-this.y*i/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(a,this.aspect,this.near,this.far)},d.PerspectiveCamera.prototype.copy=function(a){return d.Camera.prototype.copy.call(this,a),this.focalLength=a.focalLength,this.zoom=a.zoom,this.fov=a.fov,this.aspect=a.aspect,this.near=a.near,this.far=a.far,this},d.PerspectiveCamera.prototype.toJSON=function(a){var b=d.Object3D.prototype.toJSON.call(this,a);return b.object.focalLength=this.focalLength,b.object.zoom=this.zoom,b.object.fov=this.fov,b.object.aspect=this.aspect,b.object.near=this.near,b.object.far=this.far,b},d.StereoCamera=function(){this.type="StereoCamera",this.aspect=1,this.cameraL=new d.PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new d.PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1},d.StereoCamera.prototype={constructor:d.StereoCamera,update:function(){var a,b,c,e,f,g=new d.Matrix4,h=new d.Matrix4;return function(i){if(a!==i.focalLength||b!==i.fov||c!==i.aspect*this.aspect||e!==i.near||f!==i.far){a=i.focalLength,b=i.fov,c=i.aspect*this.aspect,e=i.near,f=i.far;var j,k,l=i.projectionMatrix.clone(),m=.032*e/a,n=e*Math.tan(d.Math.degToRad(.5*b));h.elements[12]=-.032,g.elements[12]=.032,j=-n*c+m,k=n*c+m,l.elements[0]=2*e/(k-j),l.elements[8]=(k+j)/(k-j),this.cameraL.projectionMatrix.copy(l),j=-n*c-m,k=n*c-m,l.elements[0]=2*e/(k-j),l.elements[8]=(k+j)/(k-j),this.cameraR.projectionMatrix.copy(l)}this.cameraL.matrixWorld.copy(i.matrixWorld).multiply(h),this.cameraR.matrixWorld.copy(i.matrixWorld).multiply(g)}}()},d.Light=function(a,b){d.Object3D.call(this),this.type="Light",this.color=new d.Color(a),this.intensity=void 0!==b?b:1,this.receiveShadow=void 0},d.Light.prototype=Object.create(d.Object3D.prototype),d.Light.prototype.constructor=d.Light,d.Light.prototype.copy=function(a){return d.Object3D.prototype.copy.call(this,a),this.color.copy(a.color),this.intensity=a.intensity,this},d.Light.prototype.toJSON=function(a){var b=d.Object3D.prototype.toJSON.call(this,a);return b.object.color=this.color.getHex(),b.object.intensity=this.intensity,void 0!==this.groundColor&&(b.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(b.object.distance=this.distance),void 0!==this.angle&&(b.object.angle=this.angle),void 0!==this.decay&&(b.object.decay=this.decay),void 0!==this.penumbra&&(b.object.penumbra=this.penumbra),b},d.LightShadow=function(a){this.camera=a,this.bias=0,this.radius=1,this.mapSize=new d.Vector2(512,512),this.map=null,this.matrix=new d.Matrix4},d.LightShadow.prototype={constructor:d.LightShadow,copy:function(a){return this.camera=a.camera.clone(),this.bias=a.bias,this.radius=a.radius,this.mapSize.copy(a.mapSize),this},clone:function(){return(new this.constructor).copy(this)}},d.AmbientLight=function(a,b){d.Light.call(this,a,b),this.type="AmbientLight",this.castShadow=void 0},d.AmbientLight.prototype=Object.create(d.Light.prototype),d.AmbientLight.prototype.constructor=d.AmbientLight,d.DirectionalLight=function(a,b){d.Light.call(this,a,b),this.type="DirectionalLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new d.Object3D,this.shadow=new d.LightShadow(new d.OrthographicCamera(-5,5,5,-5,.5,500))},d.DirectionalLight.prototype=Object.create(d.Light.prototype),d.DirectionalLight.prototype.constructor=d.DirectionalLight,d.DirectionalLight.prototype.copy=function(a){return d.Light.prototype.copy.call(this,a),this.target=a.target.clone(),this.shadow=a.shadow.clone(),this},d.HemisphereLight=function(a,b,c){d.Light.call(this,a,c),this.type="HemisphereLight",this.castShadow=void 0,this.position.set(0,1,0),this.updateMatrix(),this.groundColor=new d.Color(b)},d.HemisphereLight.prototype=Object.create(d.Light.prototype),d.HemisphereLight.prototype.constructor=d.HemisphereLight,d.HemisphereLight.prototype.copy=function(a){return d.Light.prototype.copy.call(this,a),this.groundColor.copy(a.groundColor),this},d.PointLight=function(a,b,c,e){d.Light.call(this,a,b),this.type="PointLight",this.distance=void 0!==c?c:0,this.decay=void 0!==e?e:1,this.shadow=new d.LightShadow(new d.PerspectiveCamera(90,1,.5,500))},d.PointLight.prototype=Object.create(d.Light.prototype),d.PointLight.prototype.constructor=d.PointLight,Object.defineProperty(d.PointLight.prototype,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(a){this.intensity=a/(4*Math.PI)}}),d.PointLight.prototype.copy=function(a){return d.Light.prototype.copy.call(this,a),this.distance=a.distance,this.decay=a.decay,this.shadow=a.shadow.clone(),this},d.SpotLight=function(a,b,c,e,f,g){d.Light.call(this,a,b),this.type="SpotLight",this.position.set(0,1,0),this.updateMatrix(),this.target=new d.Object3D,this.distance=void 0!==c?c:0,this.angle=void 0!==e?e:Math.PI/3,this.penumbra=void 0!==f?f:0,this.decay=void 0!==g?g:1,this.shadow=new d.LightShadow(new d.PerspectiveCamera(50,1,.5,500))},d.SpotLight.prototype=Object.create(d.Light.prototype),d.SpotLight.prototype.constructor=d.SpotLight,Object.defineProperty(d.SpotLight.prototype,"power",{get:function(){return this.intensity*Math.PI},set:function(a){this.intensity=a/Math.PI}}),d.SpotLight.prototype.copy=function(a){return d.Light.prototype.copy.call(this,a),this.distance=a.distance,this.angle=a.angle,this.penumbra=a.penumbra,this.decay=a.decay,this.target=a.target.clone(),this.shadow=a.shadow.clone(),this},d.Cache={enabled:!1,files:{},add:function(a,b){!1!==this.enabled&&(this.files[a]=b)},get:function(a){if(!1!==this.enabled)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}},d.Loader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},d.Loader.prototype={constructor:d.Loader,crossOrigin:void 0,extractUrlBase:function(a){var b=a.split("/");return 1===b.length?"./":(b.pop(),b.join("/")+"/")},initMaterials:function(a,b,c){for(var d=[],e=0;e<a.length;++e)d[e]=this.createMaterial(a[e],b,c);return d},createMaterial:function(){var a,b,c;return function(e,f,g){function h(a,c,e,h,j){var k,l=f+a,m=d.Loader.Handlers.get(l);null!==m?k=m.load(l):(b.setCrossOrigin(g),k=b.load(l)),void 0!==c&&(k.repeat.fromArray(c),1!==c[0]&&(k.wrapS=d.RepeatWrapping),1!==c[1]&&(k.wrapT=d.RepeatWrapping)),void 0!==e&&k.offset.fromArray(e),void 0!==h&&("repeat"===h[0]&&(k.wrapS=d.RepeatWrapping),"mirror"===h[0]&&(k.wrapS=d.MirroredRepeatWrapping),"repeat"===h[1]&&(k.wrapT=d.RepeatWrapping),"mirror"===h[1]&&(k.wrapT=d.MirroredRepeatWrapping)),void 0!==j&&(k.anisotropy=j);var n=d.Math.generateUUID();return i[n]=k,n}void 0===a&&(a=new d.Color),void 0===b&&(b=new d.TextureLoader),void 0===c&&(c=new d.MaterialLoader);var i={},j={uuid:d.Math.generateUUID(),type:"MeshLambertMaterial"};for(var k in e){var l=e[k];switch(k){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":j.name=l;break;case"blending":j.blending=d[l];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",k,"is no longer supported.");break;case"colorDiffuse":j.color=a.fromArray(l).getHex();break;case"colorSpecular":j.specular=a.fromArray(l).getHex();break;case"colorEmissive":j.emissive=a.fromArray(l).getHex();break;case"specularCoef":j.shininess=l;break;case"shading":"basic"===l.toLowerCase()&&(j.type="MeshBasicMaterial"),"phong"===l.toLowerCase()&&(j.type="MeshPhongMaterial");break;case"mapDiffuse":j.map=h(l,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapLight":j.lightMap=h(l,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":j.aoMap=h(l,e.mapAORepeat,e.mapAOOffset,e.mapAOWrap,e.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":j.bumpMap=h(l,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy);break;case"mapBumpScale":j.bumpScale=l;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":j.normalMap=h(l,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy);break;case"mapNormalFactor":j.normalScale=[l,l];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":j.specularMap=h(l,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapAlpha":j.alphaMap=h(l,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":j.side=d.BackSide;break;case"doubleSided":j.side=d.DoubleSide;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),j.opacity=l;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":j[k]=l;break;case"vertexColors":!0===l&&(j.vertexColors=d.VertexColors),"face"===l&&(j.vertexColors=d.FaceColors);break;default:console.error("THREE.Loader.createMaterial: Unsupported",k,l)}}return"MeshBasicMaterial"===j.type&&delete j.emissive,"MeshPhongMaterial"!==j.type&&delete j.specular,j.opacity<1&&(j.transparent=!0),c.setTextures(i),c.parse(j)}}()},d.Loader.Handlers={handlers:[],add:function(a,b){this.handlers.push(a,b)},get:function(a){for(var b=this.handlers,c=0,d=b.length;c<d;c+=2){var e=b[c],f=b[c+1];if(e.test(a))return f}return null}},d.XHRLoader=function(a){this.manager=void 0!==a?a:d.DefaultLoadingManager},d.XHRLoader.prototype={constructor:d.XHRLoader,load:function(a,b,c,e){void 0!==this.path&&(a=this.path+a);var f=this,g=d.Cache.get(a);if(void 0!==g)return b&&setTimeout(function(){b(g)},0),g;var h=new XMLHttpRequest;return h.overrideMimeType("text/plain"),h.open("GET",a,!0),h.addEventListener("load",function(c){var g=c.target.response;d.Cache.add(a,g),200===this.status?(b&&b(g),f.manager.itemEnd(a)):0===this.status?(console.warn("THREE.XHRLoader: HTTP Status 0 received."),b&&b(g),f.manager.itemEnd(a)):(e&&e(c),f.manager.itemError(a))},!1),void 0!==c&&h.addEventListener("progress",function(a){c(a)},!1),h.addEventListener("error",function(b){e&&e(b),f.manager.itemError(a)},!1),void 0!==this.responseType&&(h.responseType=this.responseType),void 0!==this.withCredentials&&(h.withCredentials=this.withCredentials),h.send(null),f.manager.itemStart(a),h},setPath:function(a){this.path=a},setResponseType:function(a){this.responseType=a},setWithCredentials:function(a){this.withCredentials=a}},d.FontLoader=function(a){this.manager=void 0!==a?a:d.DefaultLoadingManager},d.FontLoader.prototype={constructor:d.FontLoader,load:function(a,b,c,e){new d.XHRLoader(this.manager).load(a,function(a){b(new d.Font(JSON.parse(a.substring(65,a.length-2))))},c,e)}},d.ImageLoader=function(a){this.manager=void 0!==a?a:d.DefaultLoadingManager},d.ImageLoader.prototype={constructor:d.ImageLoader,load:function(a,b,c,e){void 0!==this.path&&(a=this.path+a);var f=this,g=d.Cache.get(a);if(void 0!==g)return f.manager.itemStart(a),b?setTimeout(function(){b(g),f.manager.itemEnd(a)},0):f.manager.itemEnd(a),g;var h=document.createElement("img");return h.addEventListener("load",function(c){d.Cache.add(a,this),b&&b(this),f.manager.itemEnd(a)},!1),void 0!==c&&h.addEventListener("progress",function(a){c(a)},!1),h.addEventListener("error",function(b){e&&e(b),f.manager.itemError(a)},!1),void 0!==this.crossOrigin&&(h.crossOrigin=this.crossOrigin),f.manager.itemStart(a),h.src=a,h},setCrossOrigin:function(a){this.crossOrigin=a},setPath:function(a){this.path=a}},d.JSONLoader=function(a){"boolean"==typeof a&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),a=void 0),this.manager=void 0!==a?a:d.DefaultLoadingManager,this.withCredentials=!1},d.JSONLoader.prototype={constructor:d.JSONLoader,get statusDomElement(){return void 0===this._statusDomElement&&(this._statusDomElement=document.createElement("div")),console.warn("THREE.JSONLoader: .statusDomElement has been removed."),this._statusDomElement},load:function(a,b,c,e){var f=this,g=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:d.Loader.prototype.extractUrlBase(a),h=new d.XHRLoader(this.manager);h.setWithCredentials(this.withCredentials),h.load(a,function(c){var d=JSON.parse(c),e=d.metadata;if(void 0!==e){var h=e.type;if(void 0!==h){if("object"===h.toLowerCase())return void console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.ObjectLoader instead.");if("scene"===h.toLowerCase())return void console.error("THREE.JSONLoader: "+a+" should be loaded with THREE.SceneLoader instead.")}}var i=f.parse(d,g);b(i.geometry,i.materials)},c,e)},setTexturePath:function(a){this.texturePath=a},parse:function(a,b){var c=new d.Geometry,e=void 0!==a.scale?1/a.scale:1;if(function(b){function e(a,b){return a&1<<b}var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=a.faces,H=a.vertices,I=a.normals,J=a.colors,K=0;if(void 0!==a.uvs){for(f=0;f<a.uvs.length;f++)a.uvs[f].length&&K++;for(f=0;f<K;f++)c.faceVertexUvs[f]=[]}for(i=0,j=H.length;i<j;)w=new d.Vector3,w.x=H[i++]*b,w.y=H[i++]*b,w.z=H[i++]*b,c.vertices.push(w);for(i=0,j=G.length;i<j;)if(o=G[i++],p=e(o,0),q=e(o,1),r=e(o,3),s=e(o,4),t=e(o,5),u=e(o,6),v=e(o,7),p){if(y=new d.Face3,y.a=G[i],y.b=G[i+1],y.c=G[i+3],z=new d.Face3,z.a=G[i+1],z.b=G[i+2],z.c=G[i+3],i+=4,q&&(n=G[i++],y.materialIndex=n,z.materialIndex=n),h=c.faces.length,r)for(f=0;f<K;f++)for(C=a.uvs[f],c.faceVertexUvs[f][h]=[],c.faceVertexUvs[f][h+1]=[],g=0;g<4;g++)m=G[i++],E=C[2*m],F=C[2*m+1],D=new d.Vector2(E,F),2!==g&&c.faceVertexUvs[f][h].push(D),0!==g&&c.faceVertexUvs[f][h+1].push(D);if(s&&(l=3*G[i++],y.normal.set(I[l++],I[l++],I[l]),z.normal.copy(y.normal)),t)for(f=0;f<4;f++)l=3*G[i++],B=new d.Vector3(I[l++],I[l++],I[l]),2!==f&&y.vertexNormals.push(B),0!==f&&z.vertexNormals.push(B);if(u&&(k=G[i++],A=J[k],y.color.setHex(A),z.color.setHex(A)),v)for(f=0;f<4;f++)k=G[i++],A=J[k],2!==f&&y.vertexColors.push(new d.Color(A)),0!==f&&z.vertexColors.push(new d.Color(A));c.faces.push(y),c.faces.push(z)}else{if(x=new d.Face3,x.a=G[i++],x.b=G[i++],x.c=G[i++],q&&(n=G[i++],x.materialIndex=n),h=c.faces.length,r)for(f=0;f<K;f++)for(C=a.uvs[f],c.faceVertexUvs[f][h]=[],g=0;g<3;g++)m=G[i++],E=C[2*m],F=C[2*m+1],D=new d.Vector2(E,F),c.faceVertexUvs[f][h].push(D);if(s&&(l=3*G[i++],x.normal.set(I[l++],I[l++],I[l])),t)for(f=0;f<3;f++)l=3*G[i++],B=new d.Vector3(I[l++],I[l++],I[l]),x.vertexNormals.push(B);if(u&&(k=G[i++],x.color.setHex(J[k])),v)for(f=0;f<3;f++)k=G[i++],x.vertexColors.push(new d.Color(J[k]));c.faces.push(x)}}(e),function(){var b=void 0!==a.influencesPerVertex?a.influencesPerVertex:2;if(a.skinWeights)for(var e=0,f=a.skinWeights.length;e<f;e+=b){var g=a.skinWeights[e],h=b>1?a.skinWeights[e+1]:0,i=b>2?a.skinWeights[e+2]:0,j=b>3?a.skinWeights[e+3]:0;c.skinWeights.push(new d.Vector4(g,h,i,j))}if(a.skinIndices)for(var e=0,f=a.skinIndices.length;e<f;e+=b){var k=a.skinIndices[e],l=b>1?a.skinIndices[e+1]:0,m=b>2?a.skinIndices[e+2]:0,n=b>3?a.skinIndices[e+3]:0;c.skinIndices.push(new d.Vector4(k,l,m,n))}c.bones=a.bones,c.bones&&c.bones.length>0&&(c.skinWeights.length!==c.skinIndices.length||c.skinIndices.length!==c.vertices.length)&&console.warn("When skinning, number of vertices ("+c.vertices.length+"), skinIndices ("+c.skinIndices.length+"), and skinWeights ("+c.skinWeights.length+") should match.")}(),function(b){if(void 0!==a.morphTargets)for(var e=0,f=a.morphTargets.length;e<f;e++){c.morphTargets[e]={},c.morphTargets[e].name=a.morphTargets[e].name,c.morphTargets[e].vertices=[];for(var g=c.morphTargets[e].vertices,h=a.morphTargets[e].vertices,i=0,j=h.length;i<j;i+=3){var k=new d.Vector3;k.x=h[i]*b,k.y=h[i+1]*b,k.z=h[i+2]*b,g.push(k)}}if(void 0!==a.morphColors&&a.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');for(var l=c.faces,m=a.morphColors[0].colors,e=0,f=l.length;e<f;e++)l[e].color.fromArray(m,3*e)}}(e),function(){var b=[],e=[];void 0!==a.animation&&e.push(a.animation),void 0!==a.animations&&(a.animations.length?e=e.concat(a.animations):e.push(a.animations));for(var f=0;f<e.length;f++){var g=d.AnimationClip.parseAnimation(e[f],c.bones);g&&b.push(g)}if(c.morphTargets){var h=d.AnimationClip.CreateClipsFromMorphTargetSequences(c.morphTargets,10);b=b.concat(h)}b.length>0&&(c.animations=b)}(),c.computeFaceNormals(),c.computeBoundingSphere(),void 0===a.materials||0===a.materials.length)return{geometry:c};var f=d.Loader.prototype.initMaterials(a.materials,b,this.crossOrigin);return{geometry:c,materials:f}}},d.LoadingManager=function(a,b,c){var d=this,e=!1,f=0,g=0;this.onStart=void 0,this.onLoad=a,this.onProgress=b,this.onError=c,this.itemStart=function(a){g++,!1===e&&void 0!==d.onStart&&d.onStart(a,f,g),e=!0},this.itemEnd=function(a){f++,void 0!==d.onProgress&&d.onProgress(a,f,g),f===g&&(e=!1,void 0!==d.onLoad&&d.onLoad())},this.itemError=function(a){void 0!==d.onError&&d.onError(a)}},d.DefaultLoadingManager=new d.LoadingManager,d.BufferGeometryLoader=function(a){this.manager=void 0!==a?a:d.DefaultLoadingManager},d.BufferGeometryLoader.prototype={constructor:d.BufferGeometryLoader,load:function(a,b,c,e){var f=this;new d.XHRLoader(f.manager).load(a,function(a){b(f.parse(JSON.parse(a)))},c,e)},parse:function(a){var b=new d.BufferGeometry,c=a.data.index,e={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};if(void 0!==c){var f=new e[c.type](c.array);b.setIndex(new d.BufferAttribute(f,1))}var g=a.data.attributes;for(var h in g){var i=g[h],f=new e[i.type](i.array);b.addAttribute(h,new d.BufferAttribute(f,i.itemSize))}var j=a.data.groups||a.data.drawcalls||a.data.offsets;if(void 0!==j)for(var k=0,l=j.length;k!==l;++k){var m=j[k];b.addGroup(m.start,m.count,m.materialIndex)}var n=a.data.boundingSphere;if(void 0!==n){var o=new d.Vector3;void 0!==n.center&&o.fromArray(n.center),b.boundingSphere=new d.Sphere(o,n.radius)}return b}},d.MaterialLoader=function(a){this.manager=void 0!==a?a:d.DefaultLoadingManager,this.textures={}},d.MaterialLoader.prototype={constructor:d.MaterialLoader,load:function(a,b,c,e){var f=this;new d.XHRLoader(f.manager).load(a,function(a){b(f.parse(JSON.parse(a)))},c,e)},setTextures:function(a){this.textures=a},getTexture:function(a){var b=this.textures;return void 0===b[a]&&console.warn("THREE.MaterialLoader: Undefined texture",a),b[a]},parse:function(a){var b=new d[a.type];if(void 0!==a.uuid&&(b.uuid=a.uuid),void 0!==a.name&&(b.name=a.name),void 0!==a.color&&b.color.setHex(a.color),void 0!==a.roughness&&(b.roughness=a.roughness),void 0!==a.metalness&&(b.metalness=a.metalness),void 0!==a.emissive&&b.emissive.setHex(a.emissive),void 0!==a.specular&&b.specular.setHex(a.specular),void 0!==a.shininess&&(b.shininess=a.shininess),void 0!==a.uniforms&&(b.uniforms=a.uniforms),void 0!==a.vertexShader&&(b.vertexShader=a.vertexShader),void 0!==a.fragmentShader&&(b.fragmentShader=a.fragmentShader),void 0!==a.vertexColors&&(b.vertexColors=a.vertexColors),void 0!==a.shading&&(b.shading=a.shading),void 0!==a.blending&&(b.blending=a.blending),void 0!==a.side&&(b.side=a.side),void 0!==a.opacity&&(b.opacity=a.opacity),void 0!==a.transparent&&(b.transparent=a.transparent),void 0!==a.alphaTest&&(b.alphaTest=a.alphaTest),void 0!==a.depthTest&&(b.depthTest=a.depthTest),void 0!==a.depthWrite&&(b.depthWrite=a.depthWrite),void 0!==a.colorWrite&&(b.colorWrite=a.colorWrite),void 0!==a.wireframe&&(b.wireframe=a.wireframe),void 0!==a.wireframeLinewidth&&(b.wireframeLinewidth=a.wireframeLinewidth),void 0!==a.size&&(b.size=a.size),void 0!==a.sizeAttenuation&&(b.sizeAttenuation=a.sizeAttenuation),void 0!==a.map&&(b.map=this.getTexture(a.map)),void 0!==a.alphaMap&&(b.alphaMap=this.getTexture(a.alphaMap),b.transparent=!0),void 0!==a.bumpMap&&(b.bumpMap=this.getTexture(a.bumpMap)),void 0!==a.bumpScale&&(b.bumpScale=a.bumpScale),void 0!==a.normalMap&&(b.normalMap=this.getTexture(a.normalMap)),void 0!==a.normalScale){var c=a.normalScale;!1===Array.isArray(c)&&(c=[c,c]),b.normalScale=(new d.Vector2).fromArray(c)}if(void 0!==a.displacementMap&&(b.displacementMap=this.getTexture(a.displacementMap)),void 0!==a.displacementScale&&(b.displacementScale=a.displacementScale),void 0!==a.displacementBias&&(b.displacementBias=a.displacementBias),void 0!==a.roughnessMap&&(b.roughnessMap=this.getTexture(a.roughnessMap)),void 0!==a.metalnessMap&&(b.metalnessMap=this.getTexture(a.metalnessMap)),void 0!==a.emissiveMap&&(b.emissiveMap=this.getTexture(a.emissiveMap)),void 0!==a.emissiveIntensity&&(b.emissiveIntensity=a.emissiveIntensity),void 0!==a.specularMap&&(b.specularMap=this.getTexture(a.specularMap)),void 0!==a.envMap&&(b.envMap=this.getTexture(a.envMap),b.combine=d.MultiplyOperation),a.reflectivity&&(b.reflectivity=a.reflectivity),void 0!==a.lightMap&&(b.lightMap=this.getTexture(a.lightMap)),void 0!==a.lightMapIntensity&&(b.lightMapIntensity=a.lightMapIntensity),void 0!==a.aoMap&&(b.aoMap=this.getTexture(a.aoMap)),void 0!==a.aoMapIntensity&&(b.aoMapIntensity=a.aoMapIntensity),void 0!==a.materials)for(var e=0,f=a.materials.length;e<f;e++)b.materials.push(this.parse(a.materials[e]));return b}},d.ObjectLoader=function(a){this.manager=void 0!==a?a:d.DefaultLoadingManager,this.texturePath=""},d.ObjectLoader.prototype={constructor:d.ObjectLoader,load:function(a,b,c,e){""===this.texturePath&&(this.texturePath=a.substring(0,a.lastIndexOf("/")+1));var f=this;new d.XHRLoader(f.manager).load(a,function(a){f.parse(JSON.parse(a),b)},c,e)},setTexturePath:function(a){this.texturePath=a},setCrossOrigin:function(a){this.crossOrigin=a},parse:function(a,b){var c=this.parseGeometries(a.geometries),d=this.parseImages(a.images,function(){void 0!==b&&b(g)}),e=this.parseTextures(a.textures,d),f=this.parseMaterials(a.materials,e),g=this.parseObject(a.object,c,f);return a.animations&&(g.animations=this.parseAnimations(a.animations)),void 0!==a.images&&0!==a.images.length||void 0!==b&&b(g),g},parseGeometries:function(a){var b={};if(void 0!==a)for(var c=new d.JSONLoader,e=new d.BufferGeometryLoader,f=0,g=a.length;f<g;f++){var h,i=a[f];switch(i.type){case"PlaneGeometry":case"PlaneBufferGeometry":h=new d[i.type](i.width,i.height,i.widthSegments,i.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":h=new d[i.type](i.width,i.height,i.depth,i.widthSegments,i.heightSegments,i.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":h=new d[i.type](i.radius,i.segments,i.thetaStart,i.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":h=new d[i.type](i.radiusTop,i.radiusBottom,i.height,i.radialSegments,i.heightSegments,i.openEnded,i.thetaStart,i.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":h=new d[i.type](i.radius,i.widthSegments,i.heightSegments,i.phiStart,i.phiLength,i.thetaStart,i.thetaLength);break;case"DodecahedronGeometry":h=new d.DodecahedronGeometry(i.radius,i.detail);break;case"IcosahedronGeometry":h=new d.IcosahedronGeometry(i.radius,i.detail);break;case"OctahedronGeometry":h=new d.OctahedronGeometry(i.radius,i.detail);break;case"TetrahedronGeometry":h=new d.TetrahedronGeometry(i.radius,i.detail);break;case"RingGeometry":case"RingBufferGeometry":h=new d[i.type](i.innerRadius,i.outerRadius,i.thetaSegments,i.phiSegments,i.thetaStart,i.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":h=new d[i.type](i.radius,i.tube,i.radialSegments,i.tubularSegments,i.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":h=new d[i.type](i.radius,i.tube,i.tubularSegments,i.radialSegments,i.p,i.q);break;case"LatheGeometry":h=new d.LatheGeometry(i.points,i.segments,i.phiStart,i.phiLength);break;case"BufferGeometry":h=e.parse(i);break;case"Geometry":h=c.parse(i.data,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+i.type+'"');continue}h.uuid=i.uuid,void 0!==i.name&&(h.name=i.name),b[i.uuid]=h}return b},parseMaterials:function(a,b){var c={};if(void 0!==a){var e=new d.MaterialLoader;e.setTextures(b);for(var f=0,g=a.length;f<g;f++){var h=e.parse(a[f]);c[h.uuid]=h}}return c},parseAnimations:function(a){for(var b=[],c=0;c<a.length;c++){var e=d.AnimationClip.parse(a[c]);b.push(e)}return b},parseImages:function(a,b){var c=this,e={};if(void 0!==a&&a.length>0){var f=new d.LoadingManager(b),g=new d.ImageLoader(f);g.setCrossOrigin(this.crossOrigin);for(var h=0,i=a.length;h<i;h++){var j=a[h],k=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(j.url)?j.url:c.texturePath+j.url;e[j.uuid]=function(a){return c.manager.itemStart(a),g.load(a,function(){c.manager.itemEnd(a)})}(k)}}return e},parseTextures:function(a,b){function c(a){return"number"==typeof a?a:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",a),d[a])}var e={};if(void 0!==a)for(var f=0,g=a.length;f<g;f++){var h=a[f];void 0===h.image&&console.warn('THREE.ObjectLoader: No "image" specified for',h.uuid),void 0===b[h.image]&&console.warn("THREE.ObjectLoader: Undefined image",h.image);var i=new d.Texture(b[h.image]);i.needsUpdate=!0,i.uuid=h.uuid,void 0!==h.name&&(i.name=h.name),void 0!==h.mapping&&(i.mapping=c(h.mapping)),void 0!==h.offset&&(i.offset=new d.Vector2(h.offset[0],h.offset[1])),void 0!==h.repeat&&(i.repeat=new d.Vector2(h.repeat[0],h.repeat[1])),void 0!==h.minFilter&&(i.minFilter=c(h.minFilter)),void 0!==h.magFilter&&(i.magFilter=c(h.magFilter)),void 0!==h.anisotropy&&(i.anisotropy=h.anisotropy),Array.isArray(h.wrap)&&(i.wrapS=c(h.wrap[0]),i.wrapT=c(h.wrap[1])),e[h.uuid]=i}return e},parseObject:function(){var a=new d.Matrix4;return function(b,c,e){function f(a){return void 0===c[a]&&console.warn("THREE.ObjectLoader: Undefined geometry",a),c[a]}function g(a){if(void 0!==a)return void 0===e[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),e[a]}var h;switch(b.type){case"Scene":h=new d.Scene;break;case"PerspectiveCamera":h=new d.PerspectiveCamera(b.fov,b.aspect,b.near,b.far);break;case"OrthographicCamera":h=new d.OrthographicCamera(b.left,b.right,b.top,b.bottom,b.near,b.far);break;case"AmbientLight":h=new d.AmbientLight(b.color,b.intensity);break;case"DirectionalLight":h=new d.DirectionalLight(b.color,b.intensity);break;case"PointLight":h=new d.PointLight(b.color,b.intensity,b.distance,b.decay);break;case"SpotLight":h=new d.SpotLight(b.color,b.intensity,b.distance,b.angle,b.penumbra,b.decay);break;case"HemisphereLight":h=new d.HemisphereLight(b.color,b.groundColor,b.intensity);break;case"Mesh":var i=f(b.geometry),j=g(b.material);h=i.bones&&i.bones.length>0?new d.SkinnedMesh(i,j):new d.Mesh(i,j);break;case"LOD":h=new d.LOD;break;case"Line":h=new d.Line(f(b.geometry),g(b.material),b.mode);break;case"PointCloud":case"Points":h=new d.Points(f(b.geometry),g(b.material));break;case"Sprite":h=new d.Sprite(g(b.material));break;case"Group":h=new d.Group;break;default:h=new d.Object3D}if(h.uuid=b.uuid,void 0!==b.name&&(h.name=b.name),void 0!==b.matrix?(a.fromArray(b.matrix),a.decompose(h.position,h.quaternion,h.scale)):(void 0!==b.position&&h.position.fromArray(b.position),void 0!==b.rotation&&h.rotation.fromArray(b.rotation),void 0!==b.scale&&h.scale.fromArray(b.scale)),void 0!==b.castShadow&&(h.castShadow=b.castShadow),void 0!==b.receiveShadow&&(h.receiveShadow=b.receiveShadow),void 0!==b.visible&&(h.visible=b.visible),void 0!==b.userData&&(h.userData=b.userData),void 0!==b.children)for(var k in b.children)h.add(this.parseObject(b.children[k],c,e));if("LOD"===b.type)for(var l=b.levels,m=0;m<l.length;m++){var n=l[m],k=h.getObjectByProperty("uuid",n.object);void 0!==k&&h.addLevel(k,n.distance)}return h}}()},d.TextureLoader=function(a){this.manager=void 0!==a?a:d.DefaultLoadingManager},d.TextureLoader.prototype={constructor:d.TextureLoader,load:function(a,b,c,e){var f=new d.Texture,g=new d.ImageLoader(this.manager);return g.setCrossOrigin(this.crossOrigin),g.setPath(this.path),g.load(a,function(a){f.image=a,f.needsUpdate=!0,void 0!==b&&b(f)},c,e),f},setCrossOrigin:function(a){this.crossOrigin=a},setPath:function(a){this.path=a}},d.CubeTextureLoader=function(a){this.manager=void 0!==a?a:d.DefaultLoadingManager},d.CubeTextureLoader.prototype={constructor:d.CubeTextureLoader,load:function(a,b,c,e){var f=new d.CubeTexture,g=new d.ImageLoader(this.manager);g.setCrossOrigin(this.crossOrigin),g.setPath(this.path);for(var h=0,i=0;i<a.length;++i)!function(c){g.load(a[c],function(a){f.images[c]=a,6==++h&&(f.needsUpdate=!0,b&&b(f))},void 0,e)}(i);return f},setCrossOrigin:function(a){this.crossOrigin=a},setPath:function(a){this.path=a}},d.DataTextureLoader=d.BinaryTextureLoader=function(a){this.manager=void 0!==a?a:d.DefaultLoadingManager,this._parser=null},d.BinaryTextureLoader.prototype={constructor:d.BinaryTextureLoader,load:function(a,b,c,e){var f=this,g=new d.DataTexture,h=new d.XHRLoader(this.manager);return h.setResponseType("arraybuffer"),h.load(a,function(a){var c=f._parser(a);c&&(void 0!==c.image?g.image=c.image:void 0!==c.data&&(g.image.width=c.width,g.image.height=c.height,g.image.data=c.data),g.wrapS=void 0!==c.wrapS?c.wrapS:d.ClampToEdgeWrapping,g.wrapT=void 0!==c.wrapT?c.wrapT:d.ClampToEdgeWrapping,g.magFilter=void 0!==c.magFilter?c.magFilter:d.LinearFilter,g.minFilter=void 0!==c.minFilter?c.minFilter:d.LinearMipMapLinearFilter,g.anisotropy=void 0!==c.anisotropy?c.anisotropy:1,void 0!==c.format&&(g.format=c.format),void 0!==c.type&&(g.type=c.type),void 0!==c.mipmaps&&(g.mipmaps=c.mipmaps),1===c.mipmapCount&&(g.minFilter=d.LinearFilter),g.needsUpdate=!0,b&&b(g,c))},c,e),g}};d.CompressedTextureLoader=function(a){this.manager=void 0!==a?a:d.DefaultLoadingManager,this._parser=null},d.CompressedTextureLoader.prototype={constructor:d.CompressedTextureLoader,load:function(a,b,c,e){var f=this,g=[],h=new d.CompressedTexture;h.image=g;var i=new d.XHRLoader(this.manager);if(i.setPath(this.path),i.setResponseType("arraybuffer"),Array.isArray(a))for(var j=0,k=0,l=a.length;k<l;++k)!function(k){i.load(a[k],function(a){var c=f._parser(a,!0);g[k]={width:c.width,height:c.height,format:c.format,mipmaps:c.mipmaps},6===(j+=1)&&(1===c.mipmapCount&&(h.minFilter=d.LinearFilter),h.format=c.format,h.needsUpdate=!0,b&&b(h))},c,e)}(k);else i.load(a,function(a){var c=f._parser(a,!0);if(c.isCubemap)for(var e=c.mipmaps.length/c.mipmapCount,i=0;i<e;i++){g[i]={mipmaps:[]};for(var j=0;j<c.mipmapCount;j++)g[i].mipmaps.push(c.mipmaps[i*c.mipmapCount+j]),g[i].format=c.format,g[i].width=c.width,g[i].height=c.height}else h.image.width=c.width,h.image.height=c.height,h.mipmaps=c.mipmaps;1===c.mipmapCount&&(h.minFilter=d.LinearFilter),h.format=c.format,h.needsUpdate=!0,b&&b(h)},c,e);return h},setPath:function(a){this.path=a}},d.Material=function(){Object.defineProperty(this,"id",{value:d.MaterialIdCount++}),this.uuid=d.Math.generateUUID(),this.name="",this.type="Material",this.side=d.FrontSide,this.opacity=1,this.transparent=!1,
this.blending=d.NormalBlending,this.blendSrc=d.SrcAlphaFactor,this.blendDst=d.OneMinusSrcAlphaFactor,this.blendEquation=d.AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=d.LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this._needsUpdate=!0},d.Material.prototype={constructor:d.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(a){!0===a&&this.update(),this._needsUpdate=a},setValues:function(a){if(void 0!==a)for(var b in a){var c=a[b];if(void 0!==c){var e=this[b];void 0!==e?e instanceof d.Color?e.set(c):e instanceof d.Vector3&&c instanceof d.Vector3?e.copy(c):this[b]="overdraw"===b?Number(c):c:console.warn("THREE."+this.type+": '"+b+"' is not a property of this material.")}else console.warn("THREE.Material: '"+b+"' parameter is undefined.")}},toJSON:function(a){function b(a){var b=[];for(var c in a){var d=a[c];delete d.metadata,b.push(d)}return b}var c=void 0===a;c&&(a={textures:{},images:{}});var e={metadata:{version:4.4,type:"Material",generator:"Material.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),this.color instanceof d.Color&&(e.color=this.color.getHex()),.5!==this.roughness&&(e.roughness=this.roughness),.5!==this.metalness&&(e.metalness=this.metalness),this.emissive instanceof d.Color&&(e.emissive=this.emissive.getHex()),this.specular instanceof d.Color&&(e.specular=this.specular.getHex()),void 0!==this.shininess&&(e.shininess=this.shininess),this.map instanceof d.Texture&&(e.map=this.map.toJSON(a).uuid),this.alphaMap instanceof d.Texture&&(e.alphaMap=this.alphaMap.toJSON(a).uuid),this.lightMap instanceof d.Texture&&(e.lightMap=this.lightMap.toJSON(a).uuid),this.bumpMap instanceof d.Texture&&(e.bumpMap=this.bumpMap.toJSON(a).uuid,e.bumpScale=this.bumpScale),this.normalMap instanceof d.Texture&&(e.normalMap=this.normalMap.toJSON(a).uuid,e.normalScale=this.normalScale.toArray()),this.displacementMap instanceof d.Texture&&(e.displacementMap=this.displacementMap.toJSON(a).uuid,e.displacementScale=this.displacementScale,e.displacementBias=this.displacementBias),this.roughnessMap instanceof d.Texture&&(e.roughnessMap=this.roughnessMap.toJSON(a).uuid),this.metalnessMap instanceof d.Texture&&(e.metalnessMap=this.metalnessMap.toJSON(a).uuid),this.emissiveMap instanceof d.Texture&&(e.emissiveMap=this.emissiveMap.toJSON(a).uuid),this.specularMap instanceof d.Texture&&(e.specularMap=this.specularMap.toJSON(a).uuid),this.envMap instanceof d.Texture&&(e.envMap=this.envMap.toJSON(a).uuid,e.reflectivity=this.reflectivity),void 0!==this.size&&(e.size=this.size),void 0!==this.sizeAttenuation&&(e.sizeAttenuation=this.sizeAttenuation),void 0!==this.vertexColors&&this.vertexColors!==d.NoColors&&(e.vertexColors=this.vertexColors),void 0!==this.shading&&this.shading!==d.SmoothShading&&(e.shading=this.shading),void 0!==this.blending&&this.blending!==d.NormalBlending&&(e.blending=this.blending),void 0!==this.side&&this.side!==d.FrontSide&&(e.side=this.side),this.opacity<1&&(e.opacity=this.opacity),!0===this.transparent&&(e.transparent=this.transparent),this.alphaTest>0&&(e.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(e.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(e.wireframe=this.wireframe),this.wireframeLinewidth>1&&(e.wireframeLinewidth=this.wireframeLinewidth),c){var f=b(a.textures),g=b(a.images);f.length>0&&(e.textures=f),g.length>0&&(e.images=g)}return e},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.name=a.name,this.side=a.side,this.opacity=a.opacity,this.transparent=a.transparent,this.blending=a.blending,this.blendSrc=a.blendSrc,this.blendDst=a.blendDst,this.blendEquation=a.blendEquation,this.blendSrcAlpha=a.blendSrcAlpha,this.blendDstAlpha=a.blendDstAlpha,this.blendEquationAlpha=a.blendEquationAlpha,this.depthFunc=a.depthFunc,this.depthTest=a.depthTest,this.depthWrite=a.depthWrite,this.colorWrite=a.colorWrite,this.precision=a.precision,this.polygonOffset=a.polygonOffset,this.polygonOffsetFactor=a.polygonOffsetFactor,this.polygonOffsetUnits=a.polygonOffsetUnits,this.alphaTest=a.alphaTest,this.premultipliedAlpha=a.premultipliedAlpha,this.overdraw=a.overdraw,this.visible=a.visible,this},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},d.EventDispatcher.prototype.apply(d.Material.prototype),d.MaterialIdCount=0,d.LineBasicMaterial=function(a){d.Material.call(this),this.type="LineBasicMaterial",this.color=new d.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.blending=d.NormalBlending,this.vertexColors=d.NoColors,this.fog=!0,this.setValues(a)},d.LineBasicMaterial.prototype=Object.create(d.Material.prototype),d.LineBasicMaterial.prototype.constructor=d.LineBasicMaterial,d.LineBasicMaterial.prototype.copy=function(a){return d.Material.prototype.copy.call(this,a),this.color.copy(a.color),this.linewidth=a.linewidth,this.linecap=a.linecap,this.linejoin=a.linejoin,this.vertexColors=a.vertexColors,this.fog=a.fog,this},d.LineDashedMaterial=function(a){d.Material.call(this),this.type="LineDashedMaterial",this.color=new d.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.blending=d.NormalBlending,this.vertexColors=d.NoColors,this.fog=!0,this.setValues(a)},d.LineDashedMaterial.prototype=Object.create(d.Material.prototype),d.LineDashedMaterial.prototype.constructor=d.LineDashedMaterial,d.LineDashedMaterial.prototype.copy=function(a){return d.Material.prototype.copy.call(this,a),this.color.copy(a.color),this.linewidth=a.linewidth,this.scale=a.scale,this.dashSize=a.dashSize,this.gapSize=a.gapSize,this.vertexColors=a.vertexColors,this.fog=a.fog,this},d.MeshBasicMaterial=function(a){d.Material.call(this),this.type="MeshBasicMaterial",this.color=new d.Color(16777215),this.map=null,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=d.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=d.SmoothShading,this.blending=d.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=d.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(a)},d.MeshBasicMaterial.prototype=Object.create(d.Material.prototype),d.MeshBasicMaterial.prototype.constructor=d.MeshBasicMaterial,d.MeshBasicMaterial.prototype.copy=function(a){return d.Material.prototype.copy.call(this,a),this.color.copy(a.color),this.map=a.map,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.fog=a.fog,this.shading=a.shading,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.vertexColors=a.vertexColors,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this},d.MeshLambertMaterial=function(a){d.Material.call(this),this.type="MeshLambertMaterial",this.color=new d.Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new d.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=d.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.blending=d.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=d.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)},d.MeshLambertMaterial.prototype=Object.create(d.Material.prototype),d.MeshLambertMaterial.prototype.constructor=d.MeshLambertMaterial,d.MeshLambertMaterial.prototype.copy=function(a){return d.Material.prototype.copy.call(this,a),this.color.copy(a.color),this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.fog=a.fog,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.vertexColors=a.vertexColors,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this},d.MeshPhongMaterial=function(a){d.Material.call(this),this.type="MeshPhongMaterial",this.color=new d.Color(16777215),this.specular=new d.Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new d.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new d.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=d.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=d.SmoothShading,this.blending=d.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=d.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)},d.MeshPhongMaterial.prototype=Object.create(d.Material.prototype),d.MeshPhongMaterial.prototype.constructor=d.MeshPhongMaterial,d.MeshPhongMaterial.prototype.copy=function(a){return d.Material.prototype.copy.call(this,a),this.color.copy(a.color),this.specular.copy(a.specular),this.shininess=a.shininess,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.specularMap=a.specularMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.combine=a.combine,this.reflectivity=a.reflectivity,this.refractionRatio=a.refractionRatio,this.fog=a.fog,this.shading=a.shading,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.vertexColors=a.vertexColors,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this},d.MeshStandardMaterial=function(a){d.Material.call(this),this.type="MeshStandardMaterial",this.color=new d.Color(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new d.Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new d.Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.fog=!0,this.shading=d.SmoothShading,this.blending=d.NormalBlending,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=d.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(a)},d.MeshStandardMaterial.prototype=Object.create(d.Material.prototype),d.MeshStandardMaterial.prototype.constructor=d.MeshStandardMaterial,d.MeshStandardMaterial.prototype.copy=function(a){return d.Material.prototype.copy.call(this,a),this.color.copy(a.color),this.roughness=a.roughness,this.metalness=a.metalness,this.map=a.map,this.lightMap=a.lightMap,this.lightMapIntensity=a.lightMapIntensity,this.aoMap=a.aoMap,this.aoMapIntensity=a.aoMapIntensity,this.emissive.copy(a.emissive),this.emissiveMap=a.emissiveMap,this.emissiveIntensity=a.emissiveIntensity,this.bumpMap=a.bumpMap,this.bumpScale=a.bumpScale,this.normalMap=a.normalMap,this.normalScale.copy(a.normalScale),this.displacementMap=a.displacementMap,this.displacementScale=a.displacementScale,this.displacementBias=a.displacementBias,this.roughnessMap=a.roughnessMap,this.metalnessMap=a.metalnessMap,this.alphaMap=a.alphaMap,this.envMap=a.envMap,this.envMapIntensity=a.envMapIntensity,this.refractionRatio=a.refractionRatio,this.fog=a.fog,this.shading=a.shading,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.wireframeLinecap=a.wireframeLinecap,this.wireframeLinejoin=a.wireframeLinejoin,this.vertexColors=a.vertexColors,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this},d.MeshDepthMaterial=function(a){d.Material.call(this),this.type="MeshDepthMaterial",this.morphTargets=!1,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(a)},d.MeshDepthMaterial.prototype=Object.create(d.Material.prototype),d.MeshDepthMaterial.prototype.constructor=d.MeshDepthMaterial,d.MeshDepthMaterial.prototype.copy=function(a){return d.Material.prototype.copy.call(this,a),this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this},d.MeshNormalMaterial=function(a){d.Material.call(this,a),this.type="MeshNormalMaterial",this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(a)},d.MeshNormalMaterial.prototype=Object.create(d.Material.prototype),d.MeshNormalMaterial.prototype.constructor=d.MeshNormalMaterial,d.MeshNormalMaterial.prototype.copy=function(a){return d.Material.prototype.copy.call(this,a),this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this},d.MultiMaterial=function(a){this.uuid=d.Math.generateUUID(),this.type="MultiMaterial",this.materials=a instanceof Array?a:[],this.visible=!0},d.MultiMaterial.prototype={constructor:d.MultiMaterial,toJSON:function(a){for(var b={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]},c=this.materials,d=0,e=c.length;d<e;d++){var f=c[d].toJSON(a);delete f.metadata,b.materials.push(f)}return b.visible=this.visible,b},clone:function(){for(var a=new this.constructor,b=0;b<this.materials.length;b++)a.materials.push(this.materials[b].clone());return a.visible=this.visible,a}},d.PointsMaterial=function(a){d.Material.call(this),this.type="PointsMaterial",this.color=new d.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.blending=d.NormalBlending,this.vertexColors=d.NoColors,this.fog=!0,this.setValues(a)},d.PointsMaterial.prototype=Object.create(d.Material.prototype),d.PointsMaterial.prototype.constructor=d.PointsMaterial,d.PointsMaterial.prototype.copy=function(a){return d.Material.prototype.copy.call(this,a),this.color.copy(a.color),this.map=a.map,this.size=a.size,this.sizeAttenuation=a.sizeAttenuation,this.vertexColors=a.vertexColors,this.fog=a.fog,this},d.ShaderMaterial=function(a){d.Material.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.shading=d.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=d.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==a&&(void 0!==a.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(a))},d.ShaderMaterial.prototype=Object.create(d.Material.prototype),d.ShaderMaterial.prototype.constructor=d.ShaderMaterial,d.ShaderMaterial.prototype.copy=function(a){return d.Material.prototype.copy.call(this,a),this.fragmentShader=a.fragmentShader,this.vertexShader=a.vertexShader,this.uniforms=d.UniformsUtils.clone(a.uniforms),this.defines=a.defines,this.shading=a.shading,this.wireframe=a.wireframe,this.wireframeLinewidth=a.wireframeLinewidth,this.fog=a.fog,this.lights=a.lights,this.vertexColors=a.vertexColors,this.skinning=a.skinning,this.morphTargets=a.morphTargets,this.morphNormals=a.morphNormals,this.extensions=a.extensions,this},d.ShaderMaterial.prototype.toJSON=function(a){var b=d.Material.prototype.toJSON.call(this,a);return b.uniforms=this.uniforms,b.vertexShader=this.vertexShader,b.fragmentShader=this.fragmentShader,b},d.RawShaderMaterial=function(a){d.ShaderMaterial.call(this,a),this.type="RawShaderMaterial"},d.RawShaderMaterial.prototype=Object.create(d.ShaderMaterial.prototype),d.RawShaderMaterial.prototype.constructor=d.RawShaderMaterial,d.SpriteMaterial=function(a){d.Material.call(this),this.type="SpriteMaterial",this.color=new d.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(a)},d.SpriteMaterial.prototype=Object.create(d.Material.prototype),d.SpriteMaterial.prototype.constructor=d.SpriteMaterial,d.SpriteMaterial.prototype.copy=function(a){return d.Material.prototype.copy.call(this,a),this.color.copy(a.color),this.map=a.map,this.rotation=a.rotation,this.fog=a.fog,this},d.Texture=function(a,b,c,e,f,g,h,i,j){Object.defineProperty(this,"id",{value:d.TextureIdCount++}),this.uuid=d.Math.generateUUID(),this.name="",this.sourceFile="",this.image=void 0!==a?a:d.Texture.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==b?b:d.Texture.DEFAULT_MAPPING,this.wrapS=void 0!==c?c:d.ClampToEdgeWrapping,this.wrapT=void 0!==e?e:d.ClampToEdgeWrapping,this.magFilter=void 0!==f?f:d.LinearFilter,this.minFilter=void 0!==g?g:d.LinearMipMapLinearFilter,this.anisotropy=void 0!==j?j:1,this.format=void 0!==h?h:d.RGBAFormat,this.type=void 0!==i?i:d.UnsignedByteType,this.offset=new d.Vector2(0,0),this.repeat=new d.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=d.LinearEncoding,this.version=0,this.onUpdate=null},d.Texture.DEFAULT_IMAGE=void 0,d.Texture.DEFAULT_MAPPING=d.UVMapping,d.Texture.prototype={constructor:d.Texture,set needsUpdate(a){!0===a&&this.version++},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.image=a.image,this.mipmaps=a.mipmaps.slice(0),this.mapping=a.mapping,this.wrapS=a.wrapS,this.wrapT=a.wrapT,this.magFilter=a.magFilter,this.minFilter=a.minFilter,this.anisotropy=a.anisotropy,this.format=a.format,this.type=a.type,this.offset.copy(a.offset),this.repeat.copy(a.repeat),this.generateMipmaps=a.generateMipmaps,this.premultiplyAlpha=a.premultiplyAlpha,this.flipY=a.flipY,this.unpackAlignment=a.unpackAlignment,this.encoding=a.encoding,this},toJSON:function(a){if(void 0!==a.textures[this.uuid])return a.textures[this.uuid];var b={metadata:{version:4.4,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy};if(void 0!==this.image){var c=this.image;void 0===c.uuid&&(c.uuid=d.Math.generateUUID()),void 0===a.images[c.uuid]&&(a.images[c.uuid]={uuid:c.uuid,url:function(a){var b;return void 0!==a.toDataURL?b=a:(b=document.createElement("canvas"),b.width=a.width,b.height=a.height,b.getContext("2d").drawImage(a,0,0,a.width,a.height)),b.width>2048||b.height>2048?b.toDataURL("image/jpeg",.6):b.toDataURL("image/png")}(c)}),b.image=c.uuid}return a.textures[this.uuid]=b,b},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(a){if(this.mapping===d.UVMapping){if(a.multiply(this.repeat),a.add(this.offset),a.x<0||a.x>1)switch(this.wrapS){case d.RepeatWrapping:a.x=a.x-Math.floor(a.x);break;case d.ClampToEdgeWrapping:a.x=a.x<0?0:1;break;case d.MirroredRepeatWrapping:1===Math.abs(Math.floor(a.x)%2)?a.x=Math.ceil(a.x)-a.x:a.x=a.x-Math.floor(a.x)}if(a.y<0||a.y>1)switch(this.wrapT){case d.RepeatWrapping:a.y=a.y-Math.floor(a.y);break;case d.ClampToEdgeWrapping:a.y=a.y<0?0:1;break;case d.MirroredRepeatWrapping:1===Math.abs(Math.floor(a.y)%2)?a.y=Math.ceil(a.y)-a.y:a.y=a.y-Math.floor(a.y)}this.flipY&&(a.y=1-a.y)}}},d.EventDispatcher.prototype.apply(d.Texture.prototype),d.TextureIdCount=0,d.CanvasTexture=function(a,b,c,e,f,g,h,i,j){d.Texture.call(this,a,b,c,e,f,g,h,i,j),this.needsUpdate=!0},d.CanvasTexture.prototype=Object.create(d.Texture.prototype),d.CanvasTexture.prototype.constructor=d.CanvasTexture,d.CubeTexture=function(a,b,c,e,f,g,h,i,j){a=void 0!==a?a:[],b=void 0!==b?b:d.CubeReflectionMapping,d.Texture.call(this,a,b,c,e,f,g,h,i,j),this.flipY=!1},d.CubeTexture.prototype=Object.create(d.Texture.prototype),d.CubeTexture.prototype.constructor=d.CubeTexture,Object.defineProperty(d.CubeTexture.prototype,"images",{get:function(){return this.image},set:function(a){this.image=a}}),d.CompressedTexture=function(a,b,c,e,f,g,h,i,j,k,l){d.Texture.call(this,null,g,h,i,j,k,e,f,l),this.image={width:b,height:c},this.mipmaps=a,this.flipY=!1,this.generateMipmaps=!1},d.CompressedTexture.prototype=Object.create(d.Texture.prototype),d.CompressedTexture.prototype.constructor=d.CompressedTexture,d.DataTexture=function(a,b,c,e,f,g,h,i,j,k,l){d.Texture.call(this,null,g,h,i,j,k,e,f,l),this.image={data:a,width:b,height:c},this.magFilter=void 0!==j?j:d.NearestFilter,this.minFilter=void 0!==k?k:d.NearestFilter,this.flipY=!1,this.generateMipmaps=!1},d.DataTexture.prototype=Object.create(d.Texture.prototype),d.DataTexture.prototype.constructor=d.DataTexture,d.VideoTexture=function(a,b,c,e,f,g,h,i,j){function k(){requestAnimationFrame(k),a.readyState===a.HAVE_ENOUGH_DATA&&(l.needsUpdate=!0)}d.Texture.call(this,a,b,c,e,f,g,h,i,j),this.generateMipmaps=!1;var l=this;k()},d.VideoTexture.prototype=Object.create(d.Texture.prototype),d.VideoTexture.prototype.constructor=d.VideoTexture,d.Group=function(){d.Object3D.call(this),this.type="Group"},d.Group.prototype=Object.create(d.Object3D.prototype),d.Group.prototype.constructor=d.Group,d.Points=function(a,b){d.Object3D.call(this),this.type="Points",this.geometry=void 0!==a?a:new d.Geometry,this.material=void 0!==b?b:new d.PointsMaterial({color:16777215*Math.random()})},d.Points.prototype=Object.create(d.Object3D.prototype),d.Points.prototype.constructor=d.Points,d.Points.prototype.raycast=function(){var a=new d.Matrix4,b=new d.Ray,c=new d.Sphere;return function(e,f){function g(a,c){var d=b.distanceSqToPoint(a);if(d<m){var g=b.closestPointToPoint(a);g.applyMatrix4(j);var i=e.ray.origin.distanceTo(g);if(i<e.near||i>e.far)return;f.push({distance:i,distanceToRay:Math.sqrt(d),point:g.clone(),index:c,face:null,object:h})}}var h=this,i=this.geometry,j=this.matrixWorld,k=e.params.Points.threshold;if(null===i.boundingSphere&&i.computeBoundingSphere(),c.copy(i.boundingSphere),c.applyMatrix4(j),!1!==e.ray.intersectsSphere(c)){a.getInverse(j),b.copy(e.ray).applyMatrix4(a);var l=k/((this.scale.x+this.scale.y+this.scale.z)/3),m=l*l,n=new d.Vector3;if(i instanceof d.BufferGeometry){var o=i.index,p=i.attributes,q=p.position.array;if(null!==o)for(var r=o.array,s=0,t=r.length;s<t;s++){var u=r[s];n.fromArray(q,3*u),g(n,u)}else for(var s=0,v=q.length/3;s<v;s++)n.fromArray(q,3*s),g(n,s)}else for(var w=i.vertices,s=0,v=w.length;s<v;s++)g(w[s],s)}}}(),d.Points.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},d.Line=function(a,b,c){if(1===c)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new d.LineSegments(a,b);d.Object3D.call(this),this.type="Line",this.geometry=void 0!==a?a:new d.Geometry,this.material=void 0!==b?b:new d.LineBasicMaterial({color:16777215*Math.random()})},d.Line.prototype=Object.create(d.Object3D.prototype),d.Line.prototype.constructor=d.Line,d.Line.prototype.raycast=function(){var a=new d.Matrix4,b=new d.Ray,c=new d.Sphere;return function(e,f){var g=e.linePrecision,h=g*g,i=this.geometry,j=this.matrixWorld;if(null===i.boundingSphere&&i.computeBoundingSphere(),c.copy(i.boundingSphere),c.applyMatrix4(j),!1!==e.ray.intersectsSphere(c)){a.getInverse(j),b.copy(e.ray).applyMatrix4(a);var k=new d.Vector3,l=new d.Vector3,m=new d.Vector3,n=new d.Vector3,o=this instanceof d.LineSegments?2:1;if(i instanceof d.BufferGeometry){var p=i.index,q=i.attributes,r=q.position.array;if(null!==p)for(var s=p.array,t=0,u=s.length-1;t<u;t+=o){var v=s[t],w=s[t+1];k.fromArray(r,3*v),l.fromArray(r,3*w);var x=b.distanceSqToSegment(k,l,n,m);if(!(x>h)){n.applyMatrix4(this.matrixWorld);var y=e.ray.origin.distanceTo(n);y<e.near||y>e.far||f.push({distance:y,point:m.clone().applyMatrix4(this.matrixWorld),index:t,face:null,faceIndex:null,object:this})}}else for(var t=0,u=r.length/3-1;t<u;t+=o){k.fromArray(r,3*t),l.fromArray(r,3*t+3);var x=b.distanceSqToSegment(k,l,n,m);if(!(x>h)){n.applyMatrix4(this.matrixWorld);var y=e.ray.origin.distanceTo(n);y<e.near||y>e.far||f.push({distance:y,point:m.clone().applyMatrix4(this.matrixWorld),index:t,face:null,faceIndex:null,object:this})}}}else if(i instanceof d.Geometry)for(var z=i.vertices,A=z.length,t=0;t<A-1;t+=o){var x=b.distanceSqToSegment(z[t],z[t+1],n,m);if(!(x>h)){n.applyMatrix4(this.matrixWorld);var y=e.ray.origin.distanceTo(n);y<e.near||y>e.far||f.push({distance:y,point:m.clone().applyMatrix4(this.matrixWorld),index:t,face:null,faceIndex:null,object:this})}}}}}(),d.Line.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},d.LineStrip=0,d.LinePieces=1,d.LineSegments=function(a,b){d.Line.call(this,a,b),this.type="LineSegments"},d.LineSegments.prototype=Object.create(d.Line.prototype),d.LineSegments.prototype.constructor=d.LineSegments,d.Mesh=function(a,b){d.Object3D.call(this),this.type="Mesh",this.geometry=void 0!==a?a:new d.Geometry,this.material=void 0!==b?b:new d.MeshBasicMaterial({color:16777215*Math.random()}),this.drawMode=d.TrianglesDrawMode,this.updateMorphTargets()},d.Mesh.prototype=Object.create(d.Object3D.prototype),d.Mesh.prototype.constructor=d.Mesh,d.Mesh.prototype.setDrawMode=function(a){this.drawMode=a},d.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var a=0,b=this.geometry.morphTargets.length;a<b;a++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}},d.Mesh.prototype.getMorphTargetIndexByName=function(a){return void 0!==this.morphTargetDictionary[a]?this.morphTargetDictionary[a]:(console.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+a+" does not exist. Returning 0."),0)},d.Mesh.prototype.raycast=function(){function a(a,b,c,e,f,g,h){return d.Triangle.barycoordFromPoint(a,b,c,e,q),f.multiplyScalar(q.x),g.multiplyScalar(q.y),h.multiplyScalar(q.z),f.add(g).add(h),f.clone()}function b(a,b,c,e,f,g,h){var i=a.material;if(null===(i.side===d.BackSide?c.intersectTriangle(g,f,e,!0,h):c.intersectTriangle(e,f,g,i.side!==d.DoubleSide,h)))return null;s.copy(h),s.applyMatrix4(a.matrixWorld);var j=b.ray.origin.distanceTo(s);return j<b.near||j>b.far?null:{distance:j,point:s.clone(),object:a}}function c(c,e,f,g,k,l,m,q){h.fromArray(g,3*l),i.fromArray(g,3*m),j.fromArray(g,3*q);var s=b(c,e,f,h,i,j,r);return s&&(k&&(n.fromArray(k,2*l),o.fromArray(k,2*m),p.fromArray(k,2*q),s.uv=a(r,h,i,j,n,o,p)),s.face=new d.Face3(l,m,q,d.Triangle.normal(h,i,j)),s.faceIndex=l),s}var e=new d.Matrix4,f=new d.Ray,g=new d.Sphere,h=new d.Vector3,i=new d.Vector3,j=new d.Vector3,k=new d.Vector3,l=new d.Vector3,m=new d.Vector3,n=new d.Vector2,o=new d.Vector2,p=new d.Vector2,q=new d.Vector3,r=new d.Vector3,s=new d.Vector3;return function(q,s){var t=this.geometry,u=this.material,v=this.matrixWorld;if(void 0!==u&&(null===t.boundingSphere&&t.computeBoundingSphere(),g.copy(t.boundingSphere),g.applyMatrix4(v),!1!==q.ray.intersectsSphere(g)&&(e.getInverse(v),f.copy(q.ray).applyMatrix4(e),null===t.boundingBox||!1!==f.intersectsBox(t.boundingBox)))){var w,x;if(t instanceof d.BufferGeometry){var y,z,A,B=t.index,C=t.attributes,D=C.position.array;if(void 0!==C.uv&&(w=C.uv.array),null!==B)for(var E=B.array,F=0,G=E.length;F<G;F+=3)y=E[F],z=E[F+1],A=E[F+2],(x=c(this,q,f,D,w,y,z,A))&&(x.faceIndex=Math.floor(F/3),s.push(x));else for(var F=0,G=D.length;F<G;F+=9)y=F/3,z=y+1,A=y+2,(x=c(this,q,f,D,w,y,z,A))&&(x.index=y,s.push(x))}else if(t instanceof d.Geometry){var H,I,J,K=u instanceof d.MultiMaterial,L=!0===K?u.materials:null,M=t.vertices,N=t.faces,O=t.faceVertexUvs[0];O.length>0&&(w=O);for(var P=0,Q=N.length;P<Q;P++){var R=N[P],S=!0===K?L[R.materialIndex]:u;if(void 0!==S){if(H=M[R.a],I=M[R.b],J=M[R.c],!0===S.morphTargets){var T=t.morphTargets,U=this.morphTargetInfluences;h.set(0,0,0),i.set(0,0,0),j.set(0,0,0);for(var V=0,W=T.length;V<W;V++){var X=U[V];if(0!==X){var Y=T[V].vertices;h.addScaledVector(k.subVectors(Y[R.a],H),X),i.addScaledVector(l.subVectors(Y[R.b],I),X),j.addScaledVector(m.subVectors(Y[R.c],J),X)}}h.add(H),i.add(I),j.add(J),H=h,I=i,J=j}if(x=b(this,q,f,H,I,J,r)){if(w){var Z=w[P];n.copy(Z[0]),o.copy(Z[1]),p.copy(Z[2]),x.uv=a(r,H,I,J,n,o,p)}x.face=R,x.faceIndex=P,s.push(x)}}}}}}}(),d.Mesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material).copy(this)},d.Bone=function(a){d.Object3D.call(this),this.type="Bone",this.skin=a},d.Bone.prototype=Object.create(d.Object3D.prototype),d.Bone.prototype.constructor=d.Bone,d.Bone.prototype.copy=function(a){return d.Object3D.prototype.copy.call(this,a),this.skin=a.skin,this},d.Skeleton=function(a,b,c){if(this.useVertexTexture=void 0===c||c,this.identityMatrix=new d.Matrix4,a=a||[],this.bones=a.slice(0),this.useVertexTexture){var e=Math.sqrt(4*this.bones.length);e=d.Math.nextPowerOfTwo(Math.ceil(e)),e=Math.max(e,4),this.boneTextureWidth=e,this.boneTextureHeight=e,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new d.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,d.RGBAFormat,d.FloatType)}else this.boneMatrices=new Float32Array(16*this.bones.length);if(void 0===b)this.calculateInverses();else if(this.bones.length===b.length)this.boneInverses=b.slice(0);else{console.warn("THREE.Skeleton bonInverses is the wrong length."),this.boneInverses=[];for(var f=0,g=this.bones.length;f<g;f++)this.boneInverses.push(new d.Matrix4)}},d.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var a=0,b=this.bones.length;a<b;a++){var c=new d.Matrix4;this.bones[a]&&c.getInverse(this.bones[a].matrixWorld),this.boneInverses.push(c)}},d.Skeleton.prototype.pose=function(){for(var a,b=0,c=this.bones.length;b<c;b++)(a=this.bones[b])&&a.matrixWorld.getInverse(this.boneInverses[b]);for(var b=0,c=this.bones.length;b<c;b++)(a=this.bones[b])&&(a.parent?(a.matrix.getInverse(a.parent.matrixWorld),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale))},d.Skeleton.prototype.update=function(){var a=new d.Matrix4;return function(){for(var b=0,c=this.bones.length;b<c;b++){var d=this.bones[b]?this.bones[b].matrixWorld:this.identityMatrix;a.multiplyMatrices(d,this.boneInverses[b]),a.flattenToArrayOffset(this.boneMatrices,16*b)}
this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),d.Skeleton.prototype.clone=function(){return new d.Skeleton(this.bones,this.boneInverses,this.useVertexTexture)},d.SkinnedMesh=function(a,b,c){d.Mesh.call(this,a,b),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new d.Matrix4,this.bindMatrixInverse=new d.Matrix4;var e=[];if(this.geometry&&void 0!==this.geometry.bones){for(var f,g,h=0,i=this.geometry.bones.length;h<i;++h)g=this.geometry.bones[h],f=new d.Bone(this),e.push(f),f.name=g.name,f.position.fromArray(g.pos),f.quaternion.fromArray(g.rotq),void 0!==g.scl&&f.scale.fromArray(g.scl);for(var h=0,i=this.geometry.bones.length;h<i;++h)g=this.geometry.bones[h],-1!==g.parent&&null!==g.parent?e[g.parent].add(e[h]):this.add(e[h])}this.normalizeSkinWeights(),this.updateMatrixWorld(!0),this.bind(new d.Skeleton(e,void 0,c),this.matrixWorld)},d.SkinnedMesh.prototype=Object.create(d.Mesh.prototype),d.SkinnedMesh.prototype.constructor=d.SkinnedMesh,d.SkinnedMesh.prototype.bind=function(a,b){this.skeleton=a,void 0===b&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),b=this.matrixWorld),this.bindMatrix.copy(b),this.bindMatrixInverse.getInverse(b)},d.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()},d.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof d.Geometry)for(var a=0;a<this.geometry.skinWeights.length;a++){var b=this.geometry.skinWeights[a],c=1/b.lengthManhattan();c!==1/0?b.multiplyScalar(c):b.set(1,0,0,0)}else if(this.geometry instanceof d.BufferGeometry)for(var e=new d.Vector4,f=this.geometry.attributes.skinWeight,a=0;a<f.count;a++){e.x=f.getX(a),e.y=f.getY(a),e.z=f.getZ(a),e.w=f.getW(a);var c=1/e.lengthManhattan();c!==1/0?e.multiplyScalar(c):e.set(1,0,0,0),f.setXYZW(a,e.x,e.y,e.z,e.w)}},d.SkinnedMesh.prototype.updateMatrixWorld=function(a){d.Mesh.prototype.updateMatrixWorld.call(this,!0),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh unrecognized bindMode: "+this.bindMode)},d.SkinnedMesh.prototype.clone=function(){return new this.constructor(this.geometry,this.material,this.useVertexTexture).copy(this)},d.LOD=function(){d.Object3D.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}})},d.LOD.prototype=Object.create(d.Object3D.prototype),d.LOD.prototype.constructor=d.LOD,d.LOD.prototype.addLevel=function(a,b){void 0===b&&(b=0),b=Math.abs(b);for(var c=this.levels,d=0;d<c.length&&!(b<c[d].distance);d++);c.splice(d,0,{distance:b,object:a}),this.add(a)},d.LOD.prototype.getObjectForDistance=function(a){for(var b=this.levels,c=1,d=b.length;c<d&&!(a<b[c].distance);c++);return b[c-1].object},d.LOD.prototype.raycast=function(){var a=new d.Vector3;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var d=b.ray.origin.distanceTo(a);this.getObjectForDistance(d).raycast(b,c)}}(),d.LOD.prototype.update=function(){var a=new d.Vector3,b=new d.Vector3;return function(c){var d=this.levels;if(d.length>1){a.setFromMatrixPosition(c.matrixWorld),b.setFromMatrixPosition(this.matrixWorld);var e=a.distanceTo(b);d[0].object.visible=!0;for(var f=1,g=d.length;f<g&&e>=d[f].distance;f++)d[f-1].object.visible=!1,d[f].object.visible=!0;for(;f<g;f++)d[f].object.visible=!1}}}(),d.LOD.prototype.copy=function(a){d.Object3D.prototype.copy.call(this,a,!1);for(var b=a.levels,c=0,e=b.length;c<e;c++){var f=b[c];this.addLevel(f.object.clone(),f.distance)}return this},d.LOD.prototype.toJSON=function(a){var b=d.Object3D.prototype.toJSON.call(this,a);b.object.levels=[];for(var c=this.levels,e=0,f=c.length;e<f;e++){var g=c[e];b.object.levels.push({object:g.object.uuid,distance:g.distance})}return b},d.Sprite=function(){var a=new Uint16Array([0,1,2,0,2,3]),b=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),c=new Float32Array([0,0,1,0,1,1,0,1]),e=new d.BufferGeometry;return e.setIndex(new d.BufferAttribute(a,1)),e.addAttribute("position",new d.BufferAttribute(b,3)),e.addAttribute("uv",new d.BufferAttribute(c,2)),function(a){d.Object3D.call(this),this.type="Sprite",this.geometry=e,this.material=void 0!==a?a:new d.SpriteMaterial}}(),d.Sprite.prototype=Object.create(d.Object3D.prototype),d.Sprite.prototype.constructor=d.Sprite,d.Sprite.prototype.raycast=function(){var a=new d.Vector3;return function(b,c){a.setFromMatrixPosition(this.matrixWorld);var d=b.ray.distanceSqToPoint(a);d>this.scale.x*this.scale.y||c.push({distance:Math.sqrt(d),point:this.position,face:null,object:this})}}(),d.Sprite.prototype.clone=function(){return new this.constructor(this.material).copy(this)},d.Particle=d.Sprite,d.LensFlare=function(a,b,c,e,f){d.Object3D.call(this),this.lensFlares=[],this.positionScreen=new d.Vector3,this.customUpdateCallback=void 0,void 0!==a&&this.add(a,b,c,e,f)},d.LensFlare.prototype=Object.create(d.Object3D.prototype),d.LensFlare.prototype.constructor=d.LensFlare,d.LensFlare.prototype.add=function(a,b,c,e,f,g){void 0===b&&(b=-1),void 0===c&&(c=0),void 0===g&&(g=1),void 0===f&&(f=new d.Color(16777215)),void 0===e&&(e=d.NormalBlending),c=Math.min(c,Math.max(0,c)),this.lensFlares.push({texture:a,size:b,distance:c,x:0,y:0,z:0,scale:1,rotation:0,opacity:g,color:f,blending:e})},d.LensFlare.prototype.updateLensFlares=function(){var a,b,c=this.lensFlares.length,d=2*-this.positionScreen.x,e=2*-this.positionScreen.y;for(a=0;a<c;a++)b=this.lensFlares[a],b.x=this.positionScreen.x+d*b.distance,b.y=this.positionScreen.y+e*b.distance,b.wantedRotation=b.x*Math.PI*.25,b.rotation+=.25*(b.wantedRotation-b.rotation)},d.LensFlare.prototype.copy=function(a){d.Object3D.prototype.copy.call(this,a),this.positionScreen.copy(a.positionScreen),this.customUpdateCallback=a.customUpdateCallback;for(var b=0,c=a.lensFlares.length;b<c;b++)this.lensFlares.push(a.lensFlares[b]);return this},d.Scene=function(){d.Object3D.call(this),this.type="Scene",this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0},d.Scene.prototype=Object.create(d.Object3D.prototype),d.Scene.prototype.constructor=d.Scene,d.Scene.prototype.copy=function(a,b){return d.Object3D.prototype.copy.call(this,a,b),null!==a.fog&&(this.fog=a.fog.clone()),null!==a.overrideMaterial&&(this.overrideMaterial=a.overrideMaterial.clone()),this.autoUpdate=a.autoUpdate,this.matrixAutoUpdate=a.matrixAutoUpdate,this},d.Fog=function(a,b,c){this.name="",this.color=new d.Color(a),this.near=void 0!==b?b:1,this.far=void 0!==c?c:1e3},d.Fog.prototype.clone=function(){return new d.Fog(this.color.getHex(),this.near,this.far)},d.FogExp2=function(a,b){this.name="",this.color=new d.Color(a),this.density=void 0!==b?b:25e-5},d.FogExp2.prototype.clone=function(){return new d.FogExp2(this.color.getHex(),this.density)},d.ShaderChunk={},d.ShaderChunk.alphamap_fragment="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",d.ShaderChunk.alphamap_pars_fragment="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",d.ShaderChunk.alphatest_fragment="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",d.ShaderChunk.aomap_fragment="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",d.ShaderChunk.aomap_pars_fragment="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",d.ShaderChunk.begin_vertex="\nvec3 transformed = vec3( position );\n",d.ShaderChunk.beginnormal_vertex="\nvec3 objectNormal = vec3( normal );\n",d.ShaderChunk.bsdfs="bool testLightInRange( const in float lightDistance, const in float cutoffDistance ) {\n\treturn any( bvec2( cutoffDistance == 0.0, lightDistance < cutoffDistance ) );\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t\t}\n\t\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_Smith( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",d.ShaderChunk.bumpmap_pars_fragment="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",d.ShaderChunk.color_fragment="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",d.ShaderChunk.color_pars_fragment="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",d.ShaderChunk.color_pars_vertex="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",d.ShaderChunk.color_vertex="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",d.ShaderChunk.common="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\n",d.ShaderChunk.cube_uv_reflection_fragment="#ifdef ENVMAP_TYPE_CUBE_UV\nconst float cubeUV_textureSize = 1024.0;\nint getFaceFromDirection(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    int face = -1;\n    if( absDirection.x > absDirection.z ) {\n        if(absDirection.x > absDirection.y )\n            face = direction.x > 0.0 ? 0 : 3;\n        else\n            face = direction.y > 0.0 ? 1 : 4;\n    }\n    else {\n        if(absDirection.z > absDirection.y )\n            face = direction.z > 0.0 ? 2 : 5;\n        else\n            face = direction.y > 0.0 ? 1 : 4;\n    }\n    return face;\n}\nconst float cubeUV_maxLods1 = log2(cubeUV_textureSize*0.25) - 1.0;\nconst float cubeUV_rangeClamp = exp2((6.0 - 1.0) * 2.0);\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n    float scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n    float dxRoughness = dFdx(roughness);\n    float dyRoughness = dFdy(roughness);\n    vec3 dx = dFdx( vec * scale * dxRoughness );\n    vec3 dy = dFdy( vec * scale * dyRoughness );\n    float d = max( dot( dx, dx ), dot( dy, dy ) );\n    d = clamp(d, 1.0, cubeUV_rangeClamp);\n    float mipLevel = 0.5 * log2(d);\n    return vec2(floor(mipLevel), fract(mipLevel));\n}\nconst float cubeUV_maxLods2 = log2(cubeUV_textureSize*0.25) - 2.0;\nconst float cubeUV_rcpTextureSize = 1.0 / cubeUV_textureSize;\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n    mipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n    float a = 16.0 * cubeUV_rcpTextureSize;\n    vec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n    vec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n    float powScale = exp2_packed.x * exp2_packed.y;\n    float scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n    float mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n    bool bRes = mipLevel == 0.0;\n    scale =  bRes && (scale < a) ? a : scale;\n    vec3 r;\n    vec2 offset;\n    int face = getFaceFromDirection(direction);\n    float rcpPowScale = 1.0 / powScale;\n    if( face == 0) {\n        r = vec3(direction.x, -direction.z, direction.y);\n        offset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n        offset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n    }\n    else if( face == 1) {\n        r = vec3(direction.y, direction.x, direction.z);\n        offset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n        offset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n    }\n    else if( face == 2) {\n        r = vec3(direction.z, direction.x, direction.y);\n        offset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n        offset.y = bRes && (offset.y < 2.0*a) ?  a : offset.y;\n    }\n    else if( face == 3) {\n        r = vec3(direction.x, direction.z, direction.y);\n        offset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n        offset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n    }\n    else if( face == 4) {\n        r = vec3(direction.y, direction.x, -direction.z);\n        offset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n        offset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n    }\n    else {\n        r = vec3(direction.z, -direction.x, direction.y);\n        offset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n        offset.y = bRes && (offset.y < 2.0*a) ?  0.0 : offset.y;\n    }\n    r = normalize(r);\n    float texelOffset = 0.5 * cubeUV_rcpTextureSize;\n    vec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n    vec2 base = offset + vec2( texelOffset );\n    return base + s * ( scale - 2.0 * texelOffset );\n}\nconst float cubeUV_maxLods3 = log2(cubeUV_textureSize*0.25) - 3.0;\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n    float roughnessVal = roughness* cubeUV_maxLods3;\n    float r1 = floor(roughnessVal);\n    float r2 = r1 + 1.0;\n    float t = fract(roughnessVal);\n    vec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n    float s = mipInfo.y;\n    float level0 = mipInfo.x;\n    float level1 = level0 + 1.0;\n    level1 = level1 > 5.0 ? 5.0 : level1;\n    level0 += min( floor( s + 0.5 ), 5.0 );\n    vec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n    vec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n    vec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n    vec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n    vec4 result = mix(color10, color20, t);\n    return vec4(result.rgb, 1.0);\n}\n#endif\n",d.ShaderChunk.defaultnormal_vertex="#ifdef FLIP_SIDED\n\tobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;\n",d.ShaderChunk.displacementmap_vertex="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normal * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",d.ShaderChunk.displacementmap_pars_vertex="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",d.ShaderChunk.emissivemap_fragment="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",d.ShaderChunk.emissivemap_pars_fragment="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",d.ShaderChunk.encodings_pars_fragment="\nvec4 LinearToLinear( in vec4 value ) {\n  return value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n  return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n  return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n  float maxComponent = max( max( value.r, value.g ), value.b );\n  float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n  return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n  return vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n  float maxRGB = max( value.x, max( value.g, value.b ) );\n  float M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n  M            = ceil( M * 255.0 ) / 255.0;\n  return vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n    return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n    float maxRGB = max( value.x, max( value.g, value.b ) );\n    float D      = max( maxRange / maxRGB, 1.0 );\n    D            = min( floor( D ) / 255.0, 1.0 );\n    return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n  vec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n  Xp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n  vec4 vResult;\n  vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n  float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n  vResult.w = fract(Le);\n  vResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n  return vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n  float Le = value.z * 255.0 + value.w;\n  vec3 Xp_Y_XYZp;\n  Xp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n  Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n  Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n  vec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n  return vec4( max(vRGB, 0.0), 1.0 );\n}\n",d.ShaderChunk.encodings_fragment="  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",d.ShaderChunk.envmap_fragment="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",d.ShaderChunk.envmap_pars_fragment="#if defined( USE_ENVMAP ) || defined( STANDARD )\n\tuniform float reflectivity;\n\tuniform float envMapIntenstiy;\n#endif\n#ifdef USE_ENVMAP\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( STANDARD )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",d.ShaderChunk.envmap_pars_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG ) && ! defined( STANDARD )\n\tvarying vec3 vReflect;\n\tuniform float refractionRatio;\n#endif\n",d.ShaderChunk.envmap_vertex="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG ) && ! defined( STANDARD )\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t#ifdef ENVMAP_MODE_REFLECTION\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t#else\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t#endif\n#endif\n",d.ShaderChunk.fog_fragment="#ifdef USE_FOG\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * depth * depth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",d.ShaderChunk.fog_pars_fragment="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",d.ShaderChunk.lightmap_fragment="#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",d.ShaderChunk.lightmap_pars_fragment="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",d.ShaderChunk.lights_lambert_vertex="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tdirectLight = getPointDirectLightIrradiance( pointLights[ i ], geometry );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tdirectLight = getSpotDirectLightIrradiance( spotLights[ i ], geometry );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectLight = getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",
d.ShaderChunk.lights_pars="uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tIncidentLight getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry ) {\n\t\tIncidentLight directLight;\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t\treturn directLight;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tIncidentLight getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry ) {\n\t\tIncidentLight directLight;\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tif ( testLightInRange( lightDistance, pointLight.distance ) ) {\n\t\t\tdirectLight.color = pointLight.color;\n\t\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t\treturn directLight;\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tIncidentLight getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry ) {\n\t\tIncidentLight directLight;\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( all( bvec2( angleCos > spotLight.coneCos, testLightInRange( lightDistance, spotLight.distance ) ) ) ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t\treturn directLight;\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( STANDARD )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#else\n\t\t\tfloat flipNormal = 1.0;\n\t\t#endif\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = flipNormal * vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#else\n\t\t\tfloat flipNormal = 1.0;\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t#endif\n\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",d.ShaderChunk.lights_phong_fragment="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",d.ShaderChunk.lights_phong_pars_fragment="#ifdef USE_ENVMAP\n\tvarying vec3 vWorldPosition;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",d.ShaderChunk.lights_phong_pars_vertex="#ifdef USE_ENVMAP\n\tvarying vec3 vWorldPosition;\n#endif\n",d.ShaderChunk.lights_phong_vertex="#ifdef USE_ENVMAP\n\tvWorldPosition = worldPosition.xyz;\n#endif\n",d.ShaderChunk.lights_standard_fragment="StandardMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\nmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n",d.ShaderChunk.lights_standard_pars_fragment="struct StandardMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n};\nvoid RE_Direct_Standard( const in IncidentLight directLight, const in GeometricContext geometry, const in StandardMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n}\nvoid RE_IndirectDiffuse_Standard( const in vec3 irradiance, const in GeometricContext geometry, const in StandardMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Standard( const in vec3 radiance, const in GeometricContext geometry, const in StandardMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectSpecular += radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Standard\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Standard\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Standard\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",d.ShaderChunk.lights_template="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tdirectLight = getPointDirectLightIrradiance( pointLight, geometry );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tdirectLight = getSpotDirectLightIrradiance( spotLight, geometry );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tdirectLight = getDirectionalDirectLightIrradiance( directionalLight, geometry );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t \tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\tRE_IndirectSpecular( radiance, geometry, material, reflectedLight );\n#endif\n",d.ShaderChunk.logdepthbuf_fragment="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",d.ShaderChunk.logdepthbuf_pars_fragment="#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",d.ShaderChunk.logdepthbuf_pars_vertex="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",d.ShaderChunk.logdepthbuf_vertex="#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",d.ShaderChunk.map_fragment="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",d.ShaderChunk.map_pars_fragment="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",d.ShaderChunk.map_particle_fragment="#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",d.ShaderChunk.map_particle_pars_fragment="#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",d.ShaderChunk.metalnessmap_fragment="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.r;\n#endif\n",d.ShaderChunk.metalnessmap_pars_fragment="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif";d.ShaderChunk.morphnormal_vertex="#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",d.ShaderChunk.morphtarget_pars_vertex="#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",d.ShaderChunk.morphtarget_vertex="#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",d.ShaderChunk.normal_fragment="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\t#endif\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",d.ShaderChunk.normalmap_pars_fragment="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",d.ShaderChunk.premultiplied_alpha_fragment="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",d.ShaderChunk.project_vertex="#ifdef USE_SKINNING\n\tvec4 mvPosition = modelViewMatrix * skinned;\n#else\n\tvec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;\n",d.ShaderChunk.roughnessmap_fragment="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.r;\n#endif\n",d.ShaderChunk.roughnessmap_pars_fragment="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",d.ShaderChunk.shadowmap_pars_fragment="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\treturn dot( rgba_depth, bit_shift );\n\t}\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\treturn (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn 1.0;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",d.ShaderChunk.shadowmap_pars_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",d.ShaderChunk.shadowmap_vertex="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",d.ShaderChunk.shadowmask_pars_fragment="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",d.ShaderChunk.skinbase_vertex="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",d.ShaderChunk.skinning_pars_vertex="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",d.ShaderChunk.skinning_vertex="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n#endif\n",d.ShaderChunk.skinnormal_vertex="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",d.ShaderChunk.specularmap_fragment="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",d.ShaderChunk.specularmap_pars_fragment="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",d.ShaderChunk.tonemapping_fragment="#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",
d.ShaderChunk.tonemapping_pars_fragment="#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n  return toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n  color *= toneMappingExposure;\n  color = max( vec3( 0.0 ), color - 0.004 );\n  return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",d.ShaderChunk.uv2_pars_fragment="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",d.ShaderChunk.uv2_pars_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",d.ShaderChunk.uv2_vertex="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",d.ShaderChunk.uv_pars_fragment="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",d.ShaderChunk.uv_pars_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",d.ShaderChunk.uv_vertex="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",d.ShaderChunk.worldpos_vertex="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( STANDARD ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\t#ifdef USE_SKINNING\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\t#else\n\t\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n\t#endif\n#endif\n",d.UniformsUtils={merge:function(a){for(var b={},c=0;c<a.length;c++){var d=this.clone(a[c]);for(var e in d)b[e]=d[e]}return b},clone:function(a){var b={};for(var c in a){b[c]={};for(var e in a[c]){var f=a[c][e];f instanceof d.Color||f instanceof d.Vector2||f instanceof d.Vector3||f instanceof d.Vector4||f instanceof d.Matrix3||f instanceof d.Matrix4||f instanceof d.Texture?b[c][e]=f.clone():Array.isArray(f)?b[c][e]=f.slice():b[c][e]=f}}return b}},d.UniformsLib={common:{diffuse:{type:"c",value:new d.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new d.Vector4(0,0,1,1)},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98}},aomap:{aoMap:{type:"t",value:null},aoMapIntensity:{type:"f",value:1}},lightmap:{lightMap:{type:"t",value:null},lightMapIntensity:{type:"f",value:1}},emissivemap:{emissiveMap:{type:"t",value:null}},bumpmap:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new d.Vector2(1,1)}},displacementmap:{displacementMap:{type:"t",value:null},displacementScale:{type:"f",value:1},displacementBias:{type:"f",value:0}},roughnessmap:{roughnessMap:{type:"t",value:null}},metalnessmap:{metalnessMap:{type:"t",value:null}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new d.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLights:{type:"sa",value:[],properties:{direction:{type:"v3"},color:{type:"c"},shadow:{type:"i"},shadowBias:{type:"f"},shadowRadius:{type:"f"},shadowMapSize:{type:"v2"}}},directionalShadowMap:{type:"tv",value:[]},directionalShadowMatrix:{type:"m4v",value:[]},spotLights:{type:"sa",value:[],properties:{color:{type:"c"},position:{type:"v3"},direction:{type:"v3"},distance:{type:"f"},coneCos:{type:"f"},penumbraCos:{type:"f"},decay:{type:"f"},shadow:{type:"i"},shadowBias:{type:"f"},shadowRadius:{type:"f"},shadowMapSize:{type:"v2"}}},spotShadowMap:{type:"tv",value:[]},spotShadowMatrix:{type:"m4v",value:[]},pointLights:{type:"sa",value:[],properties:{color:{type:"c"},position:{type:"v3"},decay:{type:"f"},distance:{type:"f"},shadow:{type:"i"},shadowBias:{type:"f"},shadowRadius:{type:"f"},shadowMapSize:{type:"v2"}}},pointShadowMap:{type:"tv",value:[]},pointShadowMatrix:{type:"m4v",value:[]},hemisphereLights:{type:"sa",value:[],properties:{direction:{type:"v3"},skyColor:{type:"c"},groundColor:{type:"c"}}}},points:{diffuse:{type:"c",value:new d.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new d.Vector4(0,0,1,1)}}},d.ShaderChunk.cube_frag="uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\t#include <logdepthbuf_fragment>\n}\n",d.ShaderChunk.cube_vert="varying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t#include <logdepthbuf_vertex>\n}\n",d.ShaderChunk.depth_frag="uniform float mNear;\nuniform float mFar;\nuniform float opacity;\n#include <common>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\t#else\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\t#endif\n\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );\n\tgl_FragColor = vec4( vec3( color ), opacity );\n}\n",d.ShaderChunk.depth_vert="#include <common>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n}\n",d.ShaderChunk.depthRGBA_frag="#include <common>\n#include <logdepthbuf_pars_fragment>\nvec4 pack_depth( const in float depth ) {\n\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n\tres -= res.xxyz * bit_mask;\n\treturn res;\n}\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\n\t#else\n\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n\t#endif\n}\n",d.ShaderChunk.depthRGBA_vert="#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n}\n",d.ShaderChunk.distanceRGBA_frag="uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\nvec4 pack1K ( float depth ) {\n\tdepth /= 1000.0;\n\tconst vec4 bitSh = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n\tconst vec4 bitMsk = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n\tvec4 res = mod( depth * bitSh * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n\tres -= res.xxyz * bitMsk;\n\treturn res;\n}\nfloat unpack1K ( vec4 color ) {\n\tconst vec4 bitSh = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\treturn dot( color, bitSh ) * 1000.0;\n}\nvoid main () {\n\tgl_FragColor = pack1K( length( vWorldPosition.xyz - lightPos.xyz ) );\n}\n",d.ShaderChunk.distanceRGBA_vert="varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\tvWorldPosition = worldPosition;\n}\n",d.ShaderChunk.equirect_frag="uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <logdepthbuf_fragment>\n}\n",d.ShaderChunk.equirect_vert="varying vec3 vWorldPosition;\n#include <common>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t#include <logdepthbuf_vertex>\n}\n",d.ShaderChunk.linedashed_frag="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",d.ShaderChunk.linedashed_vert="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n}\n",d.ShaderChunk.meshbasic_frag="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight;\n\treflectedLight.directDiffuse = vec3( 0.0 );\n\treflectedLight.directSpecular = vec3( 0.0 );\n\treflectedLight.indirectDiffuse = diffuseColor.rgb;\n\treflectedLight.indirectSpecular = vec3( 0.0 );\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",d.ShaderChunk.meshbasic_vert="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n}\n",d.ShaderChunk.meshlambert_frag="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",d.ShaderChunk.meshlambert_vert="#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n}\n",d.ShaderChunk.meshphong_frag="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",d.ShaderChunk.meshphong_vert="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <lights_phong_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_phong_vertex>\n\t#include <shadowmap_vertex>\n}\n",d.ShaderChunk.meshstandard_frag="#define STANDARD\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\nuniform float envMapIntensity;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_standard_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_standard_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",d.ShaderChunk.meshstandard_vert="#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <displacementmap_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n}\n",d.ShaderChunk.normal_frag="uniform float opacity;\nvarying vec3 vNormal;\n#include <common>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n\t#include <logdepthbuf_fragment>\n}\n",d.ShaderChunk.normal_vert="varying vec3 vNormal;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\tvNormal = normalize( normalMatrix * normal );\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n}\n",d.ShaderChunk.points_frag="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",d.ShaderChunk.points_vert="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",d.ShaderLib={basic:{uniforms:d.UniformsUtils.merge([d.UniformsLib.common,d.UniformsLib.aomap,d.UniformsLib.fog]),vertexShader:d.ShaderChunk.meshbasic_vert,fragmentShader:d.ShaderChunk.meshbasic_frag},lambert:{uniforms:d.UniformsUtils.merge([d.UniformsLib.common,d.UniformsLib.aomap,d.UniformsLib.lightmap,d.UniformsLib.emissivemap,d.UniformsLib.fog,d.UniformsLib.lights,{emissive:{type:"c",value:new d.Color(0)}}]),vertexShader:d.ShaderChunk.meshlambert_vert,fragmentShader:d.ShaderChunk.meshlambert_frag},phong:{uniforms:d.UniformsUtils.merge([d.UniformsLib.common,d.UniformsLib.aomap,d.UniformsLib.lightmap,d.UniformsLib.emissivemap,d.UniformsLib.bumpmap,d.UniformsLib.normalmap,d.UniformsLib.displacementmap,d.UniformsLib.fog,d.UniformsLib.lights,{emissive:{type:"c",value:new d.Color(0)},specular:{type:"c",value:new d.Color(1118481)},shininess:{type:"f",value:30}}]),vertexShader:d.ShaderChunk.meshphong_vert,fragmentShader:d.ShaderChunk.meshphong_frag},standard:{uniforms:d.UniformsUtils.merge([d.UniformsLib.common,d.UniformsLib.aomap,d.UniformsLib.lightmap,d.UniformsLib.emissivemap,d.UniformsLib.bumpmap,d.UniformsLib.normalmap,d.UniformsLib.displacementmap,d.UniformsLib.roughnessmap,d.UniformsLib.metalnessmap,d.UniformsLib.fog,d.UniformsLib.lights,{emissive:{type:"c",value:new d.Color(0)},roughness:{type:"f",value:.5},metalness:{type:"f",value:0},envMapIntensity:{type:"f",value:1}}]),vertexShader:d.ShaderChunk.meshstandard_vert,fragmentShader:d.ShaderChunk.meshstandard_frag},points:{uniforms:d.UniformsUtils.merge([d.UniformsLib.points,d.UniformsLib.fog]),vertexShader:d.ShaderChunk.points_vert,fragmentShader:d.ShaderChunk.points_frag},dashed:{uniforms:d.UniformsUtils.merge([d.UniformsLib.common,d.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:d.ShaderChunk.linedashed_vert,fragmentShader:d.ShaderChunk.linedashed_frag},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:d.ShaderChunk.depth_vert,fragmentShader:d.ShaderChunk.depth_frag},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:d.ShaderChunk.normal_vert,fragmentShader:d.ShaderChunk.normal_frag},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:d.ShaderChunk.cube_vert,fragmentShader:d.ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:d.ShaderChunk.equirect_vert,fragmentShader:d.ShaderChunk.equirect_frag},depthRGBA:{uniforms:{},vertexShader:d.ShaderChunk.depthRGBA_vert,fragmentShader:d.ShaderChunk.depthRGBA_frag},distanceRGBA:{uniforms:{lightPos:{type:"v3",value:new d.Vector3(0,0,0)}},vertexShader:d.ShaderChunk.distanceRGBA_vert,fragmentShader:d.ShaderChunk.distanceRGBA_frag}},d.WebGLRenderer=function(a){function b(){return null===ta?Ga:1}function c(a,b,c,d){!0===ha&&(a*=d,b*=d,c*=d),Ua.clearColor(a,b,c,d)}function e(){Ua.init(),Ua.scissor(ya.copy(Ha).multiplyScalar(Ga)),Ua.viewport(Aa.copy(Ja).multiplyScalar(Ga)),c(Ca.r,Ca.g,Ca.b,Da)}function f(){sa=null,xa=null,wa="",va=-1,Ua.reset()}function g(a){a.preventDefault(),f(),e(),Va.clear()}function h(a){var b=a.target;b.removeEventListener("dispose",h),k(b),Oa.textures--}function i(a){var b=a.target;b.removeEventListener("dispose",i),l(b),Oa.textures--}function j(a){var b=a.target;b.removeEventListener("dispose",j),m(b)}function k(a){var b=Va.get(a);if(a.image&&b.__image__webglTextureCube)Qa.deleteTexture(b.__image__webglTextureCube);else{if(void 0===b.__webglInit)return;Qa.deleteTexture(b.__webglTexture)}Va.delete(a)}function l(a){var b=Va.get(a),c=Va.get(a.texture);if(a&&void 0!==c.__webglTexture){if(Qa.deleteTexture(c.__webglTexture),a instanceof d.WebGLRenderTargetCube)for(var e=0;e<6;e++)Qa.deleteFramebuffer(b.__webglFramebuffer[e]),Qa.deleteRenderbuffer(b.__webglDepthbuffer[e]);else Qa.deleteFramebuffer(b.__webglFramebuffer),Qa.deleteRenderbuffer(b.__webglDepthbuffer);Va.delete(a.texture),Va.delete(a)}}function m(a){n(a),Va.delete(a)}function n(a){var b=Va.get(a).program;a.program=void 0,void 0!==b&&Xa.releaseProgram(b)}function o(a,b,c,e){var f;if(c instanceof d.InstancedBufferGeometry&&null===(f=Sa.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");void 0===e&&(e=0),Ua.initAttributes();var g=c.attributes,h=b.getAttributes(),i=a.defaultAttributeValues;for(var j in h){var k=h[j];if(k>=0){var l=g[j];if(void 0!==l){var m=l.itemSize,n=Wa.getAttributeBuffer(l);if(l instanceof d.InterleavedBufferAttribute){var o=l.data,p=o.stride,q=l.offset;o instanceof d.InstancedInterleavedBuffer?(Ua.enableAttributeAndDivisor(k,o.meshPerAttribute,f),void 0===c.maxInstancedCount&&(c.maxInstancedCount=o.meshPerAttribute*o.count)):Ua.enableAttribute(k),Qa.bindBuffer(Qa.ARRAY_BUFFER,n),Qa.vertexAttribPointer(k,m,Qa.FLOAT,!1,p*o.array.BYTES_PER_ELEMENT,(e*p+q)*o.array.BYTES_PER_ELEMENT)}else l instanceof d.InstancedBufferAttribute?(Ua.enableAttributeAndDivisor(k,l.meshPerAttribute,f),void 0===c.maxInstancedCount&&(c.maxInstancedCount=l.meshPerAttribute*l.count)):Ua.enableAttribute(k),Qa.bindBuffer(Qa.ARRAY_BUFFER,n),Qa.vertexAttribPointer(k,m,Qa.FLOAT,!1,0,e*m*4)}else if(void 0!==i){var r=i[j];if(void 0!==r)switch(r.length){case 2:Qa.vertexAttrib2fv(k,r);break;case 3:Qa.vertexAttrib3fv(k,r);break;case 4:Qa.vertexAttrib4fv(k,r);break;default:Qa.vertexAttrib1fv(k,r)}}}}Ua.disableUnusedAttributes()}function p(a,b){return Math.abs(b[0])-Math.abs(a[0])}function q(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function r(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function s(a,b,c,d,e){var f,g;c.transparent?(f=ma,g=++na):(f=ka,g=++la);var h=f[g];void 0!==h?(h.id=a.id,h.object=a,h.geometry=b,h.material=c,h.z=Ma.z,h.group=e):(h={id:a.id,object:a,geometry:b,material:c,z:Ma.z,group:e},f.push(h))}function t(a,b){if(!1!==a.visible){if(a.layers.test(b.layers))if(a instanceof d.Light)ja.push(a);else if(a instanceof d.Sprite)!1!==a.frustumCulled&&!0!==Ka.intersectsObject(a)||pa.push(a);else if(a instanceof d.LensFlare)qa.push(a);else if(a instanceof d.ImmediateRenderObject)!0===ra.sortObjects&&(Ma.setFromMatrixPosition(a.matrixWorld),Ma.applyProjection(La)),s(a,null,a.material,Ma.z,null);else if((a instanceof d.Mesh||a instanceof d.Line||a instanceof d.Points)&&(a instanceof d.SkinnedMesh&&a.skeleton.update(),!1===a.frustumCulled||!0===Ka.intersectsObject(a))){var c=a.material;if(!0===c.visible){!0===ra.sortObjects&&(Ma.setFromMatrixPosition(a.matrixWorld),Ma.applyProjection(La));var e=Wa.update(a);if(c instanceof d.MultiMaterial)for(var f=e.groups,g=c.materials,h=0,i=f.length;h<i;h++){var j=f[h],k=g[j.materialIndex];!0===k.visible&&s(a,e,k,Ma.z,j)}else s(a,e,c,Ma.z,null)}}for(var l=a.children,h=0,i=l.length;h<i;h++)t(l[h],b)}}function u(a,b,c,e){for(var f=0,g=a.length;f<g;f++){var h=a[f],i=h.object,j=h.geometry,k=void 0===e?h.material:e,l=h.group;if(i.modelViewMatrix.multiplyMatrices(b.matrixWorldInverse,i.matrixWorld),i.normalMatrix.getNormalMatrix(i.modelViewMatrix),i instanceof d.ImmediateRenderObject){w(k);var m=y(b,c,k,i);wa="",i.render(function(a){ra.renderBufferImmediate(a,m,k)})}else ra.renderBufferDirect(b,c,j,k,i,l)}}function v(a,b,c){var e=Va.get(a),f=Xa.getParameters(a,Na,b,c),g=Xa.getProgramCode(a,f),h=e.program,i=!0;if(void 0===h)a.addEventListener("dispose",j);else if(h.code!==g)n(a);else{if(void 0!==f.shaderID)return;i=!1}if(i){if(f.shaderID){var k=d.ShaderLib[f.shaderID];e.__webglShader={name:a.type,uniforms:d.UniformsUtils.clone(k.uniforms),vertexShader:k.vertexShader,fragmentShader:k.fragmentShader}}else e.__webglShader={name:a.type,uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader};a.__webglShader=e.__webglShader,h=Xa.acquireProgram(a,f,g),e.program=h,a.program=h}var l=h.getAttributes();if(a.morphTargets){a.numSupportedMorphTargets=0;for(var m=0;m<ra.maxMorphTargets;m++)l["morphTarget"+m]>=0&&a.numSupportedMorphTargets++}if(a.morphNormals){a.numSupportedMorphNormals=0
;for(var m=0;m<ra.maxMorphNormals;m++)l["morphNormal"+m]>=0&&a.numSupportedMorphNormals++}e.uniformsList=[];var o=e.__webglShader.uniforms,p=e.program.getUniforms();for(var q in o){var r=p[q];r&&e.uniformsList.push([e.__webglShader.uniforms[q],r])}(a instanceof d.MeshPhongMaterial||a instanceof d.MeshLambertMaterial||a instanceof d.MeshStandardMaterial||a.lights)&&(e.lightsHash=Na.hash,o.ambientLightColor.value=Na.ambient,o.directionalLights.value=Na.directional,o.spotLights.value=Na.spot,o.pointLights.value=Na.point,o.hemisphereLights.value=Na.hemi,o.directionalShadowMap.value=Na.directionalShadowMap,o.directionalShadowMatrix.value=Na.directionalShadowMatrix,o.spotShadowMap.value=Na.spotShadowMap,o.spotShadowMatrix.value=Na.spotShadowMatrix,o.pointShadowMap.value=Na.pointShadowMap,o.pointShadowMatrix.value=Na.pointShadowMatrix),e.hasDynamicUniforms=!1;for(var s=0,t=e.uniformsList.length;s<t;s++){if(!0===e.uniformsList[s][0].dynamic){e.hasDynamicUniforms=!0;break}}}function w(a){x(a),!0===a.transparent?Ua.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha,a.premultipliedAlpha):Ua.setBlending(d.NoBlending),Ua.setDepthFunc(a.depthFunc),Ua.setDepthTest(a.depthTest),Ua.setDepthWrite(a.depthWrite),Ua.setColorWrite(a.colorWrite),Ua.setPolygonOffset(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}function x(a){a.side!==d.DoubleSide?Ua.enable(Qa.CULL_FACE):Ua.disable(Qa.CULL_FACE),Ua.setFlipSided(a.side===d.BackSide)}function y(a,b,c,e){Ba=0;var f=Va.get(c);void 0===f.program&&(c.needsUpdate=!0),void 0!==f.lightsHash&&f.lightsHash!==Na.hash&&(c.needsUpdate=!0),c.needsUpdate&&(v(c,b,e),c.needsUpdate=!1);var g=!1,h=!1,i=!1,j=f.program,k=j.getUniforms(),l=f.__webglShader.uniforms;if(j.id!==sa&&(Qa.useProgram(j.program),sa=j.id,g=!0,h=!0,i=!0),c.id!==va&&(va=c.id,h=!0),(g||a!==xa)&&(Qa.uniformMatrix4fv(k.projectionMatrix,!1,a.projectionMatrix.elements),Ta.logarithmicDepthBuffer&&Qa.uniform1f(k.logDepthBufFC,2/(Math.log(a.far+1)/Math.LN2)),a!==xa&&(xa=a,h=!0,i=!0),(c instanceof d.ShaderMaterial||c instanceof d.MeshPhongMaterial||c instanceof d.MeshStandardMaterial||c.envMap)&&void 0!==k.cameraPosition&&(Ma.setFromMatrixPosition(a.matrixWorld),Qa.uniform3f(k.cameraPosition,Ma.x,Ma.y,Ma.z)),(c instanceof d.MeshPhongMaterial||c instanceof d.MeshLambertMaterial||c instanceof d.MeshBasicMaterial||c instanceof d.MeshStandardMaterial||c instanceof d.ShaderMaterial||c.skinning)&&void 0!==k.viewMatrix&&Qa.uniformMatrix4fv(k.viewMatrix,!1,a.matrixWorldInverse.elements),void 0!==k.toneMappingExposure&&Qa.uniform1f(k.toneMappingExposure,ra.toneMappingExposure),void 0!==k.toneMappingWhitePoint&&Qa.uniform1f(k.toneMappingWhitePoint,ra.toneMappingWhitePoint)),c.skinning)if(e.bindMatrix&&void 0!==k.bindMatrix&&Qa.uniformMatrix4fv(k.bindMatrix,!1,e.bindMatrix.elements),e.bindMatrixInverse&&void 0!==k.bindMatrixInverse&&Qa.uniformMatrix4fv(k.bindMatrixInverse,!1,e.bindMatrixInverse.elements),Ta.floatVertexTextures&&e.skeleton&&e.skeleton.useVertexTexture){if(void 0!==k.boneTexture){var m=K();Qa.uniform1i(k.boneTexture,m),ra.setTexture(e.skeleton.boneTexture,m)}void 0!==k.boneTextureWidth&&Qa.uniform1i(k.boneTextureWidth,e.skeleton.boneTextureWidth),void 0!==k.boneTextureHeight&&Qa.uniform1i(k.boneTextureHeight,e.skeleton.boneTextureHeight)}else e.skeleton&&e.skeleton.boneMatrices&&void 0!==k.boneGlobalMatrices&&Qa.uniformMatrix4fv(k.boneGlobalMatrices,!1,e.skeleton.boneMatrices);return h&&((c instanceof d.MeshPhongMaterial||c instanceof d.MeshLambertMaterial||c instanceof d.MeshStandardMaterial||c.lights)&&I(l,i),b&&c.fog&&E(l,b),(c instanceof d.MeshBasicMaterial||c instanceof d.MeshLambertMaterial||c instanceof d.MeshPhongMaterial||c instanceof d.MeshStandardMaterial)&&A(l,c),c instanceof d.LineBasicMaterial?B(l,c):c instanceof d.LineDashedMaterial?(B(l,c),C(l,c)):c instanceof d.PointsMaterial?D(l,c):c instanceof d.MeshLambertMaterial?F(l,c):c instanceof d.MeshPhongMaterial?G(l,c):c instanceof d.MeshStandardMaterial?H(l,c):c instanceof d.MeshDepthMaterial?(l.mNear.value=a.near,l.mFar.value=a.far,l.opacity.value=c.opacity):c instanceof d.MeshNormalMaterial&&(l.opacity.value=c.opacity),M(f.uniformsList)),J(k,e),void 0!==k.modelMatrix&&Qa.uniformMatrix4fv(k.modelMatrix,!1,e.matrixWorld.elements),!0===f.hasDynamicUniforms&&z(f.uniformsList,e,a),j}function z(a,b,c){for(var d=[],e=0,f=a.length;e<f;e++){var g=a[e][0],h=g.onUpdateCallback;void 0!==h&&(h.bind(g)(b,c),d.push(a[e]))}M(d)}function A(a,b){a.opacity.value=b.opacity,a.diffuse.value=b.color,b.emissive&&a.emissive.value.copy(b.emissive).multiplyScalar(b.emissiveIntensity),a.map.value=b.map,a.specularMap.value=b.specularMap,a.alphaMap.value=b.alphaMap,b.aoMap&&(a.aoMap.value=b.aoMap,a.aoMapIntensity.value=b.aoMapIntensity);var c;if(b.map?c=b.map:b.specularMap?c=b.specularMap:b.displacementMap?c=b.displacementMap:b.normalMap?c=b.normalMap:b.bumpMap?c=b.bumpMap:b.roughnessMap?c=b.roughnessMap:b.metalnessMap?c=b.metalnessMap:b.alphaMap?c=b.alphaMap:b.emissiveMap&&(c=b.emissiveMap),void 0!==c){c instanceof d.WebGLRenderTarget&&(c=c.texture);var e=c.offset,f=c.repeat;a.offsetRepeat.value.set(e.x,e.y,f.x,f.y)}a.envMap.value=b.envMap,a.flipEnvMap.value=b.envMap instanceof d.WebGLRenderTargetCube?1:-1,a.reflectivity.value=b.reflectivity,a.refractionRatio.value=b.refractionRatio}function B(a,b){a.diffuse.value=b.color,a.opacity.value=b.opacity}function C(a,b){a.dashSize.value=b.dashSize,a.totalSize.value=b.dashSize+b.gapSize,a.scale.value=b.scale}function D(a,b){if(a.diffuse.value=b.color,a.opacity.value=b.opacity,a.size.value=b.size*Ga,a.scale.value=ba.clientHeight/2,a.map.value=b.map,null!==b.map){var c=b.map.offset,d=b.map.repeat;a.offsetRepeat.value.set(c.x,c.y,d.x,d.y)}}function E(a,b){a.fogColor.value=b.color,b instanceof d.Fog?(a.fogNear.value=b.near,a.fogFar.value=b.far):b instanceof d.FogExp2&&(a.fogDensity.value=b.density)}function F(a,b){b.lightMap&&(a.lightMap.value=b.lightMap,a.lightMapIntensity.value=b.lightMapIntensity),b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap)}function G(a,b){a.specular.value=b.specular,a.shininess.value=Math.max(b.shininess,1e-4),b.lightMap&&(a.lightMap.value=b.lightMap,a.lightMapIntensity.value=b.lightMapIntensity),b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap),b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale),b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale)),b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias)}function H(a,b){a.roughness.value=b.roughness,a.metalness.value=b.metalness,b.roughnessMap&&(a.roughnessMap.value=b.roughnessMap),b.metalnessMap&&(a.metalnessMap.value=b.metalnessMap),b.lightMap&&(a.lightMap.value=b.lightMap,a.lightMapIntensity.value=b.lightMapIntensity),b.emissiveMap&&(a.emissiveMap.value=b.emissiveMap),b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale),b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale)),b.displacementMap&&(a.displacementMap.value=b.displacementMap,a.displacementScale.value=b.displacementScale,a.displacementBias.value=b.displacementBias),b.envMap&&(a.envMapIntensity.value=b.envMapIntensity)}function I(a,b){a.ambientLightColor.needsUpdate=b,a.directionalLights.needsUpdate=b,a.pointLights.needsUpdate=b,a.spotLights.needsUpdate=b,a.hemisphereLights.needsUpdate=b}function J(a,b){Qa.uniformMatrix4fv(a.modelViewMatrix,!1,b.modelViewMatrix.elements),a.normalMatrix&&Qa.uniformMatrix3fv(a.normalMatrix,!1,b.normalMatrix.elements)}function K(){var a=Ba;return a>=Ta.maxTextures&&console.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+Ta.maxTextures),Ba+=1,a}function L(a,b,c,e){var f,g;if("1i"===b)Qa.uniform1i(c,e);else if("1f"===b)Qa.uniform1f(c,e);else if("2f"===b)Qa.uniform2f(c,e[0],e[1]);else if("3f"===b)Qa.uniform3f(c,e[0],e[1],e[2]);else if("4f"===b)Qa.uniform4f(c,e[0],e[1],e[2],e[3]);else if("1iv"===b)Qa.uniform1iv(c,e);else if("3iv"===b)Qa.uniform3iv(c,e);else if("1fv"===b)Qa.uniform1fv(c,e);else if("2fv"===b)Qa.uniform2fv(c,e);else if("3fv"===b)Qa.uniform3fv(c,e);else if("4fv"===b)Qa.uniform4fv(c,e);else if("Matrix2fv"===b)Qa.uniformMatrix2fv(c,!1,e);else if("Matrix3fv"===b)Qa.uniformMatrix3fv(c,!1,e);else if("Matrix4fv"===b)Qa.uniformMatrix4fv(c,!1,e);else if("i"===b)Qa.uniform1i(c,e);else if("f"===b)Qa.uniform1f(c,e);else if("v2"===b)Qa.uniform2f(c,e.x,e.y);else if("v3"===b)Qa.uniform3f(c,e.x,e.y,e.z);else if("v4"===b)Qa.uniform4f(c,e.x,e.y,e.z,e.w);else if("c"===b)Qa.uniform3f(c,e.r,e.g,e.b);else if("s"===b){var h=a.properties;for(var i in h){var j=h[i],k=c[i],l=e[i];L(j,j.type,k,l)}}else if("sa"===b)for(var h=a.properties,m=0,n=e.length;m<n;m++)for(var i in h){var j=h[i],k=c[m][i],l=e[m][i];L(j,j.type,k,l)}else if("iv1"===b)Qa.uniform1iv(c,e);else if("iv"===b)Qa.uniform3iv(c,e);else if("fv1"===b)Qa.uniform1fv(c,e);else if("fv"===b)Qa.uniform3fv(c,e);else if("v2v"===b){void 0===a._array&&(a._array=new Float32Array(2*e.length));for(var m=0,o=0,p=e.length;m<p;m++,o+=2)a._array[o+0]=e[m].x,a._array[o+1]=e[m].y;Qa.uniform2fv(c,a._array)}else if("v3v"===b){void 0===a._array&&(a._array=new Float32Array(3*e.length));for(var m=0,q=0,p=e.length;m<p;m++,q+=3)a._array[q+0]=e[m].x,a._array[q+1]=e[m].y,a._array[q+2]=e[m].z;Qa.uniform3fv(c,a._array)}else if("v4v"===b){void 0===a._array&&(a._array=new Float32Array(4*e.length));for(var m=0,r=0,p=e.length;m<p;m++,r+=4)a._array[r+0]=e[m].x,a._array[r+1]=e[m].y,a._array[r+2]=e[m].z,a._array[r+3]=e[m].w;Qa.uniform4fv(c,a._array)}else if("m2"===b)Qa.uniformMatrix2fv(c,!1,e.elements);else if("m3"===b)Qa.uniformMatrix3fv(c,!1,e.elements);else if("m3v"===b){void 0===a._array&&(a._array=new Float32Array(9*e.length));for(var m=0,p=e.length;m<p;m++)e[m].flattenToArrayOffset(a._array,9*m);Qa.uniformMatrix3fv(c,!1,a._array)}else if("m4"===b)Qa.uniformMatrix4fv(c,!1,e.elements);else if("m4v"===b){void 0===a._array&&(a._array=new Float32Array(16*e.length));for(var m=0,p=e.length;m<p;m++)e[m].flattenToArrayOffset(a._array,16*m);Qa.uniformMatrix4fv(c,!1,a._array)}else if("t"===b){if(f=e,g=K(),Qa.uniform1i(c,g),!f)return;f instanceof d.CubeTexture||Array.isArray(f.image)&&6===f.image.length?U(f,g):f instanceof d.WebGLRenderTargetCube?V(f.texture,g):f instanceof d.WebGLRenderTarget?ra.setTexture(f.texture,g):ra.setTexture(f,g)}else if("tv"===b){void 0===a._array&&(a._array=[]);for(var m=0,p=a.value.length;m<p;m++)a._array[m]=K();Qa.uniform1iv(c,a._array);for(var m=0,p=a.value.length;m<p;m++)f=a.value[m],g=a._array[m],f&&(f instanceof d.CubeTexture||f.image instanceof Array&&6===f.image.length?U(f,g):f instanceof d.WebGLRenderTarget?ra.setTexture(f.texture,g):f instanceof d.WebGLRenderTargetCube?V(f.texture,g):ra.setTexture(f,g))}else console.warn("THREE.WebGLRenderer: Unknown uniform type: "+b)}function M(a){for(var b=0,c=a.length;b<c;b++){var d=a[b][0];if(!1!==d.needsUpdate){L(d,d.type,a[b][1],d.value)}}}function N(a,b){var c,e,f,g,h,i,j=0,k=0,l=0,m=b.matrixWorldInverse,n=0,o=0,p=0,q=0,r=0;for(Na.shadowsPointLight=0,c=0,e=a.length;c<e;c++)if(f=a[c],g=f.color,h=f.intensity,i=f.distance,f instanceof d.AmbientLight)j+=g.r*h,k+=g.g*h,l+=g.b*h;else if(f instanceof d.DirectionalLight){var s=Ya.get(f);s.color.copy(f.color).multiplyScalar(f.intensity),s.direction.setFromMatrixPosition(f.matrixWorld),Ma.setFromMatrixPosition(f.target.matrixWorld),s.direction.sub(Ma),s.direction.transformDirection(m),s.shadow=f.castShadow,f.castShadow&&(s.shadowBias=f.shadow.bias,s.shadowRadius=f.shadow.radius,s.shadowMapSize=f.shadow.mapSize,Na.shadows[r++]=f),Na.directionalShadowMap[n]=f.shadow.map,Na.directionalShadowMatrix[n]=f.shadow.matrix,Na.directional[n++]=s}else if(f instanceof d.SpotLight){var s=Ya.get(f);s.position.setFromMatrixPosition(f.matrixWorld),s.position.applyMatrix4(m),s.color.copy(g).multiplyScalar(h),s.distance=i,s.direction.setFromMatrixPosition(f.matrixWorld),Ma.setFromMatrixPosition(f.target.matrixWorld),s.direction.sub(Ma),s.direction.transformDirection(m),s.coneCos=Math.cos(f.angle),s.penumbraCos=Math.cos(f.angle*(1-f.penumbra)),s.decay=0===f.distance?0:f.decay,s.shadow=f.castShadow,f.castShadow&&(s.shadowBias=f.shadow.bias,s.shadowRadius=f.shadow.radius,s.shadowMapSize=f.shadow.mapSize,Na.shadows[r++]=f),Na.spotShadowMap[p]=f.shadow.map,Na.spotShadowMatrix[p]=f.shadow.matrix,Na.spot[p++]=s}else if(f instanceof d.PointLight){var s=Ya.get(f);s.position.setFromMatrixPosition(f.matrixWorld),s.position.applyMatrix4(m),s.color.copy(f.color).multiplyScalar(f.intensity),s.distance=f.distance,s.decay=0===f.distance?0:f.decay,s.shadow=f.castShadow,f.castShadow&&(s.shadowBias=f.shadow.bias,s.shadowRadius=f.shadow.radius,s.shadowMapSize=f.shadow.mapSize,Na.shadows[r++]=f),Na.pointShadowMap[o]=f.shadow.map,void 0===Na.pointShadowMatrix[o]&&(Na.pointShadowMatrix[o]=new d.Matrix4),Ma.setFromMatrixPosition(f.matrixWorld).negate(),Na.pointShadowMatrix[o].identity().setPosition(Ma),Na.point[o++]=s}else if(f instanceof d.HemisphereLight){var s=Ya.get(f);s.direction.setFromMatrixPosition(f.matrixWorld),s.direction.transformDirection(m),s.direction.normalize(),s.skyColor.copy(f.color).multiplyScalar(h),s.groundColor.copy(f.groundColor).multiplyScalar(h),Na.hemi[q++]=s}Na.ambient[0]=j,Na.ambient[1]=k,Na.ambient[2]=l,Na.directional.length=n,Na.spot.length=p,Na.point.length=o,Na.hemi.length=q,Na.shadows.length=r,Na.hash=n+","+o+","+p+","+q+","+r}function O(a,b,c){var e;if(c?(Qa.texParameteri(a,Qa.TEXTURE_WRAP_S,aa(b.wrapS)),Qa.texParameteri(a,Qa.TEXTURE_WRAP_T,aa(b.wrapT)),Qa.texParameteri(a,Qa.TEXTURE_MAG_FILTER,aa(b.magFilter)),Qa.texParameteri(a,Qa.TEXTURE_MIN_FILTER,aa(b.minFilter))):(Qa.texParameteri(a,Qa.TEXTURE_WRAP_S,Qa.CLAMP_TO_EDGE),Qa.texParameteri(a,Qa.TEXTURE_WRAP_T,Qa.CLAMP_TO_EDGE),b.wrapS===d.ClampToEdgeWrapping&&b.wrapT===d.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",b),Qa.texParameteri(a,Qa.TEXTURE_MAG_FILTER,_(b.magFilter)),Qa.texParameteri(a,Qa.TEXTURE_MIN_FILTER,_(b.minFilter)),b.minFilter!==d.NearestFilter&&b.minFilter!==d.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",b)),e=Sa.get("EXT_texture_filter_anisotropic")){if(b.type===d.FloatType&&null===Sa.get("OES_texture_float_linear"))return;if(b.type===d.HalfFloatType&&null===Sa.get("OES_texture_half_float_linear"))return;(b.anisotropy>1||Va.get(b).__currentAnisotropy)&&(Qa.texParameterf(a,e.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.anisotropy,ra.getMaxAnisotropy())),Va.get(b).__currentAnisotropy=b.anisotropy)}}function P(a,b,c){void 0===a.__webglInit&&(a.__webglInit=!0,b.addEventListener("dispose",h),a.__webglTexture=Qa.createTexture(),Oa.textures++),Ua.activeTexture(Qa.TEXTURE0+c),Ua.bindTexture(Qa.TEXTURE_2D,a.__webglTexture),Qa.pixelStorei(Qa.UNPACK_FLIP_Y_WEBGL,b.flipY),Qa.pixelStorei(Qa.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b.premultiplyAlpha),Qa.pixelStorei(Qa.UNPACK_ALIGNMENT,b.unpackAlignment);var e=Q(b.image,Ta.maxTextureSize);S(b)&&!1===R(e)&&(e=T(e));var f=R(e),g=aa(b.format),i=aa(b.type);O(Qa.TEXTURE_2D,b,f);var j,k=b.mipmaps;if(b instanceof d.DataTexture)if(k.length>0&&f){for(var l=0,m=k.length;l<m;l++)j=k[l],Ua.texImage2D(Qa.TEXTURE_2D,l,g,j.width,j.height,0,g,i,j.data);b.generateMipmaps=!1}else Ua.texImage2D(Qa.TEXTURE_2D,0,g,e.width,e.height,0,g,i,e.data);else if(b instanceof d.CompressedTexture)for(var l=0,m=k.length;l<m;l++)j=k[l],b.format!==d.RGBAFormat&&b.format!==d.RGBFormat?Ua.getCompressedTextureFormats().indexOf(g)>-1?Ua.compressedTexImage2D(Qa.TEXTURE_2D,l,g,j.width,j.height,0,j.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ua.texImage2D(Qa.TEXTURE_2D,l,g,j.width,j.height,0,g,i,j.data);else if(k.length>0&&f){for(var l=0,m=k.length;l<m;l++)j=k[l],Ua.texImage2D(Qa.TEXTURE_2D,l,g,g,i,j);b.generateMipmaps=!1}else Ua.texImage2D(Qa.TEXTURE_2D,0,g,g,i,e);b.generateMipmaps&&f&&Qa.generateMipmap(Qa.TEXTURE_2D),a.__version=b.version,b.onUpdate&&b.onUpdate(b)}function Q(a,b){if(a.width>b||a.height>b){var c=b/Math.max(a.width,a.height),d=document.createElement("canvas");d.width=Math.floor(a.width*c),d.height=Math.floor(a.height*c);return d.getContext("2d").drawImage(a,0,0,a.width,a.height,0,0,d.width,d.height),console.warn("THREE.WebGLRenderer: image is too big ("+a.width+"x"+a.height+"). Resized to "+d.width+"x"+d.height,a),d}return a}function R(a){return d.Math.isPowerOfTwo(a.width)&&d.Math.isPowerOfTwo(a.height)}function S(a){return a.wrapS!==d.ClampToEdgeWrapping||a.wrapT!==d.ClampToEdgeWrapping||a.minFilter!==d.NearestFilter&&a.minFilter!==d.LinearFilter}function T(a){if(a instanceof HTMLImageElement||a instanceof HTMLCanvasElement){var b=document.createElement("canvas");b.width=d.Math.nearestPowerOfTwo(a.width),b.height=d.Math.nearestPowerOfTwo(a.height);return b.getContext("2d").drawImage(a,0,0,b.width,b.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+a.width+"x"+a.height+"). Resized to "+b.width+"x"+b.height,a),b}return a}function U(a,b){var c=Va.get(a);if(6===a.image.length)if(a.version>0&&c.__version!==a.version){c.__image__webglTextureCube||(a.addEventListener("dispose",h),c.__image__webglTextureCube=Qa.createTexture(),Oa.textures++),Ua.activeTexture(Qa.TEXTURE0+b),Ua.bindTexture(Qa.TEXTURE_CUBE_MAP,c.__image__webglTextureCube),Qa.pixelStorei(Qa.UNPACK_FLIP_Y_WEBGL,a.flipY);for(var e=a instanceof d.CompressedTexture,f=a.image[0]instanceof d.DataTexture,g=[],i=0;i<6;i++)!ra.autoScaleCubemaps||e||f?g[i]=f?a.image[i].image:a.image[i]:g[i]=Q(a.image[i],Ta.maxCubemapSize);var j=g[0],k=R(j),l=aa(a.format),m=aa(a.type);O(Qa.TEXTURE_CUBE_MAP,a,k);for(var i=0;i<6;i++)if(e)for(var n,o=g[i].mipmaps,p=0,q=o.length;p<q;p++)n=o[p],a.format!==d.RGBAFormat&&a.format!==d.RGBFormat?Ua.getCompressedTextureFormats().indexOf(l)>-1?Ua.compressedTexImage2D(Qa.TEXTURE_CUBE_MAP_POSITIVE_X+i,p,l,n.width,n.height,0,n.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()"):Ua.texImage2D(Qa.TEXTURE_CUBE_MAP_POSITIVE_X+i,p,l,n.width,n.height,0,l,m,n.data);else f?Ua.texImage2D(Qa.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,l,g[i].width,g[i].height,0,l,m,g[i].data):Ua.texImage2D(Qa.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,l,l,m,g[i]);a.generateMipmaps&&k&&Qa.generateMipmap(Qa.TEXTURE_CUBE_MAP),c.__version=a.version,a.onUpdate&&a.onUpdate(a)}else Ua.activeTexture(Qa.TEXTURE0+b),Ua.bindTexture(Qa.TEXTURE_CUBE_MAP,c.__image__webglTextureCube)}function V(a,b){Ua.activeTexture(Qa.TEXTURE0+b),Ua.bindTexture(Qa.TEXTURE_CUBE_MAP,Va.get(a).__webglTexture)}function W(a,b,c,d){var e=aa(b.texture.format),f=aa(b.texture.type);Ua.texImage2D(d,0,e,b.width,b.height,0,e,f,null),Qa.bindFramebuffer(Qa.FRAMEBUFFER,a),Qa.framebufferTexture2D(Qa.FRAMEBUFFER,c,d,Va.get(b.texture).__webglTexture,0),Qa.bindFramebuffer(Qa.FRAMEBUFFER,null)}function X(a,b){Qa.bindRenderbuffer(Qa.RENDERBUFFER,a),b.depthBuffer&&!b.stencilBuffer?(Qa.renderbufferStorage(Qa.RENDERBUFFER,Qa.DEPTH_COMPONENT16,b.width,b.height),Qa.framebufferRenderbuffer(Qa.FRAMEBUFFER,Qa.DEPTH_ATTACHMENT,Qa.RENDERBUFFER,a)):b.depthBuffer&&b.stencilBuffer?(Qa.renderbufferStorage(Qa.RENDERBUFFER,Qa.DEPTH_STENCIL,b.width,b.height),Qa.framebufferRenderbuffer(Qa.FRAMEBUFFER,Qa.DEPTH_STENCIL_ATTACHMENT,Qa.RENDERBUFFER,a)):Qa.renderbufferStorage(Qa.RENDERBUFFER,Qa.RGBA4,b.width,b.height),Qa.bindRenderbuffer(Qa.RENDERBUFFER,null)}function Y(a){var b=Va.get(a);if(a instanceof d.WebGLRenderTargetCube){b.__webglDepthbuffer=[];for(var c=0;c<6;c++)Qa.bindFramebuffer(Qa.FRAMEBUFFER,b.__webglFramebuffer[c]),b.__webglDepthbuffer[c]=Qa.createRenderbuffer(),X(b.__webglDepthbuffer[c],a)}else Qa.bindFramebuffer(Qa.FRAMEBUFFER,b.__webglFramebuffer),b.__webglDepthbuffer=Qa.createRenderbuffer(),X(b.__webglDepthbuffer,a);Qa.bindFramebuffer(Qa.FRAMEBUFFER,null)}function Z(a){var b=Va.get(a),c=Va.get(a.texture);a.addEventListener("dispose",i),c.__webglTexture=Qa.createTexture(),Oa.textures++;var e=a instanceof d.WebGLRenderTargetCube,f=d.Math.isPowerOfTwo(a.width)&&d.Math.isPowerOfTwo(a.height);if(e){b.__webglFramebuffer=[];for(var g=0;g<6;g++)b.__webglFramebuffer[g]=Qa.createFramebuffer()}else b.__webglFramebuffer=Qa.createFramebuffer();if(e){Ua.bindTexture(Qa.TEXTURE_CUBE_MAP,c.__webglTexture),O(Qa.TEXTURE_CUBE_MAP,a.texture,f);for(var g=0;g<6;g++)W(b.__webglFramebuffer[g],a,Qa.COLOR_ATTACHMENT0,Qa.TEXTURE_CUBE_MAP_POSITIVE_X+g);a.texture.generateMipmaps&&f&&Qa.generateMipmap(Qa.TEXTURE_CUBE_MAP),Ua.bindTexture(Qa.TEXTURE_CUBE_MAP,null)}else Ua.bindTexture(Qa.TEXTURE_2D,c.__webglTexture),O(Qa.TEXTURE_2D,a.texture,f),W(b.__webglFramebuffer,a,Qa.COLOR_ATTACHMENT0,Qa.TEXTURE_2D),a.texture.generateMipmaps&&f&&Qa.generateMipmap(Qa.TEXTURE_2D),Ua.bindTexture(Qa.TEXTURE_2D,null);a.depthBuffer&&Y(a)}function $(a){var b=a instanceof d.WebGLRenderTargetCube?Qa.TEXTURE_CUBE_MAP:Qa.TEXTURE_2D,c=Va.get(a.texture).__webglTexture;Ua.bindTexture(b,c),Qa.generateMipmap(b),Ua.bindTexture(b,null)}function _(a){return a===d.NearestFilter||a===d.NearestMipMapNearestFilter||a===d.NearestMipMapLinearFilter?Qa.NEAREST:Qa.LINEAR}function aa(a){var b;if(a===d.RepeatWrapping)return Qa.REPEAT;if(a===d.ClampToEdgeWrapping)return Qa.CLAMP_TO_EDGE;if(a===d.MirroredRepeatWrapping)return Qa.MIRRORED_REPEAT;if(a===d.NearestFilter)return Qa.NEAREST;if(a===d.NearestMipMapNearestFilter)return Qa.NEAREST_MIPMAP_NEAREST;if(a===d.NearestMipMapLinearFilter)return Qa.NEAREST_MIPMAP_LINEAR;if(a===d.LinearFilter)return Qa.LINEAR;if(a===d.LinearMipMapNearestFilter)return Qa.LINEAR_MIPMAP_NEAREST;if(a===d.LinearMipMapLinearFilter)return Qa.LINEAR_MIPMAP_LINEAR;if(a===d.UnsignedByteType)return Qa.UNSIGNED_BYTE;if(a===d.UnsignedShort4444Type)return Qa.UNSIGNED_SHORT_4_4_4_4;if(a===d.UnsignedShort5551Type)return Qa.UNSIGNED_SHORT_5_5_5_1;if(a===d.UnsignedShort565Type)return Qa.UNSIGNED_SHORT_5_6_5;if(a===d.ByteType)return Qa.BYTE;if(a===d.ShortType)return Qa.SHORT;if(a===d.UnsignedShortType)return Qa.UNSIGNED_SHORT;if(a===d.IntType)return Qa.INT;if(a===d.UnsignedIntType)return Qa.UNSIGNED_INT;if(a===d.FloatType)return Qa.FLOAT;if(null!==(b=Sa.get("OES_texture_half_float"))&&a===d.HalfFloatType)return b.HALF_FLOAT_OES;if(a===d.AlphaFormat)return Qa.ALPHA;if(a===d.RGBFormat)return Qa.RGB;if(a===d.RGBAFormat)return Qa.RGBA;if(a===d.LuminanceFormat)return Qa.LUMINANCE;if(a===d.LuminanceAlphaFormat)return Qa.LUMINANCE_ALPHA;if(a===d.AddEquation)return Qa.FUNC_ADD;if(a===d.SubtractEquation)return Qa.FUNC_SUBTRACT;if(a===d.ReverseSubtractEquation)return Qa.FUNC_REVERSE_SUBTRACT;if(a===d.ZeroFactor)return Qa.ZERO;if(a===d.OneFactor)return Qa.ONE;if(a===d.SrcColorFactor)return Qa.SRC_COLOR;if(a===d.OneMinusSrcColorFactor)return Qa.ONE_MINUS_SRC_COLOR;if(a===d.SrcAlphaFactor)return Qa.SRC_ALPHA;if(a===d.OneMinusSrcAlphaFactor)return Qa.ONE_MINUS_SRC_ALPHA;if(a===d.DstAlphaFactor)return Qa.DST_ALPHA;if(a===d.OneMinusDstAlphaFactor)return Qa.ONE_MINUS_DST_ALPHA;if(a===d.DstColorFactor)return Qa.DST_COLOR;if(a===d.OneMinusDstColorFactor)return Qa.ONE_MINUS_DST_COLOR;if(a===d.SrcAlphaSaturateFactor)return Qa.SRC_ALPHA_SATURATE;if(null!==(b=Sa.get("WEBGL_compressed_texture_s3tc"))){if(a===d.RGB_S3TC_DXT1_Format)return b.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===d.RGBA_S3TC_DXT1_Format)return b.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===d.RGBA_S3TC_DXT3_Format)return b.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===d.RGBA_S3TC_DXT5_Format)return b.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(null!==(b=Sa.get("WEBGL_compressed_texture_pvrtc"))){if(a===d.RGB_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===d.RGB_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===d.RGBA_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===d.RGBA_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(null!==(b=Sa.get("WEBGL_compressed_texture_etc1"))&&a===d.RGB_ETC1_Format)return b.COMPRESSED_RGB_ETC1_WEBGL;if(null!==(b=Sa.get("EXT_blend_minmax"))){if(a===d.MinEquation)return b.MIN_EXT;if(a===d.MaxEquation)return b.MAX_EXT}return 0}console.log("THREE.WebGLRenderer",d.REVISION),a=a||{};var ba=void 0!==a.canvas?a.canvas:document.createElement("canvas"),ca=void 0!==a.context?a.context:null,da=void 0!==a.alpha&&a.alpha,ea=void 0===a.depth||a.depth,fa=void 0===a.stencil||a.stencil,ga=void 0!==a.antialias&&a.antialias,ha=void 0===a.premultipliedAlpha||a.premultipliedAlpha,ia=void 0!==a.preserveDrawingBuffer&&a.preserveDrawingBuffer,ja=[],ka=[],la=-1,ma=[],na=-1,oa=new Float32Array(8),pa=[],qa=[];this.domElement=ba,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=d.LinearToneMapping,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0;var ra=this,sa=null,ta=null,ua=null,va=-1,wa="",xa=null,ya=new d.Vector4,za=null,Aa=new d.Vector4,Ba=0,Ca=new d.Color(0),Da=0,Ea=ba.width,Fa=ba.height,Ga=1,Ha=new d.Vector4(0,0,Ea,Fa),Ia=!1,Ja=new d.Vector4(0,0,Ea,Fa),Ka=new d.Frustum,La=new d.Matrix4,Ma=new d.Vector3,Na={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[],shadowsPointLight:0},Oa={geometries:0,textures:0},Pa={calls:0,vertices:0,faces:0,points:0};this.info={render:Pa,memory:Oa,programs:null};var Qa;try{var Ra={alpha:da,depth:ea,stencil:fa,antialias:ga,premultipliedAlpha:ha,preserveDrawingBuffer:ia};if(null===(Qa=ca||ba.getContext("webgl",Ra)||ba.getContext("experimental-webgl",Ra)))throw null!==ba.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";void 0===Qa.getShaderPrecisionFormat&&(Qa.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),ba.addEventListener("webglcontextlost",g,!1)}catch(a){console.error("THREE.WebGLRenderer: "+a)}var Sa=new d.WebGLExtensions(Qa);Sa.get("OES_texture_float"),Sa.get("OES_texture_float_linear"),Sa.get("OES_texture_half_float"),Sa.get("OES_texture_half_float_linear"),Sa.get("OES_standard_derivatives"),Sa.get("ANGLE_instanced_arrays"),Sa.get("OES_element_index_uint")&&(d.BufferGeometry.MaxIndex=4294967296);var Ta=new d.WebGLCapabilities(Qa,Sa,a),Ua=new d.WebGLState(Qa,Sa,aa),Va=new d.WebGLProperties,Wa=new d.WebGLObjects(Qa,Va,this.info),Xa=new d.WebGLPrograms(this,Ta),Ya=new d.WebGLLights;this.info.programs=Xa.programs;var Za=new d.WebGLBufferRenderer(Qa,Sa,Pa),$a=new d.WebGLIndexedBufferRenderer(Qa,Sa,Pa);e(),this.context=Qa,this.capabilities=Ta,this.extensions=Sa,this.properties=Va,this.state=Ua;var _a=new d.WebGLShadowMap(this,Na,Wa);this.shadowMap=_a;var ab=new d.SpritePlugin(this,pa),bb=new d.LensFlarePlugin(this,qa);this.getContext=function(){return Qa},this.getContextAttributes=function(){return Qa.getContextAttributes()},this.forceContextLoss=function(){Sa.get("WEBGL_lose_context").loseContext()},this.getMaxAnisotropy=function(){var a;return function(){if(void 0!==a)return a;var b=Sa.get("EXT_texture_filter_anisotropic");return a=null!==b?Qa.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}(),this.getPrecision=function(){return Ta.precision},this.getPixelRatio=function(){return Ga},this.setPixelRatio=function(a){void 0!==a&&(Ga=a,this.setSize(Ja.z,Ja.w,!1))},this.getSize=function(){return{width:Ea,height:Fa}},this.setSize=function(a,b,c){Ea=a,Fa=b,ba.width=a*Ga,ba.height=b*Ga,!1!==c&&(ba.style.width=a+"px",ba.style.height=b+"px"),this.setViewport(0,0,a,b)},this.setViewport=function(a,b,c,d){Ua.viewport(Ja.set(a,b,c,d))},this.setScissor=function(a,b,c,d){Ua.scissor(Ha.set(a,b,c,d))},this.setScissorTest=function(a){Ua.setScissorTest(Ia=a)},this.getClearColor=function(){return Ca},this.setClearColor=function(a,b){Ca.set(a),Da=void 0!==b?b:1,c(Ca.r,Ca.g,Ca.b,Da)},this.getClearAlpha=function(){return Da},this.setClearAlpha=function(a){Da=a,c(Ca.r,Ca.g,Ca.b,Da)},this.clear=function(a,b,c){var d=0;(void 0===a||a)&&(d|=Qa.COLOR_BUFFER_BIT),(void 0===b||b)&&(d|=Qa.DEPTH_BUFFER_BIT),(void 0===c||c)&&(d|=Qa.STENCIL_BUFFER_BIT),Qa.clear(d)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(a,b,c,d){this.setRenderTarget(a),this.clear(b,c,d)},this.resetGLState=f,this.dispose=function(){ba.removeEventListener("webglcontextlost",g,!1)},this.renderBufferImmediate=function(a,b,c){Ua.initAttributes();var e=Va.get(a);a.hasPositions&&!e.position&&(e.position=Qa.createBuffer()),a.hasNormals&&!e.normal&&(e.normal=Qa.createBuffer()),a.hasUvs&&!e.uv&&(e.uv=Qa.createBuffer()),a.hasColors&&!e.color&&(e.color=Qa.createBuffer());var f=b.getAttributes();if(a.hasPositions&&(Qa.bindBuffer(Qa.ARRAY_BUFFER,e.position),Qa.bufferData(Qa.ARRAY_BUFFER,a.positionArray,Qa.DYNAMIC_DRAW),Ua.enableAttribute(f.position),Qa.vertexAttribPointer(f.position,3,Qa.FLOAT,!1,0,0)),a.hasNormals){if(Qa.bindBuffer(Qa.ARRAY_BUFFER,e.normal),"MeshPhongMaterial"!==c.type&&"MeshStandardMaterial"!==c.type&&c.shading===d.FlatShading)for(var g=0,h=3*a.count;g<h;g+=9){var i=a.normalArray,j=(i[g+0]+i[g+3]+i[g+6])/3,k=(i[g+1]+i[g+4]+i[g+7])/3,l=(i[g+2]+i[g+5]+i[g+8])/3;i[g+0]=j,i[g+1]=k,i[g+2]=l,i[g+3]=j,i[g+4]=k,i[g+5]=l,i[g+6]=j,i[g+7]=k,i[g+8]=l}Qa.bufferData(Qa.ARRAY_BUFFER,a.normalArray,Qa.DYNAMIC_DRAW),Ua.enableAttribute(f.normal),Qa.vertexAttribPointer(f.normal,3,Qa.FLOAT,!1,0,0)}a.hasUvs&&c.map&&(Qa.bindBuffer(Qa.ARRAY_BUFFER,e.uv),Qa.bufferData(Qa.ARRAY_BUFFER,a.uvArray,Qa.DYNAMIC_DRAW),Ua.enableAttribute(f.uv),Qa.vertexAttribPointer(f.uv,2,Qa.FLOAT,!1,0,0)),a.hasColors&&c.vertexColors!==d.NoColors&&(Qa.bindBuffer(Qa.ARRAY_BUFFER,e.color),Qa.bufferData(Qa.ARRAY_BUFFER,a.colorArray,Qa.DYNAMIC_DRAW),Ua.enableAttribute(f.color),Qa.vertexAttribPointer(f.color,3,Qa.FLOAT,!1,0,0)),Ua.disableUnusedAttributes(),Qa.drawArrays(Qa.TRIANGLES,0,a.count),a.count=0},this.renderBufferDirect=function(a,c,e,f,g,h){w(f);var i=y(a,c,f,g),j=!1,k=e.id+"_"+i.id+"_"+f.wireframe;k!==wa&&(wa=k,j=!0);var l=g.morphTargetInfluences;if(void 0!==l){for(var m=[],n=0,q=l.length;n<q;n++){var r=l[n];m.push([r,n])}m.sort(p),m.length>8&&(m.length=8);for(var s=e.morphAttributes,n=0,q=m.length;n<q;n++){var r=m[n];if(oa[n]=r[0],0!==r[0]){var t=r[1];!0===f.morphTargets&&s.position&&e.addAttribute("morphTarget"+n,s.position[t]),!0===f.morphNormals&&s.normal&&e.addAttribute("morphNormal"+n,s.normal[t])}else!0===f.morphTargets&&e.removeAttribute("morphTarget"+n),!0===f.morphNormals&&e.removeAttribute("morphNormal"+n)}var u=i.getUniforms();null!==u.morphTargetInfluences&&Qa.uniform1fv(u.morphTargetInfluences,oa),j=!0}var t=e.index,v=e.attributes.position;!0===f.wireframe&&(t=Wa.getWireframeAttribute(e));var x;null!==t?(x=$a,x.setIndex(t)):x=Za,j&&(o(f,i,e),null!==t&&Qa.bindBuffer(Qa.ELEMENT_ARRAY_BUFFER,Wa.getAttributeBuffer(t)));var z=1/0;null!==t?z=t.count:void 0!==v&&(z=v.count);var A=e.drawRange.start,B=e.drawRange.count,C=null!==h?h.start:0,D=null!==h?h.count:1/0,E=Math.max(0,A,C),F=Math.min(0+z,A+B,C+D)-1,G=Math.max(0,F-E+1);if(g instanceof d.Mesh)if(!0===f.wireframe)Ua.setLineWidth(f.wireframeLinewidth*b()),x.setMode(Qa.LINES);else switch(g.drawMode){case d.TrianglesDrawMode:x.setMode(Qa.TRIANGLES);break;case d.TriangleStripDrawMode:x.setMode(Qa.TRIANGLE_STRIP);break;case d.TriangleFanDrawMode:x.setMode(Qa.TRIANGLE_FAN)}else if(g instanceof d.Line){var H=f.linewidth;void 0===H&&(H=1),Ua.setLineWidth(H*b()),g instanceof d.LineSegments?x.setMode(Qa.LINES):x.setMode(Qa.LINE_STRIP)}else g instanceof d.Points&&x.setMode(Qa.POINTS)
;e instanceof d.InstancedBufferGeometry?e.maxInstancedCount>0&&x.renderInstances(e,E,G):x.render(E,G)},this.render=function(a,b,c,e){if(b instanceof d.Camera==!1)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");var f=a.fog;if(wa="",va=-1,xa=null,!0===a.autoUpdate&&a.updateMatrixWorld(),null===b.parent&&b.updateMatrixWorld(),b.matrixWorldInverse.getInverse(b.matrixWorld),La.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),Ka.setFromMatrix(La),ja.length=0,la=-1,na=-1,pa.length=0,qa.length=0,t(a,b),ka.length=la+1,ma.length=na+1,!0===ra.sortObjects&&(ka.sort(q),ma.sort(r)),N(ja,b),_a.render(a,b),Pa.calls=0,Pa.vertices=0,Pa.faces=0,Pa.points=0,void 0===c&&(c=null),this.setRenderTarget(c),(this.autoClear||e)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),a.overrideMaterial){var g=a.overrideMaterial;u(ka,b,f,g),u(ma,b,f,g)}else Ua.setBlending(d.NoBlending),u(ka,b,f),u(ma,b,f);if(ab.render(a,b),bb.render(a,b,Aa),c){var h=c.texture;h.generateMipmaps&&R(c)&&h.minFilter!==d.NearestFilter&&h.minFilter!==d.LinearFilter&&$(c)}Ua.setDepthTest(!0),Ua.setDepthWrite(!0),Ua.setColorWrite(!0)},this.setFaceCulling=function(a,b){a===d.CullFaceNone?Ua.disable(Qa.CULL_FACE):(b===d.FrontFaceDirectionCW?Qa.frontFace(Qa.CW):Qa.frontFace(Qa.CCW),a===d.CullFaceBack?Qa.cullFace(Qa.BACK):a===d.CullFaceFront?Qa.cullFace(Qa.FRONT):Qa.cullFace(Qa.FRONT_AND_BACK),Ua.enable(Qa.CULL_FACE))},this.setTexture=function(a,b){var c=Va.get(a);if(a.version>0&&c.__version!==a.version){var d=a.image;return void 0===d?void console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",a):!1===d.complete?void console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",a):void P(c,a,b)}Ua.activeTexture(Qa.TEXTURE0+b),Ua.bindTexture(Qa.TEXTURE_2D,c.__webglTexture)},this.getCurrentRenderTarget=function(){return ta},this.setRenderTarget=function(a){ta=a,a&&void 0===Va.get(a).__webglFramebuffer&&Z(a);var b,c=a instanceof d.WebGLRenderTargetCube;if(a){var e=Va.get(a);b=c?e.__webglFramebuffer[a.activeCubeFace]:e.__webglFramebuffer,ya.copy(a.scissor),za=a.scissorTest,Aa.copy(a.viewport)}else b=null,ya.copy(Ha).multiplyScalar(Ga),za=Ia,Aa.copy(Ja).multiplyScalar(Ga);if(ua!==b&&(Qa.bindFramebuffer(Qa.FRAMEBUFFER,b),ua=b),Ua.scissor(ya),Ua.setScissorTest(za),Ua.viewport(Aa),c){var f=Va.get(a.texture);Qa.framebufferTexture2D(Qa.FRAMEBUFFER,Qa.COLOR_ATTACHMENT0,Qa.TEXTURE_CUBE_MAP_POSITIVE_X+a.activeCubeFace,f.__webglTexture,a.activeMipMapLevel)}},this.readRenderTargetPixels=function(a,b,c,e,f,g){if(a instanceof d.WebGLRenderTarget==!1)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");var h=Va.get(a).__webglFramebuffer;if(h){var i=!1;h!==ua&&(Qa.bindFramebuffer(Qa.FRAMEBUFFER,h),i=!0);try{var j=a.texture;if(j.format!==d.RGBAFormat&&aa(j.format)!==Qa.getParameter(Qa.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(j.type===d.UnsignedByteType||aa(j.type)===Qa.getParameter(Qa.IMPLEMENTATION_COLOR_READ_TYPE)||j.type===d.FloatType&&Sa.get("WEBGL_color_buffer_float")||j.type===d.HalfFloatType&&Sa.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Qa.checkFramebufferStatus(Qa.FRAMEBUFFER)===Qa.FRAMEBUFFER_COMPLETE?Qa.readPixels(b,c,e,f,aa(j.format),aa(j.type),g):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{i&&Qa.bindFramebuffer(Qa.FRAMEBUFFER,ua)}}}},d.WebGLRenderTarget=function(a,b,c){this.uuid=d.Math.generateUUID(),this.width=a,this.height=b,this.scissor=new d.Vector4(0,0,a,b),this.scissorTest=!1,this.viewport=new d.Vector4(0,0,a,b),c=c||{},void 0===c.minFilter&&(c.minFilter=d.LinearFilter),this.texture=new d.Texture(void 0,void 0,c.wrapS,c.wrapT,c.magFilter,c.minFilter,c.format,c.type,c.anisotropy),this.depthBuffer=void 0===c.depthBuffer||c.depthBuffer,this.stencilBuffer=void 0===c.stencilBuffer||c.stencilBuffer},d.WebGLRenderTarget.prototype={constructor:d.WebGLRenderTarget,setSize:function(a,b){this.width===a&&this.height===b||(this.width=a,this.height=b,this.dispose()),this.viewport.set(0,0,a,b),this.scissor.set(0,0,a,b)},clone:function(){return(new this.constructor).copy(this)},copy:function(a){return this.width=a.width,this.height=a.height,this.viewport.copy(a.viewport),this.texture=a.texture.clone(),this.depthBuffer=a.depthBuffer,this.stencilBuffer=a.stencilBuffer,this},dispose:function(){this.dispatchEvent({type:"dispose"})}},d.EventDispatcher.prototype.apply(d.WebGLRenderTarget.prototype),d.WebGLRenderTargetCube=function(a,b,c){d.WebGLRenderTarget.call(this,a,b,c),this.activeCubeFace=0,this.activeMipMapLevel=0},d.WebGLRenderTargetCube.prototype=Object.create(d.WebGLRenderTarget.prototype),d.WebGLRenderTargetCube.prototype.constructor=d.WebGLRenderTargetCube,d.WebGLBufferRenderer=function(a,b,c){function e(a){h=a}function f(b,d){a.drawArrays(h,b,d),c.calls++,c.vertices+=d,h===a.TRIANGLES&&(c.faces+=d/3)}function g(e){var f=b.get("ANGLE_instanced_arrays");if(null===f)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");var g=e.attributes.position,i=0;g instanceof d.InterleavedBufferAttribute?(i=g.data.count,f.drawArraysInstancedANGLE(h,0,i,e.maxInstancedCount)):(i=g.count,f.drawArraysInstancedANGLE(h,0,i,e.maxInstancedCount)),c.calls++,c.vertices+=i*e.maxInstancedCount,h===a.TRIANGLES&&(c.faces+=e.maxInstancedCount*i/3)}var h;this.setMode=e,this.render=f,this.renderInstances=g},d.WebGLIndexedBufferRenderer=function(a,b,c){function d(a){h=a}function e(c){c.array instanceof Uint32Array&&b.get("OES_element_index_uint")?(i=a.UNSIGNED_INT,j=4):(i=a.UNSIGNED_SHORT,j=2)}function f(b,d){a.drawElements(h,d,i,b*j),c.calls++,c.vertices+=d,h===a.TRIANGLES&&(c.faces+=d/3)}function g(d,e,f){var g=b.get("ANGLE_instanced_arrays");if(null===g)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");g.drawElementsInstancedANGLE(h,f,i,e*j,d.maxInstancedCount),c.calls++,c.vertices+=f*d.maxInstancedCount,h===a.TRIANGLES&&(c.faces+=d.maxInstancedCount*f/3)}var h,i,j;this.setMode=d,this.setIndex=e,this.render=f,this.renderInstances=g},d.WebGLExtensions=function(a){var b={};this.get=function(c){if(void 0!==b[c])return b[c];var d;switch(c){case"EXT_texture_filter_anisotropic":d=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":d=a.getExtension("WEBGL_compressed_texture_s3tc")||a.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":d=a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":d=a.getExtension("WEBGL_compressed_texture_etc1");break;default:d=a.getExtension(c)}return null===d&&console.warn("THREE.WebGLRenderer: "+c+" extension not supported."),b[c]=d,d}},d.WebGLCapabilities=function(a,b,c){function d(b){if("highp"===b){if(a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision>0&&a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision>0)return"highp";b="mediump"}return"mediump"===b&&a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision>0&&a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}this.getMaxPrecision=d,this.precision=void 0!==c.precision?c.precision:"highp",this.logarithmicDepthBuffer=void 0!==c.logarithmicDepthBuffer&&c.logarithmicDepthBuffer,this.maxTextures=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),this.maxVertexTextures=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),this.maxCubemapSize=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE),this.maxAttributes=a.getParameter(a.MAX_VERTEX_ATTRIBS),this.maxVertexUniforms=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),this.maxVaryings=a.getParameter(a.MAX_VARYING_VECTORS),this.maxFragmentUniforms=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS),this.vertexTextures=this.maxVertexTextures>0,this.floatFragmentTextures=!!b.get("OES_texture_float"),this.floatVertexTextures=this.vertexTextures&&this.floatFragmentTextures;var e=d(this.precision);e!==this.precision&&(console.warn("THREE.WebGLRenderer:",this.precision,"not supported, using",e,"instead."),this.precision=e),this.logarithmicDepthBuffer&&(this.logarithmicDepthBuffer=!!b.get("EXT_frag_depth"))},d.WebGLGeometries=function(a,b,c){function e(a){var b=a.geometry;if(void 0!==k[b.id])return k[b.id];b.addEventListener("dispose",f);var e;return b instanceof d.BufferGeometry?e=b:b instanceof d.Geometry&&(void 0===b._bufferGeometry&&(b._bufferGeometry=(new d.BufferGeometry).setFromObject(a)),e=b._bufferGeometry),k[b.id]=e,c.memory.geometries++,e}function f(a){var d=a.target,e=k[d.id];null!==e.index&&h(e.index),i(e.attributes),d.removeEventListener("dispose",f),delete k[d.id];var g=b.get(d);g.wireframe&&h(g.wireframe),b.delete(d);var j=b.get(e);j.wireframe&&h(j.wireframe),b.delete(e),c.memory.geometries--}function g(a){return a instanceof d.InterleavedBufferAttribute?b.get(a.data).__webglBuffer:b.get(a).__webglBuffer}function h(b){var c=g(b);void 0!==c&&(a.deleteBuffer(c),j(b))}function i(a){for(var b in a)h(a[b])}function j(a){a instanceof d.InterleavedBufferAttribute?b.delete(a.data):b.delete(a)}var k={};this.get=e},d.WebGLLights=function(){var a={};this.get=function(b){if(void 0!==a[b.id])return a[b.id];var c;switch(b.type){case"DirectionalLight":c={direction:new d.Vector3,color:new d.Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new d.Vector2};break;case"SpotLight":c={position:new d.Vector3,direction:new d.Vector3,color:new d.Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new d.Vector2};break;case"PointLight":c={position:new d.Vector3,color:new d.Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new d.Vector2};break;case"HemisphereLight":c={direction:new d.Vector3,skyColor:new d.Color,groundColor:new d.Color}}return a[b.id]=c,c}},d.WebGLObjects=function(a,b,c){function e(b){var c=l.get(b);b.geometry instanceof d.Geometry&&c.updateFromObject(b);var e=c.index,g=c.attributes;null!==e&&f(e,a.ELEMENT_ARRAY_BUFFER);for(var h in g)f(g[h],a.ARRAY_BUFFER);var i=c.morphAttributes;for(var h in i)for(var j=i[h],k=0,m=j.length;k<m;k++)f(j[k],a.ARRAY_BUFFER);return c}function f(a,c){var e=a instanceof d.InterleavedBufferAttribute?a.data:a,f=b.get(e);void 0===f.__webglBuffer?g(f,e,c):f.version!==e.version&&h(f,e,c)}function g(b,c,d){b.__webglBuffer=a.createBuffer(),a.bindBuffer(d,b.__webglBuffer);var e=c.dynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW;a.bufferData(d,c.array,e),b.version=c.version}function h(b,c,d){a.bindBuffer(d,b.__webglBuffer),!1===c.dynamic||-1===c.updateRange.count?a.bufferSubData(d,0,c.array):0===c.updateRange.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(a.bufferSubData(d,c.updateRange.offset*c.array.BYTES_PER_ELEMENT,c.array.subarray(c.updateRange.offset,c.updateRange.offset+c.updateRange.count)),c.updateRange.count=0),b.version=c.version}function i(a){return a instanceof d.InterleavedBufferAttribute?b.get(a.data).__webglBuffer:b.get(a).__webglBuffer}function j(c){var e=b.get(c);if(void 0!==e.wireframe)return e.wireframe;var g=[],h=c.index,i=c.attributes,j=i.position;if(null!==h)for(var l={},m=h.array,n=0,o=m.length;n<o;n+=3){var p=m[n+0],q=m[n+1],r=m[n+2];k(l,p,q)&&g.push(p,q),k(l,q,r)&&g.push(q,r),k(l,r,p)&&g.push(r,p)}else for(var m=i.position.array,n=0,o=m.length/3-1;n<o;n+=3){var p=n+0,q=n+1,r=n+2;g.push(p,q,q,r,r,p)}var s=j.count>65535?Uint32Array:Uint16Array,t=new d.BufferAttribute(new s(g),1);return f(t,a.ELEMENT_ARRAY_BUFFER),e.wireframe=t,t}function k(a,b,c){if(b>c){var d=b;b=c,c=d}var e=a[b];return void 0===e?(a[b]=[c],!0):-1===e.indexOf(c)&&(e.push(c),!0)}var l=new d.WebGLGeometries(a,b,c);this.getAttributeBuffer=i,this.getWireframeAttribute=j,this.update=e},d.WebGLProgram=function(){function a(a){switch(a){case d.LinearEncoding:return["Linear","( value )"];case d.sRGBEncoding:return["sRGB","( value )"];case d.RGBEEncoding:return["RGBE","( value )"];case d.RGBM7Encoding:return["RGBM","( value, 7.0 )"];case d.RGBM16Encoding:return["RGBM","( value, 16.0 )"];case d.RGBDEncoding:return["RGBD","( value, 256.0 )"];case d.GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+a)}}function b(b,c){var d=a(c);return"vec4 "+b+"( vec4 value ) { return "+d[0]+"ToLinear"+d[1]+"; }"}function c(b,c){var d=a(c);return"vec4 "+b+"( vec4 value ) { return LinearTo"+d[0]+d[1]+"; }"}function e(a,b){var c;switch(b){case d.LinearToneMapping:c="Linear";break;case d.ReinhardToneMapping:c="Reinhard";break;case d.Uncharted2ToneMapping:c="Uncharted2";break;case d.CineonToneMapping:c="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+b)}return"vec3 "+a+"( vec3 color ) { return "+c+"ToneMapping( color ); }"}function f(a,b,c){return a=a||{},[a.derivatives||b.envMapCubeUV||b.bumpMap||b.normalMap||b.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(a.fragDepth||b.logarithmicDepthBuffer)&&c.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",a.drawBuffers&&c.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(a.shaderTextureLOD||b.envMap)&&c.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(j).join("\n")}function g(a){var b=[];for(var c in a){var d=a[c];!1!==d&&b.push("#define "+c+" "+d)}return b.join("\n")}function h(a,b,c){for(var d={},e=a.getProgramParameter(b,a.ACTIVE_UNIFORMS),f=0;f<e;f++){var g=a.getActiveUniform(b,f),h=g.name,i=a.getUniformLocation(b,h),j=o.exec(h);if(j){var k=j[1],l=j[2],m=d[k];m||(m=d[k]={}),m[l]=i}else if(j=p.exec(h)){var n=j[1],r=j[2],s=j[3],t=d[n];t||(t=d[n]=[]);var u=t[r];u||(u=t[r]={}),u[s]=i}else if(j=q.exec(h)){var n=j[1];d[n]=i}else d[h]=i}return d}function i(a,b,c){for(var d={},e=a.getProgramParameter(b,a.ACTIVE_ATTRIBUTES),f=0;f<e;f++){var g=a.getActiveAttrib(b,f),h=g.name;d[h]=a.getAttribLocation(b,h)}return d}function j(a){return""!==a}function k(a,b){return a.replace(/NUM_DIR_LIGHTS/g,b.numDirLights).replace(/NUM_SPOT_LIGHTS/g,b.numSpotLights).replace(/NUM_POINT_LIGHTS/g,b.numPointLights).replace(/NUM_HEMI_LIGHTS/g,b.numHemiLights)}function l(a){function b(a,b){var c=d.ShaderChunk[b];if(void 0===c)throw new Error("Can not resolve #include <"+b+">");return l(c)}var c=/#include +<([\w\d.]+)>/g;return a.replace(c,b)}function m(a){function b(a,b,c,d){for(var e="",f=parseInt(b);f<parseInt(c);f++)e+=d.replace(/\[ i \]/g,"[ "+f+" ]");return e}var c=/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;return a.replace(c,b)}var n=0,o=/^([\w\d_]+)\.([\w\d_]+)$/,p=/^([\w\d_]+)\[(\d+)\]\.([\w\d_]+)$/,q=/^([\w\d_]+)\[0\]$/;return function(a,o,p,q){var r=a.context,s=p.extensions,t=p.defines,u=p.__webglShader.vertexShader,v=p.__webglShader.fragmentShader,w="SHADOWMAP_TYPE_BASIC";q.shadowMapType===d.PCFShadowMap?w="SHADOWMAP_TYPE_PCF":q.shadowMapType===d.PCFSoftShadowMap&&(w="SHADOWMAP_TYPE_PCF_SOFT");var x="ENVMAP_TYPE_CUBE",y="ENVMAP_MODE_REFLECTION",z="ENVMAP_BLENDING_MULTIPLY";if(q.envMap){switch(p.envMap.mapping){case d.CubeReflectionMapping:case d.CubeRefractionMapping:x="ENVMAP_TYPE_CUBE";break;case d.CubeUVReflectionMapping:case d.CubeUVRefractionMapping:x="ENVMAP_TYPE_CUBE_UV";break;case d.EquirectangularReflectionMapping:case d.EquirectangularRefractionMapping:x="ENVMAP_TYPE_EQUIREC";break;case d.SphericalReflectionMapping:x="ENVMAP_TYPE_SPHERE"}switch(p.envMap.mapping){case d.CubeRefractionMapping:case d.EquirectangularRefractionMapping:y="ENVMAP_MODE_REFRACTION"}switch(p.combine){case d.MultiplyOperation:z="ENVMAP_BLENDING_MULTIPLY";break;case d.MixOperation:z="ENVMAP_BLENDING_MIX";break;case d.AddOperation:z="ENVMAP_BLENDING_ADD"}}var A,B,C=a.gammaFactor>0?a.gammaFactor:1,D=f(s,q,a.extensions),E=g(t),F=r.createProgram();p instanceof d.RawShaderMaterial?(A="",B=""):(A=["precision "+q.precision+" float;","precision "+q.precision+" int;","#define SHADER_NAME "+p.__webglShader.name,E,q.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+C,"#define MAX_BONES "+q.maxBones,q.map?"#define USE_MAP":"",q.envMap?"#define USE_ENVMAP":"",q.envMap?"#define "+y:"",q.lightMap?"#define USE_LIGHTMAP":"",q.aoMap?"#define USE_AOMAP":"",q.emissiveMap?"#define USE_EMISSIVEMAP":"",q.bumpMap?"#define USE_BUMPMAP":"",q.normalMap?"#define USE_NORMALMAP":"",q.displacementMap&&q.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",q.specularMap?"#define USE_SPECULARMAP":"",q.roughnessMap?"#define USE_ROUGHNESSMAP":"",q.metalnessMap?"#define USE_METALNESSMAP":"",q.alphaMap?"#define USE_ALPHAMAP":"",q.vertexColors?"#define USE_COLOR":"",q.flatShading?"#define FLAT_SHADED":"",q.skinning?"#define USE_SKINNING":"",q.useVertexTexture?"#define BONE_TEXTURE":"",q.morphTargets?"#define USE_MORPHTARGETS":"",q.morphNormals&&!1===q.flatShading?"#define USE_MORPHNORMALS":"",q.doubleSided?"#define DOUBLE_SIDED":"",q.flipSided?"#define FLIP_SIDED":"",q.shadowMapEnabled?"#define USE_SHADOWMAP":"",q.shadowMapEnabled?"#define "+w:"",q.pointLightShadows>0?"#define POINT_LIGHT_SHADOWS":"",q.sizeAttenuation?"#define USE_SIZEATTENUATION":"",q.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",q.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(j).join("\n"),B=[D,"precision "+q.precision+" float;","precision "+q.precision+" int;","#define SHADER_NAME "+p.__webglShader.name,E,q.alphaTest?"#define ALPHATEST "+q.alphaTest:"","#define GAMMA_FACTOR "+C,q.useFog&&q.fog?"#define USE_FOG":"",q.useFog&&q.fogExp?"#define FOG_EXP2":"",q.map?"#define USE_MAP":"",q.envMap?"#define USE_ENVMAP":"",q.envMap?"#define "+x:"",q.envMap?"#define "+y:"",q.envMap?"#define "+z:"",q.lightMap?"#define USE_LIGHTMAP":"",q.aoMap?"#define USE_AOMAP":"",q.emissiveMap?"#define USE_EMISSIVEMAP":"",q.bumpMap?"#define USE_BUMPMAP":"",q.normalMap?"#define USE_NORMALMAP":"",q.specularMap?"#define USE_SPECULARMAP":"",q.roughnessMap?"#define USE_ROUGHNESSMAP":"",q.metalnessMap?"#define USE_METALNESSMAP":"",q.alphaMap?"#define USE_ALPHAMAP":"",q.vertexColors?"#define USE_COLOR":"",q.flatShading?"#define FLAT_SHADED":"",q.doubleSided?"#define DOUBLE_SIDED":"",q.flipSided?"#define FLIP_SIDED":"",q.shadowMapEnabled?"#define USE_SHADOWMAP":"",q.shadowMapEnabled?"#define "+w:"",q.pointLightShadows>0?"#define POINT_LIGHT_SHADOWS":"",q.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",q.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",q.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",q.logarithmicDepthBuffer&&a.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",q.envMap&&a.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",q.toneMapping!==d.NoToneMapping?"#define TONE_MAPPING":"",q.toneMapping!==d.NoToneMapping?d.ShaderChunk.tonemapping_pars_fragment:"",q.toneMapping!==d.NoToneMapping?e("toneMapping",q.toneMapping):"",q.outputEncoding||q.mapEncoding||q.envMapEncoding||q.emissiveMapEncoding?d.ShaderChunk.encodings_pars_fragment:"",q.mapEncoding?b("mapTexelToLinear",q.mapEncoding):"",q.envMapEncoding?b("envMapTexelToLinear",q.envMapEncoding):"",q.emissiveMapEncoding?b("emissiveMapTexelToLinear",q.emissiveMapEncoding):"",q.outputEncoding?c("linearToOutputTexel",q.outputEncoding):"","\n"].filter(j).join("\n")),u=l(u,q),u=k(u,q),v=l(v,q),v=k(v,q),p instanceof d.ShaderMaterial==!1&&(u=m(u),v=m(v));var G=A+u,H=B+v,I=d.WebGLShader(r,r.VERTEX_SHADER,G),J=d.WebGLShader(r,r.FRAGMENT_SHADER,H);r.attachShader(F,I),r.attachShader(F,J),void 0!==p.index0AttributeName?r.bindAttribLocation(F,0,p.index0AttributeName):!0===q.morphTargets&&r.bindAttribLocation(F,0,"position"),r.linkProgram(F);var K=r.getProgramInfoLog(F),L=r.getShaderInfoLog(I),M=r.getShaderInfoLog(J),N=!0,O=!0;!1===r.getProgramParameter(F,r.LINK_STATUS)?(N=!1,console.error("THREE.WebGLProgram: shader error: ",r.getError(),"gl.VALIDATE_STATUS",r.getProgramParameter(F,r.VALIDATE_STATUS),"gl.getProgramInfoLog",K,L,M)):""!==K?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",K):""!==L&&""!==M||(O=!1),O&&(this.diagnostics={runnable:N,material:p,programLog:K,vertexShader:{log:L,prefix:A},fragmentShader:{log:M,prefix:B}}),r.deleteShader(I),r.deleteShader(J);var P;this.getUniforms=function(){return void 0===P&&(P=h(r,F)),P};var Q;return this.getAttributes=function(){return void 0===Q&&(Q=i(r,F)),Q},this.destroy=function(){r.deleteProgram(F),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=n++,this.code=o,this.usedTimes=1,this.program=F,this.vertexShader=I,this.fragmentShader=J,this}}(),d.WebGLPrograms=function(a,b){function c(a){if(b.floatVertexTextures&&a&&a.skeleton&&a.skeleton.useVertexTexture)return 1024;var c=b.maxVertexUniforms,e=Math.floor((c-20)/4),f=e;return void 0!==a&&a instanceof d.SkinnedMesh&&(f=Math.min(a.skeleton.bones.length,f))<a.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+a.skeleton.bones.length+", this GPU supports just "+f+" (try OpenGL instead of ANGLE)"),f}function e(a,b){var c;return a?a instanceof d.Texture?c=a.encoding:a instanceof d.WebGLRenderTarget&&(c=a.texture.encoding):c=d.LinearEncoding,c===d.LinearEncoding&&b&&(c=d.GammaEncoding),c}var f=[],g={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshStandardMaterial:"standard",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},h=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","shadowMapEnabled","pointLightShadows","toneMapping","physicallyCorrectLights","shadowMapType","alphaTest","doubleSided","flipSided"];this.getParameters=function(f,h,i,j){var k=g[f.type],l=c(j),m=a.getPrecision();return null!==f.precision&&(m=b.getMaxPrecision(f.precision))!==f.precision&&console.warn("THREE.WebGLProgram.getParameters:",f.precision,"not supported, using",m,"instead."),{shaderID:k,precision:m,supportsVertexTextures:b.vertexTextures,outputEncoding:e(a.getCurrentRenderTarget(),a.gammaOutput),map:!!f.map,mapEncoding:e(f.map,a.gammaInput),envMap:!!f.envMap,envMapMode:f.envMap&&f.envMap.mapping,envMapEncoding:e(f.envMap,a.gammaInput),envMapCubeUV:!!f.envMap&&(f.envMap.mapping===d.CubeUVReflectionMapping||f.envMap.mapping===d.CubeUVRefractionMapping),lightMap:!!f.lightMap,aoMap:!!f.aoMap,emissiveMap:!!f.emissiveMap,emissiveMapEncoding:e(f.emissiveMap,a.gammaInput),bumpMap:!!f.bumpMap,normalMap:!!f.normalMap,displacementMap:!!f.displacementMap,roughnessMap:!!f.roughnessMap,metalnessMap:!!f.metalnessMap,specularMap:!!f.specularMap,alphaMap:!!f.alphaMap,combine:f.combine,vertexColors:f.vertexColors,fog:i,useFog:f.fog,fogExp:i instanceof d.FogExp2,flatShading:f.shading===d.FlatShading,sizeAttenuation:f.sizeAttenuation,logarithmicDepthBuffer:b.logarithmicDepthBuffer,skinning:f.skinning,maxBones:l,useVertexTexture:b.floatVertexTextures&&j&&j.skeleton&&j.skeleton.useVertexTexture,morphTargets:f.morphTargets,morphNormals:f.morphNormals,maxMorphTargets:a.maxMorphTargets,maxMorphNormals:a.maxMorphNormals,numDirLights:h.directional.length,numPointLights:h.point.length,numSpotLights:h.spot.length,numHemiLights:h.hemi.length,pointLightShadows:h.shadowsPointLight,shadowMapEnabled:a.shadowMap.enabled&&j.receiveShadow&&h.shadows.length>0,shadowMapType:a.shadowMap.type,toneMapping:a.toneMapping,physicallyCorrectLights:a.physicallyCorrectLights,premultipliedAlpha:f.premultipliedAlpha,alphaTest:f.alphaTest,doubleSided:f.side===d.DoubleSide,flipSided:f.side===d.BackSide}},this.getProgramCode=function(a,b){var c=[];if(b.shaderID?c.push(b.shaderID):(c.push(a.fragmentShader),c.push(a.vertexShader)),void 0!==a.defines)for(var d in a.defines)c.push(d),c.push(a.defines[d]);for(var e=0;e<h.length;e++){var f=h[e];c.push(f),c.push(b[f])}return c.join()},this.acquireProgram=function(b,c,e){for(var g,h=0,i=f.length;h<i;h++){var j=f[h];if(j.code===e){g=j,++g.usedTimes;break}}return void 0===g&&(g=new d.WebGLProgram(a,e,b,c),f.push(g)),g},this.releaseProgram=function(a){if(0==--a.usedTimes){var b=f.indexOf(a);f[b]=f[f.length-1],f.pop(),a.destroy()}},this.programs=f},d.WebGLProperties=function(){var a={};this.get=function(b){var c=b.uuid,d=a[c];return void 0===d&&(d={},a[c]=d),d},this.delete=function(b){delete a[b.uuid]},this.clear=function(){a={}}},d.WebGLShader=function(){function a(a){for(var b=a.split("\n"),c=0;c<b.length;c++)b[c]=c+1+": "+b[c];return b.join("\n")}return function(b,c,d){var e=b.createShader(c);return b.shaderSource(e,d),b.compileShader(e),!1===b.getShaderParameter(e,b.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==b.getShaderInfoLog(e)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",c===b.VERTEX_SHADER?"vertex":"fragment",b.getShaderInfoLog(e),a(d)),e}}(),d.WebGLShadowMap=function(a,b,c){function e(a,b,c,e){var f=a.geometry,g=null,h=r,i=a.customDepthMaterial;if(c&&(h=s,i=a.customDistanceMaterial),i)g=i;else{var j=void 0!==f.morphTargets&&f.morphTargets.length>0&&b.morphTargets,k=a instanceof d.SkinnedMesh&&b.skinning,l=0;j&&(l|=o),k&&(l|=p),g=h[l]}return g.visible=b.visible,g.wireframe=b.wireframe,g.wireframeLinewidth=b.wireframeLinewidth,c&&void 0!==g.uniforms.lightPos&&g.uniforms.lightPos.value.copy(e),g}function f(a,b,c){if(!1!==a.visible){if(a.layers.test(b.layers)&&(a instanceof d.Mesh||a instanceof d.Line||a instanceof d.Points)&&a.castShadow&&(!1===a.frustumCulled||!0===i.intersectsObject(a))){!0===a.material.visible&&(a.modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,a.matrixWorld),n.push(a))}for(var e=a.children,g=0,h=e.length;g<h;g++)f(e[g],b,c)}}for(var g=a.context,h=a.state,i=new d.Frustum,j=new d.Matrix4,k=new d.Vector2,l=new d.Vector3,m=new d.Vector3,n=[],o=1,p=2,q=1+(o|p),r=new Array(q),s=new Array(q),t=[new d.Vector3(1,0,0),new d.Vector3(-1,0,0),new d.Vector3(0,0,1),new d.Vector3(0,0,-1),new d.Vector3(0,1,0),new d.Vector3(0,-1,0)],u=[new d.Vector3(0,1,0),new d.Vector3(0,1,0),new d.Vector3(0,1,0),new d.Vector3(0,1,0),new d.Vector3(0,0,1),new d.Vector3(0,0,-1)],v=[new d.Vector4,new d.Vector4,new d.Vector4,new d.Vector4,new d.Vector4,new d.Vector4],w=d.ShaderLib.depthRGBA,x=d.UniformsUtils.clone(w.uniforms),y=d.ShaderLib.distanceRGBA,z=d.UniformsUtils.clone(y.uniforms),A=0;A!==q;++A){var B=0!=(A&o),C=0!=(A&p),D=new d.ShaderMaterial({uniforms:x,vertexShader:w.vertexShader,fragmentShader:w.fragmentShader,morphTargets:B,skinning:C});r[A]=D;var E=new d.ShaderMaterial({defines:{USE_SHADOWMAP:""},uniforms:z,vertexShader:y.vertexShader,fragmentShader:y.fragmentShader,morphTargets:B,skinning:C});s[A]=E}var F=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=d.PCFShadowMap,this.cullFace=d.CullFaceFront,this.render=function(o,p){var q,r,s=b.shadows;if(0!==s.length&&!1!==F.enabled&&(!1!==F.autoUpdate||!1!==F.needsUpdate)){h.clearColor(1,1,1,1),h.disable(g.BLEND),h.enable(g.CULL_FACE),g.frontFace(g.CCW),g.cullFace(F.cullFace===d.CullFaceFront?g.FRONT:g.BACK),h.setDepthTest(!0),h.setScissorTest(!1);for(var w=0,x=s.length;w<x;w++){var y=s[w],z=y.shadow,A=z.camera;if(k.copy(z.mapSize),y instanceof d.PointLight){q=6,r=!0;var B=k.x,C=k.y;v[0].set(2*B,C,B,C),v[1].set(0,C,B,C),v[2].set(3*B,C,B,C),v[3].set(B,C,B,C),v[4].set(3*B,0,B,C),v[5].set(B,0,B,C),k.x*=4,k.y*=2}else q=1,r=!1;if(null===z.map){var D={minFilter:d.NearestFilter,magFilter:d.NearestFilter,format:d.RGBAFormat};z.map=new d.WebGLRenderTarget(k.x,k.y,D),y instanceof d.SpotLight&&(A.aspect=k.x/k.y),A.updateProjectionMatrix()}var E=z.map,G=z.matrix;m.setFromMatrixPosition(y.matrixWorld),A.position.copy(m),a.setRenderTarget(E),a.clear();for(var H=0;H<q;H++){if(r){l.copy(A.position),l.add(t[H]),A.up.copy(u[H]),A.lookAt(l);var I=v[H];h.viewport(I)}else l.setFromMatrixPosition(y.target.matrixWorld),A.lookAt(l);A.updateMatrixWorld(),A.matrixWorldInverse.getInverse(A.matrixWorld),G.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),G.multiply(A.projectionMatrix),G.multiply(A.matrixWorldInverse),j.multiplyMatrices(A.projectionMatrix,A.matrixWorldInverse),i.setFromMatrix(j),n.length=0,f(o,p,A);for(var J=0,K=n.length;J<K;J++){var L=n[J],M=c.update(L),N=L.material;if(N instanceof d.MultiMaterial)for(var O=M.groups,P=N.materials,Q=0,R=O.length;Q<R;Q++){var S=O[Q],T=P[S.materialIndex];if(!0===T.visible){var U=e(L,T,r,m);a.renderBufferDirect(A,null,M,U,L,S)}}else{var U=e(L,N,r,m);a.renderBufferDirect(A,null,M,U,L,null)}}}}var V=a.getClearColor(),W=a.getClearAlpha();a.setClearColor(V,W),h.enable(g.BLEND),F.cullFace===d.CullFaceFront&&g.cullFace(g.BACK),F.needsUpdate=!1}}},d.WebGLState=function(a,b,c){var e=this,f=new d.Vector4,g=new Uint8Array(16),h=new Uint8Array(16),i=new Uint8Array(16),j={},k=null,l=null,m=null,n=null,o=null,p=null,q=null,r=null,s=!1,t=null,u=null,v=null,w=null,x=null,y=null,z=null,A=null,B=null,C=null,D=null,E=null,F=null,G=null,H=null,I=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),J=void 0,K={},L=new d.Vector4,M=null,N=null,O=new d.Vector4,P=new d.Vector4,Q=a.createTexture();a.bindTexture(a.TEXTURE_2D,Q),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.RGB,1,1,0,a.RGB,a.UNSIGNED_BYTE,new Uint8Array(3)),this.init=function(){this.clearColor(0,0,0,1),this.clearDepth(1),this.clearStencil(0),this.enable(a.DEPTH_TEST),a.depthFunc(a.LEQUAL),a.frontFace(a.CCW),a.cullFace(a.BACK),this.enable(a.CULL_FACE),this.enable(a.BLEND),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA)},
this.initAttributes=function(){for(var a=0,b=g.length;a<b;a++)g[a]=0},this.enableAttribute=function(c){if(g[c]=1,0===h[c]&&(a.enableVertexAttribArray(c),h[c]=1),0!==i[c]){b.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(c,0),i[c]=0}},this.enableAttributeAndDivisor=function(b,c,d){g[b]=1,0===h[b]&&(a.enableVertexAttribArray(b),h[b]=1),i[b]!==c&&(d.vertexAttribDivisorANGLE(b,c),i[b]=c)},this.disableUnusedAttributes=function(){for(var b=0,c=h.length;b<c;b++)h[b]!==g[b]&&(a.disableVertexAttribArray(b),h[b]=0)},this.enable=function(b){!0!==j[b]&&(a.enable(b),j[b]=!0)},this.disable=function(b){!1!==j[b]&&(a.disable(b),j[b]=!1)},this.getCompressedTextureFormats=function(){if(null===k&&(k=[],b.get("WEBGL_compressed_texture_pvrtc")||b.get("WEBGL_compressed_texture_s3tc")||b.get("WEBGL_compressed_texture_etc1")))for(var c=a.getParameter(a.COMPRESSED_TEXTURE_FORMATS),d=0;d<c.length;d++)k.push(c[d]);return k},this.setBlending=function(b,e,f,g,h,i,j,k){b===d.NoBlending?this.disable(a.BLEND):this.enable(a.BLEND),b===l&&k===s||(b===d.AdditiveBlending?k?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE,a.ONE,a.ONE)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.SRC_ALPHA,a.ONE)):b===d.SubtractiveBlending?k?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.ONE_MINUS_SRC_COLOR)):b===d.MultiplyBlending?k?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ZERO,a.ZERO,a.SRC_COLOR,a.SRC_ALPHA)):(a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ZERO,a.SRC_COLOR)):k?(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)):(a.blendEquationSeparate(a.FUNC_ADD,a.FUNC_ADD),a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA)),l=b,s=k),b===d.CustomBlending?(h=h||e,i=i||f,j=j||g,e===m&&h===p||(a.blendEquationSeparate(c(e),c(h)),m=e,p=h),f===n&&g===o&&i===q&&j===r||(a.blendFuncSeparate(c(f),c(g),c(i),c(j)),n=f,o=g,q=i,r=j)):(m=null,n=null,o=null,p=null,q=null,r=null)},this.setDepthFunc=function(b){if(t!==b){if(b)switch(b){case d.NeverDepth:a.depthFunc(a.NEVER);break;case d.AlwaysDepth:a.depthFunc(a.ALWAYS);break;case d.LessDepth:a.depthFunc(a.LESS);break;case d.LessEqualDepth:a.depthFunc(a.LEQUAL);break;case d.EqualDepth:a.depthFunc(a.EQUAL);break;case d.GreaterEqualDepth:a.depthFunc(a.GEQUAL);break;case d.GreaterDepth:a.depthFunc(a.GREATER);break;case d.NotEqualDepth:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}else a.depthFunc(a.LEQUAL);t=b}},this.setDepthTest=function(b){b?this.enable(a.DEPTH_TEST):this.disable(a.DEPTH_TEST)},this.setDepthWrite=function(b){u!==b&&(a.depthMask(b),u=b)},this.setColorWrite=function(b){v!==b&&(a.colorMask(b,b,b,b),v=b)},this.setStencilFunc=function(b,c,d){x===b&&y===c&&z===d||(a.stencilFunc(b,c,d),x=b,y=c,z=d)},this.setStencilOp=function(b,c,d){A===b&&B===c&&C===d||(a.stencilOp(b,c,d),A=b,B=c,C=d)},this.setStencilTest=function(b){b?this.enable(a.STENCIL_TEST):this.disable(a.STENCIL_TEST)},this.setStencilWrite=function(b){w!==b&&(a.stencilMask(b),w=b)},this.setFlipSided=function(b){D!==b&&(b?a.frontFace(a.CW):a.frontFace(a.CCW),D=b)},this.setLineWidth=function(b){b!==E&&(a.lineWidth(b),E=b)},this.setPolygonOffset=function(b,c,d){b?this.enable(a.POLYGON_OFFSET_FILL):this.disable(a.POLYGON_OFFSET_FILL),!b||F===c&&G===d||(a.polygonOffset(c,d),F=c,G=d)},this.getScissorTest=function(){return H},this.setScissorTest=function(b){H=b,b?this.enable(a.SCISSOR_TEST):this.disable(a.SCISSOR_TEST)},this.activeTexture=function(b){void 0===b&&(b=a.TEXTURE0+I-1),J!==b&&(a.activeTexture(b),J=b)},this.bindTexture=function(b,c){void 0===J&&e.activeTexture();var d=K[J];void 0===d&&(d={type:void 0,texture:void 0},K[J]=d),d.type===b&&d.texture===c||(a.bindTexture(b,c||Q),d.type=b,d.texture=c)},this.compressedTexImage2D=function(){try{a.compressedTexImage2D.apply(a,arguments)}catch(a){console.error(a)}},this.texImage2D=function(){try{a.texImage2D.apply(a,arguments)}catch(a){console.error(a)}},this.clearColor=function(b,c,d,e){f.set(b,c,d,e),!1===L.equals(f)&&(a.clearColor(b,c,d,e),L.copy(f))},this.clearDepth=function(b){M!==b&&(a.clearDepth(b),M=b)},this.clearStencil=function(b){N!==b&&(a.clearStencil(b),N=b)},this.scissor=function(b){!1===O.equals(b)&&(a.scissor(b.x,b.y,b.z,b.w),O.copy(b))},this.viewport=function(b){!1===P.equals(b)&&(a.viewport(b.x,b.y,b.z,b.w),P.copy(b))},this.reset=function(){for(var b=0;b<h.length;b++)1===h[b]&&(a.disableVertexAttribArray(b),h[b]=0);j={},k=null,J=void 0,K={},l=null,v=null,u=null,w=null,D=null}},d.LensFlarePlugin=function(a,b){function c(){var a=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),b=new Uint16Array([0,1,2,0,2,3]);f=n.createBuffer(),g=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,f),n.bufferData(n.ARRAY_BUFFER,a,n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,g),n.bufferData(n.ELEMENT_ARRAY_BUFFER,b,n.STATIC_DRAW),l=n.createTexture(),m=n.createTexture(),o.bindTexture(n.TEXTURE_2D,l),n.texImage2D(n.TEXTURE_2D,0,n.RGB,16,16,0,n.RGB,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),o.bindTexture(n.TEXTURE_2D,m),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,16,16,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),k=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var c;c=k?{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},h=e(c),i={vertex:n.getAttribLocation(h,"position"),uv:n.getAttribLocation(h,"uv")},j={renderType:n.getUniformLocation(h,"renderType"),map:n.getUniformLocation(h,"map"),occlusionMap:n.getUniformLocation(h,"occlusionMap"),opacity:n.getUniformLocation(h,"opacity"),color:n.getUniformLocation(h,"color"),scale:n.getUniformLocation(h,"scale"),rotation:n.getUniformLocation(h,"rotation"),screenPosition:n.getUniformLocation(h,"screenPosition")}}function e(b){var c=n.createProgram(),d=n.createShader(n.FRAGMENT_SHADER),e=n.createShader(n.VERTEX_SHADER),f="precision "+a.getPrecision()+" float;\n";return n.shaderSource(d,f+b.fragmentShader),n.shaderSource(e,f+b.vertexShader),n.compileShader(d),n.compileShader(e),n.attachShader(c,d),n.attachShader(c,e),n.linkProgram(c),c}var f,g,h,i,j,k,l,m,n=a.context,o=a.state;this.render=function(e,p,q){if(0!==b.length){var r=new d.Vector3,s=q.w/q.z,t=.5*q.z,u=.5*q.w,v=16/q.w,w=new d.Vector2(v*s,v),x=new d.Vector3(1,1,0),y=new d.Vector2(1,1);void 0===h&&c(),n.useProgram(h),o.initAttributes(),o.enableAttribute(i.vertex),o.enableAttribute(i.uv),o.disableUnusedAttributes(),n.uniform1i(j.occlusionMap,0),n.uniform1i(j.map,1),n.bindBuffer(n.ARRAY_BUFFER,f),n.vertexAttribPointer(i.vertex,2,n.FLOAT,!1,16,0),n.vertexAttribPointer(i.uv,2,n.FLOAT,!1,16,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,g),o.disable(n.CULL_FACE),o.setDepthWrite(!1);for(var z=0,A=b.length;z<A;z++){v=16/q.w,w.set(v*s,v);var B=b[z];if(r.set(B.matrixWorld.elements[12],B.matrixWorld.elements[13],B.matrixWorld.elements[14]),r.applyMatrix4(p.matrixWorldInverse),r.applyProjection(p.projectionMatrix),x.copy(r),y.x=x.x*t+t,y.y=x.y*u+u,k||y.x>0&&y.x<q.z&&y.y>0&&y.y<q.w){o.activeTexture(n.TEXTURE0),o.bindTexture(n.TEXTURE_2D,null),o.activeTexture(n.TEXTURE1),o.bindTexture(n.TEXTURE_2D,l),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGB,q.x+y.x-8,q.y+y.y-8,16,16,0),n.uniform1i(j.renderType,0),n.uniform2f(j.scale,w.x,w.y),n.uniform3f(j.screenPosition,x.x,x.y,x.z),o.disable(n.BLEND),o.enable(n.DEPTH_TEST),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0),o.activeTexture(n.TEXTURE0),o.bindTexture(n.TEXTURE_2D,m),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,q.x+y.x-8,q.y+y.y-8,16,16,0),n.uniform1i(j.renderType,1),o.disable(n.DEPTH_TEST),o.activeTexture(n.TEXTURE1),o.bindTexture(n.TEXTURE_2D,l),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0),B.positionScreen.copy(x),B.customUpdateCallback?B.customUpdateCallback(B):B.updateLensFlares(),n.uniform1i(j.renderType,2),o.enable(n.BLEND);for(var C=0,D=B.lensFlares.length;C<D;C++){var E=B.lensFlares[C];E.opacity>.001&&E.scale>.001&&(x.x=E.x,x.y=E.y,x.z=E.z,v=E.size*E.scale/q.w,w.x=v*s,w.y=v,n.uniform3f(j.screenPosition,x.x,x.y,x.z),n.uniform2f(j.scale,w.x,w.y),n.uniform1f(j.rotation,E.rotation),n.uniform1f(j.opacity,E.opacity),n.uniform3f(j.color,E.color.r,E.color.g,E.color.b),o.setBlending(E.blending,E.blendEquation,E.blendSrc,E.blendDst),a.setTexture(E.texture,1),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0))}}}o.enable(n.CULL_FACE),o.enable(n.DEPTH_TEST),o.setDepthWrite(!0),a.resetGLState()}}},d.SpritePlugin=function(a,b){function c(){var a=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),b=new Uint16Array([0,1,2,0,2,3]);g=m.createBuffer(),h=m.createBuffer(),m.bindBuffer(m.ARRAY_BUFFER,g),m.bufferData(m.ARRAY_BUFFER,a,m.STATIC_DRAW),m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,h),m.bufferData(m.ELEMENT_ARRAY_BUFFER,b,m.STATIC_DRAW),i=e(),j={position:m.getAttribLocation(i,"position"),uv:m.getAttribLocation(i,"uv")},k={uvOffset:m.getUniformLocation(i,"uvOffset"),uvScale:m.getUniformLocation(i,"uvScale"),rotation:m.getUniformLocation(i,"rotation"),scale:m.getUniformLocation(i,"scale"),color:m.getUniformLocation(i,"color"),map:m.getUniformLocation(i,"map"),opacity:m.getUniformLocation(i,"opacity"),modelViewMatrix:m.getUniformLocation(i,"modelViewMatrix"),projectionMatrix:m.getUniformLocation(i,"projectionMatrix"),fogType:m.getUniformLocation(i,"fogType"),fogDensity:m.getUniformLocation(i,"fogDensity"),fogNear:m.getUniformLocation(i,"fogNear"),fogFar:m.getUniformLocation(i,"fogFar"),fogColor:m.getUniformLocation(i,"fogColor"),alphaTest:m.getUniformLocation(i,"alphaTest")};var c=document.createElement("canvas");c.width=8,c.height=8;var f=c.getContext("2d");f.fillStyle="white",f.fillRect(0,0,8,8),l=new d.Texture(c),l.needsUpdate=!0}function e(){var b=m.createProgram(),c=m.createShader(m.VERTEX_SHADER),d=m.createShader(m.FRAGMENT_SHADER);return m.shaderSource(c,["precision "+a.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),m.shaderSource(d,["precision "+a.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),m.compileShader(c),m.compileShader(d),m.attachShader(b,c),m.attachShader(b,d),m.linkProgram(b),b}function f(a,b){return a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:b.id-a.id}var g,h,i,j,k,l,m=a.context,n=a.state,o=new d.Vector3,p=new d.Quaternion,q=new d.Vector3;this.render=function(e,r){if(0!==b.length){void 0===i&&c(),m.useProgram(i),n.initAttributes(),n.enableAttribute(j.position),n.enableAttribute(j.uv),n.disableUnusedAttributes(),n.disable(m.CULL_FACE),n.enable(m.BLEND),m.bindBuffer(m.ARRAY_BUFFER,g),m.vertexAttribPointer(j.position,2,m.FLOAT,!1,16,0),m.vertexAttribPointer(j.uv,2,m.FLOAT,!1,16,8),m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,h),m.uniformMatrix4fv(k.projectionMatrix,!1,r.projectionMatrix.elements),n.activeTexture(m.TEXTURE0),m.uniform1i(k.map,0);var s=0,t=0,u=e.fog;u?(m.uniform3f(k.fogColor,u.color.r,u.color.g,u.color.b),u instanceof d.Fog?(m.uniform1f(k.fogNear,u.near),m.uniform1f(k.fogFar,u.far),m.uniform1i(k.fogType,1),s=1,t=1):u instanceof d.FogExp2&&(m.uniform1f(k.fogDensity,u.density),m.uniform1i(k.fogType,2),s=2,t=2)):(m.uniform1i(k.fogType,0),s=0,t=0);for(var v=0,w=b.length;v<w;v++){var x=b[v];x.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,x.matrixWorld),x.z=-x.modelViewMatrix.elements[14]}b.sort(f);for(var y=[],v=0,w=b.length;v<w;v++){var x=b[v],z=x.material;m.uniform1f(k.alphaTest,z.alphaTest),m.uniformMatrix4fv(k.modelViewMatrix,!1,x.modelViewMatrix.elements),x.matrixWorld.decompose(o,p,q),y[0]=q.x,y[1]=q.y;var A=0;e.fog&&z.fog&&(A=t),s!==A&&(m.uniform1i(k.fogType,A),s=A),null!==z.map?(m.uniform2f(k.uvOffset,z.map.offset.x,z.map.offset.y),m.uniform2f(k.uvScale,z.map.repeat.x,z.map.repeat.y)):(m.uniform2f(k.uvOffset,0,0),m.uniform2f(k.uvScale,1,1)),m.uniform1f(k.opacity,z.opacity),m.uniform3f(k.color,z.color.r,z.color.g,z.color.b),m.uniform1f(k.rotation,z.rotation),m.uniform2fv(k.scale,y),n.setBlending(z.blending,z.blendEquation,z.blendSrc,z.blendDst),n.setDepthTest(z.depthTest),n.setDepthWrite(z.depthWrite),z.map&&z.map.image&&z.map.image.width?a.setTexture(z.map,0):a.setTexture(l,0),m.drawElements(m.TRIANGLES,6,m.UNSIGNED_SHORT,0)}n.enable(m.CULL_FACE),a.resetGLState()}}},Object.defineProperties(d.Box2.prototype,{empty:{value:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()}},isIntersectionBox:{value:function(a){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(a)}}}),Object.defineProperties(d.Box3.prototype,{empty:{value:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()}},isIntersectionBox:{value:function(a){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(a)}},isIntersectionSphere:{value:function(a){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(a)}}}),Object.defineProperties(d.Matrix3.prototype,{multiplyVector3:{value:function(a){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),a.applyMatrix3(this)}},multiplyVector3Array:{value:function(a){return console.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(a)}}}),Object.defineProperties(d.Matrix4.prototype,{extractPosition:{value:function(a){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(a)}},setRotationFromQuaternion:{value:function(a){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(a)}},multiplyVector3:{value:function(a){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),a.applyProjection(this)}},multiplyVector4:{value:function(a){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)}},multiplyVector3Array:{value:function(a){return console.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(a)}},rotateAxis:{value:function(a){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),a.transformDirection(this)}},crossVector:{value:function(a){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),a.applyMatrix4(this)}},translate:{value:function(a){console.error("THREE.Matrix4: .translate() has been removed.")}},rotateX:{value:function(a){console.error("THREE.Matrix4: .rotateX() has been removed.")}},rotateY:{value:function(a){console.error("THREE.Matrix4: .rotateY() has been removed.")}},rotateZ:{value:function(a){console.error("THREE.Matrix4: .rotateZ() has been removed.")}},rotateByAxis:{value:function(a,b){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")}}}),Object.defineProperties(d.Plane.prototype,{isIntersectionLine:{value:function(a){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(a)}}}),Object.defineProperties(d.Quaternion.prototype,{multiplyVector3:{value:function(a){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),a.applyQuaternion(this)}}}),Object.defineProperties(d.Ray.prototype,{isIntersectionBox:{value:function(a){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(a)}},isIntersectionPlane:{value:function(a){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(a)}},isIntersectionSphere:{value:function(a){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(a)}}}),Object.defineProperties(d.Vector3.prototype,{setEulerFromRotationMatrix:{value:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")}},setEulerFromQuaternion:{value:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")}},getPositionFromMatrix:{value:function(a){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(a)}},getScaleFromMatrix:{value:function(a){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(a)}},getColumnFromMatrix:{value:function(a,b){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(a,b)}}}),d.Face4=function(a,b,c,e,f,g,h){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new d.Face3(a,b,c,f,g,h)},d.Vertex=function(a,b,c){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new d.Vector3(a,b,c)},Object.defineProperties(d.Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(a){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=a}},getChildByName:{value:function(a){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(a)}},renderDepth:{set:function(a){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")}},translate:{value:function(a,b){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(b,a)}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(a){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(d,{PointCloud:{value:function(a,b){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new d.Points(a,b)}},ParticleSystem:{value:function(a,b){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new d.Points(a,b)}}}),Object.defineProperties(d.Light.prototype,{onlyShadow:{set:function(a){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(a){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=a}},shadowCameraLeft:{set:function(a){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=a}},shadowCameraRight:{set:function(a){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=a}},shadowCameraTop:{set:function(a){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=a}},shadowCameraBottom:{set:function(a){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=a}},shadowCameraNear:{set:function(a){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=a}},shadowCameraFar:{set:function(a){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=a}},shadowCameraVisible:{set:function(a){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(a){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=a}},shadowDarkness:{set:function(a){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(a){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=a}},shadowMapHeight:{set:function(a){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=a}}}),Object.defineProperties(d.BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Please use .count."),this.array.length}}}),Object.defineProperties(d.BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}},addIndex:{value:function(a){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(a)}},addDrawCall:{value:function(a,b,c){void 0!==c&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(a,b)}},clearDrawCalls:{value:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()}},computeTangents:{value:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")}},computeOffsets:{value:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}}),Object.defineProperties(d.Material.prototype,{wrapAround:{get:function(){console.warn("THREE."+this.type+": .wrapAround has been removed.")},set:function(a){console.warn("THREE."+this.type+": .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE."+this.type+": .wrapRGB has been removed."),new d.Color}}}),Object.defineProperties(d,{PointCloudMaterial:{value:function(a){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new d.PointsMaterial(a)}},ParticleBasicMaterial:{value:function(a){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new d.PointsMaterial(a)}},ParticleSystemMaterial:{value:function(a){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new d.PointsMaterial(a)}}}),Object.defineProperties(d.MeshPhongMaterial.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(a){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(d.ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(a){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=a}}}),Object.defineProperties(d.WebGLRenderer.prototype,{supportsFloatTextures:{value:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")}},supportsHalfFloatTextures:{value:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")}},supportsStandardDerivatives:{value:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")}},supportsCompressedTextureS3TC:{value:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")}},supportsCompressedTexturePVRTC:{value:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")}},supportsBlendMinMax:{value:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")}},supportsVertexTextures:{value:function(){return this.capabilities.vertexTextures}},supportsInstancedArrays:{value:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")}},enableScissorTest:{value:function(a){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(a)}},initMaterial:{value:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")}},addPrePlugin:{value:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")}},addPostPlugin:{value:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")}},updateShadowMap:{value:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}},shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=a}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=a}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(a){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),this.shadowMap.cullFace=a}}}),Object.defineProperties(d.WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=a}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(a){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=a}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(a){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=a}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(a){
console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=a}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(a){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=a}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(a){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=a}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(a){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=a}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(a){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=a}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(a){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=a}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(a){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=a}}}),d.GeometryUtils={merge:function(a,b,c){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var e;b instanceof d.Mesh&&(b.matrixAutoUpdate&&b.updateMatrix(),e=b.matrix,b=b.geometry),a.merge(b,e,c)},center:function(a){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),a.center()}},d.ImageUtils={crossOrigin:void 0,loadTexture:function(a,b,c,e){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var f=new d.TextureLoader;f.setCrossOrigin(this.crossOrigin);var g=f.load(a,c,void 0,e);return b&&(g.mapping=b),g},loadTextureCube:function(a,b,c,e){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var f=new d.CubeTextureLoader;f.setCrossOrigin(this.crossOrigin);var g=f.load(a,c,void 0,e);return b&&(g.mapping=b),g},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}},d.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project()."),a.project(b)},this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),a.unproject(b)},this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},d.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElement("canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}},d.MeshFaceMaterial=d.MultiMaterial,d.CurveUtils={tangentQuadraticBezier:function(a,b,c,d){return 2*(1-a)*(c-b)+2*a*(d-c)},tangentCubicBezier:function(a,b,c,d,e){return-3*b*(1-a)*(1-a)+3*c*(1-a)*(1-a)-6*a*c*(1-a)+6*a*d*(1-a)-3*a*a*d+3*a*a*e},tangentSpline:function(a,b,c,d,e){return 6*a*a-6*a+(3*a*a-4*a+1)+(-6*a*a+6*a)+(3*a*a-2*a)},interpolate:function(a,b,c,d,e){var f=.5*(c-a),g=.5*(d-b),h=e*e;return(2*b-2*c+f+g)*(e*h)+(-3*b+3*c-2*f-g)*h+f*e+b}},d.SceneUtils={createMultiMaterialObject:function(a,b){for(var c=new d.Group,e=0,f=b.length;e<f;e++)c.add(new d.Mesh(a,b[e]));return c},detach:function(a,b,c){a.applyMatrix(b.matrixWorld),b.remove(a),c.add(a)},attach:function(a,b,c){var e=new d.Matrix4;e.getInverse(c.matrixWorld),a.applyMatrix(e),b.remove(a),c.add(a)}},d.ShapeUtils={area:function(a){for(var b=a.length,c=0,d=b-1,e=0;e<b;d=e++)c+=a[d].x*a[e].y-a[e].x*a[d].y;return.5*c},triangulate:function(){function a(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o;if(h=a[f[b]].x,i=a[f[b]].y,j=a[f[c]].x,k=a[f[c]].y,l=a[f[d]].x,m=a[f[d]].y,Number.EPSILON>(j-h)*(m-i)-(k-i)*(l-h))return!1;var p,q,r,s,t,u,v,w,x,y,z,A,B,C,D;for(p=l-j,q=m-k,r=h-l,s=i-m,t=j-h,u=k-i,g=0;g<e;g++)if(n=a[f[g]].x,o=a[f[g]].y,!(n===h&&o===i||n===j&&o===k||n===l&&o===m)&&(v=n-h,w=o-i,x=n-j,y=o-k,z=n-l,A=o-m,D=p*y-q*x,B=t*w-u*v,C=r*A-s*z,D>=-Number.EPSILON&&C>=-Number.EPSILON&&B>=-Number.EPSILON))return!1;return!0}return function(b,c){var e=b.length;if(e<3)return null;var f,g,h,i=[],j=[],k=[];if(d.ShapeUtils.area(b)>0)for(g=0;g<e;g++)j[g]=g;else for(g=0;g<e;g++)j[g]=e-1-g;var l=e,m=2*l;for(g=l-1;l>2;){if(m--<=0)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),c?k:i;if(f=g,l<=f&&(f=0),g=f+1,l<=g&&(g=0),h=g+1,l<=h&&(h=0),a(b,f,g,h,l,j)){var n,o,p,q,r;for(n=j[f],o=j[g],p=j[h],i.push([b[n],b[o],b[p]]),k.push([j[f],j[g],j[h]]),q=g,r=g+1;r<l;q++,r++)j[q]=j[r];l--,m=2*l}}return c?k:i}}(),triangulateShape:function(a,b){function c(a,b,c){return a.x!==b.x?a.x<b.x?a.x<=c.x&&c.x<=b.x:b.x<=c.x&&c.x<=a.x:a.y<b.y?a.y<=c.y&&c.y<=b.y:b.y<=c.y&&c.y<=a.y}function e(a,b,d,e,f){var g=b.x-a.x,h=b.y-a.y,i=e.x-d.x,j=e.y-d.y,k=a.x-d.x,l=a.y-d.y,m=h*i-g*j,n=h*k-g*l;if(Math.abs(m)>Number.EPSILON){var o;if(m>0){if(n<0||n>m)return[];if((o=j*k-i*l)<0||o>m)return[]}else{if(n>0||n<m)return[];if((o=j*k-i*l)>0||o<m)return[]}if(0===o)return!f||0!==n&&n!==m?[a]:[];if(o===m)return!f||0!==n&&n!==m?[b]:[];if(0===n)return[d];if(n===m)return[e];var p=o/m;return[{x:a.x+p*g,y:a.y+p*h}]}if(0!==n||j*k!=i*l)return[];var q=0===g&&0===h,r=0===i&&0===j;if(q&&r)return a.x!==d.x||a.y!==d.y?[]:[a];if(q)return c(d,e,a)?[a]:[];if(r)return c(a,b,d)?[d]:[];var s,t,u,v,w,x,y,z;return 0!==g?(a.x<b.x?(s=a,u=a.x,t=b,v=b.x):(s=b,u=b.x,t=a,v=a.x),d.x<e.x?(w=d,y=d.x,x=e,z=e.x):(w=e,y=e.x,x=d,z=d.x)):(a.y<b.y?(s=a,u=a.y,t=b,v=b.y):(s=b,u=b.y,t=a,v=a.y),d.y<e.y?(w=d,y=d.y,x=e,z=e.y):(w=e,y=e.y,x=d,z=d.y)),u<=y?v<y?[]:v===y?f?[]:[w]:v<=z?[w,t]:[w,x]:u>z?[]:u===z?f?[]:[s]:v<=z?[s,t]:[s,x]}function f(a,b,c,d){var e=b.x-a.x,f=b.y-a.y,g=c.x-a.x,h=c.y-a.y,i=d.x-a.x,j=d.y-a.y,k=e*h-f*g,l=e*j-f*i;if(Math.abs(k)>Number.EPSILON){var m=i*h-j*g;return k>0?l>=0&&m>=0:l>=0||m>=0}return l>0}for(var g,h,i,j,k,l,m={},n=a.concat(),o=0,p=b.length;o<p;o++)Array.prototype.push.apply(n,b[o]);for(g=0,h=n.length;g<h;g++)k=n[g].x+":"+n[g].y,void 0!==m[k]&&console.warn("THREE.Shape: Duplicate point",k),m[k]=g;var q=function(a,b){for(var c,d,g,h,i,j,k,l,m,n,o,p=a.concat(),q=[],r=[],s=0,t=b.length;s<t;s++)q.push(s);for(var u=0,v=2*q.length;q.length>0;){if(--v<0){console.log("Infinite Loop! Holes left:"+q.length+", Probably Hole outside Shape!");break}for(g=u;g<p.length;g++){h=p[g],d=-1;for(var s=0;s<q.length;s++)if(j=q[s],k=h.x+":"+h.y+":"+j,void 0===r[k]){c=b[j];for(var w=0;w<c.length;w++)if(i=c[w],function(a,b){var d=p.length-1,e=a-1;e<0&&(e=d);var g=a+1;g>d&&(g=0);var h=f(p[a],p[e],p[g],c[b]);if(!h)return!1;var i=c.length-1,j=b-1;j<0&&(j=i);var k=b+1;return k>i&&(k=0),!!(h=f(c[b],c[j],c[k],p[a]))}(g,w)&&!function(a,b){var c,d,f;for(c=0;c<p.length;c++)if(d=c+1,d%=p.length,f=e(a,b,p[c],p[d],!0),f.length>0)return!0;return!1}(h,i)&&!function(a,c){var d,f,g,h,i;for(d=0;d<q.length;d++)for(f=b[q[d]],g=0;g<f.length;g++)if(h=g+1,h%=f.length,i=e(a,c,f[g],f[h],!0),i.length>0)return!0;return!1}(h,i)){d=w,q.splice(s,1),l=p.slice(0,g+1),m=p.slice(g),n=c.slice(d),o=c.slice(0,d+1),p=l.concat(n).concat(o).concat(m),u=g;break}if(d>=0)break;r[k]=!0}if(d>=0)break}}return p}(a,b),r=d.ShapeUtils.triangulate(q,!1);for(g=0,h=r.length;g<h;g++)for(j=r[g],i=0;i<3;i++)k=j[i].x+":"+j[i].y,void 0!==(l=m[k])&&(j[i]=l);return r.concat()},isClockWise:function(a){return d.ShapeUtils.area(a)<0},b2:function(){function a(a,b){var c=1-a;return c*c*b}function b(a,b){return 2*(1-a)*a*b}function c(a,b){return a*a*b}return function(d,e,f,g){return a(d,e)+b(d,f)+c(d,g)}}(),b3:function(){function a(a,b){var c=1-a;return c*c*c*b}function b(a,b){var c=1-a;return 3*c*c*a*b}function c(a,b){return 3*(1-a)*a*a*b}function d(a,b){return a*a*a*b}return function(e,f,g,h,i){return a(e,f)+b(e,g)+c(e,h)+d(e,i)}}()},d.Curve=function(){},d.Curve.prototype={constructor:d.Curve,getPoint:function(a){return console.warn("THREE.Curve: Warning, getPoint() not implemented!"),null},getPointAt:function(a){var b=this.getUtoTmapping(a);return this.getPoint(b)},getPoints:function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPoint(b/a));return c},getSpacedPoints:function(a){a||(a=5);var b,c=[];for(b=0;b<=a;b++)c.push(this.getPointAt(b/a));return c},getLength:function(){var a=this.getLengths();return a[a.length-1]},getLengths:function(a){if(a||(a=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===a+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var b,c,d=[],e=this.getPoint(0),f=0;for(d.push(0),c=1;c<=a;c++)b=this.getPoint(c/a),f+=b.distanceTo(e),d.push(f),e=b;return this.cacheArcLengths=d,d},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(a,b){var c,d=this.getLengths(),e=0,f=d.length;c=b||a*d[f-1];for(var g,h=0,i=f-1;h<=i;)if(e=Math.floor(h+(i-h)/2),(g=d[e]-c)<0)h=e+1;else{if(!(g>0)){i=e;break}i=e-1}if(e=i,d[e]===c){var j=e/(f-1);return j}var k=d[e],l=d[e+1],m=l-k,n=(c-k)/m,j=(e+n)/(f-1);return j},getTangent:function(a){var b=a-1e-4,c=a+1e-4;b<0&&(b=0),c>1&&(c=1);var d=this.getPoint(b);return this.getPoint(c).clone().sub(d).normalize()},getTangentAt:function(a){var b=this.getUtoTmapping(a);return this.getTangent(b)}},d.Curve.create=function(a,b){return a.prototype=Object.create(d.Curve.prototype),a.prototype.constructor=a,a.prototype.getPoint=b,a},d.CurvePath=function(){this.curves=[],this.autoClose=!1},d.CurvePath.prototype=Object.create(d.Curve.prototype),d.CurvePath.prototype.constructor=d.CurvePath,d.CurvePath.prototype.add=function(a){this.curves.push(a)},d.CurvePath.prototype.closePath=function(){var a=this.curves[0].getPoint(0),b=this.curves[this.curves.length-1].getPoint(1);a.equals(b)||this.curves.push(new d.LineCurve(b,a))},d.CurvePath.prototype.getPoint=function(a){for(var b=a*this.getLength(),c=this.getCurveLengths(),d=0;d<c.length;){if(c[d]>=b){var e=c[d]-b,f=this.curves[d],g=1-e/f.getLength();return f.getPointAt(g)}d++}return null},d.CurvePath.prototype.getLength=function(){var a=this.getCurveLengths();return a[a.length-1]},d.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var a=[],b=0,c=0,d=this.curves.length;c<d;c++)b+=this.curves[c].getLength(),a.push(b);return this.cacheLengths=a,a},d.CurvePath.prototype.createPointsGeometry=function(a){var b=this.getPoints(a);return this.createGeometry(b)},d.CurvePath.prototype.createSpacedPointsGeometry=function(a){var b=this.getSpacedPoints(a);return this.createGeometry(b)},d.CurvePath.prototype.createGeometry=function(a){for(var b=new d.Geometry,c=0,e=a.length;c<e;c++){var f=a[c];b.vertices.push(new d.Vector3(f.x,f.y,f.z||0))}return b},d.Font=function(a){this.data=a},d.Font.prototype={constructor:d.Font,generateShapes:function(a,b,c){function e(a,b,e){var g=f.glyphs[a]||f.glyphs["?"];if(g){var h,i,j,k,l,m,n,o,p,q,r,s=new d.Path,t=[],u=d.ShapeUtils.b2,v=d.ShapeUtils.b3;if(g.o)for(var w=g._cachedOutline||(g._cachedOutline=g.o.split(" ")),x=0,y=w.length;x<y;){var z=w[x++];switch(z){case"m":h=w[x++]*b+e,i=w[x++]*b,s.moveTo(h,i);break;case"l":h=w[x++]*b+e,i=w[x++]*b,s.lineTo(h,i);break;case"q":if(j=w[x++]*b+e,k=w[x++]*b,n=w[x++]*b+e,o=w[x++]*b,s.quadraticCurveTo(n,o,j,k),r=t[t.length-1]){l=r.x,m=r.y;for(var A=1;A<=c;A++){var B=A/c;u(B,l,n,j),u(B,m,o,k)}}break;case"b":if(j=w[x++]*b+e,k=w[x++]*b,n=w[x++]*b+e,o=w[x++]*b,p=w[x++]*b+e,q=w[x++]*b,s.bezierCurveTo(n,o,p,q,j,k),r=t[t.length-1]){l=r.x,m=r.y;for(var A=1;A<=c;A++){var B=A/c;v(B,l,n,p,j),v(B,m,o,q,k)}}}}return{offset:g.ha*b,path:s}}}void 0===b&&(b=100),void 0===c&&(c=4);for(var f=this.data,g=function(a){for(var c=String(a).split(""),d=b/f.resolution,g=0,h=[],i=0;i<c.length;i++){var j=e(c[i],d,g);g+=j.offset,h.push(j.path)}return h}(a),h=[],i=0,j=g.length;i<j;i++)Array.prototype.push.apply(h,g[i].toShapes());return h}},d.Path=function(a){d.CurvePath.call(this),this.actions=[],a&&this.fromPoints(a)},d.Path.prototype=Object.create(d.CurvePath.prototype),d.Path.prototype.constructor=d.Path,d.Path.prototype.fromPoints=function(a){this.moveTo(a[0].x,a[0].y);for(var b=1,c=a.length;b<c;b++)this.lineTo(a[b].x,a[b].y)},d.Path.prototype.moveTo=function(a,b){this.actions.push({action:"moveTo",args:[a,b]})},d.Path.prototype.lineTo=function(a,b){var c=this.actions[this.actions.length-1].args,e=c[c.length-2],f=c[c.length-1],g=new d.LineCurve(new d.Vector2(e,f),new d.Vector2(a,b));this.curves.push(g),this.actions.push({action:"lineTo",args:[a,b]})},d.Path.prototype.quadraticCurveTo=function(a,b,c,e){var f=this.actions[this.actions.length-1].args,g=f[f.length-2],h=f[f.length-1],i=new d.QuadraticBezierCurve(new d.Vector2(g,h),new d.Vector2(a,b),new d.Vector2(c,e));this.curves.push(i),this.actions.push({action:"quadraticCurveTo",args:[a,b,c,e]})},d.Path.prototype.bezierCurveTo=function(a,b,c,e,f,g){var h=this.actions[this.actions.length-1].args,i=h[h.length-2],j=h[h.length-1],k=new d.CubicBezierCurve(new d.Vector2(i,j),new d.Vector2(a,b),new d.Vector2(c,e),new d.Vector2(f,g));this.curves.push(k),this.actions.push({action:"bezierCurveTo",args:[a,b,c,e,f,g]})},d.Path.prototype.splineThru=function(a){var b=Array.prototype.slice.call(arguments),c=this.actions[this.actions.length-1].args,e=c[c.length-2],f=c[c.length-1],g=[new d.Vector2(e,f)];Array.prototype.push.apply(g,a);var h=new d.SplineCurve(g);this.curves.push(h),this.actions.push({action:"splineThru",args:b})},d.Path.prototype.arc=function(a,b,c,d,e,f){var g=this.actions[this.actions.length-1].args,h=g[g.length-2],i=g[g.length-1];this.absarc(a+h,b+i,c,d,e,f)},d.Path.prototype.absarc=function(a,b,c,d,e,f){this.absellipse(a,b,c,c,d,e,f)},d.Path.prototype.ellipse=function(a,b,c,d,e,f,g,h){var i=this.actions[this.actions.length-1].args,j=i[i.length-2],k=i[i.length-1];this.absellipse(a+j,b+k,c,d,e,f,g,h)},d.Path.prototype.absellipse=function(a,b,c,e,f,g,h,i){var j=[a,b,c,e,f,g,h,i||0],k=new d.EllipseCurve(a,b,c,e,f,g,h,i);this.curves.push(k);var l=k.getPoint(1);j.push(l.x),j.push(l.y),this.actions.push({action:"ellipse",args:j})},d.Path.prototype.getSpacedPoints=function(a){a||(a=40);for(var b=[],c=0;c<a;c++)b.push(this.getPoint(c/a));return this.autoClose&&b.push(b[0]),b},d.Path.prototype.getPoints=function(a){a=a||12;for(var b,c,e,f,g,h,i,j,k,l,m,n=d.ShapeUtils.b2,o=d.ShapeUtils.b3,p=[],q=0,r=this.actions.length;q<r;q++){var s=this.actions[q],t=s.action,u=s.args;switch(t){case"moveTo":case"lineTo":p.push(new d.Vector2(u[0],u[1]));break;case"quadraticCurveTo":b=u[2],c=u[3],g=u[0],h=u[1],p.length>0?(k=p[p.length-1],i=k.x,j=k.y):(k=this.actions[q-1].args,i=k[k.length-2],j=k[k.length-1]);for(var v=1;v<=a;v++){var w=v/a;l=n(w,i,g,b),m=n(w,j,h,c),p.push(new d.Vector2(l,m))}break;case"bezierCurveTo":b=u[4],c=u[5],g=u[0],h=u[1],e=u[2],f=u[3],p.length>0?(k=p[p.length-1],i=k.x,j=k.y):(k=this.actions[q-1].args,i=k[k.length-2],j=k[k.length-1]);for(var v=1;v<=a;v++){var w=v/a;l=o(w,i,g,e,b),m=o(w,j,h,f,c),p.push(new d.Vector2(l,m))}break;case"splineThru":k=this.actions[q-1].args;var x=new d.Vector2(k[k.length-2],k[k.length-1]),y=[x],z=a*u[0].length;y=y.concat(u[0]);for(var A=new d.SplineCurve(y),v=1;v<=z;v++)p.push(A.getPointAt(v/z));break;case"arc":for(var B,C=u[0],D=u[1],E=u[2],F=u[3],G=u[4],H=!!u[5],I=G-F,J=2*a,v=1;v<=J;v++){var w=v/J;H||(w=1-w),B=F+w*I,l=C+E*Math.cos(B),m=D+E*Math.sin(B),p.push(new d.Vector2(l,m))}break;case"ellipse":var B,K,L,C=u[0],D=u[1],M=u[2],N=u[3],F=u[4],G=u[5],H=!!u[6],O=u[7],I=G-F,J=2*a;0!==O&&(K=Math.cos(O),L=Math.sin(O));for(var v=1;v<=J;v++){var w=v/J;if(H||(w=1-w),B=F+w*I,l=C+M*Math.cos(B),m=D+N*Math.sin(B),0!==O){var P=l,Q=m;l=(P-C)*K-(Q-D)*L+C,m=(P-C)*L+(Q-D)*K+D}p.push(new d.Vector2(l,m))}}}var R=p[p.length-1];return Math.abs(R.x-p[0].x)<Number.EPSILON&&Math.abs(R.y-p[0].y)<Number.EPSILON&&p.splice(p.length-1,1),this.autoClose&&p.push(p[0]),p},d.Path.prototype.toShapes=function(a,b){function c(a){for(var b=[],c=0,e=a.length;c<e;c++){var f=a[c],g=new d.Shape;g.actions=f.actions,g.curves=f.curves,b.push(g)}return b}var e=d.ShapeUtils.isClockWise,f=function(a){for(var b=[],c=new d.Path,e=0,f=a.length;e<f;e++){var g=a[e],h=g.args,i=g.action;"moveTo"===i&&0!==c.actions.length&&(b.push(c),c=new d.Path),c[i].apply(c,h)}return 0!==c.actions.length&&b.push(c),b}(this.actions);if(0===f.length)return[];if(!0===b)return c(f);var g,h,i,j=[];if(1===f.length)return h=f[0],i=new d.Shape,i.actions=h.actions,i.curves=h.curves,j.push(i),j;var k=!e(f[0].getPoints());k=a?!k:k;var l,m=[],n=[],o=[],p=0;n[p]=void 0,o[p]=[];for(var q=0,r=f.length;q<r;q++)h=f[q],l=h.getPoints(),g=e(l),g=a?!g:g,g?(!k&&n[p]&&p++,n[p]={s:new d.Shape,p:l},n[p].s.actions=h.actions,n[p].s.curves=h.curves,k&&p++,o[p]=[]):o[p].push({h:h,p:l[0]});if(!n[0])return c(f);if(n.length>1){for(var s=!1,t=[],u=0,v=n.length;u<v;u++)m[u]=[];for(var u=0,v=n.length;u<v;u++)for(var w=o[u],x=0;x<w.length;x++){for(var y=w[x],z=!0,A=0;A<n.length;A++)(function(a,b){for(var c=b.length,d=!1,e=c-1,f=0;f<c;e=f++){var g=b[e],h=b[f],i=h.x-g.x,j=h.y-g.y;if(Math.abs(j)>Number.EPSILON){if(j<0&&(g=b[f],i=-i,h=b[e],j=-j),a.y<g.y||a.y>h.y)continue;if(a.y===g.y){if(a.x===g.x)return!0}else{var k=j*(a.x-g.x)-i*(a.y-g.y);if(0===k)return!0;if(k<0)continue;d=!d}}else{if(a.y!==g.y)continue;if(h.x<=a.x&&a.x<=g.x||g.x<=a.x&&a.x<=h.x)return!0}}return d})(y.p,n[A].p)&&(u!==A&&t.push({froms:u,tos:A,hole:x}),z?(z=!1,m[A].push(y)):s=!0);z&&m[u].push(y)}t.length>0&&(s||(o=m))}for(var B,q=0,C=n.length;q<C;q++){i=n[q].s,j.push(i),B=o[q];for(var D=0,E=B.length;D<E;D++)i.holes.push(B[D].h)}return j},d.Shape=function(){d.Path.apply(this,arguments),this.holes=[]},d.Shape.prototype=Object.create(d.Path.prototype),d.Shape.prototype.constructor=d.Shape,d.Shape.prototype.extrude=function(a){return new d.ExtrudeGeometry(this,a)},d.Shape.prototype.makeGeometry=function(a){return new d.ShapeGeometry(this,a)},d.Shape.prototype.getPointsHoles=function(a){for(var b=[],c=0,d=this.holes.length;c<d;c++)b[c]=this.holes[c].getPoints(a);return b},d.Shape.prototype.extractAllPoints=function(a){return{shape:this.getPoints(a),holes:this.getPointsHoles(a)}},d.Shape.prototype.extractPoints=function(a){return this.extractAllPoints(a)},d.LineCurve=function(a,b){this.v1=a,this.v2=b},d.LineCurve.prototype=Object.create(d.Curve.prototype),d.LineCurve.prototype.constructor=d.LineCurve,d.LineCurve.prototype.getPoint=function(a){var b=this.v2.clone().sub(this.v1);return b.multiplyScalar(a).add(this.v1),b},d.LineCurve.prototype.getPointAt=function(a){return this.getPoint(a)},d.LineCurve.prototype.getTangent=function(a){return this.v2.clone().sub(this.v1).normalize()},d.QuadraticBezierCurve=function(a,b,c){this.v0=a,this.v1=b,this.v2=c},d.QuadraticBezierCurve.prototype=Object.create(d.Curve.prototype),d.QuadraticBezierCurve.prototype.constructor=d.QuadraticBezierCurve,d.QuadraticBezierCurve.prototype.getPoint=function(a){var b=d.ShapeUtils.b2;return new d.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y))},d.QuadraticBezierCurve.prototype.getTangent=function(a){var b=d.CurveUtils.tangentQuadraticBezier;return new d.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y)).normalize()},d.CubicBezierCurve=function(a,b,c,d){this.v0=a,this.v1=b,this.v2=c,this.v3=d},d.CubicBezierCurve.prototype=Object.create(d.Curve.prototype),d.CubicBezierCurve.prototype.constructor=d.CubicBezierCurve,d.CubicBezierCurve.prototype.getPoint=function(a){var b=d.ShapeUtils.b3;return new d.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y))},d.CubicBezierCurve.prototype.getTangent=function(a){var b=d.CurveUtils.tangentCubicBezier;return new d.Vector2(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y)).normalize()},d.SplineCurve=function(a){this.points=void 0==a?[]:a},d.SplineCurve.prototype=Object.create(d.Curve.prototype),d.SplineCurve.prototype.constructor=d.SplineCurve,d.SplineCurve.prototype.getPoint=function(a){var b=this.points,c=(b.length-1)*a,e=Math.floor(c),f=c-e,g=b[0===e?e:e-1],h=b[e],i=b[e>b.length-2?b.length-1:e+1],j=b[e>b.length-3?b.length-1:e+2],k=d.CurveUtils.interpolate;return new d.Vector2(k(g.x,h.x,i.x,j.x,f),k(g.y,h.y,i.y,j.y,f))},d.EllipseCurve=function(a,b,c,d,e,f,g,h){this.aX=a,this.aY=b,this.xRadius=c,this.yRadius=d,this.aStartAngle=e,this.aEndAngle=f,this.aClockwise=g,this.aRotation=h||0},d.EllipseCurve.prototype=Object.create(d.Curve.prototype),d.EllipseCurve.prototype.constructor=d.EllipseCurve,d.EllipseCurve.prototype.getPoint=function(a){var b=this.aEndAngle-this.aStartAngle;b<0&&(b+=2*Math.PI),b>2*Math.PI&&(b-=2*Math.PI);var c;c=!0===this.aClockwise?this.aEndAngle+(1-a)*(2*Math.PI-b):this.aStartAngle+a*b;var e=this.aX+this.xRadius*Math.cos(c),f=this.aY+this.yRadius*Math.sin(c);if(0!==this.aRotation){var g=Math.cos(this.aRotation),h=Math.sin(this.aRotation),i=e,j=f;e=(i-this.aX)*g-(j-this.aY)*h+this.aX,f=(i-this.aX)*h+(j-this.aY)*g+this.aY}return new d.Vector2(e,f)},d.ArcCurve=function(a,b,c,e,f,g){d.EllipseCurve.call(this,a,b,c,c,e,f,g)},d.ArcCurve.prototype=Object.create(d.EllipseCurve.prototype),d.ArcCurve.prototype.constructor=d.ArcCurve,d.LineCurve3=d.Curve.create(function(a,b){this.v1=a,this.v2=b},function(a){var b=new d.Vector3;return b.subVectors(this.v2,this.v1),b.multiplyScalar(a),b.add(this.v1),b}),d.QuadraticBezierCurve3=d.Curve.create(function(a,b,c){this.v0=a,this.v1=b,this.v2=c},function(a){var b=d.ShapeUtils.b2;return new d.Vector3(b(a,this.v0.x,this.v1.x,this.v2.x),b(a,this.v0.y,this.v1.y,this.v2.y),b(a,this.v0.z,this.v1.z,this.v2.z))}),d.CubicBezierCurve3=d.Curve.create(function(a,b,c,d){this.v0=a,this.v1=b,this.v2=c,this.v3=d},function(a){var b=d.ShapeUtils.b3;return new d.Vector3(b(a,this.v0.x,this.v1.x,this.v2.x,this.v3.x),b(a,this.v0.y,this.v1.y,this.v2.y,this.v3.y),b(a,this.v0.z,this.v1.z,this.v2.z,this.v3.z))}),d.SplineCurve3=d.Curve.create(function(a){console.warn("THREE.SplineCurve3 will be deprecated. Please use THREE.CatmullRomCurve3"),this.points=void 0==a?[]:a},function(a){var b=this.points,c=(b.length-1)*a,e=Math.floor(c),f=c-e,g=b[0==e?e:e-1],h=b[e],i=b[e>b.length-2?b.length-1:e+1],j=b[e>b.length-3?b.length-1:e+2],k=d.CurveUtils.interpolate;return new d.Vector3(k(g.x,h.x,i.x,j.x,f),k(g.y,h.y,i.y,j.y,f),k(g.z,h.z,i.z,j.z,f))}),d.CatmullRomCurve3=function(){function a(){}var b=new d.Vector3,c=new a,e=new a,f=new a;return a.prototype.init=function(a,b,c,d){this.c0=a,this.c1=c,this.c2=-3*a+3*b-2*c-d,this.c3=2*a-2*b+c+d},a.prototype.initNonuniformCatmullRom=function(a,b,c,d,e,f,g){var h=(b-a)/e-(c-a)/(e+f)+(c-b)/f,i=(c-b)/f-(d-b)/(f+g)+(d-c)/g;h*=f,i*=f,this.init(b,c,h,i)},a.prototype.initCatmullRom=function(a,b,c,d,e){this.init(b,c,e*(c-a),e*(d-b))},a.prototype.calc=function(a){var b=a*a,c=b*a;return this.c0+this.c1*a+this.c2*b+this.c3*c},d.Curve.create(function(a){this.points=a||[],this.closed=!1},function(a){var g,h,i,j,k=this.points;j=k.length,j<2&&console.log("duh, you need at least 2 points"),g=(j-(this.closed?0:1))*a,h=Math.floor(g),i=g-h,this.closed?h+=h>0?0:(Math.floor(Math.abs(h)/k.length)+1)*k.length:0===i&&h===j-1&&(h=j-2,i=1);var l,m,n,o;if(this.closed||h>0?l=k[(h-1)%j]:(b.subVectors(k[0],k[1]).add(k[0]),l=b),m=k[h%j],n=k[(h+1)%j],this.closed||h+2<j?o=k[(h+2)%j]:(b.subVectors(k[j-1],k[j-2]).add(k[j-1]),o=b),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var p="chordal"===this.type?.5:.25,q=Math.pow(l.distanceToSquared(m),p),r=Math.pow(m.distanceToSquared(n),p),s=Math.pow(n.distanceToSquared(o),p);r<1e-4&&(r=1),q<1e-4&&(q=r),s<1e-4&&(s=r),c.initNonuniformCatmullRom(l.x,m.x,n.x,o.x,q,r,s),e.initNonuniformCatmullRom(l.y,m.y,n.y,o.y,q,r,s),f.initNonuniformCatmullRom(l.z,m.z,n.z,o.z,q,r,s)}else if("catmullrom"===this.type){var t=void 0!==this.tension?this.tension:.5;c.initCatmullRom(l.x,m.x,n.x,o.x,t),e.initCatmullRom(l.y,m.y,n.y,o.y,t),f.initCatmullRom(l.z,m.z,n.z,o.z,t)}return new d.Vector3(c.calc(i),e.calc(i),f.calc(i))})}(),d.ClosedSplineCurve3=function(a){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Please use THREE.CatmullRomCurve3."),d.CatmullRomCurve3.call(this,a),this.type="catmullrom",this.closed=!0},d.ClosedSplineCurve3.prototype=Object.create(d.CatmullRomCurve3.prototype),d.BoxGeometry=function(a,b,c,e,f,g){d.Geometry.call(this),this.type="BoxGeometry",this.parameters={width:a,height:b,depth:c,widthSegments:e,heightSegments:f,depthSegments:g},this.fromBufferGeometry(new d.BoxBufferGeometry(a,b,c,e,f,g)),this.mergeVertices()},d.BoxGeometry.prototype=Object.create(d.Geometry.prototype),d.BoxGeometry.prototype.constructor=d.BoxGeometry,d.CubeGeometry=d.BoxGeometry,d.BoxBufferGeometry=function(a,b,c,e,f,g){function h(a,b,c,e,f,g,h,j,k,u,v){for(var w=g/k,x=h/u,y=g/2,z=h/2,A=j/2,B=k+1,C=u+1,D=0,E=0,F=new d.Vector3,G=0;G<C;G++)for(var H=G*x-z,I=0;I<B;I++){var J=I*w-y;F[a]=J*e,F[b]=H*f,F[c]=A,m[p]=F.x,m[p+1]=F.y,m[p+2]=F.z,F[a]=0,F[b]=0,F[c]=j>0?1:-1,n[p]=F.x,n[p+1]=F.y,n[p+2]=F.z,o[q]=I/k,o[q+1]=1-G/u,p+=3,q+=2,D+=1}for(G=0;G<u;G++)for(I=0;I<k;I++){var K=s+I+B*G,L=s+I+B*(G+1),M=s+(I+1)+B*(G+1),N=s+(I+1)+B*G;l[r]=K,l[r+1]=L,l[r+2]=N,l[r+3]=L,l[r+4]=M,l[r+5]=N,r+=6,E+=6}i.addGroup(t,E,v),t+=E,s+=D}d.BufferGeometry.call(this),this.type="BoxBufferGeometry",this.parameters={width:a,height:b,depth:c,widthSegments:e,heightSegments:f,depthSegments:g};var i=this;e=Math.floor(e)||1,f=Math.floor(f)||1,g=Math.floor(g)||1;var j=function(a,b,c){var d=0;return d+=a*b*2,d+=a*c*2,4*(d+=c*b*2)}(e,f,g),k=j/4*6,l=new(k>65535?Uint32Array:Uint16Array)(k),m=new Float32Array(3*j),n=new Float32Array(3*j),o=new Float32Array(2*j),p=0,q=0,r=0,s=0,t=0;h("z","y","x",-1,-1,c,b,a,g,f,0),h("z","y","x",1,-1,c,b,-a,g,f,1),h("x","z","y",1,1,a,c,b,e,g,2),h("x","z","y",1,-1,a,c,-b,e,g,3),h("x","y","z",1,-1,a,b,c,e,f,4),h("x","y","z",-1,-1,a,b,-c,e,f,5),this.setIndex(new d.BufferAttribute(l,1)),this.addAttribute("position",new d.BufferAttribute(m,3)),this.addAttribute("normal",new d.BufferAttribute(n,3)),this.addAttribute("uv",new d.BufferAttribute(o,2))},d.BoxBufferGeometry.prototype=Object.create(d.BufferGeometry.prototype),d.BoxBufferGeometry.prototype.constructor=d.BoxBufferGeometry,d.CircleGeometry=function(a,b,c,e){d.Geometry.call(this),this.type="CircleGeometry",this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:e},this.fromBufferGeometry(new d.CircleBufferGeometry(a,b,c,e))},d.CircleGeometry.prototype=Object.create(d.Geometry.prototype),d.CircleGeometry.prototype.constructor=d.CircleGeometry,d.CircleBufferGeometry=function(a,b,c,e){d.BufferGeometry.call(this),this.type="CircleBufferGeometry",this.parameters={radius:a,segments:b,thetaStart:c,thetaLength:e},a=a||50,b=void 0!==b?Math.max(3,b):8,c=void 0!==c?c:0,e=void 0!==e?e:2*Math.PI;var f=b+2,g=new Float32Array(3*f),h=new Float32Array(3*f),i=new Float32Array(2*f);h[2]=1,i[0]=.5,i[1]=.5;for(var j=0,k=3,l=2;j<=b;j++,k+=3,l+=2){var m=c+j/b*e;g[k]=a*Math.cos(m),g[k+1]=a*Math.sin(m),h[k+2]=1,i[l]=(g[k]/a+1)/2,i[l+1]=(g[k+1]/a+1)/2}for(var n=[],k=1;k<=b;k++)n.push(k,k+1,0);this.setIndex(new d.BufferAttribute(new Uint16Array(n),1)),this.addAttribute("position",new d.BufferAttribute(g,3)),this.addAttribute("normal",new d.BufferAttribute(h,3)),this.addAttribute("uv",new d.BufferAttribute(i,2)),this.boundingSphere=new d.Sphere(new d.Vector3,a)},d.CircleBufferGeometry.prototype=Object.create(d.BufferGeometry.prototype),d.CircleBufferGeometry.prototype.constructor=d.CircleBufferGeometry,d.CylinderBufferGeometry=function(a,b,c,e,f,g,h,i){function j(c){var f,g,j,k=new d.Vector2,l=new d.Vector3,s=!0===c?a:b,u=!0===c?1:-1;for(g=q,f=1;f<=e;f++)n.setXYZ(q,0,t*u,0),o.setXYZ(q,0,u,0),!0===c?(k.x=f/e,k.y=0):(k.x=(f-1)/e,k.y=1),p.setXY(q,k.x,k.y),q++;for(j=q,f=0;f<=e;f++){var v=f/e;l.x=s*Math.sin(v*i+h),l.y=t*u,l.z=s*Math.cos(v*i+h),n.setXYZ(q,l.x,l.y,l.z),o.setXYZ(q,0,u,0),p.setXY(q,v,!0===c?1:0),q++}for(f=0;f<e;f++){var w=g+f,x=j+f;!0===c?(m.setX(r,x),r++,m.setX(r,x+1),r++,m.setX(r,w),r++):(m.setX(r,x+1),r++,m.setX(r,x),r++,m.setX(r,w),r++)}}d.BufferGeometry.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:e,heightSegments:f,openEnded:g,thetaStart:h,thetaLength:i},a=void 0!==a?a:20,b=void 0!==b?b:20,c=void 0!==c?c:100,e=Math.floor(e)||8,f=Math.floor(f)||1,g=void 0!==g&&g,h=void 0!==h?h:0,i=void 0!==i?i:2*Math.PI;var k=function(){var a=(e+1)*(f+1);return!1===g&&(a+=2*(e+1)+2*e),a}(),l=function(){var a=e*f*2*3;return!1===g&&(a+=2*e*3),a}(),m=new d.BufferAttribute(new(l>65535?Uint32Array:Uint16Array)(l),1),n=new d.BufferAttribute(new Float32Array(3*k),3),o=new d.BufferAttribute(new Float32Array(3*k),3),p=new d.BufferAttribute(new Float32Array(2*k),2),q=0,r=0,s=[],t=c/2;!function(){var g,j,k=new d.Vector3,l=new d.Vector3,u=(b-a)/c;for(j=0;j<=f;j++){var v=[],w=j/f,x=w*(b-a)+a;for(g=0;g<=e;g++){var y=g/e;l.x=x*Math.sin(y*i+h),l.y=-w*c+t,l.z=x*Math.cos(y*i+h),n.setXYZ(q,l.x,l.y,l.z),k.copy(l),(0===a&&0===j||0===b&&j===f)&&(k.x=Math.sin(y*i+h),k.z=Math.cos(y*i+h)),k.setY(Math.sqrt(k.x*k.x+k.z*k.z)*u).normalize(),o.setXYZ(q,k.x,k.y,k.z),p.setXY(q,y,1-w),v.push(q),q++}s.push(v)}for(g=0;g<e;g++)for(j=0;j<f;j++){var z=s[j][g],A=s[j+1][g],B=s[j+1][g+1],C=s[j][g+1];m.setX(r,z),r++,m.setX(r,A),r++,m.setX(r,C),r++,m.setX(r,A),r++,m.setX(r,B),r++,m.setX(r,C),r++}}(),!1===g&&(a>0&&j(!0),b>0&&j(!1)),this.setIndex(m),this.addAttribute("position",n),this.addAttribute("normal",o),this.addAttribute("uv",p)},d.CylinderBufferGeometry.prototype=Object.create(d.BufferGeometry.prototype),d.CylinderBufferGeometry.prototype.constructor=d.CylinderBufferGeometry,d.CylinderGeometry=function(a,b,c,e,f,g,h,i){d.Geometry.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:a,radiusBottom:b,height:c,radialSegments:e,heightSegments:f,openEnded:g,thetaStart:h,thetaLength:i},this.fromBufferGeometry(new d.CylinderBufferGeometry(a,b,c,e,f,g,h,i)),this.mergeVertices()},d.CylinderGeometry.prototype=Object.create(d.Geometry.prototype),d.CylinderGeometry.prototype.constructor=d.CylinderGeometry,d.EdgesGeometry=function(a,b){function c(a,b){return a-b}d.BufferGeometry.call(this),b=void 0!==b?b:1;var e,f=Math.cos(d.Math.degToRad(b)),g=[0,0],h={},i=["a","b","c"];a instanceof d.BufferGeometry?(e=new d.Geometry,e.fromBufferGeometry(a)):e=a.clone(),e.mergeVertices(),e.computeFaceNormals();for(var j=e.vertices,k=e.faces,l=0,m=k.length;l<m;l++)for(var n=k[l],o=0;o<3;o++){g[0]=n[i[o]],g[1]=n[i[(o+1)%3]],g.sort(c);var p=g.toString();void 0===h[p]?h[p]={vert1:g[0],vert2:g[1],face1:l,face2:void 0}:h[p].face2=l}var q=[];for(var p in h){var r=h[p];if(void 0===r.face2||k[r.face1].normal.dot(k[r.face2].normal)<=f){var s=j[r.vert1];q.push(s.x),q.push(s.y),q.push(s.z),s=j[r.vert2],q.push(s.x),q.push(s.y),q.push(s.z)}}this.addAttribute("position",new d.BufferAttribute(new Float32Array(q),3))};d.EdgesGeometry.prototype=Object.create(d.BufferGeometry.prototype),d.EdgesGeometry.prototype.constructor=d.EdgesGeometry,d.ExtrudeGeometry=function(a,b){if(void 0===a)return void(a=[]);d.Geometry.call(this),this.type="ExtrudeGeometry",a=Array.isArray(a)?a:[a],this.addShapeList(a,b),this.computeFaceNormals()},
d.ExtrudeGeometry.prototype=Object.create(d.Geometry.prototype),d.ExtrudeGeometry.prototype.constructor=d.ExtrudeGeometry,d.ExtrudeGeometry.prototype.addShapeList=function(a,b){for(var c=a.length,d=0;d<c;d++){var e=a[d];this.addShape(e,b)}},d.ExtrudeGeometry.prototype.addShape=function(a,b){function c(a,b,c){return b||console.error("THREE.ExtrudeGeometry: vec does not exist"),b.clone().multiplyScalar(c).add(a)}function e(a,b,c){var e,f,g=1,h=a.x-b.x,i=a.y-b.y,j=c.x-a.x,k=c.y-a.y,l=h*h+i*i,m=h*k-i*j;if(Math.abs(m)>Number.EPSILON){var n=Math.sqrt(l),o=Math.sqrt(j*j+k*k),p=b.x-i/n,q=b.y+h/n,r=c.x-k/o,s=c.y+j/o,t=((r-p)*k-(s-q)*j)/(h*k-i*j);e=p+h*t-a.x,f=q+i*t-a.y;var u=e*e+f*f;if(u<=2)return new d.Vector2(e,f);g=Math.sqrt(u/2)}else{var v=!1;h>Number.EPSILON?j>Number.EPSILON&&(v=!0):h<-Number.EPSILON?j<-Number.EPSILON&&(v=!0):Math.sign(i)===Math.sign(k)&&(v=!0),v?(e=-i,f=h,g=Math.sqrt(l)):(e=h,f=i,g=Math.sqrt(l/2))}return new d.Vector2(e/g,f/g)}function f(a,b){var c,d;for(S=a.length;--S>=0;){c=S,d=S-1,d<0&&(d=a.length-1);var e=0,f=u+2*r;for(e=0;e<f;e++){var g=P*e,h=P*(e+1);i(b+c+g,b+d+g,b+d+h,b+c+h,a,e,f,c,d)}}}function g(a,b,c){B.vertices.push(new d.Vector3(a,b,c))}function h(a,b,c){a+=C,b+=C,c+=C,B.faces.push(new d.Face3(a,b,c,null,null,0));var e=x.generateTopUV(B,a,b,c);B.faceVertexUvs[0].push(e)}function i(a,b,c,e,f,g,h,i,j){a+=C,b+=C,c+=C,e+=C,B.faces.push(new d.Face3(a,b,e,null,null,1)),B.faces.push(new d.Face3(b,c,e,null,null,1));var k=x.generateSideWallUV(B,a,b,c,e);B.faceVertexUvs[0].push([k[0],k[1],k[3]]),B.faceVertexUvs[0].push([k[1],k[2],k[3]])}var j,k,l,m,n,o=void 0!==b.amount?b.amount:100,p=void 0!==b.bevelThickness?b.bevelThickness:6,q=void 0!==b.bevelSize?b.bevelSize:p-2,r=void 0!==b.bevelSegments?b.bevelSegments:3,s=void 0===b.bevelEnabled||b.bevelEnabled,t=void 0!==b.curveSegments?b.curveSegments:12,u=void 0!==b.steps?b.steps:1,v=b.extrudePath,w=!1,x=void 0!==b.UVGenerator?b.UVGenerator:d.ExtrudeGeometry.WorldUVGenerator;v&&(j=v.getSpacedPoints(u),w=!0,s=!1,k=void 0!==b.frames?b.frames:new d.TubeGeometry.FrenetFrames(v,u,!1),l=new d.Vector3,m=new d.Vector3,n=new d.Vector3),s||(r=0,p=0,q=0);var y,z,A,B=this,C=this.vertices.length,D=a.extractPoints(t),E=D.shape,F=D.holes,G=!d.ShapeUtils.isClockWise(E);if(G){for(E=E.reverse(),z=0,A=F.length;z<A;z++)y=F[z],d.ShapeUtils.isClockWise(y)&&(F[z]=y.reverse());G=!1}var H=d.ShapeUtils.triangulateShape(E,F),I=E;for(z=0,A=F.length;z<A;z++)y=F[z],E=E.concat(y);for(var J,K,L,M,N,O,P=E.length,Q=H.length,R=[],S=0,T=I.length,U=T-1,V=S+1;S<T;S++,U++,V++)U===T&&(U=0),V===T&&(V=0),R[S]=e(I[S],I[U],I[V]);var W,X=[],Y=R.concat();for(z=0,A=F.length;z<A;z++){for(y=F[z],W=[],S=0,T=y.length,U=T-1,V=S+1;S<T;S++,U++,V++)U===T&&(U=0),V===T&&(V=0),W[S]=e(y[S],y[U],y[V]);X.push(W),Y=Y.concat(W)}for(J=0;J<r;J++){for(L=J/r,M=p*(1-L),K=q*Math.sin(L*Math.PI/2),S=0,T=I.length;S<T;S++)N=c(I[S],R[S],K),g(N.x,N.y,-M);for(z=0,A=F.length;z<A;z++)for(y=F[z],W=X[z],S=0,T=y.length;S<T;S++)N=c(y[S],W[S],K),g(N.x,N.y,-M)}for(K=q,S=0;S<P;S++)N=s?c(E[S],Y[S],K):E[S],w?(m.copy(k.normals[0]).multiplyScalar(N.x),l.copy(k.binormals[0]).multiplyScalar(N.y),n.copy(j[0]).add(m).add(l),g(n.x,n.y,n.z)):g(N.x,N.y,0);var Z;for(Z=1;Z<=u;Z++)for(S=0;S<P;S++)N=s?c(E[S],Y[S],K):E[S],w?(m.copy(k.normals[Z]).multiplyScalar(N.x),l.copy(k.binormals[Z]).multiplyScalar(N.y),n.copy(j[Z]).add(m).add(l),g(n.x,n.y,n.z)):g(N.x,N.y,o/u*Z);for(J=r-1;J>=0;J--){for(L=J/r,M=p*(1-L),K=q*Math.sin(L*Math.PI/2),S=0,T=I.length;S<T;S++)N=c(I[S],R[S],K),g(N.x,N.y,o+M);for(z=0,A=F.length;z<A;z++)for(y=F[z],W=X[z],S=0,T=y.length;S<T;S++)N=c(y[S],W[S],K),w?g(N.x,N.y+j[u-1].y,j[u-1].x+M):g(N.x,N.y,o+M)}!function(){if(s){var a=0,b=P*a;for(S=0;S<Q;S++)O=H[S],h(O[2]+b,O[1]+b,O[0]+b);for(a=u+2*r,b=P*a,S=0;S<Q;S++)O=H[S],h(O[0]+b,O[1]+b,O[2]+b)}else{for(S=0;S<Q;S++)O=H[S],h(O[2],O[1],O[0]);for(S=0;S<Q;S++)O=H[S],h(O[0]+P*u,O[1]+P*u,O[2]+P*u)}}(),function(){var a=0;for(f(I,a),a+=I.length,z=0,A=F.length;z<A;z++)y=F[z],f(y,a),a+=y.length}()},d.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(a,b,c,e){var f=a.vertices,g=f[b],h=f[c],i=f[e];return[new d.Vector2(g.x,g.y),new d.Vector2(h.x,h.y),new d.Vector2(i.x,i.y)]},generateSideWallUV:function(a,b,c,e,f){var g=a.vertices,h=g[b],i=g[c],j=g[e],k=g[f];return Math.abs(h.y-i.y)<.01?[new d.Vector2(h.x,1-h.z),new d.Vector2(i.x,1-i.z),new d.Vector2(j.x,1-j.z),new d.Vector2(k.x,1-k.z)]:[new d.Vector2(h.y,1-h.z),new d.Vector2(i.y,1-i.z),new d.Vector2(j.y,1-j.z),new d.Vector2(k.y,1-k.z)]}},d.ShapeGeometry=function(a,b){d.Geometry.call(this),this.type="ShapeGeometry",!1===Array.isArray(a)&&(a=[a]),this.addShapeList(a,b),this.computeFaceNormals()},d.ShapeGeometry.prototype=Object.create(d.Geometry.prototype),d.ShapeGeometry.prototype.constructor=d.ShapeGeometry,d.ShapeGeometry.prototype.addShapeList=function(a,b){for(var c=0,d=a.length;c<d;c++)this.addShape(a[c],b);return this},d.ShapeGeometry.prototype.addShape=function(a,b){void 0===b&&(b={});var c,e,f,g=void 0!==b.curveSegments?b.curveSegments:12,h=b.material,i=void 0===b.UVGenerator?d.ExtrudeGeometry.WorldUVGenerator:b.UVGenerator,j=this.vertices.length,k=a.extractPoints(g),l=k.shape,m=k.holes,n=!d.ShapeUtils.isClockWise(l);if(n){for(l=l.reverse(),c=0,e=m.length;c<e;c++)f=m[c],d.ShapeUtils.isClockWise(f)&&(m[c]=f.reverse());n=!1}var o=d.ShapeUtils.triangulateShape(l,m);for(c=0,e=m.length;c<e;c++)f=m[c],l=l.concat(f);var p,q,r=l.length,s=o.length;for(c=0;c<r;c++)p=l[c],this.vertices.push(new d.Vector3(p.x,p.y,0));for(c=0;c<s;c++){q=o[c];var t=q[0]+j,u=q[1]+j,v=q[2]+j;this.faces.push(new d.Face3(t,u,v,null,null,h)),this.faceVertexUvs[0].push(i.generateTopUV(this,t,u,v))}},d.LatheBufferGeometry=function(a,b,c,e){d.BufferGeometry.call(this),this.type="LatheBufferGeometry",this.parameters={points:a,segments:b,phiStart:c,phiLength:e},b=Math.floor(b)||12,c=c||0,e=e||2*Math.PI,e=d.Math.clamp(e,0,2*Math.PI);var f,g,h,i=(b+1)*a.length,j=b*a.length*2*3,k=new d.BufferAttribute(new(j>65535?Uint32Array:Uint16Array)(j),1),l=new d.BufferAttribute(new Float32Array(3*i),3),m=new d.BufferAttribute(new Float32Array(2*i),2),n=0,o=0,p=(a.length,1/b),q=new d.Vector3,r=new d.Vector2;for(g=0;g<=b;g++){var s=c+g*p*e,t=Math.sin(s),u=Math.cos(s);for(h=0;h<=a.length-1;h++)q.x=a[h].x*t,q.y=a[h].y,q.z=a[h].x*u,l.setXYZ(n,q.x,q.y,q.z),r.x=g/b,r.y=h/(a.length-1),m.setXY(n,r.x,r.y),n++}for(g=0;g<b;g++)for(h=0;h<a.length-1;h++){f=h+g*a.length;var v=f,w=f+a.length,x=f+a.length+1,y=f+1;k.setX(o,v),o++,k.setX(o,w),o++,k.setX(o,y),o++,k.setX(o,w),o++,k.setX(o,x),o++,k.setX(o,y),o++}if(this.setIndex(k),this.addAttribute("position",l),this.addAttribute("uv",m),this.computeVertexNormals(),e===2*Math.PI){var z=this.attributes.normal.array,A=new d.Vector3,B=new d.Vector3,C=new d.Vector3;for(f=b*a.length*3,g=0,h=0;g<a.length;g++,h+=3)A.x=z[h+0],A.y=z[h+1],A.z=z[h+2],B.x=z[f+h+0],B.y=z[f+h+1],B.z=z[f+h+2],C.addVectors(A,B).normalize(),z[h+0]=z[f+h+0]=C.x,z[h+1]=z[f+h+1]=C.y,z[h+2]=z[f+h+2]=C.z}},d.LatheBufferGeometry.prototype=Object.create(d.BufferGeometry.prototype),d.LatheBufferGeometry.prototype.constructor=d.LatheBufferGeometry,d.LatheGeometry=function(a,b,c,e){d.Geometry.call(this),this.type="LatheGeometry",this.parameters={points:a,segments:b,phiStart:c,phiLength:e},this.fromBufferGeometry(new d.LatheBufferGeometry(a,b,c,e)),this.mergeVertices()},d.LatheGeometry.prototype=Object.create(d.Geometry.prototype),d.LatheGeometry.prototype.constructor=d.LatheGeometry,d.PlaneGeometry=function(a,b,c,e){d.Geometry.call(this),this.type="PlaneGeometry",this.parameters={width:a,height:b,widthSegments:c,heightSegments:e},this.fromBufferGeometry(new d.PlaneBufferGeometry(a,b,c,e))},d.PlaneGeometry.prototype=Object.create(d.Geometry.prototype),d.PlaneGeometry.prototype.constructor=d.PlaneGeometry,d.PlaneBufferGeometry=function(a,b,c,e){d.BufferGeometry.call(this),this.type="PlaneBufferGeometry",this.parameters={width:a,height:b,widthSegments:c,heightSegments:e};for(var f=a/2,g=b/2,h=Math.floor(c)||1,i=Math.floor(e)||1,j=h+1,k=i+1,l=a/h,m=b/i,n=new Float32Array(j*k*3),o=new Float32Array(j*k*3),p=new Float32Array(j*k*2),q=0,r=0,s=0;s<k;s++)for(var t=s*m-g,u=0;u<j;u++){var v=u*l-f;n[q]=v,n[q+1]=-t,o[q+2]=1,p[r]=u/h,p[r+1]=1-s/i,q+=3,r+=2}q=0;for(var w=new(n.length/3>65535?Uint32Array:Uint16Array)(h*i*6),s=0;s<i;s++)for(var u=0;u<h;u++){var x=u+j*s,y=u+j*(s+1),z=u+1+j*(s+1),A=u+1+j*s;w[q]=x,w[q+1]=y,w[q+2]=A,w[q+3]=y,w[q+4]=z,w[q+5]=A,q+=6}this.setIndex(new d.BufferAttribute(w,1)),this.addAttribute("position",new d.BufferAttribute(n,3)),this.addAttribute("normal",new d.BufferAttribute(o,3)),this.addAttribute("uv",new d.BufferAttribute(p,2))},d.PlaneBufferGeometry.prototype=Object.create(d.BufferGeometry.prototype),d.PlaneBufferGeometry.prototype.constructor=d.PlaneBufferGeometry,d.RingBufferGeometry=function(a,b,c,e,f,g){d.BufferGeometry.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:e,thetaStart:f,thetaLength:g},a=a||20,b=b||50,f=void 0!==f?f:0,g=void 0!==g?g:2*Math.PI,c=void 0!==c?Math.max(3,c):8,e=void 0!==e?Math.max(1,e):1;var h,i,j,k=(c+1)*(e+1),l=c*e*2*3,m=new d.BufferAttribute(new(l>65535?Uint32Array:Uint16Array)(l),1),n=new d.BufferAttribute(new Float32Array(3*k),3),o=new d.BufferAttribute(new Float32Array(3*k),3),p=new d.BufferAttribute(new Float32Array(2*k),2),q=0,r=0,s=a,t=(b-a)/e,u=new d.Vector3,v=new d.Vector2;for(i=0;i<=e;i++){for(j=0;j<=c;j++)h=f+j/c*g,u.x=s*Math.cos(h),u.y=s*Math.sin(h),n.setXYZ(q,u.x,u.y,u.z),o.setXYZ(q,0,0,1),v.x=(u.x/b+1)/2,v.y=(u.y/b+1)/2,p.setXY(q,v.x,v.y),q++;s+=t}for(i=0;i<e;i++){var w=i*(c+1);for(j=0;j<c;j++){h=j+w;var x=h,y=h+c+1,z=h+c+2,A=h+1;m.setX(r,x),r++,m.setX(r,y),r++,m.setX(r,z),r++,m.setX(r,x),r++,m.setX(r,z),r++,m.setX(r,A),r++}}this.setIndex(m),this.addAttribute("position",n),this.addAttribute("normal",o),this.addAttribute("uv",p)},d.RingBufferGeometry.prototype=Object.create(d.BufferGeometry.prototype),d.RingBufferGeometry.prototype.constructor=d.RingBufferGeometry,d.RingGeometry=function(a,b,c,e,f,g){d.Geometry.call(this),this.type="RingGeometry",this.parameters={innerRadius:a,outerRadius:b,thetaSegments:c,phiSegments:e,thetaStart:f,thetaLength:g},this.fromBufferGeometry(new d.RingBufferGeometry(a,b,c,e,f,g))},d.RingGeometry.prototype=Object.create(d.Geometry.prototype),d.RingGeometry.prototype.constructor=d.RingGeometry,d.SphereGeometry=function(a,b,c,e,f,g,h){d.Geometry.call(this),this.type="SphereGeometry",this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:e,phiLength:f,thetaStart:g,thetaLength:h},this.fromBufferGeometry(new d.SphereBufferGeometry(a,b,c,e,f,g,h))},d.SphereGeometry.prototype=Object.create(d.Geometry.prototype),d.SphereGeometry.prototype.constructor=d.SphereGeometry,d.SphereBufferGeometry=function(a,b,c,e,f,g,h){d.BufferGeometry.call(this),this.type="SphereBufferGeometry",this.parameters={radius:a,widthSegments:b,heightSegments:c,phiStart:e,phiLength:f,thetaStart:g,thetaLength:h},a=a||50,b=Math.max(3,Math.floor(b)||8),c=Math.max(2,Math.floor(c)||6),e=void 0!==e?e:0,f=void 0!==f?f:2*Math.PI,g=void 0!==g?g:0,h=void 0!==h?h:Math.PI;for(var i=g+h,j=(b+1)*(c+1),k=new d.BufferAttribute(new Float32Array(3*j),3),l=new d.BufferAttribute(new Float32Array(3*j),3),m=new d.BufferAttribute(new Float32Array(2*j),2),n=0,o=[],p=new d.Vector3,q=0;q<=c;q++){for(var r=[],s=q/c,t=0;t<=b;t++){var u=t/b,v=-a*Math.cos(e+u*f)*Math.sin(g+s*h),w=a*Math.cos(g+s*h),x=a*Math.sin(e+u*f)*Math.sin(g+s*h);p.set(v,w,x).normalize(),k.setXYZ(n,v,w,x),l.setXYZ(n,p.x,p.y,p.z),m.setXY(n,u,1-s),r.push(n),n++}o.push(r)}for(var y=[],q=0;q<c;q++)for(var t=0;t<b;t++){var z=o[q][t+1],A=o[q][t],B=o[q+1][t],C=o[q+1][t+1];(0!==q||g>0)&&y.push(z,A,C),(q!==c-1||i<Math.PI)&&y.push(A,B,C)}this.setIndex(new(k.count>65535?d.Uint32Attribute:d.Uint16Attribute)(y,1)),this.addAttribute("position",k),this.addAttribute("normal",l),this.addAttribute("uv",m),this.boundingSphere=new d.Sphere(new d.Vector3,a)},d.SphereBufferGeometry.prototype=Object.create(d.BufferGeometry.prototype),d.SphereBufferGeometry.prototype.constructor=d.SphereBufferGeometry,d.TextGeometry=function(a,b){b=b||{};var c=b.font;if(c instanceof d.Font==!1)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new d.Geometry;var e=c.generateShapes(a,b.size,b.curveSegments);b.amount=void 0!==b.height?b.height:50,void 0===b.bevelThickness&&(b.bevelThickness=10),void 0===b.bevelSize&&(b.bevelSize=8),void 0===b.bevelEnabled&&(b.bevelEnabled=!1),d.ExtrudeGeometry.call(this,e,b),this.type="TextGeometry"},d.TextGeometry.prototype=Object.create(d.ExtrudeGeometry.prototype),d.TextGeometry.prototype.constructor=d.TextGeometry,d.TorusBufferGeometry=function(a,b,c,e,f){d.BufferGeometry.call(this),this.type="TorusBufferGeometry",this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:e,arc:f},a=a||100,b=b||40,c=Math.floor(c)||8,e=Math.floor(e)||6,f=f||2*Math.PI;var g,h,i=(c+1)*(e+1),j=c*e*2*3,k=new(j>65535?Uint32Array:Uint16Array)(j),l=new Float32Array(3*i),m=new Float32Array(3*i),n=new Float32Array(2*i),o=0,p=0,q=0,r=new d.Vector3,s=new d.Vector3,t=new d.Vector3;for(g=0;g<=c;g++)for(h=0;h<=e;h++){var u=h/e*f,v=g/c*Math.PI*2;s.x=(a+b*Math.cos(v))*Math.cos(u),s.y=(a+b*Math.cos(v))*Math.sin(u),s.z=b*Math.sin(v),l[o]=s.x,l[o+1]=s.y,l[o+2]=s.z,r.x=a*Math.cos(u),r.y=a*Math.sin(u),t.subVectors(s,r).normalize(),m[o]=t.x,m[o+1]=t.y,m[o+2]=t.z,n[p]=h/e,n[p+1]=g/c,o+=3,p+=2}for(g=1;g<=c;g++)for(h=1;h<=e;h++){var w=(e+1)*g+h-1,x=(e+1)*(g-1)+h-1,y=(e+1)*(g-1)+h,z=(e+1)*g+h;k[q]=w,k[q+1]=x,k[q+2]=z,k[q+3]=x,k[q+4]=y,k[q+5]=z,q+=6}this.setIndex(new d.BufferAttribute(k,1)),this.addAttribute("position",new d.BufferAttribute(l,3)),this.addAttribute("normal",new d.BufferAttribute(m,3)),this.addAttribute("uv",new d.BufferAttribute(n,2))},d.TorusBufferGeometry.prototype=Object.create(d.BufferGeometry.prototype),d.TorusBufferGeometry.prototype.constructor=d.TorusBufferGeometry,d.TorusGeometry=function(a,b,c,e,f){d.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:e,arc:f},this.fromBufferGeometry(new d.TorusBufferGeometry(a,b,c,e,f))},d.TorusGeometry.prototype=Object.create(d.Geometry.prototype),d.TorusGeometry.prototype.constructor=d.TorusGeometry,d.TorusKnotBufferGeometry=function(a,b,c,e,f,g){function h(a,b,c,d,e){var f=Math.cos(a),g=Math.sin(a),h=c/b*a,i=Math.cos(h);e.x=d*(2+i)*.5*f,e.y=d*(2+i)*g*.5,e.z=d*Math.sin(h)*.5}d.BufferGeometry.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:e,p:f,q:g},a=a||100,b=b||40,c=Math.floor(c)||64,e=Math.floor(e)||8,f=f||2,g=g||3;var i,j,k=(e+1)*(c+1),l=e*c*2*3,m=new d.BufferAttribute(new(l>65535?Uint32Array:Uint16Array)(l),1),n=new d.BufferAttribute(new Float32Array(3*k),3),o=new d.BufferAttribute(new Float32Array(3*k),3),p=new d.BufferAttribute(new Float32Array(2*k),2),q=0,r=0,s=new d.Vector3,t=new d.Vector3,u=new d.Vector2,v=new d.Vector3,w=new d.Vector3,x=new d.Vector3,y=new d.Vector3,z=new d.Vector3;for(i=0;i<=c;++i){var A=i/c*f*Math.PI*2;for(h(A,f,g,a,v),h(A+.01,f,g,a,w),y.subVectors(w,v),z.addVectors(w,v),x.crossVectors(y,z),z.crossVectors(x,y),x.normalize(),z.normalize(),j=0;j<=e;++j){var B=j/e*Math.PI*2,C=-b*Math.cos(B),D=b*Math.sin(B);s.x=v.x+(C*z.x+D*x.x),s.y=v.y+(C*z.y+D*x.y),s.z=v.z+(C*z.z+D*x.z),n.setXYZ(q,s.x,s.y,s.z),t.subVectors(s,v).normalize(),o.setXYZ(q,t.x,t.y,t.z),u.x=i/c,u.y=j/e,p.setXY(q,u.x,u.y),q++}}for(j=1;j<=c;j++)for(i=1;i<=e;i++){var E=(e+1)*(j-1)+(i-1),F=(e+1)*j+(i-1),G=(e+1)*j+i,H=(e+1)*(j-1)+i;m.setX(r,E),r++,m.setX(r,F),r++,m.setX(r,H),r++,m.setX(r,F),r++,m.setX(r,G),r++,m.setX(r,H),r++}this.setIndex(m),this.addAttribute("position",n),this.addAttribute("normal",o),this.addAttribute("uv",p)},d.TorusKnotBufferGeometry.prototype=Object.create(d.BufferGeometry.prototype),d.TorusKnotBufferGeometry.prototype.constructor=d.TorusKnotBufferGeometry,d.TorusKnotGeometry=function(a,b,c,e,f,g,h){d.Geometry.call(this),this.type="TorusKnotGeometry",this.parameters={radius:a,tube:b,tubularSegments:c,radialSegments:e,p:f,q:g},void 0!==h&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new d.TorusKnotBufferGeometry(a,b,c,e,f,g)),this.mergeVertices()},d.TorusKnotGeometry.prototype=Object.create(d.Geometry.prototype),d.TorusKnotGeometry.prototype.constructor=d.TorusKnotGeometry,d.TubeGeometry=function(a,b,c,e,f,g){d.Geometry.call(this),this.type="TubeGeometry",this.parameters={path:a,segments:b,radius:c,radialSegments:e,closed:f,taper:g},b=b||64,c=c||1,e=e||8,f=f||!1,g=g||d.TubeGeometry.NoTaper;var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=[],C=this,D=b+1,E=new d.Vector3,F=new d.TubeGeometry.FrenetFrames(a,b,f),G=F.tangents,H=F.normals,I=F.binormals;for(this.tangents=G,this.normals=H,this.binormals=I,p=0;p<D;p++)for(B[p]=[],j=p/(D-1),o=a.getPointAt(j),G[p],h=H[p],i=I[p],l=c*g(j),q=0;q<e;q++)k=q/e*2*Math.PI,m=-l*Math.cos(k),n=l*Math.sin(k),E.copy(o),E.x+=m*h.x+n*i.x,E.y+=m*h.y+n*i.y,E.z+=m*h.z+n*i.z,B[p][q]=function(a,b,c){return C.vertices.push(new d.Vector3(a,b,c))-1}(E.x,E.y,E.z);for(p=0;p<b;p++)for(q=0;q<e;q++)r=f?(p+1)%b:p+1,s=(q+1)%e,t=B[p][q],u=B[r][q],v=B[r][s],w=B[p][s],x=new d.Vector2(p/b,q/e),y=new d.Vector2((p+1)/b,q/e),z=new d.Vector2((p+1)/b,(q+1)/e),A=new d.Vector2(p/b,(q+1)/e),this.faces.push(new d.Face3(t,u,w)),this.faceVertexUvs[0].push([x,y,A]),this.faces.push(new d.Face3(u,v,w)),this.faceVertexUvs[0].push([y.clone(),z,A.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},d.TubeGeometry.prototype=Object.create(d.Geometry.prototype),d.TubeGeometry.prototype.constructor=d.TubeGeometry,d.TubeGeometry.NoTaper=function(a){return 1},d.TubeGeometry.SinusoidalTaper=function(a){return Math.sin(Math.PI*a)},d.TubeGeometry.FrenetFrames=function(a,b,c){var e,f,g,h,i,j,k,l=new d.Vector3,m=[],n=[],o=[],p=new d.Vector3,q=new d.Matrix4,r=b+1;for(this.tangents=m,this.normals=n,this.binormals=o,j=0;j<r;j++)k=j/(r-1),m[j]=a.getTangentAt(k),m[j].normalize();for(function(){n[0]=new d.Vector3,o[0]=new d.Vector3,f=Number.MAX_VALUE,g=Math.abs(m[0].x),h=Math.abs(m[0].y),i=Math.abs(m[0].z),g<=f&&(f=g,l.set(1,0,0)),h<=f&&(f=h,l.set(0,1,0)),i<=f&&l.set(0,0,1),p.crossVectors(m[0],l).normalize(),n[0].crossVectors(m[0],p),o[0].crossVectors(m[0],n[0])}(),j=1;j<r;j++)n[j]=n[j-1].clone(),o[j]=o[j-1].clone(),p.crossVectors(m[j-1],m[j]),p.length()>Number.EPSILON&&(p.normalize(),e=Math.acos(d.Math.clamp(m[j-1].dot(m[j]),-1,1)),n[j].applyMatrix4(q.makeRotationAxis(p,e))),o[j].crossVectors(m[j],n[j]);if(c)for(e=Math.acos(d.Math.clamp(n[0].dot(n[r-1]),-1,1)),e/=r-1,m[0].dot(p.crossVectors(n[0],n[r-1]))>0&&(e=-e),j=1;j<r;j++)n[j].applyMatrix4(q.makeRotationAxis(m[j],e*j)),o[j].crossVectors(m[j],n[j])},d.PolyhedronGeometry=function(a,b,c,e){function f(a){var b=a.normalize().clone();b.index=k.vertices.push(b)-1;var c=h(a)/2/Math.PI+.5,e=i(a)/Math.PI+.5;return b.uv=new d.Vector2(c,1-e),b}function g(a,b,c,e){var f=new d.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()],void 0,e);k.faces.push(f),t.copy(a).add(b).add(c).divideScalar(3);var g=h(t);k.faceVertexUvs[0].push([j(a.uv,a,g),j(b.uv,b,g),j(c.uv,c,g)])}function h(a){return Math.atan2(a.z,-a.x)}function i(a){return Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))}function j(a,b,c){return c<0&&1===a.x&&(a=new d.Vector2(a.x-1,a.y)),0===b.x&&0===b.z&&(a=new d.Vector2(c/2/Math.PI+.5,a.y)),a.clone()}d.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:a,indices:b,radius:c,detail:e},c=c||1,e=e||0;for(var k=this,l=0,m=a.length;l<m;l+=3)f(new d.Vector3(a[l],a[l+1],a[l+2]));for(var n=this.vertices,o=[],l=0,p=0,m=b.length;l<m;l+=3,p++){var q=n[b[l]],r=n[b[l+1]],s=n[b[l+2]];o[p]=new d.Face3(q.index,r.index,s.index,[q.clone(),r.clone(),s.clone()],void 0,p)}for(var t=new d.Vector3,l=0,m=o.length;l<m;l++)!function(a,b){for(var c=Math.pow(2,b),d=f(k.vertices[a.a]),e=f(k.vertices[a.b]),h=f(k.vertices[a.c]),i=[],j=a.materialIndex,l=0;l<=c;l++){i[l]=[];for(var m=f(d.clone().lerp(h,l/c)),n=f(e.clone().lerp(h,l/c)),o=c-l,p=0;p<=o;p++)i[l][p]=0===p&&l===c?m:f(m.clone().lerp(n,p/o))}for(var l=0;l<c;l++)for(var p=0;p<2*(c-l)-1;p++){var q=Math.floor(p/2);p%2==0?g(i[l][q+1],i[l+1][q],i[l][q],j):g(i[l][q+1],i[l+1][q+1],i[l+1][q],j)}}(o[l],e);for(var l=0,m=this.faceVertexUvs[0].length;l<m;l++){var u=this.faceVertexUvs[0][l],v=u[0].x,w=u[1].x,x=u[2].x,y=Math.max(v,w,x),z=Math.min(v,w,x);y>.9&&z<.1&&(v<.2&&(u[0].x+=1),w<.2&&(u[1].x+=1),x<.2&&(u[2].x+=1))}for(var l=0,m=this.vertices.length;l<m;l++)this.vertices[l].multiplyScalar(c);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new d.Sphere(new d.Vector3,c)},d.PolyhedronGeometry.prototype=Object.create(d.Geometry.prototype),d.PolyhedronGeometry.prototype.constructor=d.PolyhedronGeometry,d.DodecahedronGeometry=function(a,b){var c=(1+Math.sqrt(5))/2,e=1/c,f=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-e,-c,0,-e,c,0,e,-c,0,e,c,-e,-c,0,-e,c,0,e,-c,0,e,c,0,-c,0,-e,c,0,-e,-c,0,e,c,0,e],g=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];d.PolyhedronGeometry.call(this,f,g,a,b),this.type="DodecahedronGeometry",this.parameters={radius:a,detail:b}},d.DodecahedronGeometry.prototype=Object.create(d.PolyhedronGeometry.prototype),d.DodecahedronGeometry.prototype.constructor=d.DodecahedronGeometry,d.IcosahedronGeometry=function(a,b){var c=(1+Math.sqrt(5))/2,e=[-1,c,0,1,c,0,-1,-c,0,1,-c,0,0,-1,c,0,1,c,0,-1,-c,0,1,-c,c,0,-1,c,0,1,-c,0,-1,-c,0,1],f=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];d.PolyhedronGeometry.call(this,e,f,a,b),this.type="IcosahedronGeometry",this.parameters={radius:a,detail:b}},d.IcosahedronGeometry.prototype=Object.create(d.PolyhedronGeometry.prototype),d.IcosahedronGeometry.prototype.constructor=d.IcosahedronGeometry,d.OctahedronGeometry=function(a,b){var c=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],e=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];d.PolyhedronGeometry.call(this,c,e,a,b),this.type="OctahedronGeometry",this.parameters={radius:a,detail:b}},d.OctahedronGeometry.prototype=Object.create(d.PolyhedronGeometry.prototype),d.OctahedronGeometry.prototype.constructor=d.OctahedronGeometry,d.TetrahedronGeometry=function(a,b){var c=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],e=[2,1,0,0,3,2,1,3,0,2,3,1];d.PolyhedronGeometry.call(this,c,e,a,b),this.type="TetrahedronGeometry",this.parameters={radius:a,detail:b}},d.TetrahedronGeometry.prototype=Object.create(d.PolyhedronGeometry.prototype),d.TetrahedronGeometry.prototype.constructor=d.TetrahedronGeometry,d.ParametricGeometry=function(a,b,c){d.Geometry.call(this),this.type="ParametricGeometry",this.parameters={func:a,slices:b,stacks:c};var e,f,g,h,i,j=this.vertices,k=this.faces,l=this.faceVertexUvs[0],m=b+1;for(e=0;e<=c;e++)for(i=e/c,f=0;f<=b;f++)h=f/b,g=a(h,i),j.push(g);var n,o,p,q,r,s,t,u;for(e=0;e<c;e++)for(f=0;f<b;f++)n=e*m+f,o=e*m+f+1,p=(e+1)*m+f+1,q=(e+1)*m+f,r=new d.Vector2(f/b,e/c),s=new d.Vector2((f+1)/b,e/c),t=new d.Vector2((f+1)/b,(e+1)/c),u=new d.Vector2(f/b,(e+1)/c),k.push(new d.Face3(n,o,q)),l.push([r,s,u]),k.push(new d.Face3(o,p,q)),l.push([s.clone(),t,u.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},d.ParametricGeometry.prototype=Object.create(d.Geometry.prototype),d.ParametricGeometry.prototype.constructor=d.ParametricGeometry,d.WireframeGeometry=function(a){function b(a,b){return a-b}d.BufferGeometry.call(this);var c=[0,0],e={},f=["a","b","c"];if(a instanceof d.Geometry){for(var g=a.vertices,h=a.faces,i=0,j=new Uint32Array(6*h.length),k=0,l=h.length;k<l;k++)for(var m=h[k],n=0;n<3;n++){c[0]=m[f[n]],c[1]=m[f[(n+1)%3]],c.sort(b);var o=c.toString();void 0===e[o]&&(j[2*i]=c[0],j[2*i+1]=c[1],e[o]=!0,i++)}for(var p=new Float32Array(2*i*3),k=0,l=i;k<l;k++)for(var n=0;n<2;n++){var q=g[j[2*k+n]],r=6*k+3*n;p[r+0]=q.x,p[r+1]=q.y,p[r+2]=q.z}this.addAttribute("position",new d.BufferAttribute(p,3))}else if(a instanceof d.BufferGeometry)if(null!==a.index){var s=a.index.array,g=a.attributes.position,t=a.groups,i=0;0===t.length&&a.addGroup(0,s.length);for(var j=new Uint32Array(2*s.length),u=0,v=t.length;u<v;++u)for(var w=t[u],x=w.start,y=w.count,k=x,z=x+y;k<z;k+=3)for(var n=0;n<3;n++){c[0]=s[k+n],c[1]=s[k+(n+1)%3],c.sort(b);var o=c.toString();void 0===e[o]&&(j[2*i]=c[0],j[2*i+1]=c[1],e[o]=!0,i++)}for(var p=new Float32Array(2*i*3),k=0,l=i;k<l;k++)for(var n=0;n<2;n++){var r=6*k+3*n,A=j[2*k+n];p[r+0]=g.getX(A),p[r+1]=g.getY(A),p[r+2]=g.getZ(A)}this.addAttribute("position",new d.BufferAttribute(p,3))}else{for(var g=a.attributes.position.array,i=g.length/3,B=i/3,p=new Float32Array(2*i*3),k=0,l=B;k<l;k++)for(var n=0;n<3;n++){var r=18*k+6*n,C=9*k+3*n;p[r+0]=g[C],p[r+1]=g[C+1],p[r+2]=g[C+2];var A=9*k+(n+1)%3*3;p[r+3]=g[A],p[r+4]=g[A+1],p[r+5]=g[A+2]}this.addAttribute("position",new d.BufferAttribute(p,3))}},d.WireframeGeometry.prototype=Object.create(d.BufferGeometry.prototype),d.WireframeGeometry.prototype.constructor=d.WireframeGeometry,d.AxisHelper=function(a){a=a||1;var b=new Float32Array([0,0,0,a,0,0,0,0,0,0,a,0,0,0,0,0,0,a]),c=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]),e=new d.BufferGeometry;e.addAttribute("position",new d.BufferAttribute(b,3)),e.addAttribute("color",new d.BufferAttribute(c,3));var f=new d.LineBasicMaterial({vertexColors:d.VertexColors});d.LineSegments.call(this,e,f)},d.AxisHelper.prototype=Object.create(d.LineSegments.prototype),d.AxisHelper.prototype.constructor=d.AxisHelper,d.ArrowHelper=function(){var a=new d.Geometry;a.vertices.push(new d.Vector3(0,0,0),new d.Vector3(0,1,0));var b=new d.CylinderGeometry(0,.5,1,5,1);return b.translate(0,-.5,0),function(c,e,f,g,h,i){d.Object3D.call(this),void 0===g&&(g=16776960),void 0===f&&(f=1),void 0===h&&(h=.2*f),void 0===i&&(i=.2*h),this.position.copy(e),this.line=new d.Line(a,new d.LineBasicMaterial({color:g})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new d.Mesh(b,new d.MeshBasicMaterial({color:g})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(c),this.setLength(f,h,i)}}(),d.ArrowHelper.prototype=Object.create(d.Object3D.prototype),d.ArrowHelper.prototype.constructor=d.ArrowHelper,d.ArrowHelper.prototype.setDirection=function(){var a,b=new d.Vector3;return function(c){c.y>.99999?this.quaternion.set(0,0,0,1):c.y<-.99999?this.quaternion.set(1,0,0,0):(b.set(c.z,0,-c.x).normalize(),a=Math.acos(c.y),this.quaternion.setFromAxisAngle(b,a))}}(),d.ArrowHelper.prototype.setLength=function(a,b,c){void 0===b&&(b=.2*a),void 0===c&&(c=.2*b),this.line.scale.set(1,Math.max(0,a-b),1),this.line.updateMatrix(),this.cone.scale.set(c,b,c),this.cone.position.y=a,this.cone.updateMatrix()},d.ArrowHelper.prototype.setColor=function(a){this.line.material.color.set(a),this.cone.material.color.set(a)},d.BoxHelper=function(a){var b=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),c=new Float32Array(24),e=new d.BufferGeometry;e.setIndex(new d.BufferAttribute(b,1)),e.addAttribute("position",new d.BufferAttribute(c,3)),d.LineSegments.call(this,e,new d.LineBasicMaterial({color:16776960})),void 0!==a&&this.update(a)},d.BoxHelper.prototype=Object.create(d.LineSegments.prototype),d.BoxHelper.prototype.constructor=d.BoxHelper,d.BoxHelper.prototype.update=function(){var a=new d.Box3;return function(b){if(a.setFromObject(b),!a.isEmpty()){var c=a.min,d=a.max,e=this.geometry.attributes.position,f=e.array;f[0]=d.x,f[1]=d.y,f[2]=d.z,f[3]=c.x,f[4]=d.y,f[5]=d.z,f[6]=c.x,f[7]=c.y,f[8]=d.z,f[9]=d.x,f[10]=c.y,f[11]=d.z,f[12]=d.x,f[13]=d.y,f[14]=c.z,f[15]=c.x,f[16]=d.y,f[17]=c.z,f[18]=c.x,f[19]=c.y,f[20]=c.z,f[21]=d.x,f[22]=c.y,f[23]=c.z,e.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),d.BoundingBoxHelper=function(a,b){var c=void 0!==b?b:8947848;this.object=a,this.box=new d.Box3,d.Mesh.call(this,new d.BoxGeometry(1,1,1),new d.MeshBasicMaterial({color:c,wireframe:!0}))},d.BoundingBoxHelper.prototype=Object.create(d.Mesh.prototype),d.BoundingBoxHelper.prototype.constructor=d.BoundingBoxHelper,d.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},d.CameraHelper=function(a){function b(a,b,d){c(a,d),c(b,d)}function c(a,b){e.vertices.push(new d.Vector3),e.colors.push(new d.Color(b)),void 0===g[a]&&(g[a]=[]),g[a].push(e.vertices.length-1)}var e=new d.Geometry,f=new d.LineBasicMaterial({color:16777215,vertexColors:d.FaceColors}),g={};b("n1","n2",16755200),b("n2","n4",16755200),b("n4","n3",16755200),b("n3","n1",16755200),b("f1","f2",16755200),b("f2","f4",16755200),b("f4","f3",16755200),b("f3","f1",16755200),b("n1","f1",16755200),b("n2","f2",16755200),b("n3","f3",16755200),b("n4","f4",16755200),b("p","n1",16711680),b("p","n2",16711680),b("p","n3",16711680),b("p","n4",16711680),b("u1","u2",43775),b("u2","u3",43775),b("u3","u1",43775),b("c","t",16777215),b("p","c",3355443),b("cn1","cn2",3355443),b("cn3","cn4",3355443),b("cf1","cf2",3355443),b("cf3","cf4",3355443),d.LineSegments.call(this,e,f),this.camera=a,this.camera.updateProjectionMatrix(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=g,this.update()},d.CameraHelper.prototype=Object.create(d.LineSegments.prototype),d.CameraHelper.prototype.constructor=d.CameraHelper,d.CameraHelper.prototype.update=function(){function a(a,d,g,h){e.set(d,g,h).unproject(f);var i=c[a];if(void 0!==i)for(var j=0,k=i.length;j<k;j++)b.vertices[i[j]].copy(e)}var b,c,e=new d.Vector3,f=new d.Camera;return function(){b=this.geometry,c=this.pointMap;f.projectionMatrix.copy(this.camera.projectionMatrix),a("c",0,0,-1),a("t",0,0,1),a("n1",-1,-1,-1),a("n2",1,-1,-1),a("n3",-1,1,-1),a("n4",1,1,-1),a("f1",-1,-1,1),a("f2",1,-1,1),a("f3",-1,1,1),a("f4",1,1,1),a("u1",.7,1.1,-1),a("u2",-.7,1.1,-1),a("u3",0,2,-1),a("cf1",-1,0,1),a("cf2",1,0,1),a("cf3",0,-1,1),a("cf4",0,1,1),a("cn1",-1,0,-1),a("cn2",1,0,-1),a("cn3",0,-1,-1),a("cn4",0,1,-1),b.verticesNeedUpdate=!0}}(),d.DirectionalLightHelper=function(a,b){d.Object3D.call(this),this.light=a,this.light.updateMatrixWorld(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,b=b||1;var c=new d.Geometry;c.vertices.push(new d.Vector3(-b,b,0),new d.Vector3(b,b,0),new d.Vector3(b,-b,0),new d.Vector3(-b,-b,0),new d.Vector3(-b,b,0));var e=new d.LineBasicMaterial({fog:!1});e.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new d.Line(c,e),this.add(this.lightPlane),c=new d.Geometry,c.vertices.push(new d.Vector3,new d.Vector3),e=new d.LineBasicMaterial({fog:!1}),e.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new d.Line(c,e),this.add(this.targetLine),this.update()},d.DirectionalLightHelper.prototype=Object.create(d.Object3D.prototype),d.DirectionalLightHelper.prototype.constructor=d.DirectionalLightHelper,d.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},d.DirectionalLightHelper.prototype.update=function(){var a=new d.Vector3,b=new d.Vector3,c=new d.Vector3;return function(){a.setFromMatrixPosition(this.light.matrixWorld),b.setFromMatrixPosition(this.light.target.matrixWorld),c.subVectors(b,a),this.lightPlane.lookAt(c),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(c),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),d.EdgesHelper=function(a,b,c){var e=void 0!==b?b:16777215;d.LineSegments.call(this,new d.EdgesGeometry(a.geometry,c),new d.LineBasicMaterial({color:e})),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1},
d.EdgesHelper.prototype=Object.create(d.LineSegments.prototype),d.EdgesHelper.prototype.constructor=d.EdgesHelper,d.FaceNormalsHelper=function(a,b,c,e){this.object=a,this.size=void 0!==b?b:1;var f=void 0!==c?c:16776960,g=void 0!==e?e:1,h=0,i=this.object.geometry;i instanceof d.Geometry?h=i.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var j=new d.BufferGeometry,k=new d.Float32Attribute(2*h*3,3);j.addAttribute("position",k),d.LineSegments.call(this,j,new d.LineBasicMaterial({color:f,linewidth:g})),this.matrixAutoUpdate=!1,this.update()},d.FaceNormalsHelper.prototype=Object.create(d.LineSegments.prototype),d.FaceNormalsHelper.prototype.constructor=d.FaceNormalsHelper,d.FaceNormalsHelper.prototype.update=function(){var a=new d.Vector3,b=new d.Vector3,c=new d.Matrix3;return function(){this.object.updateMatrixWorld(!0),c.getNormalMatrix(this.object.matrixWorld);for(var d=this.object.matrixWorld,e=this.geometry.attributes.position,f=this.object.geometry,g=f.vertices,h=f.faces,i=0,j=0,k=h.length;j<k;j++){var l=h[j],m=l.normal;a.copy(g[l.a]).add(g[l.b]).add(g[l.c]).divideScalar(3).applyMatrix4(d),b.copy(m).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a),e.setXYZ(i,a.x,a.y,a.z),i+=1,e.setXYZ(i,b.x,b.y,b.z),i+=1}return e.needsUpdate=!0,this}}(),d.GridHelper=function(a,b){var c=new d.Geometry,e=new d.LineBasicMaterial({vertexColors:d.VertexColors});this.color1=new d.Color(4473924),this.color2=new d.Color(8947848);for(var f=-a;f<=a;f+=b){c.vertices.push(new d.Vector3(-a,0,f),new d.Vector3(a,0,f),new d.Vector3(f,0,-a),new d.Vector3(f,0,a));var g=0===f?this.color1:this.color2;c.colors.push(g,g,g,g)}d.LineSegments.call(this,c,e)},d.GridHelper.prototype=Object.create(d.LineSegments.prototype),d.GridHelper.prototype.constructor=d.GridHelper,d.GridHelper.prototype.setColors=function(a,b){this.color1.set(a),this.color2.set(b),this.geometry.colorsNeedUpdate=!0},d.HemisphereLightHelper=function(a,b){d.Object3D.call(this),this.light=a,this.light.updateMatrixWorld(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new d.Color,new d.Color];var c=new d.SphereGeometry(b,4,2);c.rotateX(-Math.PI/2);for(var e=0;e<8;e++)c.faces[e].color=this.colors[e<4?0:1];var f=new d.MeshBasicMaterial({vertexColors:d.FaceColors,wireframe:!0});this.lightSphere=new d.Mesh(c,f),this.add(this.lightSphere),this.update()},d.HemisphereLightHelper.prototype=Object.create(d.Object3D.prototype),d.HemisphereLightHelper.prototype.constructor=d.HemisphereLightHelper,d.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},d.HemisphereLightHelper.prototype.update=function(){var a=new d.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(a.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),d.PointLightHelper=function(a,b){this.light=a,this.light.updateMatrixWorld();var c=new d.SphereGeometry(b,4,2),e=new d.MeshBasicMaterial({wireframe:!0,fog:!1});e.color.copy(this.light.color).multiplyScalar(this.light.intensity),d.Mesh.call(this,c,e),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1},d.PointLightHelper.prototype=Object.create(d.Mesh.prototype),d.PointLightHelper.prototype.constructor=d.PointLightHelper,d.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},d.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},d.SkeletonHelper=function(a){this.bones=this.getBoneList(a);for(var b=new d.Geometry,c=0;c<this.bones.length;c++){this.bones[c].parent instanceof d.Bone&&(b.vertices.push(new d.Vector3),b.vertices.push(new d.Vector3),b.colors.push(new d.Color(0,0,1)),b.colors.push(new d.Color(0,1,0)))}b.dynamic=!0;var e=new d.LineBasicMaterial({vertexColors:d.VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});d.LineSegments.call(this,b,e),this.root=a,this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1,this.update()},d.SkeletonHelper.prototype=Object.create(d.LineSegments.prototype),d.SkeletonHelper.prototype.constructor=d.SkeletonHelper,d.SkeletonHelper.prototype.getBoneList=function(a){var b=[];a instanceof d.Bone&&b.push(a);for(var c=0;c<a.children.length;c++)b.push.apply(b,this.getBoneList(a.children[c]));return b},d.SkeletonHelper.prototype.update=function(){for(var a=this.geometry,b=(new d.Matrix4).getInverse(this.root.matrixWorld),c=new d.Matrix4,e=0,f=0;f<this.bones.length;f++){var g=this.bones[f];g.parent instanceof d.Bone&&(c.multiplyMatrices(b,g.matrixWorld),a.vertices[e].setFromMatrixPosition(c),c.multiplyMatrices(b,g.parent.matrixWorld),a.vertices[e+1].setFromMatrixPosition(c),e+=2)}a.verticesNeedUpdate=!0,a.computeBoundingSphere()},d.SpotLightHelper=function(a){d.Object3D.call(this),this.light=a,this.light.updateMatrixWorld(),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1;var b=new d.CylinderGeometry(0,1,1,8,1,!0);b.translate(0,-.5,0),b.rotateX(-Math.PI/2);var c=new d.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new d.Mesh(b,c),this.add(this.cone),this.update()},d.SpotLightHelper.prototype=Object.create(d.Object3D.prototype),d.SpotLightHelper.prototype.constructor=d.SpotLightHelper,d.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},d.SpotLightHelper.prototype.update=function(){var a=new d.Vector3,b=new d.Vector3;return function(){var c=this.light.distance?this.light.distance:1e4,d=c*Math.tan(this.light.angle);this.cone.scale.set(d,d,c),a.setFromMatrixPosition(this.light.matrixWorld),b.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(b.sub(a)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),d.VertexNormalsHelper=function(a,b,c,e){this.object=a,this.size=void 0!==b?b:1;var f=void 0!==c?c:16711680,g=void 0!==e?e:1,h=0,i=this.object.geometry;i instanceof d.Geometry?h=3*i.faces.length:i instanceof d.BufferGeometry&&(h=i.attributes.normal.count);var j=new d.BufferGeometry,k=new d.Float32Attribute(2*h*3,3);j.addAttribute("position",k),d.LineSegments.call(this,j,new d.LineBasicMaterial({color:f,linewidth:g})),this.matrixAutoUpdate=!1,this.update()},d.VertexNormalsHelper.prototype=Object.create(d.LineSegments.prototype),d.VertexNormalsHelper.prototype.constructor=d.VertexNormalsHelper,d.VertexNormalsHelper.prototype.update=function(){var a=new d.Vector3,b=new d.Vector3,c=new d.Matrix3;return function(){var e=["a","b","c"];this.object.updateMatrixWorld(!0),c.getNormalMatrix(this.object.matrixWorld);var f=this.object.matrixWorld,g=this.geometry.attributes.position,h=this.object.geometry;if(h instanceof d.Geometry)for(var i=h.vertices,j=h.faces,k=0,l=0,m=j.length;l<m;l++)for(var n=j[l],o=0,p=n.vertexNormals.length;o<p;o++){var q=i[n[e[o]]],r=n.vertexNormals[o];a.copy(q).applyMatrix4(f),b.copy(r).applyMatrix3(c).normalize().multiplyScalar(this.size).add(a),g.setXYZ(k,a.x,a.y,a.z),k+=1,g.setXYZ(k,b.x,b.y,b.z),k+=1}else if(h instanceof d.BufferGeometry)for(var s=h.attributes.position,t=h.attributes.normal,k=0,o=0,p=s.count;o<p;o++)a.set(s.getX(o),s.getY(o),s.getZ(o)).applyMatrix4(f),b.set(t.getX(o),t.getY(o),t.getZ(o)),b.applyMatrix3(c).normalize().multiplyScalar(this.size).add(a),g.setXYZ(k,a.x,a.y,a.z),k+=1,g.setXYZ(k,b.x,b.y,b.z),k+=1;return g.needsUpdate=!0,this}}(),d.WireframeHelper=function(a,b){var c=void 0!==b?b:16777215;d.LineSegments.call(this,new d.WireframeGeometry(a.geometry),new d.LineBasicMaterial({color:c})),this.matrix=a.matrixWorld,this.matrixAutoUpdate=!1},d.WireframeHelper.prototype=Object.create(d.LineSegments.prototype),d.WireframeHelper.prototype.constructor=d.WireframeHelper,d.ImmediateRenderObject=function(a){d.Object3D.call(this),this.material=a,this.render=function(a){}},d.ImmediateRenderObject.prototype=Object.create(d.Object3D.prototype),d.ImmediateRenderObject.prototype.constructor=d.ImmediateRenderObject,d.MorphBlendMesh=function(a,b){d.Mesh.call(this,a,b),this.animationsMap={},this.animationsList=[];var c=this.geometry.morphTargets.length,e=c-1,f=c/1;this.createAnimation("__default",0,e,f),this.setAnimationWeight("__default",1)},d.MorphBlendMesh.prototype=Object.create(d.Mesh.prototype),d.MorphBlendMesh.prototype.constructor=d.MorphBlendMesh,d.MorphBlendMesh.prototype.createAnimation=function(a,b,c,d){var e={start:b,end:c,length:c-b+1,fps:d,duration:(c-b)/d,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[a]=e,this.animationsList.push(e)},d.MorphBlendMesh.prototype.autoCreateAnimations=function(a){for(var b,c=/([a-z]+)_?(\d+)/i,d={},e=this.geometry,f=0,g=e.morphTargets.length;f<g;f++){var h=e.morphTargets[f],i=h.name.match(c);if(i&&i.length>1){var j=i[1];d[j]||(d[j]={start:1/0,end:-1/0});var k=d[j];f<k.start&&(k.start=f),f>k.end&&(k.end=f),b||(b=j)}}for(var j in d){var k=d[j];this.createAnimation(j,k.start,k.end,a)}this.firstAnimation=b},d.MorphBlendMesh.prototype.setAnimationDirectionForward=function(a){var b=this.animationsMap[a];b&&(b.direction=1,b.directionBackwards=!1)},d.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(a){var b=this.animationsMap[a];b&&(b.direction=-1,b.directionBackwards=!0)},d.MorphBlendMesh.prototype.setAnimationFPS=function(a,b){var c=this.animationsMap[a];c&&(c.fps=b,c.duration=(c.end-c.start)/c.fps)},d.MorphBlendMesh.prototype.setAnimationDuration=function(a,b){var c=this.animationsMap[a];c&&(c.duration=b,c.fps=(c.end-c.start)/c.duration)},d.MorphBlendMesh.prototype.setAnimationWeight=function(a,b){var c=this.animationsMap[a];c&&(c.weight=b)},d.MorphBlendMesh.prototype.setAnimationTime=function(a,b){var c=this.animationsMap[a];c&&(c.time=b)},d.MorphBlendMesh.prototype.getAnimationTime=function(a){var b=0,c=this.animationsMap[a];return c&&(b=c.time),b},d.MorphBlendMesh.prototype.getAnimationDuration=function(a){var b=-1,c=this.animationsMap[a];return c&&(b=c.duration),b},d.MorphBlendMesh.prototype.playAnimation=function(a){var b=this.animationsMap[a];b?(b.time=0,b.active=!0):console.warn("THREE.MorphBlendMesh: animation["+a+"] undefined in .playAnimation()")},d.MorphBlendMesh.prototype.stopAnimation=function(a){var b=this.animationsMap[a];b&&(b.active=!1)},d.MorphBlendMesh.prototype.update=function(a){for(var b=0,c=this.animationsList.length;b<c;b++){var e=this.animationsList[b];if(e.active){var f=e.duration/e.length;e.time+=e.direction*a,e.mirroredLoop?(e.time>e.duration||e.time<0)&&(e.direction*=-1,e.time>e.duration&&(e.time=e.duration,e.directionBackwards=!0),e.time<0&&(e.time=0,e.directionBackwards=!1)):(e.time=e.time%e.duration,e.time<0&&(e.time+=e.duration));var g=e.start+d.Math.clamp(Math.floor(e.time/f),0,e.length-1),h=e.weight;g!==e.currentFrame&&(this.morphTargetInfluences[e.lastFrame]=0,this.morphTargetInfluences[e.currentFrame]=1*h,this.morphTargetInfluences[g]=0,e.lastFrame=e.currentFrame,e.currentFrame=g);var i=e.time%f/f;e.directionBackwards&&(i=1-i),e.currentFrame!==e.lastFrame?(this.morphTargetInfluences[e.currentFrame]=i*h,this.morphTargetInfluences[e.lastFrame]=(1-i)*h):this.morphTargetInfluences[e.currentFrame]=h}}},void 0!==c?(void 0!==b&&b.exports&&(c=b.exports=d),c.THREE=d):this.THREE=d},{}]},{},[91]);